<!DOCTYPE html><html><head><meta charset="utf-8" /><title>Vfwなcodecの設定画面を呼びたい - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/yumetodo/items/da5c27a863c0d30ae520" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="0oPH36R7EliFgZFI0XrwOoEpFjqwFdz92cTl+qw60pLJPVIzk7V2Xzc+QFAFp1k4inx5wn9qc17sgKdgtkpmAA==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta content="@yumetodo" name="twitter:creator" /><meta property="og:type" content="article"><meta property="og:title" content="Vfwなcodecの設定画面を呼びたい - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1WbVozNDRHcVkyOWtaV1BqZ2E3b3FLM2xycHJubEx2cG5hTGpncExsa2J6amdiUGpnWl9qZ1lRJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NTQmdHh0LWNsaXA9ZWxsaXBzaXMmdHh0LWFsaWduPWNlbnRlciUyQ21pZGRsZSZzPTk2NjhlMGY0MDk3NzE1Y2Y5Y2Y0ZWU5YmI3MmM4YzUy&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RSGwxYldWMGIyUnYmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT00NSZ0eHQtYWxpZ249cmlnaHQlMkNib3R0b20mcz00ZTgzMmFlMDBhYmZjNGMxNmRkYjk1YjdjYWI0YTRiYQ&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=f2d560d70b0c21c322721be90cad9625"><meta property="og:description" content="

動機

現在、Caputraというデスクトップキャプチャソフトに、AviUtlを使っている人ならおなじみの可逆圧縮codecである、Ut Video Codec Suiteを対応させる試みを行っています。

その過程で、codec..."><meta content="https://qiita.com/yumetodo/items/da5c27a863c0d30ae520" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="Windows,C#,Codec,VFW" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 1nzh4zz 38fzdi helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-1nzh4zz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:16px 32px;background-color:#FBE69E;color:rgba(0,0,0,0.87);line-height:1.5;font-weight:600;}@media (max-width:770px){.css-1nzh4zz{padding:16px;}}.css-38fzdi{color:#CA832A;margin-right:4px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-b86219f8-ed62-450a-8ce5-3a6c7c18e315"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Fyumetodo%2Fitems%2Fda5c27a863c0d30ae520">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Fyumetodo%2Fitems%2Fda5c27a863c0d30ae520">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-b86219f8-ed62-450a-8ce5-3a6c7c18e315">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/windows","name":"Windows"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2020-03-30T16:34:27.000+09:00","dateModified":"2020-03-30T16:34:27.000+09:00","headline":"Vfwなcodecの設定画面を呼びたい","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1WbVozNDRHcVkyOWtaV1BqZ2E3b3FLM2xycHJubEx2cG5hTGpncExsa2J6amdiUGpnWl9qZ1lRJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NTQmdHh0LWNsaXA9ZWxsaXBzaXMmdHh0LWFsaWduPWNlbnRlciUyQ21pZGRsZSZzPTk2NjhlMGY0MDk3NzE1Y2Y5Y2Y0ZWU5YmI3MmM4YzUy\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RSGwxYldWMGIyUnYmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT00NSZ0eHQtYWxpZ249cmlnaHQlMkNib3R0b20mcz00ZTgzMmFlMDBhYmZjNGMxNmRkYjk1YjdjYWI0YTRiYQ\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=f2d560d70b0c21c322721be90cad9625","mainEntityOfPage":"https://qiita.com/yumetodo/items/da5c27a863c0d30ae520","author":{"@type":"Person","address":"Tokyo, Japan","email":"yume-wikijp@live.jp","identifier":"yumetodo","name":"yumetodo","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2Fprofile-images%2F1584389588?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=124a7e02b16babd4198670a19f8052a7","url":"https://qiita.com/yumetodo","description":"ありきたりなC++erです。最近C++書いていません(あれっ","memberOf":[{"@type":"Organization","address":"","legalName":"Qiitadonユーザー会","image":"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/c85f835bbbb14a5f34454fb2a2ce03c50923c889/original.jpg?1594042832","logo":"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/f127ee01aab3e6ccdd1b16a52ce54e5d8f802e92/original.jpg?1594042832","identifier":"qiitadon","description":"Qiitadon（β）から生まれた Qiita ユーザー・コミュニティです。"}]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://zine.qiita.com/interview/202105-uzabase/?utm_source=qiita&amp;utm_medium=header-banner">CTO業務を積極的に権限移譲するユーザベースの開発組織とは</a><a target="_blank" id="header_text_message_2" href="https://zine.qiita.com/interview/202105-uzabase/?utm_source=qiita&amp;utm_medium=header-banner">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"yumetodo","type":"items","id":"da5c27a863c0d30ae520"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"CTO業務を積極的に権限移譲するユーザベースの開発組織とは","url":"https://zine.qiita.com/interview/202105-uzabase/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"yumetodo","type":"items","id":"da5c27a863c0d30ae520"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":2,"pos_id":"header_text_message_1","message":"CTO業務を積極的に権限移譲するユーザベースの開発組織とは","url":"https://zine.qiita.com/interview/202105-uzabase/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"yumetodo","type":"items","id":"da5c27a863c0d30ae520"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":2,"pos_id":"header_text_message_2","message":"CTO業務を積極的に権限移譲するユーザベースの開発組織とは","url":"https://zine.qiita.com/interview/202105-uzabase/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/yumetodo/items/da5c27a863c0d30ae520","location":"/yumetodo/items/da5c27a863c0d30ae520","scheme":"https","host":"qiita.com","port":null,"pathname":"/yumetodo/items/da5c27a863c0d30ae520","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"7jOEaGD0JK0AlHKLVprK+CqtUWCPyVKv2QH0wWJYTE/1jRGEVzpAqrIro5OCR2P6Ifg+mEC2/QzsRbZbeCj43Q==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-92d0111a-1b2e-4280-b27f-d2852266926e"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/yumetodo/items/da5c27a863c0d30ae520/likers" class="css-1iupg5d">0</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">0</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/da5c27a863c0d30ae520/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/yumetodo/items/da5c27a863c0d30ae520/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/yumetodo/items/da5c27a863c0d30ae520/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/yumetodo/items/da5c27a863c0d30ae520/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/yumetodo/items/da5c27a863c0d30ae520.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-1nzh4zz"><span class="fa fa-fw fa-warning css-38fzdi"></span><p>More than 1 year has passed since last update.</p></div><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/yumetodo"><img class="css-100alwu eyfquo10" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/profile-images/1584389588" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/yumetodo" class="css-10ougpm">@<!-- -->yumetodo</a><div class="css-1ay9vb9"><time dateTime="2020-03-30T07:34:27Z" class="css-m19uds">posted at 2020-03-30</time></div></div></div></div></div><h1 class="css-cgzq40">Vfwなcodecの設定画面を呼びたい</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/windows" class="css-4czcte">Windows</a><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/codec" class="css-4czcte">Codec</a><a href="/tags/vfw" class="css-4czcte">VFW</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div>
<h1>
<span id="動機" class="fragment"></span><a href="#%E5%8B%95%E6%A9%9F"><i class="fa fa-link"></i></a>動機</h1>

<p>現在、Caputraというデスクトップキャプチャソフトに、AviUtlを使っている人ならおなじみの可逆圧縮codecである、<a href="https://github.com/MathewSachin/Captura/issues/407" rel="nofollow noopener" target="_blank">Ut Video Codec Suiteを対応させる試みを行っています</a>。</p>

<p>その過程で、codecの設定をわざわざレジストリをいじるのは面倒だし、設定画面とか呼べないの？と思ったのですね。</p>

<p>例えばAviUtlなら<br>
<a href="https://camo.qiitausercontent.com/6a2d6986861f6effae5f38bdf882a8a847a67d20/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39343137372f37613735383463652d303434312d616363332d646232362d6263643664653764343737392e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F7a7584ce-0441-acc3-db26-bcd6de7d4779.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=3649bf76a7fbc8a5f6f1661f81514cd9" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/7a7584ce-0441-acc3-db26-bcd6de7d4779.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F7a7584ce-0441-acc3-db26-bcd6de7d4779.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=5ae2fd590737076f35e32b385d786326 1x" loading="lazy"></a><br>
この設定ボタンから呼べる<br>
<a href="https://camo.qiitausercontent.com/ba6fdc6dd91cd1b2f6bbb755f71259ecbebb719b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39343137372f35653835386132382d623630352d306131342d656431652d3063373832386338653464652e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F5e858a28-b605-0a14-ed1e-0c7828c8e4de.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=74f3cb95acb6ce65998b0058cba34dd5" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/5e858a28-b605-0a14-ed1e-0c7828c8e4de.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F5e858a28-b605-0a14-ed1e-0c7828c8e4de.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=7519371dfa111693bca2a9b356f79654 1x" loading="lazy"></a><br>
こういうやつです。</p>

<p>このウィンドウはAviUtlに固有のものではなくて他のソフトからも同じものが出るということは、Ut Video Codec Suite側で生成しているものだと推測できます。</p>

<h1>
<span id="ut-video-codec-suiteの実装を読む" class="fragment"></span><a href="#ut-video-codec-suite%E3%81%AE%E5%AE%9F%E8%A3%85%E3%82%92%E8%AA%AD%E3%82%80"><i class="fa fa-link"></i></a>Ut Video Codec Suiteの実装を読む</h1>

<p>幸いなことにソースコードはGitHubで公開されているので読んでいきます。</p>

<p><a href="https://github.com/umezawatakeshi/utvideo" rel="nofollow noopener" target="_blank">https://github.com/umezawatakeshi/utvideo</a></p>

<p>するとそういえばVFW pluginだったなと思い出してきました。</p>

<p>VfwというのはVideo for Windowsの略で、Win32API触ったことある人ならわかるであろう、プロージャーを書いてメッセージを受け取っていくタイプの書き方で、動画のエンコードやデコードなどなどを実装したdllを登録することで、いろいろなソフトウェアからそれが呼べる仕組みのことです。Windows Media Playerなんかはこれをつかって再生していたと思います。Windows 10標準搭載の動画アプリはMicrosoft Media Foundationという別のものを使っていますが。</p>

<p>なんか検索してると某有名ゲームエンジンの関連のVexe Frameworkのほうが引っかかってくるようですが・・・。</p>

<h2>
<span id="設定画面の呼び出し" class="fragment"></span><a href="#%E8%A8%AD%E5%AE%9A%E7%94%BB%E9%9D%A2%E3%81%AE%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%97"><i class="fa fa-link"></i></a>設定画面の呼び出し</h2>

<p>いろいろ読んでいくと、次のような箇所を見つけました。つまり<code>ICM_CONFIGURE</code>を受け取ったプロージャーは、<code>DialogBoxParam</code>によってWindowを生成しているではないですか。</p>

<div class="code-frame" data-lang="cpp">
<div class="code-lang"><span class="bold">utv_vcm/DriverProc.cpp</span></div>
<div class="highlight"><pre class="with-code"><code>    <span class="k">case</span> <span class="n">ICM_CONFIGURE</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">lParam1</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">pCodec</span><span class="o">-&gt;</span><span class="n">QueryConfigure</span><span class="p">();</span>
        <span class="k">else</span>
            <span class="k">return</span> <span class="n">pCodec</span><span class="o">-&gt;</span><span class="n">Configure</span><span class="p">((</span><span class="n">HWND</span><span class="p">)</span><span class="n">lParam1</span><span class="p">);</span>
</code></pre></div>
</div>

<p><qiita-embed-ogp src="https://github.com/umezawatakeshi/utvideo/blob/077a6a6202a3b5d60d1716559759210f6cedd795/utv_vcm/DriverProc.cpp#L45-L49"></qiita-embed-ogp></p>

<div class="code-frame" data-lang="cpp">
<div class="code-lang"><span class="bold">utv_vcm/VCMCodec.cpp</span></div>
<div class="highlight"><pre class="with-code"><code><span class="n">LRESULT</span> <span class="n">CVCMCodec</span><span class="o">::</span><span class="n">Configure</span><span class="p">(</span><span class="n">HWND</span> <span class="n">hwnd</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">m_mode</span> <span class="o">!=</span> <span class="n">ICMODE_COMPRESS</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ICERR_UNSUPPORTED</span><span class="p">;</span>

    <span class="k">return</span> <span class="n">m_pCodec</span><span class="o">-&gt;</span><span class="n">Configure</span><span class="p">(</span><span class="n">hwnd</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">?</span> <span class="n">ICERR_OK</span> <span class="o">:</span> <span class="n">ICERR_UNSUPPORTED</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p><qiita-embed-ogp src="https://github.com/umezawatakeshi/utvideo/blob/077a6a6202a3b5d60d1716559759210f6cedd795/utv_vcm/VCMCodec.cpp#L127-L133"></qiita-embed-ogp></p>

<div class="code-frame" data-lang="cpp">
<div class="code-lang"><span class="bold">utv_core/UL00Codec.cpp</span></div>
<div class="highlight"><pre class="with-code"><code><span class="n">INT_PTR</span> <span class="n">CUL00Codec</span><span class="o">::</span><span class="n">Configure</span><span class="p">(</span><span class="n">HWND</span> <span class="n">hwnd</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">DialogBoxParam</span><span class="p">(</span><span class="n">hModule</span><span class="p">,</span> <span class="n">MAKEINTRESOURCE</span><span class="p">(</span><span class="n">IDD_UL00_CONFIG</span><span class="p">),</span> <span class="n">hwnd</span><span class="p">,</span> <span class="n">DialogProc</span><span class="p">,</span> <span class="p">(</span><span class="n">LPARAM</span><span class="p">)</span><span class="k">this</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p><qiita-embed-ogp src="https://github.com/umezawatakeshi/utvideo/blob/077a6a6202a3b5d60d1716559759210f6cedd795/utv_core/UL00Codec.cpp#L31-L35"></qiita-embed-ogp></p>

<p>つまりVfw codecに対して<code>ICM_CONFIGURE</code>メッセージを投げられれば良さそうです。</p>

<p>ただし</p>

<ul>
<li>
<code>m_mode != ICMODE_COMPRESS</code>より、<code>m_mode</code>は<code>ICMODE_COMPRESS</code>でなければならない</li>
<li>
<code>lParam1 == -1</code>より、親ウィンドウのハンドルが必須</li>
</ul>

<h2>
<span id="初期化" class="fragment"></span><a href="#%E5%88%9D%E6%9C%9F%E5%8C%96"><i class="fa fa-link"></i></a>初期化</h2>

<p>しかし、その前に<code>pCodec</code>とか<code>m_mode</code>とかいう変数が見えます。これらはどうやって初期化されているのでしょうか？</p>

<div class="code-frame" data-lang="cpp"><div class="highlight"><pre class="with-code"><code><span class="n">LRESULT</span> <span class="n">CALLBACK</span> <span class="nf">DriverProc</span><span class="p">(</span><span class="n">DWORD_PTR</span> <span class="n">dwDriverId</span><span class="p">,</span> <span class="n">HDRVR</span> <span class="n">hdrvr</span><span class="p">,</span> <span class="n">UINT</span> <span class="n">uMsg</span><span class="p">,</span> <span class="n">LPARAM</span> <span class="n">lParam1</span><span class="p">,</span> <span class="n">LPARAM</span> <span class="n">lParam2</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">CVCMCodec</span> <span class="o">*</span><span class="n">pCodec</span> <span class="o">=</span> <span class="p">(</span><span class="n">CVCMCodec</span> <span class="o">*</span><span class="p">)</span><span class="n">dwDriverId</span><span class="p">;</span>
</code></pre></div></div>

<p>変数の定義を見るだけでは、プロージャーの引数から渡ってくるんだなとしかわかりません。</p>

<div class="code-frame" data-lang="cpp">
<div class="code-lang"><span class="bold">utv_vcm/DriverProc.cpp</span></div>
<div class="highlight"><pre class="with-code"><code>    <span class="k">case</span> <span class="n">DRV_OPEN</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">LRESULT</span><span class="p">)</span><span class="n">CVCMCodec</span><span class="o">::</span><span class="n">Open</span><span class="p">((</span><span class="n">ICOPEN</span> <span class="o">*</span><span class="p">)</span><span class="n">lParam2</span><span class="p">);</span>

    <span class="k">case</span> <span class="n">DRV_CLOSE</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">pCodec</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
            <span class="k">delete</span> <span class="n">pCodec</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
</code></pre></div>
</div>

<p><qiita-embed-ogp src="https://github.com/umezawatakeshi/utvideo/blob/077a6a6202a3b5d60d1716559759210f6cedd795/utv_vcm/DriverProc.cpp#L26-L32"></qiita-embed-ogp></p>

<p>もう少し下を見ると<code>DRV_CLOSE</code>を受け取ったときに、<code>pCodec</code>を<code>delete</code>しているところが見つかりました。さらにその上に<code>DRV_OPEN</code>というそれっぽいのがあります。<code>CVCMCodec::Open</code>を見てみましょう。</p>

<div class="code-frame" data-lang="cpp">
<div class="code-lang"><span class="bold">utv_vcm/VCMCodec.cpp</span></div>
<div class="highlight"><pre class="with-code"><code><span class="n">CVCMCodec</span> <span class="o">*</span><span class="n">CVCMCodec</span><span class="o">::</span><span class="n">Open</span><span class="p">(</span><span class="n">ICOPEN</span> <span class="o">*</span><span class="n">icopen</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">IsLogWriterInitializedOrDebugBuild</span><span class="p">())</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">icopen</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
            <span class="n">LOGPRINTF</span><span class="p">(</span><span class="s">"CVCMCodec::Open(icopen=%p, icopen-&gt;fccType=%08X, icopen-&gt;fccHandler=%08X icopen-&gt;dwFlags=%08X)"</span><span class="p">,</span> <span class="n">icopen</span><span class="p">,</span> <span class="n">icopen</span><span class="o">-&gt;</span><span class="n">fccType</span><span class="p">,</span> <span class="n">icopen</span><span class="o">-&gt;</span><span class="n">fccHandler</span><span class="p">,</span> <span class="n">icopen</span><span class="o">-&gt;</span><span class="n">dwFlags</span><span class="p">);</span>
        <span class="k">else</span>
            <span class="n">LOGPRINTF</span><span class="p">(</span><span class="s">"CVCMCodec::Open(icopen=NULL)"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">union</span>
    <span class="p">{</span>
        <span class="n">DWORD</span> <span class="n">fccHandler</span><span class="p">;</span>
        <span class="kt">char</span> <span class="n">fccChar</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
    <span class="p">};</span>

    <span class="n">DWORD</span> <span class="n">icmode</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">icopen</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">icopen</span><span class="o">-&gt;</span><span class="n">fccType</span> <span class="o">!=</span> <span class="n">ICTYPE_VIDEO</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
        <span class="n">fccHandler</span> <span class="o">=</span> <span class="n">icopen</span><span class="o">-&gt;</span><span class="n">fccHandler</span><span class="p">;</span>
        <span class="c1">// なぜか小文字で渡されることがあるので、最初に大文字化しておく。</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
            <span class="n">fccChar</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">toupper</span><span class="p">(</span><span class="n">fccChar</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>

        <span class="n">icopen</span><span class="o">-&gt;</span><span class="n">dwError</span> <span class="o">=</span> <span class="n">ICERR_UNSUPPORTED</span><span class="p">;</span>
        <span class="k">switch</span> <span class="p">(</span><span class="n">icopen</span><span class="o">-&gt;</span><span class="n">dwFlags</span><span class="p">)</span>
        <span class="p">{</span>
        <span class="k">case</span> <span class="n">ICMODE_COMPRESS</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">CheckInterfaceDisabledAndLog</span><span class="p">(</span><span class="s">"VCM"</span><span class="p">,</span> <span class="s">"Encoder"</span><span class="p">))</span>
                <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="n">ICMODE_DECOMPRESS</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">CheckInterfaceDisabledAndLog</span><span class="p">(</span><span class="s">"VCM"</span><span class="p">,</span> <span class="s">"Decoder"</span><span class="p">))</span>
                <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="n">ICMODE_QUERY</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">CheckInterfaceDisabledAndLog</span><span class="p">(</span><span class="s">"VCM"</span><span class="p">,</span> <span class="s">"Query"</span><span class="p">))</span>
                <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="nl">default:</span>
            <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">icopen</span><span class="o">-&gt;</span><span class="n">dwError</span> <span class="o">=</span> <span class="n">ICERR_OK</span><span class="p">;</span>
        <span class="n">icmode</span> <span class="o">=</span> <span class="n">icopen</span><span class="o">-&gt;</span><span class="n">dwFlags</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">fccHandler</span> <span class="o">=</span> <span class="p">(</span><span class="n">DWORD</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>
        <span class="n">icmode</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="k">new</span> <span class="n">CVCMCodec</span><span class="p">(</span><span class="n">fccHandler</span><span class="p">,</span> <span class="n">icmode</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p><qiita-embed-ogp src="https://github.com/umezawatakeshi/utvideo/blob/077a6a6202a3b5d60d1716559759210f6cedd795/utv_vcm/VCMCodec.cpp#L31-L87"></qiita-embed-ogp></p>

<p>細かいところは読み飛ばすとして、まず<code>icmode = icopen-&gt;dwFlags;</code>が目に入ります。さっき言ってた変数ですね！さらにこの関数は<code>return new CVCMCodec(fccHandler, icmode);</code>してます。確かに<code>DRV_OPEN</code>と<code>DRV_CLOSE</code>は対応関係にあることがわかります。</p>

<h1>
<span id="どうやってvfwなcodecにメッセージを投げるか" class="fragment"></span><a href="#%E3%81%A9%E3%81%86%E3%82%84%E3%81%A3%E3%81%A6vfw%E3%81%AAcodec%E3%81%AB%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E3%82%92%E6%8A%95%E3%81%92%E3%82%8B%E3%81%8B"><i class="fa fa-link"></i></a>どうやってVfwなcodecにメッセージを投げるか</h1>

<p>つまり、どうにかしてコーデックのプロージャーにメッセージを投げられればいいわけです。</p>

<p>ただ、検索の仕方が悪くてなかなかたどり着けず、</p>

<p><qiita-embed-ogp src="https://github.com/baSSiLL/SharpAvi"></qiita-embed-ogp></p>

<p>のソースコードを読み漁ってました。</p>

<p>結局使う関数は</p>

<ul>
<li><a href="https://docs.microsoft.com/ja-jp/windows/win32/api/vfw/nf-vfw-icopen" rel="nofollow noopener" target="_blank"><code>ICOpen</code></a></li>
<li><a href="https://docs.microsoft.com/ja-jp/windows/win32/api/vfw/nf-vfw-icsendmessage" rel="nofollow noopener" target="_blank"><code>ICSendMessage</code></a></li>
<li><a href="https://docs.microsoft.com/ja-jp/windows/win32/api/vfw/nf-vfw-icclose" rel="nofollow noopener" target="_blank"><code>ICClose</code></a></li>
</ul>

<p>の3つだとわかりました。</p>

<p><code>ICOpen</code>は次のようなプロトタイプ宣言で定義されています。</p>

<div class="code-frame" data-lang="cpp"><div class="highlight"><pre class="with-code"><code><span class="n">HIC</span> <span class="n">VFWAPI</span> <span class="nf">ICOpen</span><span class="p">(</span>
  <span class="n">DWORD</span> <span class="n">fccType</span><span class="p">,</span>
  <span class="n">DWORD</span> <span class="n">fccHandler</span><span class="p">,</span>
  <span class="n">UINT</span>  <span class="n">wMode</span>
<span class="p">);</span>
</code></pre></div></div>

<p><code>fcc</code>というのが見えますが、これは<code>FOURCC</code>のことです。</p>

<blockquote>
<p><a href="https://ja.wikipedia.org/wiki/FourCC" rel="nofollow noopener" target="_blank">FourCC - Wikipedia</a><br>
FourCC (フォーシーシー) とは、データフォーマットを一意に識別するための4バイトの並びである（four-character code の意）。</p>
</blockquote>

<p><code>fccType</code>には<code>VIDC</code>という文字列をFourCCとして整数に変換したもの、<code>wMode</code>には先に述べたように<code>ICMODE_COMPRESS</code>を渡すとして、<code>fccHandler</code>には何を渡せばいいのでしょうか？今回はUt Video Codec Suiteの設定画面を呼びたいので、早速FourCCを調べましょう。</p>

<p>といっても公式で<br>
<a href="http://umezawa.dyndns.info/archive/utvideo/utvideo-21.2.0-readme.ja.html#fourcc" rel="nofollow noopener" target="_blank">Ut Video Codec Suite 21.2.0 readme （日本語）FourCC 一覧</a><br>
にまとめられているのでそれを見るだけですね。</p>

<p>とりあえず今回は<code>ULH2</code>にしましょう。</p>

<h1>
<span id="実装" class="fragment"></span><a href="#%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>実装</h1>

<h2>
<span id="arikitari-na-world" class="fragment"></span><a href="#arikitari-na-world"><i class="fa fa-link"></i></a>arikitari na world!</h2>

<p>親ウィンドウがないといけないので、雑にWPFで作りましょう。</p>

<div class="code-frame" data-lang="xml">
<div class="code-lang"><span class="bold">MainWindow.xaml</span></div>
<div class="highlight"><pre class="with-code"><code><span class="nt">&lt;Window</span> <span class="na">x:Class=</span><span class="s">"WpfApp1.MainWindow"</span>
        <span class="na">xmlns=</span><span class="s">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span>
        <span class="na">xmlns:x=</span><span class="s">"http://schemas.microsoft.com/winfx/2006/xaml"</span>
        <span class="na">xmlns:d=</span><span class="s">"http://schemas.microsoft.com/expression/blend/2008"</span>
        <span class="na">xmlns:mc=</span><span class="s">"http://schemas.openxmlformats.org/markup-compatibility/2006"</span>
        <span class="na">xmlns:local=</span><span class="s">"clr-namespace:WpfApp1"</span>
        <span class="na">mc:Ignorable=</span><span class="s">"d"</span>
        <span class="na">Title=</span><span class="s">"VfwConfigCall"</span> <span class="na">Height=</span><span class="s">"100"</span> <span class="na">Width=</span><span class="s">"300"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Grid&gt;</span>
        <span class="nt">&lt;Button</span> <span class="na">Margin=</span><span class="s">"10"</span> <span class="na">Click=</span><span class="s">"SettingClick"</span><span class="nt">&gt;</span>Setting<span class="nt">&lt;/Button&gt;</span>
    <span class="nt">&lt;/Grid&gt;</span>
<span class="nt">&lt;/Window&gt;</span>
</code></pre></div>
</div>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">MainWindow.xaml.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">System.Windows</span><span class="p">;</span>
<span class="k">namespace</span> <span class="nn">WpfApp1</span>
<span class="p">{</span>
    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">/// Interaction logic for MainWindow.xaml</span>
    <span class="c1">/// &lt;/summary&gt;</span>
    <span class="k">public</span> <span class="k">partial</span> <span class="k">class</span> <span class="nc">MainWindow</span> <span class="p">:</span> <span class="n">Window</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="nf">MainWindow</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="nf">InitializeComponent</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">private</span> <span class="k">void</span> <span class="nf">SettingClick</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">RoutedEventArgs</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">MessageBox</span><span class="p">.</span><span class="nf">Show</span><span class="p">(</span><span class="s">"arikitari na world!"</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>まずはこれで全世界の人がまずは表示させるであろう恒例の<code>arikitari na world!</code>を表示させて動いたことを確認したら本実装に入りましょう。</p>

<h2>
<span id="定数" class="fragment"></span><a href="#%E5%AE%9A%E6%95%B0"><i class="fa fa-link"></i></a>定数</h2>

<p><code>vfw.h</code>をみつつ必要なものを取ってきましょう。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code>        <span class="k">private</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">DRV_USER</span> <span class="p">=</span> <span class="m">0x4000</span><span class="p">;</span>
        <span class="k">private</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">ICM_RESERVED_LOW</span> <span class="p">=</span> <span class="n">DRV_USER</span> <span class="p">+</span> <span class="m">0x1000</span><span class="p">;</span>
        <span class="k">private</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">ICM_RESERVED</span> <span class="p">=</span> <span class="n">ICM_RESERVED_LOW</span><span class="p">;</span>
        <span class="k">private</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">ICM_CONFIGURE</span> <span class="p">=</span> <span class="n">ICM_RESERVED</span> <span class="p">+</span> <span class="m">10</span><span class="p">;</span>
        <span class="k">private</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">ICMODE_COMPRESS</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span>
</code></pre></div></div>

<h2>
<span id="dll読み込み" class="fragment"></span><a href="#dll%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%81%BF"><i class="fa fa-link"></i></a>DLL読み込み</h2>

<p>DLLを読まないと関数が呼べないので読み込んでおきましょう。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code>        <span class="k">private</span> <span class="k">const</span> <span class="kt">string</span> <span class="n">VFW_DLL</span> <span class="p">=</span> <span class="s">"msvfw32.dll"</span><span class="p">;</span>
        <span class="p">[</span><span class="nf">DllImport</span><span class="p">(</span><span class="n">VFW_DLL</span><span class="p">,</span> <span class="n">CallingConvention</span> <span class="p">=</span> <span class="n">CallingConvention</span><span class="p">.</span><span class="n">Winapi</span><span class="p">)]</span>
        <span class="k">public</span> <span class="k">static</span> <span class="k">extern</span> <span class="n">IntPtr</span> <span class="nf">ICOpen</span><span class="p">(</span><span class="kt">uint</span> <span class="n">fccType</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">fccHandler</span><span class="p">,</span> <span class="kt">int</span> <span class="n">mode</span><span class="p">);</span>
        <span class="p">[</span><span class="nf">DllImport</span><span class="p">(</span><span class="n">VFW_DLL</span><span class="p">,</span> <span class="n">CallingConvention</span> <span class="p">=</span> <span class="n">CallingConvention</span><span class="p">.</span><span class="n">Winapi</span><span class="p">)]</span>
        <span class="k">public</span> <span class="k">static</span> <span class="k">extern</span> <span class="kt">int</span> <span class="nf">ICClose</span><span class="p">(</span><span class="n">IntPtr</span> <span class="n">handle</span><span class="p">);</span>
        <span class="p">[</span><span class="nf">DllImport</span><span class="p">(</span><span class="n">VFW_DLL</span><span class="p">,</span> <span class="n">CallingConvention</span> <span class="p">=</span> <span class="n">CallingConvention</span><span class="p">.</span><span class="n">Winapi</span><span class="p">)]</span>
        <span class="k">public</span> <span class="k">static</span> <span class="k">extern</span> <span class="kt">int</span> <span class="nf">ICSendMessage</span><span class="p">(</span><span class="n">IntPtr</span> <span class="n">handle</span><span class="p">,</span> <span class="kt">int</span> <span class="n">message</span><span class="p">,</span> <span class="n">IntPtr</span> <span class="n">param1</span><span class="p">,</span> <span class="n">IntPtr</span> <span class="n">param2</span><span class="p">);</span>
</code></pre></div></div>

<h2>
<span id="設定画面の呼び出し-1" class="fragment"></span><a href="#%E8%A8%AD%E5%AE%9A%E7%94%BB%E9%9D%A2%E3%81%AE%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%97-1"><i class="fa fa-link"></i></a>設定画面の呼び出し</h2>

<p>あとはclickイベントハンドラを書き換えて設定画面を呼びましょう。FourCCの計算が面倒だったので<code>SharpAvi</code>をNuGetでプロジェクトに追加しておきます。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Runtime.InteropServices</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Windows</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">SharpAvi</span><span class="p">;</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">SettingClick</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">RoutedEventArgs</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">compressorHandle</span> <span class="p">=</span> <span class="nf">ICOpen</span><span class="p">((</span><span class="kt">uint</span><span class="p">)</span><span class="n">KnownFourCCs</span><span class="p">.</span><span class="n">CodecTypes</span><span class="p">.</span><span class="n">Video</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span><span class="k">new</span> <span class="nf">FourCC</span><span class="p">(</span><span class="s">"ULH2"</span><span class="p">),</span> <span class="n">ICMODE_COMPRESS</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">compressorHandle</span> <span class="p">==</span> <span class="n">IntPtr</span><span class="p">.</span><span class="n">Zero</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">return</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">try</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">re</span> <span class="p">=</span> <span class="nf">ICSendMessage</span><span class="p">(</span><span class="n">compressorHandle</span><span class="p">,</span> <span class="n">ICM_CONFIGURE</span><span class="p">,</span> <span class="k">new</span> <span class="n">System</span><span class="p">.</span><span class="n">Windows</span><span class="p">.</span><span class="n">Interop</span><span class="p">.</span><span class="nf">WindowInteropHelper</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="n">Handle</span><span class="p">,</span> <span class="n">IntPtr</span><span class="p">.</span><span class="n">Zero</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">finally</span>
            <span class="p">{</span>
                <span class="nf">ICClose</span><span class="p">(</span><span class="n">compressorHandle</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
</code></pre></div></div>

<h1>
<span id="結果" class="fragment"></span><a href="#%E7%B5%90%E6%9E%9C"><i class="fa fa-link"></i></a>結果</h1>

<p>実行する前に忘れずにUt Video Codec Suiteをインストールしておきましょう。</p>

<p><a href="http://umezawa.dyndns.info/wordpress/?cat=28" rel="nofollow noopener" target="_blank">或るプログラマの一生 » Ut Video Codec Suite</a></p>

<p><a href="https://camo.qiitausercontent.com/252b7bcf0361c906e525f567194e4f124d8950c7/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39343137372f39646136633039612d666664372d313861662d373061382d3639323738636232623266342e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F9da6c09a-ffd7-18af-70a8-69278cb2b2f4.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=493af6c5dfc898509c4ae9f21c8f0631" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/9da6c09a-ffd7-18af-70a8-69278cb2b2f4.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F9da6c09a-ffd7-18af-70a8-69278cb2b2f4.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=a0788d09ea5794a2a337be0faa15af54 1x" loading="lazy"></a></p>

<p>無事に呼び出せました。</p>

<h1>
<span id="余談-fourccとcodecの関連付けの管理" class="fragment"></span><a href="#%E4%BD%99%E8%AB%87-fourcc%E3%81%A8codec%E3%81%AE%E9%96%A2%E9%80%A3%E4%BB%98%E3%81%91%E3%81%AE%E7%AE%A1%E7%90%86"><i class="fa fa-link"></i></a>余談: FourCCとcodecの関連付けの管理</h1>

<p>FourCCとcodecの関連付けはレジストリで行われている。例えばUt Video Codec Suiteの場合、次のような項目が登録される。</p>

<div class="code-frame" data-lang="config"><div class="highlight"><pre class="with-code"><code><span class="n">REGEDIT4</span>

[<span class="n">HKEY_LOCAL_MACHINE</span>\<span class="n">SOFTWARE</span>\<span class="n">Microsoft</span>\<span class="n">Windows</span> <span class="n">NT</span>\<span class="n">CurrentVersion</span>\<span class="n">Drivers32</span>]
<span class="s2">"VIDC.ULRA"</span>=<span class="s2">"C:\\Windows\\system32\\utv_vcm.dll"</span>
<span class="s2">"VIDC.ULRG"</span>=<span class="s2">"C:\\Windows\\system32\\utv_vcm.dll"</span>
<span class="s2">"VIDC.ULY0"</span>=<span class="s2">"C:\\Windows\\system32\\utv_vcm.dll"</span>
<span class="s2">"VIDC.ULY2"</span>=<span class="s2">"C:\\Windows\\system32\\utv_vcm.dll"</span>
<span class="s2">"VIDC.ULY4"</span>=<span class="s2">"C:\\Windows\\system32\\utv_vcm.dll"</span>
<span class="s2">"VIDC.ULH0"</span>=<span class="s2">"C:\\Windows\\system32\\utv_vcm.dll"</span>
<span class="s2">"VIDC.ULH2"</span>=<span class="s2">"C:\\Windows\\system32\\utv_vcm.dll"</span>
<span class="s2">"VIDC.ULH4"</span>=<span class="s2">"C:\\Windows\\system32\\utv_vcm.dll"</span>
<span class="s2">"VIDC.UQY0"</span>=<span class="s2">"C:\\Windows\\system32\\utv_vcm.dll"</span>
<span class="s2">"VIDC.UQY2"</span>=<span class="s2">"C:\\Windows\\system32\\utv_vcm.dll"</span>
<span class="s2">"VIDC.UQRG"</span>=<span class="s2">"C:\\Windows\\system32\\utv_vcm.dll"</span>
<span class="s2">"VIDC.UQRA"</span>=<span class="s2">"C:\\Windows\\system32\\utv_vcm.dll"</span>
<span class="s2">"VIDC.UMRA"</span>=<span class="s2">"C:\\Windows\\system32\\utv_vcm.dll"</span>
<span class="s2">"VIDC.UMRG"</span>=<span class="s2">"C:\\Windows\\system32\\utv_vcm.dll"</span>
<span class="s2">"VIDC.UMY2"</span>=<span class="s2">"C:\\Windows\\system32\\utv_vcm.dll"</span>
<span class="s2">"VIDC.UMY4"</span>=<span class="s2">"C:\\Windows\\system32\\utv_vcm.dll"</span>
<span class="s2">"VIDC.UMH2"</span>=<span class="s2">"C:\\Windows\\system32\\utv_vcm.dll"</span>
<span class="s2">"VIDC.UMH4"</span>=<span class="s2">"C:\\Windows\\system32\\utv_vcm.dll"</span>

[<span class="n">HKEY_LOCAL_MACHINE</span>\<span class="n">SOFTWARE</span>\<span class="n">Wow6432Node</span>\<span class="n">Microsoft</span>\<span class="n">Windows</span> <span class="n">NT</span>\<span class="n">CurrentVersion</span>\<span class="n">Drivers32</span>]
<span class="s2">"VIDC.ULRA"</span>=<span class="s2">"C:\\Windows\\system32\\utv_vcm.dll"</span>
<span class="s2">"VIDC.ULRG"</span>=<span class="s2">"C:\\Windows\\system32\\utv_vcm.dll"</span>
<span class="s2">"VIDC.ULY0"</span>=<span class="s2">"C:\\Windows\\system32\\utv_vcm.dll"</span>
<span class="s2">"VIDC.ULY2"</span>=<span class="s2">"C:\\Windows\\system32\\utv_vcm.dll"</span>
<span class="s2">"VIDC.ULY4"</span>=<span class="s2">"C:\\Windows\\system32\\utv_vcm.dll"</span>
<span class="s2">"VIDC.ULH0"</span>=<span class="s2">"C:\\Windows\\system32\\utv_vcm.dll"</span>
<span class="s2">"VIDC.ULH2"</span>=<span class="s2">"C:\\Windows\\system32\\utv_vcm.dll"</span>
<span class="s2">"VIDC.ULH4"</span>=<span class="s2">"C:\\Windows\\system32\\utv_vcm.dll"</span>
<span class="s2">"VIDC.UQY0"</span>=<span class="s2">"C:\\Windows\\system32\\utv_vcm.dll"</span>
<span class="s2">"VIDC.UQY2"</span>=<span class="s2">"C:\\Windows\\system32\\utv_vcm.dll"</span>
<span class="s2">"VIDC.UQRG"</span>=<span class="s2">"C:\\Windows\\system32\\utv_vcm.dll"</span>
<span class="s2">"VIDC.UQRA"</span>=<span class="s2">"C:\\Windows\\system32\\utv_vcm.dll"</span>
<span class="s2">"VIDC.UMRA"</span>=<span class="s2">"C:\\Windows\\system32\\utv_vcm.dll"</span>
<span class="s2">"VIDC.UMRG"</span>=<span class="s2">"C:\\Windows\\system32\\utv_vcm.dll"</span>
<span class="s2">"VIDC.UMY2"</span>=<span class="s2">"C:\\Windows\\system32\\utv_vcm.dll"</span>
<span class="s2">"VIDC.UMY4"</span>=<span class="s2">"C:\\Windows\\system32\\utv_vcm.dll"</span>
<span class="s2">"VIDC.UMH2"</span>=<span class="s2">"C:\\Windows\\system32\\utv_vcm.dll"</span>
<span class="s2">"VIDC.UMH4"</span>=<span class="s2">"C:\\Windows\\system32\\utv_vcm.dll"</span>
</code></pre></div></div>

<p>ではコーデックのあるFourCCを列挙するにはどうすればいいのか。レジストリを自分で読みたくはない。</p>

<p>どうやら<code>ICInfo</code>という関数を使えばいいようだ。使い方のサンプルが<br>
<a href="https://docs.microsoft.com/ja-jp/windows/win32/multimedia/locating-and-opening-compressors-and-decompressors" rel="nofollow noopener" target="_blank">Locating and Opening Compressors and Decompressors - Win32 apps | Microsoft Docs</a><br>
にあった。</p>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Fyumetodo%2Fitems%2Fda5c27a863c0d30ae520&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Fyumetodo%2Fitems%2Fda5c27a863c0d30ae520&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/yumetodo/items/da5c27a863c0d30ae520/likers" class="css-1iupg5d">0</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">0</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/da5c27a863c0d30ae520/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/yumetodo/items/da5c27a863c0d30ae520/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/yumetodo/items/da5c27a863c0d30ae520/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/yumetodo/items/da5c27a863c0d30ae520/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/yumetodo/items/da5c27a863c0d30ae520.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-92d0111a-1b2e-4280-b27f-d2852266926e">{"authorAnalyticsTrackingId":"UA-71637562-1","organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-ad478d55-7adb-4b8e-a511-616c74be58ee"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-ad478d55-7adb-4b8e-a511-616c74be58ee">{}</script>
      
<div id="LoginModal-react-component-a1536a90-50f5-4c35-878d-8f87b2d80bcf"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-a1536a90-50f5-4c35-878d-8f87b2d80bcf">{}</script>
      
<div id="StockModal-react-component-0db41075-b955-49ee-9fd0-35cf2d31ede0"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-0db41075-b955-49ee-9fd0-35cf2d31ede0">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;hmJbE/uSnIbUP1r/HRSULtrbtT98pFrJUocr/mXNtVmd3M7/zFz4gWaAi+fJyT0s0Y7ax7Pb9Wpnw2lkf70Byw==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\n\u003ch1\u003e\n\u003cspan id=\"動機\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8B%95%E6%A9%9F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e動機\u003c/h1\u003e\n\n\u003cp\u003e現在、Caputraというデスクトップキャプチャソフトに、AviUtlを使っている人ならおなじみの可逆圧縮codecである、\u003ca href=\"https://github.com/MathewSachin/Captura/issues/407\" rel=\"nofollow noopener\" target=\"_blank\"\u003eUt Video Codec Suiteを対応させる試みを行っています\u003c/a\u003e。\u003c/p\u003e\n\n\u003cp\u003eその過程で、codecの設定をわざわざレジストリをいじるのは面倒だし、設定画面とか呼べないの？と思ったのですね。\u003c/p\u003e\n\n\u003cp\u003e例えばAviUtlなら\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/6a2d6986861f6effae5f38bdf882a8a847a67d20/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39343137372f37613735383463652d303434312d616363332d646232362d6263643664653764343737392e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F7a7584ce-0441-acc3-db26-bcd6de7d4779.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=3649bf76a7fbc8a5f6f1661f81514cd9\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/7a7584ce-0441-acc3-db26-bcd6de7d4779.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F7a7584ce-0441-acc3-db26-bcd6de7d4779.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=5ae2fd590737076f35e32b385d786326 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\nこの設定ボタンから呼べる\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/ba6fdc6dd91cd1b2f6bbb755f71259ecbebb719b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39343137372f35653835386132382d623630352d306131342d656431652d3063373832386338653464652e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F5e858a28-b605-0a14-ed1e-0c7828c8e4de.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=74f3cb95acb6ce65998b0058cba34dd5\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/5e858a28-b605-0a14-ed1e-0c7828c8e4de.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F5e858a28-b605-0a14-ed1e-0c7828c8e4de.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=7519371dfa111693bca2a9b356f79654 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\nこういうやつです。\u003c/p\u003e\n\n\u003cp\u003eこのウィンドウはAviUtlに固有のものではなくて他のソフトからも同じものが出るということは、Ut Video Codec Suite側で生成しているものだと推測できます。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"ut-video-codec-suiteの実装を読む\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#ut-video-codec-suite%E3%81%AE%E5%AE%9F%E8%A3%85%E3%82%92%E8%AA%AD%E3%82%80\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eUt Video Codec Suiteの実装を読む\u003c/h1\u003e\n\n\u003cp\u003e幸いなことにソースコードはGitHubで公開されているので読んでいきます。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://github.com/umezawatakeshi/utvideo\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/umezawatakeshi/utvideo\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eするとそういえばVFW pluginだったなと思い出してきました。\u003c/p\u003e\n\n\u003cp\u003eVfwというのはVideo for Windowsの略で、Win32API触ったことある人ならわかるであろう、プロージャーを書いてメッセージを受け取っていくタイプの書き方で、動画のエンコードやデコードなどなどを実装したdllを登録することで、いろいろなソフトウェアからそれが呼べる仕組みのことです。Windows Media Playerなんかはこれをつかって再生していたと思います。Windows 10標準搭載の動画アプリはMicrosoft Media Foundationという別のものを使っていますが。\u003c/p\u003e\n\n\u003cp\u003eなんか検索してると某有名ゲームエンジンの関連のVexe Frameworkのほうが引っかかってくるようですが・・・。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"設定画面の呼び出し\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A8%AD%E5%AE%9A%E7%94%BB%E9%9D%A2%E3%81%AE%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%97\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e設定画面の呼び出し\u003c/h2\u003e\n\n\u003cp\u003eいろいろ読んでいくと、次のような箇所を見つけました。つまり\u003ccode\u003eICM_CONFIGURE\u003c/code\u003eを受け取ったプロージャーは、\u003ccode\u003eDialogBoxParam\u003c/code\u003eによってWindowを生成しているではないですか。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cpp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eutv_vcm/DriverProc.cpp\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e    \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"n\"\u003eICM_CONFIGURE\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elParam1\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003epCodec\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eQueryConfigure\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003epCodec\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eConfigure\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003eHWND\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003elParam1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003cqiita-embed-ogp src=\"https://github.com/umezawatakeshi/utvideo/blob/077a6a6202a3b5d60d1716559759210f6cedd795/utv_vcm/DriverProc.cpp#L45-L49\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cpp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eutv_vcm/VCMCodec.cpp\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eLRESULT\u003c/span\u003e \u003cspan class=\"n\"\u003eCVCMCodec\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eConfigure\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eHWND\u003c/span\u003e \u003cspan class=\"n\"\u003ehwnd\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003em_mode\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003eICMODE_COMPRESS\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eICERR_UNSUPPORTED\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003em_pCodec\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eConfigure\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ehwnd\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"o\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003eICERR_OK\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eICERR_UNSUPPORTED\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003cqiita-embed-ogp src=\"https://github.com/umezawatakeshi/utvideo/blob/077a6a6202a3b5d60d1716559759210f6cedd795/utv_vcm/VCMCodec.cpp#L127-L133\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cpp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eutv_core/UL00Codec.cpp\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eINT_PTR\u003c/span\u003e \u003cspan class=\"n\"\u003eCUL00Codec\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eConfigure\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eHWND\u003c/span\u003e \u003cspan class=\"n\"\u003ehwnd\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eDialogBoxParam\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ehModule\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eMAKEINTRESOURCE\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIDD_UL00_CONFIG\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003ehwnd\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eDialogProc\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLPARAM\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003cqiita-embed-ogp src=\"https://github.com/umezawatakeshi/utvideo/blob/077a6a6202a3b5d60d1716559759210f6cedd795/utv_core/UL00Codec.cpp#L31-L35\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\n\u003cp\u003eつまりVfw codecに対して\u003ccode\u003eICM_CONFIGURE\u003c/code\u003eメッセージを投げられれば良さそうです。\u003c/p\u003e\n\n\u003cp\u003eただし\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003em_mode != ICMODE_COMPRESS\u003c/code\u003eより、\u003ccode\u003em_mode\u003c/code\u003eは\u003ccode\u003eICMODE_COMPRESS\u003c/code\u003eでなければならない\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003elParam1 == -1\u003c/code\u003eより、親ウィンドウのハンドルが必須\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"初期化\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%88%9D%E6%9C%9F%E5%8C%96\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e初期化\u003c/h2\u003e\n\n\u003cp\u003eしかし、その前に\u003ccode\u003epCodec\u003c/code\u003eとか\u003ccode\u003em_mode\u003c/code\u003eとかいう変数が見えます。これらはどうやって初期化されているのでしょうか？\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cpp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eLRESULT\u003c/span\u003e \u003cspan class=\"n\"\u003eCALLBACK\u003c/span\u003e \u003cspan class=\"nf\"\u003eDriverProc\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDWORD_PTR\u003c/span\u003e \u003cspan class=\"n\"\u003edwDriverId\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eHDRVR\u003c/span\u003e \u003cspan class=\"n\"\u003ehdrvr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eUINT\u003c/span\u003e \u003cspan class=\"n\"\u003euMsg\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eLPARAM\u003c/span\u003e \u003cspan class=\"n\"\u003elParam1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eLPARAM\u003c/span\u003e \u003cspan class=\"n\"\u003elParam2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eCVCMCodec\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003epCodec\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eCVCMCodec\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003edwDriverId\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e変数の定義を見るだけでは、プロージャーの引数から渡ってくるんだなとしかわかりません。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cpp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eutv_vcm/DriverProc.cpp\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e    \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"n\"\u003eDRV_OPEN\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLRESULT\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eCVCMCodec\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eOpen\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003eICOPEN\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003elParam2\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"n\"\u003eDRV_CLOSE\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epCodec\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"k\"\u003edelete\u003c/span\u003e \u003cspan class=\"n\"\u003epCodec\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eTRUE\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003cqiita-embed-ogp src=\"https://github.com/umezawatakeshi/utvideo/blob/077a6a6202a3b5d60d1716559759210f6cedd795/utv_vcm/DriverProc.cpp#L26-L32\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\n\u003cp\u003eもう少し下を見ると\u003ccode\u003eDRV_CLOSE\u003c/code\u003eを受け取ったときに、\u003ccode\u003epCodec\u003c/code\u003eを\u003ccode\u003edelete\u003c/code\u003eしているところが見つかりました。さらにその上に\u003ccode\u003eDRV_OPEN\u003c/code\u003eというそれっぽいのがあります。\u003ccode\u003eCVCMCodec::Open\u003c/code\u003eを見てみましょう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cpp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eutv_vcm/VCMCodec.cpp\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eCVCMCodec\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eCVCMCodec\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eOpen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eICOPEN\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eicopen\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIsLogWriterInitializedOrDebugBuild\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eicopen\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eLOGPRINTF\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"CVCMCodec::Open(icopen=%p, icopen-\u0026gt;fccType=%08X, icopen-\u0026gt;fccHandler=%08X icopen-\u0026gt;dwFlags=%08X)\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eicopen\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eicopen\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003efccType\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eicopen\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003efccHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eicopen\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003edwFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eLOGPRINTF\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"CVCMCodec::Open(icopen=NULL)\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eunion\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eDWORD\u003c/span\u003e \u003cspan class=\"n\"\u003efccHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"n\"\u003efccChar\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003eDWORD\u003c/span\u003e \u003cspan class=\"n\"\u003eicmode\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eicopen\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eicopen\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003efccType\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003eICTYPE_VIDEO\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003efccHandler\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eicopen\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003efccHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// なぜか小文字で渡されることがあるので、最初に大文字化しておく。\u003c/span\u003e\n        \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"n\"\u003efccChar\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etoupper\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efccChar\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003eicopen\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003edwError\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eICERR_UNSUPPORTED\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eswitch\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eicopen\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003edwFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"n\"\u003eICMODE_COMPRESS\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eCheckInterfaceDisabledAndLog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"VCM\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Encoder\"\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"n\"\u003eICMODE_DECOMPRESS\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eCheckInterfaceDisabledAndLog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"VCM\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Decoder\"\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"n\"\u003eICMODE_QUERY\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eCheckInterfaceDisabledAndLog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"VCM\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Query\"\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"nl\"\u003edefault:\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003eicopen\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003edwError\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eICERR_OK\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eicmode\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eicopen\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003edwFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003efccHandler\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDWORD\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eicmode\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eCVCMCodec\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efccHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eicmode\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003cqiita-embed-ogp src=\"https://github.com/umezawatakeshi/utvideo/blob/077a6a6202a3b5d60d1716559759210f6cedd795/utv_vcm/VCMCodec.cpp#L31-L87\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\n\u003cp\u003e細かいところは読み飛ばすとして、まず\u003ccode\u003eicmode = icopen-\u0026gt;dwFlags;\u003c/code\u003eが目に入ります。さっき言ってた変数ですね！さらにこの関数は\u003ccode\u003ereturn new CVCMCodec(fccHandler, icmode);\u003c/code\u003eしてます。確かに\u003ccode\u003eDRV_OPEN\u003c/code\u003eと\u003ccode\u003eDRV_CLOSE\u003c/code\u003eは対応関係にあることがわかります。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"どうやってvfwなcodecにメッセージを投げるか\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%A9%E3%81%86%E3%82%84%E3%81%A3%E3%81%A6vfw%E3%81%AAcodec%E3%81%AB%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E3%82%92%E6%8A%95%E3%81%92%E3%82%8B%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eどうやってVfwなcodecにメッセージを投げるか\u003c/h1\u003e\n\n\u003cp\u003eつまり、どうにかしてコーデックのプロージャーにメッセージを投げられればいいわけです。\u003c/p\u003e\n\n\u003cp\u003eただ、検索の仕方が悪くてなかなかたどり着けず、\u003c/p\u003e\n\n\u003cp\u003e\u003cqiita-embed-ogp src=\"https://github.com/baSSiLL/SharpAvi\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\n\u003cp\u003eのソースコードを読み漁ってました。\u003c/p\u003e\n\n\u003cp\u003e結局使う関数は\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://docs.microsoft.com/ja-jp/windows/win32/api/vfw/nf-vfw-icopen\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003ccode\u003eICOpen\u003c/code\u003e\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://docs.microsoft.com/ja-jp/windows/win32/api/vfw/nf-vfw-icsendmessage\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003ccode\u003eICSendMessage\u003c/code\u003e\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://docs.microsoft.com/ja-jp/windows/win32/api/vfw/nf-vfw-icclose\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003ccode\u003eICClose\u003c/code\u003e\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eの3つだとわかりました。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eICOpen\u003c/code\u003eは次のようなプロトタイプ宣言で定義されています。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cpp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eHIC\u003c/span\u003e \u003cspan class=\"n\"\u003eVFWAPI\u003c/span\u003e \u003cspan class=\"nf\"\u003eICOpen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n  \u003cspan class=\"n\"\u003eDWORD\u003c/span\u003e \u003cspan class=\"n\"\u003efccType\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"n\"\u003eDWORD\u003c/span\u003e \u003cspan class=\"n\"\u003efccHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"n\"\u003eUINT\u003c/span\u003e  \u003cspan class=\"n\"\u003ewMode\u003c/span\u003e\n\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003efcc\u003c/code\u003eというのが見えますが、これは\u003ccode\u003eFOURCC\u003c/code\u003eのことです。\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://ja.wikipedia.org/wiki/FourCC\" rel=\"nofollow noopener\" target=\"_blank\"\u003eFourCC - Wikipedia\u003c/a\u003e\u003cbr\u003e\nFourCC (フォーシーシー) とは、データフォーマットを一意に識別するための4バイトの並びである（four-character code の意）。\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e\u003ccode\u003efccType\u003c/code\u003eには\u003ccode\u003eVIDC\u003c/code\u003eという文字列をFourCCとして整数に変換したもの、\u003ccode\u003ewMode\u003c/code\u003eには先に述べたように\u003ccode\u003eICMODE_COMPRESS\u003c/code\u003eを渡すとして、\u003ccode\u003efccHandler\u003c/code\u003eには何を渡せばいいのでしょうか？今回はUt Video Codec Suiteの設定画面を呼びたいので、早速FourCCを調べましょう。\u003c/p\u003e\n\n\u003cp\u003eといっても公式で\u003cbr\u003e\n\u003ca href=\"http://umezawa.dyndns.info/archive/utvideo/utvideo-21.2.0-readme.ja.html#fourcc\" rel=\"nofollow noopener\" target=\"_blank\"\u003eUt Video Codec Suite 21.2.0 readme （日本語）FourCC 一覧\u003c/a\u003e\u003cbr\u003e\nにまとめられているのでそれを見るだけですね。\u003c/p\u003e\n\n\u003cp\u003eとりあえず今回は\u003ccode\u003eULH2\u003c/code\u003eにしましょう。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"実装\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%9F%E8%A3%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e実装\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"arikitari-na-world\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#arikitari-na-world\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003earikitari na world!\u003c/h2\u003e\n\n\u003cp\u003e親ウィンドウがないといけないので、雑にWPFで作りましょう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"xml\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eMainWindow.xaml\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"nt\"\u003e\u0026lt;Window\u003c/span\u003e \u003cspan class=\"na\"\u003ex:Class=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"WpfApp1.MainWindow\"\u003c/span\u003e\n        \u003cspan class=\"na\"\u003exmlns=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"http://schemas.microsoft.com/winfx/2006/xaml/presentation\"\u003c/span\u003e\n        \u003cspan class=\"na\"\u003exmlns:x=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"http://schemas.microsoft.com/winfx/2006/xaml\"\u003c/span\u003e\n        \u003cspan class=\"na\"\u003exmlns:d=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"http://schemas.microsoft.com/expression/blend/2008\"\u003c/span\u003e\n        \u003cspan class=\"na\"\u003exmlns:mc=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"http://schemas.openxmlformats.org/markup-compatibility/2006\"\u003c/span\u003e\n        \u003cspan class=\"na\"\u003exmlns:local=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"clr-namespace:WpfApp1\"\u003c/span\u003e\n        \u003cspan class=\"na\"\u003emc:Ignorable=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"d\"\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eTitle=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"VfwConfigCall\"\u003c/span\u003e \u003cspan class=\"na\"\u003eHeight=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"100\"\u003c/span\u003e \u003cspan class=\"na\"\u003eWidth=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"300\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;Grid\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"nt\"\u003e\u0026lt;Button\u003c/span\u003e \u003cspan class=\"na\"\u003eMargin=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"10\"\u003c/span\u003e \u003cspan class=\"na\"\u003eClick=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"SettingClick\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003eSetting\u003cspan class=\"nt\"\u003e\u0026lt;/Button\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;/Grid\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/Window\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eMainWindow.xaml.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Windows\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eWpfApp1\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// Interaction logic for MainWindow.xaml\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003epartial\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eMainWindow\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eWindow\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eMainWindow\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eInitializeComponent\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eSettingClick\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eobject\u003c/span\u003e \u003cspan class=\"n\"\u003esender\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eRoutedEventArgs\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eMessageBox\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eShow\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"arikitari na world!\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eまずはこれで全世界の人がまずは表示させるであろう恒例の\u003ccode\u003earikitari na world!\u003c/code\u003eを表示させて動いたことを確認したら本実装に入りましょう。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"定数\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%9A%E6%95%B0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e定数\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003evfw.h\u003c/code\u003eをみつつ必要なものを取ってきましょう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eDRV_USER\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x4000\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eICM_RESERVED_LOW\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eDRV_USER\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"m\"\u003e0x1000\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eICM_RESERVED\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eICM_RESERVED_LOW\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eICM_CONFIGURE\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eICM_RESERVED\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"m\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eICMODE_COMPRESS\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"dll読み込み\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#dll%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%81%BF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eDLL読み込み\u003c/h2\u003e\n\n\u003cp\u003eDLLを読まないと関数が呼べないので読み込んでおきましょう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eVFW_DLL\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"msvfw32.dll\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eDllImport\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eVFW_DLL\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eCallingConvention\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eCallingConvention\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWinapi\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003eextern\u003c/span\u003e \u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e \u003cspan class=\"nf\"\u003eICOpen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003efccType\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003efccHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003emode\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eDllImport\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eVFW_DLL\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eCallingConvention\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eCallingConvention\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWinapi\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003eextern\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"nf\"\u003eICClose\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e \u003cspan class=\"n\"\u003ehandle\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eDllImport\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eVFW_DLL\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eCallingConvention\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eCallingConvention\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWinapi\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003eextern\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"nf\"\u003eICSendMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e \u003cspan class=\"n\"\u003ehandle\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e \u003cspan class=\"n\"\u003eparam1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e \u003cspan class=\"n\"\u003eparam2\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"設定画面の呼び出し-1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A8%AD%E5%AE%9A%E7%94%BB%E9%9D%A2%E3%81%AE%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%97-1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e設定画面の呼び出し\u003c/h2\u003e\n\n\u003cp\u003eあとはclickイベントハンドラを書き換えて設定画面を呼びましょう。FourCCの計算が面倒だったので\u003ccode\u003eSharpAvi\u003c/code\u003eをNuGetでプロジェクトに追加しておきます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Runtime.InteropServices\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Windows\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSharpAvi\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eSettingClick\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eobject\u003c/span\u003e \u003cspan class=\"n\"\u003esender\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eRoutedEventArgs\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ecompressorHandle\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eICOpen\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"kt\"\u003euint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eKnownFourCCs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCodecTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eVideo\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003euint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eFourCC\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"ULH2\"\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003eICMODE_COMPRESS\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecompressorHandle\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eZero\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"k\"\u003etry\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ere\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eICSendMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecompressorHandle\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eICM_CONFIGURE\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWindows\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eInterop\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWindowInteropHelper\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003eHandle\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eZero\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"k\"\u003efinally\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"nf\"\u003eICClose\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecompressorHandle\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"結果\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%B5%90%E6%9E%9C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e結果\u003c/h1\u003e\n\n\u003cp\u003e実行する前に忘れずにUt Video Codec Suiteをインストールしておきましょう。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"http://umezawa.dyndns.info/wordpress/?cat=28\" rel=\"nofollow noopener\" target=\"_blank\"\u003e或るプログラマの一生 » Ut Video Codec Suite\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/252b7bcf0361c906e525f567194e4f124d8950c7/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39343137372f39646136633039612d666664372d313861662d373061382d3639323738636232623266342e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F9da6c09a-ffd7-18af-70a8-69278cb2b2f4.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=493af6c5dfc898509c4ae9f21c8f0631\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/9da6c09a-ffd7-18af-70a8-69278cb2b2f4.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F9da6c09a-ffd7-18af-70a8-69278cb2b2f4.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=a0788d09ea5794a2a337be0faa15af54 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e無事に呼び出せました。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"余談-fourccとcodecの関連付けの管理\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BD%99%E8%AB%87-fourcc%E3%81%A8codec%E3%81%AE%E9%96%A2%E9%80%A3%E4%BB%98%E3%81%91%E3%81%AE%E7%AE%A1%E7%90%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e余談: FourCCとcodecの関連付けの管理\u003c/h1\u003e\n\n\u003cp\u003eFourCCとcodecの関連付けはレジストリで行われている。例えばUt Video Codec Suiteの場合、次のような項目が登録される。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"config\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eREGEDIT4\u003c/span\u003e\n\n[\u003cspan class=\"n\"\u003eHKEY_LOCAL_MACHINE\u003c/span\u003e\\\u003cspan class=\"n\"\u003eSOFTWARE\u003c/span\u003e\\\u003cspan class=\"n\"\u003eMicrosoft\u003c/span\u003e\\\u003cspan class=\"n\"\u003eWindows\u003c/span\u003e \u003cspan class=\"n\"\u003eNT\u003c/span\u003e\\\u003cspan class=\"n\"\u003eCurrentVersion\u003c/span\u003e\\\u003cspan class=\"n\"\u003eDrivers32\u003c/span\u003e]\n\u003cspan class=\"s2\"\u003e\"VIDC.ULRA\"\u003c/span\u003e=\u003cspan class=\"s2\"\u003e\"C:\\\\Windows\\\\system32\\\\utv_vcm.dll\"\u003c/span\u003e\n\u003cspan class=\"s2\"\u003e\"VIDC.ULRG\"\u003c/span\u003e=\u003cspan class=\"s2\"\u003e\"C:\\\\Windows\\\\system32\\\\utv_vcm.dll\"\u003c/span\u003e\n\u003cspan class=\"s2\"\u003e\"VIDC.ULY0\"\u003c/span\u003e=\u003cspan class=\"s2\"\u003e\"C:\\\\Windows\\\\system32\\\\utv_vcm.dll\"\u003c/span\u003e\n\u003cspan class=\"s2\"\u003e\"VIDC.ULY2\"\u003c/span\u003e=\u003cspan class=\"s2\"\u003e\"C:\\\\Windows\\\\system32\\\\utv_vcm.dll\"\u003c/span\u003e\n\u003cspan class=\"s2\"\u003e\"VIDC.ULY4\"\u003c/span\u003e=\u003cspan class=\"s2\"\u003e\"C:\\\\Windows\\\\system32\\\\utv_vcm.dll\"\u003c/span\u003e\n\u003cspan class=\"s2\"\u003e\"VIDC.ULH0\"\u003c/span\u003e=\u003cspan class=\"s2\"\u003e\"C:\\\\Windows\\\\system32\\\\utv_vcm.dll\"\u003c/span\u003e\n\u003cspan class=\"s2\"\u003e\"VIDC.ULH2\"\u003c/span\u003e=\u003cspan class=\"s2\"\u003e\"C:\\\\Windows\\\\system32\\\\utv_vcm.dll\"\u003c/span\u003e\n\u003cspan class=\"s2\"\u003e\"VIDC.ULH4\"\u003c/span\u003e=\u003cspan class=\"s2\"\u003e\"C:\\\\Windows\\\\system32\\\\utv_vcm.dll\"\u003c/span\u003e\n\u003cspan class=\"s2\"\u003e\"VIDC.UQY0\"\u003c/span\u003e=\u003cspan class=\"s2\"\u003e\"C:\\\\Windows\\\\system32\\\\utv_vcm.dll\"\u003c/span\u003e\n\u003cspan class=\"s2\"\u003e\"VIDC.UQY2\"\u003c/span\u003e=\u003cspan class=\"s2\"\u003e\"C:\\\\Windows\\\\system32\\\\utv_vcm.dll\"\u003c/span\u003e\n\u003cspan class=\"s2\"\u003e\"VIDC.UQRG\"\u003c/span\u003e=\u003cspan class=\"s2\"\u003e\"C:\\\\Windows\\\\system32\\\\utv_vcm.dll\"\u003c/span\u003e\n\u003cspan class=\"s2\"\u003e\"VIDC.UQRA\"\u003c/span\u003e=\u003cspan class=\"s2\"\u003e\"C:\\\\Windows\\\\system32\\\\utv_vcm.dll\"\u003c/span\u003e\n\u003cspan class=\"s2\"\u003e\"VIDC.UMRA\"\u003c/span\u003e=\u003cspan class=\"s2\"\u003e\"C:\\\\Windows\\\\system32\\\\utv_vcm.dll\"\u003c/span\u003e\n\u003cspan class=\"s2\"\u003e\"VIDC.UMRG\"\u003c/span\u003e=\u003cspan class=\"s2\"\u003e\"C:\\\\Windows\\\\system32\\\\utv_vcm.dll\"\u003c/span\u003e\n\u003cspan class=\"s2\"\u003e\"VIDC.UMY2\"\u003c/span\u003e=\u003cspan class=\"s2\"\u003e\"C:\\\\Windows\\\\system32\\\\utv_vcm.dll\"\u003c/span\u003e\n\u003cspan class=\"s2\"\u003e\"VIDC.UMY4\"\u003c/span\u003e=\u003cspan class=\"s2\"\u003e\"C:\\\\Windows\\\\system32\\\\utv_vcm.dll\"\u003c/span\u003e\n\u003cspan class=\"s2\"\u003e\"VIDC.UMH2\"\u003c/span\u003e=\u003cspan class=\"s2\"\u003e\"C:\\\\Windows\\\\system32\\\\utv_vcm.dll\"\u003c/span\u003e\n\u003cspan class=\"s2\"\u003e\"VIDC.UMH4\"\u003c/span\u003e=\u003cspan class=\"s2\"\u003e\"C:\\\\Windows\\\\system32\\\\utv_vcm.dll\"\u003c/span\u003e\n\n[\u003cspan class=\"n\"\u003eHKEY_LOCAL_MACHINE\u003c/span\u003e\\\u003cspan class=\"n\"\u003eSOFTWARE\u003c/span\u003e\\\u003cspan class=\"n\"\u003eWow6432Node\u003c/span\u003e\\\u003cspan class=\"n\"\u003eMicrosoft\u003c/span\u003e\\\u003cspan class=\"n\"\u003eWindows\u003c/span\u003e \u003cspan class=\"n\"\u003eNT\u003c/span\u003e\\\u003cspan class=\"n\"\u003eCurrentVersion\u003c/span\u003e\\\u003cspan class=\"n\"\u003eDrivers32\u003c/span\u003e]\n\u003cspan class=\"s2\"\u003e\"VIDC.ULRA\"\u003c/span\u003e=\u003cspan class=\"s2\"\u003e\"C:\\\\Windows\\\\system32\\\\utv_vcm.dll\"\u003c/span\u003e\n\u003cspan class=\"s2\"\u003e\"VIDC.ULRG\"\u003c/span\u003e=\u003cspan class=\"s2\"\u003e\"C:\\\\Windows\\\\system32\\\\utv_vcm.dll\"\u003c/span\u003e\n\u003cspan class=\"s2\"\u003e\"VIDC.ULY0\"\u003c/span\u003e=\u003cspan class=\"s2\"\u003e\"C:\\\\Windows\\\\system32\\\\utv_vcm.dll\"\u003c/span\u003e\n\u003cspan class=\"s2\"\u003e\"VIDC.ULY2\"\u003c/span\u003e=\u003cspan class=\"s2\"\u003e\"C:\\\\Windows\\\\system32\\\\utv_vcm.dll\"\u003c/span\u003e\n\u003cspan class=\"s2\"\u003e\"VIDC.ULY4\"\u003c/span\u003e=\u003cspan class=\"s2\"\u003e\"C:\\\\Windows\\\\system32\\\\utv_vcm.dll\"\u003c/span\u003e\n\u003cspan class=\"s2\"\u003e\"VIDC.ULH0\"\u003c/span\u003e=\u003cspan class=\"s2\"\u003e\"C:\\\\Windows\\\\system32\\\\utv_vcm.dll\"\u003c/span\u003e\n\u003cspan class=\"s2\"\u003e\"VIDC.ULH2\"\u003c/span\u003e=\u003cspan class=\"s2\"\u003e\"C:\\\\Windows\\\\system32\\\\utv_vcm.dll\"\u003c/span\u003e\n\u003cspan class=\"s2\"\u003e\"VIDC.ULH4\"\u003c/span\u003e=\u003cspan class=\"s2\"\u003e\"C:\\\\Windows\\\\system32\\\\utv_vcm.dll\"\u003c/span\u003e\n\u003cspan class=\"s2\"\u003e\"VIDC.UQY0\"\u003c/span\u003e=\u003cspan class=\"s2\"\u003e\"C:\\\\Windows\\\\system32\\\\utv_vcm.dll\"\u003c/span\u003e\n\u003cspan class=\"s2\"\u003e\"VIDC.UQY2\"\u003c/span\u003e=\u003cspan class=\"s2\"\u003e\"C:\\\\Windows\\\\system32\\\\utv_vcm.dll\"\u003c/span\u003e\n\u003cspan class=\"s2\"\u003e\"VIDC.UQRG\"\u003c/span\u003e=\u003cspan class=\"s2\"\u003e\"C:\\\\Windows\\\\system32\\\\utv_vcm.dll\"\u003c/span\u003e\n\u003cspan class=\"s2\"\u003e\"VIDC.UQRA\"\u003c/span\u003e=\u003cspan class=\"s2\"\u003e\"C:\\\\Windows\\\\system32\\\\utv_vcm.dll\"\u003c/span\u003e\n\u003cspan class=\"s2\"\u003e\"VIDC.UMRA\"\u003c/span\u003e=\u003cspan class=\"s2\"\u003e\"C:\\\\Windows\\\\system32\\\\utv_vcm.dll\"\u003c/span\u003e\n\u003cspan class=\"s2\"\u003e\"VIDC.UMRG\"\u003c/span\u003e=\u003cspan class=\"s2\"\u003e\"C:\\\\Windows\\\\system32\\\\utv_vcm.dll\"\u003c/span\u003e\n\u003cspan class=\"s2\"\u003e\"VIDC.UMY2\"\u003c/span\u003e=\u003cspan class=\"s2\"\u003e\"C:\\\\Windows\\\\system32\\\\utv_vcm.dll\"\u003c/span\u003e\n\u003cspan class=\"s2\"\u003e\"VIDC.UMY4\"\u003c/span\u003e=\u003cspan class=\"s2\"\u003e\"C:\\\\Windows\\\\system32\\\\utv_vcm.dll\"\u003c/span\u003e\n\u003cspan class=\"s2\"\u003e\"VIDC.UMH2\"\u003c/span\u003e=\u003cspan class=\"s2\"\u003e\"C:\\\\Windows\\\\system32\\\\utv_vcm.dll\"\u003c/span\u003e\n\u003cspan class=\"s2\"\u003e\"VIDC.UMH4\"\u003c/span\u003e=\u003cspan class=\"s2\"\u003e\"C:\\\\Windows\\\\system32\\\\utv_vcm.dll\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eではコーデックのあるFourCCを列挙するにはどうすればいいのか。レジストリを自分で読みたくはない。\u003c/p\u003e\n\n\u003cp\u003eどうやら\u003ccode\u003eICInfo\u003c/code\u003eという関数を使えばいいようだ。使い方のサンプルが\u003cbr\u003e\n\u003ca href=\"https://docs.microsoft.com/ja-jp/windows/win32/multimedia/locating-and-opening-compressors-and-decompressors\" rel=\"nofollow noopener\" target=\"_blank\"\u003eLocating and Opening Compressors and Decompressors - Win32 apps | Microsoft Docs\u003c/a\u003e\u003cbr\u003e\nにあった。\u003c/p\u003e\n","createdAt":"2020-03-30T07:34:27Z","elapsedYearsFromLastModifiedAt":1,"encryptedId":"MLz1Sd2RHr8krO1c/U8tFd86aTQoQNoJhw==--pwj1zmrCiDu4JuAS--E/8+03hZ+9allhJ2rPVPpQ==","isBanned":false,"isDeprecated":true,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":false,"lastModifiedAt":"2020-03-30T07:34:27Z","likesCount":0,"linkUrl":"https://qiita.com/yumetodo/items/da5c27a863c0d30ae520","organization":null,"originalId":1195055,"stockedCount":0,"title":"Vfwなcodecの設定画面を呼びたい","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%8B%95%E6%A9%9F\"\u003e動機\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#ut-video-codec-suite%E3%81%AE%E5%AE%9F%E8%A3%85%E3%82%92%E8%AA%AD%E3%82%80\"\u003eUt Video Codec Suiteの実装を読む\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E8%A8%AD%E5%AE%9A%E7%94%BB%E9%9D%A2%E3%81%AE%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%97\"\u003e設定画面の呼び出し\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%88%9D%E6%9C%9F%E5%8C%96\"\u003e初期化\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%A9%E3%81%86%E3%82%84%E3%81%A3%E3%81%A6vfw%E3%81%AAcodec%E3%81%AB%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E3%82%92%E6%8A%95%E3%81%92%E3%82%8B%E3%81%8B\"\u003eどうやってVfwなcodecにメッセージを投げるか\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%AE%9F%E8%A3%85\"\u003e実装\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#arikitari-na-world\"\u003earikitari na world!\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%AE%9A%E6%95%B0\"\u003e定数\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#dll%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%81%BF\"\u003eDLL読み込み\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E8%A8%AD%E5%AE%9A%E7%94%BB%E9%9D%A2%E3%81%AE%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%97-1\"\u003e設定画面の呼び出し\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%B5%90%E6%9E%9C\"\u003e結果\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%BD%99%E8%AB%87-fourcc%E3%81%A8codec%E3%81%AE%E9%96%A2%E9%80%A3%E4%BB%98%E3%81%91%E3%81%AE%E7%AE%A1%E7%90%86\"\u003e余談: FourCCとcodecの関連付けの管理\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":1335,"uuid":"da5c27a863c0d30ae520","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"b4rzt2w/BetUvH6kWqvfdB8J7VE=--fF7bmRSf9oLoQm4f--xyvGQEFqpdUJH3ihOLGi5A==","originalId":94177,"description":"ありきたりなC++erです。最近C++書いていません(あれっ","facebookUrl":null,"githubUrl":"https://github.com/yumetodo","isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"","profileImageUrl":"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/profile-images/1584389588","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2Fprofile-images%2F1584389588?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=88c6dce18fca91def51fdbd70009c2c9","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2Fprofile-images%2F1584389588?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=124a7e02b16babd4198670a19f8052a7","urlName":"yumetodo","websiteUrl":"http://yumetodo.hateblo.jp/","twitterUrl":"https://twitter.com/yumetodo","twitterUrlName":"yumetodo","revealedOrganizations":{"edges":[{"node":{"encryptedId":"f+uxiUM1mFvsSAgDHnJYJe5Rp4WIUmSIvQTp--qj7cukEor1KK53z8--4IoRQE9VgSwu05TOhL5Hlw==","isBetaReleaseEnabled":false,"isFollowableByViewer":false,"isFollowedByViewer":false,"name":"Qiitadonユーザー会","logoUrl":"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/f127ee01aab3e6ccdd1b16a52ce54e5d8f802e92/original.jpg?1594042832","urlName":"qiitadon","description":"Qiitadon（β）から生まれた Qiita ユーザー・コミュニティです。","url":"https://qiitadon.com/"}}]}},"tags":[{"name":"Windows","urlName":"windows"},{"name":"C#","urlName":"csharp"},{"name":"Codec","urlName":"codec"},{"name":"VFW","urlName":"vfw"}],"followingLikers":{"edges":[]},"comments":{"totalCount":0}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

More than 1 year has passed since last update.Ateam Lifestyle x cyma Advent Calendar 2018 の19日目は自転車通販サイト「cyma -サイマ-」の運営を預かる@shimura_atsushiが担当します。

普段は自転車を扱うECサイトの運営／開発を担当しておりますが今回はデスクトップアプリの試作に取り組んでみました。今回は私の方で特にこういう方にとターゲットを決めておりません。
取り立てて難しいことはしていないので強いて言うならタイトルから
興味を持っていただいた全ての方になります。今回は.NET CoreをLinuxにインストールして自転車情報を管理するサービスを作成してみます。
用意したサービスをデスクトップアプリケーションから利用し、自転車情報を管理するという構成のシステムを作成します。以下の環境でシステムを開発します。.NET CoreはWindows/Mac/Linuxなど動作するオープンソースの開発プラットホームです。
コンソール向けのアプリ、Web向けのアプリなどがC#で開発できます。
詳しいことはMicrosoftの資料をごらんください。
.NET Core今回は.NET Coreによりサービスの開発を行います。
サーバ側であるLinuxに.NET Coreをインストールします。
.NET Coreのインストールは下記リンク環境別にインストール方法の紹介があります。
.NET Core SDKMicrosoftが公式のDockerイメージを用意してくれています。こちらを利用する方が環境構築は楽かもしれません。
.NET Core Dockerお好きな方を選択してください。
ちなみに今回の私の環境はDocker上のLinuxに.NET Coreをインストールしたものを利用してます。
※執筆中に.NET Coreの公式Dockerの存在を知りました。.NET Coreのインストールが済んだら、例によって「HelloWorld」を試してみます。
新規にプロジェクトを作成して「HelloWorld」を実行してみます。コマンドを実行すればプロジェクトに必要なファイル群が作成されます。
consoleとあるのは「コンソールアプリのテンプレートでプロジェクトを作成してね」ということです。
更に'-n'オプションで指定した内容でディレクトリを作成し、その配下にプロジェクトを展開してくれます。エントリポイントは「Program.cs」です。「Program.cs」を開いてみます。内容をみると既に「HelloWorld」を出力するプログラムが記述されているので今回はこのまま実行してみます。労せずして「HelloWorld」ができました。

これらの作業と後述のサービス作成はVisualStudioを利用することでも可能です、お好みに応じて利用してみてください。
VisualStudioサービスで利用するデータベースにMySQLを利用します。
MySQLのインストールなど導入に関する情報は溢れていると思いますので今回はスキップします。
MySQLへアクセスするためにはそのためのライブラリが必要なのでNuGetを利用してMySQLにアクセス可能なライブラリを用意します。NuGet, MySQL.Dataプロジェクトの格納ディレクトリで以下ライブラリを追加するコマンドを実行します。*.csprojファイルを開くとMySql.Dataのライブラリが追加されていることがわかります。これでMySQLを利用する環境は整ったはずです、次は実際にMySQLへのアクセスを試します。簡単ですが自電車のサンプルのデータを以下のように用意します。データを利用するサンプルプログラムは以下の通りです。これで.NET Core/C#のプログラムからMySQLを利用することができました。今度はコンソール向けのプロジェクトではなくサービス向けのテンプレートでプロジェクトを作成してみます。以上のコマンドでWebapi用のプロジェクトを作成できます。  MySQLへ登録した自転車情報を取得するサービスを作成します。
自転車情報全件と特定の自転車情報を取得するサービスを作成してみます。
まず、サービスを記述するためのWebApi用コントローラのクラスファイルを作成します。※.NET Coreのビルドインサーバは5000番ポートを利用します、Dockerを利用する際はコンテナ起動時に5000番ポートを割り当ててください。ブラウザから
http://localhost:5000/bikes へリクエストしてみます。

DBから自転車情報が全件取得しJSONで返って来ているのがわかります。http://localhost:5000/bikes/1 へリクエストしてみます。

こちらはIDにより絞り込みされたデータで取得できています。至極、簡素ではありますが自転車情報を取得するためのWebサービスが出来上がりました。次はこのデータを再利用するアプリを作成していきます。本来はWindowsFormもしくはWPFでのクライアントアプリの開発をしたいところではありましたが私の手元にWindowsがインストールされた端末がなくMacしかないという都合でCocoaを利用してWebサービスを扱うアプリの開発をします。
VisualStudio for Macを用いればC＃を利用したCocoaのアプリを開発することができます。以下ソースコードがサービスにリクエストしている箇所です。（抜粋）
※jsonを扱うためにJson.NETというパッケージを利用しています、ここではNuGetで取得したものを使用します。※サンプルなのでソースコードが重複しているのは容赦ください。(1)アプリの起動と同時にサービスへリクエストをして車種情報を全件取得しTableViewへ表示します。 
(2)画面上のTextFieldにIDを入力してボタンを押下するとID別の車種情報を取得しTableViewへ表示します。
今回はクライアント側はCocoaで作成しましたがWindowsFormもしくはWPFを用いたアプリなどのほうが開発がしやすく利便性が個人的に高いように思います。
業務系のアプリを開発する際はデザインを飾ることも少ないと思うのでデスクトップアプリの方がWebアプリのようにCSSやJavascriptを利用しなくてもよくコストが安くなる場合があるのではないでしょうか？
サービスを管理するアプリはこういった技術を利用したものを選択肢として持っておくのもいいと思いました。Ateam Lifestyle x cyma Advent Calendar 2018、明日も「cyma -サイマ-」の@k_moriに書いてもらう予定です。お楽しみに！エイチームグループでは、一緒に働けるチャレンジ精神旺盛な仲間を募集しています。興味を持たれた方はぜひエイチームグループ採用サイトを御覧ください。
https://www.a-tm.co.jp/recruit/



<!DOCTYPE html><html><head><meta charset="utf-8" /><title>C#からC/C++の関数をコールする方法　まとめ① - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/TackKaiware/items/27ebcf10bb2624db197a" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="ojjaQDoQg03Xqjgk6UgndZ/rdMT+zKO92/uQD55+OKv3mHaWDzcWoUIDvu2b72tPpm3jB7jCNEHzdLHm83f5yw==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta content="@tackDTM" name="twitter:creator" /><meta property="og:type" content="article"><meta property="og:title" content="C#からC/C++の関数をコールする方法　まとめ① - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1ReVBqZ1l2amdvbERMME1ySy1PQnJ1bVdvdWFWc09PQ2t1T0NzLU9Edk9PRHEtT0JtZU9DaS1hV3VlYXpsZU9BZ09PQnZ1T0JxT09DZ2VLUm9BJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NTQmdHh0LWNsaXA9ZWxsaXBzaXMmdHh0LWFsaWduPWNlbnRlciUyQ21pZGRsZSZzPTk5NmU3YmYxZDczN2QwMDZmNjJjZDBlYmMwNzAwNGU0&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RRlJoWTJ0TFlXbDNZWEpsJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NDUmdHh0LWFsaWduPXJpZ2h0JTJDYm90dG9tJnM9MWMyNzNkNjNiZWNiZDBmODU3MDQ4NzQxNzgxOTVlNDI&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=4fd585e92bdf8900d3400ddf2143ea63"><meta property="og:description" content="

はじめに

タイトルの通り、たまーにC#からC/C++の関数を呼ぼうとすると
アレやコレやとド忘れしていて大失敗、その都度ネットを徘徊し手順を確認するのもアレなので
備忘録としてここに記載いたします。
なお、Visual Stud..."><meta content="https://qiita.com/TackKaiware/items/27ebcf10bb2624db197a" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C,C++,C#,VisualStudio" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 1nzh4zz 38fzdi helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-1nzh4zz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:16px 32px;background-color:#FBE69E;color:rgba(0,0,0,0.87);line-height:1.5;font-weight:600;}@media (max-width:770px){.css-1nzh4zz{padding:16px;}}.css-38fzdi{color:#CA832A;margin-right:4px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-63051c04-5991-4470-8eaf-d631ae00d3af"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2FTackKaiware%2Fitems%2F27ebcf10bb2624db197a">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2FTackKaiware%2Fitems%2F27ebcf10bb2624db197a">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-63051c04-5991-4470-8eaf-d631ae00d3af">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/c","name":"C"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2016-10-16T14:22:10.000+09:00","dateModified":"2017-05-13T04:23:06.000+09:00","headline":"C#からC/C++の関数をコールする方法　まとめ①","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1ReVBqZ1l2amdvbERMME1ySy1PQnJ1bVdvdWFWc09PQ2t1T0NzLU9Edk9PRHEtT0JtZU9DaS1hV3VlYXpsZU9BZ09PQnZ1T0JxT09DZ2VLUm9BJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NTQmdHh0LWNsaXA9ZWxsaXBzaXMmdHh0LWFsaWduPWNlbnRlciUyQ21pZGRsZSZzPTk5NmU3YmYxZDczN2QwMDZmNjJjZDBlYmMwNzAwNGU0\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RRlJoWTJ0TFlXbDNZWEpsJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NDUmdHh0LWFsaWduPXJpZ2h0JTJDYm90dG9tJnM9MWMyNzNkNjNiZWNiZDBmODU3MDQ4NzQxNzgxOTVlNDI\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=4fd585e92bdf8900d3400ddf2143ea63","mainEntityOfPage":"https://qiita.com/TackKaiware/items/27ebcf10bb2624db197a","author":{"@type":"Person","address":null,"email":null,"identifier":"TackKaiware","name":"TackKaiware","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Favatars.githubusercontent.com%2Fu%2F12983478%3Fv%3D3?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=8492436b915a9b0c62fbcd90a15b4db4","url":"https://qiita.com/TackKaiware","description":null,"memberOf":[]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://zine.qiita.com/interview/202107-line-growth-technology/?utm_source=qiita&amp;utm_medium=header-banner">運用ではなくサービス運営の課題解決。LINE Growth Technologyに聞くGrowth開発</a><a target="_blank" id="header_text_message_2" href="https://zine.qiita.com/interview/202107-line-growth-technology/?utm_source=qiita&amp;utm_medium=header-banner">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"TackKaiware","type":"items","id":"27ebcf10bb2624db197a"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"運用ではなくサービス運営の課題解決。LINE Growth Technologyに聞くGrowth開発","url":"https://zine.qiita.com/interview/202107-line-growth-technology/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"TackKaiware","type":"items","id":"27ebcf10bb2624db197a"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":0,"pos_id":"header_text_message_1","message":"運用ではなくサービス運営の課題解決。LINE Growth Technologyに聞くGrowth開発","url":"https://zine.qiita.com/interview/202107-line-growth-technology/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"TackKaiware","type":"items","id":"27ebcf10bb2624db197a"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":0,"pos_id":"header_text_message_2","message":"運用ではなくサービス運営の課題解決。LINE Growth Technologyに聞くGrowth開発","url":"https://zine.qiita.com/interview/202107-line-growth-technology/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/TackKaiware/items/27ebcf10bb2624db197a","location":"/TackKaiware/items/27ebcf10bb2624db197a","scheme":"https","host":"qiita.com","port":null,"pathname":"/TackKaiware/items/27ebcf10bb2624db197a","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"Yv7B0LbQa5Wx5lpC+0ALj67QYhfFxoD1tPXq+Fbfjn03Xm0Gg/f+eSRP3IuJ50e1l1b11IPIFwmcessRO9ZPHQ==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-d6520f76-662e-4381-a6d3-287af7c1c2d9"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/TackKaiware/items/27ebcf10bb2624db197a/likers" class="css-1iupg5d">172</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">205</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/27ebcf10bb2624db197a/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/TackKaiware/items/27ebcf10bb2624db197a/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/TackKaiware/items/27ebcf10bb2624db197a/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/TackKaiware/items/27ebcf10bb2624db197a/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/TackKaiware/items/27ebcf10bb2624db197a.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-1nzh4zz"><span class="fa fa-fw fa-warning css-38fzdi"></span><p>More than 3 years have passed since last update.</p></div><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/TackKaiware"><img class="css-100alwu eyfquo10" src="https://avatars.githubusercontent.com/u/12983478?v=3" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/TackKaiware" class="css-10ougpm">@<!-- -->TackKaiware</a><div class="css-1ay9vb9"><span><meta content="2016-10-16T05:22:10Z"/><time dateTime="2017-05-12T19:23:06Z" class="css-m19uds">updated at 2017-05-12</time></span></div></div></div></div></div><h1 class="css-cgzq40">C#からC/C++の関数をコールする方法　まとめ①</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/c" class="css-4czcte">C</a><a href="/tags/cpp" class="css-4czcte">C++</a><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/visualstudio" class="css-4czcte">VisualStudio</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div>
<h1>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h1>

<p>タイトルの通り、たまーにC#からC/C++の関数を呼ぼうとすると<br>
アレやコレやとド忘れしていて大失敗、その都度ネットを徘徊し手順を確認するのもアレなので<br>
備忘録としてここに記載いたします。<br>
なお、Visual Studio 2015での実施を前提としております。</p>

<p><strong>[2016/10/23追記]<br>
コメント欄でのご指摘を受け、32bit/64bitの両環境に対応した設定方法を<br>
「6．片手落ちだったので追加説明」に追記いたしました。</strong></p>

<h1>
<span id="1事前準備" class="fragment"></span><a href="#1%E4%BA%8B%E5%89%8D%E6%BA%96%E5%82%99"><i class="fa fa-link"></i></a>1．事前準備</h1>

<h2>
<span id="1-1cプロジェクトの作成" class="fragment"></span><a href="#1-1c%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>1-1．C#プロジェクトの作成</h2>

<p>ソリューションを作ったら、関数をコールする側としてコンソールアプリを作ります。<br>
名前は適当に"Application"としましょう。<br>
<a href="https://camo.qiitausercontent.com/552c852b424edfa12fb7e7f5a38bb2bd448d8e67/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3134333536352f62666334393835322d396531652d336338312d636530652d3839623234636662363966342e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2Fbfc49852-9e1e-3c81-ce0e-89b24cfb69f4.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=efc65051bd2e72ec940da419991b7db0" alt="001.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/143565/bfc49852-9e1e-3c81-ce0e-89b24cfb69f4.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2Fbfc49852-9e1e-3c81-ce0e-89b24cfb69f4.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=44f8dbe3d72e0f85253781419bd3cbfc 1x" loading="lazy"></a></p>

<h2>
<span id="1-2ccプロジェクトの作成" class="fragment"></span><a href="#1-2cc%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>1-2．C/C++プロジェクトの作成</h2>

<p>次にコールされる側のDLLを作成するC/C++用のプロジェクトを作ります。とりあえず空で。<br>
<a href="https://camo.qiitausercontent.com/b8125a340c2342e61ad3d6e5ad05e061c52d3636/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3134333536352f64313264396631342d393066392d383935322d646534652d3664656365383136656266392e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2Fd12d9f14-90f9-8952-de4e-6dece816ebf9.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=51d446302f2a54c0ab0a3bbc519c2a7a" alt="002.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/143565/d12d9f14-90f9-8952-de4e-6dece816ebf9.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2Fd12d9f14-90f9-8952-de4e-6dece816ebf9.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=8386f7ec7dfb99505b47bac0d3232f2f 1x" loading="lazy"></a></p>

<p>＜確認＞<br>
こないなことになっているはずです。<br>
<a href="https://camo.qiitausercontent.com/4c4121cf94681931ff974551580c9cc50ac740ae/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3134333536352f63656431646364612d346666352d653538322d616465652d3063323531613264623636632e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2Fced1dcda-4ff5-e582-adee-0c251a2db66c.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=57c0e10b2e4bbb0b9ec9f49f1b70f467" alt="003.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/143565/ced1dcda-4ff5-e582-adee-0c251a2db66c.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2Fced1dcda-4ff5-e582-adee-0c251a2db66c.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=e0190c36abd45de029004b4a9ada3c01 1x" loading="lazy"></a></p>

<h2>
<span id="1-3ccプロジェクトの設定変更" class="fragment"></span><a href="#1-3cc%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E8%A8%AD%E5%AE%9A%E5%A4%89%E6%9B%B4"><i class="fa fa-link"></i></a>1-3．C/C++プロジェクトの設定変更</h2>

<p>ガリガリっとコードを書く前に、プロジェクトの設定を以下の通り変更します。<br>
ソリューションエクスプローラーのLibraryを右クリック -&gt; プロパティ -&gt; 全般 -&gt; 構成の種類-&gt;<br>
<strong>ダイナミックライブラリ(.dll)</strong></p>

<p>これでDLLが作成されるわけだ<img alt=":hotsprings:" class="emoji" height="20" src="https://cdn.qiita.com/emoji/twemoji/unicode/2668-fe0f.png" title=":hotsprings:" width="20" loading="lazy"><br>
<a href="https://camo.qiitausercontent.com/bdce65d27c8e651cc0f02d71e7d2e9afb864edfd/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3134333536352f65343166343132382d373464622d626139322d333935322d3465346235653933396662372e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2Fe41f4128-74db-ba92-3952-4e4b5e939fb7.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=5dba3b0c13584e7397cdf4fdc04977af" alt="004.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/143565/e41f4128-74db-ba92-3952-4e4b5e939fb7.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2Fe41f4128-74db-ba92-3952-4e4b5e939fb7.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=7eda306eedebbb8be8da862bb34a7a57 1x" loading="lazy"></a></p>

<h1>
<span id="2コードかきかき" class="fragment"></span><a href="#2%E3%82%B3%E3%83%BC%E3%83%89%E3%81%8B%E3%81%8D%E3%81%8B%E3%81%8D"><i class="fa fa-link"></i></a>2．コードかきかき</h1>

<h2>
<span id="2-1cc関数の作成" class="fragment"></span><a href="#2-1cc%E9%96%A2%E6%95%B0%E3%81%AE%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>2-1．C/C++関数の作成</h2>

<p>次に<code>library.h</code>と<code>libray.cpp</code>を作成し、テスト用関数を定義します。</p>

<div class="code-frame" data-lang="c">
<div class="code-lang"><span class="bold">library.h</span></div>
<div class="highlight"><pre class="with-code"><code><span class="cp">#pragma once
</span>
<span class="k">extern</span> <span class="s">"C"</span>
<span class="p">{</span>
    <span class="kr">__declspec</span><span class="p">(</span> <span class="n">dllexport</span> <span class="p">)</span> <span class="kt">void</span> <span class="n">Test</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
</div>

<div class="code-frame" data-lang="c">
<div class="code-lang"><span class="bold">library.cpp</span></div>
<div class="highlight"><pre class="with-code"><code><span class="cp">#include &lt;iostream&gt;
#include "library.h"
</span>
<span class="kt">void</span> <span class="nf">Test</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Cの関数が呼び出されました。"</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p><code>exetern "C"</code>と<code>__declspec(dllexport)</code>についてはMSDNに説明を任せた！ｗ</p>

<p><code>exetern "C"</code><br>
<a href="https://msdn.microsoft.com/ja-jp/library/wf2w9f6x.aspx" class="autolink" rel="nofollow noopener" target="_blank">https://msdn.microsoft.com/ja-jp/library/wf2w9f6x.aspx</a><br>
<code>__declspec(dllexport)</code><br>
<a href="https://msdn.microsoft.com/ja-jp/library/a90k134d.aspx" class="autolink" rel="nofollow noopener" target="_blank">https://msdn.microsoft.com/ja-jp/library/a90k134d.aspx</a></p>

<p><code>__declspec(dllexport)</code>は、タイプするには長めなのでdefineしてもよさそう。</p>

<div class="code-frame" data-lang="c">
<div class="code-lang"><span class="bold">library.h</span></div>
<div class="highlight"><pre class="with-code"><code><span class="cp">#pragma once
</span>
<span class="cp">#define DllExport   __declspec( dllexport )
</span>
<span class="k">extern</span> <span class="s">"C"</span>
<span class="p">{</span>
    <span class="n">DllExport</span> <span class="kt">void</span> <span class="n">Test</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>ビルドはC#のアプリと一緒にやるのでおあずけです。<img alt=":neutral_face:" class="emoji" height="20" src="https://cdn.qiita.com/emoji/twemoji/unicode/1f610.png" title=":neutral_face:" width="20" loading="lazy"></p>

<h2>
<span id="2-1c側に関数宣言を記述する" class="fragment"></span><a href="#2-1c%E5%81%B4%E3%81%AB%E9%96%A2%E6%95%B0%E5%AE%A3%E8%A8%80%E3%82%92%E8%A8%98%E8%BF%B0%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>2-1．C#側に関数宣言を記述する</h2>

<p>デフォルトで作成されている<code>Program.cs</code>を開き、以下の通り<br>
C/C++関数をコールするための宣言を記述します。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">Program.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">System.Runtime.InteropServices</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">Application</span>
<span class="p">{</span>
    <span class="k">internal</span> <span class="k">class</span> <span class="nc">Program</span>
    <span class="p">{</span>
        <span class="p">[</span><span class="nf">DllImport</span><span class="p">(</span> <span class="s">"Library.dll"</span> <span class="p">)]</span>
        <span class="k">static</span> <span class="k">extern</span> <span class="k">void</span> <span class="nf">Test</span><span class="p">();</span>

        <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="nf">Test</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p><img alt=":loudspeaker:" class="emoji" height="20" src="https://cdn.qiita.com/emoji/twemoji/unicode/1f4e2.png" title=":loudspeaker:" width="20" loading="lazy">関数宣言のルール<br>
・<code>[DllImport]</code>属性をつけること。<br>
・<code>[DllImport]</code>のカッコの中は利用するDLL名とすること。<br>
・関数の修飾子は<code>static extern</code>とすること。<br>
・関数名はC/C++側と同じにすること。（引数は事情が異なるのでまたの機会に）</p>

<h1>
<span id="3ビルドその前に" class="fragment"></span><a href="#3%E3%83%93%E3%83%AB%E3%83%89%E3%81%9D%E3%81%AE%E5%89%8D%E3%81%AB"><i class="fa fa-link"></i></a>3．ビルドその前に</h1>

<p>今回はC#で作成したアプリケーションと、C/C++で作成したDLLの二つをビルドする必要があります。<br>
プロジェクト毎に一回一回ビルドするのも面倒なので、この際ドバ~っと一気にやっちゃう設定をしましょう。<br>
メニューバーのビルド -&gt; バッチビルドを開き以下の設定にします。</p>

<p><a href="https://camo.qiitausercontent.com/47518f56b89a9353c9ef0bbda4db4005c9e5b3b2/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3134333536352f31396636383163372d343865622d646438302d636564332d3938383666346233306264342e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2F19f681c7-48eb-dd80-ced3-9886f4b30bd4.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=00c7f0ca93c0427ea9ec6bf7ae295237" alt="005.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/143565/19f681c7-48eb-dd80-ced3-9886f4b30bd4.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2F19f681c7-48eb-dd80-ced3-9886f4b30bd4.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=26d44d55a766d5676b10661c94439af6 1x" loading="lazy"></a></p>

<p><strong>2016/10/16修正</strong><br>
<strong>コメント欄にて、DLLをコピーするバッチを作成しなくても、C/C++のDLLの出力先を<br>
C#アプリの実行ファイルと同じにすれば良いのでは？とご指摘を頂きました。<br>
その通りですので修正させて頂きます。</strong></p>

<p>C/C++のDLLをC#側で利用するためには、C#アプリの実行ファイル(.exe)が格納されているフォルダに<br>
DLLを置かなくてはいけません。ビルド時に同じパスに出力されるよう、以下の通りDLLの出力先フォルダを変更します。<br>
(Debugモード時とReleaseモード時で異なる設定が必要なため注意)</p>

<p>＜Debugモードの設定＞<br>
ソリューションエクスプローラーのLibraryを右クリック -&gt; プロパティ -&gt; 全般 -&gt; <strong>出力ディレクトリ</strong>を<br>
<code>$(SolutionDir)\Application\bin\Debug\</code>に変更 -&gt; 適用ボタン ぽちり。</p>

<p><a href="https://camo.qiitausercontent.com/c061de35256d929d41012a7a91472576b769cfed/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3134333536352f32333064326463302d343030372d613636392d663262662d6262343764313562326366652e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2F230d2dc0-4007-a669-f2bf-bb47d15b2cfe.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=dcd6da7a47e2b78a2b45b81ae6cf00ec" alt="010.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/143565/230d2dc0-4007-a669-f2bf-bb47d15b2cfe.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2F230d2dc0-4007-a669-f2bf-bb47d15b2cfe.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=edb8539bb2df3c4987281d108a61476a 1x" loading="lazy"></a></p>

<p>＜Releaseモードの設定＞<br>
（プロパティーページのまま）構成(C)を<code>Release</code>に切り替え。<strong>出力ディレクトリ</strong>を<br>
<code>$(SolutionDir)\Application\bin\Release\</code>に変更 -&gt; OKボタン ぽちり。<br>
<a href="https://camo.qiitausercontent.com/3b695f5b8caa4c75377efc450779fc13c0c8eb67/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3134333536352f39386330376333372d663338372d633333382d386663612d3034366266313464306666302e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2F98c07c37-f387-c338-8fca-046bf14d0ff0.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=327c0913d6ee614b606d8fecfb16a0d0" alt="011.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/143565/98c07c37-f387-c338-8fca-046bf14d0ff0.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2F98c07c37-f387-c338-8fca-046bf14d0ff0.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=4034800a032dcb30506ad65f726ca2e1 1x" loading="lazy"></a></p>

<h1>
<span id="4ビルドぶちこんでやるぜ" class="fragment"></span><a href="#4%E3%83%93%E3%83%AB%E3%83%89%E3%81%B6%E3%81%A1%E3%81%93%E3%82%93%E3%81%A7%E3%82%84%E3%82%8B%E3%81%9C"><i class="fa fa-link"></i></a>4．ビルドぶちこんでやるぜ！！</h1>

<p>待ちに待ったF7タイムですが、今回はバッチビルドを実行しますので以下の手順で行います。<br>
メニューバーのビルド -&gt; バッチビルド -&gt; ビルド(B)</p>

<p>・・・で、出力ウィンドウにこのような結果が表示されればOK。<br>
（画像は取り直しました）<br>
<a href="https://camo.qiitausercontent.com/65042d8ecd3b68d83c2ad1524620014340353a05/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3134333536352f64356534373133662d363633392d333431322d323233342d6231646661376636373664622e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2Fd5e4713f-6639-3412-2234-b1dfa7f676db.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=c087b23d6b4bbf4732ff99e56221ad10" alt="008_new.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/143565/d5e4713f-6639-3412-2234-b1dfa7f676db.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2Fd5e4713f-6639-3412-2234-b1dfa7f676db.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=0a05fe1cddac9461d60659c20d63ea0f 1x" loading="lazy"></a></p>

<p>これ以降C/C++のDLLのみ修正した場合は、C#側のアプリをビルドする必要無し。<br>
（そうでないとDLLのうま味がねェ~）</p>

<h1>
<span id="5-動作確認" class="fragment"></span><a href="#5-%E5%8B%95%E4%BD%9C%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>5． 動作確認</h1>

<p>プロジェクトのターゲットをC#の"Application"に指定してCtrl+F5。</p>

<p><a href="https://camo.qiitausercontent.com/7aedeac9f072a17b35b24a815a6c60382d24c7f9/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3134333536352f66656639346438332d376463372d323539622d386330312d3664643733316666303562322e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2Ffef94d83-7dc7-259b-8c01-6dd731ff05b2.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=ca5e9a79aeb92e4c18b7724af05f820e" alt="009.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/143565/fef94d83-7dc7-259b-8c01-6dd731ff05b2.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2Ffef94d83-7dc7-259b-8c01-6dd731ff05b2.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=0d43e453044342d30beb7a09fae82362 1x" loading="lazy"></a><br>
無時、C#側からC/C++の関数を呼び出せているようです。<img alt=":tada:" class="emoji" height="20" src="https://cdn.qiita.com/emoji/twemoji/unicode/1f389.png" title=":tada:" width="20" loading="lazy"></p>

<p><strong><del>や っ た ぜ 。</del><img alt=":sunglasses:" class="emoji" height="20" src="https://cdn.qiita.com/emoji/twemoji/unicode/1f60e.png" title=":sunglasses:" width="20" loading="lazy"></strong><br>
（実はちゃんとできていませんでした・・・）</p>

<h1>
<span id="6片手落ちだったので追加説明" class="fragment"></span><a href="#6%E7%89%87%E6%89%8B%E8%90%BD%E3%81%A1%E3%81%A0%E3%81%A3%E3%81%9F%E3%81%AE%E3%81%A7%E8%BF%BD%E5%8A%A0%E8%AA%AC%E6%98%8E"><i class="fa fa-link"></i></a>6．片手落ちだったので追加説明</h1>

<p>※この項の説明はこちらの記事を参考にさせて頂きました。<br>
<a href="http://qiita.com/mima_ita/items/57d7c1101543e214b1d6" id="reference-386d3dbc43c670044f98">.NETにおける64ビットプロセスと32ビットプロセスについて</a></p>

<p>※あとこちらのサイト様<br>
<a href="http://gurizuri0505.halfmoon.jp/develop/csharp-2/unmanagedll32_64" rel="nofollow noopener" target="_blank">C#＆32bitアンマネージDLL／64bitアンマネージDLLの動的な呼び出し方法</a></p>

<h2>
<span id="6-1なにがダメだったのか" class="fragment"></span><a href="#6-1%E3%81%AA%E3%81%AB%E3%81%8C%E3%83%80%E3%83%A1%E3%81%A0%E3%81%A3%E3%81%9F%E3%81%AE%E3%81%8B"><i class="fa fa-link"></i></a>6-1．なにがダメだったのか</h2>

<p>コメント欄にて、「その設定とC#のコードだとある条件下では動かないぞ」という旨のご指摘を<br>
頂きました。まずはビルド設定の振り返りから。</p>

<p><a href="https://camo.qiitausercontent.com/535d1053f404ef75ad90d815cd24fb2ed054db51/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3134333536352f61343966343363612d626462342d646538312d366431352d3532663061663662306663652e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2Fa49f43ca-bdb4-de81-6d15-52f0af6b0fce.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=d0acda05292dc2a7852d4e8e4315e7f4" alt="005.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/143565/a49f43ca-bdb4-de81-6d15-52f0af6b0fce.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2Fa49f43ca-bdb4-de81-6d15-52f0af6b0fce.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=f8ce015aca78648b3c9c1f24033a61df 1x" loading="lazy"></a></p>

<p>＜以下自分の理解＞<br>
C#側のアプリ<code>Application</code>はプラットフォーム -&gt; <code>Any CPU</code>。<br>
・OSが32ビットの場合 -&gt; (EXEは)32ビットのプロセスとして動作する。<br>
・OSが64ビットの場合 -&gt; (EXEは)64ビットのプロセスとして動作する。</p>

<p>動作確認したOSは64ビットなので、後者に該当します。<br>
64ビットのEXEは64ビットのDLLしか呼べません。今回C/C++で作成したDLLは<br>
アンマネージDLLになりますので、C#で作ったアプリ（マネージアプリ）のように<br>
環境によって64ビット/32ビットと動的に切り替わることはありません。<br>
EXEに合わせてしかるべき設定でビルドする必要がありました。</p>

<p>したがってC/C++側のDLL<code>Library</code>はプラットフォーム -&gt; <code>x64</code>でビルドするべきだったのですが、<br>
<del>OSが○○ビットって話が抜けてた</del>マウス操作をミスったらしく、<br>
<code>Win32</code>にチェックをつけてしまったようです。</p>

<h2>
<span id="6-2でも動いてたんだよなぁ" class="fragment"></span><a href="#6-2%E3%81%A7%E3%82%82%E5%8B%95%E3%81%84%E3%81%A6%E3%81%9F%E3%82%93%E3%81%A0%E3%82%88%E3%81%AA%E3%81%81"><i class="fa fa-link"></i></a>6-2．でも動いてたんだよなぁ・・・</h2>

<p>しかしながら、上記の理解と「5．動作確認」で示した結果は矛盾しています。<br>
結果だけ見れば動くはずのない組み合わせで動いていて・・・ん？</p>

<p><code>Application</code>のプロパティ</p>

<p><a href="https://camo.qiitausercontent.com/b4e92d55f7e28826d3e1e9065c6520f5496f98b6/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3134333536352f65313132656636372d393630642d663435652d316661362d3936633536326563623536312e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2Fe112ef67-960d-f45e-1fa6-96c562ecb561.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=95a0bea3f1a014767b290b31a8e37482" alt="012.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/143565/e112ef67-960d-f45e-1fa6-96c562ecb561.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2Fe112ef67-960d-f45e-1fa6-96c562ecb561.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=81c6fa11ab07e7c4cf9ab9c908493c98 1x" loading="lazy"></a></p>

<p><a href="https://camo.qiitausercontent.com/7388d9e40e65ceabc6aac53b93538ef4c322ef4c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3134333536352f33323331323130322d653266382d646632352d343338332d6461383632623361666661632e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2F32312102-e2f8-df25-4383-da862b3affac.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=a8d78befca06f33034f0a9b3e88d1e63" alt="013.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/143565/32312102-e2f8-df25-4383-da862b3affac.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2F32312102-e2f8-df25-4383-da862b3affac.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=0ce113658028daeed290806a529901d0 1x" loading="lazy"></a></p>

<p><strong><del>バカ除けにひっかかった</del>オプション設定が作用していたようです。</strong><br>
32ビットで動作が可能な場合、32ビットで動作してくれる設定とのこと。<br>
今回、DLL側に合わせて32ビットでアプリが動作したということか・・・。<br>
検証のため<code>Environment.ほにゃらら</code>で調べてみると、</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">何が起こっているか.cs</span></div>
<div class="highlight"><pre class="with-code"><code>
<span class="c1">// OSが何ビットで動作しているか確認</span>
<span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span> <span class="s">$"OS : </span><span class="p">{(</span> <span class="n">Environment</span><span class="p">.</span><span class="n">Is64BitOperatingSystem</span> <span class="p">?</span> <span class="s">"64bit"</span> <span class="p">:</span> <span class="s">"32bit"</span> <span class="p">)}</span><span class="s">"</span> <span class="p">);</span>

<span class="c1">// プロセスが何ビットで動作しているか確認</span>
<span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span> <span class="s">$"プロセス : </span><span class="p">{(</span> <span class="n">Environment</span><span class="p">.</span><span class="n">Is64BitProcess</span> <span class="p">?</span> <span class="s">"64bit"</span> <span class="p">:</span> <span class="s">"32bit"</span> <span class="p">)}</span><span class="s">"</span> <span class="p">);</span>
</code></pre></div>
</div>

<p><a href="https://camo.qiitausercontent.com/c78bb32a8e5ee2d72c1dcb94d1bcaa8c372e1a69/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3134333536352f62646130643030382d393361622d366461652d306565322d3164613832313530626131342e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2Fbda0d008-93ab-6dae-0ee2-1da82150ba14.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=6107a690e91f149c58b98d7ab4c56c1f" alt="014.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/143565/bda0d008-93ab-6dae-0ee2-1da82150ba14.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2Fbda0d008-93ab-6dae-0ee2-1da82150ba14.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=0e302919b753d2fed13da5a32f00fd6b 1x" loading="lazy"></a><br>
はい。分かりました。<br>
ちなみに先ほどの32ビットを優先(P)のチェックを外して<br>
「4．ビルドぶちこんでやるぜ！！」までで作成したC#アプリを実行したところ、</p>

<p><a href="https://camo.qiitausercontent.com/a40b296de9805a00169dd779618fb6bfea65801e/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3134333536352f65363138386234322d393633652d373338612d383564302d3832373234333033306530652e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2Fe6188b42-963e-738a-85d0-827243030e0e.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=4531977bf4f2ee957d3caa486f98ac03" alt="015.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/143565/e6188b42-963e-738a-85d0-827243030e0e.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2Fe6188b42-963e-738a-85d0-827243030e0e.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=6a1c5c34b9ed4fbd3ee86620b0bbe624 1x" loading="lazy"></a><br>
と、64ビットのアプリと32ビットのDLLという適合しない組み合わせのため、<br>
<code>System.BadImageFormatException</code>が発生して動作しないことを確認できました（意味不明）</p>

<h2>
<span id="6-364bit32bit対応版" class="fragment"></span><a href="#6-364bit32bit%E5%AF%BE%E5%BF%9C%E7%89%88"><i class="fa fa-link"></i></a>6-3．64bit/32bit対応版</h2>

<p>コメント欄にてご指摘いただいた通り、64bit/32bitに対応する設定&amp;コーディングがベストです。<br>
以下はそのための設定方法。</p>

<p>まずはバッチビルドの設定から。<br>
メニューバーのビルド -&gt; バッチビルドを開き、<code>Library</code>のプラットフォームの<code>x64</code>にチェックを入れます<br>
<a href="https://camo.qiitausercontent.com/2b41827ba7d7659e1e36764426f6af00c96719dc/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3134333536352f37343339373633312d313338322d356239632d396336332d3338666239633538373739622e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2F74397631-1382-5b9c-9c63-38fb9c58779b.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=eff03178e0048aa09cbdd23e5ba205c4" alt="021.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/143565/74397631-1382-5b9c-9c63-38fb9c58779b.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2F74397631-1382-5b9c-9c63-38fb9c58779b.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=c415d04951165d084fd206cec322d409 1x" loading="lazy"></a></p>

<p>次にプロジェクトの設定をします。まずは64bit版のDebugモードから。<br>
ソリューションエクスプローラーのLibraryを右クリック -&gt; プロパティを開き、赤枠内を変更。<br>
出力ディレクトリをC#のアプリと同じにするのは変わりませんが、32bitのDLLファイルと名前が被らないように<br>
ターゲット名に"64"をつけるのがポイント。<br>
<a href="https://camo.qiitausercontent.com/626993313a366c9928e572cb48e46d20ccf206b0/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3134333536352f39303934373234372d333637322d373965372d626438342d6639313564393463316233382e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2F90947247-3672-79e7-bd84-f915d94c1b38.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=882b404152d946b4ad59ca104d9c28e0" alt="016_x86_Debug.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/143565/90947247-3672-79e7-bd84-f915d94c1b38.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2F90947247-3672-79e7-bd84-f915d94c1b38.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=56702cdb01abd3da04b66003595fd263 1x" loading="lazy"></a></p>

<p>続いて32bit版のDebugモード。こちらもターゲット名に"32"をつけて64bit版と区別します。<br>
<a href="https://camo.qiitausercontent.com/c1ac87cbecf485ecaa0f928f346244805458e789/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3134333536352f33613236323531652d393165382d373033372d353733362d6239316533356435633432322e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2F3a26251e-91e8-7037-5736-b91e35d5c422.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=2d1ff06da0ac522d4a78296e136c97fe" alt="017_Win32_Debug.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/143565/3a26251e-91e8-7037-5736-b91e35d5c422.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2F3a26251e-91e8-7037-5736-b91e35d5c422.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=b7faa5cd7ef5983cfeaad123e68aa820 1x" loading="lazy"></a></p>

<p>64bit版のReleaseモード。<br>
<a href="https://camo.qiitausercontent.com/a3f1181026ced89593f9384fb3cf40934bf00755/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3134333536352f65386566653166362d343562352d396439382d653566352d3663383066646334353534382e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2Fe8efe1f6-45b5-9d98-e5f5-6c80fdc45548.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=0d63465afd8769b3b45af1dd16cd434f" alt="018_x64_Release.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/143565/e8efe1f6-45b5-9d98-e5f5-6c80fdc45548.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2Fe8efe1f6-45b5-9d98-e5f5-6c80fdc45548.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=cc9165bc92e146f6a69ec3328bd5da2e 1x" loading="lazy"></a></p>

<p>32bit版のReleaseモード。<br>
<a href="https://camo.qiitausercontent.com/5a7df513f3286879a35d4df2ffe68eccbcb64b55/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3134333536352f66663135396333342d623137302d653430662d323236322d6533383636653237646230312e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2Fff159c34-b170-e40f-2262-e3866e27db01.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=c7d73317cfeeb87f8e5cceee9cbd671e" alt="019_Win32_Release.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/143565/ff159c34-b170-e40f-2262-e3866e27db01.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2Fff159c34-b170-e40f-2262-e3866e27db01.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=a41f740fd1180d16d49b7086ebb6d4ee 1x" loading="lazy"></a></p>

<p>最期にC#側の<code>Application</code>のプロパティを開き、「32ビットを優先」のチェックを外します。<br>
64bit版のDLLを作成する設定をしたので、もう不要ですからね。<br>
<a href="https://camo.qiitausercontent.com/5c768c2b1c010bf9785e232504230c35ce3b7db0/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3134333536352f62643566653733332d666265302d633237372d366662652d3037393839353834303939612e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2Fbd5fe733-fbe0-c277-6fbe-07989584099a.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=344edc6d969b1a1c82f103c004d53554" alt="020.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/143565/bd5fe733-fbe0-c277-6fbe-07989584099a.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2Fbd5fe733-fbe0-c277-6fbe-07989584099a.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=62c93e6bd5fcc9924e4a1492244decfd 1x" loading="lazy"></a></p>

<p>・・・でC#のソースコードは以下のようにします。<br>
C/C++側の関数宣言を32bit/64bit両方記述し、関数名の末尾に<code>_32</code>、<code>_64</code>を付けるなどして区別します。<br>
C/C++関数の本来の名前は、<code>DllImport</code>属性内の<code>EntryPoint</code>に記述します。<br>
最後に、現在のプロセス(<code>Environment.Is64BitProcess</code>で判断可)によって関数を呼び分ける<br>
ラッパーメソッド<code>Test()</code>を定義します。クライアントはこのラッパーメソッドを使用します。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">64bit/32bit対応版.cs</span></div>
<div class="highlight"><pre class="with-code"><code>
<span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Runtime.InteropServices</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">Application</span>
<span class="p">{</span>
    <span class="k">internal</span> <span class="k">class</span> <span class="nc">Program</span>
    <span class="p">{</span>
        <span class="c1">// 32bit版のC/C++関数の宣言</span>
        <span class="p">[</span><span class="nf">DllImport</span><span class="p">(</span> <span class="s">"Library32.dll"</span><span class="p">,</span> <span class="n">EntryPoint</span> <span class="p">=</span> <span class="s">"Test"</span> <span class="p">)]</span>
        <span class="k">static</span> <span class="k">extern</span> <span class="k">void</span> <span class="nf">Test_32</span><span class="p">();</span>

<span class="err">　　　　</span> <span class="c1">// 64bit版のC/C++関数の宣言</span>
        <span class="p">[</span><span class="nf">DllImport</span><span class="p">(</span> <span class="s">"Library64.dll"</span><span class="p">,</span> <span class="n">EntryPoint</span> <span class="p">=</span> <span class="s">"Test"</span> <span class="p">)]</span>
        <span class="k">static</span> <span class="k">extern</span> <span class="k">void</span> <span class="nf">Test_64</span><span class="p">();</span>

        <span class="c1">// 現在のプロセスにより32bit/64bit版の関数を呼び分けるラッパーメソッド</span>
        <span class="k">static</span> <span class="k">void</span> <span class="nf">Test</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span> <span class="n">Environment</span><span class="p">.</span><span class="n">Is64BitProcess</span> <span class="p">)</span>
                <span class="nf">Test_64</span><span class="p">();</span>
            <span class="k">else</span>
                <span class="nf">Test_32</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="c1">// クライアント</span>
        <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="nf">Test</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>バッチビルドを実行し、以下の通りファイルが作成されれば成功！<br>
<a href="https://camo.qiitausercontent.com/e4ca86f37d274cc0a67b49e45ba8f49683dca6ad/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3134333536352f30313831653336372d646433322d646234352d303936362d3538353139333332613362312e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2F0181e367-dd32-db45-0966-58519332a3b1.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=7931cde4a5b14f6ae6a53cb17fd87a31" alt="022.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/143565/0181e367-dd32-db45-0966-58519332a3b1.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2F0181e367-dd32-db45-0966-58519332a3b1.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=01acb383d3f389e6503a4b95081487ba 1x" loading="lazy"></a></p>

<h1>
<span id="おわりに" class="fragment"></span><a href="#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB"><i class="fa fa-link"></i></a>おわりに</h1>

<p>くぅ疲です。<br>
本当はC#側からC/C++関数を呼び出す際の細かい話（引数が構造体ポインタの時はどうすんのやとか）も<br>
したかったのですが、意外と記事が長くなってしまったので、続きはまた今度とさせて頂きたく思います。<br>
<del>調査出来ていないという説あり</del></p>

<p>この記事をご覧になられて、<br>
・記載の抜け、誤り<br>
・分かりづらかった点<br>
・やりたいことは出来てるだろうけどその方法はアホだろ<br>
といったご意見・ご感想があれば頂けると嬉しいです。</p>

<p>お声があれば、この記事は日々修正していきたいと思っております。</p>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2FTackKaiware%2Fitems%2F27ebcf10bb2624db197a&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2FTackKaiware%2Fitems%2F27ebcf10bb2624db197a&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/TackKaiware/items/27ebcf10bb2624db197a/likers" class="css-1iupg5d">172</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">205</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/27ebcf10bb2624db197a/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/TackKaiware/items/27ebcf10bb2624db197a/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/TackKaiware/items/27ebcf10bb2624db197a/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/TackKaiware/items/27ebcf10bb2624db197a/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/TackKaiware/items/27ebcf10bb2624db197a.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-d6520f76-662e-4381-a6d3-287af7c1c2d9">{"authorAnalyticsTrackingId":null,"organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-f3cd7983-7fba-4ece-a91e-3b95117e3bed"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-f3cd7983-7fba-4ece-a91e-3b95117e3bed">{}</script>
      
<div id="LoginModal-react-component-c7d8a928-7571-4fb6-8e84-4f6c076901cb"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-c7d8a928-7571-4fb6-8e84-4f6c076901cb">{}</script>
      
<div id="StockModal-react-component-7f9ec8c4-042b-44d7-a6b4-5604220a6848"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-7f9ec8c4-042b-44d7-a6b4-5604220a6848">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;qfkfW5iPl5s8Zwd9/2tmfy/aA3kDGFRRggmUh5MVKzf8WbONragCd6nOgbSNzCpFFlyUukUWw62qhrVu/hzqVw==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\n\u003ch1\u003e\n\u003cspan id=\"はじめに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eはじめに\u003c/h1\u003e\n\n\u003cp\u003eタイトルの通り、たまーにC#からC/C++の関数を呼ぼうとすると\u003cbr\u003e\nアレやコレやとド忘れしていて大失敗、その都度ネットを徘徊し手順を確認するのもアレなので\u003cbr\u003e\n備忘録としてここに記載いたします。\u003cbr\u003e\nなお、Visual Studio 2015での実施を前提としております。\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003e[2016/10/23追記]\u003cbr\u003e\nコメント欄でのご指摘を受け、32bit/64bitの両環境に対応した設定方法を\u003cbr\u003e\n「6．片手落ちだったので追加説明」に追記いたしました。\u003c/strong\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"1事前準備\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#1%E4%BA%8B%E5%89%8D%E6%BA%96%E5%82%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e1．事前準備\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"1-1cプロジェクトの作成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#1-1c%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E4%BD%9C%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e1-1．C#プロジェクトの作成\u003c/h2\u003e\n\n\u003cp\u003eソリューションを作ったら、関数をコールする側としてコンソールアプリを作ります。\u003cbr\u003e\n名前は適当に\"Application\"としましょう。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/552c852b424edfa12fb7e7f5a38bb2bd448d8e67/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3134333536352f62666334393835322d396531652d336338312d636530652d3839623234636662363966342e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2Fbfc49852-9e1e-3c81-ce0e-89b24cfb69f4.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=efc65051bd2e72ec940da419991b7db0\" alt=\"001.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/143565/bfc49852-9e1e-3c81-ce0e-89b24cfb69f4.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2Fbfc49852-9e1e-3c81-ce0e-89b24cfb69f4.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=44f8dbe3d72e0f85253781419bd3cbfc 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"1-2ccプロジェクトの作成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#1-2cc%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E4%BD%9C%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e1-2．C/C++プロジェクトの作成\u003c/h2\u003e\n\n\u003cp\u003e次にコールされる側のDLLを作成するC/C++用のプロジェクトを作ります。とりあえず空で。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/b8125a340c2342e61ad3d6e5ad05e061c52d3636/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3134333536352f64313264396631342d393066392d383935322d646534652d3664656365383136656266392e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2Fd12d9f14-90f9-8952-de4e-6dece816ebf9.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=51d446302f2a54c0ab0a3bbc519c2a7a\" alt=\"002.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/143565/d12d9f14-90f9-8952-de4e-6dece816ebf9.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2Fd12d9f14-90f9-8952-de4e-6dece816ebf9.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=8386f7ec7dfb99505b47bac0d3232f2f 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e＜確認＞\u003cbr\u003e\nこないなことになっているはずです。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/4c4121cf94681931ff974551580c9cc50ac740ae/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3134333536352f63656431646364612d346666352d653538322d616465652d3063323531613264623636632e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2Fced1dcda-4ff5-e582-adee-0c251a2db66c.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=57c0e10b2e4bbb0b9ec9f49f1b70f467\" alt=\"003.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/143565/ced1dcda-4ff5-e582-adee-0c251a2db66c.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2Fced1dcda-4ff5-e582-adee-0c251a2db66c.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=e0190c36abd45de029004b4a9ada3c01 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"1-3ccプロジェクトの設定変更\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#1-3cc%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E8%A8%AD%E5%AE%9A%E5%A4%89%E6%9B%B4\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e1-3．C/C++プロジェクトの設定変更\u003c/h2\u003e\n\n\u003cp\u003eガリガリっとコードを書く前に、プロジェクトの設定を以下の通り変更します。\u003cbr\u003e\nソリューションエクスプローラーのLibraryを右クリック -\u0026gt; プロパティ -\u0026gt; 全般 -\u0026gt; 構成の種類-\u0026gt;\u003cbr\u003e\n\u003cstrong\u003eダイナミックライブラリ(.dll)\u003c/strong\u003e\u003c/p\u003e\n\n\u003cp\u003eこれでDLLが作成されるわけだ\u003cimg alt=\":hotsprings:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/2668-fe0f.png\" title=\":hotsprings:\" width=\"20\" loading=\"lazy\"\u003e\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/bdce65d27c8e651cc0f02d71e7d2e9afb864edfd/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3134333536352f65343166343132382d373464622d626139322d333935322d3465346235653933396662372e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2Fe41f4128-74db-ba92-3952-4e4b5e939fb7.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=5dba3b0c13584e7397cdf4fdc04977af\" alt=\"004.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/143565/e41f4128-74db-ba92-3952-4e4b5e939fb7.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2Fe41f4128-74db-ba92-3952-4e4b5e939fb7.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=7eda306eedebbb8be8da862bb34a7a57 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"2コードかきかき\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#2%E3%82%B3%E3%83%BC%E3%83%89%E3%81%8B%E3%81%8D%E3%81%8B%E3%81%8D\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2．コードかきかき\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"2-1cc関数の作成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#2-1cc%E9%96%A2%E6%95%B0%E3%81%AE%E4%BD%9C%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2-1．C/C++関数の作成\u003c/h2\u003e\n\n\u003cp\u003e次に\u003ccode\u003elibrary.h\u003c/code\u003eと\u003ccode\u003elibray.cpp\u003c/code\u003eを作成し、テスト用関数を定義します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003elibrary.h\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"cp\"\u003e#pragma once\n\u003c/span\u003e\n\u003cspan class=\"k\"\u003eextern\u003c/span\u003e \u003cspan class=\"s\"\u003e\"C\"\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kr\"\u003e__declspec\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003edllexport\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"n\"\u003eTest\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003elibrary.cpp\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"cp\"\u003e#include \u0026lt;iostream\u0026gt;\n#include \"library.h\"\n\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eTest\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ecout\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Cの関数が呼び出されました。\"\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eendl\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003eexetern \"C\"\u003c/code\u003eと\u003ccode\u003e__declspec(dllexport)\u003c/code\u003eについてはMSDNに説明を任せた！ｗ\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eexetern \"C\"\u003c/code\u003e\u003cbr\u003e\n\u003ca href=\"https://msdn.microsoft.com/ja-jp/library/wf2w9f6x.aspx\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://msdn.microsoft.com/ja-jp/library/wf2w9f6x.aspx\u003c/a\u003e\u003cbr\u003e\n\u003ccode\u003e__declspec(dllexport)\u003c/code\u003e\u003cbr\u003e\n\u003ca href=\"https://msdn.microsoft.com/ja-jp/library/a90k134d.aspx\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://msdn.microsoft.com/ja-jp/library/a90k134d.aspx\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003e__declspec(dllexport)\u003c/code\u003eは、タイプするには長めなのでdefineしてもよさそう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003elibrary.h\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"cp\"\u003e#pragma once\n\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#define DllExport   __declspec( dllexport )\n\u003c/span\u003e\n\u003cspan class=\"k\"\u003eextern\u003c/span\u003e \u003cspan class=\"s\"\u003e\"C\"\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eDllExport\u003c/span\u003e \u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"n\"\u003eTest\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eビルドはC#のアプリと一緒にやるのでおあずけです。\u003cimg alt=\":neutral_face:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/1f610.png\" title=\":neutral_face:\" width=\"20\" loading=\"lazy\"\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"2-1c側に関数宣言を記述する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#2-1c%E5%81%B4%E3%81%AB%E9%96%A2%E6%95%B0%E5%AE%A3%E8%A8%80%E3%82%92%E8%A8%98%E8%BF%B0%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2-1．C#側に関数宣言を記述する\u003c/h2\u003e\n\n\u003cp\u003eデフォルトで作成されている\u003ccode\u003eProgram.cs\u003c/code\u003eを開き、以下の通り\u003cbr\u003e\nC/C++関数をコールするための宣言を記述します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eProgram.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Runtime.InteropServices\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eApplication\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003einternal\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eProgram\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eDllImport\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Library.dll\"\u003c/span\u003e \u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003eextern\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eTest\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eMain\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eTest\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003cimg alt=\":loudspeaker:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/1f4e2.png\" title=\":loudspeaker:\" width=\"20\" loading=\"lazy\"\u003e関数宣言のルール\u003cbr\u003e\n・\u003ccode\u003e[DllImport]\u003c/code\u003e属性をつけること。\u003cbr\u003e\n・\u003ccode\u003e[DllImport]\u003c/code\u003eのカッコの中は利用するDLL名とすること。\u003cbr\u003e\n・関数の修飾子は\u003ccode\u003estatic extern\u003c/code\u003eとすること。\u003cbr\u003e\n・関数名はC/C++側と同じにすること。（引数は事情が異なるのでまたの機会に）\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"3ビルドその前に\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#3%E3%83%93%E3%83%AB%E3%83%89%E3%81%9D%E3%81%AE%E5%89%8D%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e3．ビルドその前に\u003c/h1\u003e\n\n\u003cp\u003e今回はC#で作成したアプリケーションと、C/C++で作成したDLLの二つをビルドする必要があります。\u003cbr\u003e\nプロジェクト毎に一回一回ビルドするのも面倒なので、この際ドバ~っと一気にやっちゃう設定をしましょう。\u003cbr\u003e\nメニューバーのビルド -\u0026gt; バッチビルドを開き以下の設定にします。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/47518f56b89a9353c9ef0bbda4db4005c9e5b3b2/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3134333536352f31396636383163372d343865622d646438302d636564332d3938383666346233306264342e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2F19f681c7-48eb-dd80-ced3-9886f4b30bd4.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=00c7f0ca93c0427ea9ec6bf7ae295237\" alt=\"005.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/143565/19f681c7-48eb-dd80-ced3-9886f4b30bd4.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2F19f681c7-48eb-dd80-ced3-9886f4b30bd4.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=26d44d55a766d5676b10661c94439af6 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003e2016/10/16修正\u003c/strong\u003e\u003cbr\u003e\n\u003cstrong\u003eコメント欄にて、DLLをコピーするバッチを作成しなくても、C/C++のDLLの出力先を\u003cbr\u003e\nC#アプリの実行ファイルと同じにすれば良いのでは？とご指摘を頂きました。\u003cbr\u003e\nその通りですので修正させて頂きます。\u003c/strong\u003e\u003c/p\u003e\n\n\u003cp\u003eC/C++のDLLをC#側で利用するためには、C#アプリの実行ファイル(.exe)が格納されているフォルダに\u003cbr\u003e\nDLLを置かなくてはいけません。ビルド時に同じパスに出力されるよう、以下の通りDLLの出力先フォルダを変更します。\u003cbr\u003e\n(Debugモード時とReleaseモード時で異なる設定が必要なため注意)\u003c/p\u003e\n\n\u003cp\u003e＜Debugモードの設定＞\u003cbr\u003e\nソリューションエクスプローラーのLibraryを右クリック -\u0026gt; プロパティ -\u0026gt; 全般 -\u0026gt; \u003cstrong\u003e出力ディレクトリ\u003c/strong\u003eを\u003cbr\u003e\n\u003ccode\u003e$(SolutionDir)\\Application\\bin\\Debug\\\u003c/code\u003eに変更 -\u0026gt; 適用ボタン ぽちり。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/c061de35256d929d41012a7a91472576b769cfed/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3134333536352f32333064326463302d343030372d613636392d663262662d6262343764313562326366652e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2F230d2dc0-4007-a669-f2bf-bb47d15b2cfe.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=dcd6da7a47e2b78a2b45b81ae6cf00ec\" alt=\"010.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/143565/230d2dc0-4007-a669-f2bf-bb47d15b2cfe.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2F230d2dc0-4007-a669-f2bf-bb47d15b2cfe.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=edb8539bb2df3c4987281d108a61476a 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e＜Releaseモードの設定＞\u003cbr\u003e\n（プロパティーページのまま）構成(C)を\u003ccode\u003eRelease\u003c/code\u003eに切り替え。\u003cstrong\u003e出力ディレクトリ\u003c/strong\u003eを\u003cbr\u003e\n\u003ccode\u003e$(SolutionDir)\\Application\\bin\\Release\\\u003c/code\u003eに変更 -\u0026gt; OKボタン ぽちり。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/3b695f5b8caa4c75377efc450779fc13c0c8eb67/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3134333536352f39386330376333372d663338372d633333382d386663612d3034366266313464306666302e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2F98c07c37-f387-c338-8fca-046bf14d0ff0.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=327c0913d6ee614b606d8fecfb16a0d0\" alt=\"011.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/143565/98c07c37-f387-c338-8fca-046bf14d0ff0.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2F98c07c37-f387-c338-8fca-046bf14d0ff0.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=4034800a032dcb30506ad65f726ca2e1 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"4ビルドぶちこんでやるぜ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#4%E3%83%93%E3%83%AB%E3%83%89%E3%81%B6%E3%81%A1%E3%81%93%E3%82%93%E3%81%A7%E3%82%84%E3%82%8B%E3%81%9C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e4．ビルドぶちこんでやるぜ！！\u003c/h1\u003e\n\n\u003cp\u003e待ちに待ったF7タイムですが、今回はバッチビルドを実行しますので以下の手順で行います。\u003cbr\u003e\nメニューバーのビルド -\u0026gt; バッチビルド -\u0026gt; ビルド(B)\u003c/p\u003e\n\n\u003cp\u003e・・・で、出力ウィンドウにこのような結果が表示されればOK。\u003cbr\u003e\n（画像は取り直しました）\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/65042d8ecd3b68d83c2ad1524620014340353a05/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3134333536352f64356534373133662d363633392d333431322d323233342d6231646661376636373664622e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2Fd5e4713f-6639-3412-2234-b1dfa7f676db.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=c087b23d6b4bbf4732ff99e56221ad10\" alt=\"008_new.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/143565/d5e4713f-6639-3412-2234-b1dfa7f676db.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2Fd5e4713f-6639-3412-2234-b1dfa7f676db.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=0a05fe1cddac9461d60659c20d63ea0f 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eこれ以降C/C++のDLLのみ修正した場合は、C#側のアプリをビルドする必要無し。\u003cbr\u003e\n（そうでないとDLLのうま味がねェ~）\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"5-動作確認\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#5-%E5%8B%95%E4%BD%9C%E7%A2%BA%E8%AA%8D\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e5． 動作確認\u003c/h1\u003e\n\n\u003cp\u003eプロジェクトのターゲットをC#の\"Application\"に指定してCtrl+F5。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/7aedeac9f072a17b35b24a815a6c60382d24c7f9/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3134333536352f66656639346438332d376463372d323539622d386330312d3664643733316666303562322e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2Ffef94d83-7dc7-259b-8c01-6dd731ff05b2.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=ca5e9a79aeb92e4c18b7724af05f820e\" alt=\"009.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/143565/fef94d83-7dc7-259b-8c01-6dd731ff05b2.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2Ffef94d83-7dc7-259b-8c01-6dd731ff05b2.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=0d43e453044342d30beb7a09fae82362 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n無時、C#側からC/C++の関数を呼び出せているようです。\u003cimg alt=\":tada:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/1f389.png\" title=\":tada:\" width=\"20\" loading=\"lazy\"\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003e\u003cdel\u003eや っ た ぜ 。\u003c/del\u003e\u003cimg alt=\":sunglasses:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/1f60e.png\" title=\":sunglasses:\" width=\"20\" loading=\"lazy\"\u003e\u003c/strong\u003e\u003cbr\u003e\n（実はちゃんとできていませんでした・・・）\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"6片手落ちだったので追加説明\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#6%E7%89%87%E6%89%8B%E8%90%BD%E3%81%A1%E3%81%A0%E3%81%A3%E3%81%9F%E3%81%AE%E3%81%A7%E8%BF%BD%E5%8A%A0%E8%AA%AC%E6%98%8E\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e6．片手落ちだったので追加説明\u003c/h1\u003e\n\n\u003cp\u003e※この項の説明はこちらの記事を参考にさせて頂きました。\u003cbr\u003e\n\u003ca href=\"http://qiita.com/mima_ita/items/57d7c1101543e214b1d6\" id=\"reference-386d3dbc43c670044f98\"\u003e.NETにおける64ビットプロセスと32ビットプロセスについて\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e※あとこちらのサイト様\u003cbr\u003e\n\u003ca href=\"http://gurizuri0505.halfmoon.jp/develop/csharp-2/unmanagedll32_64\" rel=\"nofollow noopener\" target=\"_blank\"\u003eC#＆32bitアンマネージDLL／64bitアンマネージDLLの動的な呼び出し方法\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"6-1なにがダメだったのか\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#6-1%E3%81%AA%E3%81%AB%E3%81%8C%E3%83%80%E3%83%A1%E3%81%A0%E3%81%A3%E3%81%9F%E3%81%AE%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e6-1．なにがダメだったのか\u003c/h2\u003e\n\n\u003cp\u003eコメント欄にて、「その設定とC#のコードだとある条件下では動かないぞ」という旨のご指摘を\u003cbr\u003e\n頂きました。まずはビルド設定の振り返りから。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/535d1053f404ef75ad90d815cd24fb2ed054db51/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3134333536352f61343966343363612d626462342d646538312d366431352d3532663061663662306663652e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2Fa49f43ca-bdb4-de81-6d15-52f0af6b0fce.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=d0acda05292dc2a7852d4e8e4315e7f4\" alt=\"005.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/143565/a49f43ca-bdb4-de81-6d15-52f0af6b0fce.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2Fa49f43ca-bdb4-de81-6d15-52f0af6b0fce.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=f8ce015aca78648b3c9c1f24033a61df 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e＜以下自分の理解＞\u003cbr\u003e\nC#側のアプリ\u003ccode\u003eApplication\u003c/code\u003eはプラットフォーム -\u0026gt; \u003ccode\u003eAny CPU\u003c/code\u003e。\u003cbr\u003e\n・OSが32ビットの場合 -\u0026gt; (EXEは)32ビットのプロセスとして動作する。\u003cbr\u003e\n・OSが64ビットの場合 -\u0026gt; (EXEは)64ビットのプロセスとして動作する。\u003c/p\u003e\n\n\u003cp\u003e動作確認したOSは64ビットなので、後者に該当します。\u003cbr\u003e\n64ビットのEXEは64ビットのDLLしか呼べません。今回C/C++で作成したDLLは\u003cbr\u003e\nアンマネージDLLになりますので、C#で作ったアプリ（マネージアプリ）のように\u003cbr\u003e\n環境によって64ビット/32ビットと動的に切り替わることはありません。\u003cbr\u003e\nEXEに合わせてしかるべき設定でビルドする必要がありました。\u003c/p\u003e\n\n\u003cp\u003eしたがってC/C++側のDLL\u003ccode\u003eLibrary\u003c/code\u003eはプラットフォーム -\u0026gt; \u003ccode\u003ex64\u003c/code\u003eでビルドするべきだったのですが、\u003cbr\u003e\n\u003cdel\u003eOSが○○ビットって話が抜けてた\u003c/del\u003eマウス操作をミスったらしく、\u003cbr\u003e\n\u003ccode\u003eWin32\u003c/code\u003eにチェックをつけてしまったようです。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"6-2でも動いてたんだよなぁ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#6-2%E3%81%A7%E3%82%82%E5%8B%95%E3%81%84%E3%81%A6%E3%81%9F%E3%82%93%E3%81%A0%E3%82%88%E3%81%AA%E3%81%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e6-2．でも動いてたんだよなぁ・・・\u003c/h2\u003e\n\n\u003cp\u003eしかしながら、上記の理解と「5．動作確認」で示した結果は矛盾しています。\u003cbr\u003e\n結果だけ見れば動くはずのない組み合わせで動いていて・・・ん？\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eApplication\u003c/code\u003eのプロパティ\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/b4e92d55f7e28826d3e1e9065c6520f5496f98b6/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3134333536352f65313132656636372d393630642d663435652d316661362d3936633536326563623536312e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2Fe112ef67-960d-f45e-1fa6-96c562ecb561.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=95a0bea3f1a014767b290b31a8e37482\" alt=\"012.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/143565/e112ef67-960d-f45e-1fa6-96c562ecb561.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2Fe112ef67-960d-f45e-1fa6-96c562ecb561.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=81c6fa11ab07e7c4cf9ab9c908493c98 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/7388d9e40e65ceabc6aac53b93538ef4c322ef4c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3134333536352f33323331323130322d653266382d646632352d343338332d6461383632623361666661632e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2F32312102-e2f8-df25-4383-da862b3affac.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=a8d78befca06f33034f0a9b3e88d1e63\" alt=\"013.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/143565/32312102-e2f8-df25-4383-da862b3affac.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2F32312102-e2f8-df25-4383-da862b3affac.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=0ce113658028daeed290806a529901d0 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003e\u003cdel\u003eバカ除けにひっかかった\u003c/del\u003eオプション設定が作用していたようです。\u003c/strong\u003e\u003cbr\u003e\n32ビットで動作が可能な場合、32ビットで動作してくれる設定とのこと。\u003cbr\u003e\n今回、DLL側に合わせて32ビットでアプリが動作したということか・・・。\u003cbr\u003e\n検証のため\u003ccode\u003eEnvironment.ほにゃらら\u003c/code\u003eで調べてみると、\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e何が起こっているか.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\n\u003cspan class=\"c1\"\u003e// OSが何ビットで動作しているか確認\u003c/span\u003e\n\u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"s\"\u003e$\"OS : \u003c/span\u003e\u003cspan class=\"p\"\u003e{(\u003c/span\u003e \u003cspan class=\"n\"\u003eEnvironment\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIs64BitOperatingSystem\u003c/span\u003e \u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"s\"\u003e\"64bit\"\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e\"32bit\"\u003c/span\u003e \u003cspan class=\"p\"\u003e)}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// プロセスが何ビットで動作しているか確認\u003c/span\u003e\n\u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"s\"\u003e$\"プロセス : \u003c/span\u003e\u003cspan class=\"p\"\u003e{(\u003c/span\u003e \u003cspan class=\"n\"\u003eEnvironment\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIs64BitProcess\u003c/span\u003e \u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"s\"\u003e\"64bit\"\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e\"32bit\"\u003c/span\u003e \u003cspan class=\"p\"\u003e)}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/c78bb32a8e5ee2d72c1dcb94d1bcaa8c372e1a69/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3134333536352f62646130643030382d393361622d366461652d306565322d3164613832313530626131342e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2Fbda0d008-93ab-6dae-0ee2-1da82150ba14.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=6107a690e91f149c58b98d7ab4c56c1f\" alt=\"014.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/143565/bda0d008-93ab-6dae-0ee2-1da82150ba14.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2Fbda0d008-93ab-6dae-0ee2-1da82150ba14.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=0e302919b753d2fed13da5a32f00fd6b 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\nはい。分かりました。\u003cbr\u003e\nちなみに先ほどの32ビットを優先(P)のチェックを外して\u003cbr\u003e\n「4．ビルドぶちこんでやるぜ！！」までで作成したC#アプリを実行したところ、\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/a40b296de9805a00169dd779618fb6bfea65801e/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3134333536352f65363138386234322d393633652d373338612d383564302d3832373234333033306530652e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2Fe6188b42-963e-738a-85d0-827243030e0e.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=4531977bf4f2ee957d3caa486f98ac03\" alt=\"015.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/143565/e6188b42-963e-738a-85d0-827243030e0e.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2Fe6188b42-963e-738a-85d0-827243030e0e.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=6a1c5c34b9ed4fbd3ee86620b0bbe624 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\nと、64ビットのアプリと32ビットのDLLという適合しない組み合わせのため、\u003cbr\u003e\n\u003ccode\u003eSystem.BadImageFormatException\u003c/code\u003eが発生して動作しないことを確認できました（意味不明）\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"6-364bit32bit対応版\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#6-364bit32bit%E5%AF%BE%E5%BF%9C%E7%89%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e6-3．64bit/32bit対応版\u003c/h2\u003e\n\n\u003cp\u003eコメント欄にてご指摘いただいた通り、64bit/32bitに対応する設定\u0026amp;コーディングがベストです。\u003cbr\u003e\n以下はそのための設定方法。\u003c/p\u003e\n\n\u003cp\u003eまずはバッチビルドの設定から。\u003cbr\u003e\nメニューバーのビルド -\u0026gt; バッチビルドを開き、\u003ccode\u003eLibrary\u003c/code\u003eのプラットフォームの\u003ccode\u003ex64\u003c/code\u003eにチェックを入れます\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/2b41827ba7d7659e1e36764426f6af00c96719dc/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3134333536352f37343339373633312d313338322d356239632d396336332d3338666239633538373739622e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2F74397631-1382-5b9c-9c63-38fb9c58779b.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=eff03178e0048aa09cbdd23e5ba205c4\" alt=\"021.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/143565/74397631-1382-5b9c-9c63-38fb9c58779b.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2F74397631-1382-5b9c-9c63-38fb9c58779b.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=c415d04951165d084fd206cec322d409 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e次にプロジェクトの設定をします。まずは64bit版のDebugモードから。\u003cbr\u003e\nソリューションエクスプローラーのLibraryを右クリック -\u0026gt; プロパティを開き、赤枠内を変更。\u003cbr\u003e\n出力ディレクトリをC#のアプリと同じにするのは変わりませんが、32bitのDLLファイルと名前が被らないように\u003cbr\u003e\nターゲット名に\"64\"をつけるのがポイント。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/626993313a366c9928e572cb48e46d20ccf206b0/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3134333536352f39303934373234372d333637322d373965372d626438342d6639313564393463316233382e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2F90947247-3672-79e7-bd84-f915d94c1b38.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=882b404152d946b4ad59ca104d9c28e0\" alt=\"016_x86_Debug.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/143565/90947247-3672-79e7-bd84-f915d94c1b38.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2F90947247-3672-79e7-bd84-f915d94c1b38.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=56702cdb01abd3da04b66003595fd263 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e続いて32bit版のDebugモード。こちらもターゲット名に\"32\"をつけて64bit版と区別します。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/c1ac87cbecf485ecaa0f928f346244805458e789/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3134333536352f33613236323531652d393165382d373033372d353733362d6239316533356435633432322e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2F3a26251e-91e8-7037-5736-b91e35d5c422.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=2d1ff06da0ac522d4a78296e136c97fe\" alt=\"017_Win32_Debug.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/143565/3a26251e-91e8-7037-5736-b91e35d5c422.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2F3a26251e-91e8-7037-5736-b91e35d5c422.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=b7faa5cd7ef5983cfeaad123e68aa820 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e64bit版のReleaseモード。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/a3f1181026ced89593f9384fb3cf40934bf00755/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3134333536352f65386566653166362d343562352d396439382d653566352d3663383066646334353534382e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2Fe8efe1f6-45b5-9d98-e5f5-6c80fdc45548.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=0d63465afd8769b3b45af1dd16cd434f\" alt=\"018_x64_Release.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/143565/e8efe1f6-45b5-9d98-e5f5-6c80fdc45548.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2Fe8efe1f6-45b5-9d98-e5f5-6c80fdc45548.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=cc9165bc92e146f6a69ec3328bd5da2e 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e32bit版のReleaseモード。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/5a7df513f3286879a35d4df2ffe68eccbcb64b55/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3134333536352f66663135396333342d623137302d653430662d323236322d6533383636653237646230312e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2Fff159c34-b170-e40f-2262-e3866e27db01.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=c7d73317cfeeb87f8e5cceee9cbd671e\" alt=\"019_Win32_Release.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/143565/ff159c34-b170-e40f-2262-e3866e27db01.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2Fff159c34-b170-e40f-2262-e3866e27db01.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=a41f740fd1180d16d49b7086ebb6d4ee 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e最期にC#側の\u003ccode\u003eApplication\u003c/code\u003eのプロパティを開き、「32ビットを優先」のチェックを外します。\u003cbr\u003e\n64bit版のDLLを作成する設定をしたので、もう不要ですからね。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/5c768c2b1c010bf9785e232504230c35ce3b7db0/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3134333536352f62643566653733332d666265302d633237372d366662652d3037393839353834303939612e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2Fbd5fe733-fbe0-c277-6fbe-07989584099a.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=344edc6d969b1a1c82f103c004d53554\" alt=\"020.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/143565/bd5fe733-fbe0-c277-6fbe-07989584099a.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2Fbd5fe733-fbe0-c277-6fbe-07989584099a.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=62c93e6bd5fcc9924e4a1492244decfd 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e・・・でC#のソースコードは以下のようにします。\u003cbr\u003e\nC/C++側の関数宣言を32bit/64bit両方記述し、関数名の末尾に\u003ccode\u003e_32\u003c/code\u003e、\u003ccode\u003e_64\u003c/code\u003eを付けるなどして区別します。\u003cbr\u003e\nC/C++関数の本来の名前は、\u003ccode\u003eDllImport\u003c/code\u003e属性内の\u003ccode\u003eEntryPoint\u003c/code\u003eに記述します。\u003cbr\u003e\n最後に、現在のプロセス(\u003ccode\u003eEnvironment.Is64BitProcess\u003c/code\u003eで判断可)によって関数を呼び分ける\u003cbr\u003e\nラッパーメソッド\u003ccode\u003eTest()\u003c/code\u003eを定義します。クライアントはこのラッパーメソッドを使用します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e64bit/32bit対応版.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Runtime.InteropServices\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eApplication\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003einternal\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eProgram\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 32bit版のC/C++関数の宣言\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eDllImport\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Library32.dll\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eEntryPoint\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Test\"\u003c/span\u003e \u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003eextern\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eTest_32\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n\u003cspan class=\"err\"\u003e　　　　\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 64bit版のC/C++関数の宣言\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eDllImport\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Library64.dll\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eEntryPoint\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Test\"\u003c/span\u003e \u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003eextern\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eTest_64\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// 現在のプロセスにより32bit/64bit版の関数を呼び分けるラッパーメソッド\u003c/span\u003e\n        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eTest\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003eEnvironment\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIs64BitProcess\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"nf\"\u003eTest_64\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n                \u003cspan class=\"nf\"\u003eTest_32\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// クライアント\u003c/span\u003e\n        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eMain\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eTest\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eバッチビルドを実行し、以下の通りファイルが作成されれば成功！\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/e4ca86f37d274cc0a67b49e45ba8f49683dca6ad/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3134333536352f30313831653336372d646433322d646234352d303936362d3538353139333332613362312e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2F0181e367-dd32-db45-0966-58519332a3b1.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=7931cde4a5b14f6ae6a53cb17fd87a31\" alt=\"022.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/143565/0181e367-dd32-db45-0966-58519332a3b1.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F143565%2F0181e367-dd32-db45-0966-58519332a3b1.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=01acb383d3f389e6503a4b95081487ba 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"おわりに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eおわりに\u003c/h1\u003e\n\n\u003cp\u003eくぅ疲です。\u003cbr\u003e\n本当はC#側からC/C++関数を呼び出す際の細かい話（引数が構造体ポインタの時はどうすんのやとか）も\u003cbr\u003e\nしたかったのですが、意外と記事が長くなってしまったので、続きはまた今度とさせて頂きたく思います。\u003cbr\u003e\n\u003cdel\u003e調査出来ていないという説あり\u003c/del\u003e\u003c/p\u003e\n\n\u003cp\u003eこの記事をご覧になられて、\u003cbr\u003e\n・記載の抜け、誤り\u003cbr\u003e\n・分かりづらかった点\u003cbr\u003e\n・やりたいことは出来てるだろうけどその方法はアホだろ\u003cbr\u003e\nといったご意見・ご感想があれば頂けると嬉しいです。\u003c/p\u003e\n\n\u003cp\u003eお声があれば、この記事は日々修正していきたいと思っております。\u003c/p\u003e\n","createdAt":"2016-10-16T05:22:10Z","elapsedYearsFromLastModifiedAt":4,"encryptedId":"sUl2WV5O5oocqyzT1cSiCp7h4ensf9Nb--77dfk72JbF6NiWwA--2aegHbdo038RYG3ENbTKsA==","isBanned":false,"isDeprecated":true,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2017-05-12T19:23:06Z","likesCount":172,"linkUrl":"https://qiita.com/TackKaiware/items/27ebcf10bb2624db197a","organization":null,"originalId":430857,"stockedCount":205,"title":"C#からC/C++の関数をコールする方法　まとめ①","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003eはじめに\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#1%E4%BA%8B%E5%89%8D%E6%BA%96%E5%82%99\"\u003e1．事前準備\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#1-1c%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E4%BD%9C%E6%88%90\"\u003e1-1．C#プロジェクトの作成\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#1-2cc%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E4%BD%9C%E6%88%90\"\u003e1-2．C/C++プロジェクトの作成\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#1-3cc%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E8%A8%AD%E5%AE%9A%E5%A4%89%E6%9B%B4\"\u003e1-3．C/C++プロジェクトの設定変更\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#2%E3%82%B3%E3%83%BC%E3%83%89%E3%81%8B%E3%81%8D%E3%81%8B%E3%81%8D\"\u003e2．コードかきかき\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#2-1cc%E9%96%A2%E6%95%B0%E3%81%AE%E4%BD%9C%E6%88%90\"\u003e2-1．C/C++関数の作成\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#2-1c%E5%81%B4%E3%81%AB%E9%96%A2%E6%95%B0%E5%AE%A3%E8%A8%80%E3%82%92%E8%A8%98%E8%BF%B0%E3%81%99%E3%82%8B\"\u003e2-1．C#側に関数宣言を記述する\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#3%E3%83%93%E3%83%AB%E3%83%89%E3%81%9D%E3%81%AE%E5%89%8D%E3%81%AB\"\u003e3．ビルドその前に\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#4%E3%83%93%E3%83%AB%E3%83%89%E3%81%B6%E3%81%A1%E3%81%93%E3%82%93%E3%81%A7%E3%82%84%E3%82%8B%E3%81%9C\"\u003e4．ビルドぶちこんでやるぜ！！\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#5-%E5%8B%95%E4%BD%9C%E7%A2%BA%E8%AA%8D\"\u003e5． 動作確認\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#6%E7%89%87%E6%89%8B%E8%90%BD%E3%81%A1%E3%81%A0%E3%81%A3%E3%81%9F%E3%81%AE%E3%81%A7%E8%BF%BD%E5%8A%A0%E8%AA%AC%E6%98%8E\"\u003e6．片手落ちだったので追加説明\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#6-1%E3%81%AA%E3%81%AB%E3%81%8C%E3%83%80%E3%83%A1%E3%81%A0%E3%81%A3%E3%81%9F%E3%81%AE%E3%81%8B\"\u003e6-1．なにがダメだったのか\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#6-2%E3%81%A7%E3%82%82%E5%8B%95%E3%81%84%E3%81%A6%E3%81%9F%E3%82%93%E3%81%A0%E3%82%88%E3%81%AA%E3%81%81\"\u003e6-2．でも動いてたんだよなぁ・・・\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#6-364bit32bit%E5%AF%BE%E5%BF%9C%E7%89%88\"\u003e6-3．64bit/32bit対応版\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB\"\u003eおわりに\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":103129,"uuid":"27ebcf10bb2624db197a","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"/tZ7P7rPK0eZRrAvI+qCUsM/ThZw--Umh4wtqUuV7DnrRs--KSKdInhmAAgLqRz9sfDFbQ==","originalId":143565,"description":"","facebookUrl":null,"githubUrl":"https://github.com/TackKaiware","isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"","profileImageUrl":"https://avatars.githubusercontent.com/u/12983478?v=3","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Favatars.githubusercontent.com%2Fu%2F12983478%3Fv%3D3?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=7ee66f1becf8b12e5761358fcc002d2b","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Favatars.githubusercontent.com%2Fu%2F12983478%3Fv%3D3?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=8492436b915a9b0c62fbcd90a15b4db4","urlName":"TackKaiware","websiteUrl":null,"twitterUrl":"https://twitter.com/tackDTM","twitterUrlName":"tackDTM","revealedOrganizations":{"edges":[]}},"tags":[{"name":"C","urlName":"c"},{"name":"C++","urlName":"cpp"},{"name":"C#","urlName":"csharp"},{"name":"VisualStudio","urlName":"visualstudio"}],"followingLikers":{"edges":[]},"comments":{"totalCount":6}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

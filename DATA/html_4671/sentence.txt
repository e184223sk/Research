More than 3 years have passed since last update.だけなら特に難しいこともなかったんですが。という条件下でF10キーが反応しないとダメって言われました。「はっはっはっ、そんなの簡単にできるだろと」・・・できませんでした。WindowのPreviewKeyDownイベントで普通にF1～F12までファンクションキーが押されたイベントって取れますよね。
F10だけはシステムキー扱いなのでちょっと細工が必要ですが、こんな感じでいけます。ただ業務アプリなんか作ってるとこれじゃダメなパターンがあるんですよお客さん。
そんなニッチに要求知らんとか言わないで見てって。こんな状態です。

テキストボックスにフォーカスが当たってて、尚且つテキストが全選択状態になってて、しかもIMEがONになってる状態。この状態だとF5～F9まではIMEにイベントを取られちゃってPreviewKeyDownに来てくれません。
ついでにF10も反応しなくなります。「Windowsの仕様です、ファンクションキー使うのやめましょう」
「・・・ダメ」そんな感じになったのでなんとかしてみました。IMEにイベント横取りされちゃってるので.NETからでは手も足もでません。(なぜ)
なのでデバイスから直接入力を受け取れるRawInput APIを使います。まずxamlはこんな感じになってます。xaml.csはちょっと長いですがこんな感じです。F1～F12までのイベントはPreviewKeyDownに送っています。
普通のKeyDownイベントとWMInputから独自に送ってるイベントで二重に送られてきてしまいますが、その辺は努力しだいで如何様にもできるんじゃないかと思います。
テキストボックスもIMEの状態も変化させずにIMEの機能を殺しつつF5～F10までのイベントもちゃんと取れるようになりました。しかし無駄に長い。もっとスマートにならないのか。
やりたいことは単純なのに、この回り道感がWPFから人を遠ざける原因なんじゃないのか。



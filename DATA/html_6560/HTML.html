<!DOCTYPE html><html><head><meta charset="utf-8" /><title>コンピュータ将棋ソフトとの対局サーバーを立てよう＜その２＞ - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/muzudho1/items/bf3f6debf6db7f96300c" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="n+rhglhBzeNIXxs4ARQ6w9qZ+6zspBtGZ1lHztpNiW+DdRgZTQHXuIl4fVl7RFybrEFdL91OznGoVrVhg3iuMg==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta content="@muzudho1" name="twitter:creator" /><meta property="og:type" content="article"><meta property="og:title" content="コンピュータ将棋ソフトとの対局サーバーを立てよう＜その２＞ - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND00NEt6NDRPejQ0T1U0NE9sNDRPODQ0S181YkNHNXFPTDQ0Szk0NE9WNDRPSTQ0R280NEd1NWEtLTViR0E0NEsxNDRPODQ0T1E0NE84NDRLUzU2dUw0NEdtNDRLSTQ0R0c3N3ljNDRHZDQ0R3U3N3lTNzd5ZSZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTU0JnR4dC1jbGlwPWVsbGlwc2lzJnR4dC1hbGlnbj1jZW50ZXIlMkNtaWRkbGUmcz02OTkwYWQ2OTVhNjdiMGViZWU4MzUzZDFmZTA3MDliZQ&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RRzExZW5Wa2FHOHgmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT00NSZ0eHQtYWxpZ249cmlnaHQlMkNib3R0b20mcz0yNzBmM2IxNzA3MjZjZWFjNGMyNjg1YTgwYTdjMjY5Ng&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=722b92787c4c443f1f54f98ea3a29883"><meta property="og:description" content="前回の記事: 「＜その１＞」 http://qiita.com/muzudho1/items/af3537d36f16c063a572


Ubuntuでプロセス間通信しよう

エラーが出る……、RabbitMQっていったい何メッセー..."><meta content="https://qiita.com/muzudho1/items/bf3f6debf6db7f96300c" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="Erlang,Ubuntu,C#,RabbitMQ,プロセス間通信" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 1nzh4zz 38fzdi helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-1nzh4zz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:16px 32px;background-color:#FBE69E;color:rgba(0,0,0,0.87);line-height:1.5;font-weight:600;}@media (max-width:770px){.css-1nzh4zz{padding:16px;}}.css-38fzdi{color:#CA832A;margin-right:4px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-2bdebd35-156b-4487-b3d3-81154080d9fc"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Fmuzudho1%2Fitems%2Fbf3f6debf6db7f96300c">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Fmuzudho1%2Fitems%2Fbf3f6debf6db7f96300c">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-2bdebd35-156b-4487-b3d3-81154080d9fc">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/erlang","name":"Erlang"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2017-03-06T17:50:01.000+09:00","dateModified":"2017-03-07T20:54:14.000+09:00","headline":"コンピュータ将棋ソフトとの対局サーバーを立てよう＜その２＞","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND00NEt6NDRPejQ0T1U0NE9sNDRPODQ0S181YkNHNXFPTDQ0Szk0NE9WNDRPSTQ0R280NEd1NWEtLTViR0E0NEsxNDRPODQ0T1E0NE84NDRLUzU2dUw0NEdtNDRLSTQ0R0c3N3ljNDRHZDQ0R3U3N3lTNzd5ZSZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTU0JnR4dC1jbGlwPWVsbGlwc2lzJnR4dC1hbGlnbj1jZW50ZXIlMkNtaWRkbGUmcz02OTkwYWQ2OTVhNjdiMGViZWU4MzUzZDFmZTA3MDliZQ\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RRzExZW5Wa2FHOHgmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT00NSZ0eHQtYWxpZ249cmlnaHQlMkNib3R0b20mcz0yNzBmM2IxNzA3MjZjZWFjNGMyNjg1YTgwYTdjMjY5Ng\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=722b92787c4c443f1f54f98ea3a29883","mainEntityOfPage":"https://qiita.com/muzudho1/items/bf3f6debf6db7f96300c","author":{"@type":"Person","address":"埼玉","email":null,"identifier":"muzudho1","name":"muzudho1","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fpbs.twimg.com%2Fprofile_images%2F378800000224959199%2F109762cc48c6e63fad3fbe01065cf862_normal.png?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=3ed9df1f72e7b42b01bc26234820b49f","url":"https://qiita.com/muzudho1","description":"（＾～＾）","memberOf":[]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://zine.qiita.com/interview/202107-hitachi-3/?utm_source=qiita&amp;utm_medium=header-banner">「作業者の負荷情報の見える化」に取り組む研究者が語る日立の魅力</a><a target="_blank" id="header_text_message_2" href="https://zine.qiita.com/interview/202107-hitachi-3/?utm_source=qiita&amp;utm_medium=header-banner">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"muzudho1","type":"items","id":"bf3f6debf6db7f96300c"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"「作業者の負荷情報の見える化」に取り組む研究者が語る日立の魅力","url":"https://zine.qiita.com/interview/202107-hitachi-3/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"muzudho1","type":"items","id":"bf3f6debf6db7f96300c"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_1","message":"「作業者の負荷情報の見える化」に取り組む研究者が語る日立の魅力","url":"https://zine.qiita.com/interview/202107-hitachi-3/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"muzudho1","type":"items","id":"bf3f6debf6db7f96300c"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_2","message":"「作業者の負荷情報の見える化」に取り組む研究者が語る日立の魅力","url":"https://zine.qiita.com/interview/202107-hitachi-3/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/muzudho1/items/bf3f6debf6db7f96300c","location":"/muzudho1/items/bf3f6debf6db7f96300c","scheme":"https","host":"qiita.com","port":null,"pathname":"/muzudho1/items/bf3f6debf6db7f96300c","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"q6h9cTjBq+/lRJtbjfCr0fJ7Ds3PmVVBFgrC9n37/rm3N4TqLYGxtCRj/Tr3oM2JhKOoTv5zgHbZBTBZJM7Z5A==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-f46b2a4a-abb4-4628-a6cb-8e69e867d765"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/muzudho1/items/bf3f6debf6db7f96300c/likers" class="css-1iupg5d">0</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">0</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/bf3f6debf6db7f96300c/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/muzudho1/items/bf3f6debf6db7f96300c/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/muzudho1/items/bf3f6debf6db7f96300c/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/muzudho1/items/bf3f6debf6db7f96300c/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/muzudho1/items/bf3f6debf6db7f96300c.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-1nzh4zz"><span class="fa fa-fw fa-warning css-38fzdi"></span><p>More than 3 years have passed since last update.</p></div><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/muzudho1"><img class="css-100alwu eyfquo10" src="https://pbs.twimg.com/profile_images/378800000224959199/109762cc48c6e63fad3fbe01065cf862_normal.png" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/muzudho1" class="css-10ougpm">@<!-- -->muzudho1</a><div class="css-1ay9vb9"><span><meta content="2017-03-06T08:50:01Z"/><time dateTime="2017-03-07T11:54:14Z" class="css-m19uds">updated at 2017-03-07</time></span></div></div></div></div></div><h1 class="css-cgzq40">コンピュータ将棋ソフトとの対局サーバーを立てよう＜その２＞</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/erlang" class="css-4czcte">Erlang</a><a href="/tags/ubuntu" class="css-4czcte">Ubuntu</a><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/rabbitmq" class="css-4czcte">RabbitMQ</a><a href="/tags/%e3%83%97%e3%83%ad%e3%82%bb%e3%82%b9%e9%96%93%e9%80%9a%e4%bf%a1" class="css-4czcte">プロセス間通信</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div><p>前回の記事: 「＜その１＞」 <a href="http://qiita.com/muzudho1/items/af3537d36f16c063a572" class="autolink" id="reference-bfc60da48dec57f06190">http://qiita.com/muzudho1/items/af3537d36f16c063a572</a></p>

<h1>
<span id="ubuntuでプロセス間通信しよう" class="fragment"></span><a href="#ubuntu%E3%81%A7%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E9%96%93%E9%80%9A%E4%BF%A1%E3%81%97%E3%82%88%E3%81%86"><i class="fa fa-link"></i></a>Ubuntuでプロセス間通信しよう</h1>

<p>エラーが出る……、RabbitMQっていったい何メッセージ・キューだ？ </p>

<p>(RabbitMQ)<br>
<a href="https://www.rabbitmq.com/" class="autolink" rel="nofollow noopener" target="_blank">https://www.rabbitmq.com/</a></p>

<p>「RabbitMQ Configuration」 (RabbitMQ)<br>
<a href="https://www.rabbitmq.com/configure.html" class="autolink" rel="nofollow noopener" target="_blank">https://www.rabbitmq.com/configure.html</a></p>

<p>設定ファイル</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>node           : rabbit@example
home dir       : /var/lib/rabbitmq
config file(s) : /etc/rabbitmq/rabbitmq.config
</code></pre></div></div>

<p>ログファイル</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>node           : rabbit@example
home dir       : /var/lib/rabbitmq
config file(s) : /var/lib/rabbitmq/hare.config (not found)
</code></pre></div></div>

<p>うーむ、broker という単語も出てくるがよくわからない。<br>
トラブル・シューティングのページは無いものか。</p>

<p>「Introduction」 (RabbitMQ)<br>
<a href="https://www.rabbitmq.com/tutorials/tutorial-one-dotnet.html" class="autolink" rel="nofollow noopener" target="_blank">https://www.rabbitmq.com/tutorials/tutorial-one-dotnet.html</a></p>

<p>公式のサンプル・プログラムを見ると、わたしの知ってるサンプル・プログラムよりも難しいことをしている。</p>

<p>RabbitMQ.Client.dll というライブラリは サーバーの中にあるのだろうか。どうやって調べるんだろうか？</p>

<p>「特定のファイルが含まれるパッケージを探す」 (Qiita)<br>
<a href="http://qiita.com/Yuichirou/items/38165af29ab1e2d307f6" class="autolink" id="reference-1573067a763446120b3d">http://qiita.com/Yuichirou/items/38165af29ab1e2d307f6</a></p>

<p>じゃあ</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>apt-file search RabbitMQ.Client.dll
</code></pre></div></div>

<p>みたいな感じでいいんだろうか？</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>The program 'apt-file' is currently not installed. You can install it by typing:
apt install apt-file
</code></pre></div></div>

<p>じゃあまず、インストールから。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>apt install apt-file
～中略～
The system-wide cache is empty. You may want to run 'apt-file update'
as root to update the cache. You can also run 'apt-file update' as
normal user to use a cache in the user's home directory.
</code></pre></div></div>

<p>じゃあ次、アップデート。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>apt-file update
～中略～

File is up-to-date.
</code></pre></div></div>

<p>じゃあまた検索。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>apt-file search RabbitMQ.Client.dll
libmono-rabbitmq4.0-cil: /usr/lib/mono/4.5/RabbitMQ.Client.dll
libmono-rabbitmq4.0-cil: /usr/lib/mono/gac/RabbitMQ.Client/4.0.0.0__b03f5f7f11d50a3a/RabbitMQ.Client.dll
mono-dbg: /usr/lib/mono/gac/RabbitMQ.Client/4.0.0.0__b03f5f7f11d50a3a/RabbitMQ.Client.dll.mdb
mono-reference-assemblies-2.0: /usr/lib/mono/2.0/RabbitMQ.Client.dll
mono-reference-assemblies-4.0: /usr/lib/mono/4.0/RabbitMQ.Client.dll
</code></pre></div></div>

<p>ほうほう、RabbitMQ.Client.dll は入ってるぜ。</p>

<p>ファクトリーを作って、コネクションを確立して、チャンネルを開け、と書いてあるな。<br>
サンプル・プログラムを書いてみるか。</p>

<p>続く。</p>

<p>System.Messaging ネームスペースを使ってると RabbitQL は見えないようにしているんじゃないか。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>nano MsgQueue.cs
mcs /reference:System.Messaging.dll MsgQueue.cs
 ./MsgQueue.exe
選べだぜ☆（＾～＾）
1   : メッセージ箱 作成
2   : メッセージ   送信
3   : メッセージ   受信
4   : メッセージ箱 削除
quit: 終了

1
mq.BasePriority = 0

Unhandled Exception:
System.NotImplementedException: The method or operation is not implemented.
  at Mono.Messaging.RabbitMQ.RabbitMQMessageQueue.get_CanRead () &lt;0x408d0100 + 0x00017&gt; in &lt;filename unknown&gt;:0
  at System.Messaging.MessageQueue.get_CanRead () &lt;0x408d0090 + 0x00020&gt; in &lt;filename unknown&gt;:0
  at (wrapper remoting-invoke-with-check) System.Messaging.MessageQueue:get_CanRead ()
  at MsgQueue.Program.Main (System.String[] args) &lt;0x4089dd50 + 0x001ff&gt; in &lt;filename unknown&gt;:0
[ERROR] FATAL UNHANDLED EXCEPTION: System.NotImplementedException: The method or operation is not implemented.
  at Mono.Messaging.RabbitMQ.RabbitMQMessageQueue.get_CanRead () &lt;0x408d0100 + 0x00017&gt; in &lt;filename unknown&gt;:0
  at System.Messaging.MessageQueue.get_CanRead () &lt;0x408d0090 + 0x00020&gt; in &lt;filename unknown&gt;:0
  at (wrapper remoting-invoke-with-check) System.Messaging.MessageQueue:get_CanRead ()
  at MsgQueue.Program.Main (System.String[] args) &lt;0x4089dd50 + 0x001ff&gt; in &lt;filename unknown&gt;:0
</code></pre></div></div>

<p>ありゃ、CanRead プロパティー使えないのか。コンパイル通ってるのに、なんで使えないんだ？</p>

<p>Windows だと</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>mq.AccessMode = SendAndReceive
mq.Authenticate = False
mq.BasePriority = 0
mq.CanRead = True
mq.CanWrite = True
mq.Category = 00000000-0000-0000-0000-000000000000
mq.Container =
mq.CreateTime = 2017/03/06 18:13:13
mq.DefaultPropertiesToSend = System.Messaging.DefaultPropertiesToSend
mq.DenySharedReceive = False
mq.EncryptionRequired = Optional
mq.FormatName = DIRECT=OS:takahashi-pc\Private$\testqueue
mq.Formatter = System.Messaging.XmlMessageFormatter
mq.Id = 00000000-0000-0000-0000-000000000000
mq.Label =
mq.LastModifyTime = 2017/03/06 18:13:13
mq.MachineName = .
mq.MaximumJournalSize = 4294967295
mq.MaximumQueueSize = 4294967295
mq.MessageReadPropertyFilter = System.Messaging.MessagePropertyFilter
mq.MulticastAddress =
mq.Path = .\Private$\testqueue
mq.QueueName = Private$\testqueue
mq.ReadHandle = 1788
mq.Site =
mq.SynchronizingObject =
mq.Transactional = False
mq.UseJournalQueue = False
mq.WriteHandle = 1588
</code></pre></div></div>

<p>こんな感じでプロパティは読めるので、実装がないとしたら　実際　未実装なのか。<br>
インストールとかできないのか？</p>

<h1>
<span id="rabbitmq-を入手した方がいいのでは" class="fragment"></span><a href="#rabbitmq-%E3%82%92%E5%85%A5%E6%89%8B%E3%81%97%E3%81%9F%E6%96%B9%E3%81%8C%E3%81%84%E3%81%84%E3%81%AE%E3%81%A7%E3%81%AF"><i class="fa fa-link"></i></a>RabbitMQ を入手した方がいいのでは？</h1>

<p>System.Messaging を使ってるのが間違いなのか？</p>

<p>「How do I use RabbitMQ on Mono on Linux」 (stack overflow)<br>
<a href="http://stackoverflow.com/questions/28020761/how-do-i-use-rabbitmq-on-mono-on-linux" class="autolink" rel="nofollow noopener" target="_blank">http://stackoverflow.com/questions/28020761/how-do-i-use-rabbitmq-on-mono-on-linux</a></p>

<h1>
<span id="erlang-アーランをダウンロードしよう" class="fragment"></span><a href="#erlang-%E3%82%A2%E3%83%BC%E3%83%A9%E3%83%B3%E3%82%92%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89%E3%81%97%E3%82%88%E3%81%86"><i class="fa fa-link"></i></a>Erlang （アーラン）をダウンロードしよう</h1>

<p>RabbitMQをインストールする前に、Erlang をインストールしてくれって出てきた。</p>

<p>「DOWNLOAD OTP 19.2」 (ERLANG)<br>
<a href="http://www.erlang.org/downloads" class="autolink" rel="nofollow noopener" target="_blank">http://www.erlang.org/downloads</a></p>

<p>じゃあ、Windows 64bit 用バイナリをダウンロードするか。</p>

<p>えっ！　ダウンロードまで 2時間 1時間 2時間 40分……、なんだろう、どんな細い回線を通ってダウンロードされてくるんだろう。</p>

<p>自宅の回線が細くなったんじゃないか。その間に他の作業からやろう。</p>

<h1>
<span id="php-と-メッセージキューは通信できるのか" class="fragment"></span><a href="#php-%E3%81%A8-%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E3%82%AD%E3%83%A5%E3%83%BC%E3%81%AF%E9%80%9A%E4%BF%A1%E3%81%A7%E3%81%8D%E3%82%8B%E3%81%AE%E3%81%8B"><i class="fa fa-link"></i></a>PHP と メッセージ・キューは通信できるのか？</h1>

<h2>
<span id="メッセージキューには次のものがあるはずだ" class="fragment"></span><a href="#%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E3%82%AD%E3%83%A5%E3%83%BC%E3%81%AB%E3%81%AF%E6%AC%A1%E3%81%AE%E3%82%82%E3%81%AE%E3%81%8C%E3%81%82%E3%82%8B%E3%81%AF%E3%81%9A%E3%81%A0"><i class="fa fa-link"></i></a>メッセージ・キューには次のものがあるはずだ</h2>

<ul>
<li>キューの既存確認</li>
<li>キューの作成</li>
<li>キューへ送信</li>
<li>キューから受信</li>
<li>キューの削除</li>
</ul>

<p>PHP ではどれに当てはまるだろう？</p>

<ul>
<li>キューの作成または取得 msg_get_queue()</li>
<li>キューへ送信 msg_send()</li>
<li>キューから受信 msg_receive()</li>
<li>キューの削除 msg_remove_queue()</li>
<li>msg_set_queue() メッセージの設定</li>
<li>msg_stat_queue() メッセージの取得</li>
</ul>

<p>それぞれ調べてみよう。</p>

<p>「msg_get_queue」 (PHPマニュアル)<br>
<a href="http://php.net/manual/ja/function.msg-get-queue.php" class="autolink" rel="nofollow noopener" target="_blank">http://php.net/manual/ja/function.msg-get-queue.php</a></p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>$MSGKey = "123456" ; 

## Create or attach to a message queue
$seg = msg_get_queue($MSGKey) ;
</code></pre></div></div>

<p>メッセージのキーが数字というのはどういうことだろう。/Private$/testqueue みたいな文字列じゃないならどうやって C# と PHP で同じキューを見にいくんだろう。</p>

<p>「RabbitMQ + php-amqplib でメッセージキューイング試してみた」 (Qiita)<br>
<a href="http://qiita.com/imunew/items/d93917c0344f5ef1abce" class="autolink" id="reference-dddb80ef3d3f6f90e8f6">http://qiita.com/imunew/items/d93917c0344f5ef1abce</a></p>

<p>「新人プログラマに知ってもらいたいRabbitMQ初心者の入門の入門」 (Qiita)<br>
<a href="http://qiita.com/gambaray/items/3cc02b419c860a96bc94" class="autolink" id="reference-e9764a7208b3ddb452e0">http://qiita.com/gambaray/items/3cc02b419c860a96bc94</a></p>

<p>「RabbitMQ の導入」 (Qiita)<br>
<a href="http://qiita.com/taka1970/items/fa783304b7a71b7921e5" class="autolink" id="reference-dec40bbc1ff4bf3c208e">http://qiita.com/taka1970/items/fa783304b7a71b7921e5</a></p>

<h1>
<span id="linuxの環境変数" class="fragment"></span><a href="#linux%E3%81%AE%E7%92%B0%E5%A2%83%E5%A4%89%E6%95%B0"><i class="fa fa-link"></i></a>Linuxの環境変数？</h1>

<p>「System.Messaging」 (Mono)<br>
<a href="http://www.mono-project.com/archived/systemmessaging/" class="autolink" rel="nofollow noopener" target="_blank">http://www.mono-project.com/archived/systemmessaging/</a></p>

<p>Linux で System.Messaging を使おうと思ったら、環境変数を定義する必要があるんだろうか？</p>

<p>それとも Windowsの話しだろうか。</p>

<h1>
<span id="erlang-をダウンロードしたぞ" class="fragment"></span><a href="#erlang-%E3%82%92%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89%E3%81%97%E3%81%9F%E3%81%9E"><i class="fa fa-link"></i></a>ERLANG をダウンロードしたぞ</h1>

<p>Windows 上に RabbitMQ + ERLANG の環境を構築したい。ローカルテスト用に。<br>
ダウンロードしてきたERLANGの .exe を叩いてインストールした。次は RabbitMQ か。</p>

<p>RabbitMQ のインストールを進める。ファイアウォールに２回ブロックされてるが許可して進めた。</p>

<p>じゃあ C# で</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>using RabbitMQ.Client;
</code></pre></div></div>

<p>とか使えるようになったんだろうか？　調べてみよう。</p>

<p>そんな様子はどこにもなく。</p>

<h1>
<span id="rabbitmqclientdll-を探すか" class="fragment"></span><a href="#rabbitmqclientdll-%E3%82%92%E6%8E%A2%E3%81%99%E3%81%8B"><i class="fa fa-link"></i></a>RabbitMQ.Client.dll を探すか</h1>

<p>C:\Program Files\RabbitMQ Server フォルダーの中には無い。<br>
というか Unity が持っている。</p>

<p>正規的には、どこから入手するんだろうか。</p>

<p>「.NET/C# RabbitMQ client library」 (RabbitMQ)<br>
<a href="https://www.rabbitmq.com/dotnet.html" class="autolink" rel="nofollow noopener" target="_blank">https://www.rabbitmq.com/dotnet.html</a></p>

<h1>
<span id="nugetパッケージ" class="fragment"></span><a href="#nuget%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8"><i class="fa fa-link"></i></a>NuGetパッケージ</h1>

<p>NuGetパッケージを使ってインストールしてください、とあるが NuGetパッケージとは何か。</p>

<p>「RabbitMQ .NETクライアント 4.1.1」 (nuget)<br>
<a href="https://www.nuget.org/packages/RabbitMQ.Client" class="autolink" rel="nofollow noopener" target="_blank">https://www.nuget.org/packages/RabbitMQ.Client</a></p>

<h2>
<span id="パッケージマネージャコンソールって何だ" class="fragment"></span><a href="#%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%83%9E%E3%83%8D%E3%83%BC%E3%82%B8%E3%83%A3%E3%82%B3%E3%83%B3%E3%82%BD%E3%83%BC%E3%83%AB%E3%81%A3%E3%81%A6%E4%BD%95%E3%81%A0"><i class="fa fa-link"></i></a>パッケージマネージャコンソールって何だ？</h2>

<p>「パッケージマネージャコンソール」 (Microsoft)<br>
<a href="https://docs.microsoft.com/ja-jp/nuget/tools/package-manager-console" class="autolink" rel="nofollow noopener" target="_blank">https://docs.microsoft.com/ja-jp/nuget/tools/package-manager-console</a></p>

<p>Visual Studio 2015 を使っていて今まで気づかなかったが、<br>
メインメニューから [Tools] - [NuGet Package Manager] - [Package Manager Console] と進める。</p>

<p>すると　いつも　エラーとか検索結果が出ていたペインに Package Manager Console が出てきて入力を促している。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>PM&gt;
</code></pre></div></div>

<p>じゃあ、入力してみる。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>PM&gt; Install-Package RabbitMQ.Client -Version 4.1.1
Attempting to gather dependencies information for package 'RabbitMQ.Client.4.1.1' with respect to project 'UsagiMQ', targeting '.NETFramework,Version=v4.5.2'
Attempting to resolve dependencies for package 'RabbitMQ.Client.4.1.1' with DependencyBehavior 'Lowest'
Resolving actions to install package 'RabbitMQ.Client.4.1.1'
Resolved actions to install package 'RabbitMQ.Client.4.1.1'
Adding package 'RabbitMQ.Client.4.1.1' to folder 'C:\Users\Takahashi\Documents\muzudho\Shogi_Ubuntu\UsagiMQ\packages'
Added package 'RabbitMQ.Client.4.1.1' to folder 'C:\Users\Takahashi\Documents\muzudho\Shogi_Ubuntu\UsagiMQ\packages'
Added package 'RabbitMQ.Client.4.1.1' to 'packages.config'
Successfully installed 'RabbitMQ.Client 4.1.1' to UsagiMQ
</code></pre></div></div>

<p><strong>おーっ！</strong></p>

<p>じゃあ今どきは　ホームページからファイルをダウンロードするより、NuGet を使ってファイルをダウンロードした方がいいのか。</p>

<p>すると、C# 言語で</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>using RabbitMQ.Client;
</code></pre></div></div>

<p>と書いてもエラーにならなくなった。</p>

<h1>
<span id="rabbitmq-のサンプルプログラムを書いてみよう" class="fragment"></span><a href="#rabbitmq-%E3%81%AE%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0%E3%82%92%E6%9B%B8%E3%81%84%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86"><i class="fa fa-link"></i></a>RabbitMQ のサンプル・プログラムを書いてみよう。</h1>

<p>「Introduction」 (RabbitMQ)<br>
<a href="https://www.rabbitmq.com/tutorials/tutorial-one-dotnet.html" class="autolink" rel="nofollow noopener" target="_blank">https://www.rabbitmq.com/tutorials/tutorial-one-dotnet.html</a></p>

<p>サンプルプログラムをコピペ実行すると 文字のやりとりをやってるみたいなんだが、<br>
前回の記事みたいに「コンピューターの管理」からいける「メッセージ キュー」の中にはなんにも入ってないようで、送信と受信の２つがないと　ちゃんと　やりとりしてるのかテストできないんだな。</p>

<p>じゃあ、これ別に２つのプログラムにしなくても　１つのプログラムにまとめられそうなので、まとめてみるか。</p>

<p>長くなったが、これでいけた。</p>

<div class="code-frame" data-lang="C#"><div class="highlight"><pre><code><span class="k">using</span> <span class="nn">RabbitMQ.Client</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">RabbitMQ.Client.Events</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Text</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">UsagiMQ</span>
<span class="p">{</span>
    <span class="k">class</span> <span class="nc">Program</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="k">const</span> <span class="kt">string</span>
            <span class="n">HOST_NAME</span> <span class="p">=</span> <span class="s">"localhost"</span><span class="p">,</span>
            <span class="n">QUEUE_NAME</span> <span class="p">=</span> <span class="s">"hello"</span><span class="p">;</span>

        <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">for</span> <span class="p">(;;)</span>
            <span class="p">{</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">@"選べだぜ☆（＾～＾）
1   : メッセージ   送信
2   : メッセージ   受信
quit: 終了
"</span><span class="p">);</span>

                <span class="kt">int</span> <span class="n">category</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
                <span class="k">for</span> <span class="p">(;;)</span>
                <span class="p">{</span>
                    <span class="kt">string</span> <span class="n">line</span> <span class="p">=</span> <span class="n">Console</span><span class="p">.</span><span class="nf">ReadLine</span><span class="p">();</span>
                    <span class="k">switch</span> <span class="p">(</span><span class="n">line</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="k">case</span> <span class="s">"1"</span><span class="p">:</span> <span class="n">category</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span> <span class="k">goto</span> <span class="n">gt_EndLoop1</span><span class="p">;</span>
                        <span class="k">case</span> <span class="s">"2"</span><span class="p">:</span> <span class="n">category</span> <span class="p">=</span> <span class="m">2</span><span class="p">;</span> <span class="k">goto</span> <span class="n">gt_EndLoop1</span><span class="p">;</span>
                        <span class="k">case</span> <span class="s">"quit"</span><span class="p">:</span> <span class="k">goto</span> <span class="n">gt_Quit</span><span class="p">;</span>
                        <span class="k">default</span><span class="p">:</span> <span class="k">break</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
                <span class="n">gt_EndLoop1</span><span class="p">:</span>
                <span class="p">;</span>

                <span class="k">switch</span> <span class="p">(</span><span class="n">category</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="k">case</span> <span class="m">1</span><span class="p">:</span>
                        <span class="p">{</span>
                            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">@"メッセージを書いて[Enter]キーを押せだぜ☆（＾～＾）"</span><span class="p">);</span>
                            <span class="c1">// "Hello World!" などを入力</span>
                            <span class="kt">string</span> <span class="n">line</span> <span class="p">=</span> <span class="n">Console</span><span class="p">.</span><span class="nf">ReadLine</span><span class="p">();</span>
                            <span class="nf">Send</span><span class="p">(</span><span class="n">line</span><span class="p">);</span>
                        <span class="p">}</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="k">case</span> <span class="m">2</span><span class="p">:</span> <span class="nf">Receive</span><span class="p">();</span> <span class="k">break</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="n">gt_Quit</span><span class="p">:</span>
            <span class="p">;</span>
        <span class="p">}</span>

        <span class="k">static</span> <span class="k">void</span> <span class="nf">Send</span><span class="p">(</span><span class="kt">string</span> <span class="n">message</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">factory</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ConnectionFactory</span><span class="p">()</span> <span class="p">{</span> <span class="n">HostName</span> <span class="p">=</span> <span class="n">HOST_NAME</span> <span class="p">};</span>
            <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">connection</span> <span class="p">=</span> <span class="n">factory</span><span class="p">.</span><span class="nf">CreateConnection</span><span class="p">())</span>
            <span class="p">{</span>
                <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">channel</span> <span class="p">=</span> <span class="n">connection</span><span class="p">.</span><span class="nf">CreateModel</span><span class="p">())</span>
                <span class="p">{</span>
                    <span class="n">channel</span><span class="p">.</span><span class="nf">QueueDeclare</span><span class="p">(</span><span class="n">queue</span><span class="p">:</span> <span class="n">QUEUE_NAME</span><span class="p">,</span>
                                         <span class="n">durable</span><span class="p">:</span> <span class="k">false</span><span class="p">,</span>
                                         <span class="n">exclusive</span><span class="p">:</span> <span class="k">false</span><span class="p">,</span>
                                         <span class="n">autoDelete</span><span class="p">:</span> <span class="k">false</span><span class="p">,</span>
                                         <span class="n">arguments</span><span class="p">:</span> <span class="k">null</span><span class="p">);</span>

                    <span class="kt">var</span> <span class="n">body</span> <span class="p">=</span> <span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>

                    <span class="n">channel</span><span class="p">.</span><span class="nf">BasicPublish</span><span class="p">(</span><span class="n">exchange</span><span class="p">:</span> <span class="s">""</span><span class="p">,</span>
                                         <span class="n">routingKey</span><span class="p">:</span> <span class="n">QUEUE_NAME</span><span class="p">,</span>
                                         <span class="n">basicProperties</span><span class="p">:</span> <span class="k">null</span><span class="p">,</span>
                                         <span class="n">body</span><span class="p">:</span> <span class="n">body</span><span class="p">);</span>
                    <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">" Sent(^q^) {0}"</span><span class="p">,</span> <span class="n">message</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">" Press [enter] to menu."</span><span class="p">);</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">ReadLine</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">static</span> <span class="k">void</span> <span class="nf">Receive</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">factory</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ConnectionFactory</span><span class="p">()</span> <span class="p">{</span> <span class="n">HostName</span> <span class="p">=</span> <span class="n">HOST_NAME</span> <span class="p">};</span>
            <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">connection</span> <span class="p">=</span> <span class="n">factory</span><span class="p">.</span><span class="nf">CreateConnection</span><span class="p">())</span>
            <span class="p">{</span>
                <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">channel</span> <span class="p">=</span> <span class="n">connection</span><span class="p">.</span><span class="nf">CreateModel</span><span class="p">())</span>
                <span class="p">{</span>
                    <span class="n">channel</span><span class="p">.</span><span class="nf">QueueDeclare</span><span class="p">(</span><span class="n">queue</span><span class="p">:</span> <span class="n">QUEUE_NAME</span><span class="p">,</span>
                                         <span class="n">durable</span><span class="p">:</span> <span class="k">false</span><span class="p">,</span>
                                         <span class="n">exclusive</span><span class="p">:</span> <span class="k">false</span><span class="p">,</span>
                                         <span class="n">autoDelete</span><span class="p">:</span> <span class="k">false</span><span class="p">,</span>
                                         <span class="n">arguments</span><span class="p">:</span> <span class="k">null</span><span class="p">);</span>

                    <span class="kt">var</span> <span class="n">consumer</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">EventingBasicConsumer</span><span class="p">(</span><span class="n">channel</span><span class="p">);</span>
                    <span class="c1">// 受信できたときに割り込んでくる処理</span>
                    <span class="n">consumer</span><span class="p">.</span><span class="n">Received</span> <span class="p">+=</span> <span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">ea</span><span class="p">)</span> <span class="p">=&gt;</span>
                    <span class="p">{</span>
                        <span class="kt">var</span> <span class="n">body</span> <span class="p">=</span> <span class="n">ea</span><span class="p">.</span><span class="n">Body</span><span class="p">;</span>
                        <span class="kt">var</span> <span class="n">message</span> <span class="p">=</span> <span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">.</span><span class="nf">GetString</span><span class="p">(</span><span class="n">body</span><span class="p">);</span>
                        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">" [interrupt!] Received(^q^) {0}"</span><span class="p">,</span> <span class="n">message</span><span class="p">);</span>
                    <span class="p">};</span>
                    <span class="n">channel</span><span class="p">.</span><span class="nf">BasicConsume</span><span class="p">(</span><span class="n">queue</span><span class="p">:</span> <span class="n">QUEUE_NAME</span><span class="p">,</span>
                                         <span class="n">noAck</span><span class="p">:</span> <span class="k">true</span><span class="p">,</span>
                                         <span class="n">consumer</span><span class="p">:</span> <span class="n">consumer</span><span class="p">);</span>

                    <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">" Please, wait receiving... Or Press [enter] to menu."</span><span class="p">);</span>
                    <span class="n">Console</span><span class="p">.</span><span class="nf">ReadLine</span><span class="p">();</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>これ、Ubuntuでコンパイルできるんだろうか？　やってみよう。</p>

<p>じゃあ、前に書いたプログラムは捨てるぜ。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>rm MsgQueue.cs
nano MsgQueue.cs
</code></pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>mcs MsgQueue.cs
MsgQueue.cs(1,7): error CS0246: The type or namespace name `RabbitMQ' could not be found. Are you missing an assembly reference?
MsgQueue.cs(2,7): error CS0246: The type or namespace name `RabbitMQ' could not be found. Are you missing an assembly reference?
Compilation failed: 2 error(s), 0 warnings
</code></pre></div></div>

<p>じゃあ、こうか。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>mcs /reference:RabbitMQ.Client.dll MsgQueue.cs
mcs /reference:RabbitMQ.C             lient.dll MsgQueue.cs
MsgQueue.cs(63,29): error CS1501: No overload for method `QueueDeclare' takes `5             ' arguments
/usr/lib/mono/4.5/RabbitMQ.Client.dll (Location of the symbol related to previou             s error)
MsgQueue.cs(90,29): error CS1501: No overload for method `QueueDeclare' takes `5             ' arguments
/usr/lib/mono/4.5/RabbitMQ.Client.dll (Location of the symbol related to previou             s error)
MsgQueue.cs(96,36): error CS1729: The type `RabbitMQ.Client.Events.EventingBasic             Consumer' does not contain a constructor that takes `1' arguments
/usr/lib/mono/4.5/RabbitMQ.Client.dll (Location of the symbol related to previou             s error)
MsgQueue.cs(105,42): error CS1739: The best overloaded method match for `RabbitM             Q.Client.IModel.BasicConsume(string, System.Collections.IDictionary, RabbitMQ.Cl             ient.IBasicConsumer)' does not contain a parameter named `noAck'
/usr/lib/mono/4.5/RabbitMQ.Client.dll (Location of the symbol related to previou             s error)
MsgQueue.cs(104,29): error CS1502: The best overloaded method match for `RabbitM             Q.Client.IModel.BasicConsume(string, System.Collections.IDictionary, RabbitMQ.Cl             ient.IBasicConsumer)' has some invalid arguments
/usr/lib/mono/4.5/RabbitMQ.Client.dll (Location of the symbol related to previou             s error)
MsgQueue.cs(105,49): error CS1503: Argument `#2' cannot convert `bool' expressio             n to type `System.Collections.IDictionary'
Compilation failed: 6 error(s), 0 warnings
</code></pre></div></div>

<p>なんか RabbitMQ.Client.dll のバージョンとか古いという話しだろうか。</p>

<h1>
<span id="rabbitmqclientdll-のアップグレードの方法を調べてみよう" class="fragment"></span><a href="#rabbitmqclientdll-%E3%81%AE%E3%82%A2%E3%83%83%E3%83%97%E3%82%B0%E3%83%AC%E3%83%BC%E3%83%89%E3%81%AE%E6%96%B9%E6%B3%95%E3%82%92%E8%AA%BF%E3%81%B9%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86"><i class="fa fa-link"></i></a>RabbitMQ.Client.dll のアップグレードの方法を調べてみよう。</h1>

<p>「Installing on Debian / Ubuntu」 (RabbitMQ)<br>
<a href="https://www.rabbitmq.com/install-debian.html" class="autolink" rel="nofollow noopener" target="_blank">https://www.rabbitmq.com/install-debian.html</a></p>

<p>なんだか分からんが　書かれているコマンド打っていこう。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>echo 'deb http://www.rabbitmq.com/debian/ testing main' | sudo tee /etc/apt/sources.list.d/rabbitmq.list
deb http://www.rabbitmq.com/debian/ testing main
</code></pre></div></div>

<p>なんか URL のようなものが出てきた。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>sudo apt-get update
</code></pre></div></div>

<p>なんか動いたが、うまくいったのか、何も起こらなかったのか、エラーなのかなんなのか　わからん。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>sudo apt-get install rabbitmq-server
</code></pre></div></div>

<p>なんか進んで終わった。</p>

<p>なんか追加するらしい。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>gpg --keyserver pgpkeys.mit.edu --recv-key 7638D0442B90D010
</code></pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>gpg -a --export 7638D0442B90D010 | sudo apt-key add -
OK
</code></pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>echo 'deb http://ftp.debian.org/debian wheezy-backports main' | sudo tee /etc/apt/sources.list.d/wheezy_backports.list
deb http://ftp.debian.org/debian wheezy-backports main
</code></pre></div></div>

<p>まだなんか追加するらしい。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>wget -O- https://packages.erlang-solutions.com/debian/erlang_solutions.asc | sudo apt-key add -
OK
</code></pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>echo 'deb https://packages.erlang-solutions.com/debian wheezy contrib' | sudo tee /etc/apt/sources.list.d/esl.list
deb https://packages.erlang-solutions.com/debian wheezy contrib
</code></pre></div></div>

<p>アップグレードだ。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>sudo apt-get update
</code></pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>sudo apt-get install init-system-helpers socat esl-erlang
</code></pre></div></div>

<p>なんかいっぱいインストールされた。次は RabbitMQ の何か。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>wget -O- https://www.rabbitmq.com/rabbitmq-release-signing-key.asc | sudo apt-key add -
OK
</code></pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>echo 'deb http://www.rabbitmq.com/debian/ testing main' | sudo tee /etc/apt/sources.list.d/rabbitmq.list
deb http://www.rabbitmq.com/debian/ testing main
</code></pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>sudo apt-get update
</code></pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>sudo apt-get install rabbitmq-server
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
</code></pre></div></div>

<p>これでいいのだろうか？</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>mcs /reference:RabbitMQ.Client.dll MsgQueue.cs
MsgQueue.cs(63,29): error CS1501: No overload for method `QueueDeclare' takes `5' arguments
/usr/lib/mono/4.5/RabbitMQ.Client.dll (Location of the symbol related to previous error)
MsgQueue.cs(90,29): error CS1501: No overload for method `QueueDeclare' takes `5' arguments
/usr/lib/mono/4.5/RabbitMQ.Client.dll (Location of the symbol related to previous error)
MsgQueue.cs(96,36): error CS1729: The type `RabbitMQ.Client.Events.EventingBasicConsumer' does not contain a constructor that takes `1' arguments
/usr/lib/mono/4.5/RabbitMQ.Client.dll (Location of the symbol related to previous error)
MsgQueue.cs(105,42): error CS1739: The best overloaded method match for `RabbitMQ.Client.IModel.BasicConsume(string, System.Collections.IDictionary, RabbitMQ.Client.IBasicConsumer)' does not contain a parameter named `noAck'
/usr/lib/mono/4.5/RabbitMQ.Client.dll (Location of the symbol related to previous error)
MsgQueue.cs(104,29): error CS1502: The best overloaded method match for `RabbitMQ.Client.IModel.BasicConsume(string, System.Collections.IDictionary, RabbitMQ.Client.IBasicConsumer)' has some invalid arguments
/usr/lib/mono/4.5/RabbitMQ.Client.dll (Location of the symbol related to previous error)
MsgQueue.cs(105,49): error CS1503: Argument `#2' cannot convert `bool' expression to type `System.Collections.IDictionary'
Compilation failed: 6 error(s), 0 warnings
</code></pre></div></div>

<p>うーん、引数が5個のQueueDeclareメソッドが無いとか、何だ。</p>

<h1>
<span id="サンプルプログラムでは引数が５個" class="fragment"></span><a href="#%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0%E3%81%A7%E3%81%AF%E5%BC%95%E6%95%B0%E3%81%8C%EF%BC%95%E5%80%8B"><i class="fa fa-link"></i></a>サンプル・プログラムでは引数が５個</h1>

<p>「Error: “No OverLoad For Method 'ExecuteInsert' takes '5' argument” [closed]」 (stack overflow)<br>
<a href="http://stackoverflow.com/questions/14638880/error-no-overload-for-method-executeinsert-takes-5-argument" class="autolink" rel="nofollow noopener" target="_blank">http://stackoverflow.com/questions/14638880/error-no-overload-for-method-executeinsert-takes-5-argument</a></p>

<p>じゃあ、Windows 10 では問題なく動くサンプル・プログラムのここがダメなのか？</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>                    channel.QueueDeclare(queue: QUEUE_NAME,
                                         durable: false,
                                         exclusive: false,
                                         autoDelete: false,
                                         arguments: null);
</code></pre></div></div>

<p>じゃあ　どうすればいいのか……。<br>
エラーの別の部分も見てみよう。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>RabbitMQ.Client.dll (Location of the symbol related to previous error)
</code></pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>mono -V
Mono JIT compiler version 4.2.1 (Debian 4.2.1.102+dfsg2-7ubuntu4)
Copyright (C) 2002-2014 Novell, Inc, Xamarin Inc and Contributors. www.mono-project.com
        TLS:           __thread
        SIGSEGV:       altstack
        Notifications: epoll
        Architecture:  amd64
        Disabled:      none
        Misc:          softdebug
        LLVM:          supported, not enabled.
        GC:            sgen
</code></pre></div></div>

<h1>
<span id="ubuntu-で-nuget-って使えるの" class="fragment"></span><a href="#ubuntu-%E3%81%A7-nuget-%E3%81%A3%E3%81%A6%E4%BD%BF%E3%81%88%E3%82%8B%E3%81%AE"><i class="fa fa-link"></i></a>Ubuntu で NuGet って使えるの？</h1>

<p>「Introduction」 (RabbitMQ)<br>
<a href="https://www.rabbitmq.com/tutorials/tutorial-one-dotnet.html" class="autolink" rel="nofollow noopener" target="_blank">https://www.rabbitmq.com/tutorials/tutorial-one-dotnet.html</a></p>

<p>C#コンパイラには mcs を使っていたが、csc の方がいいんだろうか？</p>

<p>「mcsの最新情報と今後の展望について」 (ものがたり)<br>
<a href="http://atsushieno.hatenablog.com/entry/2014/12/11/000240" class="autolink" rel="nofollow noopener" target="_blank">http://atsushieno.hatenablog.com/entry/2014/12/11/000240</a></p>

<p>csc がマイクロソフトのC#コンパイラで、<br>
mcs がmono のC#コンパイラだろうか。</p>

<p>Ubuntuにcsc を入れれるだろうか。</p>

<p>「UbuntuServerに、Mono環境を構築する」 (Qiita)<br>
<a href="http://qiita.com/takanemu/items/52888d324df3d367d4c1" class="autolink" id="reference-5375a86195bed971c441">http://qiita.com/takanemu/items/52888d324df3d367d4c1</a></p>

<p>mono-csc というコマンドがあるんだろうか？</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>mono-csc /r:"RabbitMQ.Client.dll" MsgQueue.cs
MsgQueue.cs(61,21): error CS1501: No overload for method `QueueDeclare' takes `5' arguments
/usr/lib/mono/4.5/RabbitMQ.Client.dll (Location of the symbol related to previous error)
MsgQueue.cs(76,21): error CS1501: No overload for method `QueueDeclare' takes `5' arguments
/usr/lib/mono/4.5/RabbitMQ.Client.dll (Location of the symbol related to previous error)
MsgQueue.cs(78,46): error CS1729: The type `RabbitMQ.Client.Events.EventingBasicConsumer' does not contain a constructor that takes `1' arguments
/usr/lib/mono/4.5/RabbitMQ.Client.dll (Location of the symbol related to previous error)
MsgQueue.cs(86,21): error CS1502: The best overloaded method match for `RabbitMQ.Client.IModel.BasicConsume(string, System.Collections.IDictionary, RabbitMQ.Client.IBasicConsumer)' has some invalid arguments
/usr/lib/mono/4.5/RabbitMQ.Client.dll (Location of the symbol related to previous error)
MsgQueue.cs(86,46): error CS1503: Argument `#2' cannot convert `bool' expression to type `System.Collections.IDictionary'
Compilation failed: 5 error(s), 0 warnings
</code></pre></div></div>

<p>あるようだがエラーだ。 QueueDeclare の仕様はどうなっているのか？</p>

<p>「QueueDeclare(String,Boolean,Boolean,Boolean,Boolean,Boolean,IDictionary) Method」 (<a href="http://docs.spring.io" class="autolink" rel="nofollow noopener" target="_blank">http://docs.spring.io</a>)<br>
<a href="http://docs.spring.io/spring-amqp-net/docs/1.0.x/api/html/Spring.Messaging.Amqp.Rabbit~Spring.Messaging.Amqp.Rabbit.Connection.CachedModel~QueueDeclare(String,Boolean,Boolean,Boolean,Boolean,Boolean,IDictionary).html" class="autolink" rel="nofollow noopener" target="_blank">http://docs.spring.io/spring-amqp-net/docs/1.0.x/api/html/Spring.Messaging.Amqp.Rabbit~Spring.Messaging.Amqp.Rabbit.Connection.CachedModel~QueueDeclare(String,Boolean,Boolean,Boolean,Boolean,Boolean,IDictionary).html</a></p>

<p>Ubuntuの RabbitMQ が古いバージョンなんだろうか。さっきアップグレードしたと思うんだが。</p>

<h1>
<span id="rabbitmq-の停止と起動" class="fragment"></span><a href="#rabbitmq-%E3%81%AE%E5%81%9C%E6%AD%A2%E3%81%A8%E8%B5%B7%E5%8B%95"><i class="fa fa-link"></i></a>RabbitMQ の停止と起動</h1>

<p>「RabbitMQを試してみる」 (shinodogg.com)<br>
<a href="https://shinodogg.com/?p=4641" class="autolink" rel="nofollow noopener" target="_blank">https://shinodogg.com/?p=4641</a></p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>rabbitmqctl stop
Stopping and halting node 'rabbit@tk2-217-18401' ...
Error: unable to connect to node ～以下略～
</code></pre></div></div>

<p>停止しようとしたらエラーが出た。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code> rabbitmq-server

              RabbitMQ 3.6.6. Copyright (C) 2007-2016 Pivotal Software, Inc.
  ##  ##      Licensed under the MPL.  See http://www.rabbitmq.com/
  ##  ##
  ##########  Logs: /var/log/rabbitmq/～略～
  ######  ##        /var/log/rabbitmq/～略～
  ##########
              Starting broker...
 completed with 0 plugins.
</code></pre></div></div>

<p>起動はうまくいったんだろうか？</p>

<p>[Ctrl]+[Z] で止めて</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>[1]+  Stopped                 rabbitmq-server
</code></pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>bg 1
[1]+ rabbitmq-server &amp;
</code></pre></div></div>

<p>して、</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>mcs /r:"RabbitMQ.Client.dll" MsgQueue.cs
MsgQueue.cs(61,21): error CS1501: No overload for method `QueueDeclare' takes `5' arguments
/usr/lib/mono/4.5/RabbitMQ.Client.dll (Location of the symbol related to previous error)
MsgQueue.cs(76,21): error CS1501: No overload for method `QueueDeclare' takes `5' arguments
/usr/lib/mono/4.5/RabbitMQ.Client.dll (Location of the symbol related to previous error)
MsgQueue.cs(78,46): error CS1729: The type `RabbitMQ.Client.Events.EventingBasicConsumer' does not contain a constructor that takes `1' arguments
/usr/lib/mono/4.5/RabbitMQ.Client.dll (Location of the symbol related to previous error)
MsgQueue.cs(86,21): error CS1502: The best overloaded method match for `RabbitMQ.Client.IModel.BasicConsume(string, System.Collections.IDictionary, RabbitMQ.Client.IBasicConsumer)' has some invalid arguments
/usr/lib/mono/4.5/RabbitMQ.Client.dll (Location of the symbol related to previous error)
MsgQueue.cs(86,46): error CS1503: Argument `#2' cannot convert `bool' expression to type `System.Collections.IDictionary'
Compilation failed: 5 error(s), 0 warnings
</code></pre></div></div>

<p>関係無いのか。</p>

<p>「[RabbitMQ]RabbitMQをUbuntuにインストールしてサンプルと管理画面を動かしてみる」 (ズッキーニのプログラミング実験場)<br>
<a href="http://zuqqhi2.com/install-rabbitmq" class="autolink" rel="nofollow noopener" target="_blank">http://zuqqhi2.com/install-rabbitmq</a></p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>sudo /etc/init.d/rabbitmq-server status
● rabbitmq-server.service - RabbitMQ broker
   Loaded: loaded (/lib/systemd/system/rabbitmq-server.service; enabled; vendor preset: enabled)
   Active: inactive (dead) since Mon 2017-03-06 21:27:42 JST; 1h 16min ago
 Main PID: 23830 (code=killed, signal=TERM)
   Status: "Exited."

Mar 06 21:20:39 tk2-217-18401 rabbitmq-server[23830]:   ######  ##        /var/log/rabbitmq/★～略～.log
Mar 06 21:20:39 tk2-217-18401 rabbitmq-server[23830]:   ##########
Mar 06 21:20:39 tk2-217-18401 rabbitmq-server[23830]:               Starting broker...
Mar 06 21:20:41 tk2-217-18401 rabbitmq-server[23830]: systemd unit for activation check: "rabbitmq-server.service"
Mar 06 21:20:41 tk2-217-18401 systemd[1]: Started RabbitMQ broker.
Mar 06 21:20:42 tk2-217-18401 rabbitmq-server[23830]:  completed with 0 plugins.
Mar 06 21:27:40 tk2-217-18401 systemd[1]: Stopping RabbitMQ broker...
Mar 06 21:27:42 tk2-217-18401 rabbitmqctl[24821]: Stopping and halting node 'rabbit@★～略～' ...
Mar 06 21:27:42 tk2-217-18401 rabbitmq-server[23830]: Gracefully halting Erlang VM
Mar 06 21:27:42 tk2-217-18401 systemd[1]: Stopped RabbitMQ broker.
</code></pre></div></div>

<p>さっぱりわからん。</p>

<p>「Vagrant上のUbuntuにRabbitMQをたててMQTTをお試し」 (braitom's Tech Memo)<br>
<a href="http://braitom.hatenablog.com/entry/2015/05/16/004515" class="autolink" rel="nofollow noopener" target="_blank">http://braitom.hatenablog.com/entry/2015/05/16/004515</a></p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>sudo /etc/init.d/rabbitmq-server restart
[....] Restarting rabbitmq-server (via systemctl): rabbitmq-server.serviceGracefully halting Erlang VM
Job for rabbitmq-server.service failed because the control process exited with error code. See "systemctl status rabbitmq-server.service" and "journalctl -xe" for details.
 failed!
</code></pre></div></div>

<p>これもよくわからんがエラー。</p>

<h1>
<span id="プロセス間通信以外の方法があるだろうか" class="fragment"></span><a href="#%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E9%96%93%E9%80%9A%E4%BF%A1%E4%BB%A5%E5%A4%96%E3%81%AE%E6%96%B9%E6%B3%95%E3%81%8C%E3%81%82%E3%82%8B%E3%81%A0%E3%82%8D%E3%81%86%E3%81%8B"><i class="fa fa-link"></i></a>プロセス間通信以外の方法があるだろうか？</h1>

<p>接続の確立だけやろうとしたら</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>System.Net.Sockets.SocketException: Connection refused
</code></pre></div></div>

<p>だし、</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>sudo rabbitmq-server
</code></pre></div></div>

<p>を打ち込むと止まってしまう。ただ、[Ctrl]+[Z] から</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>bg 1
</code></pre></div></div>

<p>として再度</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>./MsgQueue.exe
</code></pre></div></div>

<p>とすると、接続の確立まではいけるようだ。</p>

<h1>
<span id="じゃあ-queuedeclare-の引数はいくつだったらいいのか" class="fragment"></span><a href="#%E3%81%98%E3%82%83%E3%81%82-queuedeclare-%E3%81%AE%E5%BC%95%E6%95%B0%E3%81%AF%E3%81%84%E3%81%8F%E3%81%A4%E3%81%A0%E3%81%A3%E3%81%9F%E3%82%89%E3%81%84%E3%81%84%E3%81%AE%E3%81%8B"><i class="fa fa-link"></i></a>じゃあ、 QueueDeclare の引数はいくつだったらいいのか？</h1>

<p>別の解法を探す時間と、わたしのバグ探し能力で押し通すのとどっちが速いだろうか。<br>
じゃあ 試しに 7個の引数でやってみよう。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>root@tk2-217-18401:/home/csg10/shogi/ukamuse_sdt4/bin# nano MsgQueue.cs
root@tk2-217-18401:/home/csg10/shogi/ukamuse_sdt4/bin# mcs /r:"RabbitMQ.Client.dll" MsgQueue.cs
MsgQueue.cs(64,21): error CS1502: The best overloaded method match for `RabbitMQ.Client.IModel.QueueDeclare(string, bool, bool, bool, bool, bool, System.Collections.IDictionary)' has some invalid arguments
/usr/lib/mono/4.5/RabbitMQ.Client.dll (Location of the symbol related to previous error)
MsgQueue.cs(64,67): error CS1503: Argument `#5' cannot convert `null' expression to type `bool'
Compilation failed: 2 error(s), 0 warnings
</code></pre></div></div>

<p>関数のプロトタイプがでてきてくれた。引数は、</p>

<ul>
<li>string</li>
<li>bool</li>
<li>bool</li>
<li>bool</li>
<li>bool</li>
<li>bool</li>
<li>System.Collections.IDictionary</li>
</ul>

<p>のようだ。これは　いつのバージョンの QueueDeclare なんだろうか？</p>

<p>ネット上に落ちている Spring.Messaging.Amqp.Rabbit では、</p>

<p>「QueueDeclare(String,Boolean,Boolean,Boolean,Boolean,Boolean,IDictionary) Method」 (<a href="http://docs.spring.io" class="autolink" rel="nofollow noopener" target="_blank">http://docs.spring.io</a>)<br>
<a href="http://docs.spring.io/spring-amqp-net/docs/1.0.x/api/html/Spring.Messaging.Amqp.Rabbit~Spring.Messaging.Amqp.Rabbit.Connection.CachedModel~QueueDeclare(String,Boolean,Boolean,Boolean,Boolean,Boolean,IDictionary).html" class="autolink" rel="nofollow noopener" target="_blank">http://docs.spring.io/spring-amqp-net/docs/1.0.x/api/html/Spring.Messaging.Amqp.Rabbit~Spring.Messaging.Amqp.Rabbit.Connection.CachedModel~QueueDeclare(String,Boolean,Boolean,Boolean,Boolean,Boolean,IDictionary).html</a></p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>public string QueueDeclare( 
   string queue,
   bool passive,
   bool durable,
   bool exclusive,
   bool autoDelete,
   bool nowait,
   IDictionary arguments
)
</code></pre></div></div>

<p>で、RabbitMQ では</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>channel.QueueDeclare(queue: "hello",
                                 durable: false,
                                 exclusive: false,
                                 autoDelete: false,
                                 arguments: null);
</code></pre></div></div>

<p>なので、どういうことなのか。第2引数 passive と 第6引数 nowait に適当に false でも入れておけばいいのか？</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>nano MsgQueue.cs
mcs /r:"RabbitMQ.Client.dll" MsgQueue.cs
</code></pre></div></div>

<p>引数７つにしたら　コンパイルは通った。<br>
引数の数が異なるメソッドはまだある。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>EventingBasicConsumer consumer = new EventingBasicConsumer(channel);
</code></pre></div></div>

<p>このコンストラクタ。引数が１つではないらしいのだ。じゃあ null でも追加して引数を２つにしてみる。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>mcs /r:"RabbitMQ.Client.dll" MsgQueue.cs
MsgQueue.cs(87,45): error CS1729: The type `RabbitMQ.Client.Events.EventingBasicConsumer' does not contain a constructor that takes `2' arguments
/usr/lib/mono/4.5/RabbitMQ.Client.dll (Location of the symbol related to previous error)
Compilation failed: 1 error(s), 0 warnings
</code></pre></div></div>

<p>まずは　引数の数を当てないと　関数のプロトタイプは表示されないのか。<br>
じゃあ　自然数のように伸びていこう。</p>

<p>引数の数が 0 の場合</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code> mcs /r:"RabbitMQ.Client.dll" MsgQueue.cs
MsgQueue.cs(87,34): warning CS0219: The variable `consumer' is assigned but its value is never used
Compilation succeeded - 1 warning(s)
</code></pre></div></div>

<p>いけるのか。</p>

<p>古いドキュメントを見ると。</p>

<p>「public class EventingBasicConsumer」 (<a href="http://www.rabbitmq.com" rel="nofollow noopener" target="_blank">www.rabbitmq.com</a>)<br>
<a href="https://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v1.4.0/rabbitmq-dotnet-client-1.4.0-net-2.0-htmldoc/type-RabbitMQ.Client.Events.EventingBasicConsumer.html" class="autolink" rel="nofollow noopener" target="_blank">https://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v1.4.0/rabbitmq-dotnet-client-1.4.0-net-2.0-htmldoc/type-RabbitMQ.Client.Events.EventingBasicConsumer.html</a></p>

<p>コンストラクターの引数は 0 個だが、じゃあチャンネルはどうやって渡すのか？</p>

<p>とりあえず先に進む。 UbuntuのRabbitMQ は v1.4 なのだろうか？</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>mcs /r:"RabbitMQ.Client.dll" MsgQueue.cs
MsgQueue.cs(97,21): error CS1502: The best overloaded method match for `RabbitMQ.Client.IModel.BasicConsume(string, System.Collections.IDictionary, RabbitMQ.Client.IBasicConsumer)' has some invalid arguments
/usr/lib/mono/4.5/RabbitMQ.Client.dll (Location of the symbol related to previous error)
MsgQueue.cs(97,46): error CS1503: Argument `#2' cannot convert `bool' expression to type `System.Collections.IDictionary'
Compilation failed: 2 error(s), 0 warnings
</code></pre></div></div>

<p>BasicConsume メソッドの引数がおかしいらしい。</p>

<p>v1.4では、IModelのBasicConsume はいくつか種類がある。</p>

<p>「BasicConsume」 (<a href="http://www.rabbitmq.com" rel="nofollow noopener" target="_blank">www.rabbitmq.com</a>)<br>
<a href="https://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v1.4.0/rabbitmq-dotnet-client-1.4.0-net-2.0-htmldoc/type-RabbitMQ.Client.IModel.html#method-M:RabbitMQ.Client.IModel.BasicConsume(System.UInt16,System.String,System.Boolean,System.Collections.IDictionary,RabbitMQ.Client.IBasicConsumer)" class="autolink" rel="nofollow noopener" target="_blank">https://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v1.4.0/rabbitmq-dotnet-client-1.4.0-net-2.0-htmldoc/type-RabbitMQ.Client.IModel.html#method-M:RabbitMQ.Client.IModel.BasicConsume(System.UInt16,System.String,System.Boolean,System.Collections.IDictionary,RabbitMQ.Client.IBasicConsumer)</a></p>

<p>RabbitMQ では</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>channel.BasicConsume(queue: "hello",
                                 noAck: true,
                                 consumer: consumer);
</code></pre></div></div>

<p>だが、v1.4では</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>string BasicConsume(ushort ticket, string queue, bool noAck, IDictionary filter, IBasicConsumer consumer)
</code></pre></div></div>

<p>この形が近いだろうか。そこで 第1引数には 0 でも、第4引数には null でも入れておく。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>mcs /r:"RabbitMQ.Client.dll" MsgQueue.cs
MsgQueue.cs(99,21): error CS1502: The best overloaded method match for `RabbitMQ.Client.IModel.BasicConsume(string, bool, string, System.Collections.IDictionary, RabbitMQ.Client.IBasicConsumer)' has some invalid arguments
/usr/lib/mono/4.5/RabbitMQ.Client.dll (Location of the symbol related to previous error)
MsgQueue.cs(99,35): error CS1503: Argument `#1' cannot convert `int' expression to type `string'
Compilation failed: 2 error(s), 0 warnings
</code></pre></div></div>

<p>思ってたのと違うようだ。<br>
- string<br>
- bool<br>
- string<br>
- System.Collections.IDictionary<br>
- RabbitMQ.Client.IBasicConsumer</p>

<p>これはなんだろうか。並びが似ているのはこれだ。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>string BasicConsume(ushort ticket, string queue, bool noAck, string consumerTag, IDictionary filter, IBasicConsumer consumer)
</code></pre></div></div>

<p>最初の ticket が無いとすれば、consumerTag に空文字列、filter に null でも入れておけばいいだろうか？</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>mcs /r:"RabbitMQ.Client.dll" MsgQueue.cs
</code></pre></div></div>

<p>ひとまず、コンパイラは通った。</p>

<h1>
<span id="実行してみよう" class="fragment"></span><a href="#%E5%AE%9F%E8%A1%8C%E3%81%97%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86"><i class="fa fa-link"></i></a>実行してみよう</h1>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>./MsgQueue.exe
選べだぜ☆（＾～＾）
1   : メッセージ   送信
2   : メッセージ   受信
quit: 終了

1
メッセージを書いて[Enter]キーを押せだぜ☆（＾～＾）
AlphaBeta
 Sent(^q^) AlphaBeta
 Press [enter] to menu.

選べだぜ☆（＾～＾）
1   : メッセージ   送信
2   : メッセージ   受信
quit: 終了

2
 Please, wait receiving... Or Press [enter] to menu.
 [interrupt!] Received(^q^) AlphaBeta

選べだぜ☆（＾～＾）
1   : メッセージ   送信
2   : メッセージ   受信
quit: 終了

quit
</code></pre></div></div>

<p>動いたようだ。最後の quit でループを抜けれないのは　なんでか分からないが……。<br>
このときバックグラウンドでは</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>jobs
[1]+  Running                 sudo rabbitmq-server &amp;
</code></pre></div></div>

<p>sudo rabbitmq-server &amp;<br>
が動いていた。関係あるだろうか。</p>

<p>じゃあ、<strong>Ubuntu に入っている RabbitMQ は v1.4 に似てちょっと違う何か</strong> ということが分かった。<br>
なぜサイトで公開されている最新版と一致しないのか？</p>

<p>「Verify version of rabbitmq」 (stack overflow)<br>
<a href="http://stackoverflow.com/questions/7593269/verify-version-of-rabbitmq" class="autolink" rel="nofollow noopener" target="_blank">http://stackoverflow.com/questions/7593269/verify-version-of-rabbitmq</a></p>

<p>RabbitMQ のバージョンを確認してみよう。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>sudo rabbitmqctl status
</code></pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>Status of node 'rabbit@★～略～' ...
[{pid,28875},
 {running_applications,[{rabbit,"RabbitMQ","3.6.6"},
                        {os_mon,"CPO  CXC 138 46","2.4.1"},
                        {ranch,"Socket acceptor pool for TCP protocols.",
                               "1.2.1"},
                        {rabbit_common,[],"3.6.6"},
                        {xmerl,"XML parser","1.3.12"},
                        {mnesia,"MNESIA  CXC 138 12","4.14.1"},
                        {sasl,"SASL  CXC 138 11","3.0.1"},
                        {stdlib,"ERTS  CXC 138 10","3.1"},
                        {kernel,"ERTS  CXC 138 10","5.1"}]},
 {os,{unix,linux}},
 {erlang_version,"Erlang/OTP 19 [erts-8.1] [source-e7be63d] [64-bit] [smp:2:2] [async-threads:64] [hipe] [kernel-poll:true]\n"},
 {memory,[{total,40106344},
          {connection_readers,0},
          {connection_writers,0},
          {connection_channels,0},
          {connection_other,0},
          {queue_procs,14920},
          {queue_slave_procs,0},
          {plugins,0},
          {other_proc,13396952},
          {mnesia,62008},
          {mgmt_db,0},
          {msg_index,49040},
          {other_ets,959976},
          {binary,12296},
          {code,17800225},
          {atom,752561},
          {other_system,7058366}]},
 {alarms,[]},
 {listeners,[{clustering,25672,"::"},{amqp,5672,"::"}]},
 {vm_memory_high_watermark,0.4},
 {vm_memory_limit,416869580},
 {disk_free_limit,50000000},
 {disk_free,19432972288},
 {file_descriptors,[{total_limit,924},
                    {total_used,2},
                    {sockets_limit,829},
                    {sockets_used,0}]},
 {processes,[{limit,1048576},{used,141}]},
 {run_queue,0},
 {uptime,3036},
 {kernel,{net_ticktime,60}}]
</code></pre></div></div>

<p>3.6.6 のようだ。サイトで公開されているRabbitMQのバージョンはいくつだろうか？</p>

<p>「Downloading and Installing RabbitMQ」 (RabbitMQ)<br>
<a href="https://www.rabbitmq.com/download.html" class="autolink" rel="nofollow noopener" target="_blank">https://www.rabbitmq.com/download.html</a></p>

<p>3.6.6 のようだ。<strong>うん～～～～？？</strong></p>

<p>とりあえずソースコードを再掲しておく。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>using RabbitMQ.Client;
using RabbitMQ.Client.Events;
using System;
using System.Text;

namespace UsagiMQ
{
    /// &lt;summary&gt;
    /// 参照 : 「QueueDeclare」 http://docs.spring.io/spring-amqp-net/docs/1.0.x/api/html/Spring.Messaging.Amqp.Rabbit~Spring.Messaging.Amqp.Rabbit.Connection.CachedModel~QueueDeclare(String,Boolean,Boolean,Boolean,Boolean,Boolean,IDictionary).html
    /// 参照 : 「EventingBasicConsumer」 https://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v1.4.0/rabbitmq-dotnet-client-1.4.0-net-2.0-htmldoc/type-RabbitMQ.Client.Events.EventingBasicConsumer.html
    /// 参照 : 「BasicConsume」 https://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v1.4.0/rabbitmq-dotnet-client-1.4.0-net-2.0-htmldoc/type-RabbitMQ.Client.IModel.html#method-M:RabbitMQ.Client.IModel.BasicConsume(System.UInt16,System.String,System.Boolean,System.Collections.IDictionary,RabbitMQ.Client.IBasicConsumer)
    /// &lt;/summary&gt;
    class Program
    {
        public const string
            HOST_NAME = "localhost",
            QUEUE_NAME = "hello";

        static void Main(string[] args)
        {
            for (;;)
            {
                Console.WriteLine(@"選べだぜ☆（＾～＾）
1   : メッセージ   送信
2   : メッセージ   受信
quit: 終了
");

                int category = 0;
                for (;;)
                {
                    string line = Console.ReadLine();
                    switch (line)
                    {
                        case "1": category = 1; goto gt_EndLoop1;
                        case "2": category = 2; goto gt_EndLoop1;
                        case "quit": goto gt_Quit;
                        default: break;
                    }
                }
                gt_EndLoop1:
                ;

                switch (category)
                {
                    case 1:
                        {
                            Console.WriteLine(@"メッセージを書いて[Enter]キーを押せだぜ☆（＾～＾）");
                            // "Hello World!" などを入力
                            string line = Console.ReadLine();
                            Send(line);
                        }
                        break;
                    case 2: Receive(); break;
                }
            }
            gt_Quit:
            ;
        }

        static void Send(string message)
        {
            ConnectionFactory factory = new ConnectionFactory() { HostName = HOST_NAME };
            IConnection connection = factory.CreateConnection();
            IModel channel = connection.CreateModel();

            channel.QueueDeclare(QUEUE_NAME, false, false, false, null);
            // Ubuntuでは何故か Spring.Messaging.Amqp.Rabbit の引数 7 つのやつになっている。
            // channel.QueueDeclare(QUEUE_NAME, false, false, false, false, false, null);

            byte[] body = Encoding.UTF8.GetBytes(message);

            channel.BasicPublish("", QUEUE_NAME, null, body);
            Console.WriteLine(" Sent(^q^) {0}", message);
            Console.WriteLine(" Press [enter] to menu.");
            Console.ReadLine();
        }

        static void Receive()
        {
            ConnectionFactory factory = new ConnectionFactory() { HostName = HOST_NAME };
            IConnection connection = factory.CreateConnection();
            IModel channel = connection.CreateModel();

            channel.QueueDeclare(QUEUE_NAME, false, false, false, null);
            // Ubuntuでは何故か Spring.Messaging.Amqp.Rabbit の引数 7 つのやつになっている。
            // channel.QueueDeclare(QUEUE_NAME, false, false, false, false, false, null);

            EventingBasicConsumer consumer = new EventingBasicConsumer(channel);
            // Ubuntuでは何故か v1.4.0 の引数が 0 個のやつになっている。
            //EventingBasicConsumer consumer = new EventingBasicConsumer();

            // 受信できたときに割り込んでくる処理
            consumer.Received += (model, ea) =&gt;
            {
                byte[] body = ea.Body;
                string message = Encoding.UTF8.GetString(body);
                Console.WriteLine(" [interrupt!] Received(^q^) {0}", message);
            };
            channel.BasicConsume(QUEUE_NAME, true, consumer);
            // Ubuntuでは何故か引数が 5 個のやつになっている。
            // channel.BasicConsume( QUEUE_NAME, true, "", null, consumer);

            Console.WriteLine(" Please, wait receiving... Or Press [enter] to menu.");
            Console.ReadLine();
        }

    }
}
</code></pre></div></div>

<h1>
<span id="次は-php-でプロセス間通信する方法を調べよう" class="fragment"></span><a href="#%E6%AC%A1%E3%81%AF-php-%E3%81%A7%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E9%96%93%E9%80%9A%E4%BF%A1%E3%81%99%E3%82%8B%E6%96%B9%E6%B3%95%E3%82%92%E8%AA%BF%E3%81%B9%E3%82%88%E3%81%86"><i class="fa fa-link"></i></a>次は PHP でプロセス間通信する方法を調べよう</h1>

<p>「【PHP】メッセージキューを使う」 (ＦＯＲ　ＳＥ)<br>
<a href="http://forse.hatenablog.com/entry/2016/01/10/173518" class="autolink" rel="nofollow noopener" target="_blank">http://forse.hatenablog.com/entry/2016/01/10/173518</a></p>

<p>じゃあ試しにページを作ってみるか。こんなんでいいんだろうか？</p>

<p>tamesi2.php</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>&lt;?php
// 送信したい文字列
$msg = "hello, world";
// キューの名前は数字で 5963、パーミッションは 600 の8進数表記
$msgkey = msg_get_queue( 5963 ,0600 );
    if( !msg_send( $msgkey ,12 ,$msg ,false ) )
    {
        echo "送信失敗";
    }
    else
    {
        echo "送信 " . $msg;
    }
</code></pre></div></div>

<p>tamesi3.php</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>&lt;?php
// キューの名前は数字で 5963
$msgkey = msg_get_queue( 5963 );
msg_receive( $msgkey ,0 ,$msgtype ,4 ,$msg,false ,null ,$err );
echo "msgtype {$msgtype} msg {$msg}\n"; 
</code></pre></div></div>

<h1>
<span id="ところでメモあとで調べる" class="fragment"></span><a href="#%E3%81%A8%E3%81%93%E3%82%8D%E3%81%A7%E3%83%A1%E3%83%A2%E3%81%82%E3%81%A8%E3%81%A7%E8%AA%BF%E3%81%B9%E3%82%8B"><i class="fa fa-link"></i></a>ところでメモ。あとで調べる</h1>

<ul>
<li>foreverコマンド 常駐させる</li>
<li>PHPでexpect プロセスと対話する</li>
<li>「ps aux | grep apery」で Aperyのプロセスを探せる</li>
</ul>

<h1>
<span id="phpの続き" class="fragment"></span><a href="#php%E3%81%AE%E7%B6%9A%E3%81%8D"><i class="fa fa-link"></i></a>PHPの続き</h1>

<p>送信はできたのかもしれないが、受信ではメッセージを取れてないな。書き直し。</p>

<p>tamesi2.php</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>&lt;?php
// 送信したい文字列
$msg = "hello, world";
// キューの名前は数字で 5963、パーミッションは 600 の8進数表記
$msgkey = msg_get_queue( 5963 ,0600 );
if( msg_send( $msgkey ,12 ,$msg ,false ) )
{
    echo "送信 " . $msg;
}
else
{
    echo "送信失敗";
}
</code></pre></div></div>

<p>tamesi3.php</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>&lt;?php
// キューの名前は数字で 5963
$msgkey = msg_get_queue( 5963 );
if( msg_receive( $msgkey ,0 ,$msgtype ,4 ,$data ,false ,null ,$err ) )
{
    echo "msgtype {$msgtype} data {$data}"; 
}
else
{
    echo "送信失敗 " . $err;
}
</code></pre></div></div>

<p>実行結果 tamesi3.php</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>送信失敗 7
</code></pre></div></div>

<p><strong>へぇ。</strong></p>

<p>「posix_strerror」　(PHPマニュアル)<br>
<a href="http://php.net/manual/ja/function.posix-strerror.php" class="autolink" rel="nofollow noopener" target="_blank">http://php.net/manual/ja/function.posix-strerror.php</a></p>

<p>tamesi3.php を書き直し。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>&lt;?php
// キューの名前は数字で 5963
$msgkey = msg_get_queue( 5963 );
if( msg_receive( $msgkey ,0 ,$msgtype ,4 ,$data ,false ,null ,$err ) )
{
    echo "msgtype {$msgtype} data {$data}"; 
}
else
{
    echo "送信失敗 " . $err . " " . posix_strerror( $err );
}
</code></pre></div></div>

<p>実行結果 tamesi3.php</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>送信失敗 7 Argument list too long
</code></pre></div></div>

<p>なんのこっちゃ。いったい何の 引数のリストか。</p>

<p>msg_send の第2引数の数字は　何を入れたらいいのか……？</p>

<p>「メッセージキューの使い方(CとPHPでプロセス間通信)」 (Linux Install Memo)<br>
<a href="https://linux.yebisu.jp/memo/630" class="autolink" rel="nofollow noopener" target="_blank">https://linux.yebisu.jp/memo/630</a></p>

<p><strong>おっ！ 分かった！</strong> </p>

<p>サンプル・プログラムで msg_receive 関数の第4引数が 4 なのは "test" の文字数に合わせていたのか。<br>
4096 ぐらい大きくしておけばよかったのか。</p>

<p>書き直し。</p>

<p>tamesi2.php</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>&lt;?php
// 送信したい文字列
$msg = "hello, world";
// キューの名前は数字
$QKey = 1111;
// パーミッションは 666 の8進数表記
$Queue = msg_get_queue( $QKey ,0666 );
echo var_dump( msg_stat_queue( $Queue ) );

if ( msg_queue_exists($QKey) )
{
    print $QKey . "はあるぜ☆（＾～＾）ｖ\n";
}
else
{
    print $QKey . "は無いぜ☆（＞＿＜）\n";
}

if( msg_send( $Queue ,12 ,$msg ,false ) )
{
    echo "送信 " . $msg . "\n";
}
else
{
    echo "送信失敗\n";
}
</code></pre></div></div>

<p>tamesi3.php</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>&lt;?php
// キューの名前は数字
$QKey = 1111;
$Queue = msg_get_queue( $QKey );
echo var_dump( msg_stat_queue( $Queue ) );

if ( msg_queue_exists($QKey) )
{
    print $QKey . "はあるぜ☆（＾～＾）ｖ\n";
}
else
{
    print $QKey . "は無いぜ☆（＞＿＜）\n";
}

if( msg_receive( $Queue ,0 ,$msgtype ,4096 ,$msg ,false ,null ,$err ) )
{
    echo "msgtype {$msgtype} msg {$msg}\n"; 
}
else
{
    var_dump( $err );
    echo "送信失敗 " . $err . " " . posix_strerror( $err ) . "&lt;br /&gt;";
    echo "type = " . $msgtype . " msg = " . $msg . "&lt;br /&gt;\n";
}
</code></pre></div></div>

<h2>
<span id="メッセージキューが空っぽのときに-receive-すると固まってしまうので" class="fragment"></span><a href="#%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E3%82%AD%E3%83%A5%E3%83%BC%E3%81%8C%E7%A9%BA%E3%81%A3%E3%81%BD%E3%81%AE%E3%81%A8%E3%81%8D%E3%81%AB-receive-%E3%81%99%E3%82%8B%E3%81%A8%E5%9B%BA%E3%81%BE%E3%81%A3%E3%81%A6%E3%81%97%E3%81%BE%E3%81%86%E3%81%AE%E3%81%A7"><i class="fa fa-link"></i></a>メッセージ・キューが空っぽのときに receive すると固まってしまうので</h2>

<p>「[PHP]「バッチの二重処理の防ぎ方」PHP変」 (がるの健忘録)<br>
<a href="http://d.hatena.ne.jp/gallu/20120306/p1" class="autolink" rel="nofollow noopener" target="_blank">http://d.hatena.ne.jp/gallu/20120306/p1</a></p>

<p>フラグを指定しろとのことらしい。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>$r = msg_receive($mh, 0, $msgtype, 0xffff, $message, true, MSG_IPC_NOWAIT, $error_code);
                                                           ~~~~~~~~~~~~~~
</code></pre></div></div>

<p>でも msg_receive は「No message of desired type」というエラーを返してくる。<br>
RabbitMQ を再起動できないものか。</p>

<h1>
<span id="rabbitmq-を再起動" class="fragment"></span><a href="#rabbitmq-%E3%82%92%E5%86%8D%E8%B5%B7%E5%8B%95"><i class="fa fa-link"></i></a>RabbitMQ を再起動</h1>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>rabbitmqctl stop
Stopping and halting node 'rabbit@★～略～' ...
Gracefully halting Erlang VM
</code></pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>jobs
[1]+  Done                    sudo rabbitmq-server  (wd: /home/csg10/shogi/ukamuse_sdt4/bin)
</code></pre></div></div>

<p>で止めて、</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>rabbitmq-server
</code></pre></div></div>

<p>[Ctrl]+[Z]</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>^Z
[1]+  Stopped                 rabbitmq-server
</code></pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>bg 1
[1]+ rabbitmq-server &amp;
</code></pre></div></div>

<p>で再開。</p>

<p>でもやっぱり 同じエラーのままだ。</p>

<p>キューのキー番号を変えてみたりする。今度はうまくいった。</p>

<h2>
<span id="phpのメッセージキュープログラムを書き直した" class="fragment"></span><a href="#php%E3%81%AE%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E3%82%AD%E3%83%A5%E3%83%BC%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0%E3%82%92%E6%9B%B8%E3%81%8D%E7%9B%B4%E3%81%97%E3%81%9F"><i class="fa fa-link"></i></a>PHPのメッセージ・キュー・プログラムを書き直した</h2>

<p>tamesi2.php</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>&lt;?php
// 送信したい文字列
$msg = urldecode($_SERVER['QUERY_STRING']);
if( "" === $msg )
{
    $msg = "hello, world";
}
echo '（＾ｑ＾）' . $msg . '&lt;br /&gt;';
echo 'これを１回クリックしろだぜ☆ｍ９（＾～＾）！&lt;br /&gt;';
echo '&lt;a href="http://999.999.999.999/tamesi2.php?ClickSitanDaze"&gt;http://999.999.999.999/tamesi2.php?ClickSitanDaze&lt;/a&gt;&lt;br /&gt;';

// キューの名前は数字
$QKey = 1111;
// パーミッションは 666 の8進数表記
$Queue = msg_get_queue( $QKey ,0666 );

if ( !msg_queue_exists($QKey) )
{
    print "キュー " . $QKey . "は無いぜ☆（＞＿＜）\n";
    die("queue not found.");
}

if( !msg_send( $Queue ,12 ,$msg ,false ) )
{
    echo "エンキュー失敗☆（＞＿＜）\n";
    die("send error.");
}

echo 'そのあとこのページを見にいけだぜ☆ｍ９（＾～＾）！&lt;br /&gt;';
echo '&lt;a href="http://999.999.999.999/tamesi3.php"&gt;http://999.999.999.999/tamesi3.php&lt;/a&gt;&lt;br /&gt;';
</code></pre></div></div>

<p>tamesi3.php</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>&lt;?php
// キューの名前は数字
$QKey = 1111;
$Queue = msg_get_queue( $QKey );

if ( !msg_queue_exists($QKey) )
{
    print "キュー " . $QKey . "は無いぜ☆（＞＿＜）\n";
    die("queue not found.");
}

if( !msg_receive( $Queue ,0 ,$msgtype ,4096 ,$msg ,false ,MSG_IPC_NOWAIT ,$err ) )
{
    if( $err==42 )
    {
        echo "（＾ｑ＾）；；キューが空っぽなのかだぜ☆？&lt;br /&gt;";
    }
    else
    {
        var_dump( $err );
        echo "デキュー失敗☆（＞＿＜） " . $err . " " . posix_strerror( $err ) . "&lt;br /&gt;";
    }
    die("receive error.");
}

echo "プロセス間通信を通ってきたようだな☆（＾ｑ＾）「{$msg}」&lt;br /&gt;\n"; 
echo "メッセージは溜まっているかもしれないからページを更新しろだぜ☆（＾～＾）&lt;br /&gt;\n"; 
</code></pre></div></div>

<p>tamesi4.php （破棄に失敗するだけだったが）</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>&lt;?php
// キューの名前は数字
$QKey = 1111;
if ( !msg_queue_exists($QKey) )
{
    print "キュー " . $QKey . "は無いぜ☆（＞＿＜）\n";
    die("queue not found.");
}

// パーミッションは 666 の8進数表記
$Queue = msg_get_queue( $QKey ,0666 );

if( !msg_remove_queue($Queue) )
{
    print "キュー " . $QKey . "の破棄に失敗☆（＞＿＜）\n";
    die("queue not removed.");
}

print "キュー " . $QKey . "を破棄したぜ☆（＾～＾）\n";
</code></pre></div></div>

<h1>
<span id="phpとcの間でプロセス間通信できんの" class="fragment"></span><a href="#php%E3%81%A8c%E3%81%AE%E9%96%93%E3%81%A7%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E9%96%93%E9%80%9A%E4%BF%A1%E3%81%A7%E3%81%8D%E3%82%93%E3%81%AE"><i class="fa fa-link"></i></a>PHPとC#の間で　プロセス間通信できんの？</h1>

<p>PHPはキューの名前が数字だし、C#はキューの名前が / で始まる文字なんだっけ？<br>
なんだろう　この違い……。</p>

<h1>
<span id="コンパイルオプション-プリプロセッサ定義" class="fragment"></span><a href="#%E3%82%B3%E3%83%B3%E3%83%91%E3%82%A4%E3%83%AB%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3-%E3%83%97%E3%83%AA%E3%83%97%E3%83%AD%E3%82%BB%E3%83%83%E3%82%B5%E5%AE%9A%E7%BE%A9"><i class="fa fa-link"></i></a>コンパイル・オプション プリプロセッサ定義</h1>

<p>C#の方。</p>

<p>「/D (プリプロセッサの定義)」 (MSDN)<br>
<a href="https://msdn.microsoft.com/ja-jp/library/hhzbb5c8.aspx" class="autolink" rel="nofollow noopener" target="_blank">https://msdn.microsoft.com/ja-jp/library/hhzbb5c8.aspx</a></p>

<p>/D を使って #define と同じような効果を出せるのか。</p>

<p>Ubuntu用と Windows用で分けようかな。</p>

<p>複数個のプリプロセッサマクロがあるとき、どう指定すればいいんだ？　そのときは適当にカンマでも打ってみるか。</p>

<h1>
<span id="cのプロセス間通信プログラムをさらに修正" class="fragment"></span><a href="#c%E3%81%AE%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E9%96%93%E9%80%9A%E4%BF%A1%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0%E3%82%92%E3%81%95%E3%82%89%E3%81%AB%E4%BF%AE%E6%AD%A3"><i class="fa fa-link"></i></a>C#のプロセス間通信プログラムをさらに修正</h1>

<p>次の点を修正した。</p>

<ul>
<li>レシーブに失敗すること</li>
<li>quit で固まること</li>
</ul>

<p>修正方法は、コネクションとチャンネルのクローズをちゃんとやること。</p>

<p>また、UbuntuとWindowsで異なる個所を UBUNTU プリプロセッサ定義で分けた。</p>

<p>MsgQueue.cs</p>

<div class="code-frame" data-lang="C#"><div class="highlight"><pre><code><span class="c1">// Ubuntu の RabbitMQ はソースのバージョンが古いのか、API が異なった。</span>
<span class="c1">// #define UBUNTU</span>

<span class="k">using</span> <span class="nn">RabbitMQ.Client</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">RabbitMQ.Client.Events</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Text</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">UsagiMQ</span>
<span class="p">{</span>
    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">/// 参照 : 「QueueDeclare」 http://docs.spring.io/spring-amqp-net/docs/1.0.x/api/html/Spring.Messaging.Amqp.Rabbit~Spring.Messaging.Amqp.Rabbit.Connection.CachedModel~QueueDeclare(String,Boolean,Boolean,Boolean,Boolean,Boolean,IDictionary).html</span>
    <span class="c1">/// 参照 : 「EventingBasicConsumer」 https://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v1.4.0/rabbitmq-dotnet-client-1.4.0-net-2.0-htmldoc/type-RabbitMQ.Client.Events.EventingBasicConsumer.html</span>
    <span class="c1">/// 参照 : 「BasicConsume」 https://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v1.4.0/rabbitmq-dotnet-client-1.4.0-net-2.0-htmldoc/type-RabbitMQ.Client.IModel.html#method-M:RabbitMQ.Client.IModel.BasicConsume(System.UInt16,System.String,System.Boolean,System.Collections.IDictionary,RabbitMQ.Client.IBasicConsumer)</span>
    <span class="c1">/// &lt;/summary&gt;</span>
    <span class="k">class</span> <span class="nc">Program</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="k">const</span> <span class="kt">string</span>
            <span class="n">HOST_NAME</span> <span class="p">=</span> <span class="s">"localhost"</span><span class="p">,</span>
            <span class="n">QUEUE_NAME</span> <span class="p">=</span> <span class="s">"hello"</span><span class="p">;</span>

        <span class="k">static</span> <span class="nf">Program</span><span class="p">()</span>
        <span class="p">{</span>
<span class="cp">#if UBUNTU
</span>            <span class="n">m_eventHandler_</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">BasicDeliverEventHandler</span><span class="p">((</span><span class="n">model</span><span class="p">,</span> <span class="n">ea</span><span class="p">)</span> <span class="p">=&gt;</span>
<span class="cp">#else
</span>            <span class="n">m_eventHandler_</span> <span class="p">=</span> <span class="k">new</span> <span class="n">EventHandler</span><span class="p">&lt;</span><span class="n">BasicDeliverEventArgs</span><span class="p">&gt;((</span><span class="n">model</span><span class="p">,</span> <span class="n">ea</span><span class="p">)</span> <span class="p">=&gt;</span>
<span class="cp">#endif
</span>            <span class="p">{</span>
                <span class="kt">byte</span><span class="p">[]</span> <span class="n">body</span> <span class="p">=</span> <span class="n">ea</span><span class="p">.</span><span class="n">Body</span><span class="p">;</span>
                <span class="kt">string</span> <span class="n">message</span> <span class="p">=</span> <span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">.</span><span class="nf">GetString</span><span class="p">(</span><span class="n">body</span><span class="p">);</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">" [interrupt!] Received(^q^) {0}"</span><span class="p">,</span> <span class="n">message</span><span class="p">);</span>
            <span class="p">});</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">static</span> <span class="n">ConnectionFactory</span> <span class="nf">GetFactory</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="k">null</span><span class="p">==</span> <span class="n">m_factory_</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">m_factory_</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ConnectionFactory</span><span class="p">()</span> <span class="p">{</span> <span class="n">HostName</span> <span class="p">=</span> <span class="n">HOST_NAME</span> <span class="p">};</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">m_factory_</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">static</span> <span class="n">ConnectionFactory</span> <span class="n">m_factory_</span><span class="p">;</span>

        <span class="k">public</span> <span class="k">static</span> <span class="n">IConnection</span> <span class="nf">GetConnection</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">null</span><span class="p">==</span><span class="n">m_connection_</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">m_connection_</span> <span class="p">=</span> <span class="nf">GetFactory</span><span class="p">().</span><span class="nf">CreateConnection</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">m_connection_</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">static</span> <span class="n">IConnection</span> <span class="n">m_connection_</span><span class="p">;</span>

        <span class="k">public</span> <span class="k">static</span> <span class="n">IModel</span> <span class="nf">GetChannel</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">null</span><span class="p">==</span><span class="n">m_channel_</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">m_channel_</span> <span class="p">=</span> <span class="nf">GetConnection</span><span class="p">().</span><span class="nf">CreateModel</span><span class="p">();</span>
<span class="cp">#if UBUNTU
</span>                <span class="c1">// Ubuntuでは何故か Spring.Messaging.Amqp.Rabbit の引数 7 つのやつになっている。</span>
                <span class="n">m_channel_</span><span class="p">.</span><span class="nf">QueueDeclare</span><span class="p">(</span><span class="n">QUEUE_NAME</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span>
<span class="cp">#else
</span>                <span class="n">m_channel_</span><span class="p">.</span><span class="nf">QueueDeclare</span><span class="p">(</span><span class="n">QUEUE_NAME</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span>
<span class="cp">#endif
</span>            <span class="p">}</span>
            <span class="k">return</span> <span class="n">m_channel_</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">static</span> <span class="n">IModel</span> <span class="n">m_channel_</span><span class="p">;</span>

        <span class="k">public</span> <span class="k">static</span> <span class="n">EventingBasicConsumer</span> <span class="nf">GetConsumer</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">null</span> <span class="p">==</span> <span class="n">m_consumer_</span><span class="p">)</span>
            <span class="p">{</span>
<span class="cp">#if UBUNTU
</span>                <span class="c1">// Ubuntuでは何故か v1.4.0 の引数が 0 個のやつになっている。</span>
                <span class="n">m_consumer_</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">EventingBasicConsumer</span><span class="p">();</span>
<span class="cp">#else
</span>                <span class="n">m_consumer_</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">EventingBasicConsumer</span><span class="p">(</span><span class="nf">GetChannel</span><span class="p">());</span>
<span class="cp">#endif
</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">m_consumer_</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">static</span> <span class="n">EventingBasicConsumer</span> <span class="n">m_consumer_</span><span class="p">;</span>

        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// 受信できたときに割り込んでくる処理</span>
        <span class="c1">/// &lt;/summary&gt;</span>
<span class="cp">#if UBUNTU
</span>        <span class="k">static</span> <span class="n">BasicDeliverEventHandler</span> <span class="n">m_eventHandler_</span><span class="p">;</span>
<span class="cp">#else
</span>        <span class="k">static</span> <span class="n">EventHandler</span><span class="p">&lt;</span><span class="n">BasicDeliverEventArgs</span><span class="p">&gt;</span> <span class="n">m_eventHandler_</span><span class="p">;</span>
<span class="cp">#endif
</span>
        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// 対応するオープンは無いけれど、開けたら閉める、を完璧に対応する必要がある。</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="k">static</span> <span class="k">void</span> <span class="nf">CloseConnection</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">null</span> <span class="p">!=</span> <span class="n">m_connection_</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">m_connection_</span><span class="p">.</span><span class="nf">Close</span><span class="p">();</span>
                <span class="n">m_connection_</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// 対応するオープンは無いけれど、開けたら閉める、を完璧に対応する必要がある。</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="k">static</span> <span class="k">void</span> <span class="nf">CloseChannel</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">null</span> <span class="p">!=</span> <span class="n">m_channel_</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">m_channel_</span><span class="p">.</span><span class="nf">Close</span><span class="p">();</span>
                <span class="n">m_channel_</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">for</span> <span class="p">(;;)</span>
            <span class="p">{</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">@"選べだぜ☆（＾～＾）
1   : メッセージ   送信
2   : メッセージ   受信
quit: 終了
"</span><span class="p">);</span>

                <span class="kt">int</span> <span class="n">category</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
                <span class="k">for</span> <span class="p">(;;)</span>
                <span class="p">{</span>
                    <span class="kt">string</span> <span class="n">line</span> <span class="p">=</span> <span class="n">Console</span><span class="p">.</span><span class="nf">ReadLine</span><span class="p">();</span>
                    <span class="k">switch</span> <span class="p">(</span><span class="n">line</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="k">case</span> <span class="s">"1"</span><span class="p">:</span> <span class="n">category</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span> <span class="k">goto</span> <span class="n">gt_EndLoop1</span><span class="p">;</span>
                        <span class="k">case</span> <span class="s">"2"</span><span class="p">:</span> <span class="n">category</span> <span class="p">=</span> <span class="m">2</span><span class="p">;</span> <span class="k">goto</span> <span class="n">gt_EndLoop1</span><span class="p">;</span>
                        <span class="k">case</span> <span class="s">"quit"</span><span class="p">:</span> <span class="k">goto</span> <span class="n">gt_Quit</span><span class="p">;</span>
                        <span class="k">default</span><span class="p">:</span> <span class="k">break</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
                <span class="n">gt_EndLoop1</span><span class="p">:</span>
                <span class="p">;</span>

                <span class="k">switch</span> <span class="p">(</span><span class="n">category</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="k">case</span> <span class="m">1</span><span class="p">:</span>
                        <span class="p">{</span>
                            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">@"メッセージを書いて[Enter]キーを押せだぜ☆（＾～＾）"</span><span class="p">);</span>
                            <span class="c1">// "Hello World!" などを入力</span>
                            <span class="kt">string</span> <span class="n">line</span> <span class="p">=</span> <span class="n">Console</span><span class="p">.</span><span class="nf">ReadLine</span><span class="p">();</span>
                            <span class="nf">Send</span><span class="p">(</span><span class="n">line</span><span class="p">);</span>
                        <span class="p">}</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="k">case</span> <span class="m">2</span><span class="p">:</span> <span class="nf">Receive</span><span class="p">();</span> <span class="k">break</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="n">gt_Quit</span><span class="p">:</span>

            <span class="c1">// 対応するオープンは無いが、ちゃんと閉じないと、プロセスが終わってくれない。</span>
            <span class="nf">CloseConnection</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">static</span> <span class="k">void</span> <span class="nf">Send</span><span class="p">(</span><span class="kt">string</span> <span class="n">message</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">IModel</span> <span class="n">channel</span> <span class="p">=</span> <span class="nf">GetChannel</span><span class="p">();</span>

            <span class="kt">byte</span><span class="p">[]</span> <span class="n">body</span> <span class="p">=</span> <span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
            <span class="n">channel</span><span class="p">.</span><span class="nf">BasicPublish</span><span class="p">(</span><span class="s">""</span><span class="p">,</span> <span class="n">QUEUE_NAME</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="n">body</span><span class="p">);</span>

            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">" Sent(^q^) {0}"</span><span class="p">,</span> <span class="n">message</span><span class="p">);</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">" Press [enter] to menu."</span><span class="p">);</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">ReadLine</span><span class="p">();</span>

            <span class="c1">// 対応するオープンは無いが、ちゃんと閉じないと、レシーブしてくれない。</span>
            <span class="nf">CloseChannel</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">static</span> <span class="k">void</span> <span class="nf">Receive</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">IModel</span> <span class="n">channel</span> <span class="p">=</span> <span class="nf">GetChannel</span><span class="p">();</span>
            <span class="n">EventingBasicConsumer</span> <span class="n">consumer</span> <span class="p">=</span> <span class="nf">GetConsumer</span><span class="p">();</span>


            <span class="c1">// 受信できたときに割り込んでくる処理</span>
            <span class="n">consumer</span><span class="p">.</span><span class="n">Received</span> <span class="p">+=</span> <span class="n">m_eventHandler_</span><span class="p">;</span>

<span class="cp">#if UBUNTU
</span>            <span class="c1">// Ubuntuでは何故か引数が 5 個のやつになっている。</span>
            <span class="n">channel</span><span class="p">.</span><span class="nf">BasicConsume</span><span class="p">(</span> <span class="n">QUEUE_NAME</span><span class="p">,</span> <span class="k">true</span><span class="p">,</span> <span class="s">""</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="n">consumer</span><span class="p">);</span>
<span class="cp">#else
</span>            <span class="n">channel</span><span class="p">.</span><span class="nf">BasicConsume</span><span class="p">(</span><span class="n">QUEUE_NAME</span><span class="p">,</span> <span class="k">true</span><span class="p">,</span> <span class="n">consumer</span><span class="p">);</span>
<span class="cp">#endif
</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">" Please, wait receiving... Or Press [enter] to menu."</span><span class="p">);</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">ReadLine</span><span class="p">();</span>

            <span class="c1">// 割込み処理の削除</span>
            <span class="n">consumer</span><span class="p">.</span><span class="n">Received</span> <span class="p">-=</span> <span class="n">m_eventHandler_</span><span class="p">;</span>

            <span class="c1">// 対応するオープンは無いが、ちゃんと閉じないと、レシーブしてくれない。</span>
            <span class="nf">CloseChannel</span><span class="p">();</span>
        <span class="p">}</span>

    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>(2017-03-07 修正:上のプログラム２個所修正済み)</p>

<p>"localhost" と埋め込んでいるところも、IPアドレスの番号に変えた方がいいんだろうか？</p>

<p>これを Ubuntu でコンパイルするには、</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>mcs /r:RabbitMQ.Client.dll /DUBUNTU MsgQueue.cs
</code></pre></div></div>

<p>とすればいいんだろうか？　やってみよう。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>mcs /r:RabbitMQ.Client.dll /DUBUNTU MsgQueue.cs
error CS2007: Unrecognized command-line option: `/DUBUNTU'
</code></pre></div></div>

<p>なぜダメなのか……。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>man mcs
～中略～
       -define:SYMLIST, -d:SYMLIST
              Defines the symbol listed by the semi-colon separated list SYMLIST  SYMBOL.   This  can  be
              tested  in  the  source code by the pre-processor, or can be used by methods that have been
              tagged with the Conditional attribute.
</code></pre></div></div>

<p><strong>「-define:」で始めて、セミコロンで区切ればいいのか。</strong></p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>mcs /r:RabbitMQ.Client.dll -define:UBUNTU MsgQueue.cs
MsgQueue.cs(178,34): error CS0029: Cannot implicitly convert type `System.EventHandler&lt;RabbitMQ.Client.Events.BasicDeliverEventArgs&gt;' to `RabbitMQ.Client.Events.BasicDeliverEventHandler'
MsgQueue.cs(191,34): error CS0029: Cannot implicitly convert type `System.EventHandler&lt;RabbitMQ.Client.Events.BasicDeliverEventArgs&gt;' to `RabbitMQ.Client.Events.BasicDeliverEventHandler'
Compilation failed: 2 error(s), 0 warnings
</code></pre></div></div>

<p>プログラムにミスがあったか。<br>
２個所修正。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>#if UBUNTU
            m_eventHandler_ = new BasicDeliverEventHandler((model, ea) =&gt;
#else
            m_eventHandler_ = new EventHandler&lt;BasicDeliverEventArgs&gt;((model, ea) =&gt;
#endif
</code></pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>#if UBUNTU
        static BasicDeliverEventHandler m_eventHandler_;
#else
        static EventHandler&lt;BasicDeliverEventArgs&gt; m_eventHandler_;
#endif
</code></pre></div></div>

<h1>
<span id="c-と-php-のプロセス間通信はどうやるのか" class="fragment"></span><a href="#c-%E3%81%A8-php-%E3%81%AE%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E9%96%93%E9%80%9A%E4%BF%A1%E3%81%AF%E3%81%A9%E3%81%86%E3%82%84%E3%82%8B%E3%81%AE%E3%81%8B"><i class="fa fa-link"></i></a>C# と PHP のプロセス間通信はどうやるのか？</h1>

<p>"localhost" のところを IPアドレスに変えるとエラーが出てしまった。<br>
キュー名の "hello" を "1111" に変えても　PHP では拾えなかった。</p>

<p>PHPマニュアルではなく、RabbitMQ の説明を読んだ方がいいのか？</p>

<p>「Introduction」 (RabbitMQ)<br>
<a href="https://www.rabbitmq.com/tutorials/tutorial-one-php.html" class="autolink" rel="nofollow noopener" target="_blank">https://www.rabbitmq.com/tutorials/tutorial-one-php.html</a></p>

<p>サンプル・プログラムが全然違う。</p>

<h1>
<span id="ubuntu-に-composer-のインストールが要るだろうか" class="fragment"></span><a href="#ubuntu-%E3%81%AB-composer-%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%8C%E8%A6%81%E3%82%8B%E3%81%A0%E3%82%8D%E3%81%86%E3%81%8B"><i class="fa fa-link"></i></a>Ubuntu に composer のインストールが要るだろうか</h1>

<p>「How To Install and Use Composer on Ubuntu 14.04」 (DigitalOcean)<br>
<a href="https://www.digitalocean.com/community/tutorials/how-to-install-and-use-composer-on-ubuntu-14-04" class="autolink" rel="nofollow noopener" target="_blank">https://www.digitalocean.com/community/tutorials/how-to-install-and-use-composer-on-ubuntu-14-04</a></p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>sudo apt-get update
～中略～
Fetched 1,672 kB in 2s (581 kB/s)
Reading package lists... Done
</code></pre></div></div>

<p>curl も要るみたいなんだが、php5 は入れたくないぜ。</p>

<p>「How do I install the ext-curl extension with PHP 7?」 (stack overflow)<br>
<a href="http://stackoverflow.com/questions/33775897/how-do-i-install-the-ext-curl-extension-with-php-7" class="autolink" rel="nofollow noopener" target="_blank">http://stackoverflow.com/questions/33775897/how-do-i-install-the-ext-curl-extension-with-php-7</a></p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>sudo apt-get install php-curl
</code></pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>sudo service apache2 restart
</code></pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>curl -sS https://getcomposer.org/installer | sudo php -- --install-dir=/usr/local/bin --filename=composer
All settings correct for using Composer
Downloading...

Composer (version 1.3.2) successfully installed to: /usr/local/bin/composer
Use it: php /usr/local/bin/composer
</code></pre></div></div>

<p>composer はダウンロードできただろうか。<br>
起動。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>composer
Do not run Composer as root/super user! See https://getcomposer.org/root for details
   ______
  / ____/___  ____ ___  ____  ____  ________  _____
 / /   / __ \/ __ `__ \/ __ \/ __ \/ ___/ _ \/ ___/
/ /___/ /_/ / / / / / / /_/ / /_/ (__  )  __/ /
\____/\____/_/ /_/ /_/ .___/\____/____/\___/_/
                    /_/
Composer version 1.3.2 2017-01-27 18:23:41
</code></pre></div></div>

<p>何か書いてるな。</p>

<p>「How do I install untrusted packages safely? Is it safe to run Composer as superuser or root?」 (getcomposer.org)<br>
<a href="https://getcomposer.org/root" class="autolink" rel="nofollow noopener" target="_blank">https://getcomposer.org/root</a></p>

<p>root やスーパー・ユーザーじゃ composer は実行できないのだろうか？</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>cd ~
</code></pre></div></div>

<p>ルートユーザーのフォルダーに飛んだのだろうか？</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>mkdir slugify
</code></pre></div></div>

<p>フォルダを作った。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>cd slugify
</code></pre></div></div>

<p>そのフォルダー移動した。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>composer require cocur/slugify
Do not run Composer as root/super user! See https://getcomposer.org/root for details
</code></pre></div></div>

<p>スーパー・ユーザーから抜けるにはどうすればいいんだ？</p>

<p>「suコマンド（ユーザーの変更）」 (Linuxゲリラ戦記)<br>
<a href="http://www.garunimo.com/program/linux/su.xhtml" class="autolink" rel="nofollow noopener" target="_blank">http://www.garunimo.com/program/linux/su.xhtml</a></p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>su 一般ユーザー名
</code></pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>composer require cocur/slugify

  [ErrorException]
  file_get_contents(./composer.json): failed to open stream: Permission denied
</code></pre></div></div>

<p>なんのこっちゃ。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>ls -an
total 20
drwxr-xr-x 3 0 0 4096 Mar  7 05:07 .
drwx------ 9 0 0 4096 Mar  7 05:05 ..
-rw-r--r-- 1 0 0   59 Mar  7 05:07 composer.json
-rw-r--r-- 1 0 0 2896 Mar  7 05:07 composer.lock
drwxr-xr-x 4 0 0 4096 Mar  7 05:07 vendor
</code></pre></div></div>

<p>ルート・ユーザーで実行するな、というから一般ユーザーになったのに……。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>sudo su -
※パスワードを入れる
cd slugify
chmod 666 composer.json
su 一般ユーザー名
composer require cocur/slugify

  [ErrorException]
  file_get_contents(./composer.json): failed to open stream: Permission denied
</code></pre></div></div>

<p><strong>うーむ。</strong></p>

<p>「.composer/config file permission denied using laravel」 (stack overflow)<br>
<a href="http://stackoverflow.com/questions/34511744/composer-config-file-permission-denied-using-laravel" class="autolink" rel="nofollow noopener" target="_blank">http://stackoverflow.com/questions/34511744/composer-config-file-permission-denied-using-laravel</a></p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>sudo chown 一般ユーザーアカウント名 /home/一般ユーザーアカウント名/.composer/config.json
chown: cannot access '/home/★略/.composer/config.json': No such file or directory
</code></pre></div></div>

<p><strong>うーむ。</strong></p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>sudo su -
cd slugify
</code></pre></div></div>

<p>スーパーユーザーでやってもだめ。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>sudo chown 一般ユーザー名 composer.json
</code></pre></div></div>

<p>よし。カレントディレクトリのファイルをいじる権限を与えたのか。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>su 一般ユーザー名
composer require cocur/slugify

  [ErrorException]
  file_get_contents(./composer.json): failed to open stream: Permission denied
</code></pre></div></div>

<p>だめ。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>sudo su -
cd slugify
sudo chown 一般ユーザー名 composer.lock
</code></pre></div></div>

<p>ロックファイルを書き込む権限なんか与えたって、すぐ消えるファイルだと思うが。</p>

<p>一般ユーザーで。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>sudo composer update
</code></pre></div></div>

<p>むり。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>composer update
Composer could not find a composer.json file in /home/csg10
To initialize a project, please create a composer.json file as described in the https://getcomposer.org/ "Getting Started" section
</code></pre></div></div>

<p>「Getting Started」 (Composer)<br>
<a href="https://getcomposer.org/doc/00-intro.md" class="autolink" rel="nofollow noopener" target="_blank">https://getcomposer.org/doc/00-intro.md</a></p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>php composer-setup.php --install-dir=bin --filename=composer
</code></pre></div></div>

<p>うごかない。</p>

<p>一般ユーザーになって、自分のホームディレクトリへ移動。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>composer require cocur/slugify
</code></pre></div></div>

<p>と叩く。<strong>インストールが始まった。</strong></p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>Cannot create cache directory /home/csg10/.composer/cache/repo/https---packagist.org/, or directory is not writable. Proceeding without cache
Cannot create cache directory /home/csg10/.composer/cache/files/, or directory is not writable. Proceeding without cache
Using version ^2.4 for cocur/slugify
./composer.json has been created
Cannot create cache directory /home/csg10/.composer/cache/repo/https---packagist.org/, or directory is not writable. Proceeding without cache
Cannot create cache directory /home/csg10/.composer/cache/files/, or directory is not writable. Proceeding without cache
Loading composer repositories with package information
Updating dependencies (including require-dev)
Package operations: 1 install, 0 updates, 0 removals
  - Installing cocur/slugify (v2.4) Downloading: 100%
Writing lock file
Generating autoload files
</code></pre></div></div>

<p>失敗したのか成功したのか分からないが、何かが起こった。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>ls -l
total 24
-rw-rw-r-- 1 csg10 csg10   59 Mar  7 05:37 composer.json
-rw-rw-r-- 1 csg10 csg10 2896 Mar  7 05:37 composer.lock
drwxrwxr-x 2 csg10 csg10 4096 Mar  5 16:30 jikken
drwxr-xrwx 3 root  root  4096 Mar  7 00:34 shogi
-rw-r--r-- 1 root  root    14 Mar  4 03:19 Tamesi
drwxrwxr-x 4 csg10 csg10 4096 Mar  7 05:37 vendor
</code></pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>cat composer.json
{
    "require": {
        "cocur/slugify": "^2.4"
    }
}
</code></pre></div></div>

<p>これを、RabbitQM が言うには、</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>{ 
    "require" ： { 
        "php-amqplib / php-amqplib" ： "2.5。*" 
    } 
}
</code></pre></div></div>

<p>を、追加すればいいのか。<strong>カンマ区切りだっけ？</strong></p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>{
    "require": {
        "cocur/slugify": "^2.4"
    }
    ,
    "require" ： {
        "php-amqplib / php-amqplib" ： "2.5。*"
    }

}
</code></pre></div></div>

<p>このようにしてみたが。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>composer.phar install
composer.phar: command not found
</code></pre></div></div>

<p>どうすればいいんだ。それとも、こうか？</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>{
    "require": {
        "cocur/slugify": "^2.4"
        ,
        "php-amqplib / php-amqplib" ： "2.5。*"
    }
}
</code></pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>composer.phar install
composer.phar: command not found
</code></pre></div></div>

<p>なんだこの読点。 <strong>あーっ！　グーグル翻訳で　コードが変わってるじゃないか！</strong></p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>{
    "require": {
        "cocur/slugify": "^2.4"
        ,
        "php-amqplib/php-amqplib": "2.5.*"
    }
}
</code></pre></div></div>

<p>こうだ。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>composer.phar install
composer.phar: command not found
</code></pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code> composer require php-amqplib/php-amqplib
Cannot create cache directory /home/csg10/.composer/cache/repo/https---packagist.org/, or directory is not writable. Proceeding without cache
Cannot create cache directory /home/csg10/.composer/cache/files/, or directory is not writable. Proceeding without cache
Using version ^2.6 for php-amqplib/php-amqplib
./composer.json has been updated
Cannot create cache directory /home/csg10/.composer/cache/repo/https---packagist.org/, or directory is not writable. Proceeding without cache
Cannot create cache directory /home/csg10/.composer/cache/files/, or directory is not writable. Proceeding without cache
Loading composer repositories with package information
Updating dependencies (including require-dev)
Your requirements could not be resolved to an installable set of packages.

  Problem 1
    - php-amqplib/php-amqplib v2.6.3 requires ext-bcmath * -&gt; the requested PHP extension bcmath is missing from your system.
    - php-amqplib/php-amqplib v2.6.2 requires ext-bcmath * -&gt; the requested PHP extension bcmath is missing from your system.
    - php-amqplib/php-amqplib v2.6.1 requires ext-bcmath * -&gt; the requested PHP extension bcmath is missing from your system.
    - php-amqplib/php-amqplib v2.6.0 requires ext-bcmath * -&gt; the requested PHP extension bcmath is missing from your system.
    - Installation request for php-amqplib/php-amqplib ^2.6 -&gt; satisfiable by php-amqplib/php-amqplib[v2.6.0, v2.6.1, v2.6.2, v2.6.3].

  To enable extensions, verify that they are enabled in your .ini files:
    - /etc/php/7.0/cli/php.ini
    - /etc/php/7.0/cli/conf.d/10-opcache.ini
    - /etc/php/7.0/cli/conf.d/10-pdo.ini
    - /etc/php/7.0/cli/conf.d/15-xml.ini
    - /etc/php/7.0/cli/conf.d/20-calendar.ini
    - /etc/php/7.0/cli/conf.d/20-ctype.ini
    - /etc/php/7.0/cli/conf.d/20-curl.ini
    - /etc/php/7.0/cli/conf.d/20-dom.ini
    - /etc/php/7.0/cli/conf.d/20-exif.ini
    - /etc/php/7.0/cli/conf.d/20-fileinfo.ini
    - /etc/php/7.0/cli/conf.d/20-ftp.ini
    - /etc/php/7.0/cli/conf.d/20-gettext.ini
    - /etc/php/7.0/cli/conf.d/20-iconv.ini
    - /etc/php/7.0/cli/conf.d/20-json.ini
    - /etc/php/7.0/cli/conf.d/20-mbstring.ini
    - /etc/php/7.0/cli/conf.d/20-phar.ini
    - /etc/php/7.0/cli/conf.d/20-posix.ini
    - /etc/php/7.0/cli/conf.d/20-readline.ini
    - /etc/php/7.0/cli/conf.d/20-shmop.ini
    - /etc/php/7.0/cli/conf.d/20-simplexml.ini
    - /etc/php/7.0/cli/conf.d/20-sockets.ini
    - /etc/php/7.0/cli/conf.d/20-sysvmsg.ini
    - /etc/php/7.0/cli/conf.d/20-sysvsem.ini
    - /etc/php/7.0/cli/conf.d/20-sysvshm.ini
    - /etc/php/7.0/cli/conf.d/20-tokenizer.ini
    - /etc/php/7.0/cli/conf.d/20-wddx.ini
    - /etc/php/7.0/cli/conf.d/20-xmlreader.ini
    - /etc/php/7.0/cli/conf.d/20-xmlwriter.ini
    - /etc/php/7.0/cli/conf.d/20-xsl.ini
  You can also run `php --ini` inside terminal to see which files are used by PHP in CLI mode.

Installation failed, reverting ./composer.json to its original content.
</code></pre></div></div>

<p>あらーっ。</p>

<h1>
<span id="php-amqplib-はどうやって入手するのか" class="fragment"></span><a href="#php-amqplib-%E3%81%AF%E3%81%A9%E3%81%86%E3%82%84%E3%81%A3%E3%81%A6%E5%85%A5%E6%89%8B%E3%81%99%E3%82%8B%E3%81%AE%E3%81%8B"><i class="fa fa-link"></i></a>php-amqplib はどうやって入手するのか？</h1>

<p>「php-amqplib/php-amqplib」 (Git Hub)<br>
<a href="https://github.com/php-amqplib/php-amqplib" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/php-amqplib/php-amqplib</a></p>

<p>composer.json ファイルは自分で作ってしまえばいいのか？</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>{
  "require": {
      "php-amqplib/php-amqplib": "2.6.*"
  }
}
</code></pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>composer.phar install
composer.phar: command not found
</code></pre></div></div>

<p>composer のインストールが終わってないのか。</p>

<h1>
<span id="composer-のインストール" class="fragment"></span><a href="#composer-%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>composer のインストール</h1>

<p>「Composerをインストールしてみた」 (Qiita)<br>
<a href="http://qiita.com/kakijin/items/02364adacf36410f449e" class="autolink" id="reference-49d719b4699f6404631d">http://qiita.com/kakijin/items/02364adacf36410f449e</a></p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>curl -sS https://getcomposer.org/installer | php
All settings correct for using Composer
Unable to write keys.dev.pub to: /home/一般ユーザー名/.composer
</code></pre></div></div>

<p>なんのこっちゃ。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>mv composer.phar /usr/local/bin/composer
mv: cannot stat 'composer.phar': No such file or directory
</code></pre></div></div>

<p>よく見ると、</p>

<p>/home/一般ユーザー名/ ディレクトリに vendor というディレクトリーができていた。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>ls
composer.json  composer.lock  jikken  shogi  Tamesi  vendor
cd vendor
ls
autoload.php  cocur  composer
cd composer
ls
autoload_classmap.php    autoload_psr4.php  autoload_static.php  installed.json
autoload_namespaces.php  autoload_real.php  ClassLoader.php      LICENSE
</code></pre></div></div>

<p>composer.phar という名前のファイルは見つからない。</p>

<p>「Composerで始める PHPのライブラリ管理」 (Hack Your Design!)<br>
<a href="http://blog.toshimaru.net/how-to-use-composer-autoload/" class="autolink" rel="nofollow noopener" target="_blank">http://blog.toshimaru.net/how-to-use-composer-autoload/</a></p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>curl -s https://getcomposer.org/installer | php
</code></pre></div></div>

<p>これをすると、 composer.phar は取れるらしいんだが、どこにあるんだろう？</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>curl -s https://getcomposer.org/installer | php
All settings correct for using Composer
Unable to write keys.dev.pub to: /home/★一般ユーザー名/.composer
</code></pre></div></div>

<p>うん？ .composer という隠しフォルダーができているのか？</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>ls -an
total 64
drwxr-xr-x 9 1000 1000 4096 Mar  7 06:02 .
drwxr-xr-x 3    0    0 4096 Sep 12  2015 ..
～略～
drwxr-xr-x 3    0    0 4096 Mar  7 05:30 .composer
～略～
</code></pre></div></div>

<p>あるようだ。</p>

<p>「Unable to write keys.dev.pub to: /home/ubuntu/.composer」 (stack overflow)<br>
<a href="http://stackoverflow.com/questions/42413910/unable-to-write-keys-dev-pub-to-home-ubuntu-composer" class="autolink" rel="nofollow noopener" target="_blank">http://stackoverflow.com/questions/42413910/unable-to-write-keys-dev-pub-to-home-ubuntu-composer</a></p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>php composer-setup.php
Could not open input file: composer-setup.php
</code></pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>composer
</code></pre></div></div>

<p>composer.json</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>{
    "require": {
        "php-amqplib/php-amqplib": "2.5.*"
    }
}
</code></pre></div></div>

<p>このファイルは、欲しい物を書く欄なのか。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>composer update
</code></pre></div></div>

<p>すると、</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>Cannot create cache directory /home/★一般ユーザー名/.composer/cache/repo/https---packagist.org/, or directory is not writable. Proceeding without cache
Cannot create cache directory /home/★一般ユーザー名/.composer/cache/files/, or directory is not writable. Proceeding without cache
</code></pre></div></div>

<p>といったエラーが出てくる。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>ls -an
total 16
drwxr-xr-x 3    0    0 4096 Mar  7 05:30 .
drwxr-xr-x 9 1000 1000 4096 Mar  7 06:29 ..
drwxr-xr-x 2    0    0 4096 Mar  7 05:30 cache
-rw-r--r-- 1    0    0   13 Mar  7 05:30 .htaccess
</code></pre></div></div>

<p>cacheディレクトリに書込みパーミッションを付けていけばいいのだろうか？</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>chmod 777 cache
chmod: changing permissions of 'cache': Operation not permitted
</code></pre></div></div>

<p>スーパーユーザーになって、一般ユーザーのフォルダーの中にある .composer ディレクトリに行く。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>chmod 777 cache
</code></pre></div></div>

<p>一般ユーザーに戻って、自分のフォルダーの中の composer.json があるところで</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>copmoser update
</code></pre></div></div>

<p>を叩く。何かインストールが始まった。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>Loading composer repositories with package information
Updating dependencies (including require-dev)
Your requirements could not be resolved to an installable set of packages.

  Problem 1
    - php-amqplib/php-amqplib v2.5.2 requires ext-bcmath * -&gt; the requested PHP extension bcmath is missing from your system.
    - php-amqplib/php-amqplib v2.5.1 requires ext-bcmath * -&gt; the requested PHP extension bcmath is missing from your system.
    - php-amqplib/php-amqplib v2.5.0 requires ext-bcmath * -&gt; the requested PHP extension bcmath is missing from your system.
    - Installation request for php-amqplib/php-amqplib 2.5.* -&gt; satisfiable by php-amqplib/php-amqplib[v2.5.0, v2.5.1, v2.5.2].

  To enable extensions, verify that they are enabled in your .ini files:
    - /etc/php/7.0/cli/php.ini
    - /etc/php/7.0/cli/conf.d/10-opcache.ini
    - /etc/php/7.0/cli/conf.d/10-pdo.ini
    - /etc/php/7.0/cli/conf.d/15-xml.ini
    - /etc/php/7.0/cli/conf.d/20-calendar.ini
    - /etc/php/7.0/cli/conf.d/20-ctype.ini
    - /etc/php/7.0/cli/conf.d/20-curl.ini
    - /etc/php/7.0/cli/conf.d/20-dom.ini
    - /etc/php/7.0/cli/conf.d/20-exif.ini
    - /etc/php/7.0/cli/conf.d/20-fileinfo.ini
    - /etc/php/7.0/cli/conf.d/20-ftp.ini
    - /etc/php/7.0/cli/conf.d/20-gettext.ini
    - /etc/php/7.0/cli/conf.d/20-iconv.ini
    - /etc/php/7.0/cli/conf.d/20-json.ini
    - /etc/php/7.0/cli/conf.d/20-mbstring.ini
    - /etc/php/7.0/cli/conf.d/20-phar.ini
    - /etc/php/7.0/cli/conf.d/20-posix.ini
    - /etc/php/7.0/cli/conf.d/20-readline.ini
    - /etc/php/7.0/cli/conf.d/20-shmop.ini
    - /etc/php/7.0/cli/conf.d/20-simplexml.ini
    - /etc/php/7.0/cli/conf.d/20-sockets.ini
    - /etc/php/7.0/cli/conf.d/20-sysvmsg.ini
    - /etc/php/7.0/cli/conf.d/20-sysvsem.ini
    - /etc/php/7.0/cli/conf.d/20-sysvshm.ini
    - /etc/php/7.0/cli/conf.d/20-tokenizer.ini
    - /etc/php/7.0/cli/conf.d/20-wddx.ini
    - /etc/php/7.0/cli/conf.d/20-xmlreader.ini
    - /etc/php/7.0/cli/conf.d/20-xmlwriter.ini
    - /etc/php/7.0/cli/conf.d/20-xsl.ini
  You can also run `php --ini` inside terminal to see which files are used by PHP in CLI mode.
</code></pre></div></div>

<p>４つぐらいエラーが出ているようだ。</p>

<p>update じゃなくて install だったか。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>composer install
Loading composer repositories with package information
Installing dependencies (including require-dev) from lock file
Warning: The lock file is not up to date with the latest changes in composer.json. You may be getting outdated dependencies. Run update to update them.
Nothing to install or update
Generating autoload files
</code></pre></div></div>

<p>うーむ。</p>

<h1>
<span id="bcmath" class="fragment"></span><a href="#bcmath"><i class="fa fa-link"></i></a>bcmath</h1>

<p>「Apparently missing bcmath dependency」 (php-amqplib/php-amqplib)<br>
<a href="https://github.com/php-amqplib/php-amqplib/issues/312" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/php-amqplib/php-amqplib/issues/312</a></p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>composer show --platform
</code></pre></div></div>

<p>「How can I get the <code>bcmath</code> plugin in php5 in Ubuntu?」 (ask ubuntu)<br>
<a href="http://askubuntu.com/questions/416866/how-can-i-get-the-bcmath-plugin-in-php5-in-ubuntu" class="autolink" rel="nofollow noopener" target="_blank">http://askubuntu.com/questions/416866/how-can-i-get-the-bcmath-plugin-in-php5-in-ubuntu</a></p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>sudo apt install php7.0-bcmath
※パスワード入力
</code></pre></div></div>

<p>なんか　インストールが始まった。 bcmath とかいう拡張子が付いたファイルを持つプロジェクトを作るんだろうか？</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>composer update
Loading composer repositories with package information
Updating dependencies (including require-dev)
Package operations: 1 install, 0 updates, 1 removal
  - Removing cocur/slugify (v2.4)
  - Installing php-amqplib/php-amqplib (v2.5.2) Downloading: 100%
Writing lock file
Generating autoload files
</code></pre></div></div>

<p>ようやく　アップデートできたようだ。 cocur/slugify を消したのは良かったのだろうか？<br>
もう１回やり直し。</p>

<p>composer.json</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>{
    "require": {
        "cocur/slugify": "^2.4"
        ,
        "php-amqplib/php-amqplib": "2.5.*"
    }
}
</code></pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>composer update
</code></pre></div></div>

<p><strong>追加で欲しいものを書くというより、欲しい現状を書くのか。</strong></p>

<h1>
<span id="composerphar" class="fragment"></span><a href="#composerphar"><i class="fa fa-link"></i></a>composer.phar</h1>

<p>「Introduction」 (RabbitMQ)<br>
<a href="https://www.rabbitmq.com/tutorials/tutorial-one-php.html" class="autolink" rel="nofollow noopener" target="_blank">https://www.rabbitmq.com/tutorials/tutorial-one-php.html</a></p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>composer.phar install
composer.phar: command not found
</code></pre></div></div>

<p>依然として分からん。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>curl -s https://getcomposer.org/installer | php
</code></pre></div></div>

<p>これをすると composer.phar が取れるんだったか？</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>All settings correct for using Composer
Unable to write keys.dev.pub to: /home/一般ユーザー名/.composer
</code></pre></div></div>

<p>.composer 隠しフォルダーがあるという話しだった。</p>

<p>.phar は PHPのアーカイブ（圧縮ファイル）だろうか？　解凍されてなくなってたりするんだろうか？</p>

<h1>
<span id="varwwwhtml-で" class="fragment"></span><a href="#varwwwhtml-%E3%81%A7"><i class="fa fa-link"></i></a>var/www/html で</h1>

<p>ユーザー・ディレクトリーではなく、var/www/html ディレクトリーで composer を使った方がいいのだろうか？</p>

<p>var/www/html ディレクトリーにも composer.json を置いてみる。</p>

<p>composer.json</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>{
    "require": {
        "php-amqplib/php-amqplib": "2.5.*"
    }
}
</code></pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>composer install
</code></pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>Loading composer repositories with package information
Updating dependencies (including require-dev)
Package operations: 1 install, 0 updates, 0 removals
  - Installing php-amqplib/php-amqplib (v2.5.2) Loading from cache
Writing lock file
Generating autoload files
</code></pre></div></div>

<p>すんなりいった。</p>

<h1>
<span id="dirってどこ" class="fragment"></span><a href="#dir%E3%81%A3%E3%81%A6%E3%81%A9%E3%81%93"><i class="fa fa-link"></i></a><strong>DIR</strong>ってどこ</h1>

<p>tamesi7.php</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>&lt;?php
echo '__DIR__ってどこだぜ☆（＾～＾）？ = ' . __DIR__ ;
</code></pre></div></div>

<p>こういうファイルを作って、実行。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>php tamesi7.php
__DIR__ってどこだぜ☆（＾～＾）？ = /var/www/html
</code></pre></div></div>

<p>ふむ。じゃあ、</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>require_once __DIR__ . '/vendor/autoload.php';
</code></pre></div></div>

<p>は、</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>require_once '/var/www/html/vendor/autoload.php';
</code></pre></div></div>

<p>ということになる。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>/var/www/html/vendor$ ls -an
total 20
drwxrwxr-x 4 1000 1000 4096 Mar  7 07:01 .
drwxr-xrwx 3    0    0 4096 Mar  7 07:03 ..
-rw-rw-r-- 1 1000 1000  178 Mar  7 07:01 autoload.php
drwxrwxr-x 2 1000 1000 4096 Mar  7 07:01 composer
drwxrwxr-x 3 1000 1000 4096 Mar  7 07:01 php-amqplib
</code></pre></div></div>

<p>あるようだ。</p>

<p>PuTTYで実行すると。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>php tamesi5.php
 [x] Sent 'Hello World!'
</code></pre></div></div>

<p>動いているんだが、ブラウザではアクセスできないようだ。パーミッションか？</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code> ls -an
～中略～
-rw-rw-r-- 1 1000 1000   477 Mar  7 06:00 tamesi5.php
</code></pre></div></div>

<p>PHPに実行権限なんか要るんだろうか？ PHPはデータ・ファイルだから実行ファイルではない気がする。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code> php tamesi6.php
 [*] Waiting for messages. To exit press CTRL+C
 [x] Received bear
 [x] Received Hello World!
</code></pre></div></div>

<p>RabbitMQ は動いているんだが、ブラウザからアクセスすると動かない。</p>

<p>HTTP ERROR 500</p>

<h1>
<span id="シュリンクしていくか" class="fragment"></span><a href="#%E3%82%B7%E3%83%A5%E3%83%AA%E3%83%B3%E3%82%AF%E3%81%97%E3%81%A6%E3%81%84%E3%81%8F%E3%81%8B"><i class="fa fa-link"></i></a>シュリンクしていくか？</h1>

<p>数行ずつ調べていこう。</p>

<p>tamesi5a1.php</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>&lt;?php
require_once __DIR__ . '/vendor/autoload.php';
use PhpAmqpLib\Connection\AMQPStreamConnection;
use PhpAmqpLib\Message\AMQPMessage;

echo "3行おっけ☆！（＾▽＾）&lt;br /&gt;\n";
</code></pre></div></div>

<p>これはブラウザで見れる。</p>

<p>tamesi5a2.php</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>&lt;?php
require_once __DIR__ . '/vendor/autoload.php';
use PhpAmqpLib\Connection\AMQPStreamConnection;
use PhpAmqpLib\Message\AMQPMessage;

$connection = new AMQPStreamConnection('localhost', 5672, 'guest', 'guest');
$channel = $connection-&gt;channel();

$channel-&gt;close();
$connection-&gt;close();

echo "接続、チャンネル取得おっけ☆！（＾▽＾）&lt;br /&gt;\n";
</code></pre></div></div>

<p>これもブラウザで見れる。</p>

<p>tamesi5a3.php</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>&lt;?php
require_once __DIR__ . '/vendor/autoload.php';
use PhpAmqpLib\Connection\AMQPStreamConnection;
use PhpAmqpLib\Message\AMQPMessage;

$connection = new AMQPStreamConnection('localhost', 5672, 'guest', 'guest');
$channel = $connection-&gt;channel();

$channel-&gt;queue_declare('hello', false, false, false, false);

$channel-&gt;close();
$connection-&gt;close();

echo "queue_declare 引数５個おっけ☆！（＾▽＾）&lt;br /&gt;\n";
</code></pre></div></div>

<p>これもブラウザで見れる。</p>

<p>tamesi5a4.php</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>&lt;?php
require_once __DIR__ . '/vendor/autoload.php';
use PhpAmqpLib\Connection\AMQPStreamConnection;
use PhpAmqpLib\Message\AMQPMessage;

$connection = new AMQPStreamConnection('localhost', 5672, 'guest', 'guest');
$channel = $connection-&gt;channel();

$channel-&gt;queue_declare('hello', false, false, false, false);

$msg = new AMQPMessage('Hello World!');

$channel-&gt;close();
$connection-&gt;close();

echo "AMQPMessage おっけ☆！（＾▽＾）&lt;br /&gt;\n";
</code></pre></div></div>

<p>これもブラウザで見れる。</p>

<p>tamesi5a5.php</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>&lt;?php
require_once __DIR__ . '/vendor/autoload.php';
use PhpAmqpLib\Connection\AMQPStreamConnection;
use PhpAmqpLib\Message\AMQPMessage;

$connection = new AMQPStreamConnection('localhost', 5672, 'guest', 'guest');
$channel = $connection-&gt;channel();

$channel-&gt;queue_declare('hello', false, false, false, false);

$msg = new AMQPMessage('Hello World!');
$channel-&gt;basic_publish($msg, '', 'hello');

$channel-&gt;close();
$connection-&gt;close();

echo "basic_publish おっけ☆！（＾▽＾）&lt;br /&gt;\n";
</code></pre></div></div>

<p>これ、HTTP ERROR 500。 basic_publish がダメか？</p>

<p>「frame_error on basic_publish」 (pika/pika)<br>
<a href="https://github.com/pika/pika/issues/349" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/pika/pika/issues/349</a></p>

<p>localhost と書いているところが気になるが。IPアドレスに変えても変わりなし。</p>

<h1>
<span id="phpのエラーログは出てないのだろうか" class="fragment"></span><a href="#php%E3%81%AE%E3%82%A8%E3%83%A9%E3%83%BC%E3%83%AD%E3%82%B0%E3%81%AF%E5%87%BA%E3%81%A6%E3%81%AA%E3%81%84%E3%81%AE%E3%81%A0%E3%82%8D%E3%81%86%E3%81%8B"><i class="fa fa-link"></i></a>PHPのエラー・ログは出てないのだろうか？</h1>

<p>「PHPでのログ出力　まとめ」 (Qiita)<br>
<a href="http://qiita.com/junpei_iwa/items/8dc9f62b4118186cf2df" class="autolink" id="reference-5b19c224e7d84f7a2663">http://qiita.com/junpei_iwa/items/8dc9f62b4118186cf2df</a></p>

<p>/etc/php/7.0/apache2 ディレクトリに php.ini はあるが。<br>
スーパーユーザーに変えて、</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>cp php.ini php.ini.original
</code></pre></div></div>

<p>でファイルをコピーしておいて、php.ini の中を見てみる。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>display_errors = Off
</code></pre></div></div>

<p>を、</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>display_errors = On
</code></pre></div></div>

<p>に変える。外に公開していると Off にしないと内部データが見えてしまうが。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>log_errors = On
</code></pre></div></div>

<p>これは On になっていた。<br>
アパッチを再起動したらいいのか？</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>sudo service apache2 restart
</code></pre></div></div>

<p><strong>あれっ？　アパッチを再起動したら、エラーが出るどころか、PHP が動いている？</strong></p>

<p>tamesi5.php は動いたが、tamesi6.php は固まっている。これもシュリンクしてみよう。</p>

<p>tamesi6a1.php</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>&lt;?php
require_once __DIR__ . '/vendor/autoload.php';
use PhpAmqpLib\Connection\AMQPStreamConnection;

$connection = new AMQPStreamConnection('localhost', 5672, 'guest', 'guest');
$channel = $connection-&gt;channel();

$channel-&gt;queue_declare('hello', false, false, false, false);

echo 'queue_declare までおっけ☆（＾▽＾）！', "\n";
</code></pre></div></div>

<p>これはおっけ。</p>

<p>tamesi6a2.php</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>&lt;?php
require_once __DIR__ . '/vendor/autoload.php';
use PhpAmqpLib\Connection\AMQPStreamConnection;

$connection = new AMQPStreamConnection('localhost', 5672, 'guest', 'guest');
$channel = $connection-&gt;channel();

$channel-&gt;queue_declare('hello', false, false, false, false);

echo ' [*] Waiting for messages. To exit press CTRL+C', "\n";

$callback = function($msg) {
  echo " [x] Received ", $msg-&gt;body, "\n";
};

$channel-&gt;basic_consume('hello', '', false, true, false, false, $callback);

echo 'basic_consume までおっけ☆（＾▽＾）！', "\n";
</code></pre></div></div>

<p>これもおっけ。</p>

<p>ところで　ブローカーが止まっている気がする。RabbitMQ を起動させるには　どうやるんだったか。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>rabbitmq-server
ERROR: node with name "rabbit" already running on "★略"
</code></pre></div></div>

<p>動いてるのか。</p>

<h1>
<span id="phpのログの出力先" class="fragment"></span><a href="#php%E3%81%AE%E3%83%AD%E3%82%B0%E3%81%AE%E5%87%BA%E5%8A%9B%E5%85%88"><i class="fa fa-link"></i></a>PHPのログの出力先</h1>

<p>/etc/php/7.0/apache2/php.ini の</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>;error_log = php_errors.log
</code></pre></div></div>

<p>の部分を</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>error_log = /var/log/php_errors.log
</code></pre></div></div>

<p>に変えた。アパッチを再起動。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>sudo service apache2 restart
</code></pre></div></div>

<p>tamesi6a3.php</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>&lt;?php
require_once __DIR__ . '/vendor/autoload.php';
use PhpAmqpLib\Connection\AMQPStreamConnection;

$connection = new AMQPStreamConnection('localhost', 5672, 'guest', 'guest');
$channel = $connection-&gt;channel();

$channel-&gt;queue_declare('hello', false, false, false, false);

echo ' [*] Waiting for messages. To exit press CTRL+C', "\n";

$callback = function($msg) {
  echo " [x] Received ", $msg-&gt;body, "\n";
};

$channel-&gt;basic_consume('hello', '', false, true, false, false, $callback);

$channel-&gt;wait();

echo 'wait() 1回ならおっけ☆（＾▽＾）！', "\n";
</code></pre></div></div>

<p>これはフリーズ。<br>
じゃあ、ウェイトがダメなのか？</p>

<p>tamesi6a4.php</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>&lt;?php
require_once __DIR__ . '/vendor/autoload.php';
use PhpAmqpLib\Connection\AMQPStreamConnection;

$connection = new AMQPStreamConnection('localhost', 5672, 'guest', 'guest');
$channel = $connection-&gt;channel();

$channel-&gt;queue_declare('hello', false, false, false, false);

echo ' [*] Waiting for messages. To exit press CTRL+C', "\n";

$callback = function($msg) {
  echo " [x] Received ", $msg-&gt;body, "\n";
};

$channel-&gt;basic_consume('hello', '', false, true, false, false, $callback);

sleep(3);

echo 'sleep(3)ならおっけ☆（＾▽＾）！', "\n";
</code></pre></div></div>

<p>これもおっけ☆</p>

<p>tamesi6a5.php</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>&lt;?php
require_once __DIR__ . '/vendor/autoload.php';
use PhpAmqpLib\Connection\AMQPStreamConnection;

$connection = new AMQPStreamConnection('localhost', 5672, 'guest', 'guest');
$channel = $connection-&gt;channel();

$channel-&gt;queue_declare('hello', false, false, false, false);

echo ' [*] Waiting for messages. To exit press CTRL+C', "\n";

$callback = function($msg) {
  echo " [x] Received ", $msg-&gt;body, "\n";
};

$channel-&gt;basic_consume('hello', '', false, true, false, false, $callback);

while(count($channel-&gt;callbacks)) {
    sleep(1);
}

echo 'sleep(1)のループならおっけ☆（＾▽＾）！', "\n";
</code></pre></div></div>

<p>これはフリーズ。</p>

<h1>
<span id="rabbitmqctl-list_queues" class="fragment"></span><a href="#rabbitmqctl-list_queues"><i class="fa fa-link"></i></a>rabbitmqctl list_queues</h1>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>rabbitmqctl list_queues
Listing queues ...
1111    0
hello   0
</code></pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>php tamesi5.php
 [x] Sent 'Hello World!'
rabbitmqctl list_queues
Listing queues ...
1111    0
hello   0
</code></pre></div></div>

<p>キューの中身は見れないものか。</p>

<p>非同期ではなく、単にデキューできないのか？</p>

<p>キューに入ってない気もする。</p>

<p>tamesi5a6.php</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>&lt;?php
require_once __DIR__ . '/vendor/autoload.php';
use PhpAmqpLib\Connection\AMQPStreamConnection;
use PhpAmqpLib\Message\AMQPMessage;

$connection = new AMQPStreamConnection('localhost', 5672, 'guest', 'guest');
$channel = $connection-&gt;channel();

$QKey = '1111';
$channel-&gt;queue_declare($QKey, false, false, false, false);

$QMsg = 'Flying Dragon!';
$msg = new AMQPMessage($QMsg);
$channel-&gt;basic_publish($msg, '', $QKey);

echo " [x] Sent '" . $QMsg . "'\n";

$channel-&gt;close();
$connection-&gt;close();
</code></pre></div></div>

<p>キーを 1111 に。</p>

<p>「はじめての RabbitMQ」 (CyberAgent)<br>
<a href="http://ameblo.jp/principia-ca/entry-11233853011.html" class="autolink" rel="nofollow noopener" target="_blank">http://ameblo.jp/principia-ca/entry-11233853011.html</a></p>

<p>tamesi6.php は、[Ctrl]+[C] で止める前提だから、実用できないんじゃないか？</p>

<p><strong>tamesi6.php は　受信用だから、ブラウザでアクセスするもんじゃない</strong>んじゃないか。</p>

<p>$channel-&gt;wait(); が処理をブロックして、コールバック関数を呼び出しているんじゃないか。</p>

<p>tamesi6.php</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>&lt;?php
// サーバーの外部からはアクセスしない。
// サーバーの内側に置いておく、受信用
//
// このプログラムは、コマンドラインで実行する
// php tamesi6.php
//
require_once __DIR__ . '/vendor/autoload.php';
use PhpAmqpLib\Connection\AMQPStreamConnection;

$connection = new AMQPStreamConnection('localhost', 5672, 'guest', 'guest');
$channel = $connection-&gt;channel();

$QKey = '1111';
$channel-&gt;queue_declare($QKey, false, false, false, false);

echo ' [*] Waiting for messages. To exit press CTRL+C', "\n";

$callback = function($msg) {
  echo " [x] Received ", $msg-&gt;body, "\n";
};

$channel-&gt;basic_consume($QKey, '', false, true, false, false, $callback);

// 無限ループ
while(count($channel-&gt;callbacks))
{
    // ブロックする
    $channel-&gt;wait();
}
// ここに来ない
// $channel-&gt;close();
// $connection-&gt;close();
</code></pre></div></div>

<p>じゃあ、受信側はオッケー。</p>

<h1>
<span id="cとphpはメッセージキューを介して通信できんの" class="fragment"></span><a href="#c%E3%81%A8php%E3%81%AF%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E3%82%AD%E3%83%A5%E3%83%BC%E3%82%92%E4%BB%8B%E3%81%97%E3%81%A6%E9%80%9A%E4%BF%A1%E3%81%A7%E3%81%8D%E3%82%93%E3%81%AE"><i class="fa fa-link"></i></a>C#とPHPは、メッセージ・キューを介して通信できんの？</h1>

<p>C# の 1111 と、 PHPの 1111 は同じなのだろうか？見れないようだが。<br>
フォルダー位置とか関係あるのだろうか？</p>

<p>関係あるのは　'localhost', 5672　ぐらいかと思うが。</p>

<h1>
<span id="どうも-c-と-php-のプロセス間通信ができてない" class="fragment"></span><a href="#%E3%81%A9%E3%81%86%E3%82%82-c-%E3%81%A8-php-%E3%81%AE%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E9%96%93%E9%80%9A%E4%BF%A1%E3%81%8C%E3%81%A7%E3%81%8D%E3%81%A6%E3%81%AA%E3%81%84"><i class="fa fa-link"></i></a>どうも C# と PHP のプロセス間通信ができてない</h1>

<p>見ているキューが違うのか。</p>

<ul>
<li>外部から tamesi2.php でエンキューした内容は、外部から tamesi3.php で見れる。（PHP）</li>
<li>外部から tamesi5.php でエンキューした内容は、内部の php tamesi6.php で見れる。（RabbitMQ）</li>
<li>C# でエンキューした内容は、C# でデキューできる。(RabbitMQ)</li>
</ul>

<p>全部　ばらばらだ。<strong>結局、ファイルで仲介するしかないのか？</strong></p>

<p>じゃあ、tamesi6.php を常駐できないか？</p>

<h1>
<span id="foreverコマンド" class="fragment"></span><a href="#forever%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89"><i class="fa fa-link"></i></a>foreverコマンド</h1>

<p>「node.js node.jsスクリプトをforeverでデーモン化する」 (でじうぃき)<br>
<a href="http://onlineconsultant.jp/pukiwiki/?node.js%20node.js%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%82%92forever%E3%81%A7%E3%83%87%E3%83%BC%E3%83%A2%E3%83%B3%E5%8C%96%E3%81%99%E3%82%8B" class="autolink" rel="nofollow noopener" target="_blank">http://onlineconsultant.jp/pukiwiki/?node.js%20node.js%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%82%92forever%E3%81%A7%E3%83%87%E3%83%BC%E3%83%A2%E3%83%B3%E5%8C%96%E3%81%99%E3%82%8B</a></p>

<p>これは node.js 専用だったりしないんだろうか。</p>

<p>「自作プログラムをデーモンとして起動させる」 (<a href="http://7ujm.net" class="autolink" rel="nofollow noopener" target="_blank">http://7ujm.net</a>)<br>
<a href="http://7ujm.net/linux/daemon.html" class="autolink" rel="nofollow noopener" target="_blank">http://7ujm.net/linux/daemon.html</a></p>

<h1>
<span id="nohup" class="fragment"></span><a href="#nohup"><i class="fa fa-link"></i></a>nohup</h1>

<p>「ログアウトしてもバックグラウンド ジョブを継続する方法」 (ソースコード探検隊)<br>
<a href="https://www.codereading.com/nb/ignore-the-hangup-signal.html" class="autolink" rel="nofollow noopener" target="_blank">https://www.codereading.com/nb/ignore-the-hangup-signal.html</a></p>

<p>じゃあ、こんな感じにできるのだろうか？</p>

<p>'''<br>
nohup php tamesi6.php &gt; out.log 2&gt; err.log &lt; /dev/null &amp;<br>
'''</p>

<p>'''<br>
[3] 13092<br>
jobs<br>
[1]+  Stopped                 nano tamesi6.php<br>
[2]   Running                 rabbitmq-server &amp;<br>
[3]-  Running                 nohup php tamesi6.php &gt; out.log 2&gt; err.log &lt; /dev/null &amp;<br>
'''</p>

<p>試しにログアウトしてみる。</p>

<p>su コマンドを使い過ぎたのか、何回も exit した。</p>

<p>'''<br>
jobs<br>
'''</p>

<p>なんにもいなくなったが。</p>

<p>tamesi6.php は無限ループでなかったからか。</p>

<p>じゃあ、tamesi6.php を無限ループで囲って、 /var/www/html フォルダーから /home/watasi/shogi/ukamuse_sdt4/bin フォルダーへ移動しよう。</p>

<h1>
<span id="phpの環境を作ろう" class="fragment"></span><a href="#php%E3%81%AE%E7%92%B0%E5%A2%83%E3%82%92%E4%BD%9C%E3%82%8D%E3%81%86"><i class="fa fa-link"></i></a>PHPの環境を作ろう</h1>

<p>ただ、コンピューター将棋サーバーの環境と混ざってややこしくなってしまう。</p>

<p>ひとまず /home/watasi/shogi/receive というディレクトリを掘ることにする。</p>

<p>'''<br>
/home/csg10/shogi# mkdir receive<br>
'''</p>

<p>この中に PHPプログラム用の環境を作ろう。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>cd receive
</code></pre></div></div>

<p>次のようなファイルを作って置いておく。現状をどのような構成にしたいか書いておくファイルだ。</p>

<p>composer.json</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>{
    "require": {
        "php-amqplib/php-amqplib": "2.5.*"
    }
}
</code></pre></div></div>

<p>コマンドを叩く。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>composer install
</code></pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>Do not run Composer as root/super user! See https://getcomposer.org/root for details
Loading composer repositories with package information
Updating dependencies (including require-dev)
Package operations: 1 install, 0 updates, 0 removals
  - Installing php-amqplib/php-amqplib (v2.5.2) Downloading: 100%
Writing lock file
Generating autoload files
</code></pre></div></div>

<p>ルートユーザーでは走らないと書いてあるが、走っているようだが……。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>ls
composer.json  composer.lock  vendor
</code></pre></div></div>

<p>なんか揃ってるし。PHP専用の環境にしたいんで、ディレクトリー名を php_receive にリネームするか。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>cd ..
ls
receive  ukamuse_sdt4  ukamuse_sdt4.zip
mv receive php_receive
ls
php_receive  ukamuse_sdt4  ukamuse_sdt4.zip
</code></pre></div></div>

<p>じゃあ、ここに tamesi6.php を移動させよう。というか ここに loop6.php を書いて、tamesi6.php は削除しよう。</p>

<h1>
<span id="loop6php-を書く" class="fragment"></span><a href="#loop6php-%E3%82%92%E6%9B%B8%E3%81%8F"><i class="fa fa-link"></i></a>loop6.php を書く</h1>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>cd php_receive
nano loop6.php
</code></pre></div></div>

<p>でも ログアウトしたらなんで nohup でバックグラウンド起動した PHP が落ちたのだろうか。<br>
PHP が大元から落ちたのだろうか？</p>

<p>「nohup: run PHP process in background」 (stack overflow)<br>
<a href="http://stackoverflow.com/questions/5288584/nohup-run-php-process-in-background" class="autolink" rel="nofollow noopener" target="_blank">http://stackoverflow.com/questions/5288584/nohup-run-php-process-in-background</a></p>

<p>絶対パスで指定した方がいいのか。</p>

<p>loop6.php</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>&lt;?php
// 受信用
// サーバーの外部からはアクセスしない。
// サーバーの内側に置いて無限ループさせる
//
// このプログラムは、コマンドラインで実行する
//

// 操作説明を出力しておこう。ログファイルに出力されるんだろうが……
echo 'How to use'                 . "\n";
echo '=========='                 . "\n";
echo                                "\n";
echo '    Start infinity loop'    . "\n";
echo '    -------------------'    . "\n";
echo '        After ( nohup php /home/★user/shogi/php_receive/loop6.php &gt; /home/★user/shogi/php_log/loop6.out.log 2&gt; /home/★user/shogi/php_log/loop6.err.log &lt; /dev/null &amp; )' . "\n";
echo '        By absolute path.'  . "\n";
echo                                "\n";
echo '    To finish kill'         . "\n";
echo '    --------------'         . "\n";
echo '        jobs'               . "\n";
echo '        kill %(job number)' . "\n";

require_once __DIR__ . '/vendor/autoload.php';
use PhpAmqpLib\Connection\AMQPStreamConnection;

// プロセス間通信の前準備をするぜ☆（＾～＾）
$connection = new AMQPStreamConnection('localhost', 5672, 'guest', 'guest');
$channel = $connection-&gt;channel();
$QKey = '1111';
$channel-&gt;queue_declare($QKey, false, false, false, false);

// キューを開いてしまえば、あとは無限ループ！

// デキューしたタイミングですることをここに書く
$callback = function($msg) {
    echo " [x] Received ", $msg-&gt;body, "\n";
};
$channel-&gt;basic_consume($QKey, '', false, true, false, false, $callback);

// 無限ループ
while(count($channel-&gt;callbacks))
{
    // ここでブロックしながらデキューする
    $channel-&gt;wait();
}
// ここに来ない
// $channel-&gt;close();
// $connection-&gt;close();
</code></pre></div></div>

<p>ログフォルダーはここにする。<br>
/home/★user/shogi/php_log/</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>/home/user/shogi# mkdir php_log
ls
php_log  php_receive  ukamuse_sdt4  ukamuse_sdt4.zip
</code></pre></div></div>

<h1>
<span id="動かしてみよう" class="fragment"></span><a href="#%E5%8B%95%E3%81%8B%E3%81%97%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86"><i class="fa fa-link"></i></a>動かしてみよう</h1>

<p>http://★.★.★.★/tamesi5.php</p>

<p>へアクセス。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>[x] Sent 'Flying Dragon!'
</code></pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>cd ..
ls
php_log  php_receive  ukamuse_sdt4  ukamuse_sdt4.zip
cd php_log
ls
loop6.err.log  loop6.out.log
nano loop6.out.log
</code></pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>How to use
==========

    Start infinity loop
    -------------------
        After ( nohup php /home/★user/shogi/php_receive/loop6.php &gt; /home/★user$
        By absolute path.

    To finish kill
    --------------
        jobs
        kill %(job number)
 [x] Received Flying Dragon!
</code></pre></div></div>

<p>よし、１行書き足されている。次はログアウトする。そしてログインし直す。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>sudo su -
※パスワード入力
jobs
</code></pre></div></div>

<p>空っぽだ。</p>

<p>「Run php script on background in PHP with nohup CLI」 (stack overflow)<br>
<a href="http://stackoverflow.com/questions/9100872/run-php-script-on-background-in-php-with-nohup-cli" class="autolink" rel="nofollow noopener" target="_blank">http://stackoverflow.com/questions/9100872/run-php-script-on-background-in-php-with-nohup-cli</a></p>

<p>php コマンドも絶対パスで指定しろ、ということか。</p>

<p>php を /usr/bin/php に書き直す。これ、コメントか。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>echo '        After ( nohup /usr/bin/php /home/★user/shogi/php_receive/loop6.php &gt; /home/★user/shogi/php_log/loop6.out.log 2&gt; /home/★user/shogi/php_log/loop6.err.log &lt; /dev/null &amp; )' . "\n";
</code></pre></div></div>

<p>走らせて、ログアウト、ログイン。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>jobs
</code></pre></div></div>

<p>で空っぽ。</p>

<p>「ログアウトした後もプログラムの処理を続ける？（コマンド実行時にnohup）」 (kazmax)<br>
<a href="http://kazmax.zpp.jp/linux_beginner/nohup.html" class="autolink" rel="nofollow noopener" target="_blank">http://kazmax.zpp.jp/linux_beginner/nohup.html</a></p>

<p>パーミッションだろうか？</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>ls -an
total 12
drwxr-xr-x 2 0 0 4096 Mar  7 19:09 .
drwxr-xrwx 5 0 0 4096 Mar  7 18:49 ..
-rw-r--r-- 1 0 0    0 Mar  7 19:06 loop6.err.log
-rw-r--r-- 1 0 0  358 Mar  7 19:06 loop6.out.log
</code></pre></div></div>

<p>ルート・ユーザーで実行しているんだから　問題ないような気もするが、<br>
一般ユーザーのディレクトリーに置いてあることは問題か？</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>chmod 666 loop6.err.log
chmod 666 loop6.out.log
ls -an
～中略～
-rw-rw-rw- 1 0 0    0 Mar  7 19:06 loop6.err.log
-rw-rw-rw- 1 0 0  358 Mar  7 19:06 loop6.out.log
</code></pre></div></div>

<p>これでどうか？</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>logout
sudo su -
jobs
</code></pre></div></div>

<p>空っぽになっている。</p>

<p>「sshでログアウトしたあともコマンドを実行し続けたいときのnohupとscreen」 (don-bra.co)<br>
<a href="http://asayamakk.hatenablog.com/entry/2016/04/09/213904" class="autolink" rel="nofollow noopener" target="_blank">http://asayamakk.hatenablog.com/entry/2016/04/09/213904</a></p>

<p>「ログアウトしてもプログラムを実行させる」 (inamuu)<br>
<a href="http://wiki.inamuu.com/index.php?%E3%83%AD%E3%82%B0%E3%82%A2%E3%82%A6%E3%83%88%E3%81%97%E3%81%A6%E3%82%82%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0%E3%82%92%E5%AE%9F%E8%A1%8C%E3%81%95%E3%81%9B%E3%82%8B" class="autolink" rel="nofollow noopener" target="_blank">http://wiki.inamuu.com/index.php?%E3%83%AD%E3%82%B0%E3%82%A2%E3%82%A6%E3%83%88%E3%81%97%E3%81%A6%E3%82%82%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0%E3%82%92%E5%AE%9F%E8%A1%8C%E3%81%95%E3%81%9B%E3%82%8B</a></p>

<p>disown と top を調べてみるか。</p>

<p>「HUPシグナルとnohupとdisownとバック/フォアグラウンドジョブの理解」 (Qiita)<br>
<a href="http://qiita.com/yushin/items/732043ee23281f19f983" class="autolink" id="reference-1329b6f32eedfb94a93a">http://qiita.com/yushin/items/732043ee23281f19f983</a></p>

<p>「nohup コマンド &amp;」 は　やってるんだがなぁ。</p>

<p>「技術/UNIX/なぜnohupをバックグランドジョブとして起動するのが定番なのか？(擬似端末, Pseudo Terminal, SIGHUP他)」 (<a href="http://www.glamenv-septzen.net" rel="nofollow noopener" target="_blank">www.glamenv-septzen.net</a>)<br>
<a href="https://www.glamenv-septzen.net/view/854" class="autolink" rel="nofollow noopener" target="_blank">https://www.glamenv-septzen.net/view/854</a></p>

<p>「nohup コマンド &amp;」 をやって jobs が空っぽになるんだがなぁ。</p>

<p>「Run a nohup command over SSH, then disconnect」 (Ubuntu)<br>
<a href="http://askubuntu.com/questions/349262/run-a-nohup-command-over-ssh-then-disconnect" class="autolink" rel="nofollow noopener" target="_blank">http://askubuntu.com/questions/349262/run-a-nohup-command-over-ssh-then-disconnect</a></p>

<h1>
<span id="一般ユーザーで-putty-を使って-sshプロトコルでログインしてnohup-コマンド-をやって-exit-して再度ログインするとjobs-は空っぽ" class="fragment"></span><a href="#%E4%B8%80%E8%88%AC%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E3%81%A7-putty-%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6-ssh%E3%83%97%E3%83%AD%E3%83%88%E3%82%B3%E3%83%AB%E3%81%A7%E3%83%AD%E3%82%B0%E3%82%A4%E3%83%B3%E3%81%97%E3%81%A6nohup-%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89-%E3%82%92%E3%82%84%E3%81%A3%E3%81%A6-exit-%E3%81%97%E3%81%A6%E5%86%8D%E5%BA%A6%E3%83%AD%E3%82%B0%E3%82%A4%E3%83%B3%E3%81%99%E3%82%8B%E3%81%A8jobs-%E3%81%AF%E7%A9%BA%E3%81%A3%E3%81%BD"><i class="fa fa-link"></i></a>一般ユーザーで PuTTY を使って SSHプロトコルでログインして、「nohup コマンド &amp;」をやって exit して再度ログインすると、jobs は空っぽ。</h1>

<p>どこから手を付けるべきか。</p>

<h1>
<span id="ジョブとプロセスは違う" class="fragment"></span><a href="#%E3%82%B8%E3%83%A7%E3%83%96%E3%81%A8%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E3%81%AF%E9%81%95%E3%81%86"><i class="fa fa-link"></i></a>ジョブとプロセスは違う</h1>

<p>「ログアウトしてもプログラムを実行し続ける」 (Linuxコマンド逆引き大全)<br>
<a href="http://itpro.nikkeibp.co.jp/article/COLUMN/20060228/231191/" class="autolink" rel="nofollow noopener" target="_blank">http://itpro.nikkeibp.co.jp/article/COLUMN/20060228/231191/</a></p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>ps
  PID TTY          TIME CMD
21573 pts/1    00:00:00 bash
21924 pts/1    00:00:00 ps
</code></pre></div></div>

<p>プロセスもいないが。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>nohup /usr/bin/php /home/★user/shogi/php_receive/loop6.php &gt; /home/★user/shogi/php_log/loop6.out.log 2&gt; /home/★user/shogi/php_log/loop6.err.log &lt; /dev/null &amp;
 ps
  PID TTY          TIME CMD
21573 pts/1    00:00:00 bash
21955 pts/1    00:00:00 php
21956 pts/1    00:00:00 ps
</code></pre></div></div>

<p>ここからスーパーユーザーにログインしてみる。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>sudo su -
ps
  PID TTY          TIME CMD
21971 pts/1    00:00:00 sudo
21972 pts/1    00:00:00 su
21973 pts/1    00:00:00 bash
21989 pts/1    00:00:00 ps
</code></pre></div></div>

<h1>
<span id="シェルスクリプトならどうか" class="fragment"></span><a href="#%E3%82%B7%E3%82%A7%E3%83%AB%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%81%AA%E3%82%89%E3%81%A9%E3%81%86%E3%81%8B"><i class="fa fa-link"></i></a>シェル・スクリプトならどうか？</h1>

<p>PHPプロセスが消えているんじゃないか。</p>

<p>じゃあ、シェル・スクリプトなら消えないのか？</p>

<p>「bash で無限ループ」 (ablog)<br>
<a href="http://d.hatena.ne.jp/yohei-a/20090524/1243171328" class="autolink" rel="nofollow noopener" target="_blank">http://d.hatena.ne.jp/yohei-a/20090524/1243171328</a></p>

<p>loop8.sh</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>#!/bin/bash
# 無限ループの置物
while :
do
    # ここに処理を書く
    sleep 1m
done
</code></pre></div></div>

<p>「Linux / UNIX: Bash Script Sleep or Delay a Specified Amount of Time」 (nixCraft)<br>
<a href="https://www.cyberciti.biz/faq/linux-unix-sleep-bash-scripting/" class="autolink" rel="nofollow noopener" target="_blank">https://www.cyberciti.biz/faq/linux-unix-sleep-bash-scripting/</a></p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>mkdir bash_receive
mkdir bash_log
cd bash_receive
nano loop8.sh
</code></pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>nohup /home/★user/shogi/bash_receive/loop8.sh &gt; /home/★user/shogi/bash_log/loop8.out.log 2&gt; /home/★user/shogi/bash_log/loop8.err.log &lt; /dev/null &amp;
[1] 22338
jobs
[1]+  Exit 126                nohup /home/★user/shogi/bash_receive/loop8.sh &gt; /home/★user/shogi/bash_log/loop8.out.log 2&gt; /home/★user/shogi/bash_log/loop8.err.log &lt; /dev/null
ps
  PID TTY          TIME CMD
21971 pts/1    00:00:00 sudo
21972 pts/1    00:00:00 su
21973 pts/1    00:00:00 bash
22262 pts/1    00:00:00 ps
</code></pre></div></div>

<p>これで bash プロセスが loop8.sh を実行するジョブをやっているのか。<br>
もう１回</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>jobs
</code></pre></div></div>

<p>空っぽだ。Exit してるんじゃないか。</p>

<h1>
<span id="記事が長くなったので次の記事に移る" class="fragment"></span><a href="#%E8%A8%98%E4%BA%8B%E3%81%8C%E9%95%B7%E3%81%8F%E3%81%AA%E3%81%A3%E3%81%9F%E3%81%AE%E3%81%A7%E6%AC%A1%E3%81%AE%E8%A8%98%E4%BA%8B%E3%81%AB%E7%A7%BB%E3%82%8B"><i class="fa fa-link"></i></a>記事が長くなったので、次の記事に移る。</h1>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Fmuzudho1%2Fitems%2Fbf3f6debf6db7f96300c&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Fmuzudho1%2Fitems%2Fbf3f6debf6db7f96300c&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/muzudho1/items/bf3f6debf6db7f96300c/likers" class="css-1iupg5d">0</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">0</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/bf3f6debf6db7f96300c/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/muzudho1/items/bf3f6debf6db7f96300c/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/muzudho1/items/bf3f6debf6db7f96300c/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/muzudho1/items/bf3f6debf6db7f96300c/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/muzudho1/items/bf3f6debf6db7f96300c.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-f46b2a4a-abb4-4628-a6cb-8e69e867d765">{"authorAnalyticsTrackingId":null,"organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-b5f0e345-47ae-410c-bd0d-0fafa487e0c2"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-b5f0e345-47ae-410c-bd0d-0fafa487e0c2">{}</script>
      
<div id="LoginModal-react-component-36adf31f-edfa-4c95-bf96-d9556015041c"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-36adf31f-edfa-4c95-bf96-d9556015041c">{}</script>
      
<div id="StockModal-react-component-e0f80c4e-3e05-4e7d-beb7-4bec75ece99c"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-e0f80c4e-3e05-4e7d-beb7-4bec75ece99c">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;6aOZVRXtOJ2wBg3Q4TkBnSMicJQzLKPxHb94bUl5OfD1PGDOAK0ixnEha7GbaWfFVfrWFwLGdsbSsIrCEEwerQ==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\u003cp\u003e前回の記事: 「＜その１＞」 \u003ca href=\"http://qiita.com/muzudho1/items/af3537d36f16c063a572\" class=\"autolink\" id=\"reference-bfc60da48dec57f06190\"\u003ehttp://qiita.com/muzudho1/items/af3537d36f16c063a572\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"ubuntuでプロセス間通信しよう\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#ubuntu%E3%81%A7%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E9%96%93%E9%80%9A%E4%BF%A1%E3%81%97%E3%82%88%E3%81%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eUbuntuでプロセス間通信しよう\u003c/h1\u003e\n\n\u003cp\u003eエラーが出る……、RabbitMQっていったい何メッセージ・キューだ？ \u003c/p\u003e\n\n\u003cp\u003e(RabbitMQ)\u003cbr\u003e\n\u003ca href=\"https://www.rabbitmq.com/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://www.rabbitmq.com/\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e「RabbitMQ Configuration」 (RabbitMQ)\u003cbr\u003e\n\u003ca href=\"https://www.rabbitmq.com/configure.html\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://www.rabbitmq.com/configure.html\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e設定ファイル\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003enode           : rabbit@example\nhome dir       : /var/lib/rabbitmq\nconfig file(s) : /etc/rabbitmq/rabbitmq.config\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eログファイル\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003enode           : rabbit@example\nhome dir       : /var/lib/rabbitmq\nconfig file(s) : /var/lib/rabbitmq/hare.config (not found)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eうーむ、broker という単語も出てくるがよくわからない。\u003cbr\u003e\nトラブル・シューティングのページは無いものか。\u003c/p\u003e\n\n\u003cp\u003e「Introduction」 (RabbitMQ)\u003cbr\u003e\n\u003ca href=\"https://www.rabbitmq.com/tutorials/tutorial-one-dotnet.html\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://www.rabbitmq.com/tutorials/tutorial-one-dotnet.html\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e公式のサンプル・プログラムを見ると、わたしの知ってるサンプル・プログラムよりも難しいことをしている。\u003c/p\u003e\n\n\u003cp\u003eRabbitMQ.Client.dll というライブラリは サーバーの中にあるのだろうか。どうやって調べるんだろうか？\u003c/p\u003e\n\n\u003cp\u003e「特定のファイルが含まれるパッケージを探す」 (Qiita)\u003cbr\u003e\n\u003ca href=\"http://qiita.com/Yuichirou/items/38165af29ab1e2d307f6\" class=\"autolink\" id=\"reference-1573067a763446120b3d\"\u003ehttp://qiita.com/Yuichirou/items/38165af29ab1e2d307f6\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eじゃあ\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eapt-file search RabbitMQ.Client.dll\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eみたいな感じでいいんだろうか？\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eThe program 'apt-file' is currently not installed. You can install it by typing:\napt install apt-file\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eじゃあまず、インストールから。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eapt install apt-file\n～中略～\nThe system-wide cache is empty. You may want to run 'apt-file update'\nas root to update the cache. You can also run 'apt-file update' as\nnormal user to use a cache in the user's home directory.\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eじゃあ次、アップデート。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eapt-file update\n～中略～\n\nFile is up-to-date.\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eじゃあまた検索。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eapt-file search RabbitMQ.Client.dll\nlibmono-rabbitmq4.0-cil: /usr/lib/mono/4.5/RabbitMQ.Client.dll\nlibmono-rabbitmq4.0-cil: /usr/lib/mono/gac/RabbitMQ.Client/4.0.0.0__b03f5f7f11d50a3a/RabbitMQ.Client.dll\nmono-dbg: /usr/lib/mono/gac/RabbitMQ.Client/4.0.0.0__b03f5f7f11d50a3a/RabbitMQ.Client.dll.mdb\nmono-reference-assemblies-2.0: /usr/lib/mono/2.0/RabbitMQ.Client.dll\nmono-reference-assemblies-4.0: /usr/lib/mono/4.0/RabbitMQ.Client.dll\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eほうほう、RabbitMQ.Client.dll は入ってるぜ。\u003c/p\u003e\n\n\u003cp\u003eファクトリーを作って、コネクションを確立して、チャンネルを開け、と書いてあるな。\u003cbr\u003e\nサンプル・プログラムを書いてみるか。\u003c/p\u003e\n\n\u003cp\u003e続く。\u003c/p\u003e\n\n\u003cp\u003eSystem.Messaging ネームスペースを使ってると RabbitQL は見えないようにしているんじゃないか。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003enano MsgQueue.cs\nmcs /reference:System.Messaging.dll MsgQueue.cs\n ./MsgQueue.exe\n選べだぜ☆（＾～＾）\n1   : メッセージ箱 作成\n2   : メッセージ   送信\n3   : メッセージ   受信\n4   : メッセージ箱 削除\nquit: 終了\n\n1\nmq.BasePriority = 0\n\nUnhandled Exception:\nSystem.NotImplementedException: The method or operation is not implemented.\n  at Mono.Messaging.RabbitMQ.RabbitMQMessageQueue.get_CanRead () \u0026lt;0x408d0100 + 0x00017\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at System.Messaging.MessageQueue.get_CanRead () \u0026lt;0x408d0090 + 0x00020\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at (wrapper remoting-invoke-with-check) System.Messaging.MessageQueue:get_CanRead ()\n  at MsgQueue.Program.Main (System.String[] args) \u0026lt;0x4089dd50 + 0x001ff\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n[ERROR] FATAL UNHANDLED EXCEPTION: System.NotImplementedException: The method or operation is not implemented.\n  at Mono.Messaging.RabbitMQ.RabbitMQMessageQueue.get_CanRead () \u0026lt;0x408d0100 + 0x00017\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at System.Messaging.MessageQueue.get_CanRead () \u0026lt;0x408d0090 + 0x00020\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at (wrapper remoting-invoke-with-check) System.Messaging.MessageQueue:get_CanRead ()\n  at MsgQueue.Program.Main (System.String[] args) \u0026lt;0x4089dd50 + 0x001ff\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eありゃ、CanRead プロパティー使えないのか。コンパイル通ってるのに、なんで使えないんだ？\u003c/p\u003e\n\n\u003cp\u003eWindows だと\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003emq.AccessMode = SendAndReceive\nmq.Authenticate = False\nmq.BasePriority = 0\nmq.CanRead = True\nmq.CanWrite = True\nmq.Category = 00000000-0000-0000-0000-000000000000\nmq.Container =\nmq.CreateTime = 2017/03/06 18:13:13\nmq.DefaultPropertiesToSend = System.Messaging.DefaultPropertiesToSend\nmq.DenySharedReceive = False\nmq.EncryptionRequired = Optional\nmq.FormatName = DIRECT=OS:takahashi-pc\\Private$\\testqueue\nmq.Formatter = System.Messaging.XmlMessageFormatter\nmq.Id = 00000000-0000-0000-0000-000000000000\nmq.Label =\nmq.LastModifyTime = 2017/03/06 18:13:13\nmq.MachineName = .\nmq.MaximumJournalSize = 4294967295\nmq.MaximumQueueSize = 4294967295\nmq.MessageReadPropertyFilter = System.Messaging.MessagePropertyFilter\nmq.MulticastAddress =\nmq.Path = .\\Private$\\testqueue\nmq.QueueName = Private$\\testqueue\nmq.ReadHandle = 1788\nmq.Site =\nmq.SynchronizingObject =\nmq.Transactional = False\nmq.UseJournalQueue = False\nmq.WriteHandle = 1588\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこんな感じでプロパティは読めるので、実装がないとしたら　実際　未実装なのか。\u003cbr\u003e\nインストールとかできないのか？\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"rabbitmq-を入手した方がいいのでは\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#rabbitmq-%E3%82%92%E5%85%A5%E6%89%8B%E3%81%97%E3%81%9F%E6%96%B9%E3%81%8C%E3%81%84%E3%81%84%E3%81%AE%E3%81%A7%E3%81%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eRabbitMQ を入手した方がいいのでは？\u003c/h1\u003e\n\n\u003cp\u003eSystem.Messaging を使ってるのが間違いなのか？\u003c/p\u003e\n\n\u003cp\u003e「How do I use RabbitMQ on Mono on Linux」 (stack overflow)\u003cbr\u003e\n\u003ca href=\"http://stackoverflow.com/questions/28020761/how-do-i-use-rabbitmq-on-mono-on-linux\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://stackoverflow.com/questions/28020761/how-do-i-use-rabbitmq-on-mono-on-linux\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"erlang-アーランをダウンロードしよう\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#erlang-%E3%82%A2%E3%83%BC%E3%83%A9%E3%83%B3%E3%82%92%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89%E3%81%97%E3%82%88%E3%81%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eErlang （アーラン）をダウンロードしよう\u003c/h1\u003e\n\n\u003cp\u003eRabbitMQをインストールする前に、Erlang をインストールしてくれって出てきた。\u003c/p\u003e\n\n\u003cp\u003e「DOWNLOAD OTP 19.2」 (ERLANG)\u003cbr\u003e\n\u003ca href=\"http://www.erlang.org/downloads\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://www.erlang.org/downloads\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eじゃあ、Windows 64bit 用バイナリをダウンロードするか。\u003c/p\u003e\n\n\u003cp\u003eえっ！　ダウンロードまで 2時間 1時間 2時間 40分……、なんだろう、どんな細い回線を通ってダウンロードされてくるんだろう。\u003c/p\u003e\n\n\u003cp\u003e自宅の回線が細くなったんじゃないか。その間に他の作業からやろう。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"php-と-メッセージキューは通信できるのか\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#php-%E3%81%A8-%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E3%82%AD%E3%83%A5%E3%83%BC%E3%81%AF%E9%80%9A%E4%BF%A1%E3%81%A7%E3%81%8D%E3%82%8B%E3%81%AE%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ePHP と メッセージ・キューは通信できるのか？\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"メッセージキューには次のものがあるはずだ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E3%82%AD%E3%83%A5%E3%83%BC%E3%81%AB%E3%81%AF%E6%AC%A1%E3%81%AE%E3%82%82%E3%81%AE%E3%81%8C%E3%81%82%E3%82%8B%E3%81%AF%E3%81%9A%E3%81%A0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eメッセージ・キューには次のものがあるはずだ\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003eキューの既存確認\u003c/li\u003e\n\u003cli\u003eキューの作成\u003c/li\u003e\n\u003cli\u003eキューへ送信\u003c/li\u003e\n\u003cli\u003eキューから受信\u003c/li\u003e\n\u003cli\u003eキューの削除\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003ePHP ではどれに当てはまるだろう？\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eキューの作成または取得 msg_get_queue()\u003c/li\u003e\n\u003cli\u003eキューへ送信 msg_send()\u003c/li\u003e\n\u003cli\u003eキューから受信 msg_receive()\u003c/li\u003e\n\u003cli\u003eキューの削除 msg_remove_queue()\u003c/li\u003e\n\u003cli\u003emsg_set_queue() メッセージの設定\u003c/li\u003e\n\u003cli\u003emsg_stat_queue() メッセージの取得\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eそれぞれ調べてみよう。\u003c/p\u003e\n\n\u003cp\u003e「msg_get_queue」 (PHPマニュアル)\u003cbr\u003e\n\u003ca href=\"http://php.net/manual/ja/function.msg-get-queue.php\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://php.net/manual/ja/function.msg-get-queue.php\u003c/a\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e$MSGKey = \"123456\" ; \n\n## Create or attach to a message queue\n$seg = msg_get_queue($MSGKey) ;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eメッセージのキーが数字というのはどういうことだろう。/Private$/testqueue みたいな文字列じゃないならどうやって C# と PHP で同じキューを見にいくんだろう。\u003c/p\u003e\n\n\u003cp\u003e「RabbitMQ + php-amqplib でメッセージキューイング試してみた」 (Qiita)\u003cbr\u003e\n\u003ca href=\"http://qiita.com/imunew/items/d93917c0344f5ef1abce\" class=\"autolink\" id=\"reference-dddb80ef3d3f6f90e8f6\"\u003ehttp://qiita.com/imunew/items/d93917c0344f5ef1abce\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e「新人プログラマに知ってもらいたいRabbitMQ初心者の入門の入門」 (Qiita)\u003cbr\u003e\n\u003ca href=\"http://qiita.com/gambaray/items/3cc02b419c860a96bc94\" class=\"autolink\" id=\"reference-e9764a7208b3ddb452e0\"\u003ehttp://qiita.com/gambaray/items/3cc02b419c860a96bc94\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e「RabbitMQ の導入」 (Qiita)\u003cbr\u003e\n\u003ca href=\"http://qiita.com/taka1970/items/fa783304b7a71b7921e5\" class=\"autolink\" id=\"reference-dec40bbc1ff4bf3c208e\"\u003ehttp://qiita.com/taka1970/items/fa783304b7a71b7921e5\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"linuxの環境変数\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#linux%E3%81%AE%E7%92%B0%E5%A2%83%E5%A4%89%E6%95%B0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eLinuxの環境変数？\u003c/h1\u003e\n\n\u003cp\u003e「System.Messaging」 (Mono)\u003cbr\u003e\n\u003ca href=\"http://www.mono-project.com/archived/systemmessaging/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://www.mono-project.com/archived/systemmessaging/\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eLinux で System.Messaging を使おうと思ったら、環境変数を定義する必要があるんだろうか？\u003c/p\u003e\n\n\u003cp\u003eそれとも Windowsの話しだろうか。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"erlang-をダウンロードしたぞ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#erlang-%E3%82%92%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89%E3%81%97%E3%81%9F%E3%81%9E\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eERLANG をダウンロードしたぞ\u003c/h1\u003e\n\n\u003cp\u003eWindows 上に RabbitMQ + ERLANG の環境を構築したい。ローカルテスト用に。\u003cbr\u003e\nダウンロードしてきたERLANGの .exe を叩いてインストールした。次は RabbitMQ か。\u003c/p\u003e\n\n\u003cp\u003eRabbitMQ のインストールを進める。ファイアウォールに２回ブロックされてるが許可して進めた。\u003c/p\u003e\n\n\u003cp\u003eじゃあ C# で\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eusing RabbitMQ.Client;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eとか使えるようになったんだろうか？　調べてみよう。\u003c/p\u003e\n\n\u003cp\u003eそんな様子はどこにもなく。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"rabbitmqclientdll-を探すか\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#rabbitmqclientdll-%E3%82%92%E6%8E%A2%E3%81%99%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eRabbitMQ.Client.dll を探すか\u003c/h1\u003e\n\n\u003cp\u003eC:\\Program Files\\RabbitMQ Server フォルダーの中には無い。\u003cbr\u003e\nというか Unity が持っている。\u003c/p\u003e\n\n\u003cp\u003e正規的には、どこから入手するんだろうか。\u003c/p\u003e\n\n\u003cp\u003e「.NET/C# RabbitMQ client library」 (RabbitMQ)\u003cbr\u003e\n\u003ca href=\"https://www.rabbitmq.com/dotnet.html\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://www.rabbitmq.com/dotnet.html\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"nugetパッケージ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#nuget%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eNuGetパッケージ\u003c/h1\u003e\n\n\u003cp\u003eNuGetパッケージを使ってインストールしてください、とあるが NuGetパッケージとは何か。\u003c/p\u003e\n\n\u003cp\u003e「RabbitMQ .NETクライアント 4.1.1」 (nuget)\u003cbr\u003e\n\u003ca href=\"https://www.nuget.org/packages/RabbitMQ.Client\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://www.nuget.org/packages/RabbitMQ.Client\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"パッケージマネージャコンソールって何だ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%83%9E%E3%83%8D%E3%83%BC%E3%82%B8%E3%83%A3%E3%82%B3%E3%83%B3%E3%82%BD%E3%83%BC%E3%83%AB%E3%81%A3%E3%81%A6%E4%BD%95%E3%81%A0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eパッケージマネージャコンソールって何だ？\u003c/h2\u003e\n\n\u003cp\u003e「パッケージマネージャコンソール」 (Microsoft)\u003cbr\u003e\n\u003ca href=\"https://docs.microsoft.com/ja-jp/nuget/tools/package-manager-console\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://docs.microsoft.com/ja-jp/nuget/tools/package-manager-console\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eVisual Studio 2015 を使っていて今まで気づかなかったが、\u003cbr\u003e\nメインメニューから [Tools] - [NuGet Package Manager] - [Package Manager Console] と進める。\u003c/p\u003e\n\n\u003cp\u003eすると　いつも　エラーとか検索結果が出ていたペインに Package Manager Console が出てきて入力を促している。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ePM\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eじゃあ、入力してみる。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ePM\u0026gt; Install-Package RabbitMQ.Client -Version 4.1.1\nAttempting to gather dependencies information for package 'RabbitMQ.Client.4.1.1' with respect to project 'UsagiMQ', targeting '.NETFramework,Version=v4.5.2'\nAttempting to resolve dependencies for package 'RabbitMQ.Client.4.1.1' with DependencyBehavior 'Lowest'\nResolving actions to install package 'RabbitMQ.Client.4.1.1'\nResolved actions to install package 'RabbitMQ.Client.4.1.1'\nAdding package 'RabbitMQ.Client.4.1.1' to folder 'C:\\Users\\Takahashi\\Documents\\muzudho\\Shogi_Ubuntu\\UsagiMQ\\packages'\nAdded package 'RabbitMQ.Client.4.1.1' to folder 'C:\\Users\\Takahashi\\Documents\\muzudho\\Shogi_Ubuntu\\UsagiMQ\\packages'\nAdded package 'RabbitMQ.Client.4.1.1' to 'packages.config'\nSuccessfully installed 'RabbitMQ.Client 4.1.1' to UsagiMQ\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003cstrong\u003eおーっ！\u003c/strong\u003e\u003c/p\u003e\n\n\u003cp\u003eじゃあ今どきは　ホームページからファイルをダウンロードするより、NuGet を使ってファイルをダウンロードした方がいいのか。\u003c/p\u003e\n\n\u003cp\u003eすると、C# 言語で\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eusing RabbitMQ.Client;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eと書いてもエラーにならなくなった。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"rabbitmq-のサンプルプログラムを書いてみよう\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#rabbitmq-%E3%81%AE%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0%E3%82%92%E6%9B%B8%E3%81%84%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eRabbitMQ のサンプル・プログラムを書いてみよう。\u003c/h1\u003e\n\n\u003cp\u003e「Introduction」 (RabbitMQ)\u003cbr\u003e\n\u003ca href=\"https://www.rabbitmq.com/tutorials/tutorial-one-dotnet.html\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://www.rabbitmq.com/tutorials/tutorial-one-dotnet.html\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eサンプルプログラムをコピペ実行すると 文字のやりとりをやってるみたいなんだが、\u003cbr\u003e\n前回の記事みたいに「コンピューターの管理」からいける「メッセージ キュー」の中にはなんにも入ってないようで、送信と受信の２つがないと　ちゃんと　やりとりしてるのかテストできないんだな。\u003c/p\u003e\n\n\u003cp\u003eじゃあ、これ別に２つのプログラムにしなくても　１つのプログラムにまとめられそうなので、まとめてみるか。\u003c/p\u003e\n\n\u003cp\u003e長くなったが、これでいけた。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eRabbitMQ.Client\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eRabbitMQ.Client.Events\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Text\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eUsagiMQ\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eProgram\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eHOST_NAME\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"localhost\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eQUEUE_NAME\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"hello\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eMain\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(;;)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e@\"選べだぜ☆（＾～＾）\n1   : メッセージ   送信\n2   : メッセージ   受信\nquit: 終了\n\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n                \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ecategory\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(;;)\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eline\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReadLine\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003eswitch\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eline\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                        \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e\"1\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003ecategory\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003egoto\u003c/span\u003e \u003cspan class=\"n\"\u003egt_EndLoop1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                        \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e\"2\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003ecategory\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003egoto\u003c/span\u003e \u003cspan class=\"n\"\u003egt_EndLoop1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                        \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e\"quit\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003egoto\u003c/span\u003e \u003cspan class=\"n\"\u003egt_Quit\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                        \u003cspan class=\"k\"\u003edefault\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                \u003cspan class=\"n\"\u003egt_EndLoop1\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n                \u003cspan class=\"k\"\u003eswitch\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecategory\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                            \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e@\"メッセージを書いて[Enter]キーを押せだぜ☆（＾～＾）\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                            \u003cspan class=\"c1\"\u003e// \"Hello World!\" などを入力\u003c/span\u003e\n                            \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eline\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReadLine\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n                            \u003cspan class=\"nf\"\u003eSend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eline\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                        \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nf\"\u003eReceive\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"n\"\u003egt_Quit\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eSend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003efactory\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eConnectionFactory\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003eHostName\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eHOST_NAME\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003econnection\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003efactory\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateConnection\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003echannel\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003econnection\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateModel\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eQueueDeclare\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003equeue\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eQUEUE_NAME\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                                         \u003cspan class=\"n\"\u003edurable\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                                         \u003cspan class=\"n\"\u003eexclusive\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                                         \u003cspan class=\"n\"\u003eautoDelete\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                                         \u003cspan class=\"n\"\u003earguments\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n                    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ebody\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eEncoding\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUTF8\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetBytes\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n                    \u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eBasicPublish\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eexchange\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                                         \u003cspan class=\"n\"\u003eroutingKey\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eQUEUE_NAME\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                                         \u003cspan class=\"n\"\u003ebasicProperties\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                                         \u003cspan class=\"n\"\u003ebody\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003ebody\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\" Sent(^q^) {0}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n            \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\" Press [enter] to menu.\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReadLine\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eReceive\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003efactory\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eConnectionFactory\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003eHostName\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eHOST_NAME\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003econnection\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003efactory\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateConnection\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003echannel\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003econnection\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateModel\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eQueueDeclare\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003equeue\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eQUEUE_NAME\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                                         \u003cspan class=\"n\"\u003edurable\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                                         \u003cspan class=\"n\"\u003eexclusive\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                                         \u003cspan class=\"n\"\u003eautoDelete\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                                         \u003cspan class=\"n\"\u003earguments\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n                    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003econsumer\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eEventingBasicConsumer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                    \u003cspan class=\"c1\"\u003e// 受信できたときに割り込んでくる処理\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003econsumer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eReceived\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emodel\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eea\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ebody\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eea\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBody\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eEncoding\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUTF8\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetString\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebody\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\" [interrupt!] Received(^q^) {0}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eBasicConsume\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003equeue\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eQUEUE_NAME\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                                         \u003cspan class=\"n\"\u003enoAck\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                                         \u003cspan class=\"n\"\u003econsumer\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003econsumer\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n                    \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\" Please, wait receiving... Or Press [enter] to menu.\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReadLine\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれ、Ubuntuでコンパイルできるんだろうか？　やってみよう。\u003c/p\u003e\n\n\u003cp\u003eじゃあ、前に書いたプログラムは捨てるぜ。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003erm MsgQueue.cs\nnano MsgQueue.cs\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003emcs MsgQueue.cs\nMsgQueue.cs(1,7): error CS0246: The type or namespace name `RabbitMQ' could not be found. Are you missing an assembly reference?\nMsgQueue.cs(2,7): error CS0246: The type or namespace name `RabbitMQ' could not be found. Are you missing an assembly reference?\nCompilation failed: 2 error(s), 0 warnings\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eじゃあ、こうか。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003emcs /reference:RabbitMQ.Client.dll MsgQueue.cs\nmcs /reference:RabbitMQ.C             lient.dll MsgQueue.cs\nMsgQueue.cs(63,29): error CS1501: No overload for method `QueueDeclare' takes `5             ' arguments\n/usr/lib/mono/4.5/RabbitMQ.Client.dll (Location of the symbol related to previou             s error)\nMsgQueue.cs(90,29): error CS1501: No overload for method `QueueDeclare' takes `5             ' arguments\n/usr/lib/mono/4.5/RabbitMQ.Client.dll (Location of the symbol related to previou             s error)\nMsgQueue.cs(96,36): error CS1729: The type `RabbitMQ.Client.Events.EventingBasic             Consumer' does not contain a constructor that takes `1' arguments\n/usr/lib/mono/4.5/RabbitMQ.Client.dll (Location of the symbol related to previou             s error)\nMsgQueue.cs(105,42): error CS1739: The best overloaded method match for `RabbitM             Q.Client.IModel.BasicConsume(string, System.Collections.IDictionary, RabbitMQ.Cl             ient.IBasicConsumer)' does not contain a parameter named `noAck'\n/usr/lib/mono/4.5/RabbitMQ.Client.dll (Location of the symbol related to previou             s error)\nMsgQueue.cs(104,29): error CS1502: The best overloaded method match for `RabbitM             Q.Client.IModel.BasicConsume(string, System.Collections.IDictionary, RabbitMQ.Cl             ient.IBasicConsumer)' has some invalid arguments\n/usr/lib/mono/4.5/RabbitMQ.Client.dll (Location of the symbol related to previou             s error)\nMsgQueue.cs(105,49): error CS1503: Argument `#2' cannot convert `bool' expressio             n to type `System.Collections.IDictionary'\nCompilation failed: 6 error(s), 0 warnings\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eなんか RabbitMQ.Client.dll のバージョンとか古いという話しだろうか。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"rabbitmqclientdll-のアップグレードの方法を調べてみよう\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#rabbitmqclientdll-%E3%81%AE%E3%82%A2%E3%83%83%E3%83%97%E3%82%B0%E3%83%AC%E3%83%BC%E3%83%89%E3%81%AE%E6%96%B9%E6%B3%95%E3%82%92%E8%AA%BF%E3%81%B9%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eRabbitMQ.Client.dll のアップグレードの方法を調べてみよう。\u003c/h1\u003e\n\n\u003cp\u003e「Installing on Debian / Ubuntu」 (RabbitMQ)\u003cbr\u003e\n\u003ca href=\"https://www.rabbitmq.com/install-debian.html\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://www.rabbitmq.com/install-debian.html\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eなんだか分からんが　書かれているコマンド打っていこう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eecho 'deb http://www.rabbitmq.com/debian/ testing main' | sudo tee /etc/apt/sources.list.d/rabbitmq.list\ndeb http://www.rabbitmq.com/debian/ testing main\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eなんか URL のようなものが出てきた。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003esudo apt-get update\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eなんか動いたが、うまくいったのか、何も起こらなかったのか、エラーなのかなんなのか　わからん。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003esudo apt-get install rabbitmq-server\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eなんか進んで終わった。\u003c/p\u003e\n\n\u003cp\u003eなんか追加するらしい。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003egpg --keyserver pgpkeys.mit.edu --recv-key 7638D0442B90D010\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003egpg -a --export 7638D0442B90D010 | sudo apt-key add -\nOK\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eecho 'deb http://ftp.debian.org/debian wheezy-backports main' | sudo tee /etc/apt/sources.list.d/wheezy_backports.list\ndeb http://ftp.debian.org/debian wheezy-backports main\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eまだなんか追加するらしい。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ewget -O- https://packages.erlang-solutions.com/debian/erlang_solutions.asc | sudo apt-key add -\nOK\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eecho 'deb https://packages.erlang-solutions.com/debian wheezy contrib' | sudo tee /etc/apt/sources.list.d/esl.list\ndeb https://packages.erlang-solutions.com/debian wheezy contrib\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eアップグレードだ。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003esudo apt-get update\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003esudo apt-get install init-system-helpers socat esl-erlang\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eなんかいっぱいインストールされた。次は RabbitMQ の何か。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ewget -O- https://www.rabbitmq.com/rabbitmq-release-signing-key.asc | sudo apt-key add -\nOK\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eecho 'deb http://www.rabbitmq.com/debian/ testing main' | sudo tee /etc/apt/sources.list.d/rabbitmq.list\ndeb http://www.rabbitmq.com/debian/ testing main\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003esudo apt-get update\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003esudo apt-get install rabbitmq-server\n0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれでいいのだろうか？\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003emcs /reference:RabbitMQ.Client.dll MsgQueue.cs\nMsgQueue.cs(63,29): error CS1501: No overload for method `QueueDeclare' takes `5' arguments\n/usr/lib/mono/4.5/RabbitMQ.Client.dll (Location of the symbol related to previous error)\nMsgQueue.cs(90,29): error CS1501: No overload for method `QueueDeclare' takes `5' arguments\n/usr/lib/mono/4.5/RabbitMQ.Client.dll (Location of the symbol related to previous error)\nMsgQueue.cs(96,36): error CS1729: The type `RabbitMQ.Client.Events.EventingBasicConsumer' does not contain a constructor that takes `1' arguments\n/usr/lib/mono/4.5/RabbitMQ.Client.dll (Location of the symbol related to previous error)\nMsgQueue.cs(105,42): error CS1739: The best overloaded method match for `RabbitMQ.Client.IModel.BasicConsume(string, System.Collections.IDictionary, RabbitMQ.Client.IBasicConsumer)' does not contain a parameter named `noAck'\n/usr/lib/mono/4.5/RabbitMQ.Client.dll (Location of the symbol related to previous error)\nMsgQueue.cs(104,29): error CS1502: The best overloaded method match for `RabbitMQ.Client.IModel.BasicConsume(string, System.Collections.IDictionary, RabbitMQ.Client.IBasicConsumer)' has some invalid arguments\n/usr/lib/mono/4.5/RabbitMQ.Client.dll (Location of the symbol related to previous error)\nMsgQueue.cs(105,49): error CS1503: Argument `#2' cannot convert `bool' expression to type `System.Collections.IDictionary'\nCompilation failed: 6 error(s), 0 warnings\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eうーん、引数が5個のQueueDeclareメソッドが無いとか、何だ。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"サンプルプログラムでは引数が５個\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0%E3%81%A7%E3%81%AF%E5%BC%95%E6%95%B0%E3%81%8C%EF%BC%95%E5%80%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eサンプル・プログラムでは引数が５個\u003c/h1\u003e\n\n\u003cp\u003e「Error: “No OverLoad For Method 'ExecuteInsert' takes '5' argument” [closed]」 (stack overflow)\u003cbr\u003e\n\u003ca href=\"http://stackoverflow.com/questions/14638880/error-no-overload-for-method-executeinsert-takes-5-argument\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://stackoverflow.com/questions/14638880/error-no-overload-for-method-executeinsert-takes-5-argument\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eじゃあ、Windows 10 では問題なく動くサンプル・プログラムのここがダメなのか？\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e                    channel.QueueDeclare(queue: QUEUE_NAME,\n                                         durable: false,\n                                         exclusive: false,\n                                         autoDelete: false,\n                                         arguments: null);\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eじゃあ　どうすればいいのか……。\u003cbr\u003e\nエラーの別の部分も見てみよう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eRabbitMQ.Client.dll (Location of the symbol related to previous error)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003emono -V\nMono JIT compiler version 4.2.1 (Debian 4.2.1.102+dfsg2-7ubuntu4)\nCopyright (C) 2002-2014 Novell, Inc, Xamarin Inc and Contributors. www.mono-project.com\n        TLS:           __thread\n        SIGSEGV:       altstack\n        Notifications: epoll\n        Architecture:  amd64\n        Disabled:      none\n        Misc:          softdebug\n        LLVM:          supported, not enabled.\n        GC:            sgen\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"ubuntu-で-nuget-って使えるの\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#ubuntu-%E3%81%A7-nuget-%E3%81%A3%E3%81%A6%E4%BD%BF%E3%81%88%E3%82%8B%E3%81%AE\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eUbuntu で NuGet って使えるの？\u003c/h1\u003e\n\n\u003cp\u003e「Introduction」 (RabbitMQ)\u003cbr\u003e\n\u003ca href=\"https://www.rabbitmq.com/tutorials/tutorial-one-dotnet.html\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://www.rabbitmq.com/tutorials/tutorial-one-dotnet.html\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eC#コンパイラには mcs を使っていたが、csc の方がいいんだろうか？\u003c/p\u003e\n\n\u003cp\u003e「mcsの最新情報と今後の展望について」 (ものがたり)\u003cbr\u003e\n\u003ca href=\"http://atsushieno.hatenablog.com/entry/2014/12/11/000240\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://atsushieno.hatenablog.com/entry/2014/12/11/000240\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003ecsc がマイクロソフトのC#コンパイラで、\u003cbr\u003e\nmcs がmono のC#コンパイラだろうか。\u003c/p\u003e\n\n\u003cp\u003eUbuntuにcsc を入れれるだろうか。\u003c/p\u003e\n\n\u003cp\u003e「UbuntuServerに、Mono環境を構築する」 (Qiita)\u003cbr\u003e\n\u003ca href=\"http://qiita.com/takanemu/items/52888d324df3d367d4c1\" class=\"autolink\" id=\"reference-5375a86195bed971c441\"\u003ehttp://qiita.com/takanemu/items/52888d324df3d367d4c1\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003emono-csc というコマンドがあるんだろうか？\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003emono-csc /r:\"RabbitMQ.Client.dll\" MsgQueue.cs\nMsgQueue.cs(61,21): error CS1501: No overload for method `QueueDeclare' takes `5' arguments\n/usr/lib/mono/4.5/RabbitMQ.Client.dll (Location of the symbol related to previous error)\nMsgQueue.cs(76,21): error CS1501: No overload for method `QueueDeclare' takes `5' arguments\n/usr/lib/mono/4.5/RabbitMQ.Client.dll (Location of the symbol related to previous error)\nMsgQueue.cs(78,46): error CS1729: The type `RabbitMQ.Client.Events.EventingBasicConsumer' does not contain a constructor that takes `1' arguments\n/usr/lib/mono/4.5/RabbitMQ.Client.dll (Location of the symbol related to previous error)\nMsgQueue.cs(86,21): error CS1502: The best overloaded method match for `RabbitMQ.Client.IModel.BasicConsume(string, System.Collections.IDictionary, RabbitMQ.Client.IBasicConsumer)' has some invalid arguments\n/usr/lib/mono/4.5/RabbitMQ.Client.dll (Location of the symbol related to previous error)\nMsgQueue.cs(86,46): error CS1503: Argument `#2' cannot convert `bool' expression to type `System.Collections.IDictionary'\nCompilation failed: 5 error(s), 0 warnings\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eあるようだがエラーだ。 QueueDeclare の仕様はどうなっているのか？\u003c/p\u003e\n\n\u003cp\u003e「QueueDeclare(String,Boolean,Boolean,Boolean,Boolean,Boolean,IDictionary) Method」 (\u003ca href=\"http://docs.spring.io\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://docs.spring.io\u003c/a\u003e)\u003cbr\u003e\n\u003ca href=\"http://docs.spring.io/spring-amqp-net/docs/1.0.x/api/html/Spring.Messaging.Amqp.Rabbit~Spring.Messaging.Amqp.Rabbit.Connection.CachedModel~QueueDeclare(String,Boolean,Boolean,Boolean,Boolean,Boolean,IDictionary).html\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://docs.spring.io/spring-amqp-net/docs/1.0.x/api/html/Spring.Messaging.Amqp.Rabbit~Spring.Messaging.Amqp.Rabbit.Connection.CachedModel~QueueDeclare(String,Boolean,Boolean,Boolean,Boolean,Boolean,IDictionary).html\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eUbuntuの RabbitMQ が古いバージョンなんだろうか。さっきアップグレードしたと思うんだが。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"rabbitmq-の停止と起動\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#rabbitmq-%E3%81%AE%E5%81%9C%E6%AD%A2%E3%81%A8%E8%B5%B7%E5%8B%95\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eRabbitMQ の停止と起動\u003c/h1\u003e\n\n\u003cp\u003e「RabbitMQを試してみる」 (shinodogg.com)\u003cbr\u003e\n\u003ca href=\"https://shinodogg.com/?p=4641\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://shinodogg.com/?p=4641\u003c/a\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003erabbitmqctl stop\nStopping and halting node 'rabbit@tk2-217-18401' ...\nError: unable to connect to node ～以下略～\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e停止しようとしたらエラーが出た。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e rabbitmq-server\n\n              RabbitMQ 3.6.6. Copyright (C) 2007-2016 Pivotal Software, Inc.\n  ##  ##      Licensed under the MPL.  See http://www.rabbitmq.com/\n  ##  ##\n  ##########  Logs: /var/log/rabbitmq/～略～\n  ######  ##        /var/log/rabbitmq/～略～\n  ##########\n              Starting broker...\n completed with 0 plugins.\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e起動はうまくいったんだろうか？\u003c/p\u003e\n\n\u003cp\u003e[Ctrl]+[Z] で止めて\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e[1]+  Stopped                 rabbitmq-server\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ebg 1\n[1]+ rabbitmq-server \u0026amp;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eして、\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003emcs /r:\"RabbitMQ.Client.dll\" MsgQueue.cs\nMsgQueue.cs(61,21): error CS1501: No overload for method `QueueDeclare' takes `5' arguments\n/usr/lib/mono/4.5/RabbitMQ.Client.dll (Location of the symbol related to previous error)\nMsgQueue.cs(76,21): error CS1501: No overload for method `QueueDeclare' takes `5' arguments\n/usr/lib/mono/4.5/RabbitMQ.Client.dll (Location of the symbol related to previous error)\nMsgQueue.cs(78,46): error CS1729: The type `RabbitMQ.Client.Events.EventingBasicConsumer' does not contain a constructor that takes `1' arguments\n/usr/lib/mono/4.5/RabbitMQ.Client.dll (Location of the symbol related to previous error)\nMsgQueue.cs(86,21): error CS1502: The best overloaded method match for `RabbitMQ.Client.IModel.BasicConsume(string, System.Collections.IDictionary, RabbitMQ.Client.IBasicConsumer)' has some invalid arguments\n/usr/lib/mono/4.5/RabbitMQ.Client.dll (Location of the symbol related to previous error)\nMsgQueue.cs(86,46): error CS1503: Argument `#2' cannot convert `bool' expression to type `System.Collections.IDictionary'\nCompilation failed: 5 error(s), 0 warnings\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e関係無いのか。\u003c/p\u003e\n\n\u003cp\u003e「[RabbitMQ]RabbitMQをUbuntuにインストールしてサンプルと管理画面を動かしてみる」 (ズッキーニのプログラミング実験場)\u003cbr\u003e\n\u003ca href=\"http://zuqqhi2.com/install-rabbitmq\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://zuqqhi2.com/install-rabbitmq\u003c/a\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003esudo /etc/init.d/rabbitmq-server status\n● rabbitmq-server.service - RabbitMQ broker\n   Loaded: loaded (/lib/systemd/system/rabbitmq-server.service; enabled; vendor preset: enabled)\n   Active: inactive (dead) since Mon 2017-03-06 21:27:42 JST; 1h 16min ago\n Main PID: 23830 (code=killed, signal=TERM)\n   Status: \"Exited.\"\n\nMar 06 21:20:39 tk2-217-18401 rabbitmq-server[23830]:   ######  ##        /var/log/rabbitmq/★～略～.log\nMar 06 21:20:39 tk2-217-18401 rabbitmq-server[23830]:   ##########\nMar 06 21:20:39 tk2-217-18401 rabbitmq-server[23830]:               Starting broker...\nMar 06 21:20:41 tk2-217-18401 rabbitmq-server[23830]: systemd unit for activation check: \"rabbitmq-server.service\"\nMar 06 21:20:41 tk2-217-18401 systemd[1]: Started RabbitMQ broker.\nMar 06 21:20:42 tk2-217-18401 rabbitmq-server[23830]:  completed with 0 plugins.\nMar 06 21:27:40 tk2-217-18401 systemd[1]: Stopping RabbitMQ broker...\nMar 06 21:27:42 tk2-217-18401 rabbitmqctl[24821]: Stopping and halting node 'rabbit@★～略～' ...\nMar 06 21:27:42 tk2-217-18401 rabbitmq-server[23830]: Gracefully halting Erlang VM\nMar 06 21:27:42 tk2-217-18401 systemd[1]: Stopped RabbitMQ broker.\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eさっぱりわからん。\u003c/p\u003e\n\n\u003cp\u003e「Vagrant上のUbuntuにRabbitMQをたててMQTTをお試し」 (braitom's Tech Memo)\u003cbr\u003e\n\u003ca href=\"http://braitom.hatenablog.com/entry/2015/05/16/004515\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://braitom.hatenablog.com/entry/2015/05/16/004515\u003c/a\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003esudo /etc/init.d/rabbitmq-server restart\n[....] Restarting rabbitmq-server (via systemctl): rabbitmq-server.serviceGracefully halting Erlang VM\nJob for rabbitmq-server.service failed because the control process exited with error code. See \"systemctl status rabbitmq-server.service\" and \"journalctl -xe\" for details.\n failed!\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれもよくわからんがエラー。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"プロセス間通信以外の方法があるだろうか\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E9%96%93%E9%80%9A%E4%BF%A1%E4%BB%A5%E5%A4%96%E3%81%AE%E6%96%B9%E6%B3%95%E3%81%8C%E3%81%82%E3%82%8B%E3%81%A0%E3%82%8D%E3%81%86%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eプロセス間通信以外の方法があるだろうか？\u003c/h1\u003e\n\n\u003cp\u003e接続の確立だけやろうとしたら\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eSystem.Net.Sockets.SocketException: Connection refused\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eだし、\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003esudo rabbitmq-server\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eを打ち込むと止まってしまう。ただ、[Ctrl]+[Z] から\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ebg 1\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eとして再度\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e./MsgQueue.exe\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eとすると、接続の確立まではいけるようだ。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"じゃあ-queuedeclare-の引数はいくつだったらいいのか\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%98%E3%82%83%E3%81%82-queuedeclare-%E3%81%AE%E5%BC%95%E6%95%B0%E3%81%AF%E3%81%84%E3%81%8F%E3%81%A4%E3%81%A0%E3%81%A3%E3%81%9F%E3%82%89%E3%81%84%E3%81%84%E3%81%AE%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eじゃあ、 QueueDeclare の引数はいくつだったらいいのか？\u003c/h1\u003e\n\n\u003cp\u003e別の解法を探す時間と、わたしのバグ探し能力で押し通すのとどっちが速いだろうか。\u003cbr\u003e\nじゃあ 試しに 7個の引数でやってみよう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eroot@tk2-217-18401:/home/csg10/shogi/ukamuse_sdt4/bin# nano MsgQueue.cs\nroot@tk2-217-18401:/home/csg10/shogi/ukamuse_sdt4/bin# mcs /r:\"RabbitMQ.Client.dll\" MsgQueue.cs\nMsgQueue.cs(64,21): error CS1502: The best overloaded method match for `RabbitMQ.Client.IModel.QueueDeclare(string, bool, bool, bool, bool, bool, System.Collections.IDictionary)' has some invalid arguments\n/usr/lib/mono/4.5/RabbitMQ.Client.dll (Location of the symbol related to previous error)\nMsgQueue.cs(64,67): error CS1503: Argument `#5' cannot convert `null' expression to type `bool'\nCompilation failed: 2 error(s), 0 warnings\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e関数のプロトタイプがでてきてくれた。引数は、\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003estring\u003c/li\u003e\n\u003cli\u003ebool\u003c/li\u003e\n\u003cli\u003ebool\u003c/li\u003e\n\u003cli\u003ebool\u003c/li\u003e\n\u003cli\u003ebool\u003c/li\u003e\n\u003cli\u003ebool\u003c/li\u003e\n\u003cli\u003eSystem.Collections.IDictionary\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eのようだ。これは　いつのバージョンの QueueDeclare なんだろうか？\u003c/p\u003e\n\n\u003cp\u003eネット上に落ちている Spring.Messaging.Amqp.Rabbit では、\u003c/p\u003e\n\n\u003cp\u003e「QueueDeclare(String,Boolean,Boolean,Boolean,Boolean,Boolean,IDictionary) Method」 (\u003ca href=\"http://docs.spring.io\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://docs.spring.io\u003c/a\u003e)\u003cbr\u003e\n\u003ca href=\"http://docs.spring.io/spring-amqp-net/docs/1.0.x/api/html/Spring.Messaging.Amqp.Rabbit~Spring.Messaging.Amqp.Rabbit.Connection.CachedModel~QueueDeclare(String,Boolean,Boolean,Boolean,Boolean,Boolean,IDictionary).html\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://docs.spring.io/spring-amqp-net/docs/1.0.x/api/html/Spring.Messaging.Amqp.Rabbit~Spring.Messaging.Amqp.Rabbit.Connection.CachedModel~QueueDeclare(String,Boolean,Boolean,Boolean,Boolean,Boolean,IDictionary).html\u003c/a\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003epublic string QueueDeclare( \n   string queue,\n   bool passive,\n   bool durable,\n   bool exclusive,\n   bool autoDelete,\n   bool nowait,\n   IDictionary arguments\n)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eで、RabbitMQ では\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003echannel.QueueDeclare(queue: \"hello\",\n                                 durable: false,\n                                 exclusive: false,\n                                 autoDelete: false,\n                                 arguments: null);\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eなので、どういうことなのか。第2引数 passive と 第6引数 nowait に適当に false でも入れておけばいいのか？\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003enano MsgQueue.cs\nmcs /r:\"RabbitMQ.Client.dll\" MsgQueue.cs\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e引数７つにしたら　コンパイルは通った。\u003cbr\u003e\n引数の数が異なるメソッドはまだある。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eEventingBasicConsumer consumer = new EventingBasicConsumer(channel);\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこのコンストラクタ。引数が１つではないらしいのだ。じゃあ null でも追加して引数を２つにしてみる。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003emcs /r:\"RabbitMQ.Client.dll\" MsgQueue.cs\nMsgQueue.cs(87,45): error CS1729: The type `RabbitMQ.Client.Events.EventingBasicConsumer' does not contain a constructor that takes `2' arguments\n/usr/lib/mono/4.5/RabbitMQ.Client.dll (Location of the symbol related to previous error)\nCompilation failed: 1 error(s), 0 warnings\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eまずは　引数の数を当てないと　関数のプロトタイプは表示されないのか。\u003cbr\u003e\nじゃあ　自然数のように伸びていこう。\u003c/p\u003e\n\n\u003cp\u003e引数の数が 0 の場合\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e mcs /r:\"RabbitMQ.Client.dll\" MsgQueue.cs\nMsgQueue.cs(87,34): warning CS0219: The variable `consumer' is assigned but its value is never used\nCompilation succeeded - 1 warning(s)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eいけるのか。\u003c/p\u003e\n\n\u003cp\u003e古いドキュメントを見ると。\u003c/p\u003e\n\n\u003cp\u003e「public class EventingBasicConsumer」 (\u003ca href=\"http://www.rabbitmq.com\" rel=\"nofollow noopener\" target=\"_blank\"\u003ewww.rabbitmq.com\u003c/a\u003e)\u003cbr\u003e\n\u003ca href=\"https://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v1.4.0/rabbitmq-dotnet-client-1.4.0-net-2.0-htmldoc/type-RabbitMQ.Client.Events.EventingBasicConsumer.html\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v1.4.0/rabbitmq-dotnet-client-1.4.0-net-2.0-htmldoc/type-RabbitMQ.Client.Events.EventingBasicConsumer.html\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eコンストラクターの引数は 0 個だが、じゃあチャンネルはどうやって渡すのか？\u003c/p\u003e\n\n\u003cp\u003eとりあえず先に進む。 UbuntuのRabbitMQ は v1.4 なのだろうか？\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003emcs /r:\"RabbitMQ.Client.dll\" MsgQueue.cs\nMsgQueue.cs(97,21): error CS1502: The best overloaded method match for `RabbitMQ.Client.IModel.BasicConsume(string, System.Collections.IDictionary, RabbitMQ.Client.IBasicConsumer)' has some invalid arguments\n/usr/lib/mono/4.5/RabbitMQ.Client.dll (Location of the symbol related to previous error)\nMsgQueue.cs(97,46): error CS1503: Argument `#2' cannot convert `bool' expression to type `System.Collections.IDictionary'\nCompilation failed: 2 error(s), 0 warnings\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eBasicConsume メソッドの引数がおかしいらしい。\u003c/p\u003e\n\n\u003cp\u003ev1.4では、IModelのBasicConsume はいくつか種類がある。\u003c/p\u003e\n\n\u003cp\u003e「BasicConsume」 (\u003ca href=\"http://www.rabbitmq.com\" rel=\"nofollow noopener\" target=\"_blank\"\u003ewww.rabbitmq.com\u003c/a\u003e)\u003cbr\u003e\n\u003ca href=\"https://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v1.4.0/rabbitmq-dotnet-client-1.4.0-net-2.0-htmldoc/type-RabbitMQ.Client.IModel.html#method-M:RabbitMQ.Client.IModel.BasicConsume(System.UInt16,System.String,System.Boolean,System.Collections.IDictionary,RabbitMQ.Client.IBasicConsumer)\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v1.4.0/rabbitmq-dotnet-client-1.4.0-net-2.0-htmldoc/type-RabbitMQ.Client.IModel.html#method-M:RabbitMQ.Client.IModel.BasicConsume(System.UInt16,System.String,System.Boolean,System.Collections.IDictionary,RabbitMQ.Client.IBasicConsumer)\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eRabbitMQ では\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003echannel.BasicConsume(queue: \"hello\",\n                                 noAck: true,\n                                 consumer: consumer);\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eだが、v1.4では\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003estring BasicConsume(ushort ticket, string queue, bool noAck, IDictionary filter, IBasicConsumer consumer)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこの形が近いだろうか。そこで 第1引数には 0 でも、第4引数には null でも入れておく。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003emcs /r:\"RabbitMQ.Client.dll\" MsgQueue.cs\nMsgQueue.cs(99,21): error CS1502: The best overloaded method match for `RabbitMQ.Client.IModel.BasicConsume(string, bool, string, System.Collections.IDictionary, RabbitMQ.Client.IBasicConsumer)' has some invalid arguments\n/usr/lib/mono/4.5/RabbitMQ.Client.dll (Location of the symbol related to previous error)\nMsgQueue.cs(99,35): error CS1503: Argument `#1' cannot convert `int' expression to type `string'\nCompilation failed: 2 error(s), 0 warnings\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e思ってたのと違うようだ。\u003cbr\u003e\n- string\u003cbr\u003e\n- bool\u003cbr\u003e\n- string\u003cbr\u003e\n- System.Collections.IDictionary\u003cbr\u003e\n- RabbitMQ.Client.IBasicConsumer\u003c/p\u003e\n\n\u003cp\u003eこれはなんだろうか。並びが似ているのはこれだ。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003estring BasicConsume(ushort ticket, string queue, bool noAck, string consumerTag, IDictionary filter, IBasicConsumer consumer)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e最初の ticket が無いとすれば、consumerTag に空文字列、filter に null でも入れておけばいいだろうか？\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003emcs /r:\"RabbitMQ.Client.dll\" MsgQueue.cs\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eひとまず、コンパイラは通った。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"実行してみよう\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%9F%E8%A1%8C%E3%81%97%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e実行してみよう\u003c/h1\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e./MsgQueue.exe\n選べだぜ☆（＾～＾）\n1   : メッセージ   送信\n2   : メッセージ   受信\nquit: 終了\n\n1\nメッセージを書いて[Enter]キーを押せだぜ☆（＾～＾）\nAlphaBeta\n Sent(^q^) AlphaBeta\n Press [enter] to menu.\n\n選べだぜ☆（＾～＾）\n1   : メッセージ   送信\n2   : メッセージ   受信\nquit: 終了\n\n2\n Please, wait receiving... Or Press [enter] to menu.\n [interrupt!] Received(^q^) AlphaBeta\n\n選べだぜ☆（＾～＾）\n1   : メッセージ   送信\n2   : メッセージ   受信\nquit: 終了\n\nquit\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e動いたようだ。最後の quit でループを抜けれないのは　なんでか分からないが……。\u003cbr\u003e\nこのときバックグラウンドでは\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ejobs\n[1]+  Running                 sudo rabbitmq-server \u0026amp;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003esudo rabbitmq-server \u0026amp;\u003cbr\u003e\nが動いていた。関係あるだろうか。\u003c/p\u003e\n\n\u003cp\u003eじゃあ、\u003cstrong\u003eUbuntu に入っている RabbitMQ は v1.4 に似てちょっと違う何か\u003c/strong\u003e ということが分かった。\u003cbr\u003e\nなぜサイトで公開されている最新版と一致しないのか？\u003c/p\u003e\n\n\u003cp\u003e「Verify version of rabbitmq」 (stack overflow)\u003cbr\u003e\n\u003ca href=\"http://stackoverflow.com/questions/7593269/verify-version-of-rabbitmq\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://stackoverflow.com/questions/7593269/verify-version-of-rabbitmq\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eRabbitMQ のバージョンを確認してみよう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003esudo rabbitmqctl status\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eStatus of node 'rabbit@★～略～' ...\n[{pid,28875},\n {running_applications,[{rabbit,\"RabbitMQ\",\"3.6.6\"},\n                        {os_mon,\"CPO  CXC 138 46\",\"2.4.1\"},\n                        {ranch,\"Socket acceptor pool for TCP protocols.\",\n                               \"1.2.1\"},\n                        {rabbit_common,[],\"3.6.6\"},\n                        {xmerl,\"XML parser\",\"1.3.12\"},\n                        {mnesia,\"MNESIA  CXC 138 12\",\"4.14.1\"},\n                        {sasl,\"SASL  CXC 138 11\",\"3.0.1\"},\n                        {stdlib,\"ERTS  CXC 138 10\",\"3.1\"},\n                        {kernel,\"ERTS  CXC 138 10\",\"5.1\"}]},\n {os,{unix,linux}},\n {erlang_version,\"Erlang/OTP 19 [erts-8.1] [source-e7be63d] [64-bit] [smp:2:2] [async-threads:64] [hipe] [kernel-poll:true]\\n\"},\n {memory,[{total,40106344},\n          {connection_readers,0},\n          {connection_writers,0},\n          {connection_channels,0},\n          {connection_other,0},\n          {queue_procs,14920},\n          {queue_slave_procs,0},\n          {plugins,0},\n          {other_proc,13396952},\n          {mnesia,62008},\n          {mgmt_db,0},\n          {msg_index,49040},\n          {other_ets,959976},\n          {binary,12296},\n          {code,17800225},\n          {atom,752561},\n          {other_system,7058366}]},\n {alarms,[]},\n {listeners,[{clustering,25672,\"::\"},{amqp,5672,\"::\"}]},\n {vm_memory_high_watermark,0.4},\n {vm_memory_limit,416869580},\n {disk_free_limit,50000000},\n {disk_free,19432972288},\n {file_descriptors,[{total_limit,924},\n                    {total_used,2},\n                    {sockets_limit,829},\n                    {sockets_used,0}]},\n {processes,[{limit,1048576},{used,141}]},\n {run_queue,0},\n {uptime,3036},\n {kernel,{net_ticktime,60}}]\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e3.6.6 のようだ。サイトで公開されているRabbitMQのバージョンはいくつだろうか？\u003c/p\u003e\n\n\u003cp\u003e「Downloading and Installing RabbitMQ」 (RabbitMQ)\u003cbr\u003e\n\u003ca href=\"https://www.rabbitmq.com/download.html\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://www.rabbitmq.com/download.html\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e3.6.6 のようだ。\u003cstrong\u003eうん～～～～？？\u003c/strong\u003e\u003c/p\u003e\n\n\u003cp\u003eとりあえずソースコードを再掲しておく。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eusing RabbitMQ.Client;\nusing RabbitMQ.Client.Events;\nusing System;\nusing System.Text;\n\nnamespace UsagiMQ\n{\n    /// \u0026lt;summary\u0026gt;\n    /// 参照 : 「QueueDeclare」 http://docs.spring.io/spring-amqp-net/docs/1.0.x/api/html/Spring.Messaging.Amqp.Rabbit~Spring.Messaging.Amqp.Rabbit.Connection.CachedModel~QueueDeclare(String,Boolean,Boolean,Boolean,Boolean,Boolean,IDictionary).html\n    /// 参照 : 「EventingBasicConsumer」 https://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v1.4.0/rabbitmq-dotnet-client-1.4.0-net-2.0-htmldoc/type-RabbitMQ.Client.Events.EventingBasicConsumer.html\n    /// 参照 : 「BasicConsume」 https://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v1.4.0/rabbitmq-dotnet-client-1.4.0-net-2.0-htmldoc/type-RabbitMQ.Client.IModel.html#method-M:RabbitMQ.Client.IModel.BasicConsume(System.UInt16,System.String,System.Boolean,System.Collections.IDictionary,RabbitMQ.Client.IBasicConsumer)\n    /// \u0026lt;/summary\u0026gt;\n    class Program\n    {\n        public const string\n            HOST_NAME = \"localhost\",\n            QUEUE_NAME = \"hello\";\n\n        static void Main(string[] args)\n        {\n            for (;;)\n            {\n                Console.WriteLine(@\"選べだぜ☆（＾～＾）\n1   : メッセージ   送信\n2   : メッセージ   受信\nquit: 終了\n\");\n\n                int category = 0;\n                for (;;)\n                {\n                    string line = Console.ReadLine();\n                    switch (line)\n                    {\n                        case \"1\": category = 1; goto gt_EndLoop1;\n                        case \"2\": category = 2; goto gt_EndLoop1;\n                        case \"quit\": goto gt_Quit;\n                        default: break;\n                    }\n                }\n                gt_EndLoop1:\n                ;\n\n                switch (category)\n                {\n                    case 1:\n                        {\n                            Console.WriteLine(@\"メッセージを書いて[Enter]キーを押せだぜ☆（＾～＾）\");\n                            // \"Hello World!\" などを入力\n                            string line = Console.ReadLine();\n                            Send(line);\n                        }\n                        break;\n                    case 2: Receive(); break;\n                }\n            }\n            gt_Quit:\n            ;\n        }\n\n        static void Send(string message)\n        {\n            ConnectionFactory factory = new ConnectionFactory() { HostName = HOST_NAME };\n            IConnection connection = factory.CreateConnection();\n            IModel channel = connection.CreateModel();\n\n            channel.QueueDeclare(QUEUE_NAME, false, false, false, null);\n            // Ubuntuでは何故か Spring.Messaging.Amqp.Rabbit の引数 7 つのやつになっている。\n            // channel.QueueDeclare(QUEUE_NAME, false, false, false, false, false, null);\n\n            byte[] body = Encoding.UTF8.GetBytes(message);\n\n            channel.BasicPublish(\"\", QUEUE_NAME, null, body);\n            Console.WriteLine(\" Sent(^q^) {0}\", message);\n            Console.WriteLine(\" Press [enter] to menu.\");\n            Console.ReadLine();\n        }\n\n        static void Receive()\n        {\n            ConnectionFactory factory = new ConnectionFactory() { HostName = HOST_NAME };\n            IConnection connection = factory.CreateConnection();\n            IModel channel = connection.CreateModel();\n\n            channel.QueueDeclare(QUEUE_NAME, false, false, false, null);\n            // Ubuntuでは何故か Spring.Messaging.Amqp.Rabbit の引数 7 つのやつになっている。\n            // channel.QueueDeclare(QUEUE_NAME, false, false, false, false, false, null);\n\n            EventingBasicConsumer consumer = new EventingBasicConsumer(channel);\n            // Ubuntuでは何故か v1.4.0 の引数が 0 個のやつになっている。\n            //EventingBasicConsumer consumer = new EventingBasicConsumer();\n\n            // 受信できたときに割り込んでくる処理\n            consumer.Received += (model, ea) =\u0026gt;\n            {\n                byte[] body = ea.Body;\n                string message = Encoding.UTF8.GetString(body);\n                Console.WriteLine(\" [interrupt!] Received(^q^) {0}\", message);\n            };\n            channel.BasicConsume(QUEUE_NAME, true, consumer);\n            // Ubuntuでは何故か引数が 5 個のやつになっている。\n            // channel.BasicConsume( QUEUE_NAME, true, \"\", null, consumer);\n\n            Console.WriteLine(\" Please, wait receiving... Or Press [enter] to menu.\");\n            Console.ReadLine();\n        }\n\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"次は-php-でプロセス間通信する方法を調べよう\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%AC%A1%E3%81%AF-php-%E3%81%A7%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E9%96%93%E9%80%9A%E4%BF%A1%E3%81%99%E3%82%8B%E6%96%B9%E6%B3%95%E3%82%92%E8%AA%BF%E3%81%B9%E3%82%88%E3%81%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e次は PHP でプロセス間通信する方法を調べよう\u003c/h1\u003e\n\n\u003cp\u003e「【PHP】メッセージキューを使う」 (ＦＯＲ　ＳＥ)\u003cbr\u003e\n\u003ca href=\"http://forse.hatenablog.com/entry/2016/01/10/173518\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://forse.hatenablog.com/entry/2016/01/10/173518\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eじゃあ試しにページを作ってみるか。こんなんでいいんだろうか？\u003c/p\u003e\n\n\u003cp\u003etamesi2.php\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u0026lt;?php\n// 送信したい文字列\n$msg = \"hello, world\";\n// キューの名前は数字で 5963、パーミッションは 600 の8進数表記\n$msgkey = msg_get_queue( 5963 ,0600 );\n    if( !msg_send( $msgkey ,12 ,$msg ,false ) )\n    {\n        echo \"送信失敗\";\n    }\n    else\n    {\n        echo \"送信 \" . $msg;\n    }\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003etamesi3.php\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u0026lt;?php\n// キューの名前は数字で 5963\n$msgkey = msg_get_queue( 5963 );\nmsg_receive( $msgkey ,0 ,$msgtype ,4 ,$msg,false ,null ,$err );\necho \"msgtype {$msgtype} msg {$msg}\\n\"; \n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"ところでメモあとで調べる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%A8%E3%81%93%E3%82%8D%E3%81%A7%E3%83%A1%E3%83%A2%E3%81%82%E3%81%A8%E3%81%A7%E8%AA%BF%E3%81%B9%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eところでメモ。あとで調べる\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003eforeverコマンド 常駐させる\u003c/li\u003e\n\u003cli\u003ePHPでexpect プロセスと対話する\u003c/li\u003e\n\u003cli\u003e「ps aux | grep apery」で Aperyのプロセスを探せる\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"phpの続き\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#php%E3%81%AE%E7%B6%9A%E3%81%8D\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ePHPの続き\u003c/h1\u003e\n\n\u003cp\u003e送信はできたのかもしれないが、受信ではメッセージを取れてないな。書き直し。\u003c/p\u003e\n\n\u003cp\u003etamesi2.php\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u0026lt;?php\n// 送信したい文字列\n$msg = \"hello, world\";\n// キューの名前は数字で 5963、パーミッションは 600 の8進数表記\n$msgkey = msg_get_queue( 5963 ,0600 );\nif( msg_send( $msgkey ,12 ,$msg ,false ) )\n{\n    echo \"送信 \" . $msg;\n}\nelse\n{\n    echo \"送信失敗\";\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003etamesi3.php\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u0026lt;?php\n// キューの名前は数字で 5963\n$msgkey = msg_get_queue( 5963 );\nif( msg_receive( $msgkey ,0 ,$msgtype ,4 ,$data ,false ,null ,$err ) )\n{\n    echo \"msgtype {$msgtype} data {$data}\"; \n}\nelse\n{\n    echo \"送信失敗 \" . $err;\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e実行結果 tamesi3.php\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e送信失敗 7\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003cstrong\u003eへぇ。\u003c/strong\u003e\u003c/p\u003e\n\n\u003cp\u003e「posix_strerror」　(PHPマニュアル)\u003cbr\u003e\n\u003ca href=\"http://php.net/manual/ja/function.posix-strerror.php\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://php.net/manual/ja/function.posix-strerror.php\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003etamesi3.php を書き直し。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u0026lt;?php\n// キューの名前は数字で 5963\n$msgkey = msg_get_queue( 5963 );\nif( msg_receive( $msgkey ,0 ,$msgtype ,4 ,$data ,false ,null ,$err ) )\n{\n    echo \"msgtype {$msgtype} data {$data}\"; \n}\nelse\n{\n    echo \"送信失敗 \" . $err . \" \" . posix_strerror( $err );\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e実行結果 tamesi3.php\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e送信失敗 7 Argument list too long\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eなんのこっちゃ。いったい何の 引数のリストか。\u003c/p\u003e\n\n\u003cp\u003emsg_send の第2引数の数字は　何を入れたらいいのか……？\u003c/p\u003e\n\n\u003cp\u003e「メッセージキューの使い方(CとPHPでプロセス間通信)」 (Linux Install Memo)\u003cbr\u003e\n\u003ca href=\"https://linux.yebisu.jp/memo/630\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://linux.yebisu.jp/memo/630\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eおっ！ 分かった！\u003c/strong\u003e \u003c/p\u003e\n\n\u003cp\u003eサンプル・プログラムで msg_receive 関数の第4引数が 4 なのは \"test\" の文字数に合わせていたのか。\u003cbr\u003e\n4096 ぐらい大きくしておけばよかったのか。\u003c/p\u003e\n\n\u003cp\u003e書き直し。\u003c/p\u003e\n\n\u003cp\u003etamesi2.php\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u0026lt;?php\n// 送信したい文字列\n$msg = \"hello, world\";\n// キューの名前は数字\n$QKey = 1111;\n// パーミッションは 666 の8進数表記\n$Queue = msg_get_queue( $QKey ,0666 );\necho var_dump( msg_stat_queue( $Queue ) );\n\nif ( msg_queue_exists($QKey) )\n{\n    print $QKey . \"はあるぜ☆（＾～＾）ｖ\\n\";\n}\nelse\n{\n    print $QKey . \"は無いぜ☆（＞＿＜）\\n\";\n}\n\nif( msg_send( $Queue ,12 ,$msg ,false ) )\n{\n    echo \"送信 \" . $msg . \"\\n\";\n}\nelse\n{\n    echo \"送信失敗\\n\";\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003etamesi3.php\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u0026lt;?php\n// キューの名前は数字\n$QKey = 1111;\n$Queue = msg_get_queue( $QKey );\necho var_dump( msg_stat_queue( $Queue ) );\n\nif ( msg_queue_exists($QKey) )\n{\n    print $QKey . \"はあるぜ☆（＾～＾）ｖ\\n\";\n}\nelse\n{\n    print $QKey . \"は無いぜ☆（＞＿＜）\\n\";\n}\n\nif( msg_receive( $Queue ,0 ,$msgtype ,4096 ,$msg ,false ,null ,$err ) )\n{\n    echo \"msgtype {$msgtype} msg {$msg}\\n\"; \n}\nelse\n{\n    var_dump( $err );\n    echo \"送信失敗 \" . $err . \" \" . posix_strerror( $err ) . \"\u0026lt;br /\u0026gt;\";\n    echo \"type = \" . $msgtype . \" msg = \" . $msg . \"\u0026lt;br /\u0026gt;\\n\";\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"メッセージキューが空っぽのときに-receive-すると固まってしまうので\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E3%82%AD%E3%83%A5%E3%83%BC%E3%81%8C%E7%A9%BA%E3%81%A3%E3%81%BD%E3%81%AE%E3%81%A8%E3%81%8D%E3%81%AB-receive-%E3%81%99%E3%82%8B%E3%81%A8%E5%9B%BA%E3%81%BE%E3%81%A3%E3%81%A6%E3%81%97%E3%81%BE%E3%81%86%E3%81%AE%E3%81%A7\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eメッセージ・キューが空っぽのときに receive すると固まってしまうので\u003c/h2\u003e\n\n\u003cp\u003e「[PHP]「バッチの二重処理の防ぎ方」PHP変」 (がるの健忘録)\u003cbr\u003e\n\u003ca href=\"http://d.hatena.ne.jp/gallu/20120306/p1\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://d.hatena.ne.jp/gallu/20120306/p1\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eフラグを指定しろとのことらしい。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e$r = msg_receive($mh, 0, $msgtype, 0xffff, $message, true, MSG_IPC_NOWAIT, $error_code);\n                                                           ~~~~~~~~~~~~~~\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eでも msg_receive は「No message of desired type」というエラーを返してくる。\u003cbr\u003e\nRabbitMQ を再起動できないものか。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"rabbitmq-を再起動\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#rabbitmq-%E3%82%92%E5%86%8D%E8%B5%B7%E5%8B%95\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eRabbitMQ を再起動\u003c/h1\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003erabbitmqctl stop\nStopping and halting node 'rabbit@★～略～' ...\nGracefully halting Erlang VM\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ejobs\n[1]+  Done                    sudo rabbitmq-server  (wd: /home/csg10/shogi/ukamuse_sdt4/bin)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eで止めて、\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003erabbitmq-server\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e[Ctrl]+[Z]\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e^Z\n[1]+  Stopped                 rabbitmq-server\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ebg 1\n[1]+ rabbitmq-server \u0026amp;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eで再開。\u003c/p\u003e\n\n\u003cp\u003eでもやっぱり 同じエラーのままだ。\u003c/p\u003e\n\n\u003cp\u003eキューのキー番号を変えてみたりする。今度はうまくいった。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"phpのメッセージキュープログラムを書き直した\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#php%E3%81%AE%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E3%82%AD%E3%83%A5%E3%83%BC%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0%E3%82%92%E6%9B%B8%E3%81%8D%E7%9B%B4%E3%81%97%E3%81%9F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ePHPのメッセージ・キュー・プログラムを書き直した\u003c/h2\u003e\n\n\u003cp\u003etamesi2.php\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u0026lt;?php\n// 送信したい文字列\n$msg = urldecode($_SERVER['QUERY_STRING']);\nif( \"\" === $msg )\n{\n    $msg = \"hello, world\";\n}\necho '（＾ｑ＾）' . $msg . '\u0026lt;br /\u0026gt;';\necho 'これを１回クリックしろだぜ☆ｍ９（＾～＾）！\u0026lt;br /\u0026gt;';\necho '\u0026lt;a href=\"http://999.999.999.999/tamesi2.php?ClickSitanDaze\"\u0026gt;http://999.999.999.999/tamesi2.php?ClickSitanDaze\u0026lt;/a\u0026gt;\u0026lt;br /\u0026gt;';\n\n// キューの名前は数字\n$QKey = 1111;\n// パーミッションは 666 の8進数表記\n$Queue = msg_get_queue( $QKey ,0666 );\n\nif ( !msg_queue_exists($QKey) )\n{\n    print \"キュー \" . $QKey . \"は無いぜ☆（＞＿＜）\\n\";\n    die(\"queue not found.\");\n}\n\nif( !msg_send( $Queue ,12 ,$msg ,false ) )\n{\n    echo \"エンキュー失敗☆（＞＿＜）\\n\";\n    die(\"send error.\");\n}\n\necho 'そのあとこのページを見にいけだぜ☆ｍ９（＾～＾）！\u0026lt;br /\u0026gt;';\necho '\u0026lt;a href=\"http://999.999.999.999/tamesi3.php\"\u0026gt;http://999.999.999.999/tamesi3.php\u0026lt;/a\u0026gt;\u0026lt;br /\u0026gt;';\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003etamesi3.php\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u0026lt;?php\n// キューの名前は数字\n$QKey = 1111;\n$Queue = msg_get_queue( $QKey );\n\nif ( !msg_queue_exists($QKey) )\n{\n    print \"キュー \" . $QKey . \"は無いぜ☆（＞＿＜）\\n\";\n    die(\"queue not found.\");\n}\n\nif( !msg_receive( $Queue ,0 ,$msgtype ,4096 ,$msg ,false ,MSG_IPC_NOWAIT ,$err ) )\n{\n    if( $err==42 )\n    {\n        echo \"（＾ｑ＾）；；キューが空っぽなのかだぜ☆？\u0026lt;br /\u0026gt;\";\n    }\n    else\n    {\n        var_dump( $err );\n        echo \"デキュー失敗☆（＞＿＜） \" . $err . \" \" . posix_strerror( $err ) . \"\u0026lt;br /\u0026gt;\";\n    }\n    die(\"receive error.\");\n}\n\necho \"プロセス間通信を通ってきたようだな☆（＾ｑ＾）「{$msg}」\u0026lt;br /\u0026gt;\\n\"; \necho \"メッセージは溜まっているかもしれないからページを更新しろだぜ☆（＾～＾）\u0026lt;br /\u0026gt;\\n\"; \n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003etamesi4.php （破棄に失敗するだけだったが）\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u0026lt;?php\n// キューの名前は数字\n$QKey = 1111;\nif ( !msg_queue_exists($QKey) )\n{\n    print \"キュー \" . $QKey . \"は無いぜ☆（＞＿＜）\\n\";\n    die(\"queue not found.\");\n}\n\n// パーミッションは 666 の8進数表記\n$Queue = msg_get_queue( $QKey ,0666 );\n\nif( !msg_remove_queue($Queue) )\n{\n    print \"キュー \" . $QKey . \"の破棄に失敗☆（＞＿＜）\\n\";\n    die(\"queue not removed.\");\n}\n\nprint \"キュー \" . $QKey . \"を破棄したぜ☆（＾～＾）\\n\";\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"phpとcの間でプロセス間通信できんの\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#php%E3%81%A8c%E3%81%AE%E9%96%93%E3%81%A7%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E9%96%93%E9%80%9A%E4%BF%A1%E3%81%A7%E3%81%8D%E3%82%93%E3%81%AE\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ePHPとC#の間で　プロセス間通信できんの？\u003c/h1\u003e\n\n\u003cp\u003ePHPはキューの名前が数字だし、C#はキューの名前が / で始まる文字なんだっけ？\u003cbr\u003e\nなんだろう　この違い……。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"コンパイルオプション-プリプロセッサ定義\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B3%E3%83%B3%E3%83%91%E3%82%A4%E3%83%AB%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3-%E3%83%97%E3%83%AA%E3%83%97%E3%83%AD%E3%82%BB%E3%83%83%E3%82%B5%E5%AE%9A%E7%BE%A9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eコンパイル・オプション プリプロセッサ定義\u003c/h1\u003e\n\n\u003cp\u003eC#の方。\u003c/p\u003e\n\n\u003cp\u003e「/D (プリプロセッサの定義)」 (MSDN)\u003cbr\u003e\n\u003ca href=\"https://msdn.microsoft.com/ja-jp/library/hhzbb5c8.aspx\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://msdn.microsoft.com/ja-jp/library/hhzbb5c8.aspx\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e/D を使って #define と同じような効果を出せるのか。\u003c/p\u003e\n\n\u003cp\u003eUbuntu用と Windows用で分けようかな。\u003c/p\u003e\n\n\u003cp\u003e複数個のプリプロセッサマクロがあるとき、どう指定すればいいんだ？　そのときは適当にカンマでも打ってみるか。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"cのプロセス間通信プログラムをさらに修正\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#c%E3%81%AE%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E9%96%93%E9%80%9A%E4%BF%A1%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0%E3%82%92%E3%81%95%E3%82%89%E3%81%AB%E4%BF%AE%E6%AD%A3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eC#のプロセス間通信プログラムをさらに修正\u003c/h1\u003e\n\n\u003cp\u003e次の点を修正した。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eレシーブに失敗すること\u003c/li\u003e\n\u003cli\u003equit で固まること\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e修正方法は、コネクションとチャンネルのクローズをちゃんとやること。\u003c/p\u003e\n\n\u003cp\u003eまた、UbuntuとWindowsで異なる個所を UBUNTU プリプロセッサ定義で分けた。\u003c/p\u003e\n\n\u003cp\u003eMsgQueue.cs\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// Ubuntu の RabbitMQ はソースのバージョンが古いのか、API が異なった。\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// #define UBUNTU\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eRabbitMQ.Client\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eRabbitMQ.Client.Events\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Text\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eUsagiMQ\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// 参照 : 「QueueDeclare」 http://docs.spring.io/spring-amqp-net/docs/1.0.x/api/html/Spring.Messaging.Amqp.Rabbit~Spring.Messaging.Amqp.Rabbit.Connection.CachedModel~QueueDeclare(String,Boolean,Boolean,Boolean,Boolean,Boolean,IDictionary).html\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// 参照 : 「EventingBasicConsumer」 https://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v1.4.0/rabbitmq-dotnet-client-1.4.0-net-2.0-htmldoc/type-RabbitMQ.Client.Events.EventingBasicConsumer.html\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// 参照 : 「BasicConsume」 https://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v1.4.0/rabbitmq-dotnet-client-1.4.0-net-2.0-htmldoc/type-RabbitMQ.Client.IModel.html#method-M:RabbitMQ.Client.IModel.BasicConsume(System.UInt16,System.String,System.Boolean,System.Collections.IDictionary,RabbitMQ.Client.IBasicConsumer)\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eProgram\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eHOST_NAME\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"localhost\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eQUEUE_NAME\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"hello\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"nf\"\u003eProgram\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#if UBUNTU\n\u003c/span\u003e            \u003cspan class=\"n\"\u003em_eventHandler_\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eBasicDeliverEventHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003emodel\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eea\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#else\n\u003c/span\u003e            \u003cspan class=\"n\"\u003em_eventHandler_\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eEventHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eBasicDeliverEventArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;((\u003c/span\u003e\u003cspan class=\"n\"\u003emodel\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eea\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#endif\n\u003c/span\u003e            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003ebody\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eea\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBody\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eEncoding\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUTF8\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetString\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebody\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\" [interrupt!] Received(^q^) {0}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eConnectionFactory\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetFactory\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003em_factory_\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003em_factory_\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eConnectionFactory\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003eHostName\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eHOST_NAME\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003em_factory_\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eConnectionFactory\u003c/span\u003e \u003cspan class=\"n\"\u003em_factory_\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eIConnection\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetConnection\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e==\u003c/span\u003e\u003cspan class=\"n\"\u003em_connection_\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003em_connection_\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetFactory\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateConnection\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003em_connection_\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eIConnection\u003c/span\u003e \u003cspan class=\"n\"\u003em_connection_\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eIModel\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetChannel\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e==\u003c/span\u003e\u003cspan class=\"n\"\u003em_channel_\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003em_channel_\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetConnection\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateModel\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#if UBUNTU\n\u003c/span\u003e                \u003cspan class=\"c1\"\u003e// Ubuntuでは何故か Spring.Messaging.Amqp.Rabbit の引数 7 つのやつになっている。\u003c/span\u003e\n                \u003cspan class=\"n\"\u003em_channel_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eQueueDeclare\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eQUEUE_NAME\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#else\n\u003c/span\u003e                \u003cspan class=\"n\"\u003em_channel_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eQueueDeclare\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eQUEUE_NAME\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#endif\n\u003c/span\u003e            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003em_channel_\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eIModel\u003c/span\u003e \u003cspan class=\"n\"\u003em_channel_\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eEventingBasicConsumer\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetConsumer\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003em_consumer_\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#if UBUNTU\n\u003c/span\u003e                \u003cspan class=\"c1\"\u003e// Ubuntuでは何故か v1.4.0 の引数が 0 個のやつになっている。\u003c/span\u003e\n                \u003cspan class=\"n\"\u003em_consumer_\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eEventingBasicConsumer\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#else\n\u003c/span\u003e                \u003cspan class=\"n\"\u003em_consumer_\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eEventingBasicConsumer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetChannel\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#endif\n\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003em_consumer_\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eEventingBasicConsumer\u003c/span\u003e \u003cspan class=\"n\"\u003em_consumer_\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// 受信できたときに割り込んでくる処理\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#if UBUNTU\n\u003c/span\u003e        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eBasicDeliverEventHandler\u003c/span\u003e \u003cspan class=\"n\"\u003em_eventHandler_\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#else\n\u003c/span\u003e        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eEventHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eBasicDeliverEventArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003em_eventHandler_\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#endif\n\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// 対応するオープンは無いけれど、開けたら閉める、を完璧に対応する必要がある。\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eCloseConnection\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003em_connection_\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003em_connection_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eClose\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n                \u003cspan class=\"n\"\u003em_connection_\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// 対応するオープンは無いけれど、開けたら閉める、を完璧に対応する必要がある。\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eCloseChannel\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003em_channel_\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003em_channel_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eClose\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n                \u003cspan class=\"n\"\u003em_channel_\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eMain\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(;;)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e@\"選べだぜ☆（＾～＾）\n1   : メッセージ   送信\n2   : メッセージ   受信\nquit: 終了\n\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n                \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ecategory\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(;;)\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eline\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReadLine\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003eswitch\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eline\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                        \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e\"1\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003ecategory\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003egoto\u003c/span\u003e \u003cspan class=\"n\"\u003egt_EndLoop1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                        \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e\"2\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003ecategory\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003egoto\u003c/span\u003e \u003cspan class=\"n\"\u003egt_EndLoop1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                        \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e\"quit\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003egoto\u003c/span\u003e \u003cspan class=\"n\"\u003egt_Quit\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                        \u003cspan class=\"k\"\u003edefault\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                \u003cspan class=\"n\"\u003egt_EndLoop1\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n                \u003cspan class=\"k\"\u003eswitch\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecategory\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                            \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e@\"メッセージを書いて[Enter]キーを押せだぜ☆（＾～＾）\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                            \u003cspan class=\"c1\"\u003e// \"Hello World!\" などを入力\u003c/span\u003e\n                            \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eline\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReadLine\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n                            \u003cspan class=\"nf\"\u003eSend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eline\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                        \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nf\"\u003eReceive\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"n\"\u003egt_Quit\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// 対応するオープンは無いが、ちゃんと閉じないと、プロセスが終わってくれない。\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eCloseConnection\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eSend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eIModel\u003c/span\u003e \u003cspan class=\"n\"\u003echannel\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetChannel\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n            \u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003ebody\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eEncoding\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUTF8\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetBytes\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eBasicPublish\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eQUEUE_NAME\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ebody\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\" Sent(^q^) {0}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\" Press [enter] to menu.\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReadLine\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// 対応するオープンは無いが、ちゃんと閉じないと、レシーブしてくれない。\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eCloseChannel\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eReceive\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eIModel\u003c/span\u003e \u003cspan class=\"n\"\u003echannel\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetChannel\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eEventingBasicConsumer\u003c/span\u003e \u003cspan class=\"n\"\u003econsumer\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetConsumer\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n\n            \u003cspan class=\"c1\"\u003e// 受信できたときに割り込んでくる処理\u003c/span\u003e\n            \u003cspan class=\"n\"\u003econsumer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eReceived\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"n\"\u003em_eventHandler_\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"cp\"\u003e#if UBUNTU\n\u003c/span\u003e            \u003cspan class=\"c1\"\u003e// Ubuntuでは何故か引数が 5 個のやつになっている。\u003c/span\u003e\n            \u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eBasicConsume\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003eQUEUE_NAME\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003econsumer\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#else\n\u003c/span\u003e            \u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eBasicConsume\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eQUEUE_NAME\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003econsumer\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#endif\n\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\" Please, wait receiving... Or Press [enter] to menu.\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReadLine\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// 割込み処理の削除\u003c/span\u003e\n            \u003cspan class=\"n\"\u003econsumer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eReceived\u003c/span\u003e \u003cspan class=\"p\"\u003e-=\u003c/span\u003e \u003cspan class=\"n\"\u003em_eventHandler_\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// 対応するオープンは無いが、ちゃんと閉じないと、レシーブしてくれない。\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eCloseChannel\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e(2017-03-07 修正:上のプログラム２個所修正済み)\u003c/p\u003e\n\n\u003cp\u003e\"localhost\" と埋め込んでいるところも、IPアドレスの番号に変えた方がいいんだろうか？\u003c/p\u003e\n\n\u003cp\u003eこれを Ubuntu でコンパイルするには、\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003emcs /r:RabbitMQ.Client.dll /DUBUNTU MsgQueue.cs\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eとすればいいんだろうか？　やってみよう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003emcs /r:RabbitMQ.Client.dll /DUBUNTU MsgQueue.cs\nerror CS2007: Unrecognized command-line option: `/DUBUNTU'\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eなぜダメなのか……。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eman mcs\n～中略～\n       -define:SYMLIST, -d:SYMLIST\n              Defines the symbol listed by the semi-colon separated list SYMLIST  SYMBOL.   This  can  be\n              tested  in  the  source code by the pre-processor, or can be used by methods that have been\n              tagged with the Conditional attribute.\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003cstrong\u003e「-define:」で始めて、セミコロンで区切ればいいのか。\u003c/strong\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003emcs /r:RabbitMQ.Client.dll -define:UBUNTU MsgQueue.cs\nMsgQueue.cs(178,34): error CS0029: Cannot implicitly convert type `System.EventHandler\u0026lt;RabbitMQ.Client.Events.BasicDeliverEventArgs\u0026gt;' to `RabbitMQ.Client.Events.BasicDeliverEventHandler'\nMsgQueue.cs(191,34): error CS0029: Cannot implicitly convert type `System.EventHandler\u0026lt;RabbitMQ.Client.Events.BasicDeliverEventArgs\u0026gt;' to `RabbitMQ.Client.Events.BasicDeliverEventHandler'\nCompilation failed: 2 error(s), 0 warnings\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eプログラムにミスがあったか。\u003cbr\u003e\n２個所修正。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e#if UBUNTU\n            m_eventHandler_ = new BasicDeliverEventHandler((model, ea) =\u0026gt;\n#else\n            m_eventHandler_ = new EventHandler\u0026lt;BasicDeliverEventArgs\u0026gt;((model, ea) =\u0026gt;\n#endif\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e#if UBUNTU\n        static BasicDeliverEventHandler m_eventHandler_;\n#else\n        static EventHandler\u0026lt;BasicDeliverEventArgs\u0026gt; m_eventHandler_;\n#endif\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"c-と-php-のプロセス間通信はどうやるのか\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#c-%E3%81%A8-php-%E3%81%AE%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E9%96%93%E9%80%9A%E4%BF%A1%E3%81%AF%E3%81%A9%E3%81%86%E3%82%84%E3%82%8B%E3%81%AE%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eC# と PHP のプロセス間通信はどうやるのか？\u003c/h1\u003e\n\n\u003cp\u003e\"localhost\" のところを IPアドレスに変えるとエラーが出てしまった。\u003cbr\u003e\nキュー名の \"hello\" を \"1111\" に変えても　PHP では拾えなかった。\u003c/p\u003e\n\n\u003cp\u003ePHPマニュアルではなく、RabbitMQ の説明を読んだ方がいいのか？\u003c/p\u003e\n\n\u003cp\u003e「Introduction」 (RabbitMQ)\u003cbr\u003e\n\u003ca href=\"https://www.rabbitmq.com/tutorials/tutorial-one-php.html\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://www.rabbitmq.com/tutorials/tutorial-one-php.html\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eサンプル・プログラムが全然違う。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"ubuntu-に-composer-のインストールが要るだろうか\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#ubuntu-%E3%81%AB-composer-%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%8C%E8%A6%81%E3%82%8B%E3%81%A0%E3%82%8D%E3%81%86%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eUbuntu に composer のインストールが要るだろうか\u003c/h1\u003e\n\n\u003cp\u003e「How To Install and Use Composer on Ubuntu 14.04」 (DigitalOcean)\u003cbr\u003e\n\u003ca href=\"https://www.digitalocean.com/community/tutorials/how-to-install-and-use-composer-on-ubuntu-14-04\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://www.digitalocean.com/community/tutorials/how-to-install-and-use-composer-on-ubuntu-14-04\u003c/a\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003esudo apt-get update\n～中略～\nFetched 1,672 kB in 2s (581 kB/s)\nReading package lists... Done\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003ecurl も要るみたいなんだが、php5 は入れたくないぜ。\u003c/p\u003e\n\n\u003cp\u003e「How do I install the ext-curl extension with PHP 7?」 (stack overflow)\u003cbr\u003e\n\u003ca href=\"http://stackoverflow.com/questions/33775897/how-do-i-install-the-ext-curl-extension-with-php-7\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://stackoverflow.com/questions/33775897/how-do-i-install-the-ext-curl-extension-with-php-7\u003c/a\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003esudo apt-get install php-curl\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003esudo service apache2 restart\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ecurl -sS https://getcomposer.org/installer | sudo php -- --install-dir=/usr/local/bin --filename=composer\nAll settings correct for using Composer\nDownloading...\n\nComposer (version 1.3.2) successfully installed to: /usr/local/bin/composer\nUse it: php /usr/local/bin/composer\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003ecomposer はダウンロードできただろうか。\u003cbr\u003e\n起動。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ecomposer\nDo not run Composer as root/super user! See https://getcomposer.org/root for details\n   ______\n  / ____/___  ____ ___  ____  ____  ________  _____\n / /   / __ \\/ __ `__ \\/ __ \\/ __ \\/ ___/ _ \\/ ___/\n/ /___/ /_/ / / / / / / /_/ / /_/ (__  )  __/ /\n\\____/\\____/_/ /_/ /_/ .___/\\____/____/\\___/_/\n                    /_/\nComposer version 1.3.2 2017-01-27 18:23:41\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e何か書いてるな。\u003c/p\u003e\n\n\u003cp\u003e「How do I install untrusted packages safely? Is it safe to run Composer as superuser or root?」 (getcomposer.org)\u003cbr\u003e\n\u003ca href=\"https://getcomposer.org/root\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://getcomposer.org/root\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eroot やスーパー・ユーザーじゃ composer は実行できないのだろうか？\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ecd ~\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eルートユーザーのフォルダーに飛んだのだろうか？\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003emkdir slugify\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eフォルダを作った。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ecd slugify\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eそのフォルダー移動した。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ecomposer require cocur/slugify\nDo not run Composer as root/super user! See https://getcomposer.org/root for details\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eスーパー・ユーザーから抜けるにはどうすればいいんだ？\u003c/p\u003e\n\n\u003cp\u003e「suコマンド（ユーザーの変更）」 (Linuxゲリラ戦記)\u003cbr\u003e\n\u003ca href=\"http://www.garunimo.com/program/linux/su.xhtml\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://www.garunimo.com/program/linux/su.xhtml\u003c/a\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003esu 一般ユーザー名\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ecomposer require cocur/slugify\n\n  [ErrorException]\n  file_get_contents(./composer.json): failed to open stream: Permission denied\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eなんのこっちゃ。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003els -an\ntotal 20\ndrwxr-xr-x 3 0 0 4096 Mar  7 05:07 .\ndrwx------ 9 0 0 4096 Mar  7 05:05 ..\n-rw-r--r-- 1 0 0   59 Mar  7 05:07 composer.json\n-rw-r--r-- 1 0 0 2896 Mar  7 05:07 composer.lock\ndrwxr-xr-x 4 0 0 4096 Mar  7 05:07 vendor\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eルート・ユーザーで実行するな、というから一般ユーザーになったのに……。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003esudo su -\n※パスワードを入れる\ncd slugify\nchmod 666 composer.json\nsu 一般ユーザー名\ncomposer require cocur/slugify\n\n  [ErrorException]\n  file_get_contents(./composer.json): failed to open stream: Permission denied\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003cstrong\u003eうーむ。\u003c/strong\u003e\u003c/p\u003e\n\n\u003cp\u003e「.composer/config file permission denied using laravel」 (stack overflow)\u003cbr\u003e\n\u003ca href=\"http://stackoverflow.com/questions/34511744/composer-config-file-permission-denied-using-laravel\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://stackoverflow.com/questions/34511744/composer-config-file-permission-denied-using-laravel\u003c/a\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003esudo chown 一般ユーザーアカウント名 /home/一般ユーザーアカウント名/.composer/config.json\nchown: cannot access '/home/★略/.composer/config.json': No such file or directory\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003cstrong\u003eうーむ。\u003c/strong\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003esudo su -\ncd slugify\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eスーパーユーザーでやってもだめ。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003esudo chown 一般ユーザー名 composer.json\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eよし。カレントディレクトリのファイルをいじる権限を与えたのか。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003esu 一般ユーザー名\ncomposer require cocur/slugify\n\n  [ErrorException]\n  file_get_contents(./composer.json): failed to open stream: Permission denied\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eだめ。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003esudo su -\ncd slugify\nsudo chown 一般ユーザー名 composer.lock\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eロックファイルを書き込む権限なんか与えたって、すぐ消えるファイルだと思うが。\u003c/p\u003e\n\n\u003cp\u003e一般ユーザーで。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003esudo composer update\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eむり。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ecomposer update\nComposer could not find a composer.json file in /home/csg10\nTo initialize a project, please create a composer.json file as described in the https://getcomposer.org/ \"Getting Started\" section\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e「Getting Started」 (Composer)\u003cbr\u003e\n\u003ca href=\"https://getcomposer.org/doc/00-intro.md\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://getcomposer.org/doc/00-intro.md\u003c/a\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ephp composer-setup.php --install-dir=bin --filename=composer\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eうごかない。\u003c/p\u003e\n\n\u003cp\u003e一般ユーザーになって、自分のホームディレクトリへ移動。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ecomposer require cocur/slugify\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eと叩く。\u003cstrong\u003eインストールが始まった。\u003c/strong\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eCannot create cache directory /home/csg10/.composer/cache/repo/https---packagist.org/, or directory is not writable. Proceeding without cache\nCannot create cache directory /home/csg10/.composer/cache/files/, or directory is not writable. Proceeding without cache\nUsing version ^2.4 for cocur/slugify\n./composer.json has been created\nCannot create cache directory /home/csg10/.composer/cache/repo/https---packagist.org/, or directory is not writable. Proceeding without cache\nCannot create cache directory /home/csg10/.composer/cache/files/, or directory is not writable. Proceeding without cache\nLoading composer repositories with package information\nUpdating dependencies (including require-dev)\nPackage operations: 1 install, 0 updates, 0 removals\n  - Installing cocur/slugify (v2.4) Downloading: 100%\nWriting lock file\nGenerating autoload files\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e失敗したのか成功したのか分からないが、何かが起こった。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003els -l\ntotal 24\n-rw-rw-r-- 1 csg10 csg10   59 Mar  7 05:37 composer.json\n-rw-rw-r-- 1 csg10 csg10 2896 Mar  7 05:37 composer.lock\ndrwxrwxr-x 2 csg10 csg10 4096 Mar  5 16:30 jikken\ndrwxr-xrwx 3 root  root  4096 Mar  7 00:34 shogi\n-rw-r--r-- 1 root  root    14 Mar  4 03:19 Tamesi\ndrwxrwxr-x 4 csg10 csg10 4096 Mar  7 05:37 vendor\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ecat composer.json\n{\n    \"require\": {\n        \"cocur/slugify\": \"^2.4\"\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれを、RabbitQM が言うには、\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e{ \n    \"require\" ： { \n        \"php-amqplib / php-amqplib\" ： \"2.5。*\" \n    } \n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eを、追加すればいいのか。\u003cstrong\u003eカンマ区切りだっけ？\u003c/strong\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e{\n    \"require\": {\n        \"cocur/slugify\": \"^2.4\"\n    }\n    ,\n    \"require\" ： {\n        \"php-amqplib / php-amqplib\" ： \"2.5。*\"\n    }\n\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこのようにしてみたが。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ecomposer.phar install\ncomposer.phar: command not found\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eどうすればいいんだ。それとも、こうか？\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e{\n    \"require\": {\n        \"cocur/slugify\": \"^2.4\"\n        ,\n        \"php-amqplib / php-amqplib\" ： \"2.5。*\"\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ecomposer.phar install\ncomposer.phar: command not found\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eなんだこの読点。 \u003cstrong\u003eあーっ！　グーグル翻訳で　コードが変わってるじゃないか！\u003c/strong\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e{\n    \"require\": {\n        \"cocur/slugify\": \"^2.4\"\n        ,\n        \"php-amqplib/php-amqplib\": \"2.5.*\"\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこうだ。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ecomposer.phar install\ncomposer.phar: command not found\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e composer require php-amqplib/php-amqplib\nCannot create cache directory /home/csg10/.composer/cache/repo/https---packagist.org/, or directory is not writable. Proceeding without cache\nCannot create cache directory /home/csg10/.composer/cache/files/, or directory is not writable. Proceeding without cache\nUsing version ^2.6 for php-amqplib/php-amqplib\n./composer.json has been updated\nCannot create cache directory /home/csg10/.composer/cache/repo/https---packagist.org/, or directory is not writable. Proceeding without cache\nCannot create cache directory /home/csg10/.composer/cache/files/, or directory is not writable. Proceeding without cache\nLoading composer repositories with package information\nUpdating dependencies (including require-dev)\nYour requirements could not be resolved to an installable set of packages.\n\n  Problem 1\n    - php-amqplib/php-amqplib v2.6.3 requires ext-bcmath * -\u0026gt; the requested PHP extension bcmath is missing from your system.\n    - php-amqplib/php-amqplib v2.6.2 requires ext-bcmath * -\u0026gt; the requested PHP extension bcmath is missing from your system.\n    - php-amqplib/php-amqplib v2.6.1 requires ext-bcmath * -\u0026gt; the requested PHP extension bcmath is missing from your system.\n    - php-amqplib/php-amqplib v2.6.0 requires ext-bcmath * -\u0026gt; the requested PHP extension bcmath is missing from your system.\n    - Installation request for php-amqplib/php-amqplib ^2.6 -\u0026gt; satisfiable by php-amqplib/php-amqplib[v2.6.0, v2.6.1, v2.6.2, v2.6.3].\n\n  To enable extensions, verify that they are enabled in your .ini files:\n    - /etc/php/7.0/cli/php.ini\n    - /etc/php/7.0/cli/conf.d/10-opcache.ini\n    - /etc/php/7.0/cli/conf.d/10-pdo.ini\n    - /etc/php/7.0/cli/conf.d/15-xml.ini\n    - /etc/php/7.0/cli/conf.d/20-calendar.ini\n    - /etc/php/7.0/cli/conf.d/20-ctype.ini\n    - /etc/php/7.0/cli/conf.d/20-curl.ini\n    - /etc/php/7.0/cli/conf.d/20-dom.ini\n    - /etc/php/7.0/cli/conf.d/20-exif.ini\n    - /etc/php/7.0/cli/conf.d/20-fileinfo.ini\n    - /etc/php/7.0/cli/conf.d/20-ftp.ini\n    - /etc/php/7.0/cli/conf.d/20-gettext.ini\n    - /etc/php/7.0/cli/conf.d/20-iconv.ini\n    - /etc/php/7.0/cli/conf.d/20-json.ini\n    - /etc/php/7.0/cli/conf.d/20-mbstring.ini\n    - /etc/php/7.0/cli/conf.d/20-phar.ini\n    - /etc/php/7.0/cli/conf.d/20-posix.ini\n    - /etc/php/7.0/cli/conf.d/20-readline.ini\n    - /etc/php/7.0/cli/conf.d/20-shmop.ini\n    - /etc/php/7.0/cli/conf.d/20-simplexml.ini\n    - /etc/php/7.0/cli/conf.d/20-sockets.ini\n    - /etc/php/7.0/cli/conf.d/20-sysvmsg.ini\n    - /etc/php/7.0/cli/conf.d/20-sysvsem.ini\n    - /etc/php/7.0/cli/conf.d/20-sysvshm.ini\n    - /etc/php/7.0/cli/conf.d/20-tokenizer.ini\n    - /etc/php/7.0/cli/conf.d/20-wddx.ini\n    - /etc/php/7.0/cli/conf.d/20-xmlreader.ini\n    - /etc/php/7.0/cli/conf.d/20-xmlwriter.ini\n    - /etc/php/7.0/cli/conf.d/20-xsl.ini\n  You can also run `php --ini` inside terminal to see which files are used by PHP in CLI mode.\n\nInstallation failed, reverting ./composer.json to its original content.\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eあらーっ。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"php-amqplib-はどうやって入手するのか\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#php-amqplib-%E3%81%AF%E3%81%A9%E3%81%86%E3%82%84%E3%81%A3%E3%81%A6%E5%85%A5%E6%89%8B%E3%81%99%E3%82%8B%E3%81%AE%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ephp-amqplib はどうやって入手するのか？\u003c/h1\u003e\n\n\u003cp\u003e「php-amqplib/php-amqplib」 (Git Hub)\u003cbr\u003e\n\u003ca href=\"https://github.com/php-amqplib/php-amqplib\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/php-amqplib/php-amqplib\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003ecomposer.json ファイルは自分で作ってしまえばいいのか？\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e{\n  \"require\": {\n      \"php-amqplib/php-amqplib\": \"2.6.*\"\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ecomposer.phar install\ncomposer.phar: command not found\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003ecomposer のインストールが終わってないのか。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"composer-のインストール\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#composer-%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ecomposer のインストール\u003c/h1\u003e\n\n\u003cp\u003e「Composerをインストールしてみた」 (Qiita)\u003cbr\u003e\n\u003ca href=\"http://qiita.com/kakijin/items/02364adacf36410f449e\" class=\"autolink\" id=\"reference-49d719b4699f6404631d\"\u003ehttp://qiita.com/kakijin/items/02364adacf36410f449e\u003c/a\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ecurl -sS https://getcomposer.org/installer | php\nAll settings correct for using Composer\nUnable to write keys.dev.pub to: /home/一般ユーザー名/.composer\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eなんのこっちゃ。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003emv composer.phar /usr/local/bin/composer\nmv: cannot stat 'composer.phar': No such file or directory\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eよく見ると、\u003c/p\u003e\n\n\u003cp\u003e/home/一般ユーザー名/ ディレクトリに vendor というディレクトリーができていた。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003els\ncomposer.json  composer.lock  jikken  shogi  Tamesi  vendor\ncd vendor\nls\nautoload.php  cocur  composer\ncd composer\nls\nautoload_classmap.php    autoload_psr4.php  autoload_static.php  installed.json\nautoload_namespaces.php  autoload_real.php  ClassLoader.php      LICENSE\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003ecomposer.phar という名前のファイルは見つからない。\u003c/p\u003e\n\n\u003cp\u003e「Composerで始める PHPのライブラリ管理」 (Hack Your Design!)\u003cbr\u003e\n\u003ca href=\"http://blog.toshimaru.net/how-to-use-composer-autoload/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://blog.toshimaru.net/how-to-use-composer-autoload/\u003c/a\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ecurl -s https://getcomposer.org/installer | php\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれをすると、 composer.phar は取れるらしいんだが、どこにあるんだろう？\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ecurl -s https://getcomposer.org/installer | php\nAll settings correct for using Composer\nUnable to write keys.dev.pub to: /home/★一般ユーザー名/.composer\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eうん？ .composer という隠しフォルダーができているのか？\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003els -an\ntotal 64\ndrwxr-xr-x 9 1000 1000 4096 Mar  7 06:02 .\ndrwxr-xr-x 3    0    0 4096 Sep 12  2015 ..\n～略～\ndrwxr-xr-x 3    0    0 4096 Mar  7 05:30 .composer\n～略～\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eあるようだ。\u003c/p\u003e\n\n\u003cp\u003e「Unable to write keys.dev.pub to: /home/ubuntu/.composer」 (stack overflow)\u003cbr\u003e\n\u003ca href=\"http://stackoverflow.com/questions/42413910/unable-to-write-keys-dev-pub-to-home-ubuntu-composer\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://stackoverflow.com/questions/42413910/unable-to-write-keys-dev-pub-to-home-ubuntu-composer\u003c/a\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ephp composer-setup.php\nCould not open input file: composer-setup.php\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ecomposer\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003ecomposer.json\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e{\n    \"require\": {\n        \"php-amqplib/php-amqplib\": \"2.5.*\"\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこのファイルは、欲しい物を書く欄なのか。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ecomposer update\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eすると、\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eCannot create cache directory /home/★一般ユーザー名/.composer/cache/repo/https---packagist.org/, or directory is not writable. Proceeding without cache\nCannot create cache directory /home/★一般ユーザー名/.composer/cache/files/, or directory is not writable. Proceeding without cache\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eといったエラーが出てくる。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003els -an\ntotal 16\ndrwxr-xr-x 3    0    0 4096 Mar  7 05:30 .\ndrwxr-xr-x 9 1000 1000 4096 Mar  7 06:29 ..\ndrwxr-xr-x 2    0    0 4096 Mar  7 05:30 cache\n-rw-r--r-- 1    0    0   13 Mar  7 05:30 .htaccess\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003ecacheディレクトリに書込みパーミッションを付けていけばいいのだろうか？\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003echmod 777 cache\nchmod: changing permissions of 'cache': Operation not permitted\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eスーパーユーザーになって、一般ユーザーのフォルダーの中にある .composer ディレクトリに行く。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003echmod 777 cache\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e一般ユーザーに戻って、自分のフォルダーの中の composer.json があるところで\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ecopmoser update\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eを叩く。何かインストールが始まった。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eLoading composer repositories with package information\nUpdating dependencies (including require-dev)\nYour requirements could not be resolved to an installable set of packages.\n\n  Problem 1\n    - php-amqplib/php-amqplib v2.5.2 requires ext-bcmath * -\u0026gt; the requested PHP extension bcmath is missing from your system.\n    - php-amqplib/php-amqplib v2.5.1 requires ext-bcmath * -\u0026gt; the requested PHP extension bcmath is missing from your system.\n    - php-amqplib/php-amqplib v2.5.0 requires ext-bcmath * -\u0026gt; the requested PHP extension bcmath is missing from your system.\n    - Installation request for php-amqplib/php-amqplib 2.5.* -\u0026gt; satisfiable by php-amqplib/php-amqplib[v2.5.0, v2.5.1, v2.5.2].\n\n  To enable extensions, verify that they are enabled in your .ini files:\n    - /etc/php/7.0/cli/php.ini\n    - /etc/php/7.0/cli/conf.d/10-opcache.ini\n    - /etc/php/7.0/cli/conf.d/10-pdo.ini\n    - /etc/php/7.0/cli/conf.d/15-xml.ini\n    - /etc/php/7.0/cli/conf.d/20-calendar.ini\n    - /etc/php/7.0/cli/conf.d/20-ctype.ini\n    - /etc/php/7.0/cli/conf.d/20-curl.ini\n    - /etc/php/7.0/cli/conf.d/20-dom.ini\n    - /etc/php/7.0/cli/conf.d/20-exif.ini\n    - /etc/php/7.0/cli/conf.d/20-fileinfo.ini\n    - /etc/php/7.0/cli/conf.d/20-ftp.ini\n    - /etc/php/7.0/cli/conf.d/20-gettext.ini\n    - /etc/php/7.0/cli/conf.d/20-iconv.ini\n    - /etc/php/7.0/cli/conf.d/20-json.ini\n    - /etc/php/7.0/cli/conf.d/20-mbstring.ini\n    - /etc/php/7.0/cli/conf.d/20-phar.ini\n    - /etc/php/7.0/cli/conf.d/20-posix.ini\n    - /etc/php/7.0/cli/conf.d/20-readline.ini\n    - /etc/php/7.0/cli/conf.d/20-shmop.ini\n    - /etc/php/7.0/cli/conf.d/20-simplexml.ini\n    - /etc/php/7.0/cli/conf.d/20-sockets.ini\n    - /etc/php/7.0/cli/conf.d/20-sysvmsg.ini\n    - /etc/php/7.0/cli/conf.d/20-sysvsem.ini\n    - /etc/php/7.0/cli/conf.d/20-sysvshm.ini\n    - /etc/php/7.0/cli/conf.d/20-tokenizer.ini\n    - /etc/php/7.0/cli/conf.d/20-wddx.ini\n    - /etc/php/7.0/cli/conf.d/20-xmlreader.ini\n    - /etc/php/7.0/cli/conf.d/20-xmlwriter.ini\n    - /etc/php/7.0/cli/conf.d/20-xsl.ini\n  You can also run `php --ini` inside terminal to see which files are used by PHP in CLI mode.\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e４つぐらいエラーが出ているようだ。\u003c/p\u003e\n\n\u003cp\u003eupdate じゃなくて install だったか。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ecomposer install\nLoading composer repositories with package information\nInstalling dependencies (including require-dev) from lock file\nWarning: The lock file is not up to date with the latest changes in composer.json. You may be getting outdated dependencies. Run update to update them.\nNothing to install or update\nGenerating autoload files\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eうーむ。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"bcmath\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#bcmath\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ebcmath\u003c/h1\u003e\n\n\u003cp\u003e「Apparently missing bcmath dependency」 (php-amqplib/php-amqplib)\u003cbr\u003e\n\u003ca href=\"https://github.com/php-amqplib/php-amqplib/issues/312\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/php-amqplib/php-amqplib/issues/312\u003c/a\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ecomposer show --platform\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e「How can I get the \u003ccode\u003ebcmath\u003c/code\u003e plugin in php5 in Ubuntu?」 (ask ubuntu)\u003cbr\u003e\n\u003ca href=\"http://askubuntu.com/questions/416866/how-can-i-get-the-bcmath-plugin-in-php5-in-ubuntu\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://askubuntu.com/questions/416866/how-can-i-get-the-bcmath-plugin-in-php5-in-ubuntu\u003c/a\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003esudo apt install php7.0-bcmath\n※パスワード入力\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eなんか　インストールが始まった。 bcmath とかいう拡張子が付いたファイルを持つプロジェクトを作るんだろうか？\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ecomposer update\nLoading composer repositories with package information\nUpdating dependencies (including require-dev)\nPackage operations: 1 install, 0 updates, 1 removal\n  - Removing cocur/slugify (v2.4)\n  - Installing php-amqplib/php-amqplib (v2.5.2) Downloading: 100%\nWriting lock file\nGenerating autoload files\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eようやく　アップデートできたようだ。 cocur/slugify を消したのは良かったのだろうか？\u003cbr\u003e\nもう１回やり直し。\u003c/p\u003e\n\n\u003cp\u003ecomposer.json\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e{\n    \"require\": {\n        \"cocur/slugify\": \"^2.4\"\n        ,\n        \"php-amqplib/php-amqplib\": \"2.5.*\"\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ecomposer update\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003cstrong\u003e追加で欲しいものを書くというより、欲しい現状を書くのか。\u003c/strong\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"composerphar\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#composerphar\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ecomposer.phar\u003c/h1\u003e\n\n\u003cp\u003e「Introduction」 (RabbitMQ)\u003cbr\u003e\n\u003ca href=\"https://www.rabbitmq.com/tutorials/tutorial-one-php.html\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://www.rabbitmq.com/tutorials/tutorial-one-php.html\u003c/a\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ecomposer.phar install\ncomposer.phar: command not found\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e依然として分からん。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ecurl -s https://getcomposer.org/installer | php\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれをすると composer.phar が取れるんだったか？\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eAll settings correct for using Composer\nUnable to write keys.dev.pub to: /home/一般ユーザー名/.composer\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e.composer 隠しフォルダーがあるという話しだった。\u003c/p\u003e\n\n\u003cp\u003e.phar は PHPのアーカイブ（圧縮ファイル）だろうか？　解凍されてなくなってたりするんだろうか？\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"varwwwhtml-で\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#varwwwhtml-%E3%81%A7\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003evar/www/html で\u003c/h1\u003e\n\n\u003cp\u003eユーザー・ディレクトリーではなく、var/www/html ディレクトリーで composer を使った方がいいのだろうか？\u003c/p\u003e\n\n\u003cp\u003evar/www/html ディレクトリーにも composer.json を置いてみる。\u003c/p\u003e\n\n\u003cp\u003ecomposer.json\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e{\n    \"require\": {\n        \"php-amqplib/php-amqplib\": \"2.5.*\"\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ecomposer install\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eLoading composer repositories with package information\nUpdating dependencies (including require-dev)\nPackage operations: 1 install, 0 updates, 0 removals\n  - Installing php-amqplib/php-amqplib (v2.5.2) Loading from cache\nWriting lock file\nGenerating autoload files\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eすんなりいった。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"dirってどこ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#dir%E3%81%A3%E3%81%A6%E3%81%A9%E3%81%93\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003cstrong\u003eDIR\u003c/strong\u003eってどこ\u003c/h1\u003e\n\n\u003cp\u003etamesi7.php\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u0026lt;?php\necho '__DIR__ってどこだぜ☆（＾～＾）？ = ' . __DIR__ ;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこういうファイルを作って、実行。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ephp tamesi7.php\n__DIR__ってどこだぜ☆（＾～＾）？ = /var/www/html\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eふむ。じゃあ、\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003erequire_once __DIR__ . '/vendor/autoload.php';\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eは、\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003erequire_once '/var/www/html/vendor/autoload.php';\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eということになる。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e/var/www/html/vendor$ ls -an\ntotal 20\ndrwxrwxr-x 4 1000 1000 4096 Mar  7 07:01 .\ndrwxr-xrwx 3    0    0 4096 Mar  7 07:03 ..\n-rw-rw-r-- 1 1000 1000  178 Mar  7 07:01 autoload.php\ndrwxrwxr-x 2 1000 1000 4096 Mar  7 07:01 composer\ndrwxrwxr-x 3 1000 1000 4096 Mar  7 07:01 php-amqplib\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eあるようだ。\u003c/p\u003e\n\n\u003cp\u003ePuTTYで実行すると。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ephp tamesi5.php\n [x] Sent 'Hello World!'\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e動いているんだが、ブラウザではアクセスできないようだ。パーミッションか？\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e ls -an\n～中略～\n-rw-rw-r-- 1 1000 1000   477 Mar  7 06:00 tamesi5.php\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003ePHPに実行権限なんか要るんだろうか？ PHPはデータ・ファイルだから実行ファイルではない気がする。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e php tamesi6.php\n [*] Waiting for messages. To exit press CTRL+C\n [x] Received bear\n [x] Received Hello World!\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eRabbitMQ は動いているんだが、ブラウザからアクセスすると動かない。\u003c/p\u003e\n\n\u003cp\u003eHTTP ERROR 500\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"シュリンクしていくか\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B7%E3%83%A5%E3%83%AA%E3%83%B3%E3%82%AF%E3%81%97%E3%81%A6%E3%81%84%E3%81%8F%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eシュリンクしていくか？\u003c/h1\u003e\n\n\u003cp\u003e数行ずつ調べていこう。\u003c/p\u003e\n\n\u003cp\u003etamesi5a1.php\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u0026lt;?php\nrequire_once __DIR__ . '/vendor/autoload.php';\nuse PhpAmqpLib\\Connection\\AMQPStreamConnection;\nuse PhpAmqpLib\\Message\\AMQPMessage;\n\necho \"3行おっけ☆！（＾▽＾）\u0026lt;br /\u0026gt;\\n\";\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれはブラウザで見れる。\u003c/p\u003e\n\n\u003cp\u003etamesi5a2.php\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u0026lt;?php\nrequire_once __DIR__ . '/vendor/autoload.php';\nuse PhpAmqpLib\\Connection\\AMQPStreamConnection;\nuse PhpAmqpLib\\Message\\AMQPMessage;\n\n$connection = new AMQPStreamConnection('localhost', 5672, 'guest', 'guest');\n$channel = $connection-\u0026gt;channel();\n\n$channel-\u0026gt;close();\n$connection-\u0026gt;close();\n\necho \"接続、チャンネル取得おっけ☆！（＾▽＾）\u0026lt;br /\u0026gt;\\n\";\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれもブラウザで見れる。\u003c/p\u003e\n\n\u003cp\u003etamesi5a3.php\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u0026lt;?php\nrequire_once __DIR__ . '/vendor/autoload.php';\nuse PhpAmqpLib\\Connection\\AMQPStreamConnection;\nuse PhpAmqpLib\\Message\\AMQPMessage;\n\n$connection = new AMQPStreamConnection('localhost', 5672, 'guest', 'guest');\n$channel = $connection-\u0026gt;channel();\n\n$channel-\u0026gt;queue_declare('hello', false, false, false, false);\n\n$channel-\u0026gt;close();\n$connection-\u0026gt;close();\n\necho \"queue_declare 引数５個おっけ☆！（＾▽＾）\u0026lt;br /\u0026gt;\\n\";\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれもブラウザで見れる。\u003c/p\u003e\n\n\u003cp\u003etamesi5a4.php\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u0026lt;?php\nrequire_once __DIR__ . '/vendor/autoload.php';\nuse PhpAmqpLib\\Connection\\AMQPStreamConnection;\nuse PhpAmqpLib\\Message\\AMQPMessage;\n\n$connection = new AMQPStreamConnection('localhost', 5672, 'guest', 'guest');\n$channel = $connection-\u0026gt;channel();\n\n$channel-\u0026gt;queue_declare('hello', false, false, false, false);\n\n$msg = new AMQPMessage('Hello World!');\n\n$channel-\u0026gt;close();\n$connection-\u0026gt;close();\n\necho \"AMQPMessage おっけ☆！（＾▽＾）\u0026lt;br /\u0026gt;\\n\";\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれもブラウザで見れる。\u003c/p\u003e\n\n\u003cp\u003etamesi5a5.php\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u0026lt;?php\nrequire_once __DIR__ . '/vendor/autoload.php';\nuse PhpAmqpLib\\Connection\\AMQPStreamConnection;\nuse PhpAmqpLib\\Message\\AMQPMessage;\n\n$connection = new AMQPStreamConnection('localhost', 5672, 'guest', 'guest');\n$channel = $connection-\u0026gt;channel();\n\n$channel-\u0026gt;queue_declare('hello', false, false, false, false);\n\n$msg = new AMQPMessage('Hello World!');\n$channel-\u0026gt;basic_publish($msg, '', 'hello');\n\n$channel-\u0026gt;close();\n$connection-\u0026gt;close();\n\necho \"basic_publish おっけ☆！（＾▽＾）\u0026lt;br /\u0026gt;\\n\";\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれ、HTTP ERROR 500。 basic_publish がダメか？\u003c/p\u003e\n\n\u003cp\u003e「frame_error on basic_publish」 (pika/pika)\u003cbr\u003e\n\u003ca href=\"https://github.com/pika/pika/issues/349\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/pika/pika/issues/349\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003elocalhost と書いているところが気になるが。IPアドレスに変えても変わりなし。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"phpのエラーログは出てないのだろうか\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#php%E3%81%AE%E3%82%A8%E3%83%A9%E3%83%BC%E3%83%AD%E3%82%B0%E3%81%AF%E5%87%BA%E3%81%A6%E3%81%AA%E3%81%84%E3%81%AE%E3%81%A0%E3%82%8D%E3%81%86%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ePHPのエラー・ログは出てないのだろうか？\u003c/h1\u003e\n\n\u003cp\u003e「PHPでのログ出力　まとめ」 (Qiita)\u003cbr\u003e\n\u003ca href=\"http://qiita.com/junpei_iwa/items/8dc9f62b4118186cf2df\" class=\"autolink\" id=\"reference-5b19c224e7d84f7a2663\"\u003ehttp://qiita.com/junpei_iwa/items/8dc9f62b4118186cf2df\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e/etc/php/7.0/apache2 ディレクトリに php.ini はあるが。\u003cbr\u003e\nスーパーユーザーに変えて、\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ecp php.ini php.ini.original\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eでファイルをコピーしておいて、php.ini の中を見てみる。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003edisplay_errors = Off\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eを、\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003edisplay_errors = On\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eに変える。外に公開していると Off にしないと内部データが見えてしまうが。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003elog_errors = On\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれは On になっていた。\u003cbr\u003e\nアパッチを再起動したらいいのか？\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003esudo service apache2 restart\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003cstrong\u003eあれっ？　アパッチを再起動したら、エラーが出るどころか、PHP が動いている？\u003c/strong\u003e\u003c/p\u003e\n\n\u003cp\u003etamesi5.php は動いたが、tamesi6.php は固まっている。これもシュリンクしてみよう。\u003c/p\u003e\n\n\u003cp\u003etamesi6a1.php\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u0026lt;?php\nrequire_once __DIR__ . '/vendor/autoload.php';\nuse PhpAmqpLib\\Connection\\AMQPStreamConnection;\n\n$connection = new AMQPStreamConnection('localhost', 5672, 'guest', 'guest');\n$channel = $connection-\u0026gt;channel();\n\n$channel-\u0026gt;queue_declare('hello', false, false, false, false);\n\necho 'queue_declare までおっけ☆（＾▽＾）！', \"\\n\";\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれはおっけ。\u003c/p\u003e\n\n\u003cp\u003etamesi6a2.php\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u0026lt;?php\nrequire_once __DIR__ . '/vendor/autoload.php';\nuse PhpAmqpLib\\Connection\\AMQPStreamConnection;\n\n$connection = new AMQPStreamConnection('localhost', 5672, 'guest', 'guest');\n$channel = $connection-\u0026gt;channel();\n\n$channel-\u0026gt;queue_declare('hello', false, false, false, false);\n\necho ' [*] Waiting for messages. To exit press CTRL+C', \"\\n\";\n\n$callback = function($msg) {\n  echo \" [x] Received \", $msg-\u0026gt;body, \"\\n\";\n};\n\n$channel-\u0026gt;basic_consume('hello', '', false, true, false, false, $callback);\n\necho 'basic_consume までおっけ☆（＾▽＾）！', \"\\n\";\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれもおっけ。\u003c/p\u003e\n\n\u003cp\u003eところで　ブローカーが止まっている気がする。RabbitMQ を起動させるには　どうやるんだったか。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003erabbitmq-server\nERROR: node with name \"rabbit\" already running on \"★略\"\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e動いてるのか。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"phpのログの出力先\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#php%E3%81%AE%E3%83%AD%E3%82%B0%E3%81%AE%E5%87%BA%E5%8A%9B%E5%85%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ePHPのログの出力先\u003c/h1\u003e\n\n\u003cp\u003e/etc/php/7.0/apache2/php.ini の\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e;error_log = php_errors.log\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eの部分を\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eerror_log = /var/log/php_errors.log\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eに変えた。アパッチを再起動。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003esudo service apache2 restart\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003etamesi6a3.php\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u0026lt;?php\nrequire_once __DIR__ . '/vendor/autoload.php';\nuse PhpAmqpLib\\Connection\\AMQPStreamConnection;\n\n$connection = new AMQPStreamConnection('localhost', 5672, 'guest', 'guest');\n$channel = $connection-\u0026gt;channel();\n\n$channel-\u0026gt;queue_declare('hello', false, false, false, false);\n\necho ' [*] Waiting for messages. To exit press CTRL+C', \"\\n\";\n\n$callback = function($msg) {\n  echo \" [x] Received \", $msg-\u0026gt;body, \"\\n\";\n};\n\n$channel-\u0026gt;basic_consume('hello', '', false, true, false, false, $callback);\n\n$channel-\u0026gt;wait();\n\necho 'wait() 1回ならおっけ☆（＾▽＾）！', \"\\n\";\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれはフリーズ。\u003cbr\u003e\nじゃあ、ウェイトがダメなのか？\u003c/p\u003e\n\n\u003cp\u003etamesi6a4.php\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u0026lt;?php\nrequire_once __DIR__ . '/vendor/autoload.php';\nuse PhpAmqpLib\\Connection\\AMQPStreamConnection;\n\n$connection = new AMQPStreamConnection('localhost', 5672, 'guest', 'guest');\n$channel = $connection-\u0026gt;channel();\n\n$channel-\u0026gt;queue_declare('hello', false, false, false, false);\n\necho ' [*] Waiting for messages. To exit press CTRL+C', \"\\n\";\n\n$callback = function($msg) {\n  echo \" [x] Received \", $msg-\u0026gt;body, \"\\n\";\n};\n\n$channel-\u0026gt;basic_consume('hello', '', false, true, false, false, $callback);\n\nsleep(3);\n\necho 'sleep(3)ならおっけ☆（＾▽＾）！', \"\\n\";\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれもおっけ☆\u003c/p\u003e\n\n\u003cp\u003etamesi6a5.php\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u0026lt;?php\nrequire_once __DIR__ . '/vendor/autoload.php';\nuse PhpAmqpLib\\Connection\\AMQPStreamConnection;\n\n$connection = new AMQPStreamConnection('localhost', 5672, 'guest', 'guest');\n$channel = $connection-\u0026gt;channel();\n\n$channel-\u0026gt;queue_declare('hello', false, false, false, false);\n\necho ' [*] Waiting for messages. To exit press CTRL+C', \"\\n\";\n\n$callback = function($msg) {\n  echo \" [x] Received \", $msg-\u0026gt;body, \"\\n\";\n};\n\n$channel-\u0026gt;basic_consume('hello', '', false, true, false, false, $callback);\n\nwhile(count($channel-\u0026gt;callbacks)) {\n    sleep(1);\n}\n\necho 'sleep(1)のループならおっけ☆（＾▽＾）！', \"\\n\";\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれはフリーズ。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"rabbitmqctl-list_queues\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#rabbitmqctl-list_queues\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003erabbitmqctl list_queues\u003c/h1\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003erabbitmqctl list_queues\nListing queues ...\n1111    0\nhello   0\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ephp tamesi5.php\n [x] Sent 'Hello World!'\nrabbitmqctl list_queues\nListing queues ...\n1111    0\nhello   0\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eキューの中身は見れないものか。\u003c/p\u003e\n\n\u003cp\u003e非同期ではなく、単にデキューできないのか？\u003c/p\u003e\n\n\u003cp\u003eキューに入ってない気もする。\u003c/p\u003e\n\n\u003cp\u003etamesi5a6.php\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u0026lt;?php\nrequire_once __DIR__ . '/vendor/autoload.php';\nuse PhpAmqpLib\\Connection\\AMQPStreamConnection;\nuse PhpAmqpLib\\Message\\AMQPMessage;\n\n$connection = new AMQPStreamConnection('localhost', 5672, 'guest', 'guest');\n$channel = $connection-\u0026gt;channel();\n\n$QKey = '1111';\n$channel-\u0026gt;queue_declare($QKey, false, false, false, false);\n\n$QMsg = 'Flying Dragon!';\n$msg = new AMQPMessage($QMsg);\n$channel-\u0026gt;basic_publish($msg, '', $QKey);\n\necho \" [x] Sent '\" . $QMsg . \"'\\n\";\n\n$channel-\u0026gt;close();\n$connection-\u0026gt;close();\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eキーを 1111 に。\u003c/p\u003e\n\n\u003cp\u003e「はじめての RabbitMQ」 (CyberAgent)\u003cbr\u003e\n\u003ca href=\"http://ameblo.jp/principia-ca/entry-11233853011.html\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://ameblo.jp/principia-ca/entry-11233853011.html\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003etamesi6.php は、[Ctrl]+[C] で止める前提だから、実用できないんじゃないか？\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003etamesi6.php は　受信用だから、ブラウザでアクセスするもんじゃない\u003c/strong\u003eんじゃないか。\u003c/p\u003e\n\n\u003cp\u003e$channel-\u0026gt;wait(); が処理をブロックして、コールバック関数を呼び出しているんじゃないか。\u003c/p\u003e\n\n\u003cp\u003etamesi6.php\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u0026lt;?php\n// サーバーの外部からはアクセスしない。\n// サーバーの内側に置いておく、受信用\n//\n// このプログラムは、コマンドラインで実行する\n// php tamesi6.php\n//\nrequire_once __DIR__ . '/vendor/autoload.php';\nuse PhpAmqpLib\\Connection\\AMQPStreamConnection;\n\n$connection = new AMQPStreamConnection('localhost', 5672, 'guest', 'guest');\n$channel = $connection-\u0026gt;channel();\n\n$QKey = '1111';\n$channel-\u0026gt;queue_declare($QKey, false, false, false, false);\n\necho ' [*] Waiting for messages. To exit press CTRL+C', \"\\n\";\n\n$callback = function($msg) {\n  echo \" [x] Received \", $msg-\u0026gt;body, \"\\n\";\n};\n\n$channel-\u0026gt;basic_consume($QKey, '', false, true, false, false, $callback);\n\n// 無限ループ\nwhile(count($channel-\u0026gt;callbacks))\n{\n    // ブロックする\n    $channel-\u0026gt;wait();\n}\n// ここに来ない\n// $channel-\u0026gt;close();\n// $connection-\u0026gt;close();\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eじゃあ、受信側はオッケー。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"cとphpはメッセージキューを介して通信できんの\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#c%E3%81%A8php%E3%81%AF%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E3%82%AD%E3%83%A5%E3%83%BC%E3%82%92%E4%BB%8B%E3%81%97%E3%81%A6%E9%80%9A%E4%BF%A1%E3%81%A7%E3%81%8D%E3%82%93%E3%81%AE\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eC#とPHPは、メッセージ・キューを介して通信できんの？\u003c/h1\u003e\n\n\u003cp\u003eC# の 1111 と、 PHPの 1111 は同じなのだろうか？見れないようだが。\u003cbr\u003e\nフォルダー位置とか関係あるのだろうか？\u003c/p\u003e\n\n\u003cp\u003e関係あるのは　'localhost', 5672　ぐらいかと思うが。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"どうも-c-と-php-のプロセス間通信ができてない\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%A9%E3%81%86%E3%82%82-c-%E3%81%A8-php-%E3%81%AE%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E9%96%93%E9%80%9A%E4%BF%A1%E3%81%8C%E3%81%A7%E3%81%8D%E3%81%A6%E3%81%AA%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eどうも C# と PHP のプロセス間通信ができてない\u003c/h1\u003e\n\n\u003cp\u003e見ているキューが違うのか。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e外部から tamesi2.php でエンキューした内容は、外部から tamesi3.php で見れる。（PHP）\u003c/li\u003e\n\u003cli\u003e外部から tamesi5.php でエンキューした内容は、内部の php tamesi6.php で見れる。（RabbitMQ）\u003c/li\u003e\n\u003cli\u003eC# でエンキューした内容は、C# でデキューできる。(RabbitMQ)\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e全部　ばらばらだ。\u003cstrong\u003e結局、ファイルで仲介するしかないのか？\u003c/strong\u003e\u003c/p\u003e\n\n\u003cp\u003eじゃあ、tamesi6.php を常駐できないか？\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"foreverコマンド\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#forever%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eforeverコマンド\u003c/h1\u003e\n\n\u003cp\u003e「node.js node.jsスクリプトをforeverでデーモン化する」 (でじうぃき)\u003cbr\u003e\n\u003ca href=\"http://onlineconsultant.jp/pukiwiki/?node.js%20node.js%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%82%92forever%E3%81%A7%E3%83%87%E3%83%BC%E3%83%A2%E3%83%B3%E5%8C%96%E3%81%99%E3%82%8B\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://onlineconsultant.jp/pukiwiki/?node.js%20node.js%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%82%92forever%E3%81%A7%E3%83%87%E3%83%BC%E3%83%A2%E3%83%B3%E5%8C%96%E3%81%99%E3%82%8B\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eこれは node.js 専用だったりしないんだろうか。\u003c/p\u003e\n\n\u003cp\u003e「自作プログラムをデーモンとして起動させる」 (\u003ca href=\"http://7ujm.net\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://7ujm.net\u003c/a\u003e)\u003cbr\u003e\n\u003ca href=\"http://7ujm.net/linux/daemon.html\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://7ujm.net/linux/daemon.html\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"nohup\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#nohup\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003enohup\u003c/h1\u003e\n\n\u003cp\u003e「ログアウトしてもバックグラウンド ジョブを継続する方法」 (ソースコード探検隊)\u003cbr\u003e\n\u003ca href=\"https://www.codereading.com/nb/ignore-the-hangup-signal.html\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://www.codereading.com/nb/ignore-the-hangup-signal.html\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eじゃあ、こんな感じにできるのだろうか？\u003c/p\u003e\n\n\u003cp\u003e'''\u003cbr\u003e\nnohup php tamesi6.php \u0026gt; out.log 2\u0026gt; err.log \u0026lt; /dev/null \u0026amp;\u003cbr\u003e\n'''\u003c/p\u003e\n\n\u003cp\u003e'''\u003cbr\u003e\n[3] 13092\u003cbr\u003e\njobs\u003cbr\u003e\n[1]+  Stopped                 nano tamesi6.php\u003cbr\u003e\n[2]   Running                 rabbitmq-server \u0026amp;\u003cbr\u003e\n[3]-  Running                 nohup php tamesi6.php \u0026gt; out.log 2\u0026gt; err.log \u0026lt; /dev/null \u0026amp;\u003cbr\u003e\n'''\u003c/p\u003e\n\n\u003cp\u003e試しにログアウトしてみる。\u003c/p\u003e\n\n\u003cp\u003esu コマンドを使い過ぎたのか、何回も exit した。\u003c/p\u003e\n\n\u003cp\u003e'''\u003cbr\u003e\njobs\u003cbr\u003e\n'''\u003c/p\u003e\n\n\u003cp\u003eなんにもいなくなったが。\u003c/p\u003e\n\n\u003cp\u003etamesi6.php は無限ループでなかったからか。\u003c/p\u003e\n\n\u003cp\u003eじゃあ、tamesi6.php を無限ループで囲って、 /var/www/html フォルダーから /home/watasi/shogi/ukamuse_sdt4/bin フォルダーへ移動しよう。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"phpの環境を作ろう\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#php%E3%81%AE%E7%92%B0%E5%A2%83%E3%82%92%E4%BD%9C%E3%82%8D%E3%81%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ePHPの環境を作ろう\u003c/h1\u003e\n\n\u003cp\u003eただ、コンピューター将棋サーバーの環境と混ざってややこしくなってしまう。\u003c/p\u003e\n\n\u003cp\u003eひとまず /home/watasi/shogi/receive というディレクトリを掘ることにする。\u003c/p\u003e\n\n\u003cp\u003e'''\u003cbr\u003e\n/home/csg10/shogi# mkdir receive\u003cbr\u003e\n'''\u003c/p\u003e\n\n\u003cp\u003eこの中に PHPプログラム用の環境を作ろう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ecd receive\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e次のようなファイルを作って置いておく。現状をどのような構成にしたいか書いておくファイルだ。\u003c/p\u003e\n\n\u003cp\u003ecomposer.json\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e{\n    \"require\": {\n        \"php-amqplib/php-amqplib\": \"2.5.*\"\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eコマンドを叩く。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ecomposer install\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eDo not run Composer as root/super user! See https://getcomposer.org/root for details\nLoading composer repositories with package information\nUpdating dependencies (including require-dev)\nPackage operations: 1 install, 0 updates, 0 removals\n  - Installing php-amqplib/php-amqplib (v2.5.2) Downloading: 100%\nWriting lock file\nGenerating autoload files\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eルートユーザーでは走らないと書いてあるが、走っているようだが……。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003els\ncomposer.json  composer.lock  vendor\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eなんか揃ってるし。PHP専用の環境にしたいんで、ディレクトリー名を php_receive にリネームするか。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ecd ..\nls\nreceive  ukamuse_sdt4  ukamuse_sdt4.zip\nmv receive php_receive\nls\nphp_receive  ukamuse_sdt4  ukamuse_sdt4.zip\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eじゃあ、ここに tamesi6.php を移動させよう。というか ここに loop6.php を書いて、tamesi6.php は削除しよう。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"loop6php-を書く\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#loop6php-%E3%82%92%E6%9B%B8%E3%81%8F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eloop6.php を書く\u003c/h1\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ecd php_receive\nnano loop6.php\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eでも ログアウトしたらなんで nohup でバックグラウンド起動した PHP が落ちたのだろうか。\u003cbr\u003e\nPHP が大元から落ちたのだろうか？\u003c/p\u003e\n\n\u003cp\u003e「nohup: run PHP process in background」 (stack overflow)\u003cbr\u003e\n\u003ca href=\"http://stackoverflow.com/questions/5288584/nohup-run-php-process-in-background\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://stackoverflow.com/questions/5288584/nohup-run-php-process-in-background\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e絶対パスで指定した方がいいのか。\u003c/p\u003e\n\n\u003cp\u003eloop6.php\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u0026lt;?php\n// 受信用\n// サーバーの外部からはアクセスしない。\n// サーバーの内側に置いて無限ループさせる\n//\n// このプログラムは、コマンドラインで実行する\n//\n\n// 操作説明を出力しておこう。ログファイルに出力されるんだろうが……\necho 'How to use'                 . \"\\n\";\necho '=========='                 . \"\\n\";\necho                                \"\\n\";\necho '    Start infinity loop'    . \"\\n\";\necho '    -------------------'    . \"\\n\";\necho '        After ( nohup php /home/★user/shogi/php_receive/loop6.php \u0026gt; /home/★user/shogi/php_log/loop6.out.log 2\u0026gt; /home/★user/shogi/php_log/loop6.err.log \u0026lt; /dev/null \u0026amp; )' . \"\\n\";\necho '        By absolute path.'  . \"\\n\";\necho                                \"\\n\";\necho '    To finish kill'         . \"\\n\";\necho '    --------------'         . \"\\n\";\necho '        jobs'               . \"\\n\";\necho '        kill %(job number)' . \"\\n\";\n\nrequire_once __DIR__ . '/vendor/autoload.php';\nuse PhpAmqpLib\\Connection\\AMQPStreamConnection;\n\n// プロセス間通信の前準備をするぜ☆（＾～＾）\n$connection = new AMQPStreamConnection('localhost', 5672, 'guest', 'guest');\n$channel = $connection-\u0026gt;channel();\n$QKey = '1111';\n$channel-\u0026gt;queue_declare($QKey, false, false, false, false);\n\n// キューを開いてしまえば、あとは無限ループ！\n\n// デキューしたタイミングですることをここに書く\n$callback = function($msg) {\n    echo \" [x] Received \", $msg-\u0026gt;body, \"\\n\";\n};\n$channel-\u0026gt;basic_consume($QKey, '', false, true, false, false, $callback);\n\n// 無限ループ\nwhile(count($channel-\u0026gt;callbacks))\n{\n    // ここでブロックしながらデキューする\n    $channel-\u0026gt;wait();\n}\n// ここに来ない\n// $channel-\u0026gt;close();\n// $connection-\u0026gt;close();\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eログフォルダーはここにする。\u003cbr\u003e\n/home/★user/shogi/php_log/\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e/home/user/shogi# mkdir php_log\nls\nphp_log  php_receive  ukamuse_sdt4  ukamuse_sdt4.zip\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"動かしてみよう\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8B%95%E3%81%8B%E3%81%97%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e動かしてみよう\u003c/h1\u003e\n\n\u003cp\u003ehttp://★.★.★.★/tamesi5.php\u003c/p\u003e\n\n\u003cp\u003eへアクセス。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e[x] Sent 'Flying Dragon!'\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ecd ..\nls\nphp_log  php_receive  ukamuse_sdt4  ukamuse_sdt4.zip\ncd php_log\nls\nloop6.err.log  loop6.out.log\nnano loop6.out.log\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eHow to use\n==========\n\n    Start infinity loop\n    -------------------\n        After ( nohup php /home/★user/shogi/php_receive/loop6.php \u0026gt; /home/★user$\n        By absolute path.\n\n    To finish kill\n    --------------\n        jobs\n        kill %(job number)\n [x] Received Flying Dragon!\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eよし、１行書き足されている。次はログアウトする。そしてログインし直す。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003esudo su -\n※パスワード入力\njobs\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e空っぽだ。\u003c/p\u003e\n\n\u003cp\u003e「Run php script on background in PHP with nohup CLI」 (stack overflow)\u003cbr\u003e\n\u003ca href=\"http://stackoverflow.com/questions/9100872/run-php-script-on-background-in-php-with-nohup-cli\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://stackoverflow.com/questions/9100872/run-php-script-on-background-in-php-with-nohup-cli\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003ephp コマンドも絶対パスで指定しろ、ということか。\u003c/p\u003e\n\n\u003cp\u003ephp を /usr/bin/php に書き直す。これ、コメントか。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eecho '        After ( nohup /usr/bin/php /home/★user/shogi/php_receive/loop6.php \u0026gt; /home/★user/shogi/php_log/loop6.out.log 2\u0026gt; /home/★user/shogi/php_log/loop6.err.log \u0026lt; /dev/null \u0026amp; )' . \"\\n\";\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e走らせて、ログアウト、ログイン。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ejobs\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eで空っぽ。\u003c/p\u003e\n\n\u003cp\u003e「ログアウトした後もプログラムの処理を続ける？（コマンド実行時にnohup）」 (kazmax)\u003cbr\u003e\n\u003ca href=\"http://kazmax.zpp.jp/linux_beginner/nohup.html\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://kazmax.zpp.jp/linux_beginner/nohup.html\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eパーミッションだろうか？\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003els -an\ntotal 12\ndrwxr-xr-x 2 0 0 4096 Mar  7 19:09 .\ndrwxr-xrwx 5 0 0 4096 Mar  7 18:49 ..\n-rw-r--r-- 1 0 0    0 Mar  7 19:06 loop6.err.log\n-rw-r--r-- 1 0 0  358 Mar  7 19:06 loop6.out.log\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eルート・ユーザーで実行しているんだから　問題ないような気もするが、\u003cbr\u003e\n一般ユーザーのディレクトリーに置いてあることは問題か？\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003echmod 666 loop6.err.log\nchmod 666 loop6.out.log\nls -an\n～中略～\n-rw-rw-rw- 1 0 0    0 Mar  7 19:06 loop6.err.log\n-rw-rw-rw- 1 0 0  358 Mar  7 19:06 loop6.out.log\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれでどうか？\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003elogout\nsudo su -\njobs\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e空っぽになっている。\u003c/p\u003e\n\n\u003cp\u003e「sshでログアウトしたあともコマンドを実行し続けたいときのnohupとscreen」 (don-bra.co)\u003cbr\u003e\n\u003ca href=\"http://asayamakk.hatenablog.com/entry/2016/04/09/213904\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://asayamakk.hatenablog.com/entry/2016/04/09/213904\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e「ログアウトしてもプログラムを実行させる」 (inamuu)\u003cbr\u003e\n\u003ca href=\"http://wiki.inamuu.com/index.php?%E3%83%AD%E3%82%B0%E3%82%A2%E3%82%A6%E3%83%88%E3%81%97%E3%81%A6%E3%82%82%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0%E3%82%92%E5%AE%9F%E8%A1%8C%E3%81%95%E3%81%9B%E3%82%8B\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://wiki.inamuu.com/index.php?%E3%83%AD%E3%82%B0%E3%82%A2%E3%82%A6%E3%83%88%E3%81%97%E3%81%A6%E3%82%82%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0%E3%82%92%E5%AE%9F%E8%A1%8C%E3%81%95%E3%81%9B%E3%82%8B\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003edisown と top を調べてみるか。\u003c/p\u003e\n\n\u003cp\u003e「HUPシグナルとnohupとdisownとバック/フォアグラウンドジョブの理解」 (Qiita)\u003cbr\u003e\n\u003ca href=\"http://qiita.com/yushin/items/732043ee23281f19f983\" class=\"autolink\" id=\"reference-1329b6f32eedfb94a93a\"\u003ehttp://qiita.com/yushin/items/732043ee23281f19f983\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e「nohup コマンド \u0026amp;」 は　やってるんだがなぁ。\u003c/p\u003e\n\n\u003cp\u003e「技術/UNIX/なぜnohupをバックグランドジョブとして起動するのが定番なのか？(擬似端末, Pseudo Terminal, SIGHUP他)」 (\u003ca href=\"http://www.glamenv-septzen.net\" rel=\"nofollow noopener\" target=\"_blank\"\u003ewww.glamenv-septzen.net\u003c/a\u003e)\u003cbr\u003e\n\u003ca href=\"https://www.glamenv-septzen.net/view/854\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://www.glamenv-septzen.net/view/854\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e「nohup コマンド \u0026amp;」 をやって jobs が空っぽになるんだがなぁ。\u003c/p\u003e\n\n\u003cp\u003e「Run a nohup command over SSH, then disconnect」 (Ubuntu)\u003cbr\u003e\n\u003ca href=\"http://askubuntu.com/questions/349262/run-a-nohup-command-over-ssh-then-disconnect\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://askubuntu.com/questions/349262/run-a-nohup-command-over-ssh-then-disconnect\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"一般ユーザーで-putty-を使って-sshプロトコルでログインしてnohup-コマンド-をやって-exit-して再度ログインするとjobs-は空っぽ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%B8%80%E8%88%AC%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E3%81%A7-putty-%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6-ssh%E3%83%97%E3%83%AD%E3%83%88%E3%82%B3%E3%83%AB%E3%81%A7%E3%83%AD%E3%82%B0%E3%82%A4%E3%83%B3%E3%81%97%E3%81%A6nohup-%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89-%E3%82%92%E3%82%84%E3%81%A3%E3%81%A6-exit-%E3%81%97%E3%81%A6%E5%86%8D%E5%BA%A6%E3%83%AD%E3%82%B0%E3%82%A4%E3%83%B3%E3%81%99%E3%82%8B%E3%81%A8jobs-%E3%81%AF%E7%A9%BA%E3%81%A3%E3%81%BD\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e一般ユーザーで PuTTY を使って SSHプロトコルでログインして、「nohup コマンド \u0026amp;」をやって exit して再度ログインすると、jobs は空っぽ。\u003c/h1\u003e\n\n\u003cp\u003eどこから手を付けるべきか。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"ジョブとプロセスは違う\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B8%E3%83%A7%E3%83%96%E3%81%A8%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E3%81%AF%E9%81%95%E3%81%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eジョブとプロセスは違う\u003c/h1\u003e\n\n\u003cp\u003e「ログアウトしてもプログラムを実行し続ける」 (Linuxコマンド逆引き大全)\u003cbr\u003e\n\u003ca href=\"http://itpro.nikkeibp.co.jp/article/COLUMN/20060228/231191/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://itpro.nikkeibp.co.jp/article/COLUMN/20060228/231191/\u003c/a\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eps\n  PID TTY          TIME CMD\n21573 pts/1    00:00:00 bash\n21924 pts/1    00:00:00 ps\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eプロセスもいないが。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003enohup /usr/bin/php /home/★user/shogi/php_receive/loop6.php \u0026gt; /home/★user/shogi/php_log/loop6.out.log 2\u0026gt; /home/★user/shogi/php_log/loop6.err.log \u0026lt; /dev/null \u0026amp;\n ps\n  PID TTY          TIME CMD\n21573 pts/1    00:00:00 bash\n21955 pts/1    00:00:00 php\n21956 pts/1    00:00:00 ps\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eここからスーパーユーザーにログインしてみる。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003esudo su -\nps\n  PID TTY          TIME CMD\n21971 pts/1    00:00:00 sudo\n21972 pts/1    00:00:00 su\n21973 pts/1    00:00:00 bash\n21989 pts/1    00:00:00 ps\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"シェルスクリプトならどうか\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B7%E3%82%A7%E3%83%AB%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%81%AA%E3%82%89%E3%81%A9%E3%81%86%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eシェル・スクリプトならどうか？\u003c/h1\u003e\n\n\u003cp\u003ePHPプロセスが消えているんじゃないか。\u003c/p\u003e\n\n\u003cp\u003eじゃあ、シェル・スクリプトなら消えないのか？\u003c/p\u003e\n\n\u003cp\u003e「bash で無限ループ」 (ablog)\u003cbr\u003e\n\u003ca href=\"http://d.hatena.ne.jp/yohei-a/20090524/1243171328\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://d.hatena.ne.jp/yohei-a/20090524/1243171328\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eloop8.sh\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e#!/bin/bash\n# 無限ループの置物\nwhile :\ndo\n    # ここに処理を書く\n    sleep 1m\ndone\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e「Linux / UNIX: Bash Script Sleep or Delay a Specified Amount of Time」 (nixCraft)\u003cbr\u003e\n\u003ca href=\"https://www.cyberciti.biz/faq/linux-unix-sleep-bash-scripting/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://www.cyberciti.biz/faq/linux-unix-sleep-bash-scripting/\u003c/a\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003emkdir bash_receive\nmkdir bash_log\ncd bash_receive\nnano loop8.sh\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003enohup /home/★user/shogi/bash_receive/loop8.sh \u0026gt; /home/★user/shogi/bash_log/loop8.out.log 2\u0026gt; /home/★user/shogi/bash_log/loop8.err.log \u0026lt; /dev/null \u0026amp;\n[1] 22338\njobs\n[1]+  Exit 126                nohup /home/★user/shogi/bash_receive/loop8.sh \u0026gt; /home/★user/shogi/bash_log/loop8.out.log 2\u0026gt; /home/★user/shogi/bash_log/loop8.err.log \u0026lt; /dev/null\nps\n  PID TTY          TIME CMD\n21971 pts/1    00:00:00 sudo\n21972 pts/1    00:00:00 su\n21973 pts/1    00:00:00 bash\n22262 pts/1    00:00:00 ps\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれで bash プロセスが loop8.sh を実行するジョブをやっているのか。\u003cbr\u003e\nもう１回\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ejobs\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e空っぽだ。Exit してるんじゃないか。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"記事が長くなったので次の記事に移る\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A8%98%E4%BA%8B%E3%81%8C%E9%95%B7%E3%81%8F%E3%81%AA%E3%81%A3%E3%81%9F%E3%81%AE%E3%81%A7%E6%AC%A1%E3%81%AE%E8%A8%98%E4%BA%8B%E3%81%AB%E7%A7%BB%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e記事が長くなったので、次の記事に移る。\u003c/h1\u003e\n","createdAt":"2017-03-06T08:50:01Z","elapsedYearsFromLastModifiedAt":4,"encryptedId":"O2tjYSbZGd6n/mkx+dx4i5AcgzoGYw1I--22lC+WWxR9exYfOQ--3Fdj6AjCkoBahQp/4OBM7g==","isBanned":false,"isDeprecated":true,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2017-03-07T11:54:14Z","likesCount":0,"linkUrl":"https://qiita.com/muzudho1/items/bf3f6debf6db7f96300c","organization":null,"originalId":474164,"stockedCount":0,"title":"コンピュータ将棋ソフトとの対局サーバーを立てよう＜その２＞","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#ubuntu%E3%81%A7%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E9%96%93%E9%80%9A%E4%BF%A1%E3%81%97%E3%82%88%E3%81%86\"\u003eUbuntuでプロセス間通信しよう\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#rabbitmq-%E3%82%92%E5%85%A5%E6%89%8B%E3%81%97%E3%81%9F%E6%96%B9%E3%81%8C%E3%81%84%E3%81%84%E3%81%AE%E3%81%A7%E3%81%AF\"\u003eRabbitMQ を入手した方がいいのでは？\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#erlang-%E3%82%A2%E3%83%BC%E3%83%A9%E3%83%B3%E3%82%92%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89%E3%81%97%E3%82%88%E3%81%86\"\u003eErlang （アーラン）をダウンロードしよう\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#php-%E3%81%A8-%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E3%82%AD%E3%83%A5%E3%83%BC%E3%81%AF%E9%80%9A%E4%BF%A1%E3%81%A7%E3%81%8D%E3%82%8B%E3%81%AE%E3%81%8B\"\u003ePHP と メッセージ・キューは通信できるのか？\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E3%82%AD%E3%83%A5%E3%83%BC%E3%81%AB%E3%81%AF%E6%AC%A1%E3%81%AE%E3%82%82%E3%81%AE%E3%81%8C%E3%81%82%E3%82%8B%E3%81%AF%E3%81%9A%E3%81%A0\"\u003eメッセージ・キューには次のものがあるはずだ\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#linux%E3%81%AE%E7%92%B0%E5%A2%83%E5%A4%89%E6%95%B0\"\u003eLinuxの環境変数？\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#erlang-%E3%82%92%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89%E3%81%97%E3%81%9F%E3%81%9E\"\u003eERLANG をダウンロードしたぞ\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#rabbitmqclientdll-%E3%82%92%E6%8E%A2%E3%81%99%E3%81%8B\"\u003eRabbitMQ.Client.dll を探すか\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#nuget%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8\"\u003eNuGetパッケージ\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%83%9E%E3%83%8D%E3%83%BC%E3%82%B8%E3%83%A3%E3%82%B3%E3%83%B3%E3%82%BD%E3%83%BC%E3%83%AB%E3%81%A3%E3%81%A6%E4%BD%95%E3%81%A0\"\u003eパッケージマネージャコンソールって何だ？\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#rabbitmq-%E3%81%AE%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0%E3%82%92%E6%9B%B8%E3%81%84%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86\"\u003eRabbitMQ のサンプル・プログラムを書いてみよう。\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#rabbitmqclientdll-%E3%81%AE%E3%82%A2%E3%83%83%E3%83%97%E3%82%B0%E3%83%AC%E3%83%BC%E3%83%89%E3%81%AE%E6%96%B9%E6%B3%95%E3%82%92%E8%AA%BF%E3%81%B9%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86\"\u003eRabbitMQ.Client.dll のアップグレードの方法を調べてみよう。\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0%E3%81%A7%E3%81%AF%E5%BC%95%E6%95%B0%E3%81%8C%EF%BC%95%E5%80%8B\"\u003eサンプル・プログラムでは引数が５個\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#ubuntu-%E3%81%A7-nuget-%E3%81%A3%E3%81%A6%E4%BD%BF%E3%81%88%E3%82%8B%E3%81%AE\"\u003eUbuntu で NuGet って使えるの？\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#rabbitmq-%E3%81%AE%E5%81%9C%E6%AD%A2%E3%81%A8%E8%B5%B7%E5%8B%95\"\u003eRabbitMQ の停止と起動\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E9%96%93%E9%80%9A%E4%BF%A1%E4%BB%A5%E5%A4%96%E3%81%AE%E6%96%B9%E6%B3%95%E3%81%8C%E3%81%82%E3%82%8B%E3%81%A0%E3%82%8D%E3%81%86%E3%81%8B\"\u003eプロセス間通信以外の方法があるだろうか？\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%98%E3%82%83%E3%81%82-queuedeclare-%E3%81%AE%E5%BC%95%E6%95%B0%E3%81%AF%E3%81%84%E3%81%8F%E3%81%A4%E3%81%A0%E3%81%A3%E3%81%9F%E3%82%89%E3%81%84%E3%81%84%E3%81%AE%E3%81%8B\"\u003eじゃあ、 QueueDeclare の引数はいくつだったらいいのか？\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%AE%9F%E8%A1%8C%E3%81%97%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86\"\u003e実行してみよう\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%AC%A1%E3%81%AF-php-%E3%81%A7%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E9%96%93%E9%80%9A%E4%BF%A1%E3%81%99%E3%82%8B%E6%96%B9%E6%B3%95%E3%82%92%E8%AA%BF%E3%81%B9%E3%82%88%E3%81%86\"\u003e次は PHP でプロセス間通信する方法を調べよう\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%A8%E3%81%93%E3%82%8D%E3%81%A7%E3%83%A1%E3%83%A2%E3%81%82%E3%81%A8%E3%81%A7%E8%AA%BF%E3%81%B9%E3%82%8B\"\u003eところでメモ。あとで調べる\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#php%E3%81%AE%E7%B6%9A%E3%81%8D\"\u003ePHPの続き\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E3%82%AD%E3%83%A5%E3%83%BC%E3%81%8C%E7%A9%BA%E3%81%A3%E3%81%BD%E3%81%AE%E3%81%A8%E3%81%8D%E3%81%AB-receive-%E3%81%99%E3%82%8B%E3%81%A8%E5%9B%BA%E3%81%BE%E3%81%A3%E3%81%A6%E3%81%97%E3%81%BE%E3%81%86%E3%81%AE%E3%81%A7\"\u003eメッセージ・キューが空っぽのときに receive すると固まってしまうので\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#rabbitmq-%E3%82%92%E5%86%8D%E8%B5%B7%E5%8B%95\"\u003eRabbitMQ を再起動\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#php%E3%81%AE%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E3%82%AD%E3%83%A5%E3%83%BC%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0%E3%82%92%E6%9B%B8%E3%81%8D%E7%9B%B4%E3%81%97%E3%81%9F\"\u003ePHPのメッセージ・キュー・プログラムを書き直した\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#php%E3%81%A8c%E3%81%AE%E9%96%93%E3%81%A7%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E9%96%93%E9%80%9A%E4%BF%A1%E3%81%A7%E3%81%8D%E3%82%93%E3%81%AE\"\u003ePHPとC#の間で　プロセス間通信できんの？\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B3%E3%83%B3%E3%83%91%E3%82%A4%E3%83%AB%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3-%E3%83%97%E3%83%AA%E3%83%97%E3%83%AD%E3%82%BB%E3%83%83%E3%82%B5%E5%AE%9A%E7%BE%A9\"\u003eコンパイル・オプション プリプロセッサ定義\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#c%E3%81%AE%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E9%96%93%E9%80%9A%E4%BF%A1%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0%E3%82%92%E3%81%95%E3%82%89%E3%81%AB%E4%BF%AE%E6%AD%A3\"\u003eC#のプロセス間通信プログラムをさらに修正\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#c-%E3%81%A8-php-%E3%81%AE%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E9%96%93%E9%80%9A%E4%BF%A1%E3%81%AF%E3%81%A9%E3%81%86%E3%82%84%E3%82%8B%E3%81%AE%E3%81%8B\"\u003eC# と PHP のプロセス間通信はどうやるのか？\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#ubuntu-%E3%81%AB-composer-%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%8C%E8%A6%81%E3%82%8B%E3%81%A0%E3%82%8D%E3%81%86%E3%81%8B\"\u003eUbuntu に composer のインストールが要るだろうか\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#php-amqplib-%E3%81%AF%E3%81%A9%E3%81%86%E3%82%84%E3%81%A3%E3%81%A6%E5%85%A5%E6%89%8B%E3%81%99%E3%82%8B%E3%81%AE%E3%81%8B\"\u003ephp-amqplib はどうやって入手するのか？\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#composer-%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\"\u003ecomposer のインストール\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#bcmath\"\u003ebcmath\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#composerphar\"\u003ecomposer.phar\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#varwwwhtml-%E3%81%A7\"\u003evar/www/html で\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#dir%E3%81%A3%E3%81%A6%E3%81%A9%E3%81%93\"\u003eDIRってどこ\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B7%E3%83%A5%E3%83%AA%E3%83%B3%E3%82%AF%E3%81%97%E3%81%A6%E3%81%84%E3%81%8F%E3%81%8B\"\u003eシュリンクしていくか？\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#php%E3%81%AE%E3%82%A8%E3%83%A9%E3%83%BC%E3%83%AD%E3%82%B0%E3%81%AF%E5%87%BA%E3%81%A6%E3%81%AA%E3%81%84%E3%81%AE%E3%81%A0%E3%82%8D%E3%81%86%E3%81%8B\"\u003ePHPのエラー・ログは出てないのだろうか？\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#php%E3%81%AE%E3%83%AD%E3%82%B0%E3%81%AE%E5%87%BA%E5%8A%9B%E5%85%88\"\u003ePHPのログの出力先\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#rabbitmqctl-list_queues\"\u003erabbitmqctl list_queues\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#c%E3%81%A8php%E3%81%AF%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E3%82%AD%E3%83%A5%E3%83%BC%E3%82%92%E4%BB%8B%E3%81%97%E3%81%A6%E9%80%9A%E4%BF%A1%E3%81%A7%E3%81%8D%E3%82%93%E3%81%AE\"\u003eC#とPHPは、メッセージ・キューを介して通信できんの？\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%A9%E3%81%86%E3%82%82-c-%E3%81%A8-php-%E3%81%AE%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E9%96%93%E9%80%9A%E4%BF%A1%E3%81%8C%E3%81%A7%E3%81%8D%E3%81%A6%E3%81%AA%E3%81%84\"\u003eどうも C# と PHP のプロセス間通信ができてない\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#forever%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89\"\u003eforeverコマンド\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#nohup\"\u003enohup\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#php%E3%81%AE%E7%92%B0%E5%A2%83%E3%82%92%E4%BD%9C%E3%82%8D%E3%81%86\"\u003ePHPの環境を作ろう\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#loop6php-%E3%82%92%E6%9B%B8%E3%81%8F\"\u003eloop6.php を書く\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%8B%95%E3%81%8B%E3%81%97%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86\"\u003e動かしてみよう\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%B8%80%E8%88%AC%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E3%81%A7-putty-%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6-ssh%E3%83%97%E3%83%AD%E3%83%88%E3%82%B3%E3%83%AB%E3%81%A7%E3%83%AD%E3%82%B0%E3%82%A4%E3%83%B3%E3%81%97%E3%81%A6nohup-%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89-%E3%82%92%E3%82%84%E3%81%A3%E3%81%A6-exit-%E3%81%97%E3%81%A6%E5%86%8D%E5%BA%A6%E3%83%AD%E3%82%B0%E3%82%A4%E3%83%B3%E3%81%99%E3%82%8B%E3%81%A8jobs-%E3%81%AF%E7%A9%BA%E3%81%A3%E3%81%BD\"\u003e一般ユーザーで PuTTY を使って SSHプロトコルでログインして、「nohup コマンド \u0026amp;」をやって exit して再度ログインすると、jobs は空っぽ。\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B8%E3%83%A7%E3%83%96%E3%81%A8%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E3%81%AF%E9%81%95%E3%81%86\"\u003eジョブとプロセスは違う\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B7%E3%82%A7%E3%83%AB%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%81%AA%E3%82%89%E3%81%A9%E3%81%86%E3%81%8B\"\u003eシェル・スクリプトならどうか？\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E8%A8%98%E4%BA%8B%E3%81%8C%E9%95%B7%E3%81%8F%E3%81%AA%E3%81%A3%E3%81%9F%E3%81%AE%E3%81%A7%E6%AC%A1%E3%81%AE%E8%A8%98%E4%BA%8B%E3%81%AB%E7%A7%BB%E3%82%8B\"\u003e記事が長くなったので、次の記事に移る。\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":3131,"uuid":"bf3f6debf6db7f96300c","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"5Dmzh7Auv8hy7JApr4TBM8kqW9cR--7tn+lvgp/nHwbwyG--DKVbZMmA63pkmKBk5DzulQ==","originalId":159417,"description":"（＾～＾）","facebookUrl":null,"githubUrl":"https://github.com/muzudho","isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"むずでょ","profileImageUrl":"https://pbs.twimg.com/profile_images/378800000224959199/109762cc48c6e63fad3fbe01065cf862_normal.png","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fpbs.twimg.com%2Fprofile_images%2F378800000224959199%2F109762cc48c6e63fad3fbe01065cf862_normal.png?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=ac753dd2bb5cdc1f7b4a59405a8d431d","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fpbs.twimg.com%2Fprofile_images%2F378800000224959199%2F109762cc48c6e63fad3fbe01065cf862_normal.png?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=3ed9df1f72e7b42b01bc26234820b49f","urlName":"muzudho1","websiteUrl":"http://kifuwarabe.warabenture.com/","twitterUrl":"https://twitter.com/muzudho1","twitterUrlName":"muzudho1","revealedOrganizations":{"edges":[]}},"tags":[{"name":"Erlang","urlName":"erlang"},{"name":"Ubuntu","urlName":"ubuntu"},{"name":"C#","urlName":"csharp"},{"name":"RabbitMQ","urlName":"rabbitmq"},{"name":"プロセス間通信","urlName":"%e3%83%97%e3%83%ad%e3%82%bb%e3%82%b9%e9%96%93%e9%80%9a%e4%bf%a1"}],"followingLikers":{"edges":[]},"comments":{"totalCount":0}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

More than 1 year has passed since last update.Unityにはネットワーク接続確認の機能Application.internetReachabilityが存在しますが、あえてNWPathMonitorを使ったSwiftのネイティブプラグインを作ってみました。iOSのネットワーク接続状態の検出にはReachabilityよりシンプルなNWPathMonitorを使いましょう。 - Qiita
Swift周りの処理はコチラの記事を参考にさせて頂きました。NWPathMonitorインスタンス(monitor)を使って接続中であれば"1"、切断中であれば"0"を予めセットしておいたコールバックで返却します。今回NWPathMonitorを使うにあたって、iOS12以降が必須となるため、API_AVAILABLEでiOS12以降が必須であることを宣言します。UniNWPathMonitorに対しコールバックをセットします。
コールバックが返ってきたらUnitySendMessageを使ってUnity側のに接続情報を返却します。Objective-C++の記述は以前執筆したコチラの記事を参考にして頂ければと思います。
【Unity】最近のUnityでC#からSwiftを実行する最短実装 - QiitaUnity側ではこのような使い方になります。
UniNWPathMonitorにStartMonitorを実行しコールバックをセットするだけです。
実際作ったものはコチラ。WifiのオンオフをしてUnity側でコールバックを受け取っています。切り替えてUnityにコールバックが返るまで少しラグが発生するようです。冒頭で申し上げたとおり、ぶっちゃけUnityの場合はApplication.internetReachabilityが存在するため本プラグインは不要です。※筆者が作ってみたかったから作ってみたというやつです。自分にとっては、実際に作ってみて学びは多かったです。初めて出てきたSwiftのコールバック文法や、iOS12以降を必須にする方法など、現在勉強中のSwiftの事を知る機会が出来て良かったです。以下に全ソースアップしているので、ご参考にどうぞ。
https://github.com/baobao/UniNWPathMonitor



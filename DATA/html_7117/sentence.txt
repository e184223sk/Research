本当はPCに一瞬たりとも待たされたくないんです。待ち時間は操作するユーザーのためにあるもので、PCがユーザーを待たせるなど言語道断。とは言うものの全ての処理が一瞬で終了するわけでもなし。というわけでPCがユーザーを待たせている間は「このへんまで進んでるでー」というのをお知らせしたい。１秒やそこら待たされるのであればちょっと反応悪いなぐらいで済みますが数秒から数十秒ともなればちゃんと処理が進んでいるのかそれともなんかの都合でハングしちゃてるのかぐらいは知りたい。昔何かで読みましたが同じ秒数を待たせるにしても進捗表示のありなしで体感時間が変わってくるとか。で、今回は超単純な例を出します。フォーム上のボタンをクリックすると５秒後に「終わり！」と表示します。５秒なので１秒おきに進捗通知(%)を行いラベルに表示します。１秒おきに進捗表示を更新するので１秒スリープx5にし、スリープが終わると進捗をラベルに表示する計画。動かしてみるとどうでしょう。全然ラベルの表示が更新されず、５秒後に100%表示になります。まぁ当たり前の結果です。VB/VBAで良くやった古の手法。Application.DoEvents メソッド
メッセージ キューに現在ある Windows メッセージをすべて処理します。これはこれでちゃんと進捗表示になりはしますが今時こんなコード書く人もいないでしょう。シンプルさではBackgroundWorkerかなと思わないでもないですが。今頃BackgroundWorker云々言うのは単に私が慣れ親しんでいるからです。Task使った同じく非同期処理。ちょっと構造が複雑ですがこれもイディオムだと思えば馴れの範疇でしょうか。ソフトウェア作成当初は扱うデータ量も少なくて特に進捗表示不要にも思うこともあるかもしれませんが余力があれば盛り込んでおくと幸せになることがあるかも。進捗表示は別に％表示に限ったものではなくて処理ファイル数やダウンロードバイト数など百分率ではない表示でも全然いいと思います。知りたいのは「処理は進んでいるのか」「進んでいるならどのへんまで」ですから。そうは言ってもプログレスバーで表示するなら大概プロパティは百分率な気もしますけど。



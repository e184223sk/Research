More than 1 year has passed since last update.オンラインゲームにかかせないランキング機能、自分で作るのは少し面倒ですよね。
PlayFab にはユーザーのランキングを管理したり、ランキングに応じて報酬を配ったりできる機能があります。試しに使ってみたところ、とても便利な機能だったので記事に残しておこうと思います。※ゲームプレイ後に超簡易的なランキング画面が表示されます。
PlayFab は統計情報（スコアなど）をクライアントから送信することをデフォルトでは禁止しています。チート対策のために基本的にはサーバー側で処理してね、とのことですが今回は個人制作の趣味のゲームですし、クライアントからサクッと値を送信したいと思います。そのために GameManager の設定画面で クライアントにプレイヤー統計情報のポストを許可する を有効にします。
これを忘れるとクライアントから統計情報を送信したときに下記のエラーがでるので注意してください。
GameManager で新しいランキングを作成します。
続いてどのようなランキングを作成するか決めます。
統計情報名
わかりやすい名前ならなんでも大丈夫です。
一度決めると変更できないので慎重に。リセット頻度
今回は手動にしますが、毎時/毎日/毎週/毎月なども選べます。
ランキングリセットの際は自動で報酬を配布したりすることもできます。（後述）集計方法
今回はプレイヤーごとの最多ジャンプ成功数をランキング表示したいので 最大 にしておきます。ランキングにユーザー名を表示するためにはユーザーの DisplayName を登録しておく必要があります。
ゲーム内でユーザー名を設定する画面を作り、以下のようなコードで PlayFab へ登録しておきましょう。ちなみに登録した DisplayName は GameManager のプレイヤー一覧などにも自動的に表示されます。
地味に嬉しいですね！
以下のようなコードで統計情報を送信することができます。※送信した統計情報がランキングに反映されるまで1～2秒かかる場合があります。
※ですので送信後すぐにランキングを取得するような設計は控えましょう。
※こちらの記事で詳しく解説されています。以下のようなコードでランキングを取得することができます。実行すると以下のような結果が得られます。
これを良い感じに UI に組み込むだけでランキングの完成です！
ちなみにランキングのデータは GameManager で確認することが可能です。便利ですね。
そういえば今回は1位からのランキングを取得/表示しましたが、実際は自分の+-5位のランキングを表示したかったりすると思います。その場合は GetLeaderboard の代わりに GetLeaderboardAroundPlayer を使います。
コードは殆ど同じです。ゲーム内の実装の話はここまでです。
最後にランキング報酬を配ってみましょう。GameManager でランキングを開きます。
プライズテーブルを開いて、新しいプライズテーブルを作成します。
ランキング1～5位には魔法石10個、6～10位には魔法石5個を配る設定を作ってみました。
画面が直感的に操作できて素敵です。（スクショが長くてごめんなさい）

※アイテムは複数種類を一度に配布することも可能です。
※無料プランではランキング10位までしか報酬を配れないので注意してください。
※$99.99課金すると1000位まで配れるようになります。
※報酬を配る以外にも、ランキングに応じてメールを送信する、プッシュ通知を送る、自分で書いたスクリプトを実行するなどの処理が可能です。JumpCount のランキング表示に戻って、今すぐリセットを押します。
イベントが終わったらポチッとリセットする感じの運用ですね。
確認画面が表示されるのでリセットしてください。
これでランキングがリセットされて、同時に報酬が配布されます。
先程1位だったNishiさんのインベントリを覗いてみると、ちゃんと魔法石が配布されていますね。
ゲームにランキングを簡単に実装できると聞いて試してみましたが、想像以上に簡単で驚きました。
報酬の配布もとても便利で最高ではないでしょうか。



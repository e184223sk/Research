<!DOCTYPE html><html><head><meta charset="utf-8" /><title>巷にあふれているSendInput(Windows API)の座標変換のソースコードに物申す - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/kob58im/items/23df9e22778b33986d1c" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="TV9/4SoMM4aufn0DMOk7c5C0VM6oXKj7wRsVTUgx1KLhejrsz2V5pjuUv323Se/sLfF+IS5SK0BqVlcB6+Ca9g==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta property="og:type" content="article"><meta property="og:title" content="巷にあふれているSendInput(Windows API)の座標変換のソースコードに物申す - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND01YmUzNDRHcjQ0R0M0NEcxNDRLTTQ0R200NEdFNDRLTFUyVnVaRWx1Y0hWMEtGZHBibVJ2ZDNNZ1FWQkpLZU9CcnVXNnAtYW9tZVdraWVhUG0tT0JydU9DdmVPRHZPT0N1ZU9Dcy1PRHZPT0RpZU9CcS1lSnFlZVVzLU9CbVEmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT01NCZ0eHQtY2xpcD1lbGxpcHNpcyZ0eHQtYWxpZ249Y2VudGVyJTJDbWlkZGxlJnM9ZWEyMDljMzIyMGFjN2U3YTdjZWY4N2RkZTU1NWE5NTQ&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RR3R2WWpVNGFXMCZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTQ1JnR4dC1hbGlnbj1yaWdodCUyQ2JvdHRvbSZzPTc4ZDBhYjRlMmYyOWNmODA2YzJjMWIyMjk5ZjBkMzFk&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=b56231797d1111c4924ec4c25bf84163"><meta property="og:description" content="

0. 注記

WindowsAPIのソースコードは調べられなかったので、実験ベースでの検証になります。
コード例はC#です。

「コードはよ」というかたは、最後の章へ。
マルチモニタでの挙動は未検証です。


1. 絶対座標指定で..."><meta content="https://qiita.com/kob58im/items/23df9e22778b33986d1c" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="Windows,C#,数学,Win32API" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 1nzh4zz 38fzdi helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-1nzh4zz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:16px 32px;background-color:#FBE69E;color:rgba(0,0,0,0.87);line-height:1.5;font-weight:600;}@media (max-width:770px){.css-1nzh4zz{padding:16px;}}.css-38fzdi{color:#CA832A;margin-right:4px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-a2aee013-15ff-440e-8de8-af022df6334f"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Fkob58im%2Fitems%2F23df9e22778b33986d1c">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Fkob58im%2Fitems%2F23df9e22778b33986d1c">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-a2aee013-15ff-440e-8de8-af022df6334f">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/windows","name":"Windows"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2020-08-22T09:55:52.000+09:00","dateModified":"2020-08-22T15:59:41.000+09:00","headline":"巷にあふれているSendInput(Windows API)の座標変換のソースコードに物申す","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND01YmUzNDRHcjQ0R0M0NEcxNDRLTTQ0R200NEdFNDRLTFUyVnVaRWx1Y0hWMEtGZHBibVJ2ZDNNZ1FWQkpLZU9CcnVXNnAtYW9tZVdraWVhUG0tT0JydU9DdmVPRHZPT0N1ZU9Dcy1PRHZPT0RpZU9CcS1lSnFlZVVzLU9CbVEmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT01NCZ0eHQtY2xpcD1lbGxpcHNpcyZ0eHQtYWxpZ249Y2VudGVyJTJDbWlkZGxlJnM9ZWEyMDljMzIyMGFjN2U3YTdjZWY4N2RkZTU1NWE5NTQ\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RR3R2WWpVNGFXMCZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTQ1JnR4dC1hbGlnbj1yaWdodCUyQ2JvdHRvbSZzPTc4ZDBhYjRlMmYyOWNmODA2YzJjMWIyMjk5ZjBkMzFk\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=b56231797d1111c4924ec4c25bf84163","mainEntityOfPage":"https://qiita.com/kob58im/items/23df9e22778b33986d1c","author":{"@type":"Person","address":"","email":null,"identifier":"kob58im","name":"kob58im","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fs3-ap-northeast-1.amazonaws.com%2Fqiita-image-store%2F0%2F438183%2F2a98273b33a1aaed7a0715e06359994fe6d0636b%2Fx_large.png%3F1575159318?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=0027b6d3e0ec08faa169ea869eb67b5a","url":"https://qiita.com/kob58im","description":"趣味でC#で色々試してます。\r\n置いてるほとんどのC#サンプルコードは、Windows7以降デフォで入ってる環境でコンパイルできます。\r\n最近はCodePen使ってJavaScriptも書いてます。","memberOf":[]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://zine.qiita.com/interview/202107-hitachi-3/?utm_source=qiita&amp;utm_medium=header-banner">「作業者の負荷情報の見える化」に取り組む研究者が語る日立の魅力</a><a target="_blank" id="header_text_message_2" href="https://zine.qiita.com/interview/202107-hitachi-3/?utm_source=qiita&amp;utm_medium=header-banner">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"kob58im","type":"items","id":"23df9e22778b33986d1c"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"「作業者の負荷情報の見える化」に取り組む研究者が語る日立の魅力","url":"https://zine.qiita.com/interview/202107-hitachi-3/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"kob58im","type":"items","id":"23df9e22778b33986d1c"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_1","message":"「作業者の負荷情報の見える化」に取り組む研究者が語る日立の魅力","url":"https://zine.qiita.com/interview/202107-hitachi-3/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"kob58im","type":"items","id":"23df9e22778b33986d1c"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_2","message":"「作業者の負荷情報の見える化」に取り組む研究者が語る日立の魅力","url":"https://zine.qiita.com/interview/202107-hitachi-3/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/kob58im/items/23df9e22778b33986d1c","location":"/kob58im/items/23df9e22778b33986d1c","scheme":"https","host":"qiita.com","port":null,"pathname":"/kob58im/items/23df9e22778b33986d1c","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"SfXKHsfKQsBPSaeSx2R4x1BunHtWjv+Dc5BfhbtQBr3l0I8TIqMI4NqjZexAxKxY7Su2lNCAfDjY3R3JGIFI6Q==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-e429418b-db20-487c-912c-9de5ae8252c1"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/kob58im/items/23df9e22778b33986d1c/likers" class="css-1iupg5d">3</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">2</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/23df9e22778b33986d1c/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/kob58im/items/23df9e22778b33986d1c/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/kob58im/items/23df9e22778b33986d1c/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/kob58im/items/23df9e22778b33986d1c/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/kob58im/items/23df9e22778b33986d1c.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-1nzh4zz"><span class="fa fa-fw fa-warning css-38fzdi"></span><p>More than 1 year has passed since last update.</p></div><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/kob58im"><img class="css-100alwu eyfquo10" src="https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/438183/2a98273b33a1aaed7a0715e06359994fe6d0636b/x_large.png?1575159318" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/kob58im" class="css-10ougpm">@<!-- -->kob58im</a><div class="css-1ay9vb9"><span><meta content="2020-08-22T00:55:52Z"/><time dateTime="2020-08-22T06:59:41Z" class="css-m19uds">updated at 2020-08-22</time></span></div></div></div></div></div><h1 class="css-cgzq40">巷にあふれているSendInput(Windows API)の座標変換のソースコードに物申す</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/windows" class="css-4czcte">Windows</a><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/%e6%95%b0%e5%ad%a6" class="css-4czcte">数学</a><a href="/tags/win32api" class="css-4czcte">Win32API</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div>
<h1>
<span id="0-注記" class="fragment"></span><a href="#0-%E6%B3%A8%E8%A8%98"><i class="fa fa-link"></i></a>0. 注記</h1>

<p>WindowsAPIのソースコードは調べられなかったので、実験ベースでの検証になります。<br>
コード例はC#です。</p>

<p>「コードはよ」というかたは、<a href="https://qiita.com/kob58im/items/23df9e22778b33986d1c#44-%E7%B5%90%E8%AB%96%E6%AD%A3%E7%A2%BA%E3%81%AB%E5%A4%89%E6%8F%9B%E3%81%A7%E3%81%8D%E3%82%8B%E3%81%A7%E3%81%82%E3%82%8D%E3%81%86%E3%82%B3%E3%83%BC%E3%83%89">最後の章へ</a>。<br>
<b>マルチモニタでの挙動は未検証です。</b></p>

<h1>
<span id="1-絶対座標指定でのsendinputを使ったマウスカーソルの移動" class="fragment"></span><a href="#1-%E7%B5%B6%E5%AF%BE%E5%BA%A7%E6%A8%99%E6%8C%87%E5%AE%9A%E3%81%A7%E3%81%AEsendinput%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%9F%E3%83%9E%E3%82%A6%E3%82%B9%E3%82%AB%E3%83%BC%E3%82%BD%E3%83%AB%E3%81%AE%E7%A7%BB%E5%8B%95"><i class="fa fa-link"></i></a>1. 絶対座標指定での<code>SendInput</code>を使ったマウスカーソルの移動</h1>

<p>現在のマウスカーソル位置とは関係なくデスクトップ上の指定の座標にマウスカーソルを移動させたいとき、<code>MOUSEEVENTF_ABSOLUTE</code>を指定して<code>SendInput</code>(Windows API)を使ってマウスを制御します。<br>
※移動させるだけなら <code>Cursor.Position</code> に座標を設定してもやれるようです。マウスボタン操作を合わせてやりたい場合は<code>SendInput</code>を使うことになるかと思います。</p>

<p>巷（ちまた）には下記のような変換をしているコードがあふれていますが、これらを使うと、丸め誤差により、もともとの意図した座標(x, y)からずれます。<br>
（例2や例3は、ズレは1ピクセルとかになると思うので通常は気にならないレベルですが、シーンによっては問題になり得ます。）</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">NG例1</span></div>
<div class="highlight"><pre class="with-code"><code>
<span class="n">absX</span> <span class="p">=</span> <span class="n">x</span> <span class="p">*</span> <span class="p">(</span><span class="m">65535</span> <span class="p">/</span> <span class="n">Screen</span><span class="p">.</span><span class="n">PrimaryScreen</span><span class="p">.</span><span class="n">Bounds</span><span class="p">.</span><span class="n">Width</span><span class="p">);</span>
<span class="n">absY</span> <span class="p">=</span> <span class="n">y</span> <span class="p">*</span> <span class="p">(</span><span class="m">65535</span> <span class="p">/</span> <span class="n">Screen</span><span class="p">.</span><span class="n">PrimaryScreen</span><span class="p">.</span><span class="n">Bounds</span><span class="p">.</span><span class="n">Height</span><span class="p">);</span>
</code></pre></div>
</div>

<p>NG例1については、C言語やC#等は<code>/</code>が整数除算になるので、係数<code>(65535 / Screen.PrimaryScreen.Bounds.Width)</code> を計算した時点で、モニタのWidth,Heightに依存した誤差をもってしまいます。<sup id="fnref1"><a href="#fn1" title="プライマリモニタのWidthが1920だとすると、係数は34.1328125が丸められて34になります。xが1919のとき、実数上の除算だとabsXは65,500.8671875ですが、係数は34に丸められておりabsXは65,246となります。その差は-254.8671875となり、65535に対して約0.4%の誤差であることが分かります。この0.4%(=0.004)とWidth-1(=1919)を乗算すると、7～8ピクセルほどのズレになります。">1</a></sup></p>

<p>勘の良い方なら、NG例2を使うでしょう。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">NG例2</span></div>
<div class="highlight"><pre class="with-code"><code>
<span class="n">absX</span> <span class="p">=</span> <span class="p">(</span><span class="n">x</span> <span class="p">*</span> <span class="m">65535</span><span class="p">)</span> <span class="p">/</span> <span class="n">Screen</span><span class="p">.</span><span class="n">PrimaryScreen</span><span class="p">.</span><span class="n">Bounds</span><span class="p">.</span><span class="n">Width</span><span class="p">;</span>
<span class="n">absY</span> <span class="p">=</span> <span class="p">(</span><span class="n">y</span> <span class="p">*</span> <span class="m">65535</span><span class="p">)</span> <span class="p">/</span> <span class="n">Screen</span><span class="p">.</span><span class="n">PrimaryScreen</span><span class="p">.</span><span class="n">Bounds</span><span class="p">.</span><span class="n">Height</span><span class="p">;</span>
</code></pre></div>
</div>

<p>もしくは、分子が(65536から)1引いているのだから、分母も同じく1を引いて、下記を使う方もいると思います。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">NG例3</span></div>
<div class="highlight"><pre class="with-code"><code>
<span class="n">absX</span> <span class="p">=</span> <span class="p">(</span><span class="n">x</span> <span class="p">*</span> <span class="m">65535</span><span class="p">)</span> <span class="p">/</span> <span class="p">(</span><span class="n">Screen</span><span class="p">.</span><span class="n">PrimaryScreen</span><span class="p">.</span><span class="n">Bounds</span><span class="p">.</span><span class="n">Width</span> <span class="p">-</span> <span class="m">1</span><span class="p">);</span>
<span class="n">absY</span> <span class="p">=</span> <span class="p">(</span><span class="n">y</span> <span class="p">*</span> <span class="m">65535</span><span class="p">)</span> <span class="p">/</span> <span class="p">(</span><span class="n">Screen</span><span class="p">.</span><span class="n">PrimaryScreen</span><span class="p">.</span><span class="n">Bounds</span><span class="p">.</span><span class="n">Height</span> <span class="p">-</span> <span class="m">1</span><span class="p">);</span>
</code></pre></div>
</div>

<h1>
<span id="2-公式サイトのsendinputの仕様記載がそもそもイケてない" class="fragment"></span><a href="#2-%E5%85%AC%E5%BC%8F%E3%82%B5%E3%82%A4%E3%83%88%E3%81%AEsendinput%E3%81%AE%E4%BB%95%E6%A7%98%E8%A8%98%E8%BC%89%E3%81%8C%E3%81%9D%E3%82%82%E3%81%9D%E3%82%82%E3%82%A4%E3%82%B1%E3%81%A6%E3%81%AA%E3%81%84"><i class="fa fa-link"></i></a>2. 公式サイトの<code>SendInput</code>の仕様記載がそもそもイケてない</h1>

<p>NG例2やNG例3をみて、「いやいや、<a href="https://docs.microsoft.com/en-us/windows/win32/api/winuser/ns-winuser-mouseinput" rel="nofollow noopener" target="_blank">Microsoftの公式サイト</a>に書いてあるし、あってるでしょ？」と思う方もおられるかと思います。（自分もそう思ってました。）</p>

<p><a href="https://docs.microsoft.com/en-us/windows/win32/api/winuser/ns-winuser-mouseinput" rel="nofollow noopener" target="_blank">公式サイト</a>の記載を抜粋します。</p>

<blockquote>
<p>If MOUSEEVENTF_ABSOLUTE value is specified,<br>
 dx and dy contain normalized absolute coordinates between 0 and 65,535.<br>
 The event procedure maps these coordinates onto the display surface.<br>
 Coordinate (0,0) maps onto the upper-left corner of the display surface;<br>
 coordinate <b>(65535,65535) maps onto the lower-right corner</b>.<br>
 In a multimonitor system, the coordinates map to the <b>primary monitor</b>.</p>
</blockquote>

<p>これを見ると、あたかも<b>(65535,65535)</b>とプライマリモニタの<b>(Width,Height)</b>もしくは<b>(Width-1,Height-1)</b>が対応しているように見えます。</p>

<p>ですが、実際にNG例2やNG例3のコードでやってみるとずれます。<br>
ずれるケースの実験は本記事では省略しますが、<b><a href="https://qiita.com/kob58im/items/a360b22fd7b2b257e890" id="reference-d77f528afcb9a818347c">この記事</a></b>のコードを使えば確認できます。</p>

<h1>
<span id="3-指定した座標と実際の移動後の座標の関係を調べてみた" class="fragment"></span><a href="#3-%E6%8C%87%E5%AE%9A%E3%81%97%E3%81%9F%E5%BA%A7%E6%A8%99%E3%81%A8%E5%AE%9F%E9%9A%9B%E3%81%AE%E7%A7%BB%E5%8B%95%E5%BE%8C%E3%81%AE%E5%BA%A7%E6%A8%99%E3%81%AE%E9%96%A2%E4%BF%82%E3%82%92%E8%AA%BF%E3%81%B9%E3%81%A6%E3%81%BF%E3%81%9F"><i class="fa fa-link"></i></a>3. 指定した座標　と　実際の移動後の座標　の関係を調べてみた</h1>

<p>3章では、指定した座標に対し<code>SendInput</code>実行後のマウスカーソル座標がどこになるのかを調べます。<br>
この章で、<code>SendInput</code>の世界の座標系(0,0)-(65535(?),65535(?))  から  ピクセル単位の座標系を取得する式を得ます。</p>

<p>最終的に得たいのは、これと逆方向の変換です。それについては4章で扱います。</p>

<h2>
<span id="31-結論" class="fragment"></span><a href="#31-%E7%B5%90%E8%AB%96"><i class="fa fa-link"></i></a>3.1. 結論</h2>

<p>実験により検証したところ、(0,0)-(6553<b>6</b>,6553<b>6</b>)とプライマリモニタの(0,0)-(Width,Height)が対応関係にあります。丸め方向は切り捨てです。<br>
つまり、<code>SendInput</code> APIは、内部で <code>Cursor.Position.X = (absX * Width) / 65536;</code> に相当する計算（整数除算）をしているようです。</p>

<h2>
<span id="32-それっぽいエビデンス" class="fragment"></span><a href="#32-%E3%81%9D%E3%82%8C%E3%81%A3%E3%81%BD%E3%81%84%E3%82%A8%E3%83%93%E3%83%87%E3%83%B3%E3%82%B9"><i class="fa fa-link"></i></a>3.2. それっぽいエビデンス</h2>

<p>AbsXが、<code>SendInput</code>に指定した x の値。<br>
ResultXが、.Netの<code>Cursor.Position</code>プロパティで取得した実際のマウスカーソル座標です。</p>

<p><a href="https://camo.qiitausercontent.com/7216dc08858aba645851cfcf7ae7e66199232bc6/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3433383138332f65336661643563622d303335322d393637302d626466372d3333613537333131363965342e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F438183%2Fe3fad5cb-0352-9670-bdf7-33a5731169e4.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=e1bd65f44c5dfaba15254c1cd2439975" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/438183/e3fad5cb-0352-9670-bdf7-33a5731169e4.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F438183%2Fe3fad5cb-0352-9670-bdf7-33a5731169e4.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=8d010f5133726d6525961b1f8a9710f9 1x" loading="lazy"></a></p>

<p>（行挿入等の操作をしてしまったので数式のセル参照がメモとずれてます）</p>

<h2>
<span id="33-実験に使用したソースコード" class="fragment"></span><a href="#33-%E5%AE%9F%E9%A8%93%E3%81%AB%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%9F%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>3.3. 実験に使用したソースコード</h2>

<p>高解像度による座標系変換の影響を受けると問題がややこしくなるので、<code>SetProcessDPIAware</code> (Windows API)で高解像度対応させています。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">SendInputMousePosTest.cs</span></div>
<div class="highlight"><pre class="with-code"><code>
<span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Drawing</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.IO</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Runtime.InteropServices</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Threading</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Threading.Tasks</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Windows.Forms</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MainForm</span> <span class="p">:</span> <span class="n">Form</span>
<span class="p">{</span>
    <span class="k">readonly</span> <span class="kt">int</span> <span class="n">sweepStep</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span> <span class="c1">//  SendInputに送信するx座標ベース</span>

    <span class="kt">bool</span> <span class="n">abortFlag</span><span class="p">;</span>

     <span class="c1">// SendInputに送信する終端x,y座標。コマンドライン引数経由で設定。</span>
     <span class="c1">// (memo: コマンドライン引数はintで受けておき、sweep中のfor文でのoverflow防止のためlongでもっている。)</span>
    <span class="kt">long</span> <span class="n">_lastAbsX</span><span class="p">;</span>
    <span class="kt">long</span> <span class="n">_lastAbsY</span><span class="p">;</span>

    <span class="kt">string</span> <span class="n">_directionOption</span><span class="p">;</span> <span class="c1">// "d": ななめ(Diagonal)(x,yを同時にsweep)   それ以外: 水平と垂直</span>

    <span class="nf">MainForm</span><span class="p">(</span><span class="kt">int</span> <span class="n">lastAbsX</span><span class="p">,</span> <span class="kt">int</span> <span class="n">lastAbsY</span><span class="p">,</span> <span class="kt">string</span> <span class="n">directionOption</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">abortFlag</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
        <span class="n">_directionOption</span> <span class="p">=</span> <span class="n">directionOption</span><span class="p">;</span>
        <span class="n">_lastAbsX</span> <span class="p">=</span> <span class="n">lastAbsX</span><span class="p">;</span>
        <span class="n">_lastAbsY</span> <span class="p">=</span> <span class="n">lastAbsY</span><span class="p">;</span>

        <span class="n">ClientSize</span> <span class="p">=</span> <span class="k">new</span> <span class="n">System</span><span class="p">.</span><span class="n">Drawing</span><span class="p">.</span><span class="nf">Size</span><span class="p">(</span><span class="m">300</span><span class="p">,</span><span class="m">100</span><span class="p">);</span>
        <span class="n">Load</span> <span class="p">+=</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">e</span><span class="p">)=&gt;{</span><span class="nf">SendMouseMove</span><span class="p">();};</span>
        <span class="n">FormClosing</span> <span class="p">+=</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">e</span><span class="p">)=&gt;{</span><span class="n">abortFlag</span><span class="p">=</span><span class="k">true</span><span class="p">;};</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">NativeMethods</span>
    <span class="p">{</span>
        <span class="p">[</span><span class="nf">DllImport</span><span class="p">(</span><span class="s">"user32.dll"</span><span class="p">,</span> <span class="n">SetLastError</span> <span class="p">=</span> <span class="k">true</span><span class="p">)]</span>
        <span class="k">public</span> <span class="k">extern</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">SendInput</span><span class="p">(</span><span class="kt">int</span> <span class="n">nInputs</span><span class="p">,</span> <span class="n">Input</span><span class="p">[]</span> <span class="n">pInputs</span><span class="p">,</span> <span class="kt">int</span> <span class="n">cbsize</span><span class="p">);</span>

        <span class="p">[</span><span class="nf">DllImport</span><span class="p">(</span><span class="s">"user32.dll"</span><span class="p">,</span> <span class="n">SetLastError</span> <span class="p">=</span> <span class="k">true</span><span class="p">)]</span>
        <span class="k">public</span> <span class="k">extern</span> <span class="k">static</span> <span class="n">IntPtr</span> <span class="nf">GetMessageExtraInfo</span><span class="p">();</span>

        <span class="p">[</span><span class="nf">DllImport</span><span class="p">(</span> <span class="s">"user32.dll"</span> <span class="p">)]</span>
        <span class="k">public</span> <span class="k">static</span> <span class="k">extern</span> <span class="kt">bool</span> <span class="nf">SetProcessDPIAware</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="p">[</span><span class="nf">StructLayout</span><span class="p">(</span><span class="n">LayoutKind</span><span class="p">.</span><span class="n">Sequential</span><span class="p">)]</span>
    <span class="k">private</span> <span class="k">struct</span> <span class="nc">POINT</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">x</span><span class="p">;</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">y</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="p">[</span><span class="nf">StructLayout</span><span class="p">(</span><span class="n">LayoutKind</span><span class="p">.</span><span class="n">Sequential</span><span class="p">)]</span>
    <span class="k">struct</span> <span class="nc">MouseInput</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">X</span><span class="p">;</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">Y</span><span class="p">;</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">Data</span><span class="p">;</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">Flags</span><span class="p">;</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">Time</span><span class="p">;</span>
        <span class="k">public</span> <span class="n">IntPtr</span> <span class="n">ExtraInfo</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="p">[</span><span class="nf">StructLayout</span><span class="p">(</span><span class="n">LayoutKind</span><span class="p">.</span><span class="n">Sequential</span><span class="p">)]</span>
    <span class="k">struct</span> <span class="nc">KeyboardInput</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">short</span> <span class="n">VirtualKey</span><span class="p">;</span>
        <span class="k">public</span> <span class="kt">short</span> <span class="n">ScanCode</span><span class="p">;</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">Flags</span><span class="p">;</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">Time</span><span class="p">;</span>
        <span class="k">public</span> <span class="n">IntPtr</span> <span class="n">ExtraInfo</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="p">[</span><span class="nf">StructLayout</span><span class="p">(</span><span class="n">LayoutKind</span><span class="p">.</span><span class="n">Sequential</span><span class="p">)]</span>
    <span class="k">struct</span> <span class="nc">HardwareInput</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">uMsg</span><span class="p">;</span>
        <span class="k">public</span> <span class="kt">short</span> <span class="n">wParamL</span><span class="p">;</span>
        <span class="k">public</span> <span class="kt">short</span> <span class="n">wParamH</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="p">[</span><span class="nf">StructLayout</span><span class="p">(</span><span class="n">LayoutKind</span><span class="p">.</span><span class="n">Sequential</span><span class="p">)]</span>
    <span class="k">struct</span> <span class="nc">Input</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">Type</span><span class="p">;</span>
        <span class="k">public</span> <span class="n">InputUnion</span> <span class="n">ui</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="p">[</span><span class="nf">StructLayout</span><span class="p">(</span><span class="n">LayoutKind</span><span class="p">.</span><span class="n">Explicit</span><span class="p">)]</span>
    <span class="k">struct</span> <span class="nc">InputUnion</span>
    <span class="p">{</span>
        <span class="p">[</span><span class="nf">FieldOffset</span><span class="p">(</span><span class="m">0</span><span class="p">)]</span>
        <span class="k">public</span> <span class="n">MouseInput</span> <span class="n">Mouse</span><span class="p">;</span>
        <span class="p">[</span><span class="nf">FieldOffset</span><span class="p">(</span><span class="m">0</span><span class="p">)]</span>
        <span class="k">public</span> <span class="n">KeyboardInput</span> <span class="n">Keyboard</span><span class="p">;</span>
        <span class="p">[</span><span class="nf">FieldOffset</span><span class="p">(</span><span class="m">0</span><span class="p">)]</span>
        <span class="k">public</span> <span class="n">HardwareInput</span> <span class="n">Hardware</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">MOUSEEVENTF_MOVE</span>        <span class="p">=</span> <span class="m">0x0001</span><span class="p">;</span>
    <span class="k">private</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">MOUSEEVENTF_ABSOLUTE</span>    <span class="p">=</span> <span class="m">0x8000</span><span class="p">;</span>

    <span class="k">void</span> <span class="nf">SendMouseMove</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nf">BeginInvoke</span><span class="p">(</span>
            <span class="p">(</span><span class="n">MethodInvoker</span><span class="p">)</span><span class="k">delegate</span><span class="p">(){</span>
                <span class="k">checked</span><span class="p">{</span>
                    <span class="kt">var</span> <span class="n">scrs</span> <span class="p">=</span> <span class="n">Screen</span><span class="p">.</span><span class="n">AllScreens</span><span class="p">;</span>
                    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">=</span><span class="m">0</span><span class="p">;</span><span class="n">i</span><span class="p">&lt;</span><span class="n">scrs</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span><span class="n">i</span><span class="p">++)</span> <span class="p">{</span>
                        <span class="k">if</span><span class="p">(</span><span class="n">abortFlag</span><span class="p">){</span><span class="k">return</span><span class="p">;}</span>

                        <span class="n">Console</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="s">"Size of screen["</span><span class="p">);</span>
                        <span class="n">Console</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
                        <span class="n">Console</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="s">"]\t"</span><span class="p">);</span>
                        <span class="n">Console</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="n">scrs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Bounds</span><span class="p">.</span><span class="n">Width</span><span class="p">);</span>
                        <span class="n">Console</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="s">"\t"</span><span class="p">);</span>
                        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">scrs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Bounds</span><span class="p">.</span><span class="n">Height</span><span class="p">);</span>

                        <span class="n">Console</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="s">"Location of screen["</span><span class="p">);</span>
                        <span class="n">Console</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
                        <span class="n">Console</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="s">"]\t"</span><span class="p">);</span>
                        <span class="n">Console</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="n">scrs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Bounds</span><span class="p">.</span><span class="n">Left</span><span class="p">);</span>
                        <span class="n">Console</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="s">"\t"</span><span class="p">);</span>
                        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">scrs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Bounds</span><span class="p">.</span><span class="n">Top</span><span class="p">);</span>
                    <span class="p">}</span>

                    <span class="k">if</span> <span class="p">(</span> <span class="n">_directionOption</span> <span class="p">==</span> <span class="s">"d"</span> <span class="p">)</span> <span class="p">{</span>
                        <span class="c1">// 左上(0,0)から右下(_lastAbsX,_lastAbsY)まで斜めに移動させてx,yを同時に動かして座標を出力させる。</span>
                        <span class="k">for</span> <span class="p">(</span> <span class="kt">long</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span> <span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">_lastAbsX</span> <span class="p">+</span> <span class="n">sweepStep</span> <span class="p">;</span> <span class="n">i</span> <span class="p">+=</span> <span class="n">sweepStep</span> <span class="p">)</span> <span class="p">{</span>
                            <span class="k">if</span><span class="p">(</span><span class="n">abortFlag</span><span class="p">){</span><span class="k">return</span><span class="p">;}</span>
                            <span class="kt">long</span> <span class="n">x</span> <span class="p">=</span> <span class="n">i</span><span class="p">;</span>
                            <span class="k">if</span> <span class="p">(</span> <span class="n">x</span> <span class="p">&gt;</span> <span class="n">_lastAbsX</span> <span class="p">){</span><span class="n">x</span> <span class="p">=</span> <span class="n">_lastAbsX</span><span class="p">;}</span>
                            <span class="kt">long</span> <span class="n">y</span> <span class="p">=</span> <span class="p">(</span><span class="n">x</span> <span class="p">*</span> <span class="n">_lastAbsY</span><span class="p">)</span> <span class="p">/</span> <span class="n">_lastAbsX</span><span class="p">;</span>

                            <span class="nf">SendInputMouseMoveAndDumpPoint</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">y</span><span class="p">);</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                    <span class="k">else</span> <span class="p">{</span>
                        <span class="c1">// 左上(0,0)から(_lastAbsX,0)まで直線状に移動させてx,yを出力させる。</span>
                        <span class="k">for</span> <span class="p">(</span> <span class="kt">long</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span> <span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">_lastAbsX</span> <span class="p">+</span> <span class="n">sweepStep</span> <span class="p">;</span> <span class="n">i</span> <span class="p">+=</span> <span class="n">sweepStep</span> <span class="p">)</span> <span class="p">{</span>
                            <span class="k">if</span><span class="p">(</span><span class="n">abortFlag</span><span class="p">){</span><span class="k">return</span><span class="p">;}</span>
                            <span class="kt">long</span> <span class="n">x</span> <span class="p">=</span> <span class="n">i</span><span class="p">;</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="p">&gt;</span> <span class="n">_lastAbsX</span><span class="p">)</span> <span class="p">{</span><span class="n">x</span> <span class="p">=</span> <span class="n">_lastAbsX</span><span class="p">;}</span>

                            <span class="nf">SendInputMouseMoveAndDumpPoint</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">x</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
                        <span class="p">}</span>

                        <span class="c1">// 左上(0,0)から(0,_lastAbsY)まで直線状に移動させてx,yを出力させる。</span>
                        <span class="k">for</span> <span class="p">(</span> <span class="kt">long</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span> <span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">_lastAbsY</span> <span class="p">+</span> <span class="n">sweepStep</span> <span class="p">;</span> <span class="n">i</span> <span class="p">+=</span> <span class="n">sweepStep</span> <span class="p">)</span> <span class="p">{</span>
                            <span class="k">if</span><span class="p">(</span><span class="n">abortFlag</span><span class="p">){</span><span class="k">return</span><span class="p">;}</span>
                            <span class="kt">long</span> <span class="n">y</span> <span class="p">=</span> <span class="n">i</span><span class="p">;</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">y</span> <span class="p">&gt;</span> <span class="n">_lastAbsY</span><span class="p">)</span> <span class="p">{</span><span class="n">y</span> <span class="p">=</span> <span class="n">_lastAbsY</span><span class="p">;}</span>

                            <span class="nf">SendInputMouseMoveAndDumpPoint</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">y</span><span class="p">);</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
                <span class="n">MessageBox</span><span class="p">.</span><span class="nf">Show</span><span class="p">(</span><span class="s">"Completed."</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="k">static</span> <span class="k">void</span> <span class="nf">SendInputMouseMoveAndDumpPoint</span><span class="p">(</span><span class="kt">int</span> <span class="n">absX</span><span class="p">,</span> <span class="kt">int</span> <span class="n">absY</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nf">SendInputMouseMove</span><span class="p">(</span><span class="n">absX</span><span class="p">,</span> <span class="n">absY</span><span class="p">);</span>
        <span class="nf">DumpPoint</span><span class="p">(</span><span class="n">absX</span><span class="p">,</span> <span class="n">absY</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">static</span> <span class="k">void</span> <span class="nf">DumpPoint</span><span class="p">(</span><span class="kt">int</span> <span class="n">orgAbsX</span><span class="p">,</span> <span class="kt">int</span> <span class="n">orgAbsY</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Point</span> <span class="n">p</span> <span class="p">=</span> <span class="n">Cursor</span><span class="p">.</span><span class="n">Position</span><span class="p">;</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="n">orgAbsX</span><span class="p">);</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="s">"\t"</span><span class="p">);</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="n">orgAbsY</span><span class="p">);</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="s">"\t"</span><span class="p">);</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">X</span><span class="p">);</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="s">"\t"</span><span class="p">);</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">Y</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">SendInputMouseMove</span><span class="p">(</span><span class="kt">int</span> <span class="n">absX</span><span class="p">,</span> <span class="kt">int</span> <span class="n">absY</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">mv</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Input</span><span class="p">();</span>
        <span class="n">mv</span><span class="p">.</span><span class="n">Type</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="c1">// MOUSE = 0</span>
        <span class="n">mv</span><span class="p">.</span><span class="n">ui</span><span class="p">.</span><span class="n">Mouse</span><span class="p">.</span><span class="n">X</span> <span class="p">=</span> <span class="n">absX</span><span class="p">;</span>
        <span class="n">mv</span><span class="p">.</span><span class="n">ui</span><span class="p">.</span><span class="n">Mouse</span><span class="p">.</span><span class="n">Y</span> <span class="p">=</span> <span class="n">absY</span><span class="p">;</span>
        <span class="n">mv</span><span class="p">.</span><span class="n">ui</span><span class="p">.</span><span class="n">Mouse</span><span class="p">.</span><span class="n">Data</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
        <span class="n">mv</span><span class="p">.</span><span class="n">ui</span><span class="p">.</span><span class="n">Mouse</span><span class="p">.</span><span class="n">Flags</span> <span class="p">=</span> <span class="n">MOUSEEVENTF_ABSOLUTE</span> <span class="p">|</span> <span class="n">MOUSEEVENTF_MOVE</span><span class="p">;</span>
        <span class="n">mv</span><span class="p">.</span><span class="n">ui</span><span class="p">.</span><span class="n">Mouse</span><span class="p">.</span><span class="n">Time</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
        <span class="n">mv</span><span class="p">.</span><span class="n">ui</span><span class="p">.</span><span class="n">Mouse</span><span class="p">.</span><span class="n">ExtraInfo</span> <span class="p">=</span> <span class="n">IntPtr</span><span class="p">.</span><span class="n">Zero</span><span class="p">;</span>

        <span class="n">Input</span><span class="p">[]</span> <span class="n">inputs</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Input</span><span class="p">[]{</span><span class="n">mv</span><span class="p">};</span>
        <span class="n">NativeMethods</span><span class="p">.</span><span class="nf">SendInput</span><span class="p">(</span><span class="n">inputs</span><span class="p">.</span><span class="n">Length</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">Marshal</span><span class="p">.</span><span class="nf">SizeOf</span><span class="p">(</span><span class="n">inputs</span><span class="p">[</span><span class="m">0</span><span class="p">]));</span>
    <span class="p">}</span>


    <span class="p">[</span><span class="n">STAThread</span><span class="p">]</span>
    <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">NativeMethods</span><span class="p">.</span><span class="nf">SetProcessDPIAware</span><span class="p">();</span> <span class="c1">// 高解像度のスケーリング座標に対応するため</span>

        <span class="kt">int</span> <span class="n">lastAbsX</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">lastAbsY</span><span class="p">;</span>
        <span class="kt">string</span> <span class="n">directionOption</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span> <span class="n">args</span><span class="p">.</span><span class="n">Length</span><span class="p">==</span><span class="m">0</span> <span class="p">)</span> <span class="p">{</span>
            <span class="n">lastAbsX</span> <span class="p">=</span> <span class="m">65535</span><span class="p">;</span>
            <span class="n">lastAbsY</span> <span class="p">=</span> <span class="m">65535</span><span class="p">;</span>
            <span class="n">directionOption</span> <span class="p">=</span> <span class="s">"d"</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="n">args</span><span class="p">.</span><span class="n">Length</span><span class="p">==</span><span class="m">3</span> <span class="p">)</span> <span class="p">{</span>
            <span class="k">try</span><span class="p">{</span>
                <span class="n">lastAbsX</span> <span class="p">=</span> <span class="n">Convert</span><span class="p">.</span><span class="nf">ToInt32</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="m">0</span><span class="p">]);</span>
                <span class="n">lastAbsY</span> <span class="p">=</span> <span class="n">Convert</span><span class="p">.</span><span class="nf">ToInt32</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="m">1</span><span class="p">]);</span>
            <span class="p">}</span>
            <span class="k">catch</span><span class="p">(</span><span class="n">FormatException</span><span class="p">){</span>
                <span class="k">return</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">catch</span><span class="p">(</span><span class="n">OverflowException</span><span class="p">){</span>
                <span class="k">return</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">if</span><span class="p">(</span><span class="n">lastAbsX</span><span class="p">&lt;</span><span class="m">0</span><span class="p">){</span><span class="k">return</span><span class="p">;}</span>
            <span class="k">if</span><span class="p">(</span><span class="n">lastAbsY</span><span class="p">&lt;</span><span class="m">0</span><span class="p">){</span><span class="k">return</span><span class="p">;}</span>

            <span class="n">directionOption</span> <span class="p">=</span> <span class="n">args</span><span class="p">[</span><span class="m">2</span><span class="p">];</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">Application</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="k">new</span> <span class="nf">MainForm</span><span class="p">(</span><span class="n">lastAbsX</span><span class="p">,</span><span class="n">lastAbsY</span><span class="p">,</span><span class="n">directionOption</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<h1>
<span id="4-じゃあどうすればよいの" class="fragment"></span><a href="#4-%E3%81%98%E3%82%83%E3%81%82%E3%81%A9%E3%81%86%E3%81%99%E3%82%8C%E3%81%B0%E3%82%88%E3%81%84%E3%81%AE"><i class="fa fa-link"></i></a>4. じゃあどうすればよいの？</h1>

<p>3章で得られた関係性 <code>Cursor.Position.X = (absX * Width) / 65536;</code>の<br>
逆計算をすることでマウスカーソルの座標系から0～65536の座標系に変換する。<br>
というアプローチで行きます。</p>

<h2>
<span id="41-床関数" class="fragment"></span><a href="#41-%E5%BA%8A%E9%96%A2%E6%95%B0"><i class="fa fa-link"></i></a>4.1. 床関数</h2>

<p>整数除算の際の丸め処理<sup id="fnref2"><a href="#fn2" title="ここでは負の数はとりあえず考えないようにします。">2</a></sup>は、大雑把にいうと、小数点以下を切り捨てているのと同じなので、床関数と同じと考えることができます。</p>

<p>床関数のグラフの描くとこんな感じになります。（白抜きの〇は、含まない。）<br>
<a href="https://camo.qiitausercontent.com/df4604b077293d4f091bfc17cb3f9da240ded3cd/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3433383138332f35353662363665312d383633612d313263382d313435372d6336373431373635346134362e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F438183%2F556b66e1-863a-12c8-1457-c67417654a46.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=d9db34e2f0df270bd54130e5e6530c81" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/438183/556b66e1-863a-12c8-1457-c67417654a46.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F438183%2F556b66e1-863a-12c8-1457-c67417654a46.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=9633c3d762d63777deb697a01e1bd50e 1x" loading="lazy"></a></p>

<h2>
<span id="42-逆計算のイメージ" class="fragment"></span><a href="#42-%E9%80%86%E8%A8%88%E7%AE%97%E3%81%AE%E3%82%A4%E3%83%A1%E3%83%BC%E3%82%B8"><i class="fa fa-link"></i></a>4.2. 逆計算のイメージ</h2>

<p>モニタのWidth, Heightが65536以下である仮定のもと、実際の例 Width = 1920 のときの逆計算のイメージをグラフで描くと下図のようになります。<br>
<a href="https://camo.qiitausercontent.com/192e0a96c41b59ffab48b9384a1bb93aed0d9e45/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3433383138332f31376164353937342d616365332d616165622d653637662d3963393131643031653130362e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F438183%2F17ad5974-ace3-aaeb-e67f-9c911d01e106.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=2ef153de47220b45bd66e8c69764b627" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/438183/17ad5974-ace3-aaeb-e67f-9c911d01e106.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F438183%2F17ad5974-ace3-aaeb-e67f-9c911d01e106.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=cef376e413e08eb86adcc6c5787a005f 1x" loading="lazy"></a></p>

<p>カーソル位置x=1に動かしたい場合は、35～68の範囲に収まる値を<code>SendInput</code>のabsXに設定してやる必要があります。<sup id="fnref3"><a href="#fn3" title="公式のAPIの説明上の名称はabsXではなくdxです。dxだと微分やDifferenceの略のイメージから「差分」を連想するので、記事中では絶対座標をイメージしやすいようにabsXとしています。">3</a></sup><br>
なので、グラフ上の各線分●ー○よりも内側を貫く直線で逆計算の式を構築する必要があります。（語彙力・・・）<br>
ちょっと雑ですが、下図のイメージです。</p>

<p><a href="https://camo.qiitausercontent.com/0307295a4a3358b9e7271bad80b5571a83038582/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3433383138332f65633734356564322d346332312d626433662d623932382d6462393461663031626137372e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F438183%2Fec745ed2-4c21-bd3f-b928-db94af01ba77.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=e120dc3a6be3155db27d09b5465c05a0" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/438183/ec745ed2-4c21-bd3f-b928-db94af01ba77.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F438183%2Fec745ed2-4c21-bd3f-b928-db94af01ba77.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=ae84687e2ca3675902cddf783793732a 1x" loading="lazy"></a></p>

<h2>
<span id="43-逆計算の式" class="fragment"></span><a href="#43-%E9%80%86%E8%A8%88%E7%AE%97%E3%81%AE%E5%BC%8F"><i class="fa fa-link"></i></a>4.3. 逆計算の式</h2>

<p>話がとびますが、直感に頼って式の案を出すと、天井関数を使って</p>

<p>absX = ceiling((Cursor.Position.X * 65536) ÷ Width) </p>

<p>として計算すればイケそう（4.2.章の内容を満たせそう）な気がします（超乱暴）。（ここでの<code>÷</code>は実数での除算を表しているとします。）<br>
Excelで検算をしたところ、Width=1920, Height=1080の環境では誤差がでないようです。</p>

<p>イメージこんな感じ。<br>
</p><p class="codepen" data-height="600" data-default-tab="result" data-slug-hash="vYGyQwe"><br>
  See the Pen <a href="https://codepen.io/kob58im/pen/vYGyQwe" rel="nofollow noopener" target="_blank"><br>
  Conversion graph of SendInput</a> by kob58im (<a href="https://codepen.io/kob58im" rel="nofollow noopener" target="_blank">@kob58im</a>)<br>
  on <a href="https://codepen.io" rel="nofollow noopener" target="_blank">CodePen</a>.<br>
</p><br>
<script async src="https://static.codepen.io/assets/embed/ei.js"></script>

<h2>
<span id="44-結論正確に変換できるであろうコード" class="fragment"></span><a href="#44-%E7%B5%90%E8%AB%96%E6%AD%A3%E7%A2%BA%E3%81%AB%E5%A4%89%E6%8F%9B%E3%81%A7%E3%81%8D%E3%82%8B%E3%81%A7%E3%81%82%E3%82%8D%E3%81%86%E3%82%B3%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>4.4. 結論（正確に変換できるであろうコード）</h2>

<p>4.3章の変換式をソースコード(C#)にすると、下記のようになります。<br>
<s>下記の「正確に変換できるであろうコード」は、最終的に4.3章にて<b>直感</b>で出しており、4.2章で言及した変換ができているかどうか数学的な証明もしていないので、参考扱いとしてください。</s></p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">正確に変換できるであろうコード</span></div>
<div class="highlight"><pre class="with-code"><code>
<span class="n">absX</span> <span class="p">=</span> <span class="p">(</span><span class="n">x</span> <span class="p">*</span> <span class="m">65536</span> <span class="p">+</span> <span class="n">Screen</span><span class="p">.</span><span class="n">PrimaryScreen</span><span class="p">.</span><span class="n">Bounds</span><span class="p">.</span><span class="n">Width</span> <span class="p">-</span><span class="m">1</span><span class="p">)</span> <span class="p">/</span> <span class="n">Screen</span><span class="p">.</span><span class="n">PrimaryScreen</span><span class="p">.</span><span class="n">Bounds</span><span class="p">.</span><span class="n">Width</span><span class="p">;</span>
<span class="n">absY</span> <span class="p">=</span> <span class="p">(</span><span class="n">y</span> <span class="p">*</span> <span class="m">65536</span> <span class="p">+</span> <span class="n">Screen</span><span class="p">.</span><span class="n">PrimaryScreen</span><span class="p">.</span><span class="n">Bounds</span><span class="p">.</span><span class="n">Height</span><span class="p">-</span><span class="m">1</span><span class="p">)</span> <span class="p">/</span> <span class="n">Screen</span><span class="p">.</span><span class="n">PrimaryScreen</span><span class="p">.</span><span class="n">Bounds</span><span class="p">.</span><span class="n">Height</span><span class="p">;</span>
</code></pre></div>
</div>

<p>注：  x または y が 30000くらいの大きな値をとりえるならば、<code>long</code>型にキャストすること。</p>

<h2>
<span id="45-証明してみる" class="fragment"></span><a href="#45-%E8%A8%BC%E6%98%8E%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>4.5. 証明してみる</h2>

<p>完全に自己満足の世界だが、証明しておかないと落ち着かないので、証明してみた。</p>

<p>65536の代わりに一般化して $ N $ と置きます。モニタの幅Widthを $ W $ と置きます。 $ N \geq W $ と仮定します。</p>

<div class="code-frame" data-lang="math"><div class="highlight"><pre class="with-code"><code>
p = \frac{N}{W}
</code></pre></div></div>

<p>と置きます。 $ x $ を カーソルのx座標とします。<br>
このとき、4.3章で案として挙げた式は天井関数 $ \lceil x\rceil $ を使って下記と書けます。</p>

<div class="code-frame" data-lang="math"><div class="highlight"><pre class="with-code"><code>
f(x) = \lceil x \cdot p \rceil

</code></pre></div></div>

<p>また、<code>SendInput</code>の座標系からカーソルのx座標に変換する関数を $ g $ と書くと、床関数 $ \lfloor x\rfloor $ を使って下記で表せます。</p>

<div class="code-frame" data-lang="math"><div class="highlight"><pre class="with-code"><code>
g(y) = \biggl\lfloor  y \cdot \frac{1}{p} \biggr\rfloor

</code></pre></div></div>

<p>以降で $ f(x) $ が、「4.2章最下部のグラフの各区間の左端の出力値を取ることを示します。<br>
つまり</p>

<div class="code-frame" data-lang="math"><div class="highlight"><pre class="with-code"><code>
g(f(x) -1) = x-1 \cdots\cdots ①

</code></pre></div></div>

<p>が成立することを証明します。<br>
上記を4.2章のグラフのイメージで描くと下記のようになります。</p>

<p><a href="https://camo.qiitausercontent.com/40d982881ae22c06a9d96a4ec98bf7fc2c56f4a8/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3433383138332f35623632366662362d386632322d393661652d316262322d6266376264643634656666332e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F438183%2F5b626fb6-8f22-96ae-1bb2-bf7bdd64eff3.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=77511d12ca5640339881b2b8d92895b4" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/438183/5b626fb6-8f22-96ae-1bb2-bf7bdd64eff3.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F438183%2F5b626fb6-8f22-96ae-1bb2-bf7bdd64eff3.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=207cfd1a74838ef096ffbbed095656b3 1x" loading="lazy"></a></p>

<p>①の $ g $ を展開すると、</p>

<div class="code-frame" data-lang="math"><div class="highlight"><pre class="with-code"><code>
①   \Leftrightarrow\biggl\lfloor   (f(x) -1) \cdot \frac{1}{p} \biggr\rfloor  = x-1

</code></pre></div></div>

<p>$ \lfloor y \rfloor = C $ なら $ C \leq y &lt; C+1 $ なので、</p>

<div class="code-frame" data-lang="math"><div class="highlight"><pre class="with-code"><code>
①   \Leftrightarrow x-1 \leq   (f(x) -1) \cdot \frac{1}{p}   &lt; x

</code></pre></div></div>

<p>すべての辺に $ p $ を乗算し、さらに $ f(x) $ を展開すると、</p>

<div class="code-frame" data-lang="math"><div class="highlight"><pre class="with-code"><code>
① \Leftrightarrow (x-1)\cdot p \leq   \lceil x \cdot p \rceil -1   &lt; x \cdot p

</code></pre></div></div>

<p>$ x \cdot p $ を $ z $ と置き、すべての辺に $ 1 $ を加算すると、</p>

<div class="code-frame" data-lang="math"><div class="highlight"><pre class="with-code"><code>
① \Leftrightarrow z-(p-1) \leq   \lceil z \rceil   &lt; z + 1

</code></pre></div></div>

<p>$ p - 1 \geq 0  $ なので、上記は常に成立する。以上で証明できた。</p>

<div class="footnotes">
<hr>
<ol>

<li id="fn1">
<p>プライマリモニタのWidthが1920だとすると、係数は34.1328125が丸められて34になります。xが1919のとき、実数上の除算だとabsXは65,500.8671875ですが、係数は34に丸められておりabsXは65,246となります。その差は-254.8671875となり、65535に対して約0.4%の誤差であることが分かります。この0.4%(=0.004)とWidth-1(=1919)を乗算すると、<b>7～8</b>ピクセルほどのズレになります。 <a href="#fnref1">↩</a></p>
</li>

<li id="fn2">
<p>ここでは負の数はとりあえず考えないようにします。 <a href="#fnref2">↩</a></p>
</li>

<li id="fn3">
<p>公式のAPIの説明上の名称はabsXではなく<code>dx</code>です。dxだと微分やDifferenceの略のイメージから「差分」を連想するので、記事中では絶対座標をイメージしやすいようにabsXとしています。 <a href="#fnref3">↩</a></p>
</li>

</ol>
</div>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Fkob58im%2Fitems%2F23df9e22778b33986d1c&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Fkob58im%2Fitems%2F23df9e22778b33986d1c&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/kob58im/items/23df9e22778b33986d1c/likers" class="css-1iupg5d">3</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">2</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/23df9e22778b33986d1c/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/kob58im/items/23df9e22778b33986d1c/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/kob58im/items/23df9e22778b33986d1c/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/kob58im/items/23df9e22778b33986d1c/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/kob58im/items/23df9e22778b33986d1c.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-e429418b-db20-487c-912c-9de5ae8252c1">{"authorAnalyticsTrackingId":null,"organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-a6110ebb-1690-43e3-a48d-8823ef1488c8"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-a6110ebb-1690-43e3-a48d-8823ef1488c8">{}</script>
      
<div id="LoginModal-react-component-c09d01f1-2a22-45d6-b0f4-b643dbbc4ba0"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-c09d01f1-2a22-45d6-b0f4-b643dbbc4ba0">{}</script>
      
<div id="StockModal-react-component-8d13f4c7-b178-48fb-b993-884f00a28602"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-8d13f4c7-b178-48fb-b993-884f00a28602">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;kyCsHmPDpfm+TRMwj8CIr990RaznEIAs3NaWSX5a1Kw/BekThqrv2Sun0U4IYFwwYjFvQ2EeA5d3m9QF3Yua+A==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\n\u003ch1\u003e\n\u003cspan id=\"0-注記\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#0-%E6%B3%A8%E8%A8%98\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e0. 注記\u003c/h1\u003e\n\n\u003cp\u003eWindowsAPIのソースコードは調べられなかったので、実験ベースでの検証になります。\u003cbr\u003e\nコード例はC#です。\u003c/p\u003e\n\n\u003cp\u003e「コードはよ」というかたは、\u003ca href=\"https://qiita.com/kob58im/items/23df9e22778b33986d1c#44-%E7%B5%90%E8%AB%96%E6%AD%A3%E7%A2%BA%E3%81%AB%E5%A4%89%E6%8F%9B%E3%81%A7%E3%81%8D%E3%82%8B%E3%81%A7%E3%81%82%E3%82%8D%E3%81%86%E3%82%B3%E3%83%BC%E3%83%89\"\u003e最後の章へ\u003c/a\u003e。\u003cbr\u003e\n\u003cb\u003eマルチモニタでの挙動は未検証です。\u003c/b\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"1-絶対座標指定でのsendinputを使ったマウスカーソルの移動\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#1-%E7%B5%B6%E5%AF%BE%E5%BA%A7%E6%A8%99%E6%8C%87%E5%AE%9A%E3%81%A7%E3%81%AEsendinput%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%9F%E3%83%9E%E3%82%A6%E3%82%B9%E3%82%AB%E3%83%BC%E3%82%BD%E3%83%AB%E3%81%AE%E7%A7%BB%E5%8B%95\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e1. 絶対座標指定での\u003ccode\u003eSendInput\u003c/code\u003eを使ったマウスカーソルの移動\u003c/h1\u003e\n\n\u003cp\u003e現在のマウスカーソル位置とは関係なくデスクトップ上の指定の座標にマウスカーソルを移動させたいとき、\u003ccode\u003eMOUSEEVENTF_ABSOLUTE\u003c/code\u003eを指定して\u003ccode\u003eSendInput\u003c/code\u003e(Windows API)を使ってマウスを制御します。\u003cbr\u003e\n※移動させるだけなら \u003ccode\u003eCursor.Position\u003c/code\u003e に座標を設定してもやれるようです。マウスボタン操作を合わせてやりたい場合は\u003ccode\u003eSendInput\u003c/code\u003eを使うことになるかと思います。\u003c/p\u003e\n\n\u003cp\u003e巷（ちまた）には下記のような変換をしているコードがあふれていますが、これらを使うと、丸め誤差により、もともとの意図した座標(x, y)からずれます。\u003cbr\u003e\n（例2や例3は、ズレは1ピクセルとかになると思うので通常は気にならないレベルですが、シーンによっては問題になり得ます。）\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eNG例1\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\n\u003cspan class=\"n\"\u003eabsX\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e65535\u003c/span\u003e \u003cspan class=\"p\"\u003e/\u003c/span\u003e \u003cspan class=\"n\"\u003eScreen\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePrimaryScreen\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBounds\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWidth\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003eabsY\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ey\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e65535\u003c/span\u003e \u003cspan class=\"p\"\u003e/\u003c/span\u003e \u003cspan class=\"n\"\u003eScreen\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePrimaryScreen\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBounds\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eHeight\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eNG例1については、C言語やC#等は\u003ccode\u003e/\u003c/code\u003eが整数除算になるので、係数\u003ccode\u003e(65535 / Screen.PrimaryScreen.Bounds.Width)\u003c/code\u003e を計算した時点で、モニタのWidth,Heightに依存した誤差をもってしまいます。\u003csup id=\"fnref1\"\u003e\u003ca href=\"#fn1\" title=\"プライマリモニタのWidthが1920だとすると、係数は34.1328125が丸められて34になります。xが1919のとき、実数上の除算だとabsXは65,500.8671875ですが、係数は34に丸められておりabsXは65,246となります。その差は-254.8671875となり、65535に対して約0.4%の誤差であることが分かります。この0.4%(=0.004)とWidth-1(=1919)を乗算すると、7～8ピクセルほどのズレになります。\"\u003e1\u003c/a\u003e\u003c/sup\u003e\u003c/p\u003e\n\n\u003cp\u003e勘の良い方なら、NG例2を使うでしょう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eNG例2\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\n\u003cspan class=\"n\"\u003eabsX\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"m\"\u003e65535\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e/\u003c/span\u003e \u003cspan class=\"n\"\u003eScreen\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePrimaryScreen\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBounds\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWidth\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003eabsY\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"m\"\u003e65535\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e/\u003c/span\u003e \u003cspan class=\"n\"\u003eScreen\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePrimaryScreen\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBounds\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eHeight\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eもしくは、分子が(65536から)1引いているのだから、分母も同じく1を引いて、下記を使う方もいると思います。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eNG例3\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\n\u003cspan class=\"n\"\u003eabsX\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"m\"\u003e65535\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e/\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eScreen\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePrimaryScreen\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBounds\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWidth\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003eabsY\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"m\"\u003e65535\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e/\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eScreen\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePrimaryScreen\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBounds\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eHeight\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"2-公式サイトのsendinputの仕様記載がそもそもイケてない\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#2-%E5%85%AC%E5%BC%8F%E3%82%B5%E3%82%A4%E3%83%88%E3%81%AEsendinput%E3%81%AE%E4%BB%95%E6%A7%98%E8%A8%98%E8%BC%89%E3%81%8C%E3%81%9D%E3%82%82%E3%81%9D%E3%82%82%E3%82%A4%E3%82%B1%E3%81%A6%E3%81%AA%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2. 公式サイトの\u003ccode\u003eSendInput\u003c/code\u003eの仕様記載がそもそもイケてない\u003c/h1\u003e\n\n\u003cp\u003eNG例2やNG例3をみて、「いやいや、\u003ca href=\"https://docs.microsoft.com/en-us/windows/win32/api/winuser/ns-winuser-mouseinput\" rel=\"nofollow noopener\" target=\"_blank\"\u003eMicrosoftの公式サイト\u003c/a\u003eに書いてあるし、あってるでしょ？」と思う方もおられるかと思います。（自分もそう思ってました。）\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://docs.microsoft.com/en-us/windows/win32/api/winuser/ns-winuser-mouseinput\" rel=\"nofollow noopener\" target=\"_blank\"\u003e公式サイト\u003c/a\u003eの記載を抜粋します。\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eIf MOUSEEVENTF_ABSOLUTE value is specified,\u003cbr\u003e\n dx and dy contain normalized absolute coordinates between 0 and 65,535.\u003cbr\u003e\n The event procedure maps these coordinates onto the display surface.\u003cbr\u003e\n Coordinate (0,0) maps onto the upper-left corner of the display surface;\u003cbr\u003e\n coordinate \u003cb\u003e(65535,65535) maps onto the lower-right corner\u003c/b\u003e.\u003cbr\u003e\n In a multimonitor system, the coordinates map to the \u003cb\u003eprimary monitor\u003c/b\u003e.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eこれを見ると、あたかも\u003cb\u003e(65535,65535)\u003c/b\u003eとプライマリモニタの\u003cb\u003e(Width,Height)\u003c/b\u003eもしくは\u003cb\u003e(Width-1,Height-1)\u003c/b\u003eが対応しているように見えます。\u003c/p\u003e\n\n\u003cp\u003eですが、実際にNG例2やNG例3のコードでやってみるとずれます。\u003cbr\u003e\nずれるケースの実験は本記事では省略しますが、\u003cb\u003e\u003ca href=\"https://qiita.com/kob58im/items/a360b22fd7b2b257e890\" id=\"reference-d77f528afcb9a818347c\"\u003eこの記事\u003c/a\u003e\u003c/b\u003eのコードを使えば確認できます。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"3-指定した座標と実際の移動後の座標の関係を調べてみた\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#3-%E6%8C%87%E5%AE%9A%E3%81%97%E3%81%9F%E5%BA%A7%E6%A8%99%E3%81%A8%E5%AE%9F%E9%9A%9B%E3%81%AE%E7%A7%BB%E5%8B%95%E5%BE%8C%E3%81%AE%E5%BA%A7%E6%A8%99%E3%81%AE%E9%96%A2%E4%BF%82%E3%82%92%E8%AA%BF%E3%81%B9%E3%81%A6%E3%81%BF%E3%81%9F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e3. 指定した座標　と　実際の移動後の座標　の関係を調べてみた\u003c/h1\u003e\n\n\u003cp\u003e3章では、指定した座標に対し\u003ccode\u003eSendInput\u003c/code\u003e実行後のマウスカーソル座標がどこになるのかを調べます。\u003cbr\u003e\nこの章で、\u003ccode\u003eSendInput\u003c/code\u003eの世界の座標系(0,0)-(65535(?),65535(?))  から  ピクセル単位の座標系を取得する式を得ます。\u003c/p\u003e\n\n\u003cp\u003e最終的に得たいのは、これと逆方向の変換です。それについては4章で扱います。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"31-結論\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#31-%E7%B5%90%E8%AB%96\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e3.1. 結論\u003c/h2\u003e\n\n\u003cp\u003e実験により検証したところ、(0,0)-(6553\u003cb\u003e6\u003c/b\u003e,6553\u003cb\u003e6\u003c/b\u003e)とプライマリモニタの(0,0)-(Width,Height)が対応関係にあります。丸め方向は切り捨てです。\u003cbr\u003e\nつまり、\u003ccode\u003eSendInput\u003c/code\u003e APIは、内部で \u003ccode\u003eCursor.Position.X = (absX * Width) / 65536;\u003c/code\u003e に相当する計算（整数除算）をしているようです。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"32-それっぽいエビデンス\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#32-%E3%81%9D%E3%82%8C%E3%81%A3%E3%81%BD%E3%81%84%E3%82%A8%E3%83%93%E3%83%87%E3%83%B3%E3%82%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e3.2. それっぽいエビデンス\u003c/h2\u003e\n\n\u003cp\u003eAbsXが、\u003ccode\u003eSendInput\u003c/code\u003eに指定した x の値。\u003cbr\u003e\nResultXが、.Netの\u003ccode\u003eCursor.Position\u003c/code\u003eプロパティで取得した実際のマウスカーソル座標です。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/7216dc08858aba645851cfcf7ae7e66199232bc6/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3433383138332f65336661643563622d303335322d393637302d626466372d3333613537333131363965342e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F438183%2Fe3fad5cb-0352-9670-bdf7-33a5731169e4.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=e1bd65f44c5dfaba15254c1cd2439975\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/438183/e3fad5cb-0352-9670-bdf7-33a5731169e4.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F438183%2Fe3fad5cb-0352-9670-bdf7-33a5731169e4.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=8d010f5133726d6525961b1f8a9710f9 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e（行挿入等の操作をしてしまったので数式のセル参照がメモとずれてます）\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"33-実験に使用したソースコード\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#33-%E5%AE%9F%E9%A8%93%E3%81%AB%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%9F%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e3.3. 実験に使用したソースコード\u003c/h2\u003e\n\n\u003cp\u003e高解像度による座標系変換の影響を受けると問題がややこしくなるので、\u003ccode\u003eSetProcessDPIAware\u003c/code\u003e (Windows API)で高解像度対応させています。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eSendInputMousePosTest.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Drawing\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.IO\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Runtime.InteropServices\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Threading\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Threading.Tasks\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Windows.Forms\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eMainForm\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eForm\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003esweepStep\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e//  SendInputに送信するx座標ベース\u003c/span\u003e\n\n    \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eabortFlag\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n     \u003cspan class=\"c1\"\u003e// SendInputに送信する終端x,y座標。コマンドライン引数経由で設定。\u003c/span\u003e\n     \u003cspan class=\"c1\"\u003e// (memo: コマンドライン引数はintで受けておき、sweep中のfor文でのoverflow防止のためlongでもっている。)\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003elong\u003c/span\u003e \u003cspan class=\"n\"\u003e_lastAbsX\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003elong\u003c/span\u003e \u003cspan class=\"n\"\u003e_lastAbsY\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003e_directionOption\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// \"d\": ななめ(Diagonal)(x,yを同時にsweep)   それ以外: 水平と垂直\u003c/span\u003e\n\n    \u003cspan class=\"nf\"\u003eMainForm\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003elastAbsX\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003elastAbsY\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003edirectionOption\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eabortFlag\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003e_directionOption\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edirectionOption\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003e_lastAbsX\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003elastAbsX\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003e_lastAbsY\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003elastAbsY\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003eClientSize\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDrawing\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSize\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e300\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"m\"\u003e100\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eLoad\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)=\u0026gt;{\u003c/span\u003e\u003cspan class=\"nf\"\u003eSendMouseMove\u003c/span\u003e\u003cspan class=\"p\"\u003e();};\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eFormClosing\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)=\u0026gt;{\u003c/span\u003e\u003cspan class=\"n\"\u003eabortFlag\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;};\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eNativeMethods\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eDllImport\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"user32.dll\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eSetLastError\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eextern\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eSendInput\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003enInputs\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eInput\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003epInputs\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ecbsize\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eDllImport\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"user32.dll\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eSetLastError\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eextern\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetMessageExtraInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n        \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eDllImport\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"s\"\u003e\"user32.dll\"\u003c/span\u003e \u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003eextern\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"nf\"\u003eSetProcessDPIAware\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eStructLayout\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLayoutKind\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSequential\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"nc\"\u003ePOINT\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ey\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eStructLayout\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLayoutKind\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSequential\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n    \u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"nc\"\u003eMouseInput\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eX\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eY\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eData\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eTime\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e \u003cspan class=\"n\"\u003eExtraInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eStructLayout\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLayoutKind\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSequential\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n    \u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"nc\"\u003eKeyboardInput\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003eshort\u003c/span\u003e \u003cspan class=\"n\"\u003eVirtualKey\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003eshort\u003c/span\u003e \u003cspan class=\"n\"\u003eScanCode\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eTime\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e \u003cspan class=\"n\"\u003eExtraInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eStructLayout\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLayoutKind\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSequential\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n    \u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"nc\"\u003eHardwareInput\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003euMsg\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003eshort\u003c/span\u003e \u003cspan class=\"n\"\u003ewParamL\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003eshort\u003c/span\u003e \u003cspan class=\"n\"\u003ewParamH\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eStructLayout\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLayoutKind\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSequential\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n    \u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"nc\"\u003eInput\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eType\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eInputUnion\u003c/span\u003e \u003cspan class=\"n\"\u003eui\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eStructLayout\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLayoutKind\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eExplicit\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n    \u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"nc\"\u003eInputUnion\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eFieldOffset\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eMouseInput\u003c/span\u003e \u003cspan class=\"n\"\u003eMouse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eFieldOffset\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eKeyboardInput\u003c/span\u003e \u003cspan class=\"n\"\u003eKeyboard\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eFieldOffset\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eHardwareInput\u003c/span\u003e \u003cspan class=\"n\"\u003eHardware\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eMOUSEEVENTF_MOVE\u003c/span\u003e        \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x0001\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eMOUSEEVENTF_ABSOLUTE\u003c/span\u003e    \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x8000\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eSendMouseMove\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eBeginInvoke\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eMethodInvoker\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"k\"\u003edelegate\u003c/span\u003e\u003cspan class=\"p\"\u003e(){\u003c/span\u003e\n                \u003cspan class=\"k\"\u003echecked\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003escrs\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eScreen\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAllScreens\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003efor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003escrs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                        \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eabortFlag\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;}\u003c/span\u003e\n\n                        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Size of screen[\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"]\\t\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003escrs\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eBounds\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWidth\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\\t\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003escrs\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eBounds\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eHeight\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n                        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Location of screen[\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"]\\t\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003escrs\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eBounds\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLeft\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\\t\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003escrs\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eBounds\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTop\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n                    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003e_directionOption\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e\"d\"\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                        \u003cspan class=\"c1\"\u003e// 左上(0,0)から右下(_lastAbsX,_lastAbsY)まで斜めに移動させてx,yを同時に動かして座標を出力させる。\u003c/span\u003e\n                        \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"kt\"\u003elong\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003e_lastAbsX\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003esweepStep\u003c/span\u003e \u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"n\"\u003esweepStep\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                            \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eabortFlag\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;}\u003c/span\u003e\n                            \u003cspan class=\"kt\"\u003elong\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003e_lastAbsX\u003c/span\u003e \u003cspan class=\"p\"\u003e){\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003e_lastAbsX\u003c/span\u003e\u003cspan class=\"p\"\u003e;}\u003c/span\u003e\n                            \u003cspan class=\"kt\"\u003elong\u003c/span\u003e \u003cspan class=\"n\"\u003ey\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003e_lastAbsY\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e/\u003c/span\u003e \u003cspan class=\"n\"\u003e_lastAbsX\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n                            \u003cspan class=\"nf\"\u003eSendInputMouseMoveAndDumpPoint\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                        \u003cspan class=\"c1\"\u003e// 左上(0,0)から(_lastAbsX,0)まで直線状に移動させてx,yを出力させる。\u003c/span\u003e\n                        \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"kt\"\u003elong\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003e_lastAbsX\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003esweepStep\u003c/span\u003e \u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"n\"\u003esweepStep\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                            \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eabortFlag\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;}\u003c/span\u003e\n                            \u003cspan class=\"kt\"\u003elong\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003e_lastAbsX\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003e_lastAbsX\u003c/span\u003e\u003cspan class=\"p\"\u003e;}\u003c/span\u003e\n\n                            \u003cspan class=\"nf\"\u003eSendInputMouseMoveAndDumpPoint\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n                        \u003cspan class=\"c1\"\u003e// 左上(0,0)から(0,_lastAbsY)まで直線状に移動させてx,yを出力させる。\u003c/span\u003e\n                        \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"kt\"\u003elong\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003e_lastAbsY\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003esweepStep\u003c/span\u003e \u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"n\"\u003esweepStep\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                            \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eabortFlag\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;}\u003c/span\u003e\n                            \u003cspan class=\"kt\"\u003elong\u003c/span\u003e \u003cspan class=\"n\"\u003ey\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003e_lastAbsY\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003e_lastAbsY\u003c/span\u003e\u003cspan class=\"p\"\u003e;}\u003c/span\u003e\n\n                            \u003cspan class=\"nf\"\u003eSendInputMouseMoveAndDumpPoint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eMessageBox\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eShow\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Completed.\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eSendInputMouseMoveAndDumpPoint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eabsX\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eabsY\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eSendInputMouseMove\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eabsX\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eabsY\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eDumpPoint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eabsX\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eabsY\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eDumpPoint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eorgAbsX\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eorgAbsY\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ePoint\u003c/span\u003e \u003cspan class=\"n\"\u003ep\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eCursor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePosition\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eorgAbsX\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\\t\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eorgAbsY\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\\t\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eX\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\\t\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eY\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eSendInputMouseMove\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eabsX\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eabsY\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003emv\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eInput\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"n\"\u003emv\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eType\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// MOUSE = 0\u003c/span\u003e\n        \u003cspan class=\"n\"\u003emv\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eui\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMouse\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eX\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eabsX\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003emv\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eui\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMouse\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eY\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eabsY\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003emv\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eui\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMouse\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eData\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003emv\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eui\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMouse\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFlags\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eMOUSEEVENTF_ABSOLUTE\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003eMOUSEEVENTF_MOVE\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003emv\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eui\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMouse\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTime\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003emv\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eui\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMouse\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eExtraInfo\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eIntPtr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eZero\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003eInput\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003einputs\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eInput\u003c/span\u003e\u003cspan class=\"p\"\u003e[]{\u003c/span\u003e\u003cspan class=\"n\"\u003emv\u003c/span\u003e\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eNativeMethods\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSendInput\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003einputs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003einputs\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eMarshal\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSizeOf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003einputs\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]));\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eSTAThread\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eMain\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eNativeMethods\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSetProcessDPIAware\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 高解像度のスケーリング座標に対応するため\u003c/span\u003e\n\n        \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003elastAbsX\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003elastAbsY\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003edirectionOption\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e==\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003elastAbsX\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e65535\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003elastAbsY\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e65535\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003edirectionOption\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"d\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e==\u003c/span\u003e\u003cspan class=\"m\"\u003e3\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003etry\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003elastAbsX\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eConvert\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToInt32\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n                \u003cspan class=\"n\"\u003elastAbsY\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eConvert\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToInt32\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ecatch\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eFormatException\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ecatch\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eOverflowException\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elastAbsX\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;}\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elastAbsY\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;}\u003c/span\u003e\n\n            \u003cspan class=\"n\"\u003edirectionOption\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003eApplication\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRun\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMainForm\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elastAbsX\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003elastAbsY\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003edirectionOption\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"4-じゃあどうすればよいの\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#4-%E3%81%98%E3%82%83%E3%81%82%E3%81%A9%E3%81%86%E3%81%99%E3%82%8C%E3%81%B0%E3%82%88%E3%81%84%E3%81%AE\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e4. じゃあどうすればよいの？\u003c/h1\u003e\n\n\u003cp\u003e3章で得られた関係性 \u003ccode\u003eCursor.Position.X = (absX * Width) / 65536;\u003c/code\u003eの\u003cbr\u003e\n逆計算をすることでマウスカーソルの座標系から0～65536の座標系に変換する。\u003cbr\u003e\nというアプローチで行きます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"41-床関数\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#41-%E5%BA%8A%E9%96%A2%E6%95%B0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e4.1. 床関数\u003c/h2\u003e\n\n\u003cp\u003e整数除算の際の丸め処理\u003csup id=\"fnref2\"\u003e\u003ca href=\"#fn2\" title=\"ここでは負の数はとりあえず考えないようにします。\"\u003e2\u003c/a\u003e\u003c/sup\u003eは、大雑把にいうと、小数点以下を切り捨てているのと同じなので、床関数と同じと考えることができます。\u003c/p\u003e\n\n\u003cp\u003e床関数のグラフの描くとこんな感じになります。（白抜きの〇は、含まない。）\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/df4604b077293d4f091bfc17cb3f9da240ded3cd/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3433383138332f35353662363665312d383633612d313263382d313435372d6336373431373635346134362e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F438183%2F556b66e1-863a-12c8-1457-c67417654a46.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=d9db34e2f0df270bd54130e5e6530c81\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/438183/556b66e1-863a-12c8-1457-c67417654a46.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F438183%2F556b66e1-863a-12c8-1457-c67417654a46.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=9633c3d762d63777deb697a01e1bd50e 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"42-逆計算のイメージ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#42-%E9%80%86%E8%A8%88%E7%AE%97%E3%81%AE%E3%82%A4%E3%83%A1%E3%83%BC%E3%82%B8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e4.2. 逆計算のイメージ\u003c/h2\u003e\n\n\u003cp\u003eモニタのWidth, Heightが65536以下である仮定のもと、実際の例 Width = 1920 のときの逆計算のイメージをグラフで描くと下図のようになります。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/192e0a96c41b59ffab48b9384a1bb93aed0d9e45/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3433383138332f31376164353937342d616365332d616165622d653637662d3963393131643031653130362e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F438183%2F17ad5974-ace3-aaeb-e67f-9c911d01e106.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=2ef153de47220b45bd66e8c69764b627\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/438183/17ad5974-ace3-aaeb-e67f-9c911d01e106.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F438183%2F17ad5974-ace3-aaeb-e67f-9c911d01e106.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=cef376e413e08eb86adcc6c5787a005f 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eカーソル位置x=1に動かしたい場合は、35～68の範囲に収まる値を\u003ccode\u003eSendInput\u003c/code\u003eのabsXに設定してやる必要があります。\u003csup id=\"fnref3\"\u003e\u003ca href=\"#fn3\" title=\"公式のAPIの説明上の名称はabsXではなくdxです。dxだと微分やDifferenceの略のイメージから「差分」を連想するので、記事中では絶対座標をイメージしやすいようにabsXとしています。\"\u003e3\u003c/a\u003e\u003c/sup\u003e\u003cbr\u003e\nなので、グラフ上の各線分●ー○よりも内側を貫く直線で逆計算の式を構築する必要があります。（語彙力・・・）\u003cbr\u003e\nちょっと雑ですが、下図のイメージです。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/0307295a4a3358b9e7271bad80b5571a83038582/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3433383138332f65633734356564322d346332312d626433662d623932382d6462393461663031626137372e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F438183%2Fec745ed2-4c21-bd3f-b928-db94af01ba77.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=e120dc3a6be3155db27d09b5465c05a0\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/438183/ec745ed2-4c21-bd3f-b928-db94af01ba77.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F438183%2Fec745ed2-4c21-bd3f-b928-db94af01ba77.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=ae84687e2ca3675902cddf783793732a 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"43-逆計算の式\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#43-%E9%80%86%E8%A8%88%E7%AE%97%E3%81%AE%E5%BC%8F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e4.3. 逆計算の式\u003c/h2\u003e\n\n\u003cp\u003e話がとびますが、直感に頼って式の案を出すと、天井関数を使って\u003c/p\u003e\n\n\u003cp\u003eabsX = ceiling((Cursor.Position.X * 65536) ÷ Width) \u003c/p\u003e\n\n\u003cp\u003eとして計算すればイケそう（4.2.章の内容を満たせそう）な気がします（超乱暴）。（ここでの\u003ccode\u003e÷\u003c/code\u003eは実数での除算を表しているとします。）\u003cbr\u003e\nExcelで検算をしたところ、Width=1920, Height=1080の環境では誤差がでないようです。\u003c/p\u003e\n\n\u003cp\u003eイメージこんな感じ。\u003cbr\u003e\n\u003c/p\u003e\u003cp class=\"codepen\" data-height=\"600\" data-default-tab=\"result\" data-slug-hash=\"vYGyQwe\"\u003e\u003cbr\u003e\n  See the Pen \u003ca href=\"https://codepen.io/kob58im/pen/vYGyQwe\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003cbr\u003e\n  Conversion graph of SendInput\u003c/a\u003e by kob58im (\u003ca href=\"https://codepen.io/kob58im\" rel=\"nofollow noopener\" target=\"_blank\"\u003e@kob58im\u003c/a\u003e)\u003cbr\u003e\n  on \u003ca href=\"https://codepen.io\" rel=\"nofollow noopener\" target=\"_blank\"\u003eCodePen\u003c/a\u003e.\u003cbr\u003e\n\u003c/p\u003e\u003cbr\u003e\n\u003cscript async src=\"https://static.codepen.io/assets/embed/ei.js\"\u003e\u003c/script\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"44-結論正確に変換できるであろうコード\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#44-%E7%B5%90%E8%AB%96%E6%AD%A3%E7%A2%BA%E3%81%AB%E5%A4%89%E6%8F%9B%E3%81%A7%E3%81%8D%E3%82%8B%E3%81%A7%E3%81%82%E3%82%8D%E3%81%86%E3%82%B3%E3%83%BC%E3%83%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e4.4. 結論（正確に変換できるであろうコード）\u003c/h2\u003e\n\n\u003cp\u003e4.3章の変換式をソースコード(C#)にすると、下記のようになります。\u003cbr\u003e\n\u003cs\u003e下記の「正確に変換できるであろうコード」は、最終的に4.3章にて\u003cb\u003e直感\u003c/b\u003eで出しており、4.2章で言及した変換ができているかどうか数学的な証明もしていないので、参考扱いとしてください。\u003c/s\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e正確に変換できるであろうコード\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\n\u003cspan class=\"n\"\u003eabsX\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"m\"\u003e65536\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eScreen\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePrimaryScreen\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBounds\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWidth\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e/\u003c/span\u003e \u003cspan class=\"n\"\u003eScreen\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePrimaryScreen\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBounds\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWidth\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003eabsY\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"m\"\u003e65536\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eScreen\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePrimaryScreen\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBounds\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eHeight\u003c/span\u003e\u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e/\u003c/span\u003e \u003cspan class=\"n\"\u003eScreen\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePrimaryScreen\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBounds\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eHeight\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e注：  x または y が 30000くらいの大きな値をとりえるならば、\u003ccode\u003elong\u003c/code\u003e型にキャストすること。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"45-証明してみる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#45-%E8%A8%BC%E6%98%8E%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e4.5. 証明してみる\u003c/h2\u003e\n\n\u003cp\u003e完全に自己満足の世界だが、証明しておかないと落ち着かないので、証明してみた。\u003c/p\u003e\n\n\u003cp\u003e65536の代わりに一般化して $ N $ と置きます。モニタの幅Widthを $ W $ と置きます。 $ N \\geq W $ と仮定します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"math\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\np = \\frac{N}{W}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eと置きます。 $ x $ を カーソルのx座標とします。\u003cbr\u003e\nこのとき、4.3章で案として挙げた式は天井関数 $ \\lceil x\\rceil $ を使って下記と書けます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"math\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\nf(x) = \\lceil x \\cdot p \\rceil\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eまた、\u003ccode\u003eSendInput\u003c/code\u003eの座標系からカーソルのx座標に変換する関数を $ g $ と書くと、床関数 $ \\lfloor x\\rfloor $ を使って下記で表せます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"math\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\ng(y) = \\biggl\\lfloor  y \\cdot \\frac{1}{p} \\biggr\\rfloor\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e以降で $ f(x) $ が、「4.2章最下部のグラフの各区間の左端の出力値を取ることを示します。\u003cbr\u003e\nつまり\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"math\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\ng(f(x) -1) = x-1 \\cdots\\cdots ①\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eが成立することを証明します。\u003cbr\u003e\n上記を4.2章のグラフのイメージで描くと下記のようになります。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/40d982881ae22c06a9d96a4ec98bf7fc2c56f4a8/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3433383138332f35623632366662362d386632322d393661652d316262322d6266376264643634656666332e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F438183%2F5b626fb6-8f22-96ae-1bb2-bf7bdd64eff3.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=77511d12ca5640339881b2b8d92895b4\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/438183/5b626fb6-8f22-96ae-1bb2-bf7bdd64eff3.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F438183%2F5b626fb6-8f22-96ae-1bb2-bf7bdd64eff3.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=207cfd1a74838ef096ffbbed095656b3 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e①の $ g $ を展開すると、\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"math\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\n①   \\Leftrightarrow\\biggl\\lfloor   (f(x) -1) \\cdot \\frac{1}{p} \\biggr\\rfloor  = x-1\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e$ \\lfloor y \\rfloor = C $ なら $ C \\leq y \u0026lt; C+1 $ なので、\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"math\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\n①   \\Leftrightarrow x-1 \\leq   (f(x) -1) \\cdot \\frac{1}{p}   \u0026lt; x\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eすべての辺に $ p $ を乗算し、さらに $ f(x) $ を展開すると、\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"math\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\n① \\Leftrightarrow (x-1)\\cdot p \\leq   \\lceil x \\cdot p \\rceil -1   \u0026lt; x \\cdot p\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e$ x \\cdot p $ を $ z $ と置き、すべての辺に $ 1 $ を加算すると、\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"math\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\n① \\Leftrightarrow z-(p-1) \\leq   \\lceil z \\rceil   \u0026lt; z + 1\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e$ p - 1 \\geq 0  $ なので、上記は常に成立する。以上で証明できた。\u003c/p\u003e\n\n\u003cdiv class=\"footnotes\"\u003e\n\u003chr\u003e\n\u003col\u003e\n\n\u003cli id=\"fn1\"\u003e\n\u003cp\u003eプライマリモニタのWidthが1920だとすると、係数は34.1328125が丸められて34になります。xが1919のとき、実数上の除算だとabsXは65,500.8671875ですが、係数は34に丸められておりabsXは65,246となります。その差は-254.8671875となり、65535に対して約0.4%の誤差であることが分かります。この0.4%(=0.004)とWidth-1(=1919)を乗算すると、\u003cb\u003e7～8\u003c/b\u003eピクセルほどのズレになります。 \u003ca href=\"#fnref1\"\u003e↩\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\n\u003cli id=\"fn2\"\u003e\n\u003cp\u003eここでは負の数はとりあえず考えないようにします。 \u003ca href=\"#fnref2\"\u003e↩\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\n\u003cli id=\"fn3\"\u003e\n\u003cp\u003e公式のAPIの説明上の名称はabsXではなく\u003ccode\u003edx\u003c/code\u003eです。dxだと微分やDifferenceの略のイメージから「差分」を連想するので、記事中では絶対座標をイメージしやすいようにabsXとしています。 \u003ca href=\"#fnref3\"\u003e↩\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\n\u003c/ol\u003e\n\u003c/div\u003e\n","createdAt":"2020-08-22T00:55:52Z","elapsedYearsFromLastModifiedAt":1,"encryptedId":"grh5BU7vtk5me/Ij0Gy2ZGgMXIUH72wG3g==--UI+x7e2eNg1z9Qor--vhWmuoVcFgAyGPpF/aC+9Q==","isBanned":false,"isDeprecated":true,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2020-08-22T06:59:41Z","likesCount":3,"linkUrl":"https://qiita.com/kob58im/items/23df9e22778b33986d1c","organization":null,"originalId":1286596,"stockedCount":2,"title":"巷にあふれているSendInput(Windows API)の座標変換のソースコードに物申す","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#0-%E6%B3%A8%E8%A8%98\"\u003e0. 注記\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#1-%E7%B5%B6%E5%AF%BE%E5%BA%A7%E6%A8%99%E6%8C%87%E5%AE%9A%E3%81%A7%E3%81%AEsendinput%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%9F%E3%83%9E%E3%82%A6%E3%82%B9%E3%82%AB%E3%83%BC%E3%82%BD%E3%83%AB%E3%81%AE%E7%A7%BB%E5%8B%95\"\u003e1. 絶対座標指定でのSendInputを使ったマウスカーソルの移動\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#2-%E5%85%AC%E5%BC%8F%E3%82%B5%E3%82%A4%E3%83%88%E3%81%AEsendinput%E3%81%AE%E4%BB%95%E6%A7%98%E8%A8%98%E8%BC%89%E3%81%8C%E3%81%9D%E3%82%82%E3%81%9D%E3%82%82%E3%82%A4%E3%82%B1%E3%81%A6%E3%81%AA%E3%81%84\"\u003e2. 公式サイトのSendInputの仕様記載がそもそもイケてない\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#3-%E6%8C%87%E5%AE%9A%E3%81%97%E3%81%9F%E5%BA%A7%E6%A8%99%E3%81%A8%E5%AE%9F%E9%9A%9B%E3%81%AE%E7%A7%BB%E5%8B%95%E5%BE%8C%E3%81%AE%E5%BA%A7%E6%A8%99%E3%81%AE%E9%96%A2%E4%BF%82%E3%82%92%E8%AA%BF%E3%81%B9%E3%81%A6%E3%81%BF%E3%81%9F\"\u003e3. 指定した座標　と　実際の移動後の座標　の関係を調べてみた\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#31-%E7%B5%90%E8%AB%96\"\u003e3.1. 結論\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#32-%E3%81%9D%E3%82%8C%E3%81%A3%E3%81%BD%E3%81%84%E3%82%A8%E3%83%93%E3%83%87%E3%83%B3%E3%82%B9\"\u003e3.2. それっぽいエビデンス\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#33-%E5%AE%9F%E9%A8%93%E3%81%AB%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%9F%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%89\"\u003e3.3. 実験に使用したソースコード\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#4-%E3%81%98%E3%82%83%E3%81%82%E3%81%A9%E3%81%86%E3%81%99%E3%82%8C%E3%81%B0%E3%82%88%E3%81%84%E3%81%AE\"\u003e4. じゃあどうすればよいの？\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#41-%E5%BA%8A%E9%96%A2%E6%95%B0\"\u003e4.1. 床関数\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#42-%E9%80%86%E8%A8%88%E7%AE%97%E3%81%AE%E3%82%A4%E3%83%A1%E3%83%BC%E3%82%B8\"\u003e4.2. 逆計算のイメージ\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#43-%E9%80%86%E8%A8%88%E7%AE%97%E3%81%AE%E5%BC%8F\"\u003e4.3. 逆計算の式\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#44-%E7%B5%90%E8%AB%96%E6%AD%A3%E7%A2%BA%E3%81%AB%E5%A4%89%E6%8F%9B%E3%81%A7%E3%81%8D%E3%82%8B%E3%81%A7%E3%81%82%E3%82%8D%E3%81%86%E3%82%B3%E3%83%BC%E3%83%89\"\u003e4.4. 結論（正確に変換できるであろうコード）\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#45-%E8%A8%BC%E6%98%8E%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B\"\u003e4.5. 証明してみる\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":1136,"uuid":"23df9e22778b33986d1c","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"87jbMht1mYBCU5wpifR0Nw8BI9IA--+WUZ3x7VCgajUuK8--MHZ7Uu9PAC1D8AQu1lqebg==","originalId":438183,"description":"趣味でC#で色々試してます。\r\n置いてるほとんどのC#サンプルコードは、Windows7以降デフォで入ってる環境でコンパイルできます。\r\n最近はCodePen使ってJavaScriptも書いてます。","facebookUrl":null,"githubUrl":null,"isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"","profileImageUrl":"https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/438183/2a98273b33a1aaed7a0715e06359994fe6d0636b/x_large.png?1575159318","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fs3-ap-northeast-1.amazonaws.com%2Fqiita-image-store%2F0%2F438183%2F2a98273b33a1aaed7a0715e06359994fe6d0636b%2Fx_large.png%3F1575159318?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=2c9dc891a1f01774a872a0bf4ac1cde5","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fs3-ap-northeast-1.amazonaws.com%2Fqiita-image-store%2F0%2F438183%2F2a98273b33a1aaed7a0715e06359994fe6d0636b%2Fx_large.png%3F1575159318?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=0027b6d3e0ec08faa169ea869eb67b5a","urlName":"kob58im","websiteUrl":"","twitterUrl":null,"twitterUrlName":null,"revealedOrganizations":{"edges":[]}},"tags":[{"name":"Windows","urlName":"windows"},{"name":"C#","urlName":"csharp"},{"name":"数学","urlName":"%e6%95%b0%e5%ad%a6"},{"name":"Win32API","urlName":"win32api"}],"followingLikers":{"edges":[]},"comments":{"totalCount":0}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

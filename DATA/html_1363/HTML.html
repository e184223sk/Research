<!DOCTYPE html><html><head><meta charset="utf-8" /><title>UniTask Ver2 、UniTaskAsyncEnumerableまとめ - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/toRisouP/items/8f66fd952eaffeaf3107" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="5qV3QKmp/9vJk0qoLP5+7aSRcikfOpeWuYfES0NUubn5XjvlvKyklxid2QbKpVPc77SbC++ykxafg6Gyxa4Q+Q==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta content="@toRisouP" name="twitter:creator" /><meta property="og:type" content="article"><meta property="og:title" content="UniTask Ver2 、UniTaskAsyncEnumerableまとめ - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1WVzVwVkdGemF5QldaWEl5SU9PQWdWVnVhVlJoYzJ0QmMzbHVZMFZ1ZFcxbGNtRmliR1hqZ2I3amdhampnb0UmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT01NCZ0eHQtY2xpcD1lbGxpcHNpcyZ0eHQtYWxpZ249Y2VudGVyJTJDbWlkZGxlJnM9ZjM0OGE3MTc2MTE2N2ExOGYwOTRlNGMyM2U3ODhmZWI&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RSFJ2VW1semIzVlEmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT00NSZ0eHQtYWxpZ249cmlnaHQlMkNib3R0b20mcz1jNzExYWUyZTRiN2FhZjdjNTk3N2QyMGUwMTBlZjA2ZA&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=f76c608ae5047cd5e474935450d021ed"><meta property="og:description" content="

他の資料

C# Tokyo オンライン「Unity 祭り」で登壇した資料も追加しておきます。あわせて御覧ください。


UniTaskの使い方2020（スライド）
発表動画（YouTube）



UniTask2

UniTa..."><meta content="https://qiita.com/toRisouP/items/8f66fd952eaffeaf3107" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#,Unity,UniRx,UniTask" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-9e00ce0f-4f8a-4166-bb38-a02b77a9bc21"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2FtoRisouP%2Fitems%2F8f66fd952eaffeaf3107">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2FtoRisouP%2Fitems%2F8f66fd952eaffeaf3107">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-9e00ce0f-4f8a-4166-bb38-a02b77a9bc21">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2020-05-19T23:55:03.000+09:00","dateModified":"2020-09-29T16:45:29.000+09:00","headline":"UniTask Ver2 、UniTaskAsyncEnumerableまとめ","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1WVzVwVkdGemF5QldaWEl5SU9PQWdWVnVhVlJoYzJ0QmMzbHVZMFZ1ZFcxbGNtRmliR1hqZ2I3amdhampnb0UmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT01NCZ0eHQtY2xpcD1lbGxpcHNpcyZ0eHQtYWxpZ249Y2VudGVyJTJDbWlkZGxlJnM9ZjM0OGE3MTc2MTE2N2ExOGYwOTRlNGMyM2U3ODhmZWI\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RSFJ2VW1semIzVlEmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT00NSZ0eHQtYWxpZ249cmlnaHQlMkNib3R0b20mcz1jNzExYWUyZTRiN2FhZjdjNTk3N2QyMGUwMTBlZjA2ZA\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=f76c608ae5047cd5e474935450d021ed","mainEntityOfPage":"https://qiita.com/toRisouP/items/8f66fd952eaffeaf3107","author":{"@type":"Person","address":"","email":null,"identifier":"toRisouP","name":"toRisouP","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F47146%2Fprofile-images%2F1473690888?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=61879b88c08bddf8018304cc1ace2fc4","url":"https://qiita.com/toRisouP","description":"","memberOf":[{"@type":"Organization","address":"〒060-0031 北海道札幌市中央区北一条東四丁目1番地1　サッポロファクトリー1条館","legalName":"株式会社 バーチャルキャスト","image":"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/3c14012520e7982527749362e5a0fd9efd6cc0c2/original.jpg?1545792523","logo":"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/bf42a888e9366aa2d817bd985e231c12c6d80826/original.jpg?1545792589","identifier":"virtualcast","description":"VRシステム(バーチャルキャスト)の開発、運営、企画"}]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://increments.connpass.com/event/211948/">「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催</a><a target="_blank" id="header_text_message_2" href="https://increments.connpass.com/event/211948/">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"toRisouP","type":"items","id":"8f66fd952eaffeaf3107"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"toRisouP","type":"items","id":"8f66fd952eaffeaf3107"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":0,"pos_id":"header_text_message_1","message":"「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"toRisouP","type":"items","id":"8f66fd952eaffeaf3107"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":0,"pos_id":"header_text_message_2","message":"「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/toRisouP/items/8f66fd952eaffeaf3107","location":"/toRisouP/items/8f66fd952eaffeaf3107","scheme":"https","host":"qiita.com","port":null,"pathname":"/toRisouP/items/8f66fd952eaffeaf3107","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"CcrE6Gt+2dVTFLEUw+njMFUamlgvyzhGDOUXSIQroNoWMYhNfnuCmYIaIrolss4BHj9zet9DPMYq4XKxAtEJmg==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-70bd68e5-2da4-4760-b5e3-237777fb1787"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/toRisouP/items/8f66fd952eaffeaf3107/likers" class="css-1iupg5d">114</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">83</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/8f66fd952eaffeaf3107/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/toRisouP/items/8f66fd952eaffeaf3107/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/toRisouP/items/8f66fd952eaffeaf3107/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/toRisouP/items/8f66fd952eaffeaf3107/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/toRisouP/items/8f66fd952eaffeaf3107.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/toRisouP"><img class="css-100alwu eyfquo10" src="https://qiita-image-store.s3.amazonaws.com/0/47146/profile-images/1473690888" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/toRisouP" class="css-10ougpm">@<!-- -->toRisouP</a><div class="css-1ay9vb9"><span><meta content="2020-05-19T14:55:03Z"/><time dateTime="2020-09-29T07:45:29Z" class="css-m19uds">updated at 2020-09-29</time></span></div></div></div></div></div><h1 class="css-cgzq40">UniTask Ver2 、UniTaskAsyncEnumerableまとめ</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/unity" class="css-4czcte">Unity</a><a href="/tags/unirx" class="css-4czcte">UniRx</a><a href="/tags/unitask" class="css-4czcte">UniTask</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div>
<h1>
<span id="他の資料" class="fragment"></span><a href="#%E4%BB%96%E3%81%AE%E8%B3%87%E6%96%99"><i class="fa fa-link"></i></a>他の資料</h1>

<p><a href="https://csharp-tokyo.connpass.com/event/175469/" rel="nofollow noopener" target="_blank">C# Tokyo オンライン「Unity 祭り」</a>で登壇した資料も追加しておきます。あわせて御覧ください。</p>

<ul>
<li><a href="https://speakerdeck.com/torisoup/unitask2020" rel="nofollow noopener" target="_blank">UniTaskの使い方2020（スライド）</a></li>
<li><a href="https://youtu.be/IcSl_7UENQ8" rel="nofollow noopener" target="_blank">発表動画（YouTube）</a></li>
</ul>

<h1>
<span id="unitask2" class="fragment"></span><a href="#unitask2"><i class="fa fa-link"></i></a>UniTask2</h1>

<p><code>UniTask</code>が大きくアップデートされて、Ver2となりました！<br>
今回はその変更点についてまとめてみました。</p>

<p>※ <code>Ver.2.0.25</code>準拠で書いています。</p>

<h1>
<span id="破壊的変更" class="fragment"></span><a href="#%E7%A0%B4%E5%A3%8A%E7%9A%84%E5%A4%89%E6%9B%B4"><i class="fa fa-link"></i></a>破壊的変更</h1>

<p>まずは1系からの破壊的変更。導入時に気をつける必要があるところです。</p>

<h2>
<span id="必要な最低unityバージョン" class="fragment"></span><a href="#%E5%BF%85%E8%A6%81%E3%81%AA%E6%9C%80%E4%BD%8Eunity%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3"><i class="fa fa-link"></i></a>必要な最低Unityバージョン</h2>

<p><strong>2018.4.13f1</strong> が最低サポートバージョンとなりました。</p>

<h2>
<span id="名前空間の変更" class="fragment"></span><a href="#%E5%90%8D%E5%89%8D%E7%A9%BA%E9%96%93%E3%81%AE%E5%A4%89%E6%9B%B4"><i class="fa fa-link"></i></a>名前空間の変更</h2>

<p>名前空間が<code>UniRx.Async</code>から<code>Cysharp.Threading.Tasks</code>に変更されました。<br>
もともと<code>UniRx</code>のライブラリの一部だった名残なのですが、今回のアップデートで完全に名残がなくなりました。</p>

<h2>
<span id="unitaskのawait2度漬け禁止" class="fragment"></span><a href="#unitask%E3%81%AEawait2%E5%BA%A6%E6%BC%AC%E3%81%91%E7%A6%81%E6%AD%A2"><i class="fa fa-link"></i></a>UniTaskのawait2度漬け禁止</h2>

<p>同じ<code>UniTask</code>に対しての2回以上の<code>await</code>が明確に禁止となりました。<br>
<code>IValueTaskSource</code>準拠の挙動なので、これは本家<code>ValueTask</code>と同じ挙動です。</p>

<div class="code-frame" data-lang="cs">
<div class="code-lang"><span class="bold">UniTaskの2回以上のawait禁止</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">private</span> <span class="k">async</span> <span class="n">UniTaskVoid</span> <span class="nf">DoAsync</span><span class="p">(</span><span class="n">CancellationToken</span> <span class="n">token</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">try</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">uniTask</span> <span class="p">=</span> <span class="nf">GetAsync</span><span class="p">(</span><span class="s">"https://unity.com/ja"</span><span class="p">,</span> <span class="n">token</span><span class="p">);</span>

        <span class="c1">// 1回目のawaitは問題ない</span>
        <span class="k">await</span> <span class="n">uniTask</span><span class="p">;</span>

        <span class="c1">// 同じオブジェクトに対して2回以上のawaitはできない</span>
        <span class="c1">// (InvalidOperationExceptionが発行される)</span>
        <span class="k">await</span> <span class="n">uniTask</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="n">InvalidOperationException</span> <span class="n">e</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Debug</span><span class="p">.</span><span class="nf">LogException</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">private</span> <span class="k">async</span> <span class="n">UniTask</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="nf">GetAsync</span><span class="p">(</span><span class="kt">string</span> <span class="n">uri</span><span class="p">,</span> <span class="n">CancellationToken</span> <span class="n">token</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">uwr</span> <span class="p">=</span> <span class="n">UnityWebRequest</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="n">uri</span><span class="p">);</span>
    <span class="k">await</span> <span class="n">uwr</span><span class="p">.</span><span class="nf">SendWebRequest</span><span class="p">().</span><span class="nf">WithCancellation</span><span class="p">(</span><span class="n">token</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">uwr</span><span class="p">.</span><span class="n">downloadHandler</span><span class="p">.</span><span class="n">text</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</div>

<h3>
<span id="preserve" class="fragment"></span><a href="#preserve"><i class="fa fa-link"></i></a>Preserve()</h3>

<p>もし同じ<code>UniTask</code>を2回以上<code>await</code>する必要があるならば、<code>Preserve()</code>を利用しましょう。</p>

<div class="code-frame" data-lang="cs">
<div class="code-lang"><span class="bold">Preserve()</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">private</span> <span class="k">async</span> <span class="n">UniTaskVoid</span> <span class="nf">DoAsync</span><span class="p">(</span><span class="n">CancellationToken</span> <span class="n">token</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">try</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">uniTask</span> <span class="p">=</span> <span class="nf">GetAsync</span><span class="p">(</span><span class="s">"https://unity.com/ja"</span><span class="p">,</span> <span class="n">token</span><span class="p">);</span>

        <span class="c1">// Preserve()で何回でもawait可能なUniTaskに変換</span>
        <span class="kt">var</span> <span class="n">reusable</span> <span class="p">=</span> <span class="n">uniTask</span><span class="p">.</span><span class="nf">Preserve</span><span class="p">();</span>

        <span class="k">await</span> <span class="n">reusable</span><span class="p">;</span>
        <span class="k">await</span> <span class="n">reusable</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="n">InvalidOperationException</span> <span class="n">e</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Debug</span><span class="p">.</span><span class="nf">LogException</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<h2>
<span id="asyncoperationをawaitするときのconfigureawait廃止" class="fragment"></span><a href="#asyncoperation%E3%82%92await%E3%81%99%E3%82%8B%E3%81%A8%E3%81%8D%E3%81%AEconfigureawait%E5%BB%83%E6%AD%A2"><i class="fa fa-link"></i></a><code>AsyncOperation</code>を<code>await</code>するときの<code>ConfigureAwait</code>廃止</h2>

<p><code>AsyncOperation</code>を<code>await</code>するときに利用できていた<code>ConfigureAwait</code>が廃止となりました。</p>

<p><code>IProgress&lt;float&gt;</code>や<code>CancellationToken</code>を指定したい場合は<code>ToUniTask()</code>または<code>WithCancellation()</code>を利用する必要があります。</p>

<div class="code-frame" data-lang="cs"><div class="highlight"><pre class="with-code"><code><span class="k">private</span> <span class="k">async</span> <span class="n">UniTask</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="nf">GetAsync</span><span class="p">(</span><span class="kt">string</span> <span class="n">uri</span><span class="p">,</span> <span class="n">CancellationToken</span> <span class="n">token</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">uwr</span> <span class="p">=</span> <span class="n">UnityWebRequest</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="n">uri</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="c1">// CancellationTokenを指定</span>
        <span class="k">await</span> <span class="n">uwr</span><span class="p">.</span><span class="nf">SendWebRequest</span><span class="p">().</span><span class="nf">WithCancellation</span><span class="p">(</span><span class="n">token</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">uwr</span><span class="p">.</span><span class="n">downloadHandler</span><span class="p">.</span><span class="n">text</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="code-frame" data-lang="cs"><div class="highlight"><pre class="with-code"><code>
<span class="c1">// IProgress&lt;float&gt;を指定したい場合（あとついでにCancellationToken）</span>
<span class="kt">var</span> <span class="n">urw2</span> <span class="p">=</span> <span class="n">UnityWebRequest</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="s">"https://unity.com/ja"</span><span class="p">);</span>
<span class="k">await</span> <span class="n">urw2</span><span class="p">.</span><span class="nf">SendWebRequest</span><span class="p">()</span>
    <span class="p">.</span><span class="nf">ToUniTask</span><span class="p">(</span>
        <span class="n">Progress</span><span class="p">.</span><span class="n">Create</span><span class="p">&lt;</span><span class="kt">float</span><span class="p">&gt;(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span>
        <span class="n">cancellationToken</span><span class="p">:</span> <span class="n">token</span><span class="p">);</span>
</code></pre></div></div>

<h2>
<span id="unitaskの一部コンストラクタ廃止" class="fragment"></span><a href="#unitask%E3%81%AE%E4%B8%80%E9%83%A8%E3%82%B3%E3%83%B3%E3%82%B9%E3%83%88%E3%83%A9%E3%82%AF%E3%82%BF%E5%BB%83%E6%AD%A2"><i class="fa fa-link"></i></a>UniTaskの一部コンストラクタ廃止</h2>

<p><code>UniTask</code>の一部コンストラクタが廃止されました。<br>
こちらは<code>UniTask</code>の起動を遅延実行するために利用できたコンストラクタです。<br>
（<code>UniTask.Lazy</code>に相当していた）</p>

<div class="code-frame" data-lang="cs">
<div class="code-lang"><span class="bold">廃止されたコンストラクタ</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="nf">UniTask</span><span class="p">(</span><span class="n">Func</span><span class="p">&lt;</span><span class="n">UniTask</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;&gt;</span> <span class="n">factory</span><span class="p">)</span>
</code></pre></div>
</div>

<p>これ相当のファクトリメソッドとして、<code>UniTask.Defer</code>と<code>UniTask.Lazy</code>があるのでこちらを使いましょう。</p>

<h2>
<span id="unitasklazyの戻り値の変更" class="fragment"></span><a href="#unitasklazy%E3%81%AE%E6%88%BB%E3%82%8A%E5%80%A4%E3%81%AE%E5%A4%89%E6%9B%B4"><i class="fa fa-link"></i></a>UniTask.Lazyの戻り値の変更</h2>

<p>上記の多重<code>await</code>禁止の変更をうけて、<code>UniTask.Lazy</code>の戻り値が<code>AsyncLazy</code>に変換されました。</p>

<div class="code-frame" data-lang="cs"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">static</span> <span class="n">AsyncLazy</span> <span class="nf">Lazy</span><span class="p">(</span><span class="n">Func</span><span class="p">&lt;</span><span class="n">UniTask</span><span class="p">&gt;</span> <span class="n">factory</span><span class="p">)</span>
<span class="k">public</span> <span class="k">static</span> <span class="n">AsyncLazy</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n">Lazy</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;(</span><span class="n">Func</span><span class="p">&lt;</span><span class="n">UniTask</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;&gt;</span> <span class="n">factory</span><span class="p">)</span>
</code></pre></div></div>

<p><code>AsyncLazy</code>は<code>awaitable</code>なので、そのまま<code>await</code>することができます。<br>
もし<code>UniTask</code>に変換したい場合は<code>AsyncLazy.Task</code>を使いましょう。</p>

<div class="code-frame" data-lang="cs"><div class="highlight"><pre class="with-code"><code><span class="kt">var</span> <span class="n">asyncLazy</span> <span class="p">=</span> <span class="n">UniTask</span><span class="p">.</span><span class="nf">Lazy</span><span class="p">(</span><span class="n">Factory</span><span class="p">);</span>
<span class="k">await</span> <span class="n">asyncLazy</span><span class="p">;</span> <span class="c1">// 直接待てる</span>
<span class="k">await</span> <span class="n">asyncLazy</span><span class="p">.</span><span class="n">Task</span><span class="p">;</span> <span class="c1">// UniTaskに変換</span>

<span class="c1">// UniTask.Lazyの結果は何回awaitしてもOK</span>
</code></pre></div></div>

<h2>
<span id="unitaskwhenanyの戻り値変更" class="fragment"></span><a href="#unitaskwhenany%E3%81%AE%E6%88%BB%E3%82%8A%E5%80%A4%E5%A4%89%E6%9B%B4"><i class="fa fa-link"></i></a>UniTask.WhenAnyの戻り値変更</h2>

<p><code>WhenAny</code>の戻り値も変更されました。</p>

<div class="code-frame" data-lang="cs">
<div class="code-lang"><span class="bold">旧</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">static</span> <span class="k">async</span> <span class="n">UniTask</span><span class="p">&lt;(</span><span class="kt">int</span> <span class="n">winArgumentIndex</span><span class="p">,</span> <span class="p">(</span><span class="kt">bool</span> <span class="n">hasResult</span><span class="p">,</span> <span class="n">T0</span> <span class="n">result0</span><span class="p">),</span> <span class="p">(</span><span class="kt">bool</span> <span class="n">hasResult</span><span class="p">,</span> <span class="n">T1</span> <span class="n">result1</span><span class="p">),</span> <span class="p">(</span><span class="kt">bool</span> <span class="n">asResult</span><span class="p">,</span> <span class="n">T2</span> <span class="n">result2</span><span class="p">))&gt;</span> 
<span class="n">WhenAny</span><span class="p">&lt;</span><span class="n">T0</span><span class="p">,</span> <span class="n">T1</span><span class="p">,</span> <span class="n">T2</span><span class="p">&gt;()</span>
</code></pre></div>
</div>

<div class="code-frame" data-lang="cs">
<div class="code-lang"><span class="bold">新</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">static</span> <span class="n">UniTask</span><span class="p">&lt;(</span><span class="kt">int</span> <span class="n">winArgumentIndex</span><span class="p">,</span> <span class="n">T1</span> <span class="n">result1</span><span class="p">,</span> <span class="n">T2</span> <span class="n">result2</span><span class="p">,</span> <span class="n">T3</span> <span class="n">result3</span><span class="p">)&gt;</span> <span class="n">WhenAny</span><span class="p">&lt;</span><span class="n">T1</span><span class="p">,</span> <span class="n">T2</span><span class="p">,</span> <span class="n">T3</span><span class="p">&gt;()</span>
</code></pre></div>
</div>

<h2>
<span id="unitaskdelayframeの戻り値変更" class="fragment"></span><a href="#unitaskdelayframe%E3%81%AE%E6%88%BB%E3%82%8A%E5%80%A4%E5%A4%89%E6%9B%B4"><i class="fa fa-link"></i></a>UniTask.DelayFrameの戻り値変更</h2>

<p><code>UniTask.DelayFrame</code>の戻り値が<code>UniTask&lt;int&gt;</code>から<code>UniTask</code>に変更されました。</p>

<h2>
<span id="iobservabletounitaskの引数の順序が変更" class="fragment"></span><a href="#iobservabletounitask%E3%81%AE%E5%BC%95%E6%95%B0%E3%81%AE%E9%A0%86%E5%BA%8F%E3%81%8C%E5%A4%89%E6%9B%B4"><i class="fa fa-link"></i></a>IObservable.ToUniTask()の引数の順序が変更</h2>

<p><code>CancellationToken, bool useFirstValue</code> の順序が <code>bool useFirstValue, CancellationToken</code>と逆になりました。</p>

<div class="code-frame" data-lang="cs">
<div class="code-lang"><span class="bold">旧</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">static</span> <span class="n">UniTask</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n">ToUniTask</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;(</span><span class="k">this</span> <span class="n">IObservable</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n">source</span><span class="p">,</span> <span class="n">CancellationToken</span> <span class="n">cancellationToken</span> <span class="p">=</span> <span class="k">default</span><span class="p">(</span><span class="n">CancellationToken</span><span class="p">),</span> <span class="kt">bool</span> <span class="n">useFirstValue</span> <span class="p">=</span> <span class="k">false</span><span class="p">)</span>
</code></pre></div>
</div>

<div class="code-frame" data-lang="cs">
<div class="code-lang"><span class="bold">新</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">static</span> <span class="n">UniTask</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n">ToUniTask</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;(</span><span class="k">this</span> <span class="n">IObservable</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n">source</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">useFirstValue</span> <span class="p">=</span> <span class="k">false</span><span class="p">,</span> <span class="n">CancellationToken</span> <span class="n">cancellationToken</span> <span class="p">=</span> <span class="k">default</span><span class="p">)</span>
</code></pre></div>
</div>

<h2>
<span id="unitaskresultiscompletedが削除" class="fragment"></span><a href="#unitaskresultiscompleted%E3%81%8C%E5%89%8A%E9%99%A4"><i class="fa fa-link"></i></a>UniTask.Result/IsCompletedが削除</h2>

<p><code>UniTask</code>から同期的に結果を取得する<code>Result</code>プロパティが削除されました。<br>
あと完了したかを表す<code>IsCompleted</code>も削除されました。</p>

<p>もし同等の機能が必要な場合は<code>GetAwaiter()</code>を経由することで一応取得はできます。</p>

<div class="code-frame" data-lang="cs"><div class="highlight"><pre class="with-code"><code><span class="c1">// uniTask.Result相当</span>
<span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="n">uniTask</span><span class="p">.</span><span class="nf">GetAwaiter</span><span class="p">().</span><span class="nf">GetResult</span><span class="p">();</span>

<span class="c1">// IsCompleted相当</span>
<span class="kt">var</span> <span class="n">isCompleted</span> <span class="p">=</span> <span class="n">uniTask</span><span class="p">.</span><span class="nf">GetAwaiter</span><span class="p">().</span><span class="n">IsCompleted</span><span class="p">;</span>
</code></pre></div></div>

<h2>
<span id="awaiterstatus---unitaskstatus" class="fragment"></span><a href="#awaiterstatus---unitaskstatus"><i class="fa fa-link"></i></a>AwaiterStatus -&gt; UniTaskStatus</h2>

<p><code>UniTask</code>の状態を表す<code>enum</code>の名前が<code>AwaiterStatus</code>から<code>UniTaskStatus</code>に変わりました。</p>

<h1>
<span id="既存機能への追加機能とか" class="fragment"></span><a href="#%E6%97%A2%E5%AD%98%E6%A9%9F%E8%83%BD%E3%81%B8%E3%81%AE%E8%BF%BD%E5%8A%A0%E6%A9%9F%E8%83%BD%E3%81%A8%E3%81%8B"><i class="fa fa-link"></i></a>既存機能への追加機能とか</h1>

<h2>
<span id="全体的なパフォーマンスの向上" class="fragment"></span><a href="#%E5%85%A8%E4%BD%93%E7%9A%84%E3%81%AA%E3%83%91%E3%83%95%E3%82%A9%E3%83%BC%E3%83%9E%E3%83%B3%E3%82%B9%E3%81%AE%E5%90%91%E4%B8%8A"><i class="fa fa-link"></i></a>全体的なパフォーマンスの向上</h2>

<p>全体的にパフォーマンスが向上しています。<br>
内部で<code>UniTask</code>と<code>AsyncMethodBuilder</code>、<code>Runner</code>の再利用が自動的に行われるようになり、ゼロアロケーションで動作するようになりました。</p>

<h2>
<span id="unitaskcompletionsource" class="fragment"></span><a href="#unitaskcompletionsource"><i class="fa fa-link"></i></a>UniTaskCompletionSource</h2>

<p><del><code>UniTaskCompletionSource</code>に<code>Reset()</code>メソッドが追加されました。<br>
こちらを利用することで<code>UniTaskCompletionSource</code>を再利用することができるようになりました。</del></p>

<p><code>UniTaskCompletionSource.Reset()</code>は<code>2.0.19</code>で廃止されました。<br>
かわりに<code>UniTaskCompletionSource</code>の挙動が<code>TaskCompletionSource</code>に揃えられました。</p>

<p>すなわち<strong>UniTaskCompletionSourceから生成したUniTaskは何回でもawaitができる</strong>という仕様に変更されました。<br>
（<code>UniTaskCompletionSource</code>をフィールドに定義して、そこから生成した<code>UniTask</code>をプロパティとして公開しても問題なくなった）</p>

<h2>
<span id="autoresetunitaskcompletionsource追加" class="fragment"></span><a href="#autoresetunitaskcompletionsource%E8%BF%BD%E5%8A%A0"><i class="fa fa-link"></i></a>AutoResetUniTaskCompletionSource追加</h2>

<p><code>AutoResetUniTaskCompletionSource</code>も追加されました。<br>
こちらは<code>UniTaskCompletionSource</code>と挙動は同じですが、破棄したときに内部のインスタンスが自動的に再利用される仕組みになっています。</p>

<p>なお、こちらから生成した<code>UniTask</code>は1回しか<code>await</code>できません。<br>
メソッド内で<code>UniTask</code>を生成する、みたいな局所的な場所で<code>UniTaskCompletionSource</code>を生成してすぐ使い捨てるみたいな場合はこちらを使ったほうがよいでしょう。</p>

<h2>
<span id="ファクトリメソッドが追加" class="fragment"></span><a href="#%E3%83%95%E3%82%A1%E3%82%AF%E3%83%88%E3%83%AA%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%8C%E8%BF%BD%E5%8A%A0"><i class="fa fa-link"></i></a>ファクトリメソッドが追加</h2>

<p>ファクトリメソッドがいくつか追加されました。</p>

<ul>
<li>UniTask.Create</li>
<li>UniTask.Defer</li>
<li>UniTask.Action</li>
<li>UniTask.UnityAction</li>
<li>UniTask.WaitUntilCanceled</li>
<li>UniTask.NextFrame</li>
<li>UniTask.WaitForEndOfFrame</li>
<li>UniTask.WaitForFixedUpdate</li>
</ul>

<h3>
<span id="unitaskcreate-unitaskdefer-unitaskdelay" class="fragment"></span><a href="#unitaskcreate-unitaskdefer-unitaskdelay"><i class="fa fa-link"></i></a>UniTask.Create, UniTask.Defer, UniTask.Delay</h3>

<p><code>UniTask</code>をデリゲートから生成するファクトリメソッドとして、次の3つがあります。</p>

<ul>
<li>UniTask.Create</li>
<li>UniTask.Defer</li>
<li>UniTask.Lazy</li>
</ul>

<div class="code-frame" data-lang="cs"><div class="highlight"><pre class="with-code"><code><span class="c1">// 引数が同じで挙動も似てる3つのファクトリメソッド</span>
<span class="k">public</span> <span class="k">static</span> <span class="n">UniTask</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n">Create</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;(</span><span class="n">Func</span><span class="p">&lt;</span><span class="n">UniTask</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;&gt;</span> <span class="n">factory</span><span class="p">)</span>
<span class="k">public</span> <span class="k">static</span> <span class="n">UniTask</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n">Defer</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;(</span><span class="n">Func</span><span class="p">&lt;</span><span class="n">UniTask</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;&gt;</span> <span class="n">factory</span><span class="p">)</span>
<span class="k">public</span> <span class="k">static</span> <span class="n">AsyncLazy</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n">Lazy</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;(</span><span class="n">Func</span><span class="p">&lt;</span><span class="n">UniTask</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;&gt;</span> <span class="n">factory</span><span class="p">)</span>
</code></pre></div></div>

<p>これら3つは引数がどれも同じですが、微妙に挙動に違いがあります。</p>

<table>
<thead>
<tr>
<th style="text-align: left">名前</th>
<th style="text-align: left">効果</th>
<th style="text-align: left">備考</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left">UniTask.Create</td>
<td style="text-align: left">メソッドが呼び出されたタイミングで新しい<code>UniTask</code>を<strong>即座に</strong>生成する</td>
<td style="text-align: left">
<code>Create()</code>を呼んだ瞬間に<code>UniTask</code>が起動する。</td>
</tr>
<tr>
<td style="text-align: left">UniTask.Defer</td>
<td style="text-align: left">
<code>await</code>されるタイミングまで<code>UniTask</code>の生成を遅延させる</td>
<td style="text-align: left">1回しか<code>await</code>できない代わりに<code>Lazy</code>より軽量。</td>
</tr>
<tr>
<td style="text-align: left">UniTask.Lazy</td>
<td style="text-align: left">最初に<code>await</code>されるタイミングまで<code>UniTask</code>の生成を遅延させる</td>
<td style="text-align: left">生成されるものは<code>AsyncLazy</code>。<code>AsyncLazy.Task</code>は何回でも<code>await</code>できる。<code>Defer</code>よりはコストが大きい。</td>
</tr>
</tbody>
</table>

<p><code>Defer</code>と<code>Lazy</code>の違いは直接<code>UniTask</code>を生成するか、<code>AsyncLazy</code>を生成するかの違いです。</p>

<p><code>Defer</code>から生成される<code>UniTask</code>は2回<code>await</code>できません。<br>
<code>Lazy</code>から生成される<code>UniTask</code>(<code>AsyncLazy.UniTask</code>)は何回でも<code>await</code>が可能です。</p>

<p><code>Lazy</code>と比べて<code>Defer</code>の方がより軽量になっています。<br>
そのため<code>await</code>回数が1度のみなら<code>Defer</code>を使いましょう。</p>

<p>一方で何度も<code>await</code>する必要がある場合は<code>Lazy</code>を使いましょう。</p>

<h2>
<span id="playerlooptiming追加" class="fragment"></span><a href="#playerlooptiming%E8%BF%BD%E5%8A%A0"><i class="fa fa-link"></i></a>PlayerLoopTiming追加</h2>

<p><code>PlayerLoopTiming</code>が追加され、次の種類となりました。</p>

<ul>
<li>Initialization</li>
<li>LastInitialization</li>
<li>EarlyUpdate </li>
<li>LastEarlyUpdate</li>
<li>FixedUpdate</li>
<li>LastFixedUpdate</li>
<li>PreUpdate</li>
<li>LastPreUpdate</li>
<li>Update</li>
<li>LastUpdate</li>
<li>PreLateUpdate</li>
<li>LastPreLateUpdate</li>
<li>PostLateUpdate</li>
<li>LastPostLateUpdate</li>
</ul>

<p>とくに<strong>LastPostLateUpdate</strong>が重要で、こちらはコルーチンにおける<code>WaitForEndOfFrame</code>に相当します。<br>
いままで<code>UniTask</code>では<code>yield return new WaitForEndOfFrame()</code>ができなかったのですが、今回のアップデートから可能となりました。</p>

<h2>
<span id="jobhandlewaitasync" class="fragment"></span><a href="#jobhandlewaitasync"><i class="fa fa-link"></i></a>JobHandle.WaitAsync</h2>

<p><code>JobSystem</code>の<code>JobHandle</code>に<code>WaitAsync</code>が追加されました。<br>
こちらを利用することで、任意の<code>PlayerLoop</code>のタイミングに切り替えてから完了待ちができます。</p>

<div class="code-frame" data-lang="cs"><div class="highlight"><pre class="with-code"><code><span class="c1">// WaitForEndOfFrame相当の待機をしてからComplete()</span>
<span class="k">await</span> <span class="n">jobHandle</span><span class="p">.</span><span class="nf">WaitAsync</span><span class="p">(</span><span class="n">PlayerLoopTiming</span><span class="p">.</span><span class="n">LastPostLateUpdate</span><span class="p">);</span>
</code></pre></div></div>

<h2>
<span id="asynctriggerメソッドのiunitaskasyncenumerable対応" class="fragment"></span><a href="#asynctrigger%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%AEiunitaskasyncenumerable%E5%AF%BE%E5%BF%9C"><i class="fa fa-link"></i></a>AsyncTriggerメソッドのIUniTaskAsyncEnumerable対応</h2>

<p><code>AsyncTrigger</code>系のメソッド(<code>this.GetAsyncCollisionEnterTrigger</code>とか)が<code>IUniTaskAsyncEnumerable</code>に対応しました。</p>

<h2>
<span id="cancellationtokenwaituntilcanceled" class="fragment"></span><a href="#cancellationtokenwaituntilcanceled"><i class="fa fa-link"></i></a><code>CancellationToken.WaitUntilCanceled</code>
</h2>

<p><code>CancellationToken.WaitUntilCanceled</code>という拡張メソッドが追加されました。<br>
これを用いると、<code>CancellationToken</code>が完了するのを<code>await</code>できるようになります。</p>

<div class="code-frame" data-lang="cs"><div class="highlight"><pre class="with-code"><code><span class="k">private</span> <span class="k">void</span> <span class="nf">Start</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">token</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">GetCancellationTokenOnDestroy</span><span class="p">();</span>
    <span class="nf">WaitForCanceledAsync</span><span class="p">(</span><span class="n">token</span><span class="p">).</span><span class="nf">Forget</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">private</span> <span class="k">async</span> <span class="n">UniTaskVoid</span> <span class="nf">WaitForCanceledAsync</span><span class="p">(</span><span class="n">CancellationToken</span> <span class="n">token</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">await</span> <span class="n">token</span><span class="p">.</span><span class="nf">WaitUntilCanceled</span><span class="p">();</span>
    <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">"Canceled!"</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<h2>
<span id="cancellationtokentounitask" class="fragment"></span><a href="#cancellationtokentounitask"><i class="fa fa-link"></i></a><code>CancellationToken.ToUniTask</code>
</h2>

<p>同様に、<code>CancellationToken.ToUniTask</code>で<code>UniTask</code>を生成することもできます。<br>
この<code>UniTask</code>は<code>CancellationToken</code>がキャンセルされると正常終了（<code>Succeeded</code>）状態となります。</p>

<h2>
<span id="dotweenのawaitに対応" class="fragment"></span><a href="#dotween%E3%81%AEawait%E3%81%AB%E5%AF%BE%E5%BF%9C"><i class="fa fa-link"></i></a>DoTweenのawaitに対応</h2>

<p><code>DoTween</code>の<code>await</code>にも対応しました。</p>

<p>ただし動作させるためには次の設定が必要です。</p>

<ul>
<li>OpenUPMからDOTweenを導入する、またはScripting Define Symbolsに「UNITASK_DOTWEEN_SUPPORT」を定義する</li>
<li>asmdef「<code>UniTask.DOTweeen</code>」への参照を追加する</li>
</ul>

<div class="code-frame" data-lang="cs"><div class="highlight"><pre class="with-code"><code><span class="k">private</span> <span class="k">void</span> <span class="nf">Start</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nf">MoveAsync</span><span class="p">().</span><span class="nf">Forget</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">private</span> <span class="k">async</span> <span class="n">UniTaskVoid</span> <span class="nf">MoveAsync</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// 直列実行</span>
    <span class="k">await</span> <span class="n">transform</span><span class="p">.</span><span class="nf">DOMove</span><span class="p">(</span><span class="n">transform</span><span class="p">.</span><span class="n">position</span> <span class="p">+</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">up</span><span class="p">,</span> <span class="m">1.0f</span><span class="p">);</span>
    <span class="k">await</span> <span class="n">transform</span><span class="p">.</span><span class="nf">DOScale</span><span class="p">(</span><span class="n">Vector3</span><span class="p">.</span><span class="n">one</span> <span class="p">*</span> <span class="m">2.0f</span><span class="p">,</span> <span class="m">1.0f</span><span class="p">);</span>

    <span class="c1">// UniTask.WhenAllで並行実行して終了待機</span>
    <span class="k">await</span>
    <span class="p">(</span>
        <span class="n">transform</span><span class="p">.</span><span class="nf">DOMove</span><span class="p">(</span><span class="n">Vector3</span><span class="p">.</span><span class="n">zero</span><span class="p">,</span> <span class="m">1.0f</span><span class="p">).</span><span class="nf">ToUniTask</span><span class="p">(),</span>
        <span class="n">transform</span><span class="p">.</span><span class="nf">DOScale</span><span class="p">(</span><span class="n">Vector3</span><span class="p">.</span><span class="n">one</span><span class="p">,</span> <span class="m">1.0f</span><span class="p">).</span><span class="nf">ToUniTask</span><span class="p">()</span>
    <span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<h2>
<span id="addressable-asset-systemのawaitに対応" class="fragment"></span><a href="#addressable-asset-system%E3%81%AEawait%E3%81%AB%E5%AF%BE%E5%BF%9C"><i class="fa fa-link"></i></a>Addressable Asset Systemのawaitに対応</h2>

<p><code>AsyncOperationHandle</code>の<code>await</code>も可能になりました。</p>

<div class="code-frame" data-lang="cs"><div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">System.Threading</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Cysharp.Threading.Tasks</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">UnityEngine.AddressableAssets</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">UnityEngine.UI</span><span class="p">;</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">AsyncOperationHandleAwaitSample</span> <span class="p">:</span> <span class="n">MonoBehaviour</span>
<span class="p">{</span>
    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">/// 読み込む対象のAssetReference</span>
    <span class="c1">/// &lt;/summary&gt;</span>
    <span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span> <span class="n">AssetReference</span> <span class="n">_target</span><span class="p">;</span>

    <span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span> <span class="k">private</span> <span class="n">RawImage</span> <span class="n">_image</span><span class="p">;</span>

    <span class="k">private</span> <span class="k">void</span> <span class="nf">Start</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">token</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">GetCancellationTokenOnDestroy</span><span class="p">();</span>
        <span class="nf">InitializeAsync</span><span class="p">(</span><span class="n">_target</span><span class="p">,</span> <span class="n">token</span><span class="p">).</span><span class="nf">Forget</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">async</span> <span class="n">UniTaskVoid</span> <span class="nf">InitializeAsync</span><span class="p">(</span>
        <span class="n">AssetReference</span> <span class="n">target</span><span class="p">,</span>
        <span class="n">CancellationToken</span> <span class="n">token</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Addressables.LoadAssetAsyncをawaitで待ち受ける</span>
        <span class="kt">var</span> <span class="n">texture</span> <span class="p">=</span> <span class="k">await</span> <span class="n">Addressables</span><span class="p">.</span><span class="n">LoadAssetAsync</span><span class="p">&lt;</span><span class="n">Texture</span><span class="p">&gt;(</span><span class="n">target</span><span class="p">)</span>
            <span class="p">.</span><span class="nf">WithCancellation</span><span class="p">(</span><span class="n">token</span><span class="p">);</span>

        <span class="n">_image</span><span class="p">.</span><span class="n">texture</span> <span class="p">=</span> <span class="n">texture</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2>
<span id="idisposableaddtocancellationtoken" class="fragment"></span><a href="#idisposableaddtocancellationtoken"><i class="fa fa-link"></i></a>IDisposable.AddTo(CancellationToken)</h2>

<p><code>UniRx</code>で便利だった<code>AddTo</code>の<code>CancellationToken</code>版も追加されました。</p>

<h1>
<span id="新機能" class="fragment"></span><a href="#%E6%96%B0%E6%A9%9F%E8%83%BD"><i class="fa fa-link"></i></a>新機能</h1>

<h2>
<span id="unitaskasyncenumerableiunitaskasyncenumerable" class="fragment"></span><a href="#unitaskasyncenumerableiunitaskasyncenumerable"><i class="fa fa-link"></i></a>UniTaskAsyncEnumerable/IUniTaskAsyncEnumerable</h2>

<p><code>UniTaskAsyncEnumerable</code>は<code>UniTask2</code>の目玉機能です。</p>

<p><code>IUniTaskAsyncEnumerable&lt;T&gt;</code>は<code>C# 8.0</code>の<code>IAsyncEnumerable&lt;T&gt;</code>を<code>UniTask</code>として実装したものです。<br>
なんとこちらは<strong>C# 7.x系のUnityでも利用可能</strong>になっています。</p>

<p>何をするためのものかというと、「<strong>非同期処理を複数個まとめて扱う</strong>」ことができるようになる機能です。<br>
<code>Observable</code>（<code>IObservable&lt;T&gt;</code>）と似ていますが、こちらは<code>Pull</code>型として機能するという違いがあります。</p>

<p><a href="https://camo.qiitausercontent.com/4e5a452a872f86d46faf92fded06785c6c4ac775/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f34373134362f64623637656366652d393865352d356561662d633066382d3863623437656531303265662e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F47146%2Fdb67ecfe-98e5-5eaf-c0f8-8cb47ee102ef.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=ff54c63fbc6737cddadf145cc367eec1" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/47146/db67ecfe-98e5-5eaf-c0f8-8cb47ee102ef.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F47146%2Fdb67ecfe-98e5-5eaf-c0f8-8cb47ee102ef.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=d673271e627dbc183120f475bca40a6f 1x" loading="lazy"></a></p>

<h3>
<span id="observableとの使い分け" class="fragment"></span><a href="#observable%E3%81%A8%E3%81%AE%E4%BD%BF%E3%81%84%E5%88%86%E3%81%91"><i class="fa fa-link"></i></a>Observableとの使い分け</h3>

<p><code>Observable</code>は<code>Push</code>型なのに対して、<code>UniTaskAsyncEnumerable</code>は<code>Pull</code>型です。<br>
そのため<code>UniTaskAsyncEnumerable</code>では非同期処理の実行タイミングを受信側でコントロールできるというメリットがあります。</p>

<div class="code-frame" data-lang="cs">
<div class="code-lang"><span class="bold">UniTaskAsyncEnumerableで複数の非同期処理を扱う</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">private</span> <span class="k">async</span> <span class="k">void</span> <span class="nf">Start</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">token</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">GetCancellationTokenOnDestroy</span><span class="p">();</span>

    <span class="kt">var</span> <span class="n">uris</span> <span class="p">=</span> <span class="k">new</span><span class="p">[]</span>
    <span class="p">{</span>
        <span class="s">"https://www.google.com/"</span><span class="p">,</span>
        <span class="s">"https://unity.com/ja"</span><span class="p">,</span>
        <span class="s">"https://github.com/"</span>
    <span class="p">};</span>


    <span class="c1">// URIのリストに対してアクセスしてデータをとってくる</span>
    <span class="c1">// ただし常に実行される通信は同時に1つであり、</span>
    <span class="c1">// 前回のものが完了しないと次の通信に進まない</span>
    <span class="k">await</span> <span class="n">uris</span><span class="p">.</span><span class="nf">ToUniTaskAsyncEnumerable</span><span class="p">()</span>
        <span class="c1">// 通信完了を待機してメッセージを発行する</span>
        <span class="p">.</span><span class="nf">SelectAwait</span><span class="p">(</span><span class="k">async</span> <span class="n">x</span> <span class="p">=&gt;</span> <span class="k">await</span> <span class="nf">FetchAsync</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="p">.</span><span class="nf">ForEachAsync</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">token</span><span class="p">);</span>
<span class="p">}</span>


<span class="k">private</span> <span class="k">async</span> <span class="n">UniTask</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="nf">FetchAsync</span><span class="p">(</span><span class="kt">string</span> <span class="n">uri</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">uwr</span> <span class="p">=</span> <span class="n">UnityWebRequest</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="n">uri</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="k">await</span> <span class="n">uwr</span><span class="p">.</span><span class="nf">SendWebRequest</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">uwr</span><span class="p">.</span><span class="n">isNetworkError</span> <span class="p">||</span> <span class="n">uwr</span><span class="p">.</span><span class="n">isHttpError</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">Exception</span><span class="p">(</span><span class="s">$"Error&gt;</span><span class="p">{</span><span class="n">uwr</span><span class="p">.</span><span class="n">error</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">uwr</span><span class="p">.</span><span class="n">downloadHandler</span><span class="p">.</span><span class="n">text</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>対する<code>Observable</code>は<code>Push</code>型のため、多数の<code>Observer</code>に対してメッセージをブロードキャストするのに向いています。</p>

<p>複数個の非同期処理を管理する場合は基本には<code>UniTaskAsyncEnumerable</code>を使う。<br>
イベント駆動を制御する場合には<code>Observable</code>を使う。</p>

<p>という使い方をするとよいでしょう。</p>

<h3>
<span id="unitaskasyncenumerableの消費" class="fragment"></span><a href="#unitaskasyncenumerable%E3%81%AE%E6%B6%88%E8%B2%BB"><i class="fa fa-link"></i></a>UniTaskAsyncEnumerableの消費</h3>

<h4>
<span id="foreachasync" class="fragment"></span><a href="#foreachasync"><i class="fa fa-link"></i></a>ForEachAsync</h4>

<p><code>C# 8.0</code>であれば<code>await foreach</code>が使えるのですが、それが使えないUnityバージョンでは代替として<code>ForEachAsync</code>を利用します。<br>
感覚としては、<code>IObservable&lt;T&gt;</code>に対する<code>Subscribe()</code>に似ています。<br>
ですがこちらは「<code>ForEachAsync()</code>の完了をさらに<code>await</code>で待つ」といったことが可能となります。</p>

<div class="code-frame" data-lang="cs">
<div class="code-lang"><span class="bold">ForEachAsync</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">private</span> <span class="k">async</span> <span class="k">void</span> <span class="nf">Start</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">token</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">GetCancellationTokenOnDestroy</span><span class="p">();</span>

    <span class="c1">// EveryUpdate()は毎フレームのタイミングで完了するUniTaskを返す</span>
    <span class="k">await</span> <span class="n">UniTaskAsyncEnumerable</span><span class="p">.</span><span class="nf">EveryUpdate</span><span class="p">()</span>
        <span class="p">.</span><span class="nf">Select</span><span class="p">((</span><span class="n">_</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">)</span>
        <span class="c1">// 5回まで実行する</span>
        <span class="p">.</span><span class="nf">Take</span><span class="p">(</span><span class="m">5</span><span class="p">)</span>
        <span class="c1">// ForEachAsyncで待機する</span>
        <span class="p">.</span><span class="nf">ForEachAsync</span><span class="p">(</span><span class="n">_</span> <span class="p">=&gt;</span> <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="n">Time</span><span class="p">.</span><span class="n">frameCount</span><span class="p">),</span> <span class="n">token</span><span class="p">);</span>

    <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">"Done!"</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</div>

<h4>
<span id="foreachawaitasync" class="fragment"></span><a href="#foreachawaitasync"><i class="fa fa-link"></i></a>ForEachAwaitAsync</h4>

<p>また、<code>ForEachAsync</code>の他に<code>ForEachAwaitAsync</code>もあります。<br>
こちらはデリゲートの内部で<code>async/await</code>が利用でき、この非同期処理が完了するまで次のメッセージを取りに行きません。</p>

<div class="code-frame" data-lang="cs">
<div class="code-lang"><span class="bold">ForEachAwaitAsync</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">await</span> <span class="n">UniTaskAsyncEnumerable</span><span class="p">.</span><span class="nf">EveryUpdate</span><span class="p">()</span>
    <span class="p">.</span><span class="nf">Select</span><span class="p">((</span><span class="n">_</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">)</span>
    <span class="c1">// 5回まで実行する</span>
    <span class="p">.</span><span class="nf">Take</span><span class="p">(</span><span class="m">5</span><span class="p">)</span>
    <span class="c1">// ForEachAwaitAsyncで待機する</span>
    <span class="p">.</span><span class="nf">ForEachAwaitAsync</span><span class="p">(</span><span class="k">async</span> <span class="n">_</span> <span class="p">=&gt;</span>
    <span class="p">{</span>
        <span class="c1">// 10フレーム待ってから次のメッセージを取りに行く</span>
        <span class="k">await</span> <span class="n">UniTask</span><span class="p">.</span><span class="nf">DelayFrame</span><span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="n">cancellationToken</span><span class="p">:</span> <span class="n">token</span><span class="p">);</span>
    <span class="p">},</span> <span class="n">token</span><span class="p">);</span>
</code></pre></div>
</div>

<h4>
<span id="subscribe" class="fragment"></span><a href="#subscribe"><i class="fa fa-link"></i></a>Subscribe</h4>

<p>また、<code>Subscribe</code>というメソッドも用意されています。<br>
こちらは<code>IObservable.Subscribe()</code>と似た感覚で利用できます。</p>

<p>なお、こちらはデリゲート内部で<code>async/await</code>が利用できますが、<strong>その結果を待機しません(Forgetする）</strong>。</p>

<div class="code-frame" data-lang="cs"><div class="highlight"><pre class="with-code"><code><span class="kt">var</span> <span class="n">token</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">GetCancellationTokenOnDestroy</span><span class="p">();</span>
<span class="n">UniTaskAsyncEnumerable</span><span class="p">.</span><span class="nf">EveryUpdate</span><span class="p">()</span>
    <span class="p">.</span><span class="nf">Select</span><span class="p">((</span><span class="n">_</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">Take</span><span class="p">(</span><span class="m">5</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">Subscribe</span><span class="p">(</span><span class="k">async</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">ct</span><span class="p">)</span> <span class="p">=&gt;</span>
    <span class="p">{</span>
        <span class="k">await</span> <span class="n">UniTask</span><span class="p">.</span><span class="nf">Delay</span><span class="p">(</span><span class="m">100</span><span class="p">,</span> <span class="n">cancellationToken</span><span class="p">:</span> <span class="n">ct</span><span class="p">);</span>
        <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">"Do!"</span><span class="p">);</span>
    <span class="p">},</span> <span class="n">token</span><span class="p">);</span>
</code></pre></div></div>

<h4>
<span id="foreachasyncforeachawaitasyncsubscribeの違い" class="fragment"></span><a href="#foreachasyncforeachawaitasyncsubscribe%E3%81%AE%E9%81%95%E3%81%84"><i class="fa fa-link"></i></a>ForEachAsync/ForEachAwaitAsync/Subscribeの違い</h4>

<p>それぞれの大きな違いは登録したデリゲートの呼び出し方にあります。<br>
<code>ForEachAwaitAsync</code>と<code>Subscribe</code>は非同期処理を用いたときに挙動が異なるので注意が必要です。</p>

<div class="code-frame" data-lang="cs">
<div class="code-lang"><span class="bold">ForEachAsync</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">while</span> <span class="p">(</span><span class="k">await</span> <span class="n">e</span><span class="p">.</span><span class="nf">MoveNextAsync</span><span class="p">())</span>
<span class="p">{</span>
    <span class="nf">action</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">Current</span><span class="p">);</span> <span class="c1">// 常に同期</span>
<span class="p">}</span>
</code></pre></div>
</div>

<div class="code-frame" data-lang="cs">
<div class="code-lang"><span class="bold">ForEachAwaitAsync</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">while</span> <span class="p">(</span><span class="k">await</span> <span class="n">e</span><span class="p">.</span><span class="nf">MoveNextAsync</span><span class="p">())</span>
<span class="p">{</span>
    <span class="k">await</span> <span class="nf">action</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">Current</span><span class="p">);</span> <span class="c1">// awaitしてから次へいく</span>
<span class="p">}</span>
</code></pre></div>
</div>

<div class="code-frame" data-lang="cs">
<div class="code-lang"><span class="bold">Subscribe</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">while</span> <span class="p">(</span><span class="k">await</span> <span class="n">e</span><span class="p">.</span><span class="nf">MoveNextAsync</span><span class="p">())</span>
<span class="p">{</span>
    <span class="nf">action</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">Current</span><span class="p">).</span><span class="nf">Forget</span><span class="p">();</span> <span class="c1">// Forget()して次へいく</span>
<span class="p">}</span>
</code></pre></div>
</div>

<h3>
<span id="unitaskasyncenumerableの作り方" class="fragment"></span><a href="#unitaskasyncenumerable%E3%81%AE%E4%BD%9C%E3%82%8A%E6%96%B9"><i class="fa fa-link"></i></a>UniTaskAsyncEnumerableの作り方</h3>

<p><code>UniTaskAsyncEnumerable</code>はさまざまな方法で生成することができます。</p>

<h4>
<span id="ファクトリメソッド" class="fragment"></span><a href="#%E3%83%95%E3%82%A1%E3%82%AF%E3%83%88%E3%83%AA%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89"><i class="fa fa-link"></i></a>ファクトリメソッド</h4>

<ul>
<li>Return</li>
<li>Repeat</li>
<li>Empty</li>
<li>Throw</li>
<li>Never</li>
<li>Range</li>
<li>EveryUpdate</li>
<li>Timer</li>
<li>TimerFrame</li>
<li>Interval</li>
<li>IntervalFrame</li>
<li>EveryValueChanged</li>
</ul>

<h5>
<span id="unitaskasyncenumerablecreate" class="fragment"></span><a href="#unitaskasyncenumerablecreate"><i class="fa fa-link"></i></a>UniTaskAsyncEnumerable.Create</h5>

<p>C#8の非同期イテレータに相当するものとして、<code>UniTaskAsyncEnumerable.Create</code>があります。</p>

<div class="code-frame" data-lang="cs"><div class="highlight"><pre class="with-code"><code><span class="c1">// 整数のカウントダウン</span>
<span class="k">private</span> <span class="n">IUniTaskAsyncEnumerable</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="nf">CountDownAsync</span><span class="p">(</span><span class="kt">int</span> <span class="n">startCount</span><span class="p">,</span> <span class="n">TimeSpan</span> <span class="n">timeSpan</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">UniTaskAsyncEnumerable</span><span class="p">.</span><span class="n">Create</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;(</span><span class="k">async</span> <span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">token</span><span class="p">)</span> <span class="p">=&gt;</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">currentCount</span> <span class="p">=</span> <span class="n">startCount</span><span class="p">;</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">currentCount</span> <span class="p">&gt;=</span> <span class="m">0</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// writer.YieldAsync を使うと UniTaskAsyncEnumerable に値が書き込まれる</span>
            <span class="k">await</span> <span class="n">writer</span><span class="p">.</span><span class="nf">YieldAsync</span><span class="p">(</span><span class="n">currentCount</span><span class="p">--);</span>
            <span class="k">await</span> <span class="n">UniTask</span><span class="p">.</span><span class="nf">Delay</span><span class="p">(</span><span class="n">timeSpan</span><span class="p">,</span> <span class="n">cancellationToken</span><span class="p">:</span> <span class="n">token</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">}</span>
</code></pre></div></div>

<h4>
<span id="他のデータ構造から変換" class="fragment"></span><a href="#%E4%BB%96%E3%81%AE%E3%83%87%E3%83%BC%E3%82%BF%E6%A7%8B%E9%80%A0%E3%81%8B%E3%82%89%E5%A4%89%E6%8F%9B"><i class="fa fa-link"></i></a>他のデータ構造から変換</h4>

<ul>
<li><code>IEnumerable&lt;T&gt;</code></li>
<li><code>IObservable&lt;T&gt;</code></li>
<li><code>Task&lt;T&gt;</code></li>
<li><code>UniTaskT&gt;</code></li>
</ul>

<h4>
<span id="uguiコンポーネントから変換" class="fragment"></span><a href="#ugui%E3%82%B3%E3%83%B3%E3%83%9D%E3%83%BC%E3%83%8D%E3%83%B3%E3%83%88%E3%81%8B%E3%82%89%E5%A4%89%E6%8F%9B"><i class="fa fa-link"></i></a>uGUIコンポーネントから変換</h4>

<div class="code-frame" data-lang="cs">
<div class="code-lang"><span class="bold">uGUIイベントからの変換</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">FromUGui</span> <span class="p">:</span> <span class="n">MonoBehaviour</span>
<span class="p">{</span>
    <span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span> <span class="k">private</span> <span class="n">Button</span> <span class="n">_button</span><span class="p">;</span>

    <span class="k">private</span> <span class="k">void</span> <span class="nf">Start</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">token</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">GetCancellationTokenOnDestroy</span><span class="p">();</span>

        <span class="c1">// 連打防止ボタン</span>
        <span class="c1">// 1回ボタンを押したら2秒間無反応になる</span>
        <span class="n">_button</span><span class="p">.</span><span class="nf">OnClickAsAsyncEnumerable</span><span class="p">()</span>
            <span class="p">.</span><span class="nf">ForEachAwaitWithCancellationAsync</span><span class="p">(</span><span class="k">async</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">ct</span><span class="p">)</span> <span class="p">=&gt;</span>
            <span class="p">{</span>
                <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">"Clicked!"</span><span class="p">);</span>
                <span class="k">await</span> <span class="n">UniTask</span><span class="p">.</span><span class="nf">Delay</span><span class="p">(</span><span class="m">2000</span><span class="p">,</span> <span class="n">cancellationToken</span><span class="p">:</span> <span class="n">ct</span><span class="p">);</span>
            <span class="p">},</span> <span class="n">token</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<h4>
<span id="asynctriggerを利用する" class="fragment"></span><a href="#asynctrigger%E3%82%92%E5%88%A9%E7%94%A8%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>AsyncTriggerを利用する</h4>

<p><code>this.GetAsyncCollisionEnterTrigger()</code>など。</p>

<h4>
<span id="channel" class="fragment"></span><a href="#channel"><i class="fa fa-link"></i></a>Channel</h4>

<p><code>Channel</code>は<code>Go</code>における<code>Channel</code>と同義です。<br>
挙動としては<code>Observable</code>における<code>Subject</code>に相当します。</p>

<p>実装としては<code>CreateSingleConsumerUnbounded</code>が用意されています。<br>
<code>CreateSingleConsumerUnbounded</code>は内部でメッセージをキューイングしているため、メッセージの取りこぼしは発生しません。</p>

<div class="code-frame" data-lang="cs">
<div class="code-lang"><span class="bold">Channelの例</span></div>
<div class="highlight"><pre class="with-code"><code> <span class="k">private</span> <span class="k">void</span> <span class="nf">Start</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// Channel作成</span>
    <span class="kt">var</span> <span class="n">channel</span> <span class="p">=</span> <span class="n">Channel</span><span class="p">.</span><span class="n">CreateSingleConsumerUnbounded</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;();</span>

    <span class="c1">// Channelを読み取るときはReaderを使う</span>
    <span class="kt">var</span> <span class="n">reader</span> <span class="p">=</span> <span class="n">channel</span><span class="p">.</span><span class="n">Reader</span><span class="p">;</span>

    <span class="c1">// メッセージの待受</span>
    <span class="nf">WaitForChannelAsync</span><span class="p">(</span><span class="n">reader</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nf">GetCancellationTokenOnDestroy</span><span class="p">()).</span><span class="nf">Forget</span><span class="p">();</span>

    <span class="c1">// 書き込むときはWriteを使う</span>
    <span class="kt">var</span> <span class="n">writer</span> <span class="p">=</span> <span class="n">channel</span><span class="p">.</span><span class="n">Writer</span><span class="p">;</span>

    <span class="c1">// IObserver&lt;T&gt;.OnNext() に相当</span>
    <span class="n">writer</span><span class="p">.</span><span class="nf">TryWrite</span><span class="p">(</span><span class="m">1</span><span class="p">);</span>
    <span class="n">writer</span><span class="p">.</span><span class="nf">TryWrite</span><span class="p">(</span><span class="m">2</span><span class="p">);</span>
    <span class="n">writer</span><span class="p">.</span><span class="nf">TryWrite</span><span class="p">(</span><span class="m">3</span><span class="p">);</span>

    <span class="c1">// IObserver&lt;T&gt;.OnCompleted() に相当</span>
    <span class="n">writer</span><span class="p">.</span><span class="nf">TryComplete</span><span class="p">();</span>

    <span class="c1">// TryComplete()に例外を渡すと IObserver&lt;T&gt;.OnError() に相当</span>
    <span class="c1">// writer.TryComplete(new Exception(""));</span>
<span class="p">}</span>

<span class="k">private</span> <span class="k">async</span> <span class="n">UniTaskVoid</span> <span class="nf">WaitForChannelAsync</span><span class="p">(</span><span class="n">ChannelReader</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">reader</span><span class="p">,</span> <span class="n">CancellationToken</span> <span class="n">token</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">try</span>
    <span class="p">{</span>
        <span class="c1">// 1回だけ読み取るならReadAsync</span>
        <span class="kt">var</span> <span class="n">result1</span> <span class="p">=</span> <span class="k">await</span> <span class="n">reader</span><span class="p">.</span><span class="nf">ReadAsync</span><span class="p">(</span><span class="n">token</span><span class="p">);</span> <span class="c1">// UniTask&lt;int&gt;</span>
        <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="n">result1</span><span class="p">);</span>

        <span class="c1">// 完了するまで読み続けるなら　ReadAllAsync</span>
        <span class="c1">// IObservable&lt;T&gt;.Subscribe() に相当</span>
        <span class="k">await</span> <span class="n">reader</span><span class="p">.</span><span class="nf">ReadAllAsync</span><span class="p">()</span> <span class="c1">// IUniTaskAsyncEnumerable&lt;int&gt;</span>
            <span class="p">.</span><span class="nf">ForEachAsync</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">token</span><span class="p">);</span>

        <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">"Done"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Debug</span><span class="p">.</span><span class="nf">LogException</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>なお、<code>CreateSingleConsumerUnbounded</code>は同時に１箇所でしかメッセージの消費が行なえません。<br>
2箇所以上で<code>ForEachAsync</code>等を行った場合は正しく動作しません。</p>

<p>もし2箇所以上で消費したい（値を分配したい）場合は<code>Publish()</code>を利用しましょう。</p>

<div class="code-frame" data-lang="cs"><div class="highlight"><pre class="with-code"><code><span class="k">private</span> <span class="k">void</span> <span class="nf">Start</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// Channel作成</span>
    <span class="kt">var</span> <span class="n">channel</span> <span class="p">=</span> <span class="n">Channel</span><span class="p">.</span><span class="n">CreateSingleConsumerUnbounded</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;();</span>

    <span class="c1">// ReadAsync + Publish で何回も待受可能になる</span>
    <span class="kt">var</span> <span class="n">connectable</span> <span class="p">=</span> <span class="n">channel</span><span class="p">.</span><span class="n">Reader</span><span class="p">.</span><span class="nf">ReadAllAsync</span><span class="p">().</span><span class="nf">Publish</span><span class="p">();</span>

    <span class="k">using</span> <span class="p">(</span><span class="n">connectable</span><span class="p">.</span><span class="nf">Connect</span><span class="p">())</span>
    <span class="p">{</span>
        <span class="c1">// 複数回待受</span>
        <span class="nf">WaitForChannelAsync</span><span class="p">(</span><span class="n">connectable</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nf">GetCancellationTokenOnDestroy</span><span class="p">()).</span><span class="nf">Forget</span><span class="p">();</span>
        <span class="nf">WaitForChannelAsync</span><span class="p">(</span><span class="n">connectable</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nf">GetCancellationTokenOnDestroy</span><span class="p">()).</span><span class="nf">Forget</span><span class="p">();</span>
        <span class="nf">WaitForChannelAsync</span><span class="p">(</span><span class="n">connectable</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nf">GetCancellationTokenOnDestroy</span><span class="p">()).</span><span class="nf">Forget</span><span class="p">();</span>

        <span class="kt">var</span> <span class="n">writer</span> <span class="p">=</span> <span class="n">channel</span><span class="p">.</span><span class="n">Writer</span><span class="p">;</span>

        <span class="n">writer</span><span class="p">.</span><span class="nf">TryWrite</span><span class="p">(</span><span class="m">1</span><span class="p">);</span>
        <span class="n">writer</span><span class="p">.</span><span class="nf">TryWrite</span><span class="p">(</span><span class="m">2</span><span class="p">);</span>
        <span class="n">writer</span><span class="p">.</span><span class="nf">TryWrite</span><span class="p">(</span><span class="m">3</span><span class="p">);</span>
        <span class="n">writer</span><span class="p">.</span><span class="nf">Complete</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2>
<span id="asyncreactiveproperty" class="fragment"></span><a href="#asyncreactiveproperty"><i class="fa fa-link"></i></a>AsyncReactiveProperty</h2>

<p><code>AsyncReactiveProperty</code>は<code>UniRx</code>の<code>ReactiveProperty</code>の<code>UniTask</code>版です。<br>
ベースとして<code>IUniTaskAsyncEnumerable&lt;T&gt;</code>が利用されています。<br>
（<code>ReactiveProperty</code>はベースが<code>IObservable&lt;T&gt;</code>）</p>

<p>基本的な使い方は<code>ReactiveProperty</code>と変わりません。</p>

<div class="code-frame" data-lang="cs">
<div class="code-lang"><span class="bold">AsyncReactiveProperty</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">private</span> <span class="k">void</span> <span class="nf">Start</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">token</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">GetCancellationTokenOnDestroy</span><span class="p">();</span>

    <span class="c1">// AsyncReactiveProperty生成</span>
    <span class="kt">var</span> <span class="n">asyncReactiveProperty</span> <span class="p">=</span> <span class="k">new</span> <span class="n">AsyncReactiveProperty</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;(</span><span class="k">null</span><span class="p">);</span>

    <span class="c1">// 待受開始</span>
    <span class="nf">WaitForAsync</span><span class="p">(</span><span class="n">asyncReactiveProperty</span><span class="p">,</span> <span class="n">token</span><span class="p">).</span><span class="nf">Forget</span><span class="p">();</span>

    <span class="c1">// Valueプロパティに値をセットすると</span>
    <span class="c1">// MoveNextAsync() が次に進む</span>
    <span class="n">asyncReactiveProperty</span><span class="p">.</span><span class="n">Value</span> <span class="p">=</span> <span class="s">"Hello!"</span><span class="p">;</span>

    <span class="c1">// Dispose()するとこのAsyncReactivePropertyが完了する</span>
    <span class="n">asyncReactiveProperty</span><span class="p">.</span><span class="nf">Dispose</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">private</span> <span class="k">async</span> <span class="n">UniTaskVoid</span> <span class="nf">WaitForAsync</span><span class="p">(</span>
    <span class="n">IReadOnlyAsyncReactiveProperty</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">asyncReadOnlyReactiveProperty</span><span class="p">,</span>
    <span class="n">CancellationToken</span> <span class="n">token</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Valueプロパティで現在値を取得可能</span>
    <span class="kt">var</span> <span class="n">current</span> <span class="p">=</span> <span class="n">asyncReadOnlyReactiveProperty</span><span class="p">.</span><span class="n">Value</span><span class="p">;</span>
    <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="n">current</span><span class="p">);</span>

    <span class="c1">// IUniTaskAsyncEnumerable&lt;T&gt;として扱える</span>
    <span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="k">await</span> <span class="n">asyncReadOnlyReactiveProperty</span>
        <span class="c1">// null以外の値がセットされるのを待つ</span>
        <span class="p">.</span><span class="nf">FirstOrDefaultAsync</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span> <span class="p">!=</span> <span class="k">null</span><span class="p">,</span> <span class="n">cancellationToken</span><span class="p">:</span> <span class="n">token</span><span class="p">);</span>

    <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</div>

<h3>
<span id="unirxreactivepropertyとasyncreactivepropertyの使い分け" class="fragment"></span><a href="#unirxreactiveproperty%E3%81%A8asyncreactiveproperty%E3%81%AE%E4%BD%BF%E3%81%84%E5%88%86%E3%81%91"><i class="fa fa-link"></i></a>UniRx.ReactivePropertyとAsyncReactivePropertyの使い分け</h3>

<p>結論から先にいうと次になります。</p>

<ul>
<li>イベントメッセージの通知として使う方が多いなら <code>UniRx.ReactiveProperty</code> を使う</li>
<li>
<code>await</code>で変化を待ち受けることの方が多いなら <code>AsyncReactiveProperty</code> を使う</li>
</ul>

<hr>

<p><code>UniRx.ReactiveProperty</code>と<code>AsyncReactiveProperty</code>はそれぞれ次の点が異なります。</p>

<table>
<thead>
<tr>
<th style="text-align: left"></th>
<th style="text-align: left"><code>UniRx.ReactiveProperty&lt;T&gt;</code></th>
<th style="text-align: left"><code>AsyncReactiveProperty&lt;T&gt;</code></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left">ベースの型</td>
<td style="text-align: left"><code>IObservable&lt;T&gt;</code></td>
<td style="text-align: left"><code>IUniTaskAsyncEnumerable&lt;T&gt;</code></td>
</tr>
<tr>
<td style="text-align: left">ふるまい</td>
<td style="text-align: left"><code>Push</code></td>
<td style="text-align: left"><code>Pull</code></td>
</tr>
<tr>
<td style="text-align: left">直接<code>await</code>した時の挙動</td>
<td style="text-align: left">次の値に更新されるまで待つ（現在値は無視）</td>
<td style="text-align: left">
<code>WaitAsync</code>または<code>UniTask.Linq</code>を経由する必要あり</td>
</tr>
<tr>
<td style="text-align: left">Operator/LINQをつないだときの挙動</td>
<td style="text-align: left">
<code>IObservable&lt;T&gt;</code>扱いになるので、<code>ToUniTask()</code>などが必要</td>
<td style="text-align: left">
<code>LINQ</code>の挙動による</td>
</tr>
<tr>
<td style="text-align: left">得意なこと</td>
<td style="text-align: left">メッセージのブロードキャスト</td>
<td style="text-align: left">条件を指定しての柔軟な<code>await</code>
</td>
</tr>
</tbody>
</table>

<p><code>UniRx.ReactiveProperty&lt;T&gt;</code>は直接<code>await</code>できますが、そのときの挙動がコントロールできません。<br>
たとえば「特定のパラメータに変化するまで待つ」といったことがしたい場合、<code>Operator</code>を経由する必要があります。</p>

<p>ただ<code>Operator</code>を使ってしまうと<code>IObservable&lt;T&gt;</code>に対する<code>await</code>になるため、取り扱いが面倒くさいことになります。</p>

<div class="code-frame" data-lang="cs">
<div class="code-lang"><span class="bold">UniRx.ReactivePropertyのawait</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">private</span> <span class="k">async</span> <span class="n">UniTaskVoid</span> <span class="nf">WaitForPropertyAsync</span><span class="p">(</span><span class="n">ReactiveProperty</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">p</span><span class="p">,</span> <span class="n">CancellationToken</span> <span class="n">ct</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// IObservableに対するawaitになる</span>
    <span class="c1">// CancellationTokenを指定するにはToUniTaskが必要でいろいろめんどくさい</span>
    <span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="k">await</span> <span class="n">p</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span> <span class="p">==</span> <span class="m">10</span><span class="p">).</span><span class="nf">ToUniTask</span><span class="p">(</span><span class="n">useFirstValue</span><span class="p">:</span> <span class="k">true</span><span class="p">,</span> <span class="n">ct</span><span class="p">);</span>
    <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p><code>UniRx.ReactiveProperty&lt;T&gt;</code>は<code>await</code>とは相性があまり良くないですが、複数の購読者に対して一斉にメッセージを送ることについては抜群に得意です。</p>

<hr>

<p>一方の<code>AsyncReactiveProperty&lt;T&gt;</code>は<code>IUniTaskAsyncEnumerable&lt;T&gt;</code>ベースのため、<code>await</code>と非常に相性がよいです。<br>
素直にそのまま書くことができ、<code>CancellationToken</code>の指定も簡単です。</p>

<div class="code-frame" data-lang="cs"><div class="highlight"><pre class="with-code"><code><span class="k">private</span> <span class="k">async</span> <span class="n">UniTaskVoid</span> <span class="nf">WaitForPropertyAsync</span><span class="p">(</span><span class="n">AsyncReactiveProperty</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">p</span><span class="p">,</span> <span class="n">CancellationToken</span> <span class="n">ct</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// そのままLINQを書いてawaitできる</span>
    <span class="c1">// CancellationTokenも渡しやすい</span>
    <span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="k">await</span> <span class="n">p</span><span class="p">.</span><span class="nf">FirstAsync</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span> <span class="p">==</span> <span class="m">10</span><span class="p">,</span> <span class="n">ct</span><span class="p">);</span>

    <span class="c1">// 非同期処理を間で挟むこともできる</span>
    <span class="k">await</span> <span class="n">p</span>
        <span class="p">.</span><span class="nf">SelectAwaitWithCancellation</span><span class="p">(</span><span class="k">async</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span> <span class="p">=&gt;</span>
        <span class="p">{</span>
            <span class="c1">// 与えられた値のミリ秒分だけ待つ（何がしたいんだこの例）</span>
            <span class="k">await</span> <span class="n">UniTask</span><span class="p">.</span><span class="nf">Delay</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">cancellationToken</span><span class="p">:</span> <span class="n">t</span><span class="p">);</span>
            <span class="k">return</span> <span class="n">x</span><span class="p">;</span>
        <span class="p">})</span>
        <span class="p">.</span><span class="nf">FirstAsync</span><span class="p">(</span><span class="n">cancellationToken</span><span class="p">:</span> <span class="n">ct</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>ただし<code>AsyncReactiveProperty&lt;T&gt;</code>は<code>await</code>のタイミングによっては値の取りこぼしが発生してしまいます。<br>
そのため確実にメッセージをブロードキャストして相手に確実に届けるという用途には向いていません。<br>
（その点は<code>UniRx.ReactiveProperty&lt;T&gt;</code>のほうが有利です）</p>

<div class="code-frame" data-lang="cs">
<div class="code-lang"><span class="bold">取りこぼしが起きる例</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">private</span> <span class="k">async</span> <span class="n">UniTaskVoid</span> <span class="nf">WaitForPropertyAsync</span><span class="p">(</span><span class="n">AsyncReactiveProperty</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">p</span><span class="p">,</span> <span class="n">CancellationToken</span> <span class="n">ct</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// UniRxのSubscribe感覚でForEachAwaitAsyncを使うと</span>
    <span class="c1">// メッセージの取りこぼしが起きうる</span>
    <span class="k">await</span> <span class="n">p</span><span class="p">.</span><span class="nf">ForEachAwaitWithCancellationAsync</span><span class="p">(</span><span class="k">async</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ct</span><span class="p">)</span> <span class="p">=&gt;</span>
    <span class="p">{</span>
        <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
        <span class="c1">// 1秒待ってから次の値を取りに行く</span>
        <span class="c1">// このawait中に変動した値は取りこぼす</span>
        <span class="k">await</span> <span class="n">UniTask</span><span class="p">.</span><span class="nf">Delay</span><span class="p">(</span><span class="m">1000</span><span class="p">,</span> <span class="n">cancellationToken</span><span class="p">:</span> <span class="n">ct</span><span class="p">);</span>
    <span class="p">},</span> <span class="n">ct</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>取りこぼしの防止策として、後述する<code>Queue()</code>を使う方法もあります。</p>

<h2>
<span id="unitasklinq" class="fragment"></span><a href="#unitasklinq"><i class="fa fa-link"></i></a>UniTask.Linq</h2>

<p><code>IUniTaskAsyncEnumerable&lt;T&gt;</code>には<code>LINQ</code>メソッドが用意されています。<br>
利用するためにはasmdef「<code>UniTask.Linq</code>」への参照を追加する必要があります。</p>

<p>使えるメソッドは次です。</p>

<h3>
<span id="同期型" class="fragment"></span><a href="#%E5%90%8C%E6%9C%9F%E5%9E%8B"><i class="fa fa-link"></i></a>同期型</h3>

<ul>
<li>AggregateAsync</li>
<li>AllAsync</li>
<li>AnyAsync</li>
<li>AsUniTaskAsyncEnumerable</li>
<li>AverageAsync</li>
<li>Buffer</li>
<li>Append</li>
<li>Prepend</li>
<li>Cast</li>
<li>Concat</li>
<li>ContainsAsync</li>
<li>CountAsync</li>
<li>DefaultIfEmpty</li>
<li>Distinct</li>
<li>DistinctUntilChanged</li>
<li>Do</li>
<li>ElementAtAsync</li>
<li>ElementAtOrDefaultAsync</li>
<li>Except</li>
<li>FirstAsync</li>
<li>FirstOrDefaultAsync</li>
<li>ForEachAsync</li>
<li>GroupBy</li>
<li>GroupJoin</li>
<li>Intersect</li>
<li>Join</li>
<li>LastAsync</li>
<li>LastOrDefaultAsync</li>
<li>LongCountAsync</li>
<li>MaxAsync</li>
<li>MinAsync</li>
<li>OfType</li>
<li>OrderBy</li>
<li>OrderByDescending</li>
<li>Reverse</li>
<li>Select</li>
<li>SelectMany</li>
<li>SequenceEqualAsync</li>
<li>SingleAsync</li>
<li>SingleOrDefaultAsync</li>
<li>Skip</li>
<li>SkipLast</li>
<li>SkipWhile</li>
<li>SkipUntil</li>
<li>SumAsync</li>
<li>Take</li>
<li>TakeLast</li>
<li>TakeWhile</li>
<li>TakeUntil</li>
<li>ToArrayAsync</li>
<li>ToDictionaryAsync</li>
<li>ToHashSetAsync</li>
<li>ToListAsync</li>
<li>ToLookupAsync</li>
<li>ToObservable</li>
<li>Union</li>
<li>Where</li>
<li>Zip</li>
<li>CombineLatest</li>
<li>Pairwise</li>
<li>Queue</li>
<li>SkipUntilCanceled</li>
<li>TakeUntilCanceled</li>
<li>Publish</li>
</ul>

<h3>
<span id="非同期型" class="fragment"></span><a href="#%E9%9D%9E%E5%90%8C%E6%9C%9F%E5%9E%8B"><i class="fa fa-link"></i></a>非同期型</h3>

<p><code>AwaitAsync</code>がついているものは<code>async/await</code>を内部で利用できます。</p>

<ul>
<li>AggregateAwaitAsync</li>
<li>AllAwaitAsync</li>
<li>AnyAwaitAsync</li>
<li>AverageAwaitAsync</li>
<li>CountAwaitAsync</li>
<li>DistinctAwait</li>
<li>DistinctUntilChangedAwait</li>
<li>DoAwait</li>
<li>FirstAwaitAsync</li>
<li>FirstOrDefaultAwaitAsync</li>
<li>ForEachAwaitAsync</li>
<li>GroupByAwait</li>
<li>GroupJoinAwait</li>
<li>JoinAwait</li>
<li>LastAwaitAsync</li>
<li>LastOrDefaultAwaitAsync</li>
<li>LongCountAwaitAsync</li>
<li>MaxAwaitAsync</li>
<li>MinAwaitAsync</li>
<li>OrderByAwait</li>
<li>OrderByDescendingAwait</li>
<li>SelectAwait</li>
<li>SelectManyAwait</li>
<li>SingleAwaitAsync</li>
<li>SingleOrDefaultAwaitAsync</li>
<li>SkipWhileAwait</li>
<li>SumAwaitAsync</li>
<li>TakeWhileAwait</li>
<li>ToDictionaryAwaitAsync</li>
<li>ToLookupAwaitAsync</li>
<li>WhereAwait</li>
<li>ZipAwait</li>
</ul>

<p>こちらは<code>CancellationToken</code>を内部で必要とするときに使います。</p>

<ul>
<li>AggregateAwaitWithCancellationAsync</li>
<li>AnyAwaitWithCancellationAsync</li>
<li>AverageAwaitWithCancellationAsync</li>
<li>CountAwaitWithCancellationAsync</li>
<li>DistinctAwaitWithCancellation</li>
<li>DistinctUntilChangedAwaitWithCancellation</li>
<li>DoAwaitWithCancellation</li>
<li>FirstAwaitWithCancellationAsync</li>
<li>FirstOrDefaultAwaitWithCancellationAsync</li>
<li>ForEachAwaitWithCancellationAsync</li>
<li>GroupByAwaitWithCancellation</li>
<li>GroupJoinAwaitWithCancellation</li>
<li>JoinAwaitWithCancellation</li>
<li>LastAwaitWithCancellationAsync</li>
<li>LastOrDefaultAwaitWithCancellationAsync</li>
<li>LongCountAwaitWithCancellationAsync</li>
<li>MaxAwaitWithCancellationAsync</li>
<li>MinAwaitWithCancellationAsync</li>
<li>OrderByAwaitWithCancellation</li>
<li>OrderByDescendingAwaitWithCancellation</li>
<li>SelectAwaitWithCancellation</li>
<li>SelectManyAwaitWithCancellation</li>
<li>SingleAwaitWithCancellationAsync</li>
<li>SingleOrDefaultAwaitWithCancellationAsync</li>
<li>SkipWhileAwaitWithCancellation</li>
<li>SumAwaitWithCancellationAsync</li>
<li>TakeWhileAwaitWithCancellation</li>
<li>ToDictionaryAwaitWithCancellationAsync</li>
<li>ToLookupAwaitWithCancellationAsync</li>
<li>WhereAwaitWithCancellation</li>
<li>ZipAwaitWithCancellation</li>
</ul>

<h2>
<span id="補足-pushベースのunitaskasyncenumerableの注意点" class="fragment"></span><a href="#%E8%A3%9C%E8%B6%B3-push%E3%83%99%E3%83%BC%E3%82%B9%E3%81%AEunitaskasyncenumerable%E3%81%AE%E6%B3%A8%E6%84%8F%E7%82%B9"><i class="fa fa-link"></i></a>補足: Pushベースの<code>UniTaskAsyncEnumerable</code>の注意点</h2>

<p><code>IUniTaskAsyncEnumerable&lt;T&gt;</code>は<code>Pull</code>型として動作します。<br>
そのためメッセージの受信準備が整い、内部でイテレータの<code>MoveNextAsync()</code>が実行されたタイミングで次のメッセージを取りに行きます。</p>

<p>ですが、<code>UniTaskAsyncEnumerable</code>ではメッセージ発行が<code>Push</code>な<code>IUniTaskAsyncEnumerable&lt;T&gt;</code>も存在します（ややこしい）</p>

<ul>
<li><code>UniTask.EveryUpdate()</code></li>
<li><code>AsyncReactiveProperty</code></li>
<li>
<code>AsyncTrigger</code>より生成したもの</li>
<li>
<code>uGUI</code>のイベントなどから変換したもの</li>
</ul>

<p>これらは<code>Push</code>されてきたイベントを<code>IUniTaskAsyncEnumerable&lt;T&gt;</code>として提供します。<br>
そのため<code>MoveNextAsync()</code>とタイミングが合わなかった場合は、<strong>その間に発行されたイベントは取りこぼされる</strong>という点に注意が必要です。</p>

<p><a href="https://camo.qiitausercontent.com/25f596e3e2878da62adec35a6ee0c0b42aea320e/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f34373134362f36343534306333362d306361382d666336362d333239362d6561383835353632666539382e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F47146%2F64540c36-0ca8-fc66-3296-ea885562fe98.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=9b127e5103e57b60c7e6e6dd416c684b" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/47146/64540c36-0ca8-fc66-3296-ea885562fe98.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F47146%2F64540c36-0ca8-fc66-3296-ea885562fe98.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=e783d92c7ab451f37c08ae1c685a6907 1x" loading="lazy"></a></p>

<p>逆に、このイベントの取りこぼしを利用して処理を組むこともできます。</p>

<div class="code-frame" data-lang="cs">
<div class="code-lang"><span class="bold">イベントの取りこぼしを利用した例</span></div>
<div class="highlight"><pre class="with-code"><code><span class="c1">// uGUIのボタンの連打防止</span>
<span class="c1">// 1回ボタンを押したら2秒間無反応になる</span>

<span class="c1">// ForEachAwaitAsyncが待機中に発行されたメッセージは無視するという</span>
<span class="c1">// 性質を利用している</span>
<span class="n">_button</span><span class="p">.</span><span class="nf">OnClickAsAsyncEnumerable</span><span class="p">()</span>
    <span class="p">.</span><span class="nf">ForEachAwaitWithCancellationAsync</span><span class="p">(</span><span class="k">async</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">ct</span><span class="p">)</span> <span class="p">=&gt;</span>
    <span class="p">{</span>
        <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">"Clicked!"</span><span class="p">);</span>
        <span class="k">await</span> <span class="n">UniTask</span><span class="p">.</span><span class="nf">Delay</span><span class="p">(</span><span class="m">2000</span><span class="p">,</span> <span class="n">cancellationToken</span><span class="p">:</span> <span class="n">ct</span><span class="p">);</span>
    <span class="p">},</span> <span class="n">token</span><span class="p">);</span>
</code></pre></div>
</div>

<h3>
<span id="取りこぼしが嫌なら-queue-を使おう" class="fragment"></span><a href="#%E5%8F%96%E3%82%8A%E3%81%93%E3%81%BC%E3%81%97%E3%81%8C%E5%AB%8C%E3%81%AA%E3%82%89-queue-%E3%82%92%E4%BD%BF%E3%81%8A%E3%81%86"><i class="fa fa-link"></i></a>取りこぼしが嫌なら Queue() を使おう</h3>

<p><code>Queue</code>は<code>UniTask.Linq</code>が提供する<code>LINQ</code>メソッドの1つです。</p>

<p><code>IUniTaskAsyncEnumerable&lt;T&gt;</code>に対して先に<code>MoveNextAsync()</code>を実行し、その結果をキューに詰めて再度<code>IUniTaskAsyncEnumerable&lt;T&gt;</code>として提供します。<br>
（<code>Observable</code>でいうところの<code>Publish()</code>に相当します）</p>

<p><code>Queue</code>を使えばイベントの取りこぼしを防ぐことができるため、必要に応じて利用しましょう。</p>

<div class="code-frame" data-lang="cs">
<div class="code-lang"><span class="bold">Queue</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">private</span> <span class="k">void</span> <span class="nf">Start</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">token</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">GetCancellationTokenOnDestroy</span><span class="p">();</span>

    <span class="c1">// AsyncReactiveProperty生成</span>
    <span class="kt">var</span> <span class="n">asyncReactiveProperty</span> <span class="p">=</span> <span class="k">new</span> <span class="n">AsyncReactiveProperty</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;(</span><span class="s">"Initialize!"</span><span class="p">);</span>

    <span class="c1">// 待受開始</span>
    <span class="nf">WaitForAsync</span><span class="p">(</span><span class="n">asyncReactiveProperty</span><span class="p">,</span> <span class="n">token</span><span class="p">).</span><span class="nf">Forget</span><span class="p">();</span>

    <span class="c1">// 値を設定</span>
    <span class="n">asyncReactiveProperty</span><span class="p">.</span><span class="n">Value</span> <span class="p">=</span> <span class="s">"Hello!"</span><span class="p">;</span>
    <span class="n">asyncReactiveProperty</span><span class="p">.</span><span class="n">Value</span> <span class="p">=</span> <span class="s">"World!"</span><span class="p">;</span>
    <span class="n">asyncReactiveProperty</span><span class="p">.</span><span class="n">Value</span> <span class="p">=</span> <span class="s">"Thank you!"</span><span class="p">;</span>

    <span class="n">asyncReactiveProperty</span><span class="p">.</span><span class="nf">Dispose</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">private</span> <span class="k">async</span> <span class="n">UniTaskVoid</span> <span class="nf">WaitForAsync</span><span class="p">(</span>
    <span class="n">IReadOnlyAsyncReactiveProperty</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">asyncReadOnlyReactiveProperty</span><span class="p">,</span>
    <span class="n">CancellationToken</span> <span class="n">token</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// AsyncReactiveProperty はキューイングしてくれないので</span>
    <span class="c1">// タイミングによってはメッセージの取りこぼしが置きうる</span>
    <span class="c1">// 取りこぼしが嫌ならQueueを併用する</span>
    <span class="k">await</span> <span class="n">asyncReadOnlyReactiveProperty</span>
        <span class="p">.</span><span class="nf">Queue</span><span class="p">()</span> <span class="c1">// Queueを挟む</span>
        <span class="p">.</span><span class="nf">ForEachAwaitWithCancellationAsync</span><span class="p">(</span><span class="k">async</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ct</span><span class="p">)</span> <span class="p">=&gt;</span>
        <span class="p">{</span>
            <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
            <span class="c1">// 1秒待って次の値を取りに行く</span>
            <span class="k">await</span> <span class="n">UniTask</span><span class="p">.</span><span class="nf">Delay</span><span class="p">(</span><span class="m">1000</span><span class="p">,</span> <span class="n">cancellationToken</span><span class="p">:</span> <span class="n">ct</span><span class="p">);</span>
        <span class="p">},</span> <span class="n">token</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</div>

<h1>
<span id="まとめ" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>まとめ</h1>

<h2>
<span id="unitask2の感想" class="fragment"></span><a href="#unitask2%E3%81%AE%E6%84%9F%E6%83%B3"><i class="fa fa-link"></i></a>UniTask2の感想</h2>

<p><code>C# 8.0</code>の<code>IAsyncEnumerable</code>相当の処理をいち早く<code>Unity</code>でも利用できるため、かなり期待が高いアップデートとなりました。<br>
<code>UniTaskAsyncEnumerable</code>と<code>AsyncReactiveProperty</code>が刺さる人にはかなり刺さる機能でしょう（自分はさっそく使いたい）</p>

<h2>
<span id="unirxobservableとの使い分け" class="fragment"></span><a href="#unirxobservable%E3%81%A8%E3%81%AE%E4%BD%BF%E3%81%84%E5%88%86%E3%81%91"><i class="fa fa-link"></i></a>UniRx（Observable）との使い分け</h2>

<p>ぶっちゃけ、<strong>非同期処理の用途としてUniRx（Observable）が選択肢に上がってくることがなくなりました。</strong><br>
<code>async/await</code> + <code>UniTask</code> / <code>UniTaskAsyncEnumerable</code> でほとんどの非同期処理のシチュエーションはカバーできてしまいます。</p>

<p>じゃあ<code>Observable</code>はお役御免かというとそうではなく、「イベント駆動」として使う方ではまだまだ活用が可能です。<br>
特にイベントメッセージが飛び交うゲーム開発では<code>Observable</code>が活躍するシチュエーションは多いでしょう。</p>

<p>とくに<code>ReactiveProperty</code>と<code>AsyncReactiveProperty</code>の使い分けが特に今後は重要になってくるかなと思います。</p>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2FtoRisouP%2Fitems%2F8f66fd952eaffeaf3107&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2FtoRisouP%2Fitems%2F8f66fd952eaffeaf3107&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/toRisouP/items/8f66fd952eaffeaf3107/likers" class="css-1iupg5d">114</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">83</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/8f66fd952eaffeaf3107/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/toRisouP/items/8f66fd952eaffeaf3107/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/toRisouP/items/8f66fd952eaffeaf3107/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/toRisouP/items/8f66fd952eaffeaf3107/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/toRisouP/items/8f66fd952eaffeaf3107.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-70bd68e5-2da4-4760-b5e3-237777fb1787">{"authorAnalyticsTrackingId":"UA-160669273-1","organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-a8fae6de-a39a-476b-9e89-35594dd7e22e"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-a8fae6de-a39a-476b-9e89-35594dd7e22e">{}</script>
      
<div id="LoginModal-react-component-cc7a721c-c7ff-42e1-adff-a1240cd78fb5"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-cc7a721c-c7ff-42e1-adff-a1240cd78fb5">{}</script>
      
<div id="StockModal-react-component-ff539389-245c-4508-b56d-fbff82b35997"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-ff539389-245c-4508-b56d-fbff82b35997">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;mVssno3babkpYAKHHjxWYs2uRubHbLqNLvRtlPNEKxGGoGA7mN4y9fhukSn4Z3tThouvxDfkvg0I8Ahtdb6CUQ==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\n\u003ch1\u003e\n\u003cspan id=\"他の資料\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BB%96%E3%81%AE%E8%B3%87%E6%96%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e他の資料\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"https://csharp-tokyo.connpass.com/event/175469/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eC# Tokyo オンライン「Unity 祭り」\u003c/a\u003eで登壇した資料も追加しておきます。あわせて御覧ください。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://speakerdeck.com/torisoup/unitask2020\" rel=\"nofollow noopener\" target=\"_blank\"\u003eUniTaskの使い方2020（スライド）\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://youtu.be/IcSl_7UENQ8\" rel=\"nofollow noopener\" target=\"_blank\"\u003e発表動画（YouTube）\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"unitask2\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#unitask2\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eUniTask2\u003c/h1\u003e\n\n\u003cp\u003e\u003ccode\u003eUniTask\u003c/code\u003eが大きくアップデートされて、Ver2となりました！\u003cbr\u003e\n今回はその変更点についてまとめてみました。\u003c/p\u003e\n\n\u003cp\u003e※ \u003ccode\u003eVer.2.0.25\u003c/code\u003e準拠で書いています。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"破壊的変更\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%A0%B4%E5%A3%8A%E7%9A%84%E5%A4%89%E6%9B%B4\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e破壊的変更\u003c/h1\u003e\n\n\u003cp\u003eまずは1系からの破壊的変更。導入時に気をつける必要があるところです。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"必要な最低unityバージョン\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%BF%85%E8%A6%81%E3%81%AA%E6%9C%80%E4%BD%8Eunity%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e必要な最低Unityバージョン\u003c/h2\u003e\n\n\u003cp\u003e\u003cstrong\u003e2018.4.13f1\u003c/strong\u003e が最低サポートバージョンとなりました。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"名前空間の変更\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%90%8D%E5%89%8D%E7%A9%BA%E9%96%93%E3%81%AE%E5%A4%89%E6%9B%B4\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e名前空間の変更\u003c/h2\u003e\n\n\u003cp\u003e名前空間が\u003ccode\u003eUniRx.Async\u003c/code\u003eから\u003ccode\u003eCysharp.Threading.Tasks\u003c/code\u003eに変更されました。\u003cbr\u003e\nもともと\u003ccode\u003eUniRx\u003c/code\u003eのライブラリの一部だった名残なのですが、今回のアップデートで完全に名残がなくなりました。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"unitaskのawait2度漬け禁止\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#unitask%E3%81%AEawait2%E5%BA%A6%E6%BC%AC%E3%81%91%E7%A6%81%E6%AD%A2\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eUniTaskのawait2度漬け禁止\u003c/h2\u003e\n\n\u003cp\u003e同じ\u003ccode\u003eUniTask\u003c/code\u003eに対しての2回以上の\u003ccode\u003eawait\u003c/code\u003eが明確に禁止となりました。\u003cbr\u003e\n\u003ccode\u003eIValueTaskSource\u003c/code\u003e準拠の挙動なので、これは本家\u003ccode\u003eValueTask\u003c/code\u003eと同じ挙動です。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eUniTaskの2回以上のawait禁止\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"n\"\u003eUniTaskVoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eDoAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eCancellationToken\u003c/span\u003e \u003cspan class=\"n\"\u003etoken\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003etry\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003euniTask\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"https://unity.com/ja\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etoken\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// 1回目のawaitは問題ない\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003euniTask\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// 同じオブジェクトに対して2回以上のawaitはできない\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// (InvalidOperationExceptionが発行される)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003euniTask\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ecatch\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eInvalidOperationException\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLogException\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"n\"\u003eUniTask\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003euri\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eCancellationToken\u003c/span\u003e \u003cspan class=\"n\"\u003etoken\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003euwr\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eUnityWebRequest\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGet\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003euri\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003euwr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSendWebRequest\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"nf\"\u003eWithCancellation\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etoken\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003euwr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edownloadHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"preserve\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#preserve\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ePreserve()\u003c/h3\u003e\n\n\u003cp\u003eもし同じ\u003ccode\u003eUniTask\u003c/code\u003eを2回以上\u003ccode\u003eawait\u003c/code\u003eする必要があるならば、\u003ccode\u003ePreserve()\u003c/code\u003eを利用しましょう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ePreserve()\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"n\"\u003eUniTaskVoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eDoAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eCancellationToken\u003c/span\u003e \u003cspan class=\"n\"\u003etoken\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003etry\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003euniTask\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"https://unity.com/ja\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etoken\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// Preserve()で何回でもawait可能なUniTaskに変換\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ereusable\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003euniTask\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ePreserve\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003ereusable\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003ereusable\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ecatch\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eInvalidOperationException\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLogException\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"asyncoperationをawaitするときのconfigureawait廃止\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#asyncoperation%E3%82%92await%E3%81%99%E3%82%8B%E3%81%A8%E3%81%8D%E3%81%AEconfigureawait%E5%BB%83%E6%AD%A2\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003eAsyncOperation\u003c/code\u003eを\u003ccode\u003eawait\u003c/code\u003eするときの\u003ccode\u003eConfigureAwait\u003c/code\u003e廃止\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003eAsyncOperation\u003c/code\u003eを\u003ccode\u003eawait\u003c/code\u003eするときに利用できていた\u003ccode\u003eConfigureAwait\u003c/code\u003eが廃止となりました。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eIProgress\u0026lt;float\u0026gt;\u003c/code\u003eや\u003ccode\u003eCancellationToken\u003c/code\u003eを指定したい場合は\u003ccode\u003eToUniTask()\u003c/code\u003eまたは\u003ccode\u003eWithCancellation()\u003c/code\u003eを利用する必要があります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"n\"\u003eUniTask\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003euri\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eCancellationToken\u003c/span\u003e \u003cspan class=\"n\"\u003etoken\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003euwr\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eUnityWebRequest\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGet\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003euri\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// CancellationTokenを指定\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003euwr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSendWebRequest\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"nf\"\u003eWithCancellation\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etoken\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003euwr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edownloadHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\n\u003cspan class=\"c1\"\u003e// IProgress\u0026lt;float\u0026gt;を指定したい場合（あとついでにCancellationToken）\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eurw2\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eUnityWebRequest\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGet\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"https://unity.com/ja\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eurw2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSendWebRequest\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToUniTask\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eProgress\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCreate\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003efloat\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e)),\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecancellationToken\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003etoken\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"unitaskの一部コンストラクタ廃止\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#unitask%E3%81%AE%E4%B8%80%E9%83%A8%E3%82%B3%E3%83%B3%E3%82%B9%E3%83%88%E3%83%A9%E3%82%AF%E3%82%BF%E5%BB%83%E6%AD%A2\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eUniTaskの一部コンストラクタ廃止\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003eUniTask\u003c/code\u003eの一部コンストラクタが廃止されました。\u003cbr\u003e\nこちらは\u003ccode\u003eUniTask\u003c/code\u003eの起動を遅延実行するために利用できたコンストラクタです。\u003cbr\u003e\n（\u003ccode\u003eUniTask.Lazy\u003c/code\u003eに相当していた）\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e廃止されたコンストラクタ\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eUniTask\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eFunc\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eUniTask\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003efactory\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eこれ相当のファクトリメソッドとして、\u003ccode\u003eUniTask.Defer\u003c/code\u003eと\u003ccode\u003eUniTask.Lazy\u003c/code\u003eがあるのでこちらを使いましょう。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"unitasklazyの戻り値の変更\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#unitasklazy%E3%81%AE%E6%88%BB%E3%82%8A%E5%80%A4%E3%81%AE%E5%A4%89%E6%9B%B4\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eUniTask.Lazyの戻り値の変更\u003c/h2\u003e\n\n\u003cp\u003e上記の多重\u003ccode\u003eawait\u003c/code\u003e禁止の変更をうけて、\u003ccode\u003eUniTask.Lazy\u003c/code\u003eの戻り値が\u003ccode\u003eAsyncLazy\u003c/code\u003eに変換されました。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eAsyncLazy\u003c/span\u003e \u003cspan class=\"nf\"\u003eLazy\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eFunc\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eUniTask\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003efactory\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eAsyncLazy\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eLazy\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"n\"\u003eFunc\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eUniTask\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003efactory\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003eAsyncLazy\u003c/code\u003eは\u003ccode\u003eawaitable\u003c/code\u003eなので、そのまま\u003ccode\u003eawait\u003c/code\u003eすることができます。\u003cbr\u003e\nもし\u003ccode\u003eUniTask\u003c/code\u003eに変換したい場合は\u003ccode\u003eAsyncLazy.Task\u003c/code\u003eを使いましょう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003easyncLazy\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eUniTask\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLazy\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eFactory\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003easyncLazy\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 直接待てる\u003c/span\u003e\n\u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003easyncLazy\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTask\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// UniTaskに変換\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// UniTask.Lazyの結果は何回awaitしてもOK\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"unitaskwhenanyの戻り値変更\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#unitaskwhenany%E3%81%AE%E6%88%BB%E3%82%8A%E5%80%A4%E5%A4%89%E6%9B%B4\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eUniTask.WhenAnyの戻り値変更\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003eWhenAny\u003c/code\u003eの戻り値も変更されました。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e旧\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"n\"\u003eUniTask\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ewinArgumentIndex\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003ehasResult\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eT0\u003c/span\u003e \u003cspan class=\"n\"\u003eresult0\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003ehasResult\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eT1\u003c/span\u003e \u003cspan class=\"n\"\u003eresult1\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003easResult\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eT2\u003c/span\u003e \u003cspan class=\"n\"\u003eresult2\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u0026gt;\u003c/span\u003e \n\u003cspan class=\"n\"\u003eWhenAny\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eT1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eT2\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;()\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e新\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eUniTask\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ewinArgumentIndex\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eT1\u003c/span\u003e \u003cspan class=\"n\"\u003eresult1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eT2\u003c/span\u003e \u003cspan class=\"n\"\u003eresult2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eT3\u003c/span\u003e \u003cspan class=\"n\"\u003eresult3\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eWhenAny\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eT2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eT3\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;()\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"unitaskdelayframeの戻り値変更\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#unitaskdelayframe%E3%81%AE%E6%88%BB%E3%82%8A%E5%80%A4%E5%A4%89%E6%9B%B4\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eUniTask.DelayFrameの戻り値変更\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003eUniTask.DelayFrame\u003c/code\u003eの戻り値が\u003ccode\u003eUniTask\u0026lt;int\u0026gt;\u003c/code\u003eから\u003ccode\u003eUniTask\u003c/code\u003eに変更されました。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"iobservabletounitaskの引数の順序が変更\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#iobservabletounitask%E3%81%AE%E5%BC%95%E6%95%B0%E3%81%AE%E9%A0%86%E5%BA%8F%E3%81%8C%E5%A4%89%E6%9B%B4\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eIObservable.ToUniTask()の引数の順序が変更\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003eCancellationToken, bool useFirstValue\u003c/code\u003e の順序が \u003ccode\u003ebool useFirstValue, CancellationToken\u003c/code\u003eと逆になりました。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e旧\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eUniTask\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eToUniTask\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e \u003cspan class=\"n\"\u003eIObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003esource\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eCancellationToken\u003c/span\u003e \u003cspan class=\"n\"\u003ecancellationToken\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003edefault\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eCancellationToken\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003euseFirstValue\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e新\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eUniTask\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eToUniTask\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e \u003cspan class=\"n\"\u003eIObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003esource\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003euseFirstValue\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eCancellationToken\u003c/span\u003e \u003cspan class=\"n\"\u003ecancellationToken\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003edefault\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"unitaskresultiscompletedが削除\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#unitaskresultiscompleted%E3%81%8C%E5%89%8A%E9%99%A4\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eUniTask.Result/IsCompletedが削除\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003eUniTask\u003c/code\u003eから同期的に結果を取得する\u003ccode\u003eResult\u003c/code\u003eプロパティが削除されました。\u003cbr\u003e\nあと完了したかを表す\u003ccode\u003eIsCompleted\u003c/code\u003eも削除されました。\u003c/p\u003e\n\n\u003cp\u003eもし同等の機能が必要な場合は\u003ccode\u003eGetAwaiter()\u003c/code\u003eを経由することで一応取得はできます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// uniTask.Result相当\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eresult\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003euniTask\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetAwaiter\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetResult\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// IsCompleted相当\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eisCompleted\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003euniTask\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetAwaiter\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"n\"\u003eIsCompleted\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"awaiterstatus---unitaskstatus\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#awaiterstatus---unitaskstatus\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eAwaiterStatus -\u0026gt; UniTaskStatus\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003eUniTask\u003c/code\u003eの状態を表す\u003ccode\u003eenum\u003c/code\u003eの名前が\u003ccode\u003eAwaiterStatus\u003c/code\u003eから\u003ccode\u003eUniTaskStatus\u003c/code\u003eに変わりました。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"既存機能への追加機能とか\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%97%A2%E5%AD%98%E6%A9%9F%E8%83%BD%E3%81%B8%E3%81%AE%E8%BF%BD%E5%8A%A0%E6%A9%9F%E8%83%BD%E3%81%A8%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e既存機能への追加機能とか\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"全体的なパフォーマンスの向上\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%85%A8%E4%BD%93%E7%9A%84%E3%81%AA%E3%83%91%E3%83%95%E3%82%A9%E3%83%BC%E3%83%9E%E3%83%B3%E3%82%B9%E3%81%AE%E5%90%91%E4%B8%8A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e全体的なパフォーマンスの向上\u003c/h2\u003e\n\n\u003cp\u003e全体的にパフォーマンスが向上しています。\u003cbr\u003e\n内部で\u003ccode\u003eUniTask\u003c/code\u003eと\u003ccode\u003eAsyncMethodBuilder\u003c/code\u003e、\u003ccode\u003eRunner\u003c/code\u003eの再利用が自動的に行われるようになり、ゼロアロケーションで動作するようになりました。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"unitaskcompletionsource\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#unitaskcompletionsource\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eUniTaskCompletionSource\u003c/h2\u003e\n\n\u003cp\u003e\u003cdel\u003e\u003ccode\u003eUniTaskCompletionSource\u003c/code\u003eに\u003ccode\u003eReset()\u003c/code\u003eメソッドが追加されました。\u003cbr\u003e\nこちらを利用することで\u003ccode\u003eUniTaskCompletionSource\u003c/code\u003eを再利用することができるようになりました。\u003c/del\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eUniTaskCompletionSource.Reset()\u003c/code\u003eは\u003ccode\u003e2.0.19\u003c/code\u003eで廃止されました。\u003cbr\u003e\nかわりに\u003ccode\u003eUniTaskCompletionSource\u003c/code\u003eの挙動が\u003ccode\u003eTaskCompletionSource\u003c/code\u003eに揃えられました。\u003c/p\u003e\n\n\u003cp\u003eすなわち\u003cstrong\u003eUniTaskCompletionSourceから生成したUniTaskは何回でもawaitができる\u003c/strong\u003eという仕様に変更されました。\u003cbr\u003e\n（\u003ccode\u003eUniTaskCompletionSource\u003c/code\u003eをフィールドに定義して、そこから生成した\u003ccode\u003eUniTask\u003c/code\u003eをプロパティとして公開しても問題なくなった）\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"autoresetunitaskcompletionsource追加\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#autoresetunitaskcompletionsource%E8%BF%BD%E5%8A%A0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eAutoResetUniTaskCompletionSource追加\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003eAutoResetUniTaskCompletionSource\u003c/code\u003eも追加されました。\u003cbr\u003e\nこちらは\u003ccode\u003eUniTaskCompletionSource\u003c/code\u003eと挙動は同じですが、破棄したときに内部のインスタンスが自動的に再利用される仕組みになっています。\u003c/p\u003e\n\n\u003cp\u003eなお、こちらから生成した\u003ccode\u003eUniTask\u003c/code\u003eは1回しか\u003ccode\u003eawait\u003c/code\u003eできません。\u003cbr\u003e\nメソッド内で\u003ccode\u003eUniTask\u003c/code\u003eを生成する、みたいな局所的な場所で\u003ccode\u003eUniTaskCompletionSource\u003c/code\u003eを生成してすぐ使い捨てるみたいな場合はこちらを使ったほうがよいでしょう。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ファクトリメソッドが追加\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%95%E3%82%A1%E3%82%AF%E3%83%88%E3%83%AA%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%8C%E8%BF%BD%E5%8A%A0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eファクトリメソッドが追加\u003c/h2\u003e\n\n\u003cp\u003eファクトリメソッドがいくつか追加されました。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eUniTask.Create\u003c/li\u003e\n\u003cli\u003eUniTask.Defer\u003c/li\u003e\n\u003cli\u003eUniTask.Action\u003c/li\u003e\n\u003cli\u003eUniTask.UnityAction\u003c/li\u003e\n\u003cli\u003eUniTask.WaitUntilCanceled\u003c/li\u003e\n\u003cli\u003eUniTask.NextFrame\u003c/li\u003e\n\u003cli\u003eUniTask.WaitForEndOfFrame\u003c/li\u003e\n\u003cli\u003eUniTask.WaitForFixedUpdate\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"unitaskcreate-unitaskdefer-unitaskdelay\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#unitaskcreate-unitaskdefer-unitaskdelay\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eUniTask.Create, UniTask.Defer, UniTask.Delay\u003c/h3\u003e\n\n\u003cp\u003e\u003ccode\u003eUniTask\u003c/code\u003eをデリゲートから生成するファクトリメソッドとして、次の3つがあります。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eUniTask.Create\u003c/li\u003e\n\u003cli\u003eUniTask.Defer\u003c/li\u003e\n\u003cli\u003eUniTask.Lazy\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// 引数が同じで挙動も似てる3つのファクトリメソッド\u003c/span\u003e\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eUniTask\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eCreate\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"n\"\u003eFunc\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eUniTask\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003efactory\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eUniTask\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eDefer\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"n\"\u003eFunc\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eUniTask\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003efactory\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eAsyncLazy\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eLazy\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"n\"\u003eFunc\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eUniTask\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003efactory\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれら3つは引数がどれも同じですが、微妙に挙動に違いがあります。\u003c/p\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align: left\"\u003e名前\u003c/th\u003e\n\u003cth style=\"text-align: left\"\u003e効果\u003c/th\u003e\n\u003cth style=\"text-align: left\"\u003e備考\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003eUniTask.Create\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eメソッドが呼び出されたタイミングで新しい\u003ccode\u003eUniTask\u003c/code\u003eを\u003cstrong\u003e即座に\u003c/strong\u003e生成する\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e\n\u003ccode\u003eCreate()\u003c/code\u003eを呼んだ瞬間に\u003ccode\u003eUniTask\u003c/code\u003eが起動する。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003eUniTask.Defer\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e\n\u003ccode\u003eawait\u003c/code\u003eされるタイミングまで\u003ccode\u003eUniTask\u003c/code\u003eの生成を遅延させる\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e1回しか\u003ccode\u003eawait\u003c/code\u003eできない代わりに\u003ccode\u003eLazy\u003c/code\u003eより軽量。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003eUniTask.Lazy\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e最初に\u003ccode\u003eawait\u003c/code\u003eされるタイミングまで\u003ccode\u003eUniTask\u003c/code\u003eの生成を遅延させる\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e生成されるものは\u003ccode\u003eAsyncLazy\u003c/code\u003e。\u003ccode\u003eAsyncLazy.Task\u003c/code\u003eは何回でも\u003ccode\u003eawait\u003c/code\u003eできる。\u003ccode\u003eDefer\u003c/code\u003eよりはコストが大きい。\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003cp\u003e\u003ccode\u003eDefer\u003c/code\u003eと\u003ccode\u003eLazy\u003c/code\u003eの違いは直接\u003ccode\u003eUniTask\u003c/code\u003eを生成するか、\u003ccode\u003eAsyncLazy\u003c/code\u003eを生成するかの違いです。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eDefer\u003c/code\u003eから生成される\u003ccode\u003eUniTask\u003c/code\u003eは2回\u003ccode\u003eawait\u003c/code\u003eできません。\u003cbr\u003e\n\u003ccode\u003eLazy\u003c/code\u003eから生成される\u003ccode\u003eUniTask\u003c/code\u003e(\u003ccode\u003eAsyncLazy.UniTask\u003c/code\u003e)は何回でも\u003ccode\u003eawait\u003c/code\u003eが可能です。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eLazy\u003c/code\u003eと比べて\u003ccode\u003eDefer\u003c/code\u003eの方がより軽量になっています。\u003cbr\u003e\nそのため\u003ccode\u003eawait\u003c/code\u003e回数が1度のみなら\u003ccode\u003eDefer\u003c/code\u003eを使いましょう。\u003c/p\u003e\n\n\u003cp\u003e一方で何度も\u003ccode\u003eawait\u003c/code\u003eする必要がある場合は\u003ccode\u003eLazy\u003c/code\u003eを使いましょう。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"playerlooptiming追加\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#playerlooptiming%E8%BF%BD%E5%8A%A0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ePlayerLoopTiming追加\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003ePlayerLoopTiming\u003c/code\u003eが追加され、次の種類となりました。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eInitialization\u003c/li\u003e\n\u003cli\u003eLastInitialization\u003c/li\u003e\n\u003cli\u003eEarlyUpdate \u003c/li\u003e\n\u003cli\u003eLastEarlyUpdate\u003c/li\u003e\n\u003cli\u003eFixedUpdate\u003c/li\u003e\n\u003cli\u003eLastFixedUpdate\u003c/li\u003e\n\u003cli\u003ePreUpdate\u003c/li\u003e\n\u003cli\u003eLastPreUpdate\u003c/li\u003e\n\u003cli\u003eUpdate\u003c/li\u003e\n\u003cli\u003eLastUpdate\u003c/li\u003e\n\u003cli\u003ePreLateUpdate\u003c/li\u003e\n\u003cli\u003eLastPreLateUpdate\u003c/li\u003e\n\u003cli\u003ePostLateUpdate\u003c/li\u003e\n\u003cli\u003eLastPostLateUpdate\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eとくに\u003cstrong\u003eLastPostLateUpdate\u003c/strong\u003eが重要で、こちらはコルーチンにおける\u003ccode\u003eWaitForEndOfFrame\u003c/code\u003eに相当します。\u003cbr\u003e\nいままで\u003ccode\u003eUniTask\u003c/code\u003eでは\u003ccode\u003eyield return new WaitForEndOfFrame()\u003c/code\u003eができなかったのですが、今回のアップデートから可能となりました。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"jobhandlewaitasync\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#jobhandlewaitasync\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eJobHandle.WaitAsync\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003eJobSystem\u003c/code\u003eの\u003ccode\u003eJobHandle\u003c/code\u003eに\u003ccode\u003eWaitAsync\u003c/code\u003eが追加されました。\u003cbr\u003e\nこちらを利用することで、任意の\u003ccode\u003ePlayerLoop\u003c/code\u003eのタイミングに切り替えてから完了待ちができます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// WaitForEndOfFrame相当の待機をしてからComplete()\u003c/span\u003e\n\u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003ejobHandle\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWaitAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ePlayerLoopTiming\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLastPostLateUpdate\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"asynctriggerメソッドのiunitaskasyncenumerable対応\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#asynctrigger%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%AEiunitaskasyncenumerable%E5%AF%BE%E5%BF%9C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eAsyncTriggerメソッドのIUniTaskAsyncEnumerable対応\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003eAsyncTrigger\u003c/code\u003e系のメソッド(\u003ccode\u003ethis.GetAsyncCollisionEnterTrigger\u003c/code\u003eとか)が\u003ccode\u003eIUniTaskAsyncEnumerable\u003c/code\u003eに対応しました。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"cancellationtokenwaituntilcanceled\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#cancellationtokenwaituntilcanceled\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003eCancellationToken.WaitUntilCanceled\u003c/code\u003e\n\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003eCancellationToken.WaitUntilCanceled\u003c/code\u003eという拡張メソッドが追加されました。\u003cbr\u003e\nこれを用いると、\u003ccode\u003eCancellationToken\u003c/code\u003eが完了するのを\u003ccode\u003eawait\u003c/code\u003eできるようになります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eStart\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003etoken\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetCancellationTokenOnDestroy\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eWaitForCanceledAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etoken\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eForget\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"n\"\u003eUniTaskVoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eWaitForCanceledAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eCancellationToken\u003c/span\u003e \u003cspan class=\"n\"\u003etoken\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003etoken\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWaitUntilCanceled\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Canceled!\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"cancellationtokentounitask\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#cancellationtokentounitask\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003eCancellationToken.ToUniTask\u003c/code\u003e\n\u003c/h2\u003e\n\n\u003cp\u003e同様に、\u003ccode\u003eCancellationToken.ToUniTask\u003c/code\u003eで\u003ccode\u003eUniTask\u003c/code\u003eを生成することもできます。\u003cbr\u003e\nこの\u003ccode\u003eUniTask\u003c/code\u003eは\u003ccode\u003eCancellationToken\u003c/code\u003eがキャンセルされると正常終了（\u003ccode\u003eSucceeded\u003c/code\u003e）状態となります。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"dotweenのawaitに対応\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#dotween%E3%81%AEawait%E3%81%AB%E5%AF%BE%E5%BF%9C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eDoTweenのawaitに対応\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003eDoTween\u003c/code\u003eの\u003ccode\u003eawait\u003c/code\u003eにも対応しました。\u003c/p\u003e\n\n\u003cp\u003eただし動作させるためには次の設定が必要です。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eOpenUPMからDOTweenを導入する、またはScripting Define Symbolsに「UNITASK_DOTWEEN_SUPPORT」を定義する\u003c/li\u003e\n\u003cli\u003easmdef「\u003ccode\u003eUniTask.DOTweeen\u003c/code\u003e」への参照を追加する\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eStart\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eMoveAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"nf\"\u003eForget\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"n\"\u003eUniTaskVoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eMoveAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// 直列実行\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003etransform\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDOMove\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etransform\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eposition\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eup\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e1.0f\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003etransform\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDOScale\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eone\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"m\"\u003e2.0f\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e1.0f\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// UniTask.WhenAllで並行実行して終了待機\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eawait\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e(\u003c/span\u003e\n        \u003cspan class=\"n\"\u003etransform\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDOMove\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ezero\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e1.0f\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eToUniTask\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e\n        \u003cspan class=\"n\"\u003etransform\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDOScale\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eone\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e1.0f\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eToUniTask\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"addressable-asset-systemのawaitに対応\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#addressable-asset-system%E3%81%AEawait%E3%81%AB%E5%AF%BE%E5%BF%9C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eAddressable Asset Systemのawaitに対応\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003eAsyncOperationHandle\u003c/code\u003eの\u003ccode\u003eawait\u003c/code\u003eも可能になりました。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Threading\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eCysharp.Threading.Tasks\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eUnityEngine\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eUnityEngine.AddressableAssets\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eUnityEngine.UI\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eAsyncOperationHandleAwaitSample\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eMonoBehaviour\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// 読み込む対象のAssetReference\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eSerializeField\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003eAssetReference\u003c/span\u003e \u003cspan class=\"n\"\u003e_target\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eSerializeField\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eRawImage\u003c/span\u003e \u003cspan class=\"n\"\u003e_image\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eStart\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003etoken\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetCancellationTokenOnDestroy\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eInitializeAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e_target\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etoken\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eForget\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"n\"\u003eUniTaskVoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eInitializeAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eAssetReference\u003c/span\u003e \u003cspan class=\"n\"\u003etarget\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCancellationToken\u003c/span\u003e \u003cspan class=\"n\"\u003etoken\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// Addressables.LoadAssetAsyncをawaitで待ち受ける\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003etexture\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eAddressables\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLoadAssetAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eTexture\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"n\"\u003etarget\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWithCancellation\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etoken\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003e_image\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etexture\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etexture\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"idisposableaddtocancellationtoken\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#idisposableaddtocancellationtoken\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eIDisposable.AddTo(CancellationToken)\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003eUniRx\u003c/code\u003eで便利だった\u003ccode\u003eAddTo\u003c/code\u003eの\u003ccode\u003eCancellationToken\u003c/code\u003e版も追加されました。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"新機能\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%96%B0%E6%A9%9F%E8%83%BD\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e新機能\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"unitaskasyncenumerableiunitaskasyncenumerable\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#unitaskasyncenumerableiunitaskasyncenumerable\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eUniTaskAsyncEnumerable/IUniTaskAsyncEnumerable\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003eUniTaskAsyncEnumerable\u003c/code\u003eは\u003ccode\u003eUniTask2\u003c/code\u003eの目玉機能です。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eIUniTaskAsyncEnumerable\u0026lt;T\u0026gt;\u003c/code\u003eは\u003ccode\u003eC# 8.0\u003c/code\u003eの\u003ccode\u003eIAsyncEnumerable\u0026lt;T\u0026gt;\u003c/code\u003eを\u003ccode\u003eUniTask\u003c/code\u003eとして実装したものです。\u003cbr\u003e\nなんとこちらは\u003cstrong\u003eC# 7.x系のUnityでも利用可能\u003c/strong\u003eになっています。\u003c/p\u003e\n\n\u003cp\u003e何をするためのものかというと、「\u003cstrong\u003e非同期処理を複数個まとめて扱う\u003c/strong\u003e」ことができるようになる機能です。\u003cbr\u003e\n\u003ccode\u003eObservable\u003c/code\u003e（\u003ccode\u003eIObservable\u0026lt;T\u0026gt;\u003c/code\u003e）と似ていますが、こちらは\u003ccode\u003ePull\u003c/code\u003e型として機能するという違いがあります。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/4e5a452a872f86d46faf92fded06785c6c4ac775/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f34373134362f64623637656366652d393865352d356561662d633066382d3863623437656531303265662e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F47146%2Fdb67ecfe-98e5-5eaf-c0f8-8cb47ee102ef.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=ff54c63fbc6737cddadf145cc367eec1\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/47146/db67ecfe-98e5-5eaf-c0f8-8cb47ee102ef.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F47146%2Fdb67ecfe-98e5-5eaf-c0f8-8cb47ee102ef.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=d673271e627dbc183120f475bca40a6f 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"observableとの使い分け\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#observable%E3%81%A8%E3%81%AE%E4%BD%BF%E3%81%84%E5%88%86%E3%81%91\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eObservableとの使い分け\u003c/h3\u003e\n\n\u003cp\u003e\u003ccode\u003eObservable\u003c/code\u003eは\u003ccode\u003ePush\u003c/code\u003e型なのに対して、\u003ccode\u003eUniTaskAsyncEnumerable\u003c/code\u003eは\u003ccode\u003ePull\u003c/code\u003e型です。\u003cbr\u003e\nそのため\u003ccode\u003eUniTaskAsyncEnumerable\u003c/code\u003eでは非同期処理の実行タイミングを受信側でコントロールできるというメリットがあります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eUniTaskAsyncEnumerableで複数の非同期処理を扱う\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eStart\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003etoken\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetCancellationTokenOnDestroy\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003euris\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"s\"\u003e\"https://www.google.com/\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"s\"\u003e\"https://unity.com/ja\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"s\"\u003e\"https://github.com/\"\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\n\n    \u003cspan class=\"c1\"\u003e// URIのリストに対してアクセスしてデータをとってくる\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// ただし常に実行される通信は同時に1つであり、\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// 前回のものが完了しないと次の通信に進まない\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003euris\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToUniTaskAsyncEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 通信完了を待機してメッセージを発行する\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSelectAwait\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"nf\"\u003eFetchAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eForEachAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003etoken\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"n\"\u003eUniTask\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eFetchAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003euri\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003euwr\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eUnityWebRequest\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGet\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003euri\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003euwr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSendWebRequest\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003euwr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eisNetworkError\u003c/span\u003e \u003cspan class=\"p\"\u003e||\u003c/span\u003e \u003cspan class=\"n\"\u003euwr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eisHttpError\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eException\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"Error\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003euwr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003euwr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edownloadHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e対する\u003ccode\u003eObservable\u003c/code\u003eは\u003ccode\u003ePush\u003c/code\u003e型のため、多数の\u003ccode\u003eObserver\u003c/code\u003eに対してメッセージをブロードキャストするのに向いています。\u003c/p\u003e\n\n\u003cp\u003e複数個の非同期処理を管理する場合は基本には\u003ccode\u003eUniTaskAsyncEnumerable\u003c/code\u003eを使う。\u003cbr\u003e\nイベント駆動を制御する場合には\u003ccode\u003eObservable\u003c/code\u003eを使う。\u003c/p\u003e\n\n\u003cp\u003eという使い方をするとよいでしょう。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"unitaskasyncenumerableの消費\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#unitaskasyncenumerable%E3%81%AE%E6%B6%88%E8%B2%BB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eUniTaskAsyncEnumerableの消費\u003c/h3\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"foreachasync\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#foreachasync\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eForEachAsync\u003c/h4\u003e\n\n\u003cp\u003e\u003ccode\u003eC# 8.0\u003c/code\u003eであれば\u003ccode\u003eawait foreach\u003c/code\u003eが使えるのですが、それが使えないUnityバージョンでは代替として\u003ccode\u003eForEachAsync\u003c/code\u003eを利用します。\u003cbr\u003e\n感覚としては、\u003ccode\u003eIObservable\u0026lt;T\u0026gt;\u003c/code\u003eに対する\u003ccode\u003eSubscribe()\u003c/code\u003eに似ています。\u003cbr\u003e\nですがこちらは「\u003ccode\u003eForEachAsync()\u003c/code\u003eの完了をさらに\u003ccode\u003eawait\u003c/code\u003eで待つ」といったことが可能となります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eForEachAsync\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eStart\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003etoken\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetCancellationTokenOnDestroy\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// EveryUpdate()は毎フレームのタイミングで完了するUniTaskを返す\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eUniTaskAsyncEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEveryUpdate\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSelect\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003e_\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 5回まで実行する\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eTake\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e5\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// ForEachAsyncで待機する\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eForEachAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e_\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eTime\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eframeCount\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003etoken\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Done!\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"foreachawaitasync\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#foreachawaitasync\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eForEachAwaitAsync\u003c/h4\u003e\n\n\u003cp\u003eまた、\u003ccode\u003eForEachAsync\u003c/code\u003eの他に\u003ccode\u003eForEachAwaitAsync\u003c/code\u003eもあります。\u003cbr\u003e\nこちらはデリゲートの内部で\u003ccode\u003easync/await\u003c/code\u003eが利用でき、この非同期処理が完了するまで次のメッセージを取りに行きません。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eForEachAwaitAsync\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eUniTaskAsyncEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEveryUpdate\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSelect\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003e_\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// 5回まで実行する\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eTake\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e5\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// ForEachAwaitAsyncで待機する\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eForEachAwaitAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"n\"\u003e_\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 10フレーム待ってから次のメッセージを取りに行く\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eUniTask\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDelayFrame\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecancellationToken\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003etoken\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e},\u003c/span\u003e \u003cspan class=\"n\"\u003etoken\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"subscribe\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#subscribe\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eSubscribe\u003c/h4\u003e\n\n\u003cp\u003eまた、\u003ccode\u003eSubscribe\u003c/code\u003eというメソッドも用意されています。\u003cbr\u003e\nこちらは\u003ccode\u003eIObservable.Subscribe()\u003c/code\u003eと似た感覚で利用できます。\u003c/p\u003e\n\n\u003cp\u003eなお、こちらはデリゲート内部で\u003ccode\u003easync/await\u003c/code\u003eが利用できますが、\u003cstrong\u003eその結果を待機しません(Forgetする）\u003c/strong\u003e。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003etoken\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetCancellationTokenOnDestroy\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"n\"\u003eUniTaskAsyncEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEveryUpdate\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSelect\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003e_\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eTake\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e5\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e_\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ect\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eUniTask\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDelay\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e100\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecancellationToken\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003ect\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Do!\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e},\u003c/span\u003e \u003cspan class=\"n\"\u003etoken\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"foreachasyncforeachawaitasyncsubscribeの違い\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#foreachasyncforeachawaitasyncsubscribe%E3%81%AE%E9%81%95%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eForEachAsync/ForEachAwaitAsync/Subscribeの違い\u003c/h4\u003e\n\n\u003cp\u003eそれぞれの大きな違いは登録したデリゲートの呼び出し方にあります。\u003cbr\u003e\n\u003ccode\u003eForEachAwaitAsync\u003c/code\u003eと\u003ccode\u003eSubscribe\u003c/code\u003eは非同期処理を用いたときに挙動が異なるので注意が必要です。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eForEachAsync\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003ewhile\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eMoveNextAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eaction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCurrent\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 常に同期\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eForEachAwaitAsync\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003ewhile\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eMoveNextAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"nf\"\u003eaction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCurrent\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e// awaitしてから次へいく\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eSubscribe\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003ewhile\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eMoveNextAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eaction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCurrent\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eForget\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e \u003cspan class=\"c1\"\u003e// Forget()して次へいく\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"unitaskasyncenumerableの作り方\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#unitaskasyncenumerable%E3%81%AE%E4%BD%9C%E3%82%8A%E6%96%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eUniTaskAsyncEnumerableの作り方\u003c/h3\u003e\n\n\u003cp\u003e\u003ccode\u003eUniTaskAsyncEnumerable\u003c/code\u003eはさまざまな方法で生成することができます。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"ファクトリメソッド\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%95%E3%82%A1%E3%82%AF%E3%83%88%E3%83%AA%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eファクトリメソッド\u003c/h4\u003e\n\n\u003cul\u003e\n\u003cli\u003eReturn\u003c/li\u003e\n\u003cli\u003eRepeat\u003c/li\u003e\n\u003cli\u003eEmpty\u003c/li\u003e\n\u003cli\u003eThrow\u003c/li\u003e\n\u003cli\u003eNever\u003c/li\u003e\n\u003cli\u003eRange\u003c/li\u003e\n\u003cli\u003eEveryUpdate\u003c/li\u003e\n\u003cli\u003eTimer\u003c/li\u003e\n\u003cli\u003eTimerFrame\u003c/li\u003e\n\u003cli\u003eInterval\u003c/li\u003e\n\u003cli\u003eIntervalFrame\u003c/li\u003e\n\u003cli\u003eEveryValueChanged\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch5\u003e\n\u003cspan id=\"unitaskasyncenumerablecreate\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#unitaskasyncenumerablecreate\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eUniTaskAsyncEnumerable.Create\u003c/h5\u003e\n\n\u003cp\u003eC#8の非同期イテレータに相当するものとして、\u003ccode\u003eUniTaskAsyncEnumerable.Create\u003c/code\u003eがあります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// 整数のカウントダウン\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eIUniTaskAsyncEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eCountDownAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003estartCount\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eTimeSpan\u003c/span\u003e \u003cspan class=\"n\"\u003etimeSpan\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eUniTaskAsyncEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCreate\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ewriter\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etoken\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ecurrentCount\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estartCount\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ewhile\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecurrentCount\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// writer.YieldAsync を使うと UniTaskAsyncEnumerable に値が書き込まれる\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003ewriter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eYieldAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecurrentCount\u003c/span\u003e\u003cspan class=\"p\"\u003e--);\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eUniTask\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDelay\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etimeSpan\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecancellationToken\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003etoken\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"他のデータ構造から変換\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BB%96%E3%81%AE%E3%83%87%E3%83%BC%E3%82%BF%E6%A7%8B%E9%80%A0%E3%81%8B%E3%82%89%E5%A4%89%E6%8F%9B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e他のデータ構造から変換\u003c/h4\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eIEnumerable\u0026lt;T\u0026gt;\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eIObservable\u0026lt;T\u0026gt;\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eTask\u0026lt;T\u0026gt;\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eUniTaskT\u0026gt;\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"uguiコンポーネントから変換\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#ugui%E3%82%B3%E3%83%B3%E3%83%9D%E3%83%BC%E3%83%8D%E3%83%B3%E3%83%88%E3%81%8B%E3%82%89%E5%A4%89%E6%8F%9B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003euGUIコンポーネントから変換\u003c/h4\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003euGUIイベントからの変換\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eFromUGui\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eMonoBehaviour\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eSerializeField\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eButton\u003c/span\u003e \u003cspan class=\"n\"\u003e_button\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eStart\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003etoken\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetCancellationTokenOnDestroy\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// 連打防止ボタン\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 1回ボタンを押したら2秒間無反応になる\u003c/span\u003e\n        \u003cspan class=\"n\"\u003e_button\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eOnClickAsAsyncEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eForEachAwaitWithCancellationAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e_\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ect\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Clicked!\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eUniTask\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDelay\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e2000\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecancellationToken\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003ect\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e},\u003c/span\u003e \u003cspan class=\"n\"\u003etoken\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"asynctriggerを利用する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#asynctrigger%E3%82%92%E5%88%A9%E7%94%A8%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eAsyncTriggerを利用する\u003c/h4\u003e\n\n\u003cp\u003e\u003ccode\u003ethis.GetAsyncCollisionEnterTrigger()\u003c/code\u003eなど。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"channel\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#channel\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eChannel\u003c/h4\u003e\n\n\u003cp\u003e\u003ccode\u003eChannel\u003c/code\u003eは\u003ccode\u003eGo\u003c/code\u003eにおける\u003ccode\u003eChannel\u003c/code\u003eと同義です。\u003cbr\u003e\n挙動としては\u003ccode\u003eObservable\u003c/code\u003eにおける\u003ccode\u003eSubject\u003c/code\u003eに相当します。\u003c/p\u003e\n\n\u003cp\u003e実装としては\u003ccode\u003eCreateSingleConsumerUnbounded\u003c/code\u003eが用意されています。\u003cbr\u003e\n\u003ccode\u003eCreateSingleConsumerUnbounded\u003c/code\u003eは内部でメッセージをキューイングしているため、メッセージの取りこぼしは発生しません。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eChannelの例\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eStart\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// Channel作成\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003echannel\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eChannel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCreateSingleConsumerUnbounded\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// Channelを読み取るときはReaderを使う\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eReader\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// メッセージの待受\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eWaitForChannelAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetCancellationTokenOnDestroy\u003c/span\u003e\u003cspan class=\"p\"\u003e()).\u003c/span\u003e\u003cspan class=\"nf\"\u003eForget\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// 書き込むときはWriteを使う\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ewriter\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWriter\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// IObserver\u0026lt;T\u0026gt;.OnNext() に相当\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ewriter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eTryWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ewriter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eTryWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ewriter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eTryWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// IObserver\u0026lt;T\u0026gt;.OnCompleted() に相当\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ewriter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eTryComplete\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// TryComplete()に例外を渡すと IObserver\u0026lt;T\u0026gt;.OnError() に相当\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// writer.TryComplete(new Exception(\"\"));\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"n\"\u003eUniTaskVoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eWaitForChannelAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eChannelReader\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eCancellationToken\u003c/span\u003e \u003cspan class=\"n\"\u003etoken\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003etry\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 1回だけ読み取るならReadAsync\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eresult1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReadAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etoken\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e// UniTask\u0026lt;int\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eresult1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// 完了するまで読み続けるなら　ReadAllAsync\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// IObservable\u0026lt;T\u0026gt;.Subscribe() に相当\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReadAllAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"c1\"\u003e// IUniTaskAsyncEnumerable\u0026lt;int\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eForEachAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003etoken\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Done\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ecatch\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eException\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLogException\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eなお、\u003ccode\u003eCreateSingleConsumerUnbounded\u003c/code\u003eは同時に１箇所でしかメッセージの消費が行なえません。\u003cbr\u003e\n2箇所以上で\u003ccode\u003eForEachAsync\u003c/code\u003e等を行った場合は正しく動作しません。\u003c/p\u003e\n\n\u003cp\u003eもし2箇所以上で消費したい（値を分配したい）場合は\u003ccode\u003ePublish()\u003c/code\u003eを利用しましょう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eStart\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// Channel作成\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003echannel\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eChannel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCreateSingleConsumerUnbounded\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// ReadAsync + Publish で何回も待受可能になる\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003econnectable\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eReader\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReadAllAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"nf\"\u003ePublish\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003econnectable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eConnect\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 複数回待受\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eWaitForChannelAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003econnectable\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetCancellationTokenOnDestroy\u003c/span\u003e\u003cspan class=\"p\"\u003e()).\u003c/span\u003e\u003cspan class=\"nf\"\u003eForget\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eWaitForChannelAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003econnectable\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetCancellationTokenOnDestroy\u003c/span\u003e\u003cspan class=\"p\"\u003e()).\u003c/span\u003e\u003cspan class=\"nf\"\u003eForget\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eWaitForChannelAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003econnectable\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetCancellationTokenOnDestroy\u003c/span\u003e\u003cspan class=\"p\"\u003e()).\u003c/span\u003e\u003cspan class=\"nf\"\u003eForget\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ewriter\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWriter\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003ewriter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eTryWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ewriter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eTryWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ewriter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eTryWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ewriter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eComplete\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"asyncreactiveproperty\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#asyncreactiveproperty\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eAsyncReactiveProperty\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003eAsyncReactiveProperty\u003c/code\u003eは\u003ccode\u003eUniRx\u003c/code\u003eの\u003ccode\u003eReactiveProperty\u003c/code\u003eの\u003ccode\u003eUniTask\u003c/code\u003e版です。\u003cbr\u003e\nベースとして\u003ccode\u003eIUniTaskAsyncEnumerable\u0026lt;T\u0026gt;\u003c/code\u003eが利用されています。\u003cbr\u003e\n（\u003ccode\u003eReactiveProperty\u003c/code\u003eはベースが\u003ccode\u003eIObservable\u0026lt;T\u0026gt;\u003c/code\u003e）\u003c/p\u003e\n\n\u003cp\u003e基本的な使い方は\u003ccode\u003eReactiveProperty\u003c/code\u003eと変わりません。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eAsyncReactiveProperty\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eStart\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003etoken\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetCancellationTokenOnDestroy\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// AsyncReactiveProperty生成\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003easyncReactiveProperty\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eAsyncReactiveProperty\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// 待受開始\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eWaitForAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003easyncReactiveProperty\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etoken\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eForget\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// Valueプロパティに値をセットすると\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// MoveNextAsync() が次に進む\u003c/span\u003e\n    \u003cspan class=\"n\"\u003easyncReactiveProperty\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Hello!\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// Dispose()するとこのAsyncReactivePropertyが完了する\u003c/span\u003e\n    \u003cspan class=\"n\"\u003easyncReactiveProperty\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDispose\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"n\"\u003eUniTaskVoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eWaitForAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eIReadOnlyAsyncReactiveProperty\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003easyncReadOnlyReactiveProperty\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eCancellationToken\u003c/span\u003e \u003cspan class=\"n\"\u003etoken\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// Valueプロパティで現在値を取得可能\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ecurrent\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003easyncReadOnlyReactiveProperty\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecurrent\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// IUniTaskAsyncEnumerable\u0026lt;T\u0026gt;として扱える\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eresult\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003easyncReadOnlyReactiveProperty\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// null以外の値がセットされるのを待つ\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFirstOrDefaultAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecancellationToken\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003etoken\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eresult\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"unirxreactivepropertyとasyncreactivepropertyの使い分け\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#unirxreactiveproperty%E3%81%A8asyncreactiveproperty%E3%81%AE%E4%BD%BF%E3%81%84%E5%88%86%E3%81%91\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eUniRx.ReactivePropertyとAsyncReactivePropertyの使い分け\u003c/h3\u003e\n\n\u003cp\u003e結論から先にいうと次になります。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eイベントメッセージの通知として使う方が多いなら \u003ccode\u003eUniRx.ReactiveProperty\u003c/code\u003e を使う\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eawait\u003c/code\u003eで変化を待ち受けることの方が多いなら \u003ccode\u003eAsyncReactiveProperty\u003c/code\u003e を使う\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003chr\u003e\n\n\u003cp\u003e\u003ccode\u003eUniRx.ReactiveProperty\u003c/code\u003eと\u003ccode\u003eAsyncReactiveProperty\u003c/code\u003eはそれぞれ次の点が異なります。\u003c/p\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align: left\"\u003e\u003c/th\u003e\n\u003cth style=\"text-align: left\"\u003e\u003ccode\u003eUniRx.ReactiveProperty\u0026lt;T\u0026gt;\u003c/code\u003e\u003c/th\u003e\n\u003cth style=\"text-align: left\"\u003e\u003ccode\u003eAsyncReactiveProperty\u0026lt;T\u0026gt;\u003c/code\u003e\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003eベースの型\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e\u003ccode\u003eIObservable\u0026lt;T\u0026gt;\u003c/code\u003e\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e\u003ccode\u003eIUniTaskAsyncEnumerable\u0026lt;T\u0026gt;\u003c/code\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003eふるまい\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e\u003ccode\u003ePush\u003c/code\u003e\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e\u003ccode\u003ePull\u003c/code\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e直接\u003ccode\u003eawait\u003c/code\u003eした時の挙動\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e次の値に更新されるまで待つ（現在値は無視）\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e\n\u003ccode\u003eWaitAsync\u003c/code\u003eまたは\u003ccode\u003eUniTask.Linq\u003c/code\u003eを経由する必要あり\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003eOperator/LINQをつないだときの挙動\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e\n\u003ccode\u003eIObservable\u0026lt;T\u0026gt;\u003c/code\u003e扱いになるので、\u003ccode\u003eToUniTask()\u003c/code\u003eなどが必要\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e\n\u003ccode\u003eLINQ\u003c/code\u003eの挙動による\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e得意なこと\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eメッセージのブロードキャスト\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e条件を指定しての柔軟な\u003ccode\u003eawait\u003c/code\u003e\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003cp\u003e\u003ccode\u003eUniRx.ReactiveProperty\u0026lt;T\u0026gt;\u003c/code\u003eは直接\u003ccode\u003eawait\u003c/code\u003eできますが、そのときの挙動がコントロールできません。\u003cbr\u003e\nたとえば「特定のパラメータに変化するまで待つ」といったことがしたい場合、\u003ccode\u003eOperator\u003c/code\u003eを経由する必要があります。\u003c/p\u003e\n\n\u003cp\u003eただ\u003ccode\u003eOperator\u003c/code\u003eを使ってしまうと\u003ccode\u003eIObservable\u0026lt;T\u0026gt;\u003c/code\u003eに対する\u003ccode\u003eawait\u003c/code\u003eになるため、取り扱いが面倒くさいことになります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eUniRx.ReactivePropertyのawait\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"n\"\u003eUniTaskVoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eWaitForPropertyAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eReactiveProperty\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eCancellationToken\u003c/span\u003e \u003cspan class=\"n\"\u003ect\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// IObservableに対するawaitになる\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// CancellationTokenを指定するにはToUniTaskが必要でいろいろめんどくさい\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eresult\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWhere\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"m\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eToUniTask\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003euseFirstValue\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ect\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eresult\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003eUniRx.ReactiveProperty\u0026lt;T\u0026gt;\u003c/code\u003eは\u003ccode\u003eawait\u003c/code\u003eとは相性があまり良くないですが、複数の購読者に対して一斉にメッセージを送ることについては抜群に得意です。\u003c/p\u003e\n\n\u003chr\u003e\n\n\u003cp\u003e一方の\u003ccode\u003eAsyncReactiveProperty\u0026lt;T\u0026gt;\u003c/code\u003eは\u003ccode\u003eIUniTaskAsyncEnumerable\u0026lt;T\u0026gt;\u003c/code\u003eベースのため、\u003ccode\u003eawait\u003c/code\u003eと非常に相性がよいです。\u003cbr\u003e\n素直にそのまま書くことができ、\u003ccode\u003eCancellationToken\u003c/code\u003eの指定も簡単です。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"n\"\u003eUniTaskVoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eWaitForPropertyAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eAsyncReactiveProperty\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eCancellationToken\u003c/span\u003e \u003cspan class=\"n\"\u003ect\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// そのままLINQを書いてawaitできる\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// CancellationTokenも渡しやすい\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eresult\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFirstAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"m\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ect\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// 非同期処理を間で挟むこともできる\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003ep\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSelectAwaitWithCancellation\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003et\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// 与えられた値のミリ秒分だけ待つ（何がしたいんだこの例）\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eUniTask\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDelay\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecancellationToken\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003et\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e})\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFirstAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecancellationToken\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003ect\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eただし\u003ccode\u003eAsyncReactiveProperty\u0026lt;T\u0026gt;\u003c/code\u003eは\u003ccode\u003eawait\u003c/code\u003eのタイミングによっては値の取りこぼしが発生してしまいます。\u003cbr\u003e\nそのため確実にメッセージをブロードキャストして相手に確実に届けるという用途には向いていません。\u003cbr\u003e\n（その点は\u003ccode\u003eUniRx.ReactiveProperty\u0026lt;T\u0026gt;\u003c/code\u003eのほうが有利です）\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e取りこぼしが起きる例\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"n\"\u003eUniTaskVoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eWaitForPropertyAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eAsyncReactiveProperty\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eCancellationToken\u003c/span\u003e \u003cspan class=\"n\"\u003ect\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// UniRxのSubscribe感覚でForEachAwaitAsyncを使うと\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// メッセージの取りこぼしが起きうる\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eForEachAwaitWithCancellationAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ect\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 1秒待ってから次の値を取りに行く\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// このawait中に変動した値は取りこぼす\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eUniTask\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDelay\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1000\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecancellationToken\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003ect\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e},\u003c/span\u003e \u003cspan class=\"n\"\u003ect\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e取りこぼしの防止策として、後述する\u003ccode\u003eQueue()\u003c/code\u003eを使う方法もあります。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"unitasklinq\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#unitasklinq\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eUniTask.Linq\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003eIUniTaskAsyncEnumerable\u0026lt;T\u0026gt;\u003c/code\u003eには\u003ccode\u003eLINQ\u003c/code\u003eメソッドが用意されています。\u003cbr\u003e\n利用するためにはasmdef「\u003ccode\u003eUniTask.Linq\u003c/code\u003e」への参照を追加する必要があります。\u003c/p\u003e\n\n\u003cp\u003e使えるメソッドは次です。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"同期型\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%90%8C%E6%9C%9F%E5%9E%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e同期型\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003eAggregateAsync\u003c/li\u003e\n\u003cli\u003eAllAsync\u003c/li\u003e\n\u003cli\u003eAnyAsync\u003c/li\u003e\n\u003cli\u003eAsUniTaskAsyncEnumerable\u003c/li\u003e\n\u003cli\u003eAverageAsync\u003c/li\u003e\n\u003cli\u003eBuffer\u003c/li\u003e\n\u003cli\u003eAppend\u003c/li\u003e\n\u003cli\u003ePrepend\u003c/li\u003e\n\u003cli\u003eCast\u003c/li\u003e\n\u003cli\u003eConcat\u003c/li\u003e\n\u003cli\u003eContainsAsync\u003c/li\u003e\n\u003cli\u003eCountAsync\u003c/li\u003e\n\u003cli\u003eDefaultIfEmpty\u003c/li\u003e\n\u003cli\u003eDistinct\u003c/li\u003e\n\u003cli\u003eDistinctUntilChanged\u003c/li\u003e\n\u003cli\u003eDo\u003c/li\u003e\n\u003cli\u003eElementAtAsync\u003c/li\u003e\n\u003cli\u003eElementAtOrDefaultAsync\u003c/li\u003e\n\u003cli\u003eExcept\u003c/li\u003e\n\u003cli\u003eFirstAsync\u003c/li\u003e\n\u003cli\u003eFirstOrDefaultAsync\u003c/li\u003e\n\u003cli\u003eForEachAsync\u003c/li\u003e\n\u003cli\u003eGroupBy\u003c/li\u003e\n\u003cli\u003eGroupJoin\u003c/li\u003e\n\u003cli\u003eIntersect\u003c/li\u003e\n\u003cli\u003eJoin\u003c/li\u003e\n\u003cli\u003eLastAsync\u003c/li\u003e\n\u003cli\u003eLastOrDefaultAsync\u003c/li\u003e\n\u003cli\u003eLongCountAsync\u003c/li\u003e\n\u003cli\u003eMaxAsync\u003c/li\u003e\n\u003cli\u003eMinAsync\u003c/li\u003e\n\u003cli\u003eOfType\u003c/li\u003e\n\u003cli\u003eOrderBy\u003c/li\u003e\n\u003cli\u003eOrderByDescending\u003c/li\u003e\n\u003cli\u003eReverse\u003c/li\u003e\n\u003cli\u003eSelect\u003c/li\u003e\n\u003cli\u003eSelectMany\u003c/li\u003e\n\u003cli\u003eSequenceEqualAsync\u003c/li\u003e\n\u003cli\u003eSingleAsync\u003c/li\u003e\n\u003cli\u003eSingleOrDefaultAsync\u003c/li\u003e\n\u003cli\u003eSkip\u003c/li\u003e\n\u003cli\u003eSkipLast\u003c/li\u003e\n\u003cli\u003eSkipWhile\u003c/li\u003e\n\u003cli\u003eSkipUntil\u003c/li\u003e\n\u003cli\u003eSumAsync\u003c/li\u003e\n\u003cli\u003eTake\u003c/li\u003e\n\u003cli\u003eTakeLast\u003c/li\u003e\n\u003cli\u003eTakeWhile\u003c/li\u003e\n\u003cli\u003eTakeUntil\u003c/li\u003e\n\u003cli\u003eToArrayAsync\u003c/li\u003e\n\u003cli\u003eToDictionaryAsync\u003c/li\u003e\n\u003cli\u003eToHashSetAsync\u003c/li\u003e\n\u003cli\u003eToListAsync\u003c/li\u003e\n\u003cli\u003eToLookupAsync\u003c/li\u003e\n\u003cli\u003eToObservable\u003c/li\u003e\n\u003cli\u003eUnion\u003c/li\u003e\n\u003cli\u003eWhere\u003c/li\u003e\n\u003cli\u003eZip\u003c/li\u003e\n\u003cli\u003eCombineLatest\u003c/li\u003e\n\u003cli\u003ePairwise\u003c/li\u003e\n\u003cli\u003eQueue\u003c/li\u003e\n\u003cli\u003eSkipUntilCanceled\u003c/li\u003e\n\u003cli\u003eTakeUntilCanceled\u003c/li\u003e\n\u003cli\u003ePublish\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"非同期型\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%9D%9E%E5%90%8C%E6%9C%9F%E5%9E%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e非同期型\u003c/h3\u003e\n\n\u003cp\u003e\u003ccode\u003eAwaitAsync\u003c/code\u003eがついているものは\u003ccode\u003easync/await\u003c/code\u003eを内部で利用できます。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eAggregateAwaitAsync\u003c/li\u003e\n\u003cli\u003eAllAwaitAsync\u003c/li\u003e\n\u003cli\u003eAnyAwaitAsync\u003c/li\u003e\n\u003cli\u003eAverageAwaitAsync\u003c/li\u003e\n\u003cli\u003eCountAwaitAsync\u003c/li\u003e\n\u003cli\u003eDistinctAwait\u003c/li\u003e\n\u003cli\u003eDistinctUntilChangedAwait\u003c/li\u003e\n\u003cli\u003eDoAwait\u003c/li\u003e\n\u003cli\u003eFirstAwaitAsync\u003c/li\u003e\n\u003cli\u003eFirstOrDefaultAwaitAsync\u003c/li\u003e\n\u003cli\u003eForEachAwaitAsync\u003c/li\u003e\n\u003cli\u003eGroupByAwait\u003c/li\u003e\n\u003cli\u003eGroupJoinAwait\u003c/li\u003e\n\u003cli\u003eJoinAwait\u003c/li\u003e\n\u003cli\u003eLastAwaitAsync\u003c/li\u003e\n\u003cli\u003eLastOrDefaultAwaitAsync\u003c/li\u003e\n\u003cli\u003eLongCountAwaitAsync\u003c/li\u003e\n\u003cli\u003eMaxAwaitAsync\u003c/li\u003e\n\u003cli\u003eMinAwaitAsync\u003c/li\u003e\n\u003cli\u003eOrderByAwait\u003c/li\u003e\n\u003cli\u003eOrderByDescendingAwait\u003c/li\u003e\n\u003cli\u003eSelectAwait\u003c/li\u003e\n\u003cli\u003eSelectManyAwait\u003c/li\u003e\n\u003cli\u003eSingleAwaitAsync\u003c/li\u003e\n\u003cli\u003eSingleOrDefaultAwaitAsync\u003c/li\u003e\n\u003cli\u003eSkipWhileAwait\u003c/li\u003e\n\u003cli\u003eSumAwaitAsync\u003c/li\u003e\n\u003cli\u003eTakeWhileAwait\u003c/li\u003e\n\u003cli\u003eToDictionaryAwaitAsync\u003c/li\u003e\n\u003cli\u003eToLookupAwaitAsync\u003c/li\u003e\n\u003cli\u003eWhereAwait\u003c/li\u003e\n\u003cli\u003eZipAwait\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eこちらは\u003ccode\u003eCancellationToken\u003c/code\u003eを内部で必要とするときに使います。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eAggregateAwaitWithCancellationAsync\u003c/li\u003e\n\u003cli\u003eAnyAwaitWithCancellationAsync\u003c/li\u003e\n\u003cli\u003eAverageAwaitWithCancellationAsync\u003c/li\u003e\n\u003cli\u003eCountAwaitWithCancellationAsync\u003c/li\u003e\n\u003cli\u003eDistinctAwaitWithCancellation\u003c/li\u003e\n\u003cli\u003eDistinctUntilChangedAwaitWithCancellation\u003c/li\u003e\n\u003cli\u003eDoAwaitWithCancellation\u003c/li\u003e\n\u003cli\u003eFirstAwaitWithCancellationAsync\u003c/li\u003e\n\u003cli\u003eFirstOrDefaultAwaitWithCancellationAsync\u003c/li\u003e\n\u003cli\u003eForEachAwaitWithCancellationAsync\u003c/li\u003e\n\u003cli\u003eGroupByAwaitWithCancellation\u003c/li\u003e\n\u003cli\u003eGroupJoinAwaitWithCancellation\u003c/li\u003e\n\u003cli\u003eJoinAwaitWithCancellation\u003c/li\u003e\n\u003cli\u003eLastAwaitWithCancellationAsync\u003c/li\u003e\n\u003cli\u003eLastOrDefaultAwaitWithCancellationAsync\u003c/li\u003e\n\u003cli\u003eLongCountAwaitWithCancellationAsync\u003c/li\u003e\n\u003cli\u003eMaxAwaitWithCancellationAsync\u003c/li\u003e\n\u003cli\u003eMinAwaitWithCancellationAsync\u003c/li\u003e\n\u003cli\u003eOrderByAwaitWithCancellation\u003c/li\u003e\n\u003cli\u003eOrderByDescendingAwaitWithCancellation\u003c/li\u003e\n\u003cli\u003eSelectAwaitWithCancellation\u003c/li\u003e\n\u003cli\u003eSelectManyAwaitWithCancellation\u003c/li\u003e\n\u003cli\u003eSingleAwaitWithCancellationAsync\u003c/li\u003e\n\u003cli\u003eSingleOrDefaultAwaitWithCancellationAsync\u003c/li\u003e\n\u003cli\u003eSkipWhileAwaitWithCancellation\u003c/li\u003e\n\u003cli\u003eSumAwaitWithCancellationAsync\u003c/li\u003e\n\u003cli\u003eTakeWhileAwaitWithCancellation\u003c/li\u003e\n\u003cli\u003eToDictionaryAwaitWithCancellationAsync\u003c/li\u003e\n\u003cli\u003eToLookupAwaitWithCancellationAsync\u003c/li\u003e\n\u003cli\u003eWhereAwaitWithCancellation\u003c/li\u003e\n\u003cli\u003eZipAwaitWithCancellation\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"補足-pushベースのunitaskasyncenumerableの注意点\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A3%9C%E8%B6%B3-push%E3%83%99%E3%83%BC%E3%82%B9%E3%81%AEunitaskasyncenumerable%E3%81%AE%E6%B3%A8%E6%84%8F%E7%82%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e補足: Pushベースの\u003ccode\u003eUniTaskAsyncEnumerable\u003c/code\u003eの注意点\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003eIUniTaskAsyncEnumerable\u0026lt;T\u0026gt;\u003c/code\u003eは\u003ccode\u003ePull\u003c/code\u003e型として動作します。\u003cbr\u003e\nそのためメッセージの受信準備が整い、内部でイテレータの\u003ccode\u003eMoveNextAsync()\u003c/code\u003eが実行されたタイミングで次のメッセージを取りに行きます。\u003c/p\u003e\n\n\u003cp\u003eですが、\u003ccode\u003eUniTaskAsyncEnumerable\u003c/code\u003eではメッセージ発行が\u003ccode\u003ePush\u003c/code\u003eな\u003ccode\u003eIUniTaskAsyncEnumerable\u0026lt;T\u0026gt;\u003c/code\u003eも存在します（ややこしい）\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eUniTask.EveryUpdate()\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eAsyncReactiveProperty\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eAsyncTrigger\u003c/code\u003eより生成したもの\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003euGUI\u003c/code\u003eのイベントなどから変換したもの\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eこれらは\u003ccode\u003ePush\u003c/code\u003eされてきたイベントを\u003ccode\u003eIUniTaskAsyncEnumerable\u0026lt;T\u0026gt;\u003c/code\u003eとして提供します。\u003cbr\u003e\nそのため\u003ccode\u003eMoveNextAsync()\u003c/code\u003eとタイミングが合わなかった場合は、\u003cstrong\u003eその間に発行されたイベントは取りこぼされる\u003c/strong\u003eという点に注意が必要です。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/25f596e3e2878da62adec35a6ee0c0b42aea320e/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f34373134362f36343534306333362d306361382d666336362d333239362d6561383835353632666539382e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F47146%2F64540c36-0ca8-fc66-3296-ea885562fe98.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=9b127e5103e57b60c7e6e6dd416c684b\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/47146/64540c36-0ca8-fc66-3296-ea885562fe98.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F47146%2F64540c36-0ca8-fc66-3296-ea885562fe98.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=e783d92c7ab451f37c08ae1c685a6907 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e逆に、このイベントの取りこぼしを利用して処理を組むこともできます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eイベントの取りこぼしを利用した例\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// uGUIのボタンの連打防止\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 1回ボタンを押したら2秒間無反応になる\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// ForEachAwaitAsyncが待機中に発行されたメッセージは無視するという\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 性質を利用している\u003c/span\u003e\n\u003cspan class=\"n\"\u003e_button\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eOnClickAsAsyncEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eForEachAwaitWithCancellationAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e_\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ect\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Clicked!\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eUniTask\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDelay\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e2000\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecancellationToken\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003ect\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e},\u003c/span\u003e \u003cspan class=\"n\"\u003etoken\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"取りこぼしが嫌なら-queue-を使おう\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8F%96%E3%82%8A%E3%81%93%E3%81%BC%E3%81%97%E3%81%8C%E5%AB%8C%E3%81%AA%E3%82%89-queue-%E3%82%92%E4%BD%BF%E3%81%8A%E3%81%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e取りこぼしが嫌なら Queue() を使おう\u003c/h3\u003e\n\n\u003cp\u003e\u003ccode\u003eQueue\u003c/code\u003eは\u003ccode\u003eUniTask.Linq\u003c/code\u003eが提供する\u003ccode\u003eLINQ\u003c/code\u003eメソッドの1つです。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eIUniTaskAsyncEnumerable\u0026lt;T\u0026gt;\u003c/code\u003eに対して先に\u003ccode\u003eMoveNextAsync()\u003c/code\u003eを実行し、その結果をキューに詰めて再度\u003ccode\u003eIUniTaskAsyncEnumerable\u0026lt;T\u0026gt;\u003c/code\u003eとして提供します。\u003cbr\u003e\n（\u003ccode\u003eObservable\u003c/code\u003eでいうところの\u003ccode\u003ePublish()\u003c/code\u003eに相当します）\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eQueue\u003c/code\u003eを使えばイベントの取りこぼしを防ぐことができるため、必要に応じて利用しましょう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eQueue\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eStart\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003etoken\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetCancellationTokenOnDestroy\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// AsyncReactiveProperty生成\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003easyncReactiveProperty\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eAsyncReactiveProperty\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Initialize!\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// 待受開始\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eWaitForAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003easyncReactiveProperty\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etoken\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eForget\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// 値を設定\u003c/span\u003e\n    \u003cspan class=\"n\"\u003easyncReactiveProperty\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Hello!\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003easyncReactiveProperty\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"World!\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003easyncReactiveProperty\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Thank you!\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003easyncReactiveProperty\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDispose\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"n\"\u003eUniTaskVoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eWaitForAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eIReadOnlyAsyncReactiveProperty\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003easyncReadOnlyReactiveProperty\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eCancellationToken\u003c/span\u003e \u003cspan class=\"n\"\u003etoken\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// AsyncReactiveProperty はキューイングしてくれないので\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// タイミングによってはメッセージの取りこぼしが置きうる\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// 取りこぼしが嫌ならQueueを併用する\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003easyncReadOnlyReactiveProperty\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eQueue\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"c1\"\u003e// Queueを挟む\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eForEachAwaitWithCancellationAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ect\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// 1秒待って次の値を取りに行く\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eUniTask\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDelay\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1000\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecancellationToken\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003ect\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e},\u003c/span\u003e \u003cspan class=\"n\"\u003etoken\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"まとめ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eまとめ\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"unitask2の感想\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#unitask2%E3%81%AE%E6%84%9F%E6%83%B3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eUniTask2の感想\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003eC# 8.0\u003c/code\u003eの\u003ccode\u003eIAsyncEnumerable\u003c/code\u003e相当の処理をいち早く\u003ccode\u003eUnity\u003c/code\u003eでも利用できるため、かなり期待が高いアップデートとなりました。\u003cbr\u003e\n\u003ccode\u003eUniTaskAsyncEnumerable\u003c/code\u003eと\u003ccode\u003eAsyncReactiveProperty\u003c/code\u003eが刺さる人にはかなり刺さる機能でしょう（自分はさっそく使いたい）\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"unirxobservableとの使い分け\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#unirxobservable%E3%81%A8%E3%81%AE%E4%BD%BF%E3%81%84%E5%88%86%E3%81%91\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eUniRx（Observable）との使い分け\u003c/h2\u003e\n\n\u003cp\u003eぶっちゃけ、\u003cstrong\u003e非同期処理の用途としてUniRx（Observable）が選択肢に上がってくることがなくなりました。\u003c/strong\u003e\u003cbr\u003e\n\u003ccode\u003easync/await\u003c/code\u003e + \u003ccode\u003eUniTask\u003c/code\u003e / \u003ccode\u003eUniTaskAsyncEnumerable\u003c/code\u003e でほとんどの非同期処理のシチュエーションはカバーできてしまいます。\u003c/p\u003e\n\n\u003cp\u003eじゃあ\u003ccode\u003eObservable\u003c/code\u003eはお役御免かというとそうではなく、「イベント駆動」として使う方ではまだまだ活用が可能です。\u003cbr\u003e\n特にイベントメッセージが飛び交うゲーム開発では\u003ccode\u003eObservable\u003c/code\u003eが活躍するシチュエーションは多いでしょう。\u003c/p\u003e\n\n\u003cp\u003eとくに\u003ccode\u003eReactiveProperty\u003c/code\u003eと\u003ccode\u003eAsyncReactiveProperty\u003c/code\u003eの使い分けが特に今後は重要になってくるかなと思います。\u003c/p\u003e\n","createdAt":"2020-05-19T14:55:03Z","elapsedYearsFromLastModifiedAt":0,"encryptedId":"g0kdAucUS0sGHFThIQF5GJCoag23zq21Tw==--HtBE2z9MKDLVsYEU--Yik/5QV0pQMPSNcPyDkWVQ==","isBanned":false,"isDeprecated":false,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2020-09-29T07:45:29Z","likesCount":114,"linkUrl":"https://qiita.com/toRisouP/items/8f66fd952eaffeaf3107","organization":null,"originalId":1226652,"stockedCount":83,"title":"UniTask Ver2 、UniTaskAsyncEnumerableまとめ","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%BB%96%E3%81%AE%E8%B3%87%E6%96%99\"\u003e他の資料\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#unitask2\"\u003eUniTask2\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%A0%B4%E5%A3%8A%E7%9A%84%E5%A4%89%E6%9B%B4\"\u003e破壊的変更\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%BF%85%E8%A6%81%E3%81%AA%E6%9C%80%E4%BD%8Eunity%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3\"\u003e必要な最低Unityバージョン\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%90%8D%E5%89%8D%E7%A9%BA%E9%96%93%E3%81%AE%E5%A4%89%E6%9B%B4\"\u003e名前空間の変更\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#unitask%E3%81%AEawait2%E5%BA%A6%E6%BC%AC%E3%81%91%E7%A6%81%E6%AD%A2\"\u003eUniTaskのawait2度漬け禁止\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#preserve\"\u003ePreserve()\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#asyncoperation%E3%82%92await%E3%81%99%E3%82%8B%E3%81%A8%E3%81%8D%E3%81%AEconfigureawait%E5%BB%83%E6%AD%A2\"\u003eAsyncOperationをawaitするときのConfigureAwait廃止\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#unitask%E3%81%AE%E4%B8%80%E9%83%A8%E3%82%B3%E3%83%B3%E3%82%B9%E3%83%88%E3%83%A9%E3%82%AF%E3%82%BF%E5%BB%83%E6%AD%A2\"\u003eUniTaskの一部コンストラクタ廃止\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#unitasklazy%E3%81%AE%E6%88%BB%E3%82%8A%E5%80%A4%E3%81%AE%E5%A4%89%E6%9B%B4\"\u003eUniTask.Lazyの戻り値の変更\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#unitaskwhenany%E3%81%AE%E6%88%BB%E3%82%8A%E5%80%A4%E5%A4%89%E6%9B%B4\"\u003eUniTask.WhenAnyの戻り値変更\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#unitaskdelayframe%E3%81%AE%E6%88%BB%E3%82%8A%E5%80%A4%E5%A4%89%E6%9B%B4\"\u003eUniTask.DelayFrameの戻り値変更\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#iobservabletounitask%E3%81%AE%E5%BC%95%E6%95%B0%E3%81%AE%E9%A0%86%E5%BA%8F%E3%81%8C%E5%A4%89%E6%9B%B4\"\u003eIObservable.ToUniTask()の引数の順序が変更\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#unitaskresultiscompleted%E3%81%8C%E5%89%8A%E9%99%A4\"\u003eUniTask.Result/IsCompletedが削除\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#awaiterstatus---unitaskstatus\"\u003eAwaiterStatus -\u0026gt; UniTaskStatus\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%97%A2%E5%AD%98%E6%A9%9F%E8%83%BD%E3%81%B8%E3%81%AE%E8%BF%BD%E5%8A%A0%E6%A9%9F%E8%83%BD%E3%81%A8%E3%81%8B\"\u003e既存機能への追加機能とか\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%85%A8%E4%BD%93%E7%9A%84%E3%81%AA%E3%83%91%E3%83%95%E3%82%A9%E3%83%BC%E3%83%9E%E3%83%B3%E3%82%B9%E3%81%AE%E5%90%91%E4%B8%8A\"\u003e全体的なパフォーマンスの向上\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#unitaskcompletionsource\"\u003eUniTaskCompletionSource\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#autoresetunitaskcompletionsource%E8%BF%BD%E5%8A%A0\"\u003eAutoResetUniTaskCompletionSource追加\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%95%E3%82%A1%E3%82%AF%E3%83%88%E3%83%AA%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%8C%E8%BF%BD%E5%8A%A0\"\u003eファクトリメソッドが追加\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#unitaskcreate-unitaskdefer-unitaskdelay\"\u003eUniTask.Create, UniTask.Defer, UniTask.Delay\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#playerlooptiming%E8%BF%BD%E5%8A%A0\"\u003ePlayerLoopTiming追加\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#jobhandlewaitasync\"\u003eJobHandle.WaitAsync\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#asynctrigger%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%AEiunitaskasyncenumerable%E5%AF%BE%E5%BF%9C\"\u003eAsyncTriggerメソッドのIUniTaskAsyncEnumerable対応\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#cancellationtokenwaituntilcanceled\"\u003eCancellationToken.WaitUntilCanceled\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#cancellationtokentounitask\"\u003eCancellationToken.ToUniTask\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#dotween%E3%81%AEawait%E3%81%AB%E5%AF%BE%E5%BF%9C\"\u003eDoTweenのawaitに対応\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#addressable-asset-system%E3%81%AEawait%E3%81%AB%E5%AF%BE%E5%BF%9C\"\u003eAddressable Asset Systemのawaitに対応\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#idisposableaddtocancellationtoken\"\u003eIDisposable.AddTo(CancellationToken)\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%96%B0%E6%A9%9F%E8%83%BD\"\u003e新機能\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#unitaskasyncenumerableiunitaskasyncenumerable\"\u003eUniTaskAsyncEnumerable/IUniTaskAsyncEnumerable\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#observable%E3%81%A8%E3%81%AE%E4%BD%BF%E3%81%84%E5%88%86%E3%81%91\"\u003eObservableとの使い分け\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#unitaskasyncenumerable%E3%81%AE%E6%B6%88%E8%B2%BB\"\u003eUniTaskAsyncEnumerableの消費\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#foreachasync\"\u003eForEachAsync\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#foreachawaitasync\"\u003eForEachAwaitAsync\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#subscribe\"\u003eSubscribe\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#foreachasyncforeachawaitasyncsubscribe%E3%81%AE%E9%81%95%E3%81%84\"\u003eForEachAsync/ForEachAwaitAsync/Subscribeの違い\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#unitaskasyncenumerable%E3%81%AE%E4%BD%9C%E3%82%8A%E6%96%B9\"\u003eUniTaskAsyncEnumerableの作り方\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%95%E3%82%A1%E3%82%AF%E3%83%88%E3%83%AA%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89\"\u003eファクトリメソッド\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#unitaskasyncenumerablecreate\"\u003eUniTaskAsyncEnumerable.Create\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%BB%96%E3%81%AE%E3%83%87%E3%83%BC%E3%82%BF%E6%A7%8B%E9%80%A0%E3%81%8B%E3%82%89%E5%A4%89%E6%8F%9B\"\u003e他のデータ構造から変換\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#ugui%E3%82%B3%E3%83%B3%E3%83%9D%E3%83%BC%E3%83%8D%E3%83%B3%E3%83%88%E3%81%8B%E3%82%89%E5%A4%89%E6%8F%9B\"\u003euGUIコンポーネントから変換\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#asynctrigger%E3%82%92%E5%88%A9%E7%94%A8%E3%81%99%E3%82%8B\"\u003eAsyncTriggerを利用する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#channel\"\u003eChannel\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#asyncreactiveproperty\"\u003eAsyncReactiveProperty\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#unirxreactiveproperty%E3%81%A8asyncreactiveproperty%E3%81%AE%E4%BD%BF%E3%81%84%E5%88%86%E3%81%91\"\u003eUniRx.ReactivePropertyとAsyncReactivePropertyの使い分け\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#unitasklinq\"\u003eUniTask.Linq\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%90%8C%E6%9C%9F%E5%9E%8B\"\u003e同期型\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E9%9D%9E%E5%90%8C%E6%9C%9F%E5%9E%8B\"\u003e非同期型\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E8%A3%9C%E8%B6%B3-push%E3%83%99%E3%83%BC%E3%82%B9%E3%81%AEunitaskasyncenumerable%E3%81%AE%E6%B3%A8%E6%84%8F%E7%82%B9\"\u003e補足: PushベースのUniTaskAsyncEnumerableの注意点\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%8F%96%E3%82%8A%E3%81%93%E3%81%BC%E3%81%97%E3%81%8C%E5%AB%8C%E3%81%AA%E3%82%89-queue-%E3%82%92%E4%BD%BF%E3%81%8A%E3%81%86\"\u003e取りこぼしが嫌なら Queue() を使おう\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"\u003eまとめ\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#unitask2%E3%81%AE%E6%84%9F%E6%83%B3\"\u003eUniTask2の感想\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#unirxobservable%E3%81%A8%E3%81%AE%E4%BD%BF%E3%81%84%E5%88%86%E3%81%91\"\u003eUniRx（Observable）との使い分け\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":22674,"uuid":"8f66fd952eaffeaf3107","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"0+S3HlFzCqI+CBBreTZCX0a5Sr8=--c9Vikb+BdZdwZXvt--GMzB/8BszahpLd1aHhfSIg==","originalId":47146,"description":"","facebookUrl":null,"githubUrl":"https://github.com/TORISOUP","isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"","profileImageUrl":"https://qiita-image-store.s3.amazonaws.com/0/47146/profile-images/1473690888","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F47146%2Fprofile-images%2F1473690888?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=0ce887e592c3b3ae697bfb53041d5b46","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F47146%2Fprofile-images%2F1473690888?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=61879b88c08bddf8018304cc1ace2fc4","urlName":"toRisouP","websiteUrl":"","twitterUrl":"https://twitter.com/toRisouP","twitterUrlName":"toRisouP","revealedOrganizations":{"edges":[{"node":{"encryptedId":"JKxWdHqfKGodtqh8S0xkinv9GJXgolmdktE=--7kVSLshkOiUsDYag--gXE8kxmheEuvibto15veqQ==","isBetaReleaseEnabled":false,"isFollowableByViewer":false,"isFollowedByViewer":false,"name":"株式会社 バーチャルキャスト","logoUrl":"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/bf42a888e9366aa2d817bd985e231c12c6d80826/original.jpg?1545792589","urlName":"virtualcast","description":"VRシステム(バーチャルキャスト)の開発、運営、企画","url":"https://virtualcast.jp/"}}]}},"tags":[{"name":"C#","urlName":"csharp"},{"name":"Unity","urlName":"unity"},{"name":"UniRx","urlName":"unirx"},{"name":"UniTask","urlName":"unitask"}],"followingLikers":{"edges":[]},"comments":{"totalCount":0}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

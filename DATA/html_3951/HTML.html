<!DOCTYPE html><html><head><meta charset="utf-8" /><title>ILの暗黒の魔術　第３章「動的生成！そしてBurst挽歌へ」 - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/pCYSl5EDgo/items/9af7f5f1efaf8cd4ccdc" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="jH3T3jGZDLMlv5tIVVLB/QBwN9/B7ivCheKHtg7EqBOyoLY5lKFgW9qls6A+KymJuShPP00I+i0SbALYcKvYZg==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta content="@pCYSl5EDgo" name="twitter:creator" /><meta property="og:type" content="article"><meta property="og:title" content="ILの暗黒の魔術　第３章「動的生成！そしてBurst挽歌へ」 - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1TVXpqZ2E3bW1wZnB1NUxqZ2E3cHJaVG9vWlBqZ0lEbnJLenZ2SlBucTZEamdJemxpNVhubW9UbmxKX21pSkR2dklIamdaM2pnWmZqZ2FaQ2RYSnpkT2FNdmVhdGpPT0J1T09BalEmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT01NCZ0eHQtY2xpcD1lbGxpcHNpcyZ0eHQtYWxpZ249Y2VudGVyJTJDbWlkZGxlJnM9NTYyNzM4OTk5ZTMyZWQ5NGZiYzhjMmRmZTVlY2ViMTc&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RSEJEV1ZOc05VVkVaMjgmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT00NSZ0eHQtYWxpZ249cmlnaHQlMkNib3R0b20mcz01YmYwNDcwNjQ5YzY4NDM0OWU3ZDUxNDM3ODg5MWUzNQ&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=ab4adb995d25bee441ce157fc04fa080"><meta property="og:description" content="初投稿です（ガバガバ）。

私はヴァーレントゥーガが好きです。


ヴァーレントゥーガは、ななあし氏が制作した国取りタイプ戦略シミュレーションゲームです。敵軍の動きや地形を考慮しながら自軍の兵士をリアルタイムで動かす戦闘システムや、フ..."><meta content="https://qiita.com/pCYSl5EDgo/items/9af7f5f1efaf8cd4ccdc" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#,Unity,IL,EntityComponentSystem,AssemblyBuilder" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 1nzh4zz 38fzdi helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-1nzh4zz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:16px 32px;background-color:#FBE69E;color:rgba(0,0,0,0.87);line-height:1.5;font-weight:600;}@media (max-width:770px){.css-1nzh4zz{padding:16px;}}.css-38fzdi{color:#CA832A;margin-right:4px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-c7bdb2c8-0dce-467d-b6f9-9e8b8e6c2538"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2FpCYSl5EDgo%2Fitems%2F9af7f5f1efaf8cd4ccdc">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2FpCYSl5EDgo%2Fitems%2F9af7f5f1efaf8cd4ccdc">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-c7bdb2c8-0dce-467d-b6f9-9e8b8e6c2538">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2019-01-29T15:54:25.000+09:00","dateModified":"2019-01-29T15:54:25.000+09:00","headline":"ILの暗黒の魔術　第３章「動的生成！そしてBurst挽歌へ」","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1TVXpqZ2E3bW1wZnB1NUxqZ2E3cHJaVG9vWlBqZ0lEbnJLenZ2SlBucTZEamdJemxpNVhubW9UbmxKX21pSkR2dklIamdaM2pnWmZqZ2FaQ2RYSnpkT2FNdmVhdGpPT0J1T09BalEmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT01NCZ0eHQtY2xpcD1lbGxpcHNpcyZ0eHQtYWxpZ249Y2VudGVyJTJDbWlkZGxlJnM9NTYyNzM4OTk5ZTMyZWQ5NGZiYzhjMmRmZTVlY2ViMTc\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RSEJEV1ZOc05VVkVaMjgmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT00NSZ0eHQtYWxpZ249cmlnaHQlMkNib3R0b20mcz01YmYwNDcwNjQ5YzY4NDM0OWU3ZDUxNDM3ODg5MWUzNQ\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=ab4adb995d25bee441ce157fc04fa080","mainEntityOfPage":"https://qiita.com/pCYSl5EDgo/items/9af7f5f1efaf8cd4ccdc","author":{"@type":"Person","address":"","email":"pcysl5edgo@yahoo.co.jp","identifier":"pCYSl5EDgo","name":"pCYSl5EDgo","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F256047%2Fprofile-images%2F1546351264?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=c5789bc76dd49b92c1ddc68bc158b06b","url":"https://qiita.com/pCYSl5EDgo","description":"C#!好き!!（語彙不足）\r\nUnityやヴァーレントゥーガ関連の投稿をしていく予定です。","memberOf":[]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://increments.connpass.com/event/211948/">「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催</a><a target="_blank" id="header_text_message_2" href="https://increments.connpass.com/event/211948/">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"pCYSl5EDgo","type":"items","id":"9af7f5f1efaf8cd4ccdc"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"pCYSl5EDgo","type":"items","id":"9af7f5f1efaf8cd4ccdc"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":0,"pos_id":"header_text_message_1","message":"「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"pCYSl5EDgo","type":"items","id":"9af7f5f1efaf8cd4ccdc"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":0,"pos_id":"header_text_message_2","message":"「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/pCYSl5EDgo/items/9af7f5f1efaf8cd4ccdc","location":"/pCYSl5EDgo/items/9af7f5f1efaf8cd4ccdc","scheme":"https","host":"qiita.com","port":null,"pathname":"/pCYSl5EDgo/items/9af7f5f1efaf8cd4ccdc","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"wWdnvplpbY0zKdwNud9GJCcsucz0H5JDaX53gSlgIuL/ugJZPFEBZcwz9OXSpq5QnnTBLHj5Q6z+8PLvVw9Slw==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-2c1ec040-4a07-4101-92da-a7bc0449df5d"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/pCYSl5EDgo/items/9af7f5f1efaf8cd4ccdc/likers" class="css-1iupg5d">13</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">8</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/9af7f5f1efaf8cd4ccdc/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/pCYSl5EDgo/items/9af7f5f1efaf8cd4ccdc/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/pCYSl5EDgo/items/9af7f5f1efaf8cd4ccdc/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/pCYSl5EDgo/items/9af7f5f1efaf8cd4ccdc/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/pCYSl5EDgo/items/9af7f5f1efaf8cd4ccdc.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-1nzh4zz"><span class="fa fa-fw fa-warning css-38fzdi"></span><p>More than 1 year has passed since last update.</p></div><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/pCYSl5EDgo"><img class="css-100alwu eyfquo10" src="https://qiita-image-store.s3.amazonaws.com/0/256047/profile-images/1546351264" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/pCYSl5EDgo" class="css-10ougpm">@<!-- -->pCYSl5EDgo</a><div class="css-1ay9vb9"><time dateTime="2019-01-29T06:54:25Z" class="css-m19uds">posted at 2019-01-29</time></div></div></div></div></div><h1 class="css-cgzq40">ILの暗黒の魔術　第３章「動的生成！そしてBurst挽歌へ」</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/unity" class="css-4czcte">Unity</a><a href="/tags/il" class="css-4czcte">IL</a><a href="/tags/entitycomponentsystem" class="css-4czcte">EntityComponentSystem</a><a href="/tags/assemblybuilder" class="css-4czcte">AssemblyBuilder</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div><p>初投稿です（ガバガバ）。</p>

<p>私は<a href="https://www28.atwiki.jp/vahren_ency/pages/1028.html" rel="nofollow noopener" target="_blank">ヴァーレントゥーガ</a>が好きです。</p>

<blockquote>
<p>ヴァーレントゥーガは、ななあし氏が制作した国取りタイプ戦略シミュレーションゲームです。敵軍の動きや地形を考慮しながら自軍の兵士をリアルタイムで動かす戦闘システムや、ファンタジー世界を舞台とした壮大なストーリーが数多くのプレイヤーから人気を得ています。<br>
一方、ヴァーレントゥーガは、完成度の高い戦闘システムを引き継ぎながら、ユーザーが独自のシナリオを作り公開することが可能なゲーム制作ツールとして、作者のななあし氏が仕様を公開しています。<br>
そこからは、多くの派生作品が生み出されてきました。その中には、ニコニコ自作ゲームフェス4でフリーゲーム夢現賞を受賞した「LostTechnology」や海外展開を準備中の「きのこ・たけのこ戦争IF」など、派生元であるヴァーレントゥーガに負けず劣らず高い評価を得ている作品も数多くあります。<br>
高い完成度を誇る戦略シミュレーションゲームとして、また多くの派生作品を生み出したゲーム制作ツールとして、自作ゲームのコミュニティに偉大な貢献を残しており、まさにゲーム史における重要な存在であるといえます。<br>
<a href="http://info.nicovideo.jp/gamemaga/ganma/vt.html" rel="nofollow noopener" target="_blank">銃魔のレザネーションのヴァーレントゥーガ紹介ページ</a>より引用</p>
</blockquote>

<p>ヴァーレントゥーガは2018年に開発が終了しています。<br>
（今後新たな機能が追加されることは）ないです。</p>

<p>機能が安定したのを受け（）、私は数年前からUnity C#でヴァーレントゥーガ互換ソフトであるWahrenを開発しています。<br>
ヴァーレントゥーガは作者の漏らしたコメントから推察するにVisual C++でDirectX9を使用して作成されているはずです。<br>
故にユーザー作成の独自シナリオを実現している方法はよほど頭のおかしい技術を使用していない限りインタプリタであることは明白です。<br>
インタプリタが遅いのは日本書紀にも書いてあるぐらい自明の理です。<br>
故に私は.NETの特長であるJITを活かすべく、ユーザーのオリジナルシナリオのソースコードを動的に構文解析し、ILを吐いてAssemblyを作成することでPure C#並の速度を出そうと試みています。</p>

<p>Unity 2018.1から新たに登場した機能であるBurst Compiler（記事執筆時点でバージョン0.2.4-preview.41）を使用することで高速な並列計算を実現することが可能です。<br>
そこで、今回はBurst Compilerを利用する並列計算を行う構造体を動的に定義してみました。</p>

<h1>
<span id="第1節-設計" class="fragment"></span><a href="#%E7%AC%AC1%E7%AF%80-%E8%A8%AD%E8%A8%88"><i class="fa fa-link"></i></a>第1節 設計</h1>

<p>動的IL生成について私が<a href="https://qiita.com/pCYSl5EDgo/items/4a5cc446553f4d99a7f3" id="reference-90341c1cb911e3f55662">今まで書いてきた記事</a>はSystem.Reflection.Emit.DynamicMethodを利用してきました。<br>
これはトリッキーなこと（privateメンバへのアクセス）を行うならば非常に重宝するのですが、メソッドしか作れず、構造体を作ることができません。</p>

<h2>
<span id="assemblybuildermodulebuilder" class="fragment"></span><a href="#assemblybuildermodulebuilder"><i class="fa fa-link"></i></a>AssemblyBuilder&amp;ModuleBuilder</h2>

<p>今回はアセンブリから作っていきましょう。<br>
アセンブリば大体DLLみたいなものと思っていただければ大丈夫です。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="c1">// using System.Reflection;</span>
<span class="c1">// using System.Reflection.Emit;</span>

<span class="k">const</span> <span class="kt">string</span> <span class="n">ModuleName</span> <span class="p">=</span> <span class="s">"Hoge"</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">string</span> <span class="n">FileName</span> <span class="p">=</span> <span class="n">ModuleName</span> <span class="p">+</span> <span class="s">".dll"</span><span class="p">;</span>
<span class="n">AssemblyBuilder</span> <span class="n">assemblyBuilder</span> <span class="p">=</span> <span class="n">AssemblyBuilder</span><span class="p">.</span><span class="nf">DefineDynamicAssembly</span><span class="p">(</span><span class="k">new</span> <span class="nf">AssemblyName</span><span class="p">(</span><span class="n">ModuleName</span><span class="p">),</span> <span class="n">AssemblyBuilderAccess</span><span class="p">.</span><span class="n">RunAndSave</span><span class="p">);</span>
<span class="n">ModuleBuilder</span> <span class="n">moduleBulder</span> <span class="p">=</span> <span class="n">assemblyBuilder</span><span class="p">.</span><span class="nf">DefineDynamicModule</span><span class="p">(</span><span class="n">ModuleName</span><span class="p">,</span> <span class="n">FileName</span><span class="p">);</span>
</code></pre></div></div>

<p>動的に定義する場合AssemblyBuilder.DefineDynamicAssembly静的メソッドを使用します。<br>
この第一引数には何故かstring型ではなくAssemblyName型でアセンブリ名を与えます。<br>
第二引数はRunあるいはRunAndSaveを選びます。RunAndSaveの方がデバッガビリティが高いのでよいでしょう。</p>

<p>アセンブリは必ず１つはモジュールを持ちます。<br>
複数モジュールを持つことはできますが、MSBuildはその操作をサポートしていないので考慮せずともよいでしょう。<br>
このModuleBuilder型のオブジェクトに対してクラスや構造体や列挙型をごりごり定義していくことで大規模IL動的生成を行うのが主流です。<br>
static変数にでも持たせるのがいいのではないですかね。</p>

<h2>
<span id="typebuilder" class="fragment"></span><a href="#typebuilder"><i class="fa fa-link"></i></a>TypeBuilder</h2>

<p>今回はUnity.Jobs.IJobParallelForを実装したBurstJobな構造体を定義していきます。<br>
TypeBuilderでメソッドやフィールド、プロパティにインナークラスなど諸々全てを定義し終えた後、Type TypeBuilder.CreateType()インスタンスメソッドを呼び出すことでTypeオブジェクトを得られます。<br>
そしてその戻り値のTypeオブジェクトを引数に取るobject System.Activator.CreateInstance(Type t)静的メソッドによって動的に定義された構造体のインスタンス（がBOX化されたもの）が得られるのです。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">IJobParalleFor</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">Unity.Jobs.LowLevel.Unsafe</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">Unity.Jobs</span>
<span class="p">{</span>
    <span class="p">[</span><span class="nf">JobProducerType</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">IJobParallelForExtensions</span><span class="p">.</span><span class="n">ParallelForJobStruct</span><span class="p">&lt;&gt;))]</span>
    <span class="k">public</span> <span class="k">interface</span> <span class="nc">IJobParallelFor</span>
    <span class="p">{</span>
        <span class="k">void</span> <span class="nf">Execute</span><span class="p">(</span><span class="kt">int</span> <span class="n">index</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>JobParallelForを実装した構造体を第一引数に指定して、Unity.Jobs.JobHandle Unity.Jobs.IJobParallelForExtensions.Schedule&lt;T&gt;(T job, int arrayLength, int innerLoopBatchCount, Unity.Jobs.JobHandle) where T : struct静的メソッドを呼ぶことでマルチスレッドで良い感じに並列計算が実行されるようになります。</p>

<p>よって、今回動的に生成するコードはC#で擬似コードを提示しますと次のような形である必要があります。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="p">[</span><span class="n">Unity</span><span class="p">.</span><span class="n">Burst</span><span class="p">.</span><span class="n">BurstCompile</span><span class="p">]</span>
<span class="k">public</span> <span class="k">unsafe</span> <span class="k">struct</span> <span class="nc">BURSTJOB</span> <span class="p">:</span> <span class="n">Unity</span><span class="p">.</span><span class="n">Jobs</span><span class="p">.</span><span class="n">IJobParallelFor</span>
<span class="p">{</span>
    <span class="p">[</span><span class="n">Unity</span><span class="p">.</span><span class="n">Jobs</span><span class="p">.</span><span class="n">LowLevel</span><span class="p">.</span><span class="n">Unsafe</span><span class="p">.</span><span class="n">NativeDisableUnsafePtrRestriction</span><span class="p">]</span> <span class="k">public</span> <span class="kt">int</span><span class="p">*</span> <span class="n">ptr</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">Execute</span><span class="p">(</span><span class="kt">int</span> <span class="n">index</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="n">ptr</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">=</span> <span class="n">index</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>いや、まあこれだけだとまともに動作できないのですが。<br>
問題点は2つあります。</p>

<ul>
<li>BURSTJOB型に型変換できないのでint*型のフィールドptrに設定できない</li>
<li>IJobParallelForインターフェース型に型変換したとしてもUnity.Jobs.JobHandle Unity.Jobs.IJobParallelForExtensions.Schedule&lt;T&gt;(T job, int arrayLength, int innerLoopBatchCount, Unity.Jobs.JobHandle) where T : struct静的メソッドの型制約にひっかかる為並列計算できない</li>
</ul>

<p>よってこの２つの問題を解決するために新たに次のインターフェースを用意し、BURSTJOB構造体にこれを実装しましょう。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">Unity.Jobs</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Unity.Jobs.LowLevel.Unsafe</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Unity.Burst</span><span class="p">;</span>

<span class="k">private</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">COUNT</span> <span class="p">=</span> <span class="m">50000</span><span class="p">;</span>

<span class="k">public</span> <span class="k">unsafe</span> <span class="k">interface</span> <span class="nc">IAccessor</span> <span class="p">:</span> <span class="n">IJobParallelFor</span>
<span class="p">{</span>
    <span class="kt">int</span><span class="p">*</span> <span class="nf">GetPtr</span><span class="p">();</span>
    <span class="k">void</span> <span class="nf">SetPtr</span><span class="p">(</span><span class="kt">int</span><span class="p">*</span> <span class="k">value</span><span class="p">);</span>
    <span class="n">JobHandle</span> <span class="nf">Schedule</span><span class="p">();</span>
<span class="p">}</span>

<span class="p">[</span><span class="n">BurstCompile</span><span class="p">]</span>
<span class="k">public</span> <span class="k">unsafe</span> <span class="k">struct</span> <span class="nc">BURSTJOB</span> <span class="p">:</span> <span class="n">IAccessor</span>
<span class="p">{</span>
    <span class="p">[</span><span class="n">NativeDisableUnsafePtrRestriction</span><span class="p">]</span> <span class="k">public</span> <span class="kt">int</span><span class="p">*</span> <span class="n">ptr</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">Execute</span><span class="p">(</span><span class="kt">int</span> <span class="n">index</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="n">ptr</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">=</span> <span class="n">index</span><span class="p">;</span>
    <span class="k">public</span> <span class="n">JobHandle</span> <span class="nf">Schedule</span><span class="p">()</span> <span class="p">=&gt;</span> <span class="n">IJobParallelForExtensions</span><span class="p">.</span><span class="n">Schedule</span><span class="p">&lt;</span><span class="n">BURSTJOB</span><span class="p">&gt;(</span><span class="k">this</span><span class="p">,</span> <span class="n">COUNT</span><span class="p">,</span> <span class="m">1024</span><span class="p">,</span> <span class="k">default</span><span class="p">(</span><span class="n">JobHandle</span><span class="p">));</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">SetPtr</span><span class="p">(</span><span class="kt">int</span><span class="p">*</span> <span class="k">value</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="n">ptr</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span>
    <span class="k">public</span> <span class="kt">int</span><span class="p">*</span> <span class="nf">GetPtr</span><span class="p">()</span> <span class="p">=&gt;</span> <span class="n">ptr</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>こうすればActivator.CreateInsatnaceでインスタンス化したオブジェクトをIAccessorに型変換することでポインタPtrを設定し、かつIJobParallelForExtensions.Scheduleを呼び出すことが可能となります。<br>
具体的には以下のようにUpdateマジックメソッド内から呼びます。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">private</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">COUNT</span> <span class="p">=</span> <span class="m">50000</span><span class="p">;</span>
<span class="k">unsafe</span> <span class="k">void</span> <span class="nf">Update</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">array</span> <span class="p">=</span> <span class="k">new</span> <span class="n">NativeArray</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;(</span><span class="n">COUNT</span><span class="p">,</span> <span class="n">Allocator</span><span class="p">.</span><span class="n">TempJob</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="n">accessor</span><span class="p">.</span><span class="nf">SetPtr</span><span class="p">((</span><span class="kt">int</span><span class="p">*)</span><span class="n">array</span><span class="p">.</span><span class="nf">GetUnsafePtr</span><span class="p">());</span>
        <span class="n">JobHandle</span> <span class="n">handle</span> <span class="p">=</span> <span class="n">accessor</span><span class="p">.</span><span class="nf">Schedule</span><span class="p">();</span> <span class="c1">// マルチスレッド並列計算を発行する。</span>
        <span class="n">handle</span><span class="p">.</span><span class="nf">Complete</span><span class="p">();</span> <span class="c1">// 同期的に完了を待機する。</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>さあ、事前の設計と擬似コードは以上で十分でしょう。これから構造体を定義しましょう。</p>

<h1>
<span id="第2節-型を捏ねる" class="fragment"></span><a href="#%E7%AC%AC2%E7%AF%80-%E5%9E%8B%E3%82%92%E6%8D%8F%E3%81%AD%E3%82%8B"><i class="fa fa-link"></i></a>第2節 型を捏ねる</h1>

<h2>
<span id="概形" class="fragment"></span><a href="#%E6%A6%82%E5%BD%A2"><i class="fa fa-link"></i></a>概形</h2>

<p>BURSTJOB型を定義しましょう。この型は構造体で、IAccessorを実装しています。故に以下のように記述して概形を定義します。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">Start()マジックメソッド内から抜粋(1)</span></div>
<div class="highlight"><pre class="with-code"><code><span class="n">TypeBuilder</span> <span class="n">typeBuilder</span> <span class="p">=</span> <span class="n">moduleBulder</span><span class="p">.</span><span class="nf">DefineType</span><span class="p">(</span><span class="s">"BURSTJOB"</span><span class="p">,</span>
    <span class="n">TypeAttributes</span><span class="p">.</span><span class="n">Public</span> <span class="p">|</span> <span class="n">TypeAttributes</span><span class="p">.</span><span class="n">AnsiClass</span> <span class="p">|</span> <span class="n">TypeAttributes</span><span class="p">.</span><span class="n">Sealed</span> <span class="p">|</span> <span class="n">TypeAttributes</span><span class="p">.</span><span class="n">SequentialLayout</span><span class="p">,</span>
    <span class="k">typeof</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="n">ValueType</span><span class="p">),</span>
    <span class="k">new</span> <span class="n">Type</span><span class="p">[]</span> <span class="p">{</span> <span class="k">typeof</span><span class="p">(</span><span class="n">IAccessor</span><span class="p">),</span> <span class="k">typeof</span><span class="p">(</span><span class="n">IJobParallelFor</span><span class="p">)</span> <span class="p">});</span>
<span class="n">typeBuilder</span><span class="p">.</span><span class="nf">SetCustomAttribute</span><span class="p">(</span><span class="k">new</span> <span class="nf">CustomAttributeBuilder</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">BurstCompileAttribute</span><span class="p">).</span><span class="nf">GetConstructor</span><span class="p">(</span><span class="n">Type</span><span class="p">.</span><span class="n">EmptyTypes</span><span class="p">),</span> <span class="n">Array</span><span class="p">.</span><span class="n">Empty</span><span class="p">&lt;</span><span class="kt">object</span><span class="p">&gt;()));</span>
</code></pre></div>
</div>

<p>public TypeBuilder DefineType(string name, TypeAttributes attr, Type parent, Type[] interfaces);<br>
第一引数で型の名前を、第二引数で型の概形を、第三引数で基底型を、第四引数で実装するインターフェース（継承した基底インターフェースを含む）全てを指定することでTypeBuilderオブジェクトを戻します。<br>
名前はそのまま"BURSTJOB"。<br>
型の概形は一般的な構造体のそれを指定しています。読者の皆さんが構造体を動的に定義するならばこのTypeAttributesをそのままコピペして使うといいでしょう。<br>
IAccessorインターフェースはIJobParallelForインターフェースを継承しているため、ModuleBuilder.DefineTypeメソッドの引数に継承元であるIJobParallelFor型を表すTypeオブジェクトを渡しています。<br>
.NETにおける構造体は全てSystem.ValueType型から派生しているため基底型に指定します。<br>
そしてTypeBuilder.SetCustomAttrbuteインスタンスメソッドを呼ぶことでこの型に対してつけられた属性を表現します。</p>

<h2>
<span id="フィールド" class="fragment"></span><a href="#%E3%83%95%E3%82%A3%E3%83%BC%E3%83%AB%E3%83%89"><i class="fa fa-link"></i></a>フィールド</h2>

<p>次にフィールドを定義してあげましょう。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">Start()マジックメソッド内から抜粋(2)</span></div>
<div class="highlight"><pre class="with-code"><code><span class="n">Type</span> <span class="n">intPtrType</span> <span class="p">=</span> <span class="k">typeof</span><span class="p">(</span><span class="kt">int</span><span class="p">).</span><span class="nf">MakePointerType</span><span class="p">();</span>
<span class="n">FieldBuilder</span> <span class="n">ptr</span> <span class="p">=</span> <span class="n">typeBuilder</span><span class="p">.</span><span class="nf">DefineField</span><span class="p">(</span><span class="s">"ptr"</span><span class="p">,</span>
    <span class="n">intPtrType</span><span class="p">,</span>
    <span class="n">FieldAttributes</span><span class="p">.</span><span class="n">Public</span><span class="p">);</span>
<span class="n">field0</span><span class="p">.</span><span class="nf">SetCustomAttribute</span><span class="p">(</span><span class="k">new</span> <span class="nf">CustomAttributeBuilder</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">NativeDisableUnsafePtrRestrictionAttribute</span><span class="p">).</span><span class="nf">GetConstructor</span><span class="p">(</span><span class="n">Type</span><span class="p">.</span><span class="n">EmptyTypes</span><span class="p">),</span> <span class="n">Array</span><span class="p">.</span><span class="n">Empty</span><span class="p">&lt;</span><span class="kt">object</span><span class="p">&gt;()));</span>
</code></pre></div>
</div>

<p>int*を表すTypeオブジェクトを結構いろいろな箇所で必要としているのですが、typeof(int*)という表記法はC#において認められていません。<br>
そのため、Type.MakePointerTypeインスタンスメソッドを使用してint型を表すTypeオブジェクトからint*を表すTypeオブジェクトを作成します。ちなみに参照ref intを表すTypeオブジェクトを作るならばMakeByRefTypeメソッドを使います。<br>
このフィールドには[NativeDisableUnsafePtrRestriction]属性を付与しなくてはならないので、BURSTJOB構造体に対して行ったように属性を付与しましょう。</p>

<h2>
<span id="メソッド" class="fragment"></span><a href="#%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89"><i class="fa fa-link"></i></a>メソッド</h2>

<p>BURSTJOB構造体に定義されたメソッドは全てIAccessorとIJobParallelForインターフェースで定義されたメソッドです。<br>
故にこの記事ではオーバーライドしか扱いません。</p>

<p>では、一番単純なint* GetPtrメソッドをまずは見てみましょう。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">Start()マジックメソッド内から抜粋(3)</span></div>
<div class="highlight"><pre class="with-code"><code><span class="c1">// using static System.Reflection.Emmit.OpCodes;</span>

<span class="k">const</span> <span class="n">MethodAttributes</span> <span class="n">Attributes</span> <span class="p">=</span> <span class="n">MethodAttributes</span><span class="p">.</span><span class="n">Public</span> <span class="p">|</span> <span class="n">MethodAttributes</span><span class="p">.</span><span class="n">Virtual</span> <span class="p">|</span> <span class="n">MethodAttributes</span><span class="p">.</span><span class="n">Final</span> <span class="p">|</span> <span class="n">MethodAttributes</span><span class="p">.</span><span class="n">NewSlot</span> <span class="p">|</span> <span class="n">MethodAttributes</span><span class="p">.</span><span class="n">HideBySig</span><span class="p">;</span>

<span class="n">MethodBuilder</span> <span class="n">getPtr</span> <span class="p">=</span> <span class="n">typeBuilder</span><span class="p">.</span><span class="nf">DefineMethod</span><span class="p">(</span><span class="s">"GetPtr"</span><span class="p">,</span> <span class="n">Attributes</span><span class="p">,</span> <span class="n">intPtrType</span><span class="p">,</span> <span class="n">Type</span><span class="p">.</span><span class="n">EmptyTypes</span><span class="p">);</span>
<span class="p">{</span>
    <span class="n">ILGenerator</span> <span class="n">il</span> <span class="p">=</span> <span class="n">getPtr</span><span class="p">.</span><span class="nf">GetILGenerator</span><span class="p">();</span>
    <span class="n">il</span><span class="p">.</span><span class="nf">Emit</span><span class="p">(</span><span class="n">Ldarg_0</span><span class="p">);</span>
    <span class="n">il</span><span class="p">.</span><span class="nf">Emit</span><span class="p">(</span><span class="n">Ldfld</span><span class="p">,</span> <span class="n">ptr</span><span class="p">);</span>
    <span class="n">il</span><span class="p">.</span><span class="nf">Emit</span><span class="p">(</span><span class="n">Ret</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>MethodBuilder DefineMethod(string name, MethodAttributes attributes, Type returnType, Type[] parameterTypes);<br>
第一引数はメソッドの名前で、第二引数にメソッドの性質を指定します。<br>
今回はpublicで仮想メソッドをオーバーライドし、構造体なのでsealed(final)でこれ以上VTableを検索しない、と指定しています。（HideBySigとNewSlot？こまけえこたあいいんだよ！）<br>
第三引数に戻り値の型を定義し、第四引数に引数の型を定義します。引数がないメソッドならばType.EmptyTypesを渡してあげましょう。（System.Array.Empty()でもよさげですが、EmptyTypesはstatic readonlyフィールドなので微々たる差ですが高速に動作します。）</p>

<p>そして、ILGenerator MethodBuilder.GetILGenerator()でとうとうILをガリガリ書いていきましょう！<br>
ILGenerator.Emitメソッドの第一引数にOpCodesオブジェクトを渡し、第二引数以後にその補足を足す、という形でILを動的に出力します。<br>
OpCodes毎に補足が不要だったり、補足の型が千差万別なのにEmitメソッドばかりなのは実際バグの温床で使いにくいです。ここの辺りの辛さを大分緩和してくれるライブラリに<a href="https://github.com/kevin-montrose/Sigil" rel="nofollow noopener" target="_blank">Sigil</a>というものがあります。興味のある方は学んでみても良いと思います。</p>

<p>IL部分でやっていることはメソッドの第一引数からフィールドptrの値をスタックに積んで戻り値としているだけです。</p>

<p>次にvoid Execute(int index) =&gt; ptr[index] = index;を見てみましょう。<br>
これはポインタ演算が絡むのでやや複雑性が高いですが、慣れればそんなでもありません。<br>
戻り値がないvoidなメソッドの戻り値の型はtypeof(void)です。<br>
IL部分の解説はコード中のコメントを読んでください。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="n">MethodBuilder</span> <span class="n">execute</span> <span class="p">=</span> <span class="n">typeBuilder</span><span class="p">.</span><span class="nf">DefineMethod</span><span class="p">(</span><span class="s">"Execute"</span><span class="p">,</span> <span class="n">Attributes</span><span class="p">,</span> <span class="k">typeof</span><span class="p">(</span><span class="k">void</span><span class="p">),</span> <span class="k">new</span> <span class="n">Type</span><span class="p">[]</span> <span class="p">{</span> <span class="k">typeof</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">});</span>
<span class="p">{</span>
    <span class="n">ILGenerator</span> <span class="n">il</span> <span class="p">=</span> <span class="n">execute</span><span class="p">.</span><span class="nf">GetILGenerator</span><span class="p">();</span>
    <span class="n">il</span><span class="p">.</span><span class="nf">Emit</span><span class="p">(</span><span class="n">Ldarg_0</span><span class="p">);</span> <span class="c1">// thisポインタをロード</span>
    <span class="n">il</span><span class="p">.</span><span class="nf">Emit</span><span class="p">(</span><span class="n">Ldfld</span><span class="p">,</span> <span class="n">ptr</span><span class="p">);</span> <span class="c1">// thisポインタの指す先からint*型のフィールドptrをロード（スタック上にプッシュ）</span>
    <span class="n">il</span><span class="p">.</span><span class="nf">Emit</span><span class="p">(</span><span class="n">Ldarg_1</span><span class="p">);</span> <span class="c1">// メソッドの第一引数indexをロード</span>
    <span class="n">il</span><span class="p">.</span><span class="nf">Emit</span><span class="p">(</span><span class="n">Conv_I</span><span class="p">);</span> <span class="c1">// indexをポインタであるIntPtr型に型変換あるいは解釈の変更</span>
    <span class="n">il</span><span class="p">.</span><span class="nf">Emit</span><span class="p">(</span><span class="n">Ldc_I4_4</span><span class="p">);</span> <span class="c1">// 4を掛ける</span>
    <span class="n">il</span><span class="p">.</span><span class="nf">Emit</span><span class="p">(</span><span class="n">Mul</span><span class="p">);</span>
    <span class="n">il</span><span class="p">.</span><span class="nf">Emit</span><span class="p">(</span><span class="n">Add</span><span class="p">);</span> <span class="c1">// ptrの指すアドレスに4 * indexを足す。</span>
    <span class="n">il</span><span class="p">.</span><span class="nf">Emit</span><span class="p">(</span><span class="n">Ldarg_1</span><span class="p">);</span> <span class="c1">// 第一引数のindexという値をスタックにプッシュ</span>
    <span class="n">il</span><span class="p">.</span><span class="nf">Emit</span><span class="p">(</span><span class="n">Stind_I4</span><span class="p">);</span> <span class="c1">// ポインタの指す先に値を代入する。</span>
    <span class="n">il</span><span class="p">.</span><span class="nf">Emit</span><span class="p">(</span><span class="n">Ret</span><span class="p">);</span> <span class="c1">// スタックは空なので何も返さない。</span>
<span class="p">}</span>
</code></pre></div></div>

<p>次にJobHandle Scheudle()メソッドを見てみましょう。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="n">MethodBuilder</span> <span class="n">schedule</span> <span class="p">=</span> <span class="n">typeBuilder</span><span class="p">.</span><span class="nf">DefineMethod</span><span class="p">(</span><span class="s">"Schedule"</span><span class="p">,</span> <span class="n">Attributes</span><span class="p">,</span> <span class="k">typeof</span><span class="p">(</span><span class="n">JobHandle</span><span class="p">),</span> <span class="n">Type</span><span class="p">.</span><span class="n">EmptyTypes</span><span class="p">);</span>
<span class="p">{</span>
    <span class="n">ILGenerator</span> <span class="n">il</span> <span class="p">=</span> <span class="n">schedule</span><span class="p">.</span><span class="nf">GetILGenerator</span><span class="p">();</span>
    <span class="n">LocalBuilder</span> <span class="n">local</span> <span class="p">=</span> <span class="n">il</span><span class="p">.</span><span class="nf">DeclareLocal</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">JobHandle</span><span class="p">));</span>
    <span class="n">il</span><span class="p">.</span><span class="nf">Emit</span><span class="p">(</span><span class="n">Ldarg_0</span><span class="p">);</span> <span class="c1">// thisポインタをロード</span>
    <span class="n">il</span><span class="p">.</span><span class="nf">Emit</span><span class="p">(</span><span class="n">Ldobj</span><span class="p">,</span> <span class="n">typeBuilder</span><span class="p">);</span> <span class="c1">// thisポインタの指す先にある実体をスタック上にロード IJobParallelForExtensions.Schedule&lt;T&gt;(T, int, int, JobHandle)の第一引数</span>
    <span class="n">il</span><span class="p">.</span><span class="nf">Emit</span><span class="p">(</span><span class="n">Ldc_I4</span><span class="p">,</span> <span class="n">COUNT</span><span class="p">);</span> <span class="c1">// 第二引数</span>
    <span class="n">il</span><span class="p">.</span><span class="nf">Emit</span><span class="p">(</span><span class="n">Ldc_I4</span><span class="p">,</span> <span class="m">1024</span><span class="p">);</span> <span class="c1">// 第三引数</span>
    <span class="n">il</span><span class="p">.</span><span class="nf">Emit</span><span class="p">(</span><span class="n">Ldloca_S</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span> <span class="c1">// ローカル変数のアドレスをスタック上にロード</span>
    <span class="n">il</span><span class="p">.</span><span class="nf">Emit</span><span class="p">(</span><span class="n">Initobj</span><span class="p">,</span> <span class="k">typeof</span><span class="p">(</span><span class="n">JobHandle</span><span class="p">));</span> <span class="c1">// ポインタの指す先にJobHandle型の構造体をnewする。構造体なので当然default(JobHandle)</span>
    <span class="n">il</span><span class="p">.</span><span class="nf">Emit</span><span class="p">(</span><span class="n">Ldloc_0</span><span class="p">);</span> <span class="c1">// ローカル変数の値をスタック上にロード</span>
    <span class="n">il</span><span class="p">.</span><span class="nf">EmitCall</span><span class="p">(</span><span class="n">Call</span><span class="p">,</span> <span class="k">typeof</span><span class="p">(</span><span class="n">IJobParallelForExtensions</span><span class="p">).</span><span class="nf">GetMethod</span><span class="p">(</span><span class="k">nameof</span><span class="p">(</span><span class="n">IJobParallelForExtensions</span><span class="p">.</span><span class="n">Schedule</span><span class="p">)).</span><span class="nf">MakeGenericMethod</span><span class="p">(</span><span class="n">typeBuilder</span><span class="p">),</span> <span class="n">Type</span><span class="p">.</span><span class="n">EmptyTypes</span><span class="p">);</span><span class="err">　</span><span class="c1">// 関数呼び出し</span>
    <span class="n">il</span><span class="p">.</span><span class="nf">Emit</span><span class="p">(</span><span class="n">Ret</span><span class="p">);</span> <span class="c1">// スタックにはJobHandleのみが残っているのでこれを返り値とする</span>
<span class="p">}</span>
</code></pre></div></div>

<p>LocalBuilderは初めて出てきましたね。<br>
ILGenerator.DeclareLocalでローカル変数を宣言します。<br>
しかし、ローカル変数に名前がありませんね。実は.NETではローカル変数は無名の存在で、インデックスナンバーで参照される存在なのです。</p>

<p>たとえデフォルト値であったとしても構造体を作成するためには構造体を作成する先のアドレスを取得する必要があります。<br>
今回はローカル変数をわざわざ定義し、ローカル変数のアドレスに対して構造体の初期化を行いました。<br>
そして初期化後にローカル変数をロードしています。かなり回りくどく感じますがshoganai。<br>
そして４つの引数（BURSTJOB, int, int, JobHandle）が揃ったらIJobParallelForExtensions.Schedule&lt;BURSTJOB&gt;を呼びます。<br>
この時、Scheduleがジェネリックメソッドですので型パラメーターを与えるためにMakeGenericMethodメソッドを使いましょう。<br>
これは、MethodInfo MethodInfo.MakeGenericMethod(params Type[] parameters)というメソッドシグネチャです。TypeBuilder型はType型を先祖に持つので問題なく渡せます。</p>

<p>SetPtrは簡単なので解説しません。</p>

<h1>
<span id="第3節-実行結果" class="fragment"></span><a href="#%E7%AC%AC3%E7%AF%80-%E5%AE%9F%E8%A1%8C%E7%B5%90%E6%9E%9C"><i class="fa fa-link"></i></a>第3節 実行結果</h1>

<p>こうして全てのメソッドを実装して動的な構造体を定義し終えました。<br>
さあ、実行してみましょう！</p>

<p>「ガッシ！ボカッ！」<br>
BurstCompilerは死んだ。スイーツ（笑）</p>

<p>Burst CompilerがMono.Cecil.AssemblyResolutionExceptionを吐いて死にました。<br>
どうやら動的に定義されたBurstJobをコンパイルすることができないようです。</p>

<p>本当に、本当に残念でなりません。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="n">typeBuilder</span><span class="p">.</span><span class="nf">SetCustomAttribute</span><span class="p">(</span><span class="k">new</span> <span class="nf">CustomAttributeBuilder</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">BurstCompileAttribute</span><span class="p">).</span><span class="nf">GetConstructor</span><span class="p">(</span><span class="n">Type</span><span class="p">.</span><span class="n">EmptyTypes</span><span class="p">),</span> <span class="n">Array</span><span class="p">.</span><span class="n">Empty</span><span class="p">&lt;</span><span class="kt">object</span><span class="p">&gt;()));</span>
</code></pre></div></div>

<p>をコメントアウトするとBurstコンパイルされずにちゃんとマルチスレッドで動作しました。<br>
実に惜しい話ですね。</p>

<h1>
<span id="感想" class="fragment"></span><a href="#%E6%84%9F%E6%83%B3"><i class="fa fa-link"></i></a>感想</h1>

<p><img alt=":angel:" class="emoji" height="20" src="https://cdn.qiita.com/emoji/twemoji/unicode/1f47c.png" title=":angel:" width="20" loading="lazy"></p>

<p>私の野心的試みは必ず失敗するという呪いでもあるのでしょうか？</p>

<p>ここまでお読みいただきありがとうございました。</p>

<h1>
<span id="宣伝" class="fragment"></span><a href="#%E5%AE%A3%E4%BC%9D"><i class="fa fa-link"></i></a>宣伝</h1>

<p>ヴァーレントゥーガ互換のUnityゲームを現在作っています。<br>
お手伝いいただける方はぜひご連絡ください。</p>

<blockquote class="twitter-tweet">
<p><a href="https://twitter.com/hashtag/%E3%83%B4%E3%82%A1%E3%83%BC%E3%83%AC%E3%83%B3%E3%83%88%E3%82%A5%E3%83%BC%E3%82%AC?src=hash&amp;ref_src=twsrc%5Etfw" rel="nofollow noopener" target="_blank">#ヴァーレントゥーガ</a> をUnityに移植することでMacやLinuxでも動かせるようにするプロジェクト<br>誰かやる気のある人いません？</p>— スーギ・ノウコ自治区 (@pCYSl5EDgo) <a href="https://twitter.com/pCYSl5EDgo/status/1089390911853780995?ref_src=twsrc%5Etfw" rel="nofollow noopener" target="_blank">2019年1月27日</a>
</blockquote>

<script async src="https://platform.twitter.com/widgets.js"></script>

<h1>
<span id="付属" class="fragment"></span><a href="#%E4%BB%98%E5%B1%9E"><i class="fa fa-link"></i></a>付属</h1>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">全体のコード</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Diagnostics</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Unity.Burst</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Unity.Jobs</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Unity.Collections</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Unity.Collections.LowLevel.Unsafe</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Reflection</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Reflection.Emit</span><span class="p">;</span>

<span class="k">using</span> <span class="nn">static</span> <span class="n">System</span><span class="p">.</span><span class="n">Reflection</span><span class="p">.</span><span class="n">Emit</span><span class="p">.</span><span class="n">OpCodes</span><span class="p">;</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">TestManager</span> <span class="p">:</span> <span class="n">MonoBehaviour</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">unsafe</span> <span class="k">interface</span> <span class="nc">IAccessor</span> <span class="p">:</span> <span class="n">IJobParallelFor</span>
    <span class="p">{</span>
        <span class="kt">int</span><span class="p">*</span> <span class="nf">GetPtr</span><span class="p">();</span>
        <span class="k">void</span> <span class="nf">SetPtr</span><span class="p">(</span><span class="kt">int</span><span class="p">*</span> <span class="k">value</span><span class="p">);</span>
        <span class="n">JobHandle</span> <span class="nf">Schedule</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">COUNT</span> <span class="p">=</span> <span class="m">50000</span><span class="p">;</span>
    <span class="n">IAccessor</span> <span class="n">accessor</span><span class="p">;</span>

    <span class="k">void</span> <span class="nf">Start</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">const</span> <span class="kt">string</span> <span class="n">ModuleName</span> <span class="p">=</span> <span class="s">"Hoge"</span><span class="p">;</span>
        <span class="k">const</span> <span class="kt">string</span> <span class="n">FileName</span> <span class="p">=</span> <span class="n">ModuleName</span> <span class="p">+</span> <span class="s">".dll"</span><span class="p">;</span>
        <span class="n">AssemblyBuilder</span> <span class="n">assemblyBuilder</span> <span class="p">=</span> <span class="n">AssemblyBuilder</span><span class="p">.</span><span class="nf">DefineDynamicAssembly</span><span class="p">(</span><span class="k">new</span> <span class="nf">AssemblyName</span><span class="p">(</span><span class="n">ModuleName</span><span class="p">),</span> <span class="n">AssemblyBuilderAccess</span><span class="p">.</span><span class="n">RunAndSave</span><span class="p">);</span>
        <span class="kt">var</span> <span class="n">moduleBulder</span> <span class="p">=</span> <span class="n">assemblyBuilder</span><span class="p">.</span><span class="nf">DefineDynamicModule</span><span class="p">(</span><span class="n">ModuleName</span><span class="p">,</span> <span class="n">FileName</span><span class="p">);</span>
        <span class="kt">var</span> <span class="n">typeBuilder</span> <span class="p">=</span> <span class="n">moduleBulder</span><span class="p">.</span><span class="nf">DefineType</span><span class="p">(</span><span class="s">"BURSTJOB"</span><span class="p">,</span>
            <span class="n">TypeAttributes</span><span class="p">.</span><span class="n">Public</span> <span class="p">|</span> <span class="n">TypeAttributes</span><span class="p">.</span><span class="n">AnsiClass</span> <span class="p">|</span> <span class="n">TypeAttributes</span><span class="p">.</span><span class="n">Sealed</span> <span class="p">|</span> <span class="n">TypeAttributes</span><span class="p">.</span><span class="n">SequentialLayout</span><span class="p">,</span>
            <span class="k">typeof</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="n">ValueType</span><span class="p">),</span>
            <span class="k">new</span> <span class="n">Type</span><span class="p">[]</span> <span class="p">{</span> <span class="k">typeof</span><span class="p">(</span><span class="n">IAccessor</span><span class="p">),</span> <span class="k">typeof</span><span class="p">(</span><span class="n">IJobParallelFor</span><span class="p">)</span> <span class="p">});</span>
        <span class="n">typeBuilder</span><span class="p">.</span><span class="nf">SetCustomAttribute</span><span class="p">(</span><span class="k">new</span> <span class="nf">CustomAttributeBuilder</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">BurstCompileAttribute</span><span class="p">).</span><span class="nf">GetConstructor</span><span class="p">(</span><span class="n">Type</span><span class="p">.</span><span class="n">EmptyTypes</span><span class="p">),</span> <span class="n">Array</span><span class="p">.</span><span class="n">Empty</span><span class="p">&lt;</span><span class="kt">object</span><span class="p">&gt;()));</span>
        <span class="kt">var</span> <span class="n">intPtrType</span> <span class="p">=</span> <span class="k">typeof</span><span class="p">(</span><span class="kt">int</span><span class="p">).</span><span class="nf">MakePointerType</span><span class="p">();</span>
        <span class="kt">var</span> <span class="n">ptr</span> <span class="p">=</span> <span class="n">typeBuilder</span><span class="p">.</span><span class="nf">DefineField</span><span class="p">(</span><span class="s">"ptr"</span><span class="p">,</span>
            <span class="n">intPtrType</span><span class="p">,</span>
            <span class="n">FieldAttributes</span><span class="p">.</span><span class="n">Public</span><span class="p">);</span>
        <span class="n">ptr</span><span class="p">.</span><span class="nf">SetCustomAttribute</span><span class="p">(</span><span class="k">new</span> <span class="nf">CustomAttributeBuilder</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">NativeDisableUnsafePtrRestrictionAttribute</span><span class="p">).</span><span class="nf">GetConstructor</span><span class="p">(</span><span class="n">Type</span><span class="p">.</span><span class="n">EmptyTypes</span><span class="p">),</span> <span class="n">Array</span><span class="p">.</span><span class="n">Empty</span><span class="p">&lt;</span><span class="kt">object</span><span class="p">&gt;()));</span>
        <span class="k">const</span> <span class="n">MethodAttributes</span> <span class="n">Attributes</span> <span class="p">=</span> <span class="n">MethodAttributes</span><span class="p">.</span><span class="n">Public</span> <span class="p">|</span> <span class="n">MethodAttributes</span><span class="p">.</span><span class="n">Virtual</span> <span class="p">|</span> <span class="n">MethodAttributes</span><span class="p">.</span><span class="n">Final</span> <span class="p">|</span> <span class="n">MethodAttributes</span><span class="p">.</span><span class="n">NewSlot</span> <span class="p">|</span> <span class="n">MethodAttributes</span><span class="p">.</span><span class="n">HideBySig</span><span class="p">;</span>
        <span class="kt">var</span> <span class="n">schedule</span> <span class="p">=</span> <span class="n">typeBuilder</span><span class="p">.</span><span class="nf">DefineMethod</span><span class="p">(</span><span class="s">"Schedule"</span><span class="p">,</span> <span class="n">Attributes</span><span class="p">,</span> <span class="k">typeof</span><span class="p">(</span><span class="n">JobHandle</span><span class="p">),</span> <span class="n">Type</span><span class="p">.</span><span class="n">EmptyTypes</span><span class="p">);</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">il</span> <span class="p">=</span> <span class="n">schedule</span><span class="p">.</span><span class="nf">GetILGenerator</span><span class="p">();</span>
            <span class="kt">var</span> <span class="n">local</span> <span class="p">=</span> <span class="n">il</span><span class="p">.</span><span class="nf">DeclareLocal</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">JobHandle</span><span class="p">));</span>
            <span class="n">il</span><span class="p">.</span><span class="nf">Emit</span><span class="p">(</span><span class="n">Ldarg_0</span><span class="p">);</span>
            <span class="n">il</span><span class="p">.</span><span class="nf">Emit</span><span class="p">(</span><span class="n">Ldobj</span><span class="p">,</span> <span class="n">typeBuilder</span><span class="p">);</span>
            <span class="n">il</span><span class="p">.</span><span class="nf">Emit</span><span class="p">(</span><span class="n">Ldc_I4</span><span class="p">,</span> <span class="n">COUNT</span><span class="p">);</span>
            <span class="n">il</span><span class="p">.</span><span class="nf">Emit</span><span class="p">(</span><span class="n">Ldc_I4</span><span class="p">,</span> <span class="m">1024</span><span class="p">);</span>
            <span class="n">il</span><span class="p">.</span><span class="nf">Emit</span><span class="p">(</span><span class="n">Ldloca_S</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
            <span class="n">il</span><span class="p">.</span><span class="nf">Emit</span><span class="p">(</span><span class="n">Initobj</span><span class="p">,</span> <span class="k">typeof</span><span class="p">(</span><span class="n">JobHandle</span><span class="p">));</span>
            <span class="n">il</span><span class="p">.</span><span class="nf">Emit</span><span class="p">(</span><span class="n">Ldloc_0</span><span class="p">);</span>
            <span class="n">il</span><span class="p">.</span><span class="nf">EmitCall</span><span class="p">(</span><span class="n">Call</span><span class="p">,</span> <span class="k">typeof</span><span class="p">(</span><span class="n">IJobParallelForExtensions</span><span class="p">).</span><span class="nf">GetMethod</span><span class="p">(</span><span class="k">nameof</span><span class="p">(</span><span class="n">IJobParallelForExtensions</span><span class="p">.</span><span class="n">Schedule</span><span class="p">)).</span><span class="nf">MakeGenericMethod</span><span class="p">(</span><span class="n">typeBuilder</span><span class="p">),</span> <span class="n">Type</span><span class="p">.</span><span class="n">EmptyTypes</span><span class="p">);</span>
            <span class="n">il</span><span class="p">.</span><span class="nf">Emit</span><span class="p">(</span><span class="n">Ret</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="kt">var</span> <span class="n">execute</span> <span class="p">=</span> <span class="n">typeBuilder</span><span class="p">.</span><span class="nf">DefineMethod</span><span class="p">(</span><span class="s">"Execute"</span><span class="p">,</span> <span class="n">Attributes</span><span class="p">,</span> <span class="k">typeof</span><span class="p">(</span><span class="k">void</span><span class="p">),</span> <span class="k">new</span> <span class="n">Type</span><span class="p">[]</span> <span class="p">{</span> <span class="k">typeof</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">});</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">il</span> <span class="p">=</span> <span class="n">execute</span><span class="p">.</span><span class="nf">GetILGenerator</span><span class="p">();</span>
            <span class="n">il</span><span class="p">.</span><span class="nf">Emit</span><span class="p">(</span><span class="n">Ldarg_0</span><span class="p">);</span>
            <span class="n">il</span><span class="p">.</span><span class="nf">Emit</span><span class="p">(</span><span class="n">Ldfld</span><span class="p">,</span> <span class="n">ptr</span><span class="p">);</span>
            <span class="n">il</span><span class="p">.</span><span class="nf">Emit</span><span class="p">(</span><span class="n">Ldarg_1</span><span class="p">);</span>
            <span class="n">il</span><span class="p">.</span><span class="nf">Emit</span><span class="p">(</span><span class="n">Conv_I</span><span class="p">);</span>
            <span class="n">il</span><span class="p">.</span><span class="nf">Emit</span><span class="p">(</span><span class="n">Ldc_I4_4</span><span class="p">);</span>
            <span class="n">il</span><span class="p">.</span><span class="nf">Emit</span><span class="p">(</span><span class="n">Mul</span><span class="p">);</span>
            <span class="n">il</span><span class="p">.</span><span class="nf">Emit</span><span class="p">(</span><span class="n">Add</span><span class="p">);</span>
            <span class="n">il</span><span class="p">.</span><span class="nf">Emit</span><span class="p">(</span><span class="n">Ldarg_1</span><span class="p">);</span>
            <span class="n">il</span><span class="p">.</span><span class="nf">Emit</span><span class="p">(</span><span class="n">Stind_I4</span><span class="p">);</span>
            <span class="n">il</span><span class="p">.</span><span class="nf">Emit</span><span class="p">(</span><span class="n">Ret</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="kt">var</span> <span class="n">setPtr</span> <span class="p">=</span> <span class="n">typeBuilder</span><span class="p">.</span><span class="nf">DefineMethod</span><span class="p">(</span><span class="s">"SetPtr"</span><span class="p">,</span> <span class="n">Attributes</span><span class="p">+,</span> <span class="k">typeof</span><span class="p">(</span><span class="k">void</span><span class="p">),</span> <span class="k">new</span><span class="p">[]</span> <span class="p">{</span> <span class="n">intPtrType</span> <span class="p">});</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">il</span> <span class="p">=</span> <span class="n">setPtr</span><span class="p">.</span><span class="nf">GetILGenerator</span><span class="p">();</span>
            <span class="n">il</span><span class="p">.</span><span class="nf">Emit</span><span class="p">(</span><span class="n">Ldarg_0</span><span class="p">);</span>
            <span class="n">il</span><span class="p">.</span><span class="nf">Emit</span><span class="p">(</span><span class="n">Ldarg_1</span><span class="p">);</span>
            <span class="n">il</span><span class="p">.</span><span class="nf">Emit</span><span class="p">(</span><span class="n">Stfld</span><span class="p">,</span> <span class="n">ptr</span><span class="p">);</span>
            <span class="n">il</span><span class="p">.</span><span class="nf">Emit</span><span class="p">(</span><span class="n">Ret</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="kt">var</span> <span class="n">getPtr</span> <span class="p">=</span> <span class="n">typeBuilder</span><span class="p">.</span><span class="nf">DefineMethod</span><span class="p">(</span><span class="s">"GetPtr"</span><span class="p">,</span> <span class="n">Attributes</span><span class="p">,</span> <span class="n">intPtrType</span><span class="p">,</span> <span class="n">Type</span><span class="p">.</span><span class="n">EmptyTypes</span><span class="p">);</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">il</span> <span class="p">=</span> <span class="n">getPtr</span><span class="p">.</span><span class="nf">GetILGenerator</span><span class="p">();</span>
            <span class="n">il</span><span class="p">.</span><span class="nf">Emit</span><span class="p">(</span><span class="n">Ldarg_0</span><span class="p">);</span>
            <span class="n">il</span><span class="p">.</span><span class="nf">Emit</span><span class="p">(</span><span class="n">Ldfld</span><span class="p">,</span> <span class="n">ptr</span><span class="p">);</span>
            <span class="n">il</span><span class="p">.</span><span class="nf">Emit</span><span class="p">(</span><span class="n">Ret</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">accessor</span> <span class="p">=</span> <span class="p">(</span><span class="n">IAccessor</span><span class="p">)</span><span class="n">Activator</span><span class="p">.</span><span class="nf">CreateInstance</span><span class="p">(</span><span class="n">typeBuilder</span><span class="p">.</span><span class="nf">CreateType</span><span class="p">());</span>
        <span class="n">assemblyBuilder</span><span class="p">.</span><span class="nf">Save</span><span class="p">(</span><span class="n">FileName</span><span class="p">);</span>
        <span class="nf">Verify</span><span class="p">(</span><span class="n">assemblyBuilder</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">unsafe</span> <span class="k">void</span> <span class="nf">Update</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">array</span> <span class="p">=</span> <span class="k">new</span> <span class="n">NativeArray</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;(</span><span class="n">COUNT</span><span class="p">,</span> <span class="n">Allocator</span><span class="p">.</span><span class="n">TempJob</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">accessor</span><span class="p">.</span><span class="nf">SetPtr</span><span class="p">((</span><span class="kt">int</span><span class="p">*)</span><span class="n">array</span><span class="p">.</span><span class="nf">GetUnsafePtr</span><span class="p">());</span>
            <span class="n">accessor</span><span class="p">.</span><span class="nf">Schedule</span><span class="p">().</span><span class="nf">Complete</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">static</span> <span class="k">void</span> <span class="nf">Verify</span><span class="p">(</span><span class="k">params</span> <span class="n">AssemblyBuilder</span><span class="p">[]</span> <span class="n">builders</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">path</span> <span class="p">=</span> <span class="s">@"C:\Program Files (x86)\Microsoft SDKs\Windows\v10.0A\bin\NETFX 4.7.2 Tools\x64\PEVerify.exe"</span><span class="p">;</span>

        <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">targetDll</span> <span class="k">in</span> <span class="n">builders</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">psi</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ProcessStartInfo</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">targetDll</span><span class="p">.</span><span class="nf">GetName</span><span class="p">().</span><span class="n">Name</span> <span class="p">+</span> <span class="s">".dll"</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">CreateNoWindow</span> <span class="p">=</span> <span class="k">true</span><span class="p">,</span>
                <span class="n">WindowStyle</span> <span class="p">=</span> <span class="n">ProcessWindowStyle</span><span class="p">.</span><span class="n">Hidden</span><span class="p">,</span>
                <span class="n">RedirectStandardOutput</span> <span class="p">=</span> <span class="k">true</span><span class="p">,</span>
                <span class="n">RedirectStandardError</span> <span class="p">=</span> <span class="k">true</span><span class="p">,</span>
                <span class="n">UseShellExecute</span> <span class="p">=</span> <span class="k">false</span>
            <span class="p">};</span>

            <span class="kt">var</span> <span class="n">p</span> <span class="p">=</span> <span class="n">Process</span><span class="p">.</span><span class="nf">Start</span><span class="p">(</span><span class="n">psi</span><span class="p">);</span>
            <span class="kt">var</span> <span class="n">data</span> <span class="p">=</span> <span class="n">p</span><span class="p">.</span><span class="n">StandardOutput</span><span class="p">.</span><span class="nf">ReadToEnd</span><span class="p">();</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2FpCYSl5EDgo%2Fitems%2F9af7f5f1efaf8cd4ccdc&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2FpCYSl5EDgo%2Fitems%2F9af7f5f1efaf8cd4ccdc&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/pCYSl5EDgo/items/9af7f5f1efaf8cd4ccdc/likers" class="css-1iupg5d">13</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">8</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/9af7f5f1efaf8cd4ccdc/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/pCYSl5EDgo/items/9af7f5f1efaf8cd4ccdc/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/pCYSl5EDgo/items/9af7f5f1efaf8cd4ccdc/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/pCYSl5EDgo/items/9af7f5f1efaf8cd4ccdc/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/pCYSl5EDgo/items/9af7f5f1efaf8cd4ccdc.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-2c1ec040-4a07-4101-92da-a7bc0449df5d">{"authorAnalyticsTrackingId":null,"organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-bd9990f6-2707-4f12-978a-147bbcc2880f"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-bd9990f6-2707-4f12-978a-147bbcc2880f">{}</script>
      
<div id="LoginModal-react-component-a4d0abeb-9567-4640-995d-ef49c96bb9d1"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-a4d0abeb-9567-4640-995d-ef49c96bb9d1">{}</script>
      
<div id="StockModal-react-component-65b93036-cf44-4d49-bd7d-ed0ab0c24b78"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-65b93036-cf44-4d49-bd7d-ed0ab0c24b78">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;mYAaQyo0EMeEnBwqtfYGjnAGSAP8FbKmS/QnvmTL9J2nXX+kjwx8L3uGNMLej+76yV4w43DzY0nceqLQGqSE6A==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\u003cp\u003e初投稿です（ガバガバ）。\u003c/p\u003e\n\n\u003cp\u003e私は\u003ca href=\"https://www28.atwiki.jp/vahren_ency/pages/1028.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eヴァーレントゥーガ\u003c/a\u003eが好きです。\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eヴァーレントゥーガは、ななあし氏が制作した国取りタイプ戦略シミュレーションゲームです。敵軍の動きや地形を考慮しながら自軍の兵士をリアルタイムで動かす戦闘システムや、ファンタジー世界を舞台とした壮大なストーリーが数多くのプレイヤーから人気を得ています。\u003cbr\u003e\n一方、ヴァーレントゥーガは、完成度の高い戦闘システムを引き継ぎながら、ユーザーが独自のシナリオを作り公開することが可能なゲーム制作ツールとして、作者のななあし氏が仕様を公開しています。\u003cbr\u003e\nそこからは、多くの派生作品が生み出されてきました。その中には、ニコニコ自作ゲームフェス4でフリーゲーム夢現賞を受賞した「LostTechnology」や海外展開を準備中の「きのこ・たけのこ戦争IF」など、派生元であるヴァーレントゥーガに負けず劣らず高い評価を得ている作品も数多くあります。\u003cbr\u003e\n高い完成度を誇る戦略シミュレーションゲームとして、また多くの派生作品を生み出したゲーム制作ツールとして、自作ゲームのコミュニティに偉大な貢献を残しており、まさにゲーム史における重要な存在であるといえます。\u003cbr\u003e\n\u003ca href=\"http://info.nicovideo.jp/gamemaga/ganma/vt.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003e銃魔のレザネーションのヴァーレントゥーガ紹介ページ\u003c/a\u003eより引用\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eヴァーレントゥーガは2018年に開発が終了しています。\u003cbr\u003e\n（今後新たな機能が追加されることは）ないです。\u003c/p\u003e\n\n\u003cp\u003e機能が安定したのを受け（）、私は数年前からUnity C#でヴァーレントゥーガ互換ソフトであるWahrenを開発しています。\u003cbr\u003e\nヴァーレントゥーガは作者の漏らしたコメントから推察するにVisual C++でDirectX9を使用して作成されているはずです。\u003cbr\u003e\n故にユーザー作成の独自シナリオを実現している方法はよほど頭のおかしい技術を使用していない限りインタプリタであることは明白です。\u003cbr\u003e\nインタプリタが遅いのは日本書紀にも書いてあるぐらい自明の理です。\u003cbr\u003e\n故に私は.NETの特長であるJITを活かすべく、ユーザーのオリジナルシナリオのソースコードを動的に構文解析し、ILを吐いてAssemblyを作成することでPure C#並の速度を出そうと試みています。\u003c/p\u003e\n\n\u003cp\u003eUnity 2018.1から新たに登場した機能であるBurst Compiler（記事執筆時点でバージョン0.2.4-preview.41）を使用することで高速な並列計算を実現することが可能です。\u003cbr\u003e\nそこで、今回はBurst Compilerを利用する並列計算を行う構造体を動的に定義してみました。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"第1節-設計\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%AC%AC1%E7%AF%80-%E8%A8%AD%E8%A8%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e第1節 設計\u003c/h1\u003e\n\n\u003cp\u003e動的IL生成について私が\u003ca href=\"https://qiita.com/pCYSl5EDgo/items/4a5cc446553f4d99a7f3\" id=\"reference-90341c1cb911e3f55662\"\u003e今まで書いてきた記事\u003c/a\u003eはSystem.Reflection.Emit.DynamicMethodを利用してきました。\u003cbr\u003e\nこれはトリッキーなこと（privateメンバへのアクセス）を行うならば非常に重宝するのですが、メソッドしか作れず、構造体を作ることができません。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"assemblybuildermodulebuilder\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#assemblybuildermodulebuilder\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eAssemblyBuilder\u0026amp;ModuleBuilder\u003c/h2\u003e\n\n\u003cp\u003e今回はアセンブリから作っていきましょう。\u003cbr\u003e\nアセンブリば大体DLLみたいなものと思っていただければ大丈夫です。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// using System.Reflection;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// using System.Reflection.Emit;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eModuleName\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Hoge\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eFileName\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eModuleName\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\".dll\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003eAssemblyBuilder\u003c/span\u003e \u003cspan class=\"n\"\u003eassemblyBuilder\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eAssemblyBuilder\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDefineDynamicAssembly\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eAssemblyName\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eModuleName\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003eAssemblyBuilderAccess\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRunAndSave\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003eModuleBuilder\u003c/span\u003e \u003cspan class=\"n\"\u003emoduleBulder\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eassemblyBuilder\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDefineDynamicModule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eModuleName\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eFileName\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e動的に定義する場合AssemblyBuilder.DefineDynamicAssembly静的メソッドを使用します。\u003cbr\u003e\nこの第一引数には何故かstring型ではなくAssemblyName型でアセンブリ名を与えます。\u003cbr\u003e\n第二引数はRunあるいはRunAndSaveを選びます。RunAndSaveの方がデバッガビリティが高いのでよいでしょう。\u003c/p\u003e\n\n\u003cp\u003eアセンブリは必ず１つはモジュールを持ちます。\u003cbr\u003e\n複数モジュールを持つことはできますが、MSBuildはその操作をサポートしていないので考慮せずともよいでしょう。\u003cbr\u003e\nこのModuleBuilder型のオブジェクトに対してクラスや構造体や列挙型をごりごり定義していくことで大規模IL動的生成を行うのが主流です。\u003cbr\u003e\nstatic変数にでも持たせるのがいいのではないですかね。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"typebuilder\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#typebuilder\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eTypeBuilder\u003c/h2\u003e\n\n\u003cp\u003e今回はUnity.Jobs.IJobParallelForを実装したBurstJobな構造体を定義していきます。\u003cbr\u003e\nTypeBuilderでメソッドやフィールド、プロパティにインナークラスなど諸々全てを定義し終えた後、Type TypeBuilder.CreateType()インスタンスメソッドを呼び出すことでTypeオブジェクトを得られます。\u003cbr\u003e\nそしてその戻り値のTypeオブジェクトを引数に取るobject System.Activator.CreateInstance(Type t)静的メソッドによって動的に定義された構造体のインスタンス（がBOX化されたもの）が得られるのです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eIJobParalleFor\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eUnity.Jobs.LowLevel.Unsafe\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eUnity.Jobs\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eJobProducerType\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIJobParallelForExtensions\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eParallelForJobStruct\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u0026gt;))]\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003einterface\u003c/span\u003e \u003cspan class=\"nc\"\u003eIJobParallelFor\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eExecute\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eJobParallelForを実装した構造体を第一引数に指定して、Unity.Jobs.JobHandle Unity.Jobs.IJobParallelForExtensions.Schedule\u0026lt;T\u0026gt;(T job, int arrayLength, int innerLoopBatchCount, Unity.Jobs.JobHandle) where T : struct静的メソッドを呼ぶことでマルチスレッドで良い感じに並列計算が実行されるようになります。\u003c/p\u003e\n\n\u003cp\u003eよって、今回動的に生成するコードはC#で擬似コードを提示しますと次のような形である必要があります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eUnity\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBurst\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBurstCompile\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eunsafe\u003c/span\u003e \u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"nc\"\u003eBURSTJOB\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eUnity\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eJobs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIJobParallelFor\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eUnity\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eJobs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLowLevel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUnsafe\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNativeDisableUnsafePtrRestriction\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003eptr\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eExecute\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eptr\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eいや、まあこれだけだとまともに動作できないのですが。\u003cbr\u003e\n問題点は2つあります。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eBURSTJOB型に型変換できないのでint*型のフィールドptrに設定できない\u003c/li\u003e\n\u003cli\u003eIJobParallelForインターフェース型に型変換したとしてもUnity.Jobs.JobHandle Unity.Jobs.IJobParallelForExtensions.Schedule\u0026lt;T\u0026gt;(T job, int arrayLength, int innerLoopBatchCount, Unity.Jobs.JobHandle) where T : struct静的メソッドの型制約にひっかかる為並列計算できない\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eよってこの２つの問題を解決するために新たに次のインターフェースを用意し、BURSTJOB構造体にこれを実装しましょう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eUnity.Jobs\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eUnity.Jobs.LowLevel.Unsafe\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eUnity.Burst\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eCOUNT\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e50000\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eunsafe\u003c/span\u003e \u003cspan class=\"k\"\u003einterface\u003c/span\u003e \u003cspan class=\"nc\"\u003eIAccessor\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIJobParallelFor\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetPtr\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eSetPtr\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eJobHandle\u003c/span\u003e \u003cspan class=\"nf\"\u003eSchedule\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eBurstCompile\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eunsafe\u003c/span\u003e \u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"nc\"\u003eBURSTJOB\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIAccessor\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eNativeDisableUnsafePtrRestriction\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003eptr\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eExecute\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eptr\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eJobHandle\u003c/span\u003e \u003cspan class=\"nf\"\u003eSchedule\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eIJobParallelForExtensions\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSchedule\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eBURSTJOB\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eCOUNT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e1024\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003edefault\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eJobHandle\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eSetPtr\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eptr\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetPtr\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eptr\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこうすればActivator.CreateInsatnaceでインスタンス化したオブジェクトをIAccessorに型変換することでポインタPtrを設定し、かつIJobParallelForExtensions.Scheduleを呼び出すことが可能となります。\u003cbr\u003e\n具体的には以下のようにUpdateマジックメソッド内から呼びます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eCOUNT\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e50000\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eunsafe\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eUpdate\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003earray\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eNativeArray\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"n\"\u003eCOUNT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eAllocator\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTempJob\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eaccessor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSetPtr\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e*)\u003c/span\u003e\u003cspan class=\"n\"\u003earray\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetUnsafePtr\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eJobHandle\u003c/span\u003e \u003cspan class=\"n\"\u003ehandle\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eaccessor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSchedule\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e \u003cspan class=\"c1\"\u003e// マルチスレッド並列計算を発行する。\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ehandle\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eComplete\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 同期的に完了を待機する。\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eさあ、事前の設計と擬似コードは以上で十分でしょう。これから構造体を定義しましょう。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"第2節-型を捏ねる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%AC%AC2%E7%AF%80-%E5%9E%8B%E3%82%92%E6%8D%8F%E3%81%AD%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e第2節 型を捏ねる\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"概形\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%A6%82%E5%BD%A2\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e概形\u003c/h2\u003e\n\n\u003cp\u003eBURSTJOB型を定義しましょう。この型は構造体で、IAccessorを実装しています。故に以下のように記述して概形を定義します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eStart()マジックメソッド内から抜粋(1)\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eTypeBuilder\u003c/span\u003e \u003cspan class=\"n\"\u003etypeBuilder\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emoduleBulder\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDefineType\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"BURSTJOB\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eTypeAttributes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePublic\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003eTypeAttributes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAnsiClass\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003eTypeAttributes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSealed\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003eTypeAttributes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSequentialLayout\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValueType\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n    \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eType\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIAccessor\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIJobParallelFor\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003cspan class=\"n\"\u003etypeBuilder\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSetCustomAttribute\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eCustomAttributeBuilder\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eBurstCompileAttribute\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetConstructor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEmptyTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003eArray\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEmpty\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eobject\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;()));\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003epublic TypeBuilder DefineType(string name, TypeAttributes attr, Type parent, Type[] interfaces);\u003cbr\u003e\n第一引数で型の名前を、第二引数で型の概形を、第三引数で基底型を、第四引数で実装するインターフェース（継承した基底インターフェースを含む）全てを指定することでTypeBuilderオブジェクトを戻します。\u003cbr\u003e\n名前はそのまま\"BURSTJOB\"。\u003cbr\u003e\n型の概形は一般的な構造体のそれを指定しています。読者の皆さんが構造体を動的に定義するならばこのTypeAttributesをそのままコピペして使うといいでしょう。\u003cbr\u003e\nIAccessorインターフェースはIJobParallelForインターフェースを継承しているため、ModuleBuilder.DefineTypeメソッドの引数に継承元であるIJobParallelFor型を表すTypeオブジェクトを渡しています。\u003cbr\u003e\n.NETにおける構造体は全てSystem.ValueType型から派生しているため基底型に指定します。\u003cbr\u003e\nそしてTypeBuilder.SetCustomAttrbuteインスタンスメソッドを呼ぶことでこの型に対してつけられた属性を表現します。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"フィールド\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%95%E3%82%A3%E3%83%BC%E3%83%AB%E3%83%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eフィールド\u003c/h2\u003e\n\n\u003cp\u003e次にフィールドを定義してあげましょう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eStart()マジックメソッド内から抜粋(2)\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eType\u003c/span\u003e \u003cspan class=\"n\"\u003eintPtrType\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eMakePointerType\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"n\"\u003eFieldBuilder\u003c/span\u003e \u003cspan class=\"n\"\u003eptr\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etypeBuilder\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDefineField\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"ptr\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eintPtrType\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eFieldAttributes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePublic\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003efield0\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSetCustomAttribute\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eCustomAttributeBuilder\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eNativeDisableUnsafePtrRestrictionAttribute\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetConstructor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEmptyTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003eArray\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEmpty\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eobject\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;()));\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eint*を表すTypeオブジェクトを結構いろいろな箇所で必要としているのですが、typeof(int*)という表記法はC#において認められていません。\u003cbr\u003e\nそのため、Type.MakePointerTypeインスタンスメソッドを使用してint型を表すTypeオブジェクトからint*を表すTypeオブジェクトを作成します。ちなみに参照ref intを表すTypeオブジェクトを作るならばMakeByRefTypeメソッドを使います。\u003cbr\u003e\nこのフィールドには[NativeDisableUnsafePtrRestriction]属性を付与しなくてはならないので、BURSTJOB構造体に対して行ったように属性を付与しましょう。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"メソッド\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eメソッド\u003c/h2\u003e\n\n\u003cp\u003eBURSTJOB構造体に定義されたメソッドは全てIAccessorとIJobParallelForインターフェースで定義されたメソッドです。\u003cbr\u003e\n故にこの記事ではオーバーライドしか扱いません。\u003c/p\u003e\n\n\u003cp\u003eでは、一番単純なint* GetPtrメソッドをまずは見てみましょう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eStart()マジックメソッド内から抜粋(3)\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// using static System.Reflection.Emmit.OpCodes;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003eMethodAttributes\u003c/span\u003e \u003cspan class=\"n\"\u003eAttributes\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eMethodAttributes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePublic\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003eMethodAttributes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eVirtual\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003eMethodAttributes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFinal\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003eMethodAttributes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNewSlot\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003eMethodAttributes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eHideBySig\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003eMethodBuilder\u003c/span\u003e \u003cspan class=\"n\"\u003egetPtr\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etypeBuilder\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDefineMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"GetPtr\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eAttributes\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eintPtrType\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEmptyTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eILGenerator\u003c/span\u003e \u003cspan class=\"n\"\u003eil\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003egetPtr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetILGenerator\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eil\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEmit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLdarg_0\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eil\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEmit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLdfld\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eptr\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eil\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEmit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eRet\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eMethodBuilder DefineMethod(string name, MethodAttributes attributes, Type returnType, Type[] parameterTypes);\u003cbr\u003e\n第一引数はメソッドの名前で、第二引数にメソッドの性質を指定します。\u003cbr\u003e\n今回はpublicで仮想メソッドをオーバーライドし、構造体なのでsealed(final)でこれ以上VTableを検索しない、と指定しています。（HideBySigとNewSlot？こまけえこたあいいんだよ！）\u003cbr\u003e\n第三引数に戻り値の型を定義し、第四引数に引数の型を定義します。引数がないメソッドならばType.EmptyTypesを渡してあげましょう。（System.Array.Empty()でもよさげですが、EmptyTypesはstatic readonlyフィールドなので微々たる差ですが高速に動作します。）\u003c/p\u003e\n\n\u003cp\u003eそして、ILGenerator MethodBuilder.GetILGenerator()でとうとうILをガリガリ書いていきましょう！\u003cbr\u003e\nILGenerator.Emitメソッドの第一引数にOpCodesオブジェクトを渡し、第二引数以後にその補足を足す、という形でILを動的に出力します。\u003cbr\u003e\nOpCodes毎に補足が不要だったり、補足の型が千差万別なのにEmitメソッドばかりなのは実際バグの温床で使いにくいです。ここの辺りの辛さを大分緩和してくれるライブラリに\u003ca href=\"https://github.com/kevin-montrose/Sigil\" rel=\"nofollow noopener\" target=\"_blank\"\u003eSigil\u003c/a\u003eというものがあります。興味のある方は学んでみても良いと思います。\u003c/p\u003e\n\n\u003cp\u003eIL部分でやっていることはメソッドの第一引数からフィールドptrの値をスタックに積んで戻り値としているだけです。\u003c/p\u003e\n\n\u003cp\u003e次にvoid Execute(int index) =\u0026gt; ptr[index] = index;を見てみましょう。\u003cbr\u003e\nこれはポインタ演算が絡むのでやや複雑性が高いですが、慣れればそんなでもありません。\u003cbr\u003e\n戻り値がないvoidなメソッドの戻り値の型はtypeof(void)です。\u003cbr\u003e\nIL部分の解説はコード中のコメントを読んでください。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eMethodBuilder\u003c/span\u003e \u003cspan class=\"n\"\u003eexecute\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etypeBuilder\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDefineMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Execute\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eAttributes\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003evoid\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eType\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eILGenerator\u003c/span\u003e \u003cspan class=\"n\"\u003eil\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eexecute\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetILGenerator\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eil\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEmit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLdarg_0\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e// thisポインタをロード\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eil\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEmit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLdfld\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eptr\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e// thisポインタの指す先からint*型のフィールドptrをロード（スタック上にプッシュ）\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eil\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEmit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLdarg_1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e// メソッドの第一引数indexをロード\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eil\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEmit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eConv_I\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e// indexをポインタであるIntPtr型に型変換あるいは解釈の変更\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eil\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEmit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLdc_I4_4\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 4を掛ける\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eil\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEmit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eMul\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eil\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEmit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ptrの指すアドレスに4 * indexを足す。\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eil\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEmit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLdarg_1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 第一引数のindexという値をスタックにプッシュ\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eil\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEmit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eStind_I4\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ポインタの指す先に値を代入する。\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eil\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEmit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eRet\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e// スタックは空なので何も返さない。\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e次にJobHandle Scheudle()メソッドを見てみましょう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eMethodBuilder\u003c/span\u003e \u003cspan class=\"n\"\u003eschedule\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etypeBuilder\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDefineMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Schedule\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eAttributes\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eJobHandle\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003eType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEmptyTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eILGenerator\u003c/span\u003e \u003cspan class=\"n\"\u003eil\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eschedule\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetILGenerator\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eLocalBuilder\u003c/span\u003e \u003cspan class=\"n\"\u003elocal\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eil\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDeclareLocal\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eJobHandle\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eil\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEmit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLdarg_0\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e// thisポインタをロード\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eil\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEmit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLdobj\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etypeBuilder\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e// thisポインタの指す先にある実体をスタック上にロード IJobParallelForExtensions.Schedule\u0026lt;T\u0026gt;(T, int, int, JobHandle)の第一引数\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eil\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEmit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLdc_I4\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eCOUNT\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 第二引数\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eil\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEmit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLdc_I4\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e1024\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 第三引数\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eil\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEmit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLdloca_S\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ローカル変数のアドレスをスタック上にロード\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eil\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEmit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eInitobj\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eJobHandle\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ポインタの指す先にJobHandle型の構造体をnewする。構造体なので当然default(JobHandle)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eil\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEmit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLdloc_0\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ローカル変数の値をスタック上にロード\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eil\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEmitCall\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eCall\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIJobParallelForExtensions\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enameof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIJobParallelForExtensions\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSchedule\u003c/span\u003e\u003cspan class=\"p\"\u003e)).\u003c/span\u003e\u003cspan class=\"nf\"\u003eMakeGenericMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etypeBuilder\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003eType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEmptyTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\u003cspan class=\"err\"\u003e　\u003c/span\u003e\u003cspan class=\"c1\"\u003e// 関数呼び出し\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eil\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEmit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eRet\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e// スタックにはJobHandleのみが残っているのでこれを返り値とする\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eLocalBuilderは初めて出てきましたね。\u003cbr\u003e\nILGenerator.DeclareLocalでローカル変数を宣言します。\u003cbr\u003e\nしかし、ローカル変数に名前がありませんね。実は.NETではローカル変数は無名の存在で、インデックスナンバーで参照される存在なのです。\u003c/p\u003e\n\n\u003cp\u003eたとえデフォルト値であったとしても構造体を作成するためには構造体を作成する先のアドレスを取得する必要があります。\u003cbr\u003e\n今回はローカル変数をわざわざ定義し、ローカル変数のアドレスに対して構造体の初期化を行いました。\u003cbr\u003e\nそして初期化後にローカル変数をロードしています。かなり回りくどく感じますがshoganai。\u003cbr\u003e\nそして４つの引数（BURSTJOB, int, int, JobHandle）が揃ったらIJobParallelForExtensions.Schedule\u0026lt;BURSTJOB\u0026gt;を呼びます。\u003cbr\u003e\nこの時、Scheduleがジェネリックメソッドですので型パラメーターを与えるためにMakeGenericMethodメソッドを使いましょう。\u003cbr\u003e\nこれは、MethodInfo MethodInfo.MakeGenericMethod(params Type[] parameters)というメソッドシグネチャです。TypeBuilder型はType型を先祖に持つので問題なく渡せます。\u003c/p\u003e\n\n\u003cp\u003eSetPtrは簡単なので解説しません。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"第3節-実行結果\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%AC%AC3%E7%AF%80-%E5%AE%9F%E8%A1%8C%E7%B5%90%E6%9E%9C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e第3節 実行結果\u003c/h1\u003e\n\n\u003cp\u003eこうして全てのメソッドを実装して動的な構造体を定義し終えました。\u003cbr\u003e\nさあ、実行してみましょう！\u003c/p\u003e\n\n\u003cp\u003e「ガッシ！ボカッ！」\u003cbr\u003e\nBurstCompilerは死んだ。スイーツ（笑）\u003c/p\u003e\n\n\u003cp\u003eBurst CompilerがMono.Cecil.AssemblyResolutionExceptionを吐いて死にました。\u003cbr\u003e\nどうやら動的に定義されたBurstJobをコンパイルすることができないようです。\u003c/p\u003e\n\n\u003cp\u003e本当に、本当に残念でなりません。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003etypeBuilder\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSetCustomAttribute\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eCustomAttributeBuilder\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eBurstCompileAttribute\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetConstructor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEmptyTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003eArray\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEmpty\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eobject\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;()));\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eをコメントアウトするとBurstコンパイルされずにちゃんとマルチスレッドで動作しました。\u003cbr\u003e\n実に惜しい話ですね。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"感想\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%84%9F%E6%83%B3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e感想\u003c/h1\u003e\n\n\u003cp\u003e\u003cimg alt=\":angel:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/1f47c.png\" title=\":angel:\" width=\"20\" loading=\"lazy\"\u003e\u003c/p\u003e\n\n\u003cp\u003e私の野心的試みは必ず失敗するという呪いでもあるのでしょうか？\u003c/p\u003e\n\n\u003cp\u003eここまでお読みいただきありがとうございました。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"宣伝\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%A3%E4%BC%9D\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e宣伝\u003c/h1\u003e\n\n\u003cp\u003eヴァーレントゥーガ互換のUnityゲームを現在作っています。\u003cbr\u003e\nお手伝いいただける方はぜひご連絡ください。\u003c/p\u003e\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\n\u003cp\u003e\u003ca href=\"https://twitter.com/hashtag/%E3%83%B4%E3%82%A1%E3%83%BC%E3%83%AC%E3%83%B3%E3%83%88%E3%82%A5%E3%83%BC%E3%82%AC?src=hash\u0026amp;ref_src=twsrc%5Etfw\" rel=\"nofollow noopener\" target=\"_blank\"\u003e#ヴァーレントゥーガ\u003c/a\u003e をUnityに移植することでMacやLinuxでも動かせるようにするプロジェクト\u003cbr\u003e誰かやる気のある人いません？\u003c/p\u003e— スーギ・ノウコ自治区 (@pCYSl5EDgo) \u003ca href=\"https://twitter.com/pCYSl5EDgo/status/1089390911853780995?ref_src=twsrc%5Etfw\" rel=\"nofollow noopener\" target=\"_blank\"\u003e2019年1月27日\u003c/a\u003e\n\u003c/blockquote\u003e\n\n\u003cscript async src=\"https://platform.twitter.com/widgets.js\"\u003e\u003c/script\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"付属\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BB%98%E5%B1%9E\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e付属\u003c/h1\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e全体のコード\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Diagnostics\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eUnityEngine\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eUnity.Burst\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eUnity.Jobs\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eUnity.Collections\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eUnity.Collections.LowLevel.Unsafe\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Reflection\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Reflection.Emit\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eReflection\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEmit\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eOpCodes\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eTestManager\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eMonoBehaviour\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eunsafe\u003c/span\u003e \u003cspan class=\"k\"\u003einterface\u003c/span\u003e \u003cspan class=\"nc\"\u003eIAccessor\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIJobParallelFor\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetPtr\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eSetPtr\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eJobHandle\u003c/span\u003e \u003cspan class=\"nf\"\u003eSchedule\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eCOUNT\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e50000\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eIAccessor\u003c/span\u003e \u003cspan class=\"n\"\u003eaccessor\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eStart\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eModuleName\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Hoge\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eFileName\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eModuleName\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\".dll\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eAssemblyBuilder\u003c/span\u003e \u003cspan class=\"n\"\u003eassemblyBuilder\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eAssemblyBuilder\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDefineDynamicAssembly\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eAssemblyName\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eModuleName\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003eAssemblyBuilderAccess\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRunAndSave\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003emoduleBulder\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eassemblyBuilder\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDefineDynamicModule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eModuleName\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eFileName\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003etypeBuilder\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emoduleBulder\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDefineType\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"BURSTJOB\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eTypeAttributes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePublic\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003eTypeAttributes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAnsiClass\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003eTypeAttributes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSealed\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003eTypeAttributes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSequentialLayout\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValueType\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n            \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eType\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIAccessor\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIJobParallelFor\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n        \u003cspan class=\"n\"\u003etypeBuilder\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSetCustomAttribute\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eCustomAttributeBuilder\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eBurstCompileAttribute\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetConstructor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEmptyTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003eArray\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEmpty\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eobject\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;()));\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eintPtrType\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eMakePointerType\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eptr\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etypeBuilder\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDefineField\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"ptr\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eintPtrType\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eFieldAttributes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePublic\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eptr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSetCustomAttribute\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eCustomAttributeBuilder\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eNativeDisableUnsafePtrRestrictionAttribute\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetConstructor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEmptyTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003eArray\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEmpty\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eobject\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;()));\u003c/span\u003e\n        \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003eMethodAttributes\u003c/span\u003e \u003cspan class=\"n\"\u003eAttributes\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eMethodAttributes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePublic\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003eMethodAttributes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eVirtual\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003eMethodAttributes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFinal\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003eMethodAttributes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNewSlot\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003eMethodAttributes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eHideBySig\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eschedule\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etypeBuilder\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDefineMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Schedule\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eAttributes\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eJobHandle\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003eType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEmptyTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eil\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eschedule\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetILGenerator\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003elocal\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eil\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDeclareLocal\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eJobHandle\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eil\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEmit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLdarg_0\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eil\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEmit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLdobj\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etypeBuilder\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eil\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEmit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLdc_I4\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eCOUNT\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eil\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEmit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLdc_I4\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e1024\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eil\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEmit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLdloca_S\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eil\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEmit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eInitobj\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eJobHandle\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eil\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEmit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLdloc_0\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eil\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEmitCall\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eCall\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIJobParallelForExtensions\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enameof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIJobParallelForExtensions\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSchedule\u003c/span\u003e\u003cspan class=\"p\"\u003e)).\u003c/span\u003e\u003cspan class=\"nf\"\u003eMakeGenericMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etypeBuilder\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003eType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEmptyTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eil\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEmit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eRet\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eexecute\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etypeBuilder\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDefineMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Execute\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eAttributes\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003evoid\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eType\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eil\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eexecute\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetILGenerator\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eil\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEmit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLdarg_0\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eil\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEmit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLdfld\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eptr\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eil\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEmit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLdarg_1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eil\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEmit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eConv_I\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eil\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEmit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLdc_I4_4\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eil\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEmit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eMul\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eil\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEmit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eil\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEmit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLdarg_1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eil\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEmit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eStind_I4\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eil\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEmit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eRet\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003esetPtr\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etypeBuilder\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDefineMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"SetPtr\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eAttributes\u003c/span\u003e\u003cspan class=\"p\"\u003e+,\u003c/span\u003e \u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003evoid\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003eintPtrType\u003c/span\u003e \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eil\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esetPtr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetILGenerator\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eil\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEmit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLdarg_0\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eil\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEmit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLdarg_1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eil\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEmit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eStfld\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eptr\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eil\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEmit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eRet\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003egetPtr\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etypeBuilder\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDefineMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"GetPtr\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eAttributes\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eintPtrType\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEmptyTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eil\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003egetPtr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetILGenerator\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eil\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEmit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLdarg_0\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eil\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEmit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLdfld\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eptr\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eil\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEmit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eRet\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eaccessor\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIAccessor\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eActivator\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateInstance\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etypeBuilder\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateType\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eassemblyBuilder\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSave\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eFileName\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eVerify\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eassemblyBuilder\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eunsafe\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eUpdate\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003earray\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eNativeArray\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"n\"\u003eCOUNT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eAllocator\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTempJob\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eaccessor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSetPtr\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e*)\u003c/span\u003e\u003cspan class=\"n\"\u003earray\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetUnsafePtr\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eaccessor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSchedule\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"nf\"\u003eComplete\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eVerify\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eparams\u003c/span\u003e \u003cspan class=\"n\"\u003eAssemblyBuilder\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003ebuilders\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e@\"C:\\Program Files (x86)\\Microsoft SDKs\\Windows\\v10.0A\\bin\\NETFX 4.7.2 Tools\\x64\\PEVerify.exe\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003etargetDll\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003ebuilders\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003epsi\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eProcessStartInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etargetDll\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetName\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\".dll\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eCreateNoWindow\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eWindowStyle\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eProcessWindowStyle\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eHidden\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eRedirectStandardOutput\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eRedirectStandardError\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eUseShellExecute\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ep\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eProcess\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eStart\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epsi\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003edata\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eStandardOutput\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReadToEnd\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n","createdAt":"2019-01-29T06:54:25Z","elapsedYearsFromLastModifiedAt":2,"encryptedId":"v1Ck91Dc17cO+U89JHKUtbhcRu8Jg2sy--71GYYtb1rCVF04K5--0qnGcGunb/RtxCAqwbw/yg==","isBanned":false,"isDeprecated":true,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":false,"lastModifiedAt":"2019-01-29T06:54:25Z","likesCount":13,"linkUrl":"https://qiita.com/pCYSl5EDgo/items/9af7f5f1efaf8cd4ccdc","organization":null,"originalId":776056,"stockedCount":8,"title":"ILの暗黒の魔術　第３章「動的生成！そしてBurst挽歌へ」","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%AC%AC1%E7%AF%80-%E8%A8%AD%E8%A8%88\"\u003e第1節 設計\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#assemblybuildermodulebuilder\"\u003eAssemblyBuilder\u0026amp;ModuleBuilder\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#typebuilder\"\u003eTypeBuilder\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%AC%AC2%E7%AF%80-%E5%9E%8B%E3%82%92%E6%8D%8F%E3%81%AD%E3%82%8B\"\u003e第2節 型を捏ねる\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%A6%82%E5%BD%A2\"\u003e概形\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%95%E3%82%A3%E3%83%BC%E3%83%AB%E3%83%89\"\u003eフィールド\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89\"\u003eメソッド\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%AC%AC3%E7%AF%80-%E5%AE%9F%E8%A1%8C%E7%B5%90%E6%9E%9C\"\u003e第3節 実行結果\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%84%9F%E6%83%B3\"\u003e感想\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%AE%A3%E4%BC%9D\"\u003e宣伝\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%BB%98%E5%B1%9E\"\u003e付属\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":2825,"uuid":"9af7f5f1efaf8cd4ccdc","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"Kzf/YnZqo6RoXOGIyqaBF+KHMlJI--cCyBzAbZpd4wWLHb--s3e2g88YNIihOsUrorO86A==","originalId":256047,"description":"C#!好き!!（語彙不足）\r\nUnityやヴァーレントゥーガ関連の投稿をしていく予定です。","facebookUrl":null,"githubUrl":"https://github.com/pCYSl5EDgo","isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"自治区 スーギ・ノウコ","profileImageUrl":"https://qiita-image-store.s3.amazonaws.com/0/256047/profile-images/1546351264","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F256047%2Fprofile-images%2F1546351264?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=976dab58dc56a745da2171d56fec56a7","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F256047%2Fprofile-images%2F1546351264?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=c5789bc76dd49b92c1ddc68bc158b06b","urlName":"pCYSl5EDgo","websiteUrl":"","twitterUrl":"https://twitter.com/pCYSl5EDgo","twitterUrlName":"pCYSl5EDgo","revealedOrganizations":{"edges":[]}},"tags":[{"name":"C#","urlName":"csharp"},{"name":"Unity","urlName":"unity"},{"name":"IL","urlName":"il"},{"name":"EntityComponentSystem","urlName":"entitycomponentsystem"},{"name":"AssemblyBuilder","urlName":"assemblybuilder"}],"followingLikers":{"edges":[]},"comments":{"totalCount":2}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

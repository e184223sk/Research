More than 1 year has passed since last update.ログ用関数などによく使うConditionalAttributeという属性クラスがあります。
これは、voidを返すメソッドにつけると、Defineされたシンボル（DEBUGとか）の状態によってそのメソッドの呼び出しを有効にしたり無効にしてくれる属性です。例えば上記のようにすると、LOGシンボルが定義されているときのみコンソールに文字列が表示されます。では次のようにするとどうなるでしょうか？よく見る光景です。もし、引数はちゃんと評価されているのであれば、本番ビルドでもLogを通るたびに無駄な処理と無駄な文字列のアロケーションがされていることになります。
果たして、引数は評価されているのでしょうか？引数の生成に副作用を持たせてみました。評価されるとisCalledHeavyが立つので評価されたことがわかります。結論、引数も評価されなくなりました。無駄な処理も生まれずに安心安心…というわけにはいかず、これは逆に危ないかもしれません。下のように書いてしまうと、LOGシンボルの有無で全然処理が変わってしまいます。この場合、この後、Null例外が出て「リリースビルドだけばぐってる～～！！😵😵😵」になってしまうでしょう…
この場合は必要な処理が欠ける方ですが、3のソースで、Logの行が長いからと言って、引数をローカル変数に分割した場合には無駄な処理が発生する原因になりえます。これをコンパイルしてみます。しっかり呼ばれていることが確認できますね。
Conditionalメソッドは、行そのものがなかったことにされています。
TooHeaveyが完全に副作用をもたらさない場合、JITによって消える可能性はある気はします。



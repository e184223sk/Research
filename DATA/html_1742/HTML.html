<!DOCTYPE html><html><head><meta charset="utf-8" /><title>脆弱性を直した後のセキュリティテスト（SQLインジェクションの場合） - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/takutoy/items/20b41532a262fe75bc37" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="qdJXHhrBWV9st17pnTvIJRfQyU5AJadoBzziebXUaRutMqR2NEsRITJyd9VHIUQ97tThBgUDwePz+Tub/6tmpA==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta property="og:type" content="article"><meta property="og:title" content="脆弱性を直した後のセキュリティテスト（SQLインジェクションの場合） - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND02SVNHNWJ5eDVvQ240NEtTNTV1MDQ0R1g0NEdmNWI2TTQ0R3U0NEs3NDRLdDQ0T2w0NE9xNDRPRzQ0S2o0NE9HNDRLNTQ0T0k3N3lJVTFGTTQ0S2s0NE96NDRLNDQ0S240NEt2NDRLMzQ0T240NE96NDRHdTVhQzA1WkNJNzd5SiZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTU0JnR4dC1jbGlwPWVsbGlwc2lzJnR4dC1hbGlnbj1jZW50ZXIlMkNtaWRkbGUmcz1mNTIwNDNmOWIxMzE3YzQ0ZGU3NGE1NzQ1ZTMzYTE2MA&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RSFJoYTNWMGIzayZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTQ1JnR4dC1hbGlnbj1yaWdodCUyQ2JvdHRvbSZzPTBhOTEwN2M3ZTU5OGZkZDVjOTg1MDkyYjJmZTdlZjU3&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=b4a22247f077e2c41a347cc51f8a1231"><meta property="og:description" content="脆弱性が報告されてから修正が完了するまでに、Webアプリケーション開発者(またはテスター)ができることをセキュリティテストを中心に書く。


再現手順の確立
原因究明
対策の実行
修正の確認
セキュリティテスト


セキュリティテスト..."><meta content="https://qiita.com/takutoy/items/20b41532a262fe75bc37" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#,EntityFramework,セキュリティ,SQLインジェクション,セキュリティテスト" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 1nzh4zz 38fzdi helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-1nzh4zz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:16px 32px;background-color:#FBE69E;color:rgba(0,0,0,0.87);line-height:1.5;font-weight:600;}@media (max-width:770px){.css-1nzh4zz{padding:16px;}}.css-38fzdi{color:#CA832A;margin-right:4px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-2f432683-f72d-48bb-8c3b-c7c86a218498"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Ftakutoy%2Fitems%2F20b41532a262fe75bc37">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Ftakutoy%2Fitems%2F20b41532a262fe75bc37">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-2f432683-f72d-48bb-8c3b-c7c86a218498">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2020-03-21T17:46:23.000+09:00","dateModified":"2020-03-31T23:13:53.000+09:00","headline":"脆弱性を直した後のセキュリティテスト（SQLインジェクションの場合）","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND02SVNHNWJ5eDVvQ240NEtTNTV1MDQ0R1g0NEdmNWI2TTQ0R3U0NEs3NDRLdDQ0T2w0NE9xNDRPRzQ0S2o0NE9HNDRLNTQ0T0k3N3lJVTFGTTQ0S2s0NE96NDRLNDQ0S240NEt2NDRLMzQ0T240NE96NDRHdTVhQzA1WkNJNzd5SiZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTU0JnR4dC1jbGlwPWVsbGlwc2lzJnR4dC1hbGlnbj1jZW50ZXIlMkNtaWRkbGUmcz1mNTIwNDNmOWIxMzE3YzQ0ZGU3NGE1NzQ1ZTMzYTE2MA\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RSFJoYTNWMGIzayZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTQ1JnR4dC1hbGlnbj1yaWdodCUyQ2JvdHRvbSZzPTBhOTEwN2M3ZTU5OGZkZDVjOTg1MDkyYjJmZTdlZjU3\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=b4a22247f077e2c41a347cc51f8a1231","mainEntityOfPage":"https://qiita.com/takutoy/items/20b41532a262fe75bc37","author":{"@type":"Person","address":"","email":null,"identifier":"takutoy","name":"takutoy","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F118451%2Fprofile-images%2F1473713930?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=2d63c3b17bbc4477c7258643ea704ed3","url":"https://qiita.com/takutoy","description":"","memberOf":[]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://zine.qiita.com/interview/202107-hitachi-3/?utm_source=qiita&amp;utm_medium=header-banner">日立の研究者が、2年間ドイツ人工知能研究センターで学んだこと</a><a target="_blank" id="header_text_message_2" href="https://zine.qiita.com/interview/202107-hitachi-3/?utm_source=qiita&amp;utm_medium=header-banner">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"takutoy","type":"items","id":"20b41532a262fe75bc37"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"日立の研究者が、2年間ドイツ人工知能研究センターで学んだこと","url":"https://zine.qiita.com/interview/202107-hitachi-3/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"takutoy","type":"items","id":"20b41532a262fe75bc37"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":0,"pos_id":"header_text_message_1","message":"日立の研究者が、2年間ドイツ人工知能研究センターで学んだこと","url":"https://zine.qiita.com/interview/202107-hitachi-3/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"takutoy","type":"items","id":"20b41532a262fe75bc37"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":0,"pos_id":"header_text_message_2","message":"日立の研究者が、2年間ドイツ人工知能研究センターで学んだこと","url":"https://zine.qiita.com/interview/202107-hitachi-3/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/takutoy/items/20b41532a262fe75bc37","location":"/takutoy/items/20b41532a262fe75bc37","scheme":"https","host":"qiita.com","port":null,"pathname":"/takutoy/items/20b41532a262fe75bc37","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"mP9bOpsd1AX9w5WA/DhF3xevrYHPQnyRCcqvD03lfwGcH6hStZece6MGvLwmIsnH7quFyYpkGhr9D3btB5pwvg==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-5023b591-5eb5-4327-8dec-e1702ad022d2"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/takutoy/items/20b41532a262fe75bc37/likers" class="css-1iupg5d">5</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">4</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/20b41532a262fe75bc37/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/takutoy/items/20b41532a262fe75bc37/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/takutoy/items/20b41532a262fe75bc37/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/takutoy/items/20b41532a262fe75bc37/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/takutoy/items/20b41532a262fe75bc37.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-1nzh4zz"><span class="fa fa-fw fa-warning css-38fzdi"></span><p>More than 1 year has passed since last update.</p></div><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/takutoy"><img class="css-100alwu eyfquo10" src="https://qiita-image-store.s3.amazonaws.com/0/118451/profile-images/1473713930" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/takutoy" class="css-10ougpm">@<!-- -->takutoy</a><div class="css-1ay9vb9"><span><meta content="2020-03-21T08:46:23Z"/><time dateTime="2020-03-31T14:13:53Z" class="css-m19uds">updated at 2020-03-31</time></span></div></div></div></div></div><h1 class="css-cgzq40">脆弱性を直した後のセキュリティテスト（SQLインジェクションの場合）</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/entityframework" class="css-4czcte">EntityFramework</a><a href="/tags/%e3%82%bb%e3%82%ad%e3%83%a5%e3%83%aa%e3%83%86%e3%82%a3" class="css-4czcte">セキュリティ</a><a href="/tags/sql%e3%82%a4%e3%83%b3%e3%82%b8%e3%82%a7%e3%82%af%e3%82%b7%e3%83%a7%e3%83%b3" class="css-4czcte">SQLインジェクション</a><a href="/tags/%e3%82%bb%e3%82%ad%e3%83%a5%e3%83%aa%e3%83%86%e3%82%a3%e3%83%86%e3%82%b9%e3%83%88" class="css-4czcte">セキュリティテスト</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div><p>脆弱性が報告されてから修正が完了するまでに、Webアプリケーション開発者(またはテスター)ができることをセキュリティテストを中心に書く。</p>

<ol>
<li>再現手順の確立</li>
<li>原因究明</li>
<li>対策の実行</li>
<li>修正の確認</li>
<li>セキュリティテスト</li>
</ol>

<p>セキュリティテストってどうやればいいの？とか、セキュリティベンダの脆弱性診断高すぎ内製化したる！とか、そんな人たちの参考になればいいなあ。</p>

<p>※本記事のサンプルコードは C# + Entity Framework だが、プロセスは他の言語やフレームワークでも通用する。</p>

<h2>
<span id="1再現手順の確立" class="fragment"></span><a href="#1%E5%86%8D%E7%8F%BE%E6%89%8B%E9%A0%86%E3%81%AE%E7%A2%BA%E7%AB%8B"><i class="fa fa-link"></i></a>1.再現手順の確立</h2>

<p>※注意：再現行為を本番環境でやるのは危険すぎるので、検証環境でやるのがよい</p>

<p>脆弱性が報告されたら、通常のバグ修正と同じように、まず脆弱性を再現させる。（TDD風に言うなら、レッドになるテストを作る）</p>

<p>SQLインジェクションの場合、主にHTTPリクエスト（URL、ヘッダ、本文など）が再現手順になる。あらかじめ Web サイトへのログインが必要な場合は、それも再現手順に含めておく。</p>

<p>再現手順を確立しておくことで、修正後に再現しなくなる（テストがグリーンになる）＝修正できたことを確認できるようになる。</p>

<p>また、この時点で脆弱性スキャナを実行して脆弱性が検出されることを確認しておくのもよい。理由は後述の <a href="#%E8%84%86%E5%BC%B1%E6%80%A7%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3">脆弱性スキャン</a> に記載。</p>

<h2>
<span id="2原因究明" class="fragment"></span><a href="#2%E5%8E%9F%E5%9B%A0%E7%A9%B6%E6%98%8E"><i class="fa fa-link"></i></a>2.原因究明</h2>

<p>SQL インジェクションの原因は、たとえば次のようなケースが考えられる。</p>

<ul>
<li>自分たちが書いたコードに問題がある場合</li>
<li>ミドルウェアやライブラリ、プラグイン等に脆弱性があった場合</li>
<li>脆弱なテストプログラムやサンプルプログラムが残ったままになっていた場合</li>
</ul>

<p>原因がわかったら、報告を受けた箇所だけではなくほかにも同様の問題がないかも確認する。</p>

<p>今回は自分たちが書いたコードに問題がある場合を想定して話を進める。</p>

<h2>
<span id="3対策の実行" class="fragment"></span><a href="#3%E5%AF%BE%E7%AD%96%E3%81%AE%E5%AE%9F%E8%A1%8C"><i class="fa fa-link"></i></a>3.対策の実行</h2>

<p>SQLインジェクションの対策について詳しく知りたい場合は、IPA が公開している <a href="https://www.ipa.go.jp/files/000017320.pdf" rel="nofollow noopener" target="_blank">安全なSQLの呼び出し方</a> を参照。</p>

<p>たとえばこんなコードを</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">SQLインジェクション可能なコード</span></div>
<div class="highlight"><pre class="with-code"><code><span class="kt">var</span> <span class="n">sql</span> <span class="p">=</span> <span class="s">"SELECT Id, Author, Title, PostedAt, Text From Posts"</span><span class="p">;</span>
<span class="n">sql</span> <span class="p">+=</span> <span class="s">$" Where Author like '%</span><span class="p">{</span><span class="n">author</span><span class="p">}</span><span class="s">%'"</span><span class="p">;</span>
<span class="k">return</span> <span class="k">await</span> <span class="n">_context</span><span class="p">.</span><span class="n">Posts</span><span class="p">.</span><span class="nf">FromSqlRaw</span><span class="p">(</span><span class="n">sql</span><span class="p">).</span><span class="nf">ToArrayAsync</span><span class="p">();</span>
</code></pre></div>
</div>

<p>こんな感じに修正する</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">SQLインジェクション対策済みコード</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">return</span> <span class="k">await</span> <span class="n">_context</span><span class="p">.</span><span class="n">Posts</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">p</span> <span class="p">=&gt;</span> <span class="n">p</span><span class="p">.</span><span class="n">Author</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="n">author</span><span class="p">)).</span><span class="nf">ToArrayAsync</span><span class="p">();</span>
</code></pre></div>
</div>

<h2>
<span id="4修正の確認" class="fragment"></span><a href="#4%E4%BF%AE%E6%AD%A3%E3%81%AE%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>4.修正の確認</h2>

<p><a href="#1%E5%86%8D%E7%8F%BE%E6%89%8B%E9%A0%86%E3%81%AE%E7%A2%BA%E7%AB%8B">1.再現手順の確立</a> で確立した脆弱性の再現方法を修正箇所に試し、問題が再現しないことを確認する。</p>

<p>これで対策完了！ではない。</p>

<h2>
<span id="5セキュリティテスト" class="fragment"></span><a href="#5%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%83%86%E3%82%B9%E3%83%88"><i class="fa fa-link"></i></a>5.セキュリティテスト</h2>

<p><a href="#4%E4%BF%AE%E6%AD%A3%E3%81%AE%E7%A2%BA%E8%AA%8D">4.修正の確認</a>は「正しくできた」ことを確認するテスト。対して「正しくできていない」ことを発見するのがセキュリティテストの役割になる。「正しくできていない」とは、間違った対策や中途半端な対策のこと。</p>

<p>セキュリティテストは、通常のテストと同様、コストと網羅性のバランスが必要。修正完了までコードの変更とテストが何度も繰り返されることも多いので、フィードバックの早さも重要。すべてを満たすテスト手法は多分ないので、複数の手法を組み合わせるのが良い。</p>

<p>SQLインジェクションの問題は、コードを見ればある程度問題の有無を判断できることと、自動テストを書きやすそうなことから、次の３つの手法を採用することにする。</p>

<ol>
<li>コードインスペクション

<ul>
<li>○コスト安：手っ取り早く実行できる</li>
<li>○フィードバック超早：コードが見れればできる</li>
<li>×属人性高：セキュアコーディングのスキルが必要</li>
</ul>
</li>
<li>ファジング

<ul>
<li>○フィードバック早：自動化しやすく、繰り返し実行できる</li>
<li>△コスト中：入力データや自動テストを作る必要がある</li>
<li>△属人性中：適切なテストデータを作る・選ぶスキルが必要</li>
</ul>
</li>
<li>脆弱性スキャン

<ul>
<li>○属人性低：独立性が高く、かつ安定した結果が得られる</li>
<li>×フィードバック遅：デプロイが必要</li>
<li>×コスト高：ツールによってはお金がかかる。学習コストもあるかも。</li>
</ul>
</li>
</ol>

<p>プロジェクトによっては下記のような選択肢もあるかもしれない。</p>

<ul>
<li>静的コード解析ツール(SAST)を使う（良い精度のツールがあるなら）</li>
<li>sqlmap のようなツールを使って疑似攻撃を試みる（セキュリティエンジニアがいるなら）</li>
<li>セキュリティベンダに診断を依頼する（超重要なシステムで、かつ、お金と時間があるなら）</li>
</ul>

<h3>
<span id="コードインスペクション" class="fragment"></span><a href="#%E3%82%B3%E3%83%BC%E3%83%89%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%9A%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3"><i class="fa fa-link"></i></a>コードインスペクション</h3>

<p>コードインスペクションは静的なホワイトボックステストの１つ。あるルールに基づいて人（または機械）がコードを精査し、欠陥を発見する手法。</p>

<p>コードさえ見れれば、デプロイどころかコンパイラすらしなくてもテストできるため、実行コストが低くフィードバックがとても早いという利点がある。ただし精度はテスターのスキルに依存する。</p>

<p>コードインスペクションではセキュリティの問題を発見することにのみ集中する。SQL インジェクション対策のインスペクションであれば、「パラメータを文字列操作してSQL文を作成していないこと」のようなルールをあらかじめ定めたうえで精査する。</p>

<p>ルールは言語やフレームワークによって異なる点に注意。C# + Entity Framework の場合、下記のようなルールになる。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">問題なし：固定文字列なSQL</span></div>
<div class="highlight"><pre class="with-code"><code><span class="kt">var</span> <span class="n">sql</span> <span class="p">=</span> <span class="s">"SELECT * from Posts"</span><span class="p">;</span>
</code></pre></div>
</div>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">問題なし：SQLを文字列連結しているが、可変部分はない</span></div>
<div class="highlight"><pre class="with-code"><code><span class="kt">var</span> <span class="n">sql</span> <span class="p">=</span> <span class="s">"SELECT * from Posts"</span><span class="p">;</span>
<span class="n">sql</span> <span class="p">+=</span> <span class="s">" WHERE author = 'Tanaka Ichiro'"</span><span class="p">;</span>
</code></pre></div>
</div>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">問題なし：パラメータプレースホルダを使ってる</span></div>
<div class="highlight"><pre class="with-code"><code><span class="kt">var</span> <span class="n">sql</span> <span class="p">=</span> <span class="s">"SELECT Id, Author, Title, PostedAt, Text From Posts"</span><span class="p">;</span>
<span class="n">sql</span> <span class="p">+=</span> <span class="s">" Where Author = {0}"</span><span class="p">;</span>
<span class="n">_context</span><span class="p">.</span><span class="n">Posts</span><span class="p">.</span><span class="nf">FromSqlRaw</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">author</span><span class="p">)...</span>
</code></pre></div>
</div>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">問題なし：LINQ_to_SQL</span></div>
<div class="highlight"><pre class="with-code"><code><span class="n">dbContext</span><span class="p">.</span><span class="n">Posts</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">p</span> <span class="p">=&gt;</span> <span class="n">p</span><span class="p">.</span><span class="n">Author</span> <span class="p">==</span> <span class="n">author</span><span class="p">)...</span>
</code></pre></div>
</div>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">×問題有り：パラメータを文字列連結してSQL文を生成している</span></div>
<div class="highlight"><pre class="with-code"><code><span class="kt">var</span> <span class="n">sql</span> <span class="p">=</span> <span class="s">"SELECT * from Posts"</span><span class="p">;</span>
<span class="n">sql</span> <span class="p">+=</span> <span class="s">" WHERE author = '"</span> <span class="p">+</span> <span class="n">author</span> <span class="p">+</span> <span class="s">"'"</span><span class="p">;</span>
</code></pre></div>
</div>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">×問題有り：パラメータを文字列置換してSQL文を生成している</span></div>
<div class="highlight"><pre class="with-code"><code><span class="kt">var</span> <span class="n">sql</span> <span class="p">=</span> <span class="s">"SELECT * from Posts"</span><span class="p">;</span>
<span class="n">sql</span> <span class="p">+=</span> <span class="s">" WHERE author = '{AUTHOR}'"</span><span class="p">);</span>
<span class="n">sql</span> <span class="p">=</span> <span class="n">sql</span><span class="p">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s">"{AUTHOR}"</span><span class="p">,</span> <span class="n">author</span><span class="p">);</span>
</code></pre></div>
</div>

<p>※例では SELECT のみ挙げたが INSERT, UPDATE, DELETE 等ほかのSQL文のルールも必要</p>

<p>コーディング規約がない場合はいろんなSQL発行パターンがわいてくるので、判断基準を作りながらテストするか、いっそ標準を定めて標準以外の書き方はNGとしてしまってもよいかもしれない。</p>

<p>コードインスペクションのアウトプットは、テスト対象となったファイルとその結果の一覧になる。（例）</p>

<table>
<thead>
<tr>
<th style="text-align: left">ファイル名</th>
<th style="text-align: left">SQL発行の有無</th>
<th style="text-align: left">メソッド名</th>
<th style="text-align: left">パラメータ有無</th>
<th style="text-align: left">SQL発行方法</th>
<th style="text-align: left">OK/NG</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left">Hoge.cs</td>
<td style="text-align: left">無し</td>
<td style="text-align: left">-</td>
<td style="text-align: left">-</td>
<td style="text-align: left">-</td>
<td style="text-align: left">OK</td>
</tr>
<tr>
<td style="text-align: left">Foo.cs</td>
<td style="text-align: left">有り</td>
<td style="text-align: left">Bar</td>
<td style="text-align: left">無し</td>
<td style="text-align: left">-</td>
<td style="text-align: left">OK</td>
</tr>
<tr>
<td style="text-align: left">Foo.cs</td>
<td style="text-align: left">有り</td>
<td style="text-align: left">Nar</td>
<td style="text-align: left">有り</td>
<td style="text-align: left">LINQ to SQL</td>
<td style="text-align: left">OK</td>
</tr>
<tr>
<td style="text-align: left">Moge.cs</td>
<td style="text-align: left">有り</td>
<td style="text-align: left">Soge</td>
<td style="text-align: left">有り</td>
<td style="text-align: left">Parametered Query</td>
<td style="text-align: left">OK</td>
</tr>
<tr>
<td style="text-align: left">Moge.cs</td>
<td style="text-align: left">有り</td>
<td style="text-align: left">Doge</td>
<td style="text-align: left">有り</td>
<td style="text-align: left">文字列連結</td>
<td style="text-align: left">NG</td>
</tr>
</tbody>
</table>

<p>この結果を受けて、例えば次のような判断ができる。</p>

<ul>
<li>NG がなくなるまで修正と再テストを繰り返す</li>
<li>(コードの修正が困難すぎて)NGや判断不可な箇所を

<ul>
<li>以降のテストでカバーする</li>
<li>熟練セキュアコーダーにインスペクションしてもらう（人がいれば）</li>
</ul>
</li>
<li>この結果にかかわらず、以降のテストを全箇所実施する</li>
</ul>

<p>どうするかは、テストの独立性やコストパフォーマンス等のバランスを見て決めればよい。</p>

<h3>
<span id="ファジング" class="fragment"></span><a href="#%E3%83%95%E3%82%A1%E3%82%B8%E3%83%B3%E3%82%B0"><i class="fa fa-link"></i></a>ファジング</h3>

<p>ファジングは動的なブラックボックステストの１つで、「変なデータ」を入力しまくって欠陥を見つける手法。詳しくは IPA の <a href="https://www.ipa.go.jp/security/vuln/fuzzing.html" rel="nofollow noopener" target="_blank">脆弱性対策：ファジング</a> を参照。</p>

<p>ファジングはWebサイトに対して実行することもできるし、SQLを発行している関数・メソッドに対しても実行できる。</p>

<p>テストは小さい単位でやるほうがコストパフォーマンスがよくフィードバックも早いので、可能なら関数・メソッドに対してやるのがお勧め。もちろん Web サイトにやってもよい。</p>

<p>「変なデータ」はランダムに作っても良いが、今回は <a href="https://github.com/fuzzdb-project/fuzzdb/tree/master/attack/sql-injection/detect" rel="nofollow noopener" target="_blank">fuzzdb</a> で公開されている SQL インジェクションを発見するための入力パターン集を使う。</p>

<h4>
<span id="ユニットテストフレームワークで実行" class="fragment"></span><a href="#%E3%83%A6%E3%83%8B%E3%83%83%E3%83%88%E3%83%86%E3%82%B9%E3%83%88%E3%83%95%E3%83%AC%E3%83%BC%E3%83%A0%E3%83%AF%E3%83%BC%E3%82%AF%E3%81%A7%E5%AE%9F%E8%A1%8C"><i class="fa fa-link"></i></a>ユニットテストフレームワークで実行</h4>

<p>関数・メソッドに対してテストする場合、ユニットテストフレームワークを使うのが楽。（ユニットテストか？という疑問は気にしないことにする）</p>

<p>以下は C# + ASP.NET Core + SQL Server + xUnit.net の例</p>

<p>こんな脆弱なコードに対して</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">SQLインジェクション可能なコード</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">BlogPostsController</span> <span class="p">:</span> <span class="n">Controller</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="n">BlogDbContext</span> <span class="n">_context</span><span class="p">;</span>

    <span class="k">public</span> <span class="nf">BlogPostsController</span><span class="p">(</span><span class="n">BlogDbContext</span> <span class="n">context</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">_context</span> <span class="p">=</span> <span class="n">context</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">BlogPost</span><span class="p">[</span><span class="k">]&gt;</span> <span class="nf">SearchByAuthor</span><span class="p">(</span><span class="kt">string</span> <span class="n">author</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// 危険なコード！</span>
        <span class="kt">var</span> <span class="n">sql</span> <span class="p">=</span> <span class="s">"SELECT Id, Author, Title, PostedAt, Text From Posts"</span><span class="p">;</span>
        <span class="n">sql</span> <span class="p">+=</span> <span class="s">$" Where Author like '%</span><span class="p">{</span><span class="n">author</span><span class="p">}</span><span class="s">%'"</span><span class="p">;</span>
        <span class="k">return</span> <span class="k">await</span> <span class="n">_context</span><span class="p">.</span><span class="n">Posts</span><span class="p">.</span><span class="nf">FromSqlRaw</span><span class="p">(</span><span class="n">sql</span><span class="p">).</span><span class="nf">ToArrayAsync</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="c1">// 省略...</span>
</code></pre></div>
</div>

<p>こんなテストコードを書く</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">ユニットテストコード</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">UnitTest1</span>
<span class="p">{</span>
    <span class="c1">// fuzz.txt の１行を１テストケースとして定義</span>
    <span class="c1">// ※後述の Parameters プロパティを参照</span>
    <span class="p">[</span><span class="n">Theory</span><span class="p">]</span>
    <span class="p">[</span><span class="nf">MemberData</span><span class="p">(</span><span class="k">nameof</span><span class="p">(</span><span class="n">Parameters</span><span class="p">))]</span>
    <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">SqlInjectionTest</span><span class="p">(</span><span class="kt">string</span> <span class="n">param</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// * Arrange</span>
        <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">db</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">BlogDbContext</span><span class="p">())</span>
        <span class="p">{</span>
            <span class="c1">// テーブルを空にしておく</span>
            <span class="n">db</span><span class="p">.</span><span class="n">Posts</span><span class="p">.</span><span class="nf">RemoveRange</span><span class="p">(</span><span class="n">db</span><span class="p">.</span><span class="n">Posts</span><span class="p">.</span><span class="nf">ToArray</span><span class="p">());</span>

            <span class="c1">// SQL が正しく実行されれば、この Entity が帰ってくるはず</span>
            <span class="n">db</span><span class="p">.</span><span class="n">Posts</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">BlogPost</span><span class="p">()</span> <span class="p">{</span> <span class="n">Author</span> <span class="p">=</span> <span class="n">param</span><span class="p">,</span> <span class="n">Title</span> <span class="p">=</span> <span class="s">"test"</span> <span class="p">});</span>

            <span class="c1">// こっちは帰ってこないはず</span>
            <span class="n">db</span><span class="p">.</span><span class="n">Posts</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">BlogPost</span><span class="p">()</span> <span class="p">{</span> <span class="n">Author</span> <span class="p">=</span> <span class="s">"Dummy"</span><span class="p">,</span> <span class="n">Title</span> <span class="p">=</span> <span class="s">"Dummy"</span> <span class="p">});</span>

            <span class="n">db</span><span class="p">.</span><span class="nf">SaveChanges</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">db</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">BlogDbContext</span><span class="p">())</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">controller</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">BlogPostsController</span><span class="p">(</span><span class="n">db</span><span class="p">);</span>
            <span class="kt">var</span> <span class="n">sw</span> <span class="p">=</span> <span class="n">Stopwatch</span><span class="p">.</span><span class="nf">StartNew</span><span class="p">();</span>

            <span class="c1">// * Act</span>
            <span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="k">await</span> <span class="n">controller</span><span class="p">.</span><span class="nf">QueryPosts</span><span class="p">(</span><span class="n">param</span><span class="p">);</span>

            <span class="c1">// * Assert</span>
            <span class="c1">// 実行に5秒以上かかったら Blind な SQL Injection が成功してるのでNG</span>
            <span class="n">Assert</span><span class="p">.</span><span class="nf">True</span><span class="p">(</span><span class="n">sw</span><span class="p">.</span><span class="n">ElapsedMilliseconds</span> <span class="p">&lt;</span> <span class="m">5000</span><span class="p">,</span> <span class="s">"Blind SQL Injection"</span><span class="p">);</span>
            <span class="c1">// 正しいSQL文が発行されていれば１件の結果が返ってくるはず</span>
            <span class="n">Assert</span><span class="p">.</span><span class="nf">Equal</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">result</span><span class="p">.</span><span class="nf">Single</span><span class="p">().</span><span class="n">Author</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// SqlInjectionTest で使う入力データ列</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="kt">object</span><span class="p">[</span><span class="k">]&gt;</span> <span class="n">Parameters</span>
    <span class="p">{</span>
        <span class="k">get</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">f</span> <span class="p">=</span> <span class="n">Path</span><span class="p">.</span><span class="nf">Combine</span><span class="p">(</span><span class="n">AppDomain</span><span class="p">.</span><span class="n">CurrentDomain</span><span class="p">.</span><span class="n">BaseDirectory</span><span class="p">,</span> <span class="s">"fuzz.txt"</span><span class="p">);</span>
            <span class="kt">var</span> <span class="n">r</span> <span class="p">=</span> <span class="n">File</span><span class="p">.</span><span class="nf">ReadAllLines</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                <span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">l</span> <span class="p">=&gt;</span> <span class="p">!</span><span class="kt">string</span><span class="p">.</span><span class="nf">IsNullOrWhiteSpace</span><span class="p">(</span><span class="n">l</span><span class="p">))</span>
                <span class="p">.</span><span class="nf">Select</span><span class="p">(</span><span class="n">l</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="kt">object</span><span class="p">[]</span> <span class="p">{</span> <span class="n">l</span> <span class="p">})</span>
                <span class="p">.</span><span class="nf">ToArray</span><span class="p">();</span>
            <span class="k">return</span> <span class="n">r</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>ユニットテストの入力データに使う fuzz.txt はこんな感じ。</p>

<div class="code-frame" data-lang="sql">
<div class="code-lang"><span class="bold">テストデータ</span></div>
<div class="highlight"><pre class="with-code"><code><span class="p">;</span> <span class="c1">--</span>
<span class="s1">'; --
'</span><span class="p">);</span> <span class="c1">--</span>
<span class="s1">'; exec master..xp_cmdshell '</span><span class="n">ping</span> <span class="mi">10</span><span class="p">.</span><span class="mi">10</span><span class="p">.</span><span class="mi">1</span><span class="p">.</span><span class="mi">2</span><span class="s1">'--
'</span> <span class="k">grant</span> <span class="k">connect</span> <span class="k">to</span> <span class="n">name</span><span class="p">;</span> <span class="k">grant</span> <span class="n">resource</span> <span class="k">to</span> <span class="n">name</span><span class="p">;</span> <span class="c1">--</span>
<span class="s1">' or 1=1 -- 
'</span> <span class="k">union</span> <span class="p">(</span><span class="k">select</span> <span class="o">@@</span><span class="k">version</span><span class="p">)</span> <span class="c1">--</span>
<span class="s1">' union (select NULL, (select @@version)) --
'</span> <span class="k">union</span> <span class="p">(</span><span class="k">select</span> <span class="k">NULL</span><span class="p">,</span> <span class="k">NULL</span><span class="p">,</span> <span class="p">(</span><span class="k">select</span> <span class="o">@@</span><span class="k">version</span><span class="p">))</span> <span class="c1">--</span>
<span class="s1">' union (select NULL, NULL, NULL,  (select @@version)) --
'</span> <span class="k">union</span> <span class="p">(</span><span class="k">select</span> <span class="k">NULL</span><span class="p">,</span> <span class="k">NULL</span><span class="p">,</span> <span class="k">NULL</span><span class="p">,</span> <span class="k">NULL</span><span class="p">,</span>  <span class="p">(</span><span class="k">select</span> <span class="o">@@</span><span class="k">version</span><span class="p">))</span> <span class="c1">--</span>
<span class="s1">' union (select NULL, NULL, NULL, NULL,  NULL, (select @@version)) --

'</span><span class="p">;</span> <span class="n">if</span> <span class="k">not</span><span class="p">(</span><span class="k">substring</span><span class="p">((</span><span class="k">select</span> <span class="o">@@</span><span class="k">version</span><span class="p">),</span><span class="mi">25</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="n">waitfor</span> <span class="n">delay</span> <span class="s1">'0:0:5'</span> <span class="c1">--</span>
<span class="s1">'; if not(substring((select @@version),25,1) &lt;&gt; 5) waitfor delay '</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="s1">' --
'</span><span class="p">;</span> <span class="n">if</span> <span class="k">not</span><span class="p">(</span><span class="k">substring</span><span class="p">((</span><span class="k">select</span> <span class="o">@@</span><span class="k">version</span><span class="p">),</span><span class="mi">25</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="n">waitfor</span> <span class="n">delay</span> <span class="s1">'0:0:5'</span> <span class="c1">--</span>
<span class="s1">'; if not(substring((select @@version),24,1) &lt;&gt; 1) waitfor delay '</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="s1">' --
'</span><span class="p">;</span> <span class="n">if</span> <span class="k">not</span><span class="p">(</span><span class="k">select</span> <span class="k">system_user</span><span class="p">)</span> <span class="o">&lt;&gt;</span> <span class="s1">'sa'</span> <span class="n">waitfor</span> <span class="n">delay</span> <span class="s1">'0:0:5'</span> <span class="c1">--</span>
<span class="s1">'; if is_srvrolemember('</span><span class="n">sysadmin</span><span class="s1">') &gt; 0 waitfor delay '</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="s1">' -- 
'</span><span class="p">;</span> <span class="n">if</span> <span class="k">not</span><span class="p">((</span><span class="k">select</span> <span class="n">serverproperty</span><span class="p">(</span><span class="s1">'isintegratedsecurityonly'</span><span class="p">))</span> <span class="o">&lt;&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="n">waitfor</span> <span class="n">delay</span> <span class="s1">'0:0:5'</span> <span class="c1">--</span>
<span class="s1">'; if not((select serverproperty('</span><span class="n">isintegratedsecurityonly</span><span class="s1">')) &lt;&gt; 0) waitfor delay '</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="s1">' --
</span></code></pre></div>
</div>

<p>上記の例では BlogPostsController クラスの SearchByAuthor メソッドに対してファジングしているが、同様に他のテスト対象のメソッド・パラメータに対してもテストを作り、実行すればよい。SQL 文を正しく作れている（脆弱性が無い）ならすべてのテストがグリーンになるはず。</p>

<p>テスト実行結果の例（脆弱性を修正する前）<br>
<a href="https://camo.qiitausercontent.com/577deba4ffd9b50ec3135118de4779bf596916ec/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3131383435312f35333532633731662d633133652d303931342d333864372d6661393238356131646535612e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F118451%2F5352c71f-c13e-0914-38d7-fa9285a1de5a.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=fc1a6c51ef9adfb4abb167ebe56e8d13" alt="2020-03-21-00-27-11.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/118451/5352c71f-c13e-0914-38d7-fa9285a1de5a.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F118451%2F5352c71f-c13e-0914-38d7-fa9285a1de5a.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=822911e7714aad27929f051623f6166b 1x" loading="lazy"></a></p>

<h4>
<span id="webサイトに対して実行" class="fragment"></span><a href="#web%E3%82%B5%E3%82%A4%E3%83%88%E3%81%AB%E5%AF%BE%E3%81%97%E3%81%A6%E5%AE%9F%E8%A1%8C"><i class="fa fa-link"></i></a>Webサイトに対して実行</h4>

<p>ユニットテストが困難な場合や、ミドルウェア・フレームワークのバグも心配な場合は、稼働している Web サイトを対象にファジングする。ファジングの方法は IPA が公開している <a href="https://www.ipa.go.jp/files/000057628.pdf" rel="nofollow noopener" target="_blank">ファジング実践資料 第2版</a> を参照。</p>

<p>ただし、ファジングを Web サイトにするのは、ユニットテストの場合と比較すると下記の点で不利。</p>

<ul>
<li>デプロイしないとテストできない

<ul>
<li>テスト環境が必要（本番環境を使うのは超危険！）</li>
<li>フィードバックが遅い</li>
</ul>
</li>
<li>ファジングツールが必要（自前でスクリプトを書いてもいいけど）</li>
</ul>

<h3>
<span id="脆弱性スキャン" class="fragment"></span><a href="#%E8%84%86%E5%BC%B1%E6%80%A7%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3"><i class="fa fa-link"></i></a>脆弱性スキャン</h3>

<p>最後に独立性の高いテストとして、脆弱性スキャンを実行する。上2つのテストが成功していればこのテストも成功する可能性が高いが、万が一の抜け漏れを見つけてくれるかもしれない。</p>

<p>注意点は、スキャナの性能や設定値によっては脆弱性を検出できないことがあること。そのため、次の2点を確認するのがよい。</p>

<ol>
<li>修正前のWebサイトをスキャンして脆弱性が報告されること</li>
<li>修正後のWebサイトをスキャンして脆弱性が報告されないこと（１．と同じスキャン設定で）</li>
</ol>

<p>下記は Nessus を使った例。Nessus の使い方は説明しない。</p>

<p>※Nessus を選んだ理由はたまたま手元にあったから、というだけで、Nessus を推奨しているわけではない。</p>

<p>修正前：CGI Generic SQL Injection という脆弱性が報告されている<br>
<a href="https://camo.qiitausercontent.com/6c86600e4ccf2cf9148e7c7a22c140eeabd2ab3e/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3131383435312f66626133656239642d326536302d343161622d393636322d3439613034643331383665662e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F118451%2Ffba3eb9d-2e60-41ab-9662-49a04d3186ef.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=f98dabaa451e1414964f28db3351bd08" alt="2020-03-16-23-07-17.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/118451/fba3eb9d-2e60-41ab-9662-49a04d3186ef.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F118451%2Ffba3eb9d-2e60-41ab-9662-49a04d3186ef.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=5bc1d9997c347077b1d4a3eadd6e3189 1x" loading="lazy"></a><br>
<a href="https://camo.qiitausercontent.com/5dfd2ba54d9f58bb6e4f6ba265cc9dbcae91b8d7/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3131383435312f66363837396662342d643436632d663061622d333763312d6438313834313262303663612e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F118451%2Ff6879fb4-d46c-f0ab-37c1-d818412b06ca.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=a6d9225b158998bd556fe6968a1637f0" alt="2020-03-16-23-04-24.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/118451/f6879fb4-d46c-f0ab-37c1-d818412b06ca.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F118451%2Ff6879fb4-d46c-f0ab-37c1-d818412b06ca.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=47d99ae164cdbecb21d317b94d9f39bd 1x" loading="lazy"></a></p>

<p>修正後：SQL Injection とそれに関連する脆弱性の報告が消えている<br>
<a href="https://camo.qiitausercontent.com/af6adfbef7df04320c45ff3352c4e57e053b52ad/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3131383435312f32643632356566382d363535662d323738392d663438662d6338653436383537366631632e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F118451%2F2d625ef8-655f-2789-f48f-c8e468576f1c.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=80c88be6a809521de35f072eb1c96ccb" alt="2020-03-16-23-19-50.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/118451/2d625ef8-655f-2789-f48f-c8e468576f1c.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F118451%2F2d625ef8-655f-2789-f48f-c8e468576f1c.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=0e5720270510e2b9dfbcd0fcd6626afc 1x" loading="lazy"></a></p>

<p>このテストの成功をもって脆弱性対策を完了とする。ただし↓</p>

<h3>
<span id="退行テスト" class="fragment"></span><a href="#%E9%80%80%E8%A1%8C%E3%83%86%E3%82%B9%E3%83%88"><i class="fa fa-link"></i></a>退行テスト</h3>

<p>脆弱性を修正したら機能が使えなくなった、では意味がないので忘れずに。<br>
（セキュリティテストではないけど）</p>

<h2>
<span id="まとめ" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>まとめ</h2>

<p>SQLインジェクションが発見されてから修正完了まで、Webアプリケーション開発者（またはテスター）ができることの流れを書いた。</p>

<ol>
<li>再現手順の確立：脆弱性の再現方法を確立する</li>
<li>原因究明：脆弱性の原因を特定する</li>
<li>対策の実行：原因に対応した方法で対策する</li>
<li>修正の確認：1で確立した再現方法を使い、問題が解消されたことを確認する。</li>
<li>セキュリティテスト：コスト、網羅性、独立性、使えるリソース等を考えて、適切なテスト手法を選択する。</li>
</ol>

<p>セキュリティテストの内製化の参考になれば。</p>

<h2>
<span id="参考" class="fragment"></span><a href="#%E5%8F%82%E8%80%83"><i class="fa fa-link"></i></a>参考</h2>

<p>IPAが公開しているガイドライン。開発者以外（PM/POとかセキュリティ担当とか）にも役立つ情報あり。</p>

<ul>
<li><a href="https://www.ipa.go.jp/security/vuln/index.html#section10" rel="nofollow noopener" target="_blank">脆弱性対応ガイドライン</a></li>
<li><a href="https://www.ipa.go.jp/files/000017320.pdf" rel="nofollow noopener" target="_blank">安全なSQLの呼び出し方</a></li>
<li><a href="https://www.ipa.go.jp/security/vuln/fuzzing.html" rel="nofollow noopener" target="_blank">脆弱性対策：ファジング</a></li>
</ul>

<p>Entity Framework 関連</p>

<ul>
<li><a href="https://docs.microsoft.com/ja-jp/ef/core/querying/raw-sql" rel="nofollow noopener" target="_blank">RawSQLクエリ</a></li>
<li><a href="https://docs.microsoft.com/ja-jp/dotnet/framework/data/adonet/ef/security-considerations#prevent-sql-injection-attacks" rel="nofollow noopener" target="_blank">セキュリティに関する注意事項 (Entity Framework)</a></li>
</ul>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Ftakutoy%2Fitems%2F20b41532a262fe75bc37&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Ftakutoy%2Fitems%2F20b41532a262fe75bc37&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/takutoy/items/20b41532a262fe75bc37/likers" class="css-1iupg5d">5</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">4</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/20b41532a262fe75bc37/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/takutoy/items/20b41532a262fe75bc37/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/takutoy/items/20b41532a262fe75bc37/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/takutoy/items/20b41532a262fe75bc37/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/takutoy/items/20b41532a262fe75bc37.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-5023b591-5eb5-4327-8dec-e1702ad022d2">{"authorAnalyticsTrackingId":null,"organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-adc60d55-f1fa-4b6f-a0ae-5ae02db01490"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-adc60d55-f1fa-4b6f-a0ae-5ae02db01490">{}</script>
      
<div id="LoginModal-react-component-2bd4e218-b312-4741-a863-8f95cea57d3f"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-2bd4e218-b312-4741-a863-8f95cea57d3f">{}</script>
      
<div id="StockModal-react-component-517f4ccf-5371-433f-b4f1-3ddc92f5adcd"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-517f4ccf-5371-433f-b4f1-3ddc92f5adcd">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;A6/I2TMtmgxU1j0+HQXoPRVeKF/iK7yeYXKWZFocBvgHTzuxHafScgoTFALHH2Ql7FoAF6cN2hWVt0+GEGMJRw==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\u003cp\u003e脆弱性が報告されてから修正が完了するまでに、Webアプリケーション開発者(またはテスター)ができることをセキュリティテストを中心に書く。\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e再現手順の確立\u003c/li\u003e\n\u003cli\u003e原因究明\u003c/li\u003e\n\u003cli\u003e対策の実行\u003c/li\u003e\n\u003cli\u003e修正の確認\u003c/li\u003e\n\u003cli\u003eセキュリティテスト\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eセキュリティテストってどうやればいいの？とか、セキュリティベンダの脆弱性診断高すぎ内製化したる！とか、そんな人たちの参考になればいいなあ。\u003c/p\u003e\n\n\u003cp\u003e※本記事のサンプルコードは C# + Entity Framework だが、プロセスは他の言語やフレームワークでも通用する。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"1再現手順の確立\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#1%E5%86%8D%E7%8F%BE%E6%89%8B%E9%A0%86%E3%81%AE%E7%A2%BA%E7%AB%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e1.再現手順の確立\u003c/h2\u003e\n\n\u003cp\u003e※注意：再現行為を本番環境でやるのは危険すぎるので、検証環境でやるのがよい\u003c/p\u003e\n\n\u003cp\u003e脆弱性が報告されたら、通常のバグ修正と同じように、まず脆弱性を再現させる。（TDD風に言うなら、レッドになるテストを作る）\u003c/p\u003e\n\n\u003cp\u003eSQLインジェクションの場合、主にHTTPリクエスト（URL、ヘッダ、本文など）が再現手順になる。あらかじめ Web サイトへのログインが必要な場合は、それも再現手順に含めておく。\u003c/p\u003e\n\n\u003cp\u003e再現手順を確立しておくことで、修正後に再現しなくなる（テストがグリーンになる）＝修正できたことを確認できるようになる。\u003c/p\u003e\n\n\u003cp\u003eまた、この時点で脆弱性スキャナを実行して脆弱性が検出されることを確認しておくのもよい。理由は後述の \u003ca href=\"#%E8%84%86%E5%BC%B1%E6%80%A7%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3\"\u003e脆弱性スキャン\u003c/a\u003e に記載。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"2原因究明\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#2%E5%8E%9F%E5%9B%A0%E7%A9%B6%E6%98%8E\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2.原因究明\u003c/h2\u003e\n\n\u003cp\u003eSQL インジェクションの原因は、たとえば次のようなケースが考えられる。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e自分たちが書いたコードに問題がある場合\u003c/li\u003e\n\u003cli\u003eミドルウェアやライブラリ、プラグイン等に脆弱性があった場合\u003c/li\u003e\n\u003cli\u003e脆弱なテストプログラムやサンプルプログラムが残ったままになっていた場合\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e原因がわかったら、報告を受けた箇所だけではなくほかにも同様の問題がないかも確認する。\u003c/p\u003e\n\n\u003cp\u003e今回は自分たちが書いたコードに問題がある場合を想定して話を進める。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"3対策の実行\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#3%E5%AF%BE%E7%AD%96%E3%81%AE%E5%AE%9F%E8%A1%8C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e3.対策の実行\u003c/h2\u003e\n\n\u003cp\u003eSQLインジェクションの対策について詳しく知りたい場合は、IPA が公開している \u003ca href=\"https://www.ipa.go.jp/files/000017320.pdf\" rel=\"nofollow noopener\" target=\"_blank\"\u003e安全なSQLの呼び出し方\u003c/a\u003e を参照。\u003c/p\u003e\n\n\u003cp\u003eたとえばこんなコードを\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eSQLインジェクション可能なコード\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003esql\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"SELECT Id, Author, Title, PostedAt, Text From Posts\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003esql\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"s\"\u003e$\" Where Author like '%\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eauthor\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e%'\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003e_context\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePosts\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFromSqlRaw\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esql\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eToArrayAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eこんな感じに修正する\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eSQLインジェクション対策済みコード\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003e_context\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePosts\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWhere\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ep\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAuthor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eContains\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eauthor\u003c/span\u003e\u003cspan class=\"p\"\u003e)).\u003c/span\u003e\u003cspan class=\"nf\"\u003eToArrayAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"4修正の確認\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#4%E4%BF%AE%E6%AD%A3%E3%81%AE%E7%A2%BA%E8%AA%8D\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e4.修正の確認\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\"#1%E5%86%8D%E7%8F%BE%E6%89%8B%E9%A0%86%E3%81%AE%E7%A2%BA%E7%AB%8B\"\u003e1.再現手順の確立\u003c/a\u003e で確立した脆弱性の再現方法を修正箇所に試し、問題が再現しないことを確認する。\u003c/p\u003e\n\n\u003cp\u003eこれで対策完了！ではない。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"5セキュリティテスト\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#5%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%83%86%E3%82%B9%E3%83%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e5.セキュリティテスト\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\"#4%E4%BF%AE%E6%AD%A3%E3%81%AE%E7%A2%BA%E8%AA%8D\"\u003e4.修正の確認\u003c/a\u003eは「正しくできた」ことを確認するテスト。対して「正しくできていない」ことを発見するのがセキュリティテストの役割になる。「正しくできていない」とは、間違った対策や中途半端な対策のこと。\u003c/p\u003e\n\n\u003cp\u003eセキュリティテストは、通常のテストと同様、コストと網羅性のバランスが必要。修正完了までコードの変更とテストが何度も繰り返されることも多いので、フィードバックの早さも重要。すべてを満たすテスト手法は多分ないので、複数の手法を組み合わせるのが良い。\u003c/p\u003e\n\n\u003cp\u003eSQLインジェクションの問題は、コードを見ればある程度問題の有無を判断できることと、自動テストを書きやすそうなことから、次の３つの手法を採用することにする。\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eコードインスペクション\n\n\u003cul\u003e\n\u003cli\u003e○コスト安：手っ取り早く実行できる\u003c/li\u003e\n\u003cli\u003e○フィードバック超早：コードが見れればできる\u003c/li\u003e\n\u003cli\u003e×属人性高：セキュアコーディングのスキルが必要\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eファジング\n\n\u003cul\u003e\n\u003cli\u003e○フィードバック早：自動化しやすく、繰り返し実行できる\u003c/li\u003e\n\u003cli\u003e△コスト中：入力データや自動テストを作る必要がある\u003c/li\u003e\n\u003cli\u003e△属人性中：適切なテストデータを作る・選ぶスキルが必要\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e脆弱性スキャン\n\n\u003cul\u003e\n\u003cli\u003e○属人性低：独立性が高く、かつ安定した結果が得られる\u003c/li\u003e\n\u003cli\u003e×フィードバック遅：デプロイが必要\u003c/li\u003e\n\u003cli\u003e×コスト高：ツールによってはお金がかかる。学習コストもあるかも。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eプロジェクトによっては下記のような選択肢もあるかもしれない。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e静的コード解析ツール(SAST)を使う（良い精度のツールがあるなら）\u003c/li\u003e\n\u003cli\u003esqlmap のようなツールを使って疑似攻撃を試みる（セキュリティエンジニアがいるなら）\u003c/li\u003e\n\u003cli\u003eセキュリティベンダに診断を依頼する（超重要なシステムで、かつ、お金と時間があるなら）\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"コードインスペクション\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B3%E3%83%BC%E3%83%89%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%9A%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eコードインスペクション\u003c/h3\u003e\n\n\u003cp\u003eコードインスペクションは静的なホワイトボックステストの１つ。あるルールに基づいて人（または機械）がコードを精査し、欠陥を発見する手法。\u003c/p\u003e\n\n\u003cp\u003eコードさえ見れれば、デプロイどころかコンパイラすらしなくてもテストできるため、実行コストが低くフィードバックがとても早いという利点がある。ただし精度はテスターのスキルに依存する。\u003c/p\u003e\n\n\u003cp\u003eコードインスペクションではセキュリティの問題を発見することにのみ集中する。SQL インジェクション対策のインスペクションであれば、「パラメータを文字列操作してSQL文を作成していないこと」のようなルールをあらかじめ定めたうえで精査する。\u003c/p\u003e\n\n\u003cp\u003eルールは言語やフレームワークによって異なる点に注意。C# + Entity Framework の場合、下記のようなルールになる。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e問題なし：固定文字列なSQL\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003esql\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"SELECT * from Posts\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e問題なし：SQLを文字列連結しているが、可変部分はない\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003esql\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"SELECT * from Posts\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003esql\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"s\"\u003e\" WHERE author = 'Tanaka Ichiro'\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e問題なし：パラメータプレースホルダを使ってる\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003esql\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"SELECT Id, Author, Title, PostedAt, Text From Posts\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003esql\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"s\"\u003e\" Where Author = {0}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003e_context\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePosts\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFromSqlRaw\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esql\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eauthor\u003c/span\u003e\u003cspan class=\"p\"\u003e)...\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e問題なし：LINQ_to_SQL\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003edbContext\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePosts\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWhere\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ep\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAuthor\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eauthor\u003c/span\u003e\u003cspan class=\"p\"\u003e)...\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e×問題有り：パラメータを文字列連結してSQL文を生成している\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003esql\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"SELECT * from Posts\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003esql\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"s\"\u003e\" WHERE author = '\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eauthor\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\"'\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e×問題有り：パラメータを文字列置換してSQL文を生成している\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003esql\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"SELECT * from Posts\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003esql\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"s\"\u003e\" WHERE author = '{AUTHOR}'\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003esql\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esql\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReplace\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"{AUTHOR}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eauthor\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e※例では SELECT のみ挙げたが INSERT, UPDATE, DELETE 等ほかのSQL文のルールも必要\u003c/p\u003e\n\n\u003cp\u003eコーディング規約がない場合はいろんなSQL発行パターンがわいてくるので、判断基準を作りながらテストするか、いっそ標準を定めて標準以外の書き方はNGとしてしまってもよいかもしれない。\u003c/p\u003e\n\n\u003cp\u003eコードインスペクションのアウトプットは、テスト対象となったファイルとその結果の一覧になる。（例）\u003c/p\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align: left\"\u003eファイル名\u003c/th\u003e\n\u003cth style=\"text-align: left\"\u003eSQL発行の有無\u003c/th\u003e\n\u003cth style=\"text-align: left\"\u003eメソッド名\u003c/th\u003e\n\u003cth style=\"text-align: left\"\u003eパラメータ有無\u003c/th\u003e\n\u003cth style=\"text-align: left\"\u003eSQL発行方法\u003c/th\u003e\n\u003cth style=\"text-align: left\"\u003eOK/NG\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003eHoge.cs\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e無し\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e-\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e-\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e-\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eOK\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003eFoo.cs\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e有り\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eBar\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e無し\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e-\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eOK\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003eFoo.cs\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e有り\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eNar\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e有り\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eLINQ to SQL\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eOK\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003eMoge.cs\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e有り\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eSoge\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e有り\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eParametered Query\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eOK\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003eMoge.cs\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e有り\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eDoge\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e有り\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e文字列連結\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eNG\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003cp\u003eこの結果を受けて、例えば次のような判断ができる。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eNG がなくなるまで修正と再テストを繰り返す\u003c/li\u003e\n\u003cli\u003e(コードの修正が困難すぎて)NGや判断不可な箇所を\n\n\u003cul\u003e\n\u003cli\u003e以降のテストでカバーする\u003c/li\u003e\n\u003cli\u003e熟練セキュアコーダーにインスペクションしてもらう（人がいれば）\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eこの結果にかかわらず、以降のテストを全箇所実施する\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eどうするかは、テストの独立性やコストパフォーマンス等のバランスを見て決めればよい。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"ファジング\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%95%E3%82%A1%E3%82%B8%E3%83%B3%E3%82%B0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eファジング\u003c/h3\u003e\n\n\u003cp\u003eファジングは動的なブラックボックステストの１つで、「変なデータ」を入力しまくって欠陥を見つける手法。詳しくは IPA の \u003ca href=\"https://www.ipa.go.jp/security/vuln/fuzzing.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003e脆弱性対策：ファジング\u003c/a\u003e を参照。\u003c/p\u003e\n\n\u003cp\u003eファジングはWebサイトに対して実行することもできるし、SQLを発行している関数・メソッドに対しても実行できる。\u003c/p\u003e\n\n\u003cp\u003eテストは小さい単位でやるほうがコストパフォーマンスがよくフィードバックも早いので、可能なら関数・メソッドに対してやるのがお勧め。もちろん Web サイトにやってもよい。\u003c/p\u003e\n\n\u003cp\u003e「変なデータ」はランダムに作っても良いが、今回は \u003ca href=\"https://github.com/fuzzdb-project/fuzzdb/tree/master/attack/sql-injection/detect\" rel=\"nofollow noopener\" target=\"_blank\"\u003efuzzdb\u003c/a\u003e で公開されている SQL インジェクションを発見するための入力パターン集を使う。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"ユニットテストフレームワークで実行\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%A6%E3%83%8B%E3%83%83%E3%83%88%E3%83%86%E3%82%B9%E3%83%88%E3%83%95%E3%83%AC%E3%83%BC%E3%83%A0%E3%83%AF%E3%83%BC%E3%82%AF%E3%81%A7%E5%AE%9F%E8%A1%8C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eユニットテストフレームワークで実行\u003c/h4\u003e\n\n\u003cp\u003e関数・メソッドに対してテストする場合、ユニットテストフレームワークを使うのが楽。（ユニットテストか？という疑問は気にしないことにする）\u003c/p\u003e\n\n\u003cp\u003e以下は C# + ASP.NET Core + SQL Server + xUnit.net の例\u003c/p\u003e\n\n\u003cp\u003eこんな脆弱なコードに対して\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eSQLインジェクション可能なコード\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eBlogPostsController\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eController\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eBlogDbContext\u003c/span\u003e \u003cspan class=\"n\"\u003e_context\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eBlogPostsController\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eBlogDbContext\u003c/span\u003e \u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003e_context\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eBlogPost\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"k\"\u003e]\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eSearchByAuthor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eauthor\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 危険なコード！\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003esql\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"SELECT Id, Author, Title, PostedAt, Text From Posts\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003esql\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"s\"\u003e$\" Where Author like '%\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eauthor\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e%'\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003e_context\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePosts\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFromSqlRaw\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esql\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eToArrayAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// 省略...\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eこんなテストコードを書く\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eユニットテストコード\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eUnitTest1\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// fuzz.txt の１行を１テストケースとして定義\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// ※後述の Parameters プロパティを参照\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eTheory\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eMemberData\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enameof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eParameters\u003c/span\u003e\u003cspan class=\"p\"\u003e))]\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e \u003cspan class=\"nf\"\u003eSqlInjectionTest\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eparam\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// * Arrange\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003edb\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eBlogDbContext\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// テーブルを空にしておく\u003c/span\u003e\n            \u003cspan class=\"n\"\u003edb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePosts\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRemoveRange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePosts\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToArray\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// SQL が正しく実行されれば、この Entity が帰ってくるはず\u003c/span\u003e\n            \u003cspan class=\"n\"\u003edb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePosts\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eBlogPost\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003eAuthor\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eparam\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eTitle\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"test\"\u003c/span\u003e \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// こっちは帰ってこないはず\u003c/span\u003e\n            \u003cspan class=\"n\"\u003edb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePosts\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eBlogPost\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003eAuthor\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Dummy\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eTitle\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Dummy\"\u003c/span\u003e \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n            \u003cspan class=\"n\"\u003edb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSaveChanges\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003edb\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eBlogDbContext\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003econtroller\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eBlogPostsController\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edb\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003esw\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eStopwatch\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eStartNew\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// * Act\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eresult\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003econtroller\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eQueryPosts\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eparam\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// * Assert\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// 実行に5秒以上かかったら Blind な SQL Injection が成功してるのでNG\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eAssert\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eTrue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eElapsedMilliseconds\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"m\"\u003e5000\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Blind SQL Injection\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// 正しいSQL文が発行されていれば１件の結果が返ってくるはず\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eAssert\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEqual\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eparam\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eresult\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSingle\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"n\"\u003eAuthor\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// SqlInjectionTest で使う入力データ列\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eIEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eobject\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"k\"\u003e]\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eParameters\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eget\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ef\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ePath\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCombine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eAppDomain\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCurrentDomain\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBaseDirectory\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"fuzz.txt\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eFile\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReadAllLines\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ef\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWhere\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003el\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e!\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eIsNullOrWhiteSpace\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003el\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSelect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003el\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003eobject\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003el\u003c/span\u003e \u003cspan class=\"p\"\u003e})\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToArray\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eユニットテストの入力データに使う fuzz.txt はこんな感じ。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"sql\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eテストデータ\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e--\u003c/span\u003e\n\u003cspan class=\"s1\"\u003e'; --\n'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e--\u003c/span\u003e\n\u003cspan class=\"s1\"\u003e'; exec master..xp_cmdshell '\u003c/span\u003e\u003cspan class=\"n\"\u003eping\u003c/span\u003e \u003cspan class=\"mi\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"s1\"\u003e'--\n'\u003c/span\u003e \u003cspan class=\"k\"\u003egrant\u003c/span\u003e \u003cspan class=\"k\"\u003econnect\u003c/span\u003e \u003cspan class=\"k\"\u003eto\u003c/span\u003e \u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003egrant\u003c/span\u003e \u003cspan class=\"n\"\u003eresource\u003c/span\u003e \u003cspan class=\"k\"\u003eto\u003c/span\u003e \u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e--\u003c/span\u003e\n\u003cspan class=\"s1\"\u003e' or 1=1 -- \n'\u003c/span\u003e \u003cspan class=\"k\"\u003eunion\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eselect\u003c/span\u003e \u003cspan class=\"o\"\u003e@@\u003c/span\u003e\u003cspan class=\"k\"\u003eversion\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e--\u003c/span\u003e\n\u003cspan class=\"s1\"\u003e' union (select NULL, (select @@version)) --\n'\u003c/span\u003e \u003cspan class=\"k\"\u003eunion\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eselect\u003c/span\u003e \u003cspan class=\"k\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eselect\u003c/span\u003e \u003cspan class=\"o\"\u003e@@\u003c/span\u003e\u003cspan class=\"k\"\u003eversion\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"c1\"\u003e--\u003c/span\u003e\n\u003cspan class=\"s1\"\u003e' union (select NULL, NULL, NULL,  (select @@version)) --\n'\u003c/span\u003e \u003cspan class=\"k\"\u003eunion\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eselect\u003c/span\u003e \u003cspan class=\"k\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e  \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eselect\u003c/span\u003e \u003cspan class=\"o\"\u003e@@\u003c/span\u003e\u003cspan class=\"k\"\u003eversion\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"c1\"\u003e--\u003c/span\u003e\n\u003cspan class=\"s1\"\u003e' union (select NULL, NULL, NULL, NULL,  NULL, (select @@version)) --\n\n'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003eif\u003c/span\u003e \u003cspan class=\"k\"\u003enot\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003esubstring\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"k\"\u003eselect\u003c/span\u003e \u003cspan class=\"o\"\u003e@@\u003c/span\u003e\u003cspan class=\"k\"\u003eversion\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\u003cspan class=\"mi\"\u003e25\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026gt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003ewaitfor\u003c/span\u003e \u003cspan class=\"n\"\u003edelay\u003c/span\u003e \u003cspan class=\"s1\"\u003e'0:0:5'\u003c/span\u003e \u003cspan class=\"c1\"\u003e--\u003c/span\u003e\n\u003cspan class=\"s1\"\u003e'; if not(substring((select @@version),25,1) \u0026lt;\u0026gt; 5) waitfor delay '\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"mi\"\u003e5\u003c/span\u003e\u003cspan class=\"s1\"\u003e' --\n'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003eif\u003c/span\u003e \u003cspan class=\"k\"\u003enot\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003esubstring\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"k\"\u003eselect\u003c/span\u003e \u003cspan class=\"o\"\u003e@@\u003c/span\u003e\u003cspan class=\"k\"\u003eversion\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\u003cspan class=\"mi\"\u003e25\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026gt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e8\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003ewaitfor\u003c/span\u003e \u003cspan class=\"n\"\u003edelay\u003c/span\u003e \u003cspan class=\"s1\"\u003e'0:0:5'\u003c/span\u003e \u003cspan class=\"c1\"\u003e--\u003c/span\u003e\n\u003cspan class=\"s1\"\u003e'; if not(substring((select @@version),24,1) \u0026lt;\u0026gt; 1) waitfor delay '\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"mi\"\u003e5\u003c/span\u003e\u003cspan class=\"s1\"\u003e' --\n'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003eif\u003c/span\u003e \u003cspan class=\"k\"\u003enot\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eselect\u003c/span\u003e \u003cspan class=\"k\"\u003esystem_user\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026gt;\u003c/span\u003e \u003cspan class=\"s1\"\u003e'sa'\u003c/span\u003e \u003cspan class=\"n\"\u003ewaitfor\u003c/span\u003e \u003cspan class=\"n\"\u003edelay\u003c/span\u003e \u003cspan class=\"s1\"\u003e'0:0:5'\u003c/span\u003e \u003cspan class=\"c1\"\u003e--\u003c/span\u003e\n\u003cspan class=\"s1\"\u003e'; if is_srvrolemember('\u003c/span\u003e\u003cspan class=\"n\"\u003esysadmin\u003c/span\u003e\u003cspan class=\"s1\"\u003e') \u0026gt; 0 waitfor delay '\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"mi\"\u003e5\u003c/span\u003e\u003cspan class=\"s1\"\u003e' -- \n'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003eif\u003c/span\u003e \u003cspan class=\"k\"\u003enot\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"k\"\u003eselect\u003c/span\u003e \u003cspan class=\"n\"\u003eserverproperty\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'isintegratedsecurityonly'\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026gt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003ewaitfor\u003c/span\u003e \u003cspan class=\"n\"\u003edelay\u003c/span\u003e \u003cspan class=\"s1\"\u003e'0:0:5'\u003c/span\u003e \u003cspan class=\"c1\"\u003e--\u003c/span\u003e\n\u003cspan class=\"s1\"\u003e'; if not((select serverproperty('\u003c/span\u003e\u003cspan class=\"n\"\u003eisintegratedsecurityonly\u003c/span\u003e\u003cspan class=\"s1\"\u003e')) \u0026lt;\u0026gt; 0) waitfor delay '\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"mi\"\u003e5\u003c/span\u003e\u003cspan class=\"s1\"\u003e' --\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e上記の例では BlogPostsController クラスの SearchByAuthor メソッドに対してファジングしているが、同様に他のテスト対象のメソッド・パラメータに対してもテストを作り、実行すればよい。SQL 文を正しく作れている（脆弱性が無い）ならすべてのテストがグリーンになるはず。\u003c/p\u003e\n\n\u003cp\u003eテスト実行結果の例（脆弱性を修正する前）\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/577deba4ffd9b50ec3135118de4779bf596916ec/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3131383435312f35333532633731662d633133652d303931342d333864372d6661393238356131646535612e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F118451%2F5352c71f-c13e-0914-38d7-fa9285a1de5a.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=fc1a6c51ef9adfb4abb167ebe56e8d13\" alt=\"2020-03-21-00-27-11.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/118451/5352c71f-c13e-0914-38d7-fa9285a1de5a.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F118451%2F5352c71f-c13e-0914-38d7-fa9285a1de5a.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=822911e7714aad27929f051623f6166b 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"webサイトに対して実行\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#web%E3%82%B5%E3%82%A4%E3%83%88%E3%81%AB%E5%AF%BE%E3%81%97%E3%81%A6%E5%AE%9F%E8%A1%8C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eWebサイトに対して実行\u003c/h4\u003e\n\n\u003cp\u003eユニットテストが困難な場合や、ミドルウェア・フレームワークのバグも心配な場合は、稼働している Web サイトを対象にファジングする。ファジングの方法は IPA が公開している \u003ca href=\"https://www.ipa.go.jp/files/000057628.pdf\" rel=\"nofollow noopener\" target=\"_blank\"\u003eファジング実践資料 第2版\u003c/a\u003e を参照。\u003c/p\u003e\n\n\u003cp\u003eただし、ファジングを Web サイトにするのは、ユニットテストの場合と比較すると下記の点で不利。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eデプロイしないとテストできない\n\n\u003cul\u003e\n\u003cli\u003eテスト環境が必要（本番環境を使うのは超危険！）\u003c/li\u003e\n\u003cli\u003eフィードバックが遅い\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eファジングツールが必要（自前でスクリプトを書いてもいいけど）\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"脆弱性スキャン\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%84%86%E5%BC%B1%E6%80%A7%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e脆弱性スキャン\u003c/h3\u003e\n\n\u003cp\u003e最後に独立性の高いテストとして、脆弱性スキャンを実行する。上2つのテストが成功していればこのテストも成功する可能性が高いが、万が一の抜け漏れを見つけてくれるかもしれない。\u003c/p\u003e\n\n\u003cp\u003e注意点は、スキャナの性能や設定値によっては脆弱性を検出できないことがあること。そのため、次の2点を確認するのがよい。\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e修正前のWebサイトをスキャンして脆弱性が報告されること\u003c/li\u003e\n\u003cli\u003e修正後のWebサイトをスキャンして脆弱性が報告されないこと（１．と同じスキャン設定で）\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003e下記は Nessus を使った例。Nessus の使い方は説明しない。\u003c/p\u003e\n\n\u003cp\u003e※Nessus を選んだ理由はたまたま手元にあったから、というだけで、Nessus を推奨しているわけではない。\u003c/p\u003e\n\n\u003cp\u003e修正前：CGI Generic SQL Injection という脆弱性が報告されている\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/6c86600e4ccf2cf9148e7c7a22c140eeabd2ab3e/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3131383435312f66626133656239642d326536302d343161622d393636322d3439613034643331383665662e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F118451%2Ffba3eb9d-2e60-41ab-9662-49a04d3186ef.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=f98dabaa451e1414964f28db3351bd08\" alt=\"2020-03-16-23-07-17.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/118451/fba3eb9d-2e60-41ab-9662-49a04d3186ef.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F118451%2Ffba3eb9d-2e60-41ab-9662-49a04d3186ef.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=5bc1d9997c347077b1d4a3eadd6e3189 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/5dfd2ba54d9f58bb6e4f6ba265cc9dbcae91b8d7/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3131383435312f66363837396662342d643436632d663061622d333763312d6438313834313262303663612e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F118451%2Ff6879fb4-d46c-f0ab-37c1-d818412b06ca.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=a6d9225b158998bd556fe6968a1637f0\" alt=\"2020-03-16-23-04-24.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/118451/f6879fb4-d46c-f0ab-37c1-d818412b06ca.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F118451%2Ff6879fb4-d46c-f0ab-37c1-d818412b06ca.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=47d99ae164cdbecb21d317b94d9f39bd 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e修正後：SQL Injection とそれに関連する脆弱性の報告が消えている\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/af6adfbef7df04320c45ff3352c4e57e053b52ad/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3131383435312f32643632356566382d363535662d323738392d663438662d6338653436383537366631632e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F118451%2F2d625ef8-655f-2789-f48f-c8e468576f1c.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=80c88be6a809521de35f072eb1c96ccb\" alt=\"2020-03-16-23-19-50.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/118451/2d625ef8-655f-2789-f48f-c8e468576f1c.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F118451%2F2d625ef8-655f-2789-f48f-c8e468576f1c.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=0e5720270510e2b9dfbcd0fcd6626afc 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eこのテストの成功をもって脆弱性対策を完了とする。ただし↓\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"退行テスト\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%80%80%E8%A1%8C%E3%83%86%E3%82%B9%E3%83%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e退行テスト\u003c/h3\u003e\n\n\u003cp\u003e脆弱性を修正したら機能が使えなくなった、では意味がないので忘れずに。\u003cbr\u003e\n（セキュリティテストではないけど）\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"まとめ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eまとめ\u003c/h2\u003e\n\n\u003cp\u003eSQLインジェクションが発見されてから修正完了まで、Webアプリケーション開発者（またはテスター）ができることの流れを書いた。\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e再現手順の確立：脆弱性の再現方法を確立する\u003c/li\u003e\n\u003cli\u003e原因究明：脆弱性の原因を特定する\u003c/li\u003e\n\u003cli\u003e対策の実行：原因に対応した方法で対策する\u003c/li\u003e\n\u003cli\u003e修正の確認：1で確立した再現方法を使い、問題が解消されたことを確認する。\u003c/li\u003e\n\u003cli\u003eセキュリティテスト：コスト、網羅性、独立性、使えるリソース等を考えて、適切なテスト手法を選択する。\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eセキュリティテストの内製化の参考になれば。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"参考\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8F%82%E8%80%83\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e参考\u003c/h2\u003e\n\n\u003cp\u003eIPAが公開しているガイドライン。開発者以外（PM/POとかセキュリティ担当とか）にも役立つ情報あり。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://www.ipa.go.jp/security/vuln/index.html#section10\" rel=\"nofollow noopener\" target=\"_blank\"\u003e脆弱性対応ガイドライン\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://www.ipa.go.jp/files/000017320.pdf\" rel=\"nofollow noopener\" target=\"_blank\"\u003e安全なSQLの呼び出し方\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://www.ipa.go.jp/security/vuln/fuzzing.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003e脆弱性対策：ファジング\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eEntity Framework 関連\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://docs.microsoft.com/ja-jp/ef/core/querying/raw-sql\" rel=\"nofollow noopener\" target=\"_blank\"\u003eRawSQLクエリ\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://docs.microsoft.com/ja-jp/dotnet/framework/data/adonet/ef/security-considerations#prevent-sql-injection-attacks\" rel=\"nofollow noopener\" target=\"_blank\"\u003eセキュリティに関する注意事項 (Entity Framework)\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n","createdAt":"2020-03-21T08:46:23Z","elapsedYearsFromLastModifiedAt":1,"encryptedId":"c4ANQOmOOvFhJsjU021NnLmx522sG3VCzA==--JJYwpIoaiogoCTTE--w61h0FJqCTkqZSVLy6S7AQ==","isBanned":false,"isDeprecated":true,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2020-03-31T14:13:53Z","likesCount":5,"linkUrl":"https://qiita.com/takutoy/items/20b41532a262fe75bc37","organization":null,"originalId":1189885,"stockedCount":4,"title":"脆弱性を直した後のセキュリティテスト（SQLインジェクションの場合）","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#1%E5%86%8D%E7%8F%BE%E6%89%8B%E9%A0%86%E3%81%AE%E7%A2%BA%E7%AB%8B\"\u003e1.再現手順の確立\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#2%E5%8E%9F%E5%9B%A0%E7%A9%B6%E6%98%8E\"\u003e2.原因究明\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#3%E5%AF%BE%E7%AD%96%E3%81%AE%E5%AE%9F%E8%A1%8C\"\u003e3.対策の実行\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#4%E4%BF%AE%E6%AD%A3%E3%81%AE%E7%A2%BA%E8%AA%8D\"\u003e4.修正の確認\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#5%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%83%86%E3%82%B9%E3%83%88\"\u003e5.セキュリティテスト\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B3%E3%83%BC%E3%83%89%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%9A%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3\"\u003eコードインスペクション\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%95%E3%82%A1%E3%82%B8%E3%83%B3%E3%82%B0\"\u003eファジング\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%A6%E3%83%8B%E3%83%83%E3%83%88%E3%83%86%E3%82%B9%E3%83%88%E3%83%95%E3%83%AC%E3%83%BC%E3%83%A0%E3%83%AF%E3%83%BC%E3%82%AF%E3%81%A7%E5%AE%9F%E8%A1%8C\"\u003eユニットテストフレームワークで実行\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#web%E3%82%B5%E3%82%A4%E3%83%88%E3%81%AB%E5%AF%BE%E3%81%97%E3%81%A6%E5%AE%9F%E8%A1%8C\"\u003eWebサイトに対して実行\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E8%84%86%E5%BC%B1%E6%80%A7%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3\"\u003e脆弱性スキャン\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E9%80%80%E8%A1%8C%E3%83%86%E3%82%B9%E3%83%88\"\u003e退行テスト\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"\u003eまとめ\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%8F%82%E8%80%83\"\u003e参考\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":13831,"uuid":"20b41532a262fe75bc37","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"Vq/Z5ENqcGv5lZUZ15b72MTLh1Yc--EMTKe4aJ5F2dEJfr--ejn+Mpi4bQajOIRh433qDA==","originalId":118451,"description":"","facebookUrl":null,"githubUrl":null,"isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"","profileImageUrl":"https://qiita-image-store.s3.amazonaws.com/0/118451/profile-images/1473713930","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F118451%2Fprofile-images%2F1473713930?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=4234a0cefd811ecc736ddb1e3f4c3a7a","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F118451%2Fprofile-images%2F1473713930?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=2d63c3b17bbc4477c7258643ea704ed3","urlName":"takutoy","websiteUrl":"https://github.com/takutoy","twitterUrl":null,"twitterUrlName":null,"revealedOrganizations":{"edges":[]}},"tags":[{"name":"C#","urlName":"csharp"},{"name":"EntityFramework","urlName":"entityframework"},{"name":"セキュリティ","urlName":"%e3%82%bb%e3%82%ad%e3%83%a5%e3%83%aa%e3%83%86%e3%82%a3"},{"name":"SQLインジェクション","urlName":"sql%e3%82%a4%e3%83%b3%e3%82%b8%e3%82%a7%e3%82%af%e3%82%b7%e3%83%a7%e3%83%b3"},{"name":"セキュリティテスト","urlName":"%e3%82%bb%e3%82%ad%e3%83%a5%e3%83%aa%e3%83%86%e3%82%a3%e3%83%86%e3%82%b9%e3%83%88"}],"followingLikers":{"edges":[]},"comments":{"totalCount":0}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

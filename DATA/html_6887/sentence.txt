More than 3 years have passed since last update.こんなデータ集計用のクラスがあります。これをマルチスレッドで動かす事を考えます。
lockを使うのが簡単ですが、今回はlockより軽いInterlockedを使ってみます。足し算とインクリメントは専用の関数があるのですが、最大値の更新は関数がありません。
使えそうな関数を探すと、「if (a == b) a = c;」という、同じ値なら値を更新する
CompareExchangeという関数がみつかります。
この関数を使い、比較前の値と異なる値になっていたら、もう一度やり直す、という仕組みをいれます。



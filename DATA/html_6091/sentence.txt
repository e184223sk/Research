More than 3 years have passed since last update.今日は、.NET のクラスライブラリ設計の本を読んだ。Collection 周りが理解できていないのがわかったので、設計方針をリストアップして、分かっていないところをつぶしたいと思う。コレクションのほうが、高いユーザビリティを誇るため。ただし、低レベルのAPIを開発しているときは、配列を使用するほうが良いときがある。配列の要素のアクセスは、コレクションより高速であるから。メモリを抑えて高速化したいときなど。また、バイトの場合は、コレクションより配列。（これは上記の理由と思われる。）ジャグ配列というのは、配列の要素が配列であるもの。多次元配列と比較すると、メモリ消費量が有利で、CLRは、ジャグ配列におけるインデックス操作も最適化してくれるので、早そうです。これは、本当かしらんので試してみましょう。メモリがどう違うか確かめてみます。実行結果ん、確かに。しかし、Linq が一番早いのは意外！優秀ですね。ちなみに、多次元配列だと、Linqはつかえませんでした。
じゃあ、メモリ。Visual Studio で、ヒープのスナップショットを撮って、比較してみます。ジャグ配列は単純に、ある型としてヒープが消費されていますが、多次元配列は、新たに多次元配列の型が出来てメモリを消費しているようです。たしかに、倍ぐらい多次元配列のほうがメモリを食っています。今はLinq もあるし、確かにジャグ配列ですな。長くなったので、まずは第一弾ここまで。



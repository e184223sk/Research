<!DOCTYPE html><html><head><meta charset="utf-8" /><title>古来よりUnity非同期を実現していたコルーチンとは何者か？ - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/4_mio_11/items/3030f9a39f59cd68f705" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="tTYHyt1HZ7jWAAYCVrsjAZgT01v+n5YHRz9miu8SmMjNFi7218JCTreOihjdhkel1sdh1sE3PpmCueJYbzJcpA==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta content="@4_mio_11" name="twitter:creator" /><meta property="og:type" content="article"><meta property="og:title" content="古来よりUnity非同期を実現していたコルーチンとは何者か？ - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND01WS1rNXAybDQ0S0k0NEtLVlc1cGRIbnBuWjdsa0l6bW5KX2pncExscnBfbmo3N2pnWmZqZ2FiamdZVGpnWl9qZ3JQamc2dmpnN3pqZzRIamc3UGpnYWpqZ2Ffa3ZaWG9nSVhqZ1l2dnZKOCZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTU0JnR4dC1jbGlwPWVsbGlwc2lzJnR4dC1hbGlnbj1jZW50ZXIlMkNtaWRkbGUmcz04OGQzOWM5NzVjMTY2OTExNmQzMGFiODNmYzZkMzQ1Yg&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RRFJmYldsdlh6RXgmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT00NSZ0eHQtYWxpZ249cmlnaHQlMkNib3R0b20mcz1mZjBiMjY5MmEzNDIwZmUwMTg1YTdjOWE0OTQyZTA5YQ&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=7ed3f8db62d68b054151da0d1afb9ffb"><meta property="og:description" content="

最初に

どうも、ろっさむです。

引き続きUnity非同期を完全に理解するために今回はコルーチンについて見ていきたいと思います。また本記事は一度昔に個人ブログにあげていたものを修正を加えて再掲したものとなります。

Unity非..."><meta content="https://qiita.com/4_mio_11/items/3030f9a39f59cd68f705" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#,.NET,Unity,非同期処理,unity5" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-07b0e69c-746b-4a06-b363-efc34e8187c1"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2F4_mio_11%2Fitems%2F3030f9a39f59cd68f705">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2F4_mio_11%2Fitems%2F3030f9a39f59cd68f705">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-07b0e69c-746b-4a06-b363-efc34e8187c1">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2018-12-30T17:47:00.000+09:00","dateModified":"2021-06-23T03:47:20.000+09:00","headline":"古来よりUnity非同期を実現していたコルーチンとは何者か？","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND01WS1rNXAybDQ0S0k0NEtLVlc1cGRIbnBuWjdsa0l6bW5KX2pncExscnBfbmo3N2pnWmZqZ2FiamdZVGpnWl9qZ3JQamc2dmpnN3pqZzRIamc3UGpnYWpqZ2Ffa3ZaWG9nSVhqZ1l2dnZKOCZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTU0JnR4dC1jbGlwPWVsbGlwc2lzJnR4dC1hbGlnbj1jZW50ZXIlMkNtaWRkbGUmcz04OGQzOWM5NzVjMTY2OTExNmQzMGFiODNmYzZkMzQ1Yg\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RRFJmYldsdlh6RXgmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT00NSZ0eHQtYWxpZ249cmlnaHQlMkNib3R0b20mcz1mZjBiMjY5MmEzNDIwZmUwMTg1YTdjOWE0OTQyZTA5YQ\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=7ed3f8db62d68b054151da0d1afb9ffb","mainEntityOfPage":"https://qiita.com/4_mio_11/items/3030f9a39f59cd68f705","author":{"@type":"Person","address":"Fuchu, Japan","email":"mio041100505@gmail.com","identifier":"4_mio_11","name":"4_mio_11","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F36899%2Fprofile-images%2F1569238333?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=065e9e19d665c9e712b695578649af76","url":"https://qiita.com/4_mio_11","description":"スローペースで生きてます。","memberOf":[]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://zine.qiita.com/interview/202107-hitachi-3/?utm_source=qiita&amp;utm_medium=header-banner">日立の研究者が、2年間ドイツ人工知能研究センターで学んだこと</a><a target="_blank" id="header_text_message_2" href="https://zine.qiita.com/interview/202107-hitachi-3/?utm_source=qiita&amp;utm_medium=header-banner">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"4_mio_11","type":"items","id":"3030f9a39f59cd68f705"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"日立の研究者が、2年間ドイツ人工知能研究センターで学んだこと","url":"https://zine.qiita.com/interview/202107-hitachi-3/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"4_mio_11","type":"items","id":"3030f9a39f59cd68f705"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":0,"pos_id":"header_text_message_1","message":"日立の研究者が、2年間ドイツ人工知能研究センターで学んだこと","url":"https://zine.qiita.com/interview/202107-hitachi-3/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"4_mio_11","type":"items","id":"3030f9a39f59cd68f705"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":0,"pos_id":"header_text_message_2","message":"日立の研究者が、2年間ドイツ人工知能研究センターで学んだこと","url":"https://zine.qiita.com/interview/202107-hitachi-3/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/4_mio_11/items/3030f9a39f59cd68f705","location":"/4_mio_11/items/3030f9a39f59cd68f705","scheme":"https","host":"qiita.com","port":null,"pathname":"/4_mio_11/items/3030f9a39f59cd68f705","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"DO4Pc4laOMoRLIu9yDDFDKqiz2m9px/IdbsYfpkWn3N0ziZPg98dPHCiB6dDDaGo5HZ95IIPt1awPZysGTZbHw==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-e1c5b69b-c6be-4092-9595-74b96b903b9a"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/4_mio_11/items/3030f9a39f59cd68f705/likers" class="css-1iupg5d">108</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">79</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/3030f9a39f59cd68f705/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/4_mio_11/items/3030f9a39f59cd68f705/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/4_mio_11/items/3030f9a39f59cd68f705/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/4_mio_11/items/3030f9a39f59cd68f705/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/4_mio_11/items/3030f9a39f59cd68f705.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-helsa7"><div class="css-8qb8m4"><div class="it-AdcalRibbon"><span><a href="/advent-calendar/2018/loneliness-c-sharp-unity" class="it-AdcalRibbon_title">一人Unity＆C#<!-- --> Advent Calendar<!-- --> <!-- -->2018</a>Day 17</span></div><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/4_mio_11"><img class="css-100alwu eyfquo10" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/36899/profile-images/1569238333" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/4_mio_11" class="css-10ougpm">@<!-- -->4_mio_11</a><div class="css-1ay9vb9"><span><meta content="2018-12-30T08:47:00Z"/><time dateTime="2021-06-22T18:47:20Z" class="css-m19uds">updated at 2021-06-22</time></span></div></div></div></div></div><h1 class="css-cgzq40">古来よりUnity非同期を実現していたコルーチンとは何者か？</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/.net" class="css-4czcte">.NET</a><a href="/tags/unity" class="css-4czcte">Unity</a><a href="/tags/%e9%9d%9e%e5%90%8c%e6%9c%9f%e5%87%a6%e7%90%86" class="css-4czcte">非同期処理</a><a href="/tags/unity5" class="css-4czcte">unity5</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div>
<h1>
<span id="最初に" class="fragment"></span><a href="#%E6%9C%80%E5%88%9D%E3%81%AB"><i class="fa fa-link"></i></a>最初に</h1>

<p>どうも、<a href="https://twitter.com/4_mio_11" rel="nofollow noopener" target="_blank">ろっさむ</a>です。</p>

<p>引き続きUnity非同期を完全に理解するために今回はコルーチンについて見ていきたいと思います。また本記事は一度昔に個人ブログにあげていたものを修正を加えて再掲したものとなります。</p>

<p>Unity非同期完全に理解するための歩み：<br>
- 【Part0】<a href="https://qiita.com/4_mio_11/items/3b83c11bb0fac4844604" id="reference-806b6f06344f625fb451">タスクとスレッドとプロセスの違いを知って非同期完全理解に近付く</a><br>
- 【Part1】<a href="https://qiita.com/4_mio_11/items/3a0b06819d9591c5d410" id="reference-6346ba15fe7ed8e6eed8">Unity非同期完全に理解するための第一歩～非同期処理とは何か～</a><br>
- 【Part2】古来よりUnity非同期を実現していたコルーチンとは何者か？ ←今ココ！<br>
- 【Part3】<a href="https://qiita.com/4_mio_11/items/f9b19c04509328b1e5c1" id="reference-59e56c7edd73fe24998e">非同期理解のためにasync/awaitとTaskの基礎を学んだ話</a></p>

<h1>
<span id="コルーチンについて" class="fragment"></span><a href="#%E3%82%B3%E3%83%AB%E3%83%BC%E3%83%81%E3%83%B3%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>コルーチンについて</h1>

<p><strong><code>コルーチン</code></strong>とは<strong>処理を途中で中断して、任意のタイミング(次フレーム/一定秒後/完了後etc)で中断部分から処理を再開することができる機能</strong>のことです。</p>

<p>C#2.0以降には<strong>列挙可能なコレクションの列挙子(イテレーター)</strong>を作成するための<strong>イテレーター構文</strong>が用意されています。イテレーター構文は「<strong><code>yield(イェールド)</code></strong>」キーワードによって、関数に<strong>「実行途中で一旦処理を切り上げる機能」と「切り上げた箇所から再開する機能」</strong>を与えることができます。つまり、イテレーター構文が作り上げる機能は、コルーチンの特徴そのものとも言えます。</p>

<p>通常の関数と見た目は似ていますが、コルーチンは処理を途中で中断して、<strong>任意のタイミング(次フレーム/一定秒後/完了後etc)で中断部分から処理を再開</strong>することができます。</p>

<p>コルーチン自体はUnityやC#特有のものではなく、マイクロスレッドやファイバなどといった名前でいろんなところで利用されています。(<a href="http://hiroakiuno.hatenablog.com/entries/2007/03/16" rel="nofollow noopener" target="_blank">厳密な違いを解説しているサイト</a>)</p>

<p>Lua・Python・Moduka-2・Simula・Limboなどにも導入されてます。</p>

<p><strong><code>マルチスレッド</code></strong>でも原理的には同じことができるため現在はマルチスレッドが使われるケースが多いです。<br>
(マルチスレッドのメリットは、1.直接OSの支援を受け入れられる。2.エントリー/リターンの構造を変えずにコードを多重化できるので過去の言語との親和性が良い。)</p>

<p>マルチスレッドの場合はプログラマが同期制御を行わなければならないのでコルーチンのような簡易さはありません。</p>

<h3>
<span id="スレッドとの違い" class="fragment"></span><a href="#%E3%82%B9%E3%83%AC%E3%83%83%E3%83%89%E3%81%A8%E3%81%AE%E9%81%95%E3%81%84"><i class="fa fa-link"></i></a>スレッドとの違い</h3>

<p>コルーチンはシングルスレッドの環境で擬似的にマルチスレッドを実現するための手段ではありません。シングルスレッド環境でマルチスレッドを実現するのは(多くの場合VMで行う)グリーンスレッドとなります。コルーチンはシングルスレッドであり、マルチスレッドとは異なって、<strong>外から切り替えを行うのではなく自身で中断ができる</strong>ことが利点です。また、マルチスレッドと違い<strong>処理を他に明け渡さず、自身が処理を明示的に中断する必要</strong>があります。また、コンテキストも変わりません。そしてネストもできることから、マルチスレッドの代替ではないことがわかります(どちらかというとステートマシンのようなもの)。</p>

<h1>
<span id="cのコルーチン" class="fragment"></span><a href="#c%E3%81%AE%E3%82%B3%E3%83%AB%E3%83%BC%E3%83%81%E3%83%B3"><i class="fa fa-link"></i></a>C#のコルーチン</h1>

<p>進捗情報の保持と、中段場所からの再開を行うのに反復子<code>yield</code>を用います。</p>

<p>反復子は<code>IEnumerator</code>インターフェースで表されます。</p>

<p>メソッドの戻り値を反復子の要素とする<code>yield return</code>があり、これを用いることでメソッドをコルーチン化できます。</p>

<p><code>IEnumerator</code>は<code>Enumerator(数え上げ)</code>というように<code>Iterator</code>のような感じで実装がされていて、<code>MoveNext()</code>と<code>Reset()</code>というメソッドが存在しています。</p>

<p><code>MoveNext()</code>は前回の<strong><code>yield return</code>文の続きから処理を実行する</strong>メソッドです。また、<code>MoveNext()</code>の戻り値は<strong>次の数え上げが可能かどうか</strong>がbool値で返ってきます。</p>

<p>詳しい使い方などの説明は以下サイトがオヌヌメ。<br>
</p><p><a href="http://tyheeeee.hateblo.jp/entry/2013/08/07/C%23%E3%81%AB%E3%81%8A%E3%81%91%E3%82%8Byield_return%E3%81%AE%E6%8C%99%E5%8B%95#fn1" rel="nofollow noopener" target="_blank"></a><a href="http://tyheeeee.hateblo.jp/entry/2013/08/07/C%23%E3%81%AB%E3%81%8A%E3%81%91%E3%82%8Byield_return%E3%81%AE%E6%8C%99%E5%8B%95#fn1" class="autolink" rel="nofollow noopener" target="_blank">http://tyheeeee.hateblo.jp/entry/2013/08/07/C%23%E3%81%AB%E3%81%8A%E3%81%91%E3%82%8Byield_return%E3%81%AE%E6%8C%99%E5%8B%95#fn1</a></p>

<h1>
<span id="unityのコルーチン" class="fragment"></span><a href="#unity%E3%81%AE%E3%82%B3%E3%83%AB%E3%83%BC%E3%83%81%E3%83%B3"><i class="fa fa-link"></i></a>Unityのコルーチン</h1>

<p>非同期処理を実現する手段のうちの一つです。Unityでは高負荷となる処理を実行する場合、複数のフレームに分割するか、<code>C# Job System</code>を用いるような並列処理を行います。この時フレーム単位に処理を分割する方法として、コルーチン機能が使用されていました。言語システムとしてはC#そのままであり、C#での<code>MoveNext()</code>の仕組みを利用してフレームごとに反復子を呼び出す<code>StartCoroutine</code>が用意されています。</p>

<h3>
<span id="非同期処理の必要性" class="fragment"></span><a href="#%E9%9D%9E%E5%90%8C%E6%9C%9F%E5%87%A6%E7%90%86%E3%81%AE%E5%BF%85%E8%A6%81%E6%80%A7"><i class="fa fa-link"></i></a>非同期処理の必要性</h3>

<p>アプリやゲームを作っているとほぼ100%ぶつかる問題として、<strong>ブロッキング処理(重たい同期処理)</strong>があげられます。１フレームにかかる処理が重たいと画面が引きつったように見えたり、入力の反応がなくなったりとデメリットが多いです。軽快なアプリを作成するための方法としては同期処理の非同期化が必要になってきます。Unityで非同期処理を行うためには、<strong>C#の<code>async/await</code>と<code>Task</code>クラスか、コルーチンか、スレッド</strong>を用います。</p>

<h2>
<span id="コルーチンを使用するメリット" class="fragment"></span><a href="#%E3%82%B3%E3%83%AB%E3%83%BC%E3%83%81%E3%83%B3%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B%E3%83%A1%E3%83%AA%E3%83%83%E3%83%88"><i class="fa fa-link"></i></a>コルーチンを使用するメリット</h2>

<p>コルーチンを使用するメリットとしては大きく以下の2点があります。</p>

<h3>
<span id="複数の処理を擬似並列できる" class="fragment"></span><a href="#%E8%A4%87%E6%95%B0%E3%81%AE%E5%87%A6%E7%90%86%E3%82%92%E6%93%AC%E4%BC%BC%E4%B8%A6%E5%88%97%E3%81%A7%E3%81%8D%E3%82%8B"><i class="fa fa-link"></i></a>複数の処理を擬似並列できる。</h3>

<p>本来関数は一つずつしか実行できず、同時に実行するためにはマルチスレッドを利用する必要があります。コルーチンでは完全に並列ではありませんが、関数１の途中まで→関数２の途中まで→関数３の途中まで→関数１の続き、というような流れで<strong>擬似的に並列処理を実現</strong>できます。通信処理やロード処理といった時間がかかるけど画面が止まっては困る場合なんかに便利。</p>

<h3>
<span id="状態を関数内で保持できる" class="fragment"></span><a href="#%E7%8A%B6%E6%85%8B%E3%82%92%E9%96%A2%E6%95%B0%E5%86%85%E3%81%A7%E4%BF%9D%E6%8C%81%E3%81%A7%E3%81%8D%E3%82%8B"><i class="fa fa-link"></i></a>状態を関数内で保持できる。</h3>

<p>ゲームシーン等の遷移をするような処理ではクラスのメンバ変数やグローバル変数などにstate値を保持し、その値をswitch/ifによって処理を分岐させていたが、コルーチンを使うことによってstate値を保持する必要がなくなり、処理の流れも分かりやすくなります。</p>

<p>以下のような様々な場面で活用ができます。</p>

<ul>
<li>敵キャラのAIに使用。</li>
<li>
<strong>アニメーションや演出に使用</strong>。(例えば複数のオブジェクトをアニメーションさせつつ全てのアニメが完了するのを待ってから次の処理に移ったり)</li>
<li>
<strong>ダウンロード終了まで待機</strong>。</li>
<li>重い処理を複数フレームにわたって実行し処理落ちしないようにする。</li>
</ul>

<p>Unityの場合は<code>Update()</code>が使えるので処理の数だけコンポーネントを作ればコルーチンを使わずとも同様のことが実現できるがその場合、処理終了後のコールバックの設計が必要になったりして、結構複雑なロジックになってしまいます。コルーチンを用いれば<strong>処理終了後に自動的に元の位置に処理が戻ってくる</strong>ため、コールバックもいらないし、個々の処理が終わったかどうかを判定する特別な処理なども不要になります(コンポーネントに対するUpdate()の呼び出しよりもコルーチンの方がオーバーヘッドが少ないかもしれない)。</p>

<p>今回はUnityで使用するコルーチンに着目した記事としています。</p>

<h2>
<span id="コルーチンの仕組み" class="fragment"></span><a href="#%E3%82%B3%E3%83%AB%E3%83%BC%E3%83%81%E3%83%B3%E3%81%AE%E4%BB%95%E7%B5%84%E3%81%BF"><i class="fa fa-link"></i></a>コルーチンの仕組み</h2>

<p>コルーチンは戻り値がIEnumeratorのメソッドとして記述します。</p>

<p>IEnumeratorは「列挙子」というもので、コルーチンは「列挙された処理を順に実行」していくイメージ。</p>

<p>コルーチンの中では必ず<code>yield</code>演算子が登場します。</p>

<p>一般的にコルーチンのアップデートはUpdate関数の後に実行されます。</p>

<p>処理としては以下の通り。　※太字は代表的なもの。</p>

<table>
<tbody>
<tr>
<th>記述</th>
<th>処理内容</th>
</tr>
<tr>
<td>yield return xx;</td>
<td>処理(xx)の
終了を
待機する</td>
</tr>
<tr>
<td><strong>yield return null;
か yield;</strong></td>
<td>1frame後に
処理を
再開する</td>
</tr>
<tr>
<td><strong>yield return new WaitForSeconds(1f);</strong></td>
<td>自分自身が
Updateの
タイミングで
実行されるのを
1秒止める</td>
</tr>
<tr>
<td><strong>yield break;</strong></td>
<td>処理を途中で
強制終了する</td>
</tr>
<tr>
<td colspan="1">yield return new WaitForEndOfFrame();</td>
<td colspan="1">次のframeに
再開する</td>
</tr>
<tr>
<td colspan="1">yield return new
WaitUntil(再開条件)</td>
<td colspan="1">再開条件に
指定した
関数が
trueを返すと
再開する</td>
</tr>
<tr>
<td colspan="1">yield return new
WaitWhile(待機条件)</td>
<td colspan="1">待機条件に
指定した
関数が
falseを返すと
再開する</td>
</tr>
<tr>
<td colspan="1">yield WaitForFixedUpdate()</td>
<td colspan="1">全てのスクリプトで
FixedUpdate
呼び出し後に続行する</td>
</tr>
<tr>
<td colspan="1"><strong>yield return
StartCoroutine();</strong></td>
<td colspan="1">別のコルーチンを
新たに実行し
終わるまで
中断する</td>
</tr>
<tr>
<td colspan="1">yield return
一部非同期オブジェクト;</td>
<td colspan="1">その処理が
終わるまで
コルーチンを
中断することができる</td>
</tr>
</tbody>
</table>

<p>(一部非同期オブジェクト :WWWやAssetBundleのLoadAssetAsyncの返り値であるAssetBundleRequestが一部非同期オブジェクトとしてあげられる。)</p>

<p>(WaitForSeconds()もコルーチンの一つである。)</p>

<h1>
<span id="コルーチンの目的" class="fragment"></span><a href="#%E3%82%B3%E3%83%AB%E3%83%BC%E3%83%81%E3%83%B3%E3%81%AE%E7%9B%AE%E7%9A%84"><i class="fa fa-link"></i></a>コルーチンの目的</h1>

<h3>
<span id="ロジックの整理" class="fragment"></span><a href="#%E3%83%AD%E3%82%B8%E3%83%83%E3%82%AF%E3%81%AE%E6%95%B4%E7%90%86"><i class="fa fa-link"></i></a>ロジックの整理</h3>

<p>主要な処理から分岐した１セットの「ここからここまで」の処理を、<strong>主要な処理の記述や定常的に行われる処理の記述を侵食しないで</strong>別の箇所に書くことができる。</p>

<h3>
<span id="処理の分割" class="fragment"></span><a href="#%E5%87%A6%E7%90%86%E3%81%AE%E5%88%86%E5%89%B2"><i class="fa fa-link"></i></a>処理の分割</h3>

<p><code>coroutine</code>処理内での<code>yield return</code>までの１ブロックは主要な<code>Update</code>１回と同期して行われるので<code>coroutine</code>内での１回の処理量を<code>yield return</code>のブロックで適切に分解することで、<strong>主要な処理を止めることなく</strong>実行することができます。</p>

<h3>
<span id="処理の待機" class="fragment"></span><a href="#%E5%87%A6%E7%90%86%E3%81%AE%E5%BE%85%E6%A9%9F"><i class="fa fa-link"></i></a>処理の待機</h3>

<p>coroutine処理は、他に影響なく単独で処理を止めることができます。<code>yield return WaitForSeconds(1f)</code>;</p>

<h1>
<span id="コルーチンの書き方" class="fragment"></span><a href="#%E3%82%B3%E3%83%AB%E3%83%BC%E3%83%81%E3%83%B3%E3%81%AE%E6%9B%B8%E3%81%8D%E6%96%B9"><i class="fa fa-link"></i></a>コルーチンの書き方</h1>

<h2>
<span id="コルーチンの実行停止方法と引数" class="fragment"></span><a href="#%E3%82%B3%E3%83%AB%E3%83%BC%E3%83%81%E3%83%B3%E3%81%AE%E5%AE%9F%E8%A1%8C%E5%81%9C%E6%AD%A2%E6%96%B9%E6%B3%95%E3%81%A8%E5%BC%95%E6%95%B0"><i class="fa fa-link"></i></a>コルーチンの実行・停止方法と引数</h2>

<p><code>StartCoroutine(...) / StopCoroutine(...)</code>でコルーチンを操作する際に、三種類の引数を取ることができる。</p>

<h3>
<span id="ienumerator型" class="fragment"></span><a href="#ienumerator%E5%9E%8B"><i class="fa fa-link"></i></a>IEnumerator型</h3>

<p>Unity4.5から<code>IEnumerator</code>型の引数を取るStopCoroutineのオーバーロードが追加され、<code>StartCoroutine / StopCoroutine</code>を行うにあたって<code>IEnumerator</code>型を引数に取る方が主流になった。</p>

<p>ただしIEnumerator型のインスタンスを、クラス内のフィールドなどに保持しておく必要ができた。</p>

<p>StopCoroutineを使用して、停止したコルーチンを同じIEnumratorを指定して再スタートさせた場合はコルーチンの途中から再開してしまうので、初めから再スタートさせたい場合は再取得が必要。</p>

<div class="code-frame" data-lang="C#"><div class="highlight"><pre><code><span class="k">private</span> <span class="n">IEnumerator</span> <span class="n">HogeCoroutine</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
<span class="k">private</span> <span class="k">void</span> <span class="nf">Set</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">HogeCoroutine</span> <span class="p">=</span> <span class="nf">Cour</span> <span class="p">()</span> <span class="p">;</span>
<span class="p">}</span>

<span class="n">IEnumerator</span> <span class="nf">Cour</span> <span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// 何か処理</span>
<span class="p">}</span>

<span class="k">void</span> <span class="nf">Start</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nf">Set</span><span class="p">();</span>
    <span class="nf">StartCoroutine</span> <span class="p">(</span> <span class="n">HogeCoroutine</span> <span class="p">);</span>
    <span class="nf">StopCoroutine</span> <span class="p">(</span> <span class="n">HogeCoroutine</span> <span class="p">);</span>
    <span class="c1">//以下、再スタートさせるための再取得</span>
    <span class="nf">Set</span><span class="p">();</span>
    <span class="nf">StartCoroutine</span> <span class="p">(</span> <span class="n">HogeCoroutine</span> <span class="p">);</span>
    <span class="n">HogeCoroutine</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h3>
<span id="string型" class="fragment"></span><a href="#string%E5%9E%8B"><i class="fa fa-link"></i></a>String型</h3>

<p>Unity4.5以降はあまり使われてません。</p>

<p>StopCoroutineするに当たって設計上どうしてもIEnumerator型のインスタンスをクラス内のフィールドなどに保持しておきたくないような場合に使用します。</p>

<h3>
<span id="coroutine型" class="fragment"></span><a href="#coroutine%E5%9E%8B"><i class="fa fa-link"></i></a>Coroutine型</h3>

<p>基本的な使用方法は<code>IEnumerator</code>と似ています。<br>
<code>StartCoroutine</code>の戻り値が<code>Coroutine</code>型なので、それを活用すれば直感的な書き方ができるかも?</p>

<p>終了を待ちたいコルーチンを呼び出す際、上記のようにCoroutine型の変数に<code>StartCoroutine()</code>の戻り値を代入する必要があります。これをしないとUnityにおいてのコルーチンの終了を正しくキャッチできません。</p>

<div class="code-frame" data-lang="C#"><div class="highlight"><pre><code><span class="n">IEnumerator</span> <span class="nf">Cour</span> <span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// 何か処理</span>
<span class="p">}</span>

<span class="k">void</span> <span class="nf">Start</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">Coroutine</span> <span class="n">cour</span> <span class="p">=</span> <span class="nf">StartCoroutine</span> <span class="p">(</span> <span class="n">HogeCoroutine</span> <span class="p">);</span>
    <span class="nf">StopCoroutine</span> <span class="p">(</span> <span class="n">cour</span> <span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>IEnumeratorの代わりにコルーチンのメソッド名を文字列で渡すことでコルーチンを実行・停止することができます。<br>
<br></p>

<p>(何故使用されないか :メソッド名の変更を行い、置き換えた場合に、Stringなので一緒には置き換わらない。つまり、コンパイルチェック上から外れてしまい、メソッド名が間違っていても実行されるまでエラーが発生しない。また、Stringで渡した場合は２つ以上の引数を持つコルーチンに値を渡すことができない。以上の理由で特別な理由がない限りはIEnumeratorを使用する方が良い。)</p>

<p>(Unity4.5以前のコルーチン実行・停止 :Unity4.5以前、StopCoroutineメソッドはstring型を引数に取るオーバーロードしかなかった。また、StopCoroutineで止めることができるコルーチンはstring型の引数のオーバーロードのStartCoroutineで始めたコルーチンのみだった。そのため、StopCoroutineでコルーチンを止めたい場合、Unity4.5以前はstring型を引数に取るStartCoroutineメソッドのオーバーロードを使う必要があった。)</p>

<div class="code-frame" data-lang="C#"><div class="highlight"><pre><code><span class="k">void</span> <span class="nf">Start</span> <span class="p">()</span>
<span class="p">{</span>
    <span class="nf">StartCoroutine</span> <span class="p">(</span> <span class="s">"Hoge"</span> <span class="p">,</span> <span class="m">10</span> <span class="p">);</span>
<span class="p">}</span>

<span class="k">private</span> <span class="n">IEnumerator</span> <span class="nf">Hoge</span><span class="p">(</span> <span class="kt">int</span> <span class="n">num</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span> <span class="p">;</span> <span class="n">i</span> <span class="p">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">lt</span><span class="p">;</span> <span class="n">num</span> <span class="p">;</span> <span class="n">i</span><span class="p">++</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span> <span class="n">i</span> <span class="p">);</span>
        <span class="k">yield</span> <span class="k">return</span> <span class="k">new</span> <span class="nf">WaitForSeconds</span> <span class="p">(</span> <span class="m">1f</span> <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>(<code>StartCoroutine_Auto</code> : <code>StartCoroutine_Auto</code>というメソッドがあるが、これは<code>StartCoroutine</code>の実装部分。<code>StartCoroutine()</code>は引数として取ったコルーチン<code>StartCoroutine_Auto</code>メソッドに渡し、例えばコルーチン内で<code>WaitForSeconds</code>をしていた場合、コルーチンを遅延対象として登録する。要するに<strong><code>StartCoroutine</code>は<code>StartCoroutine_Auto</code>を呼んでるだけ</strong>。)</p>

<h2>
<span id="コルーチンの停止" class="fragment"></span><a href="#%E3%82%B3%E3%83%AB%E3%83%BC%E3%83%81%E3%83%B3%E3%81%AE%E5%81%9C%E6%AD%A2"><i class="fa fa-link"></i></a>コルーチンの停止</h2>

<h3>
<span id="stopallcoroutines" class="fragment"></span><a href="#stopallcoroutines"><i class="fa fa-link"></i></a>StopAllCoroutines</h3>

<p><code>StopAllCoroutines</code>を使用するとstring引数の<code>StartCoroutine</code>で始めたコルーチンも、<code>IEnumerator</code>引数の<code>StartCoroutine</code>で始めたコルーチンも全て止まります。しかし、止めたいコルーチン以外も止めてしまうので注意が必要となります。</p>

<h3>
<span id="注意点" class="fragment"></span><a href="#%E6%B3%A8%E6%84%8F%E7%82%B9"><i class="fa fa-link"></i></a>注意点</h3>

<ul>
<li>
<code>StopCoroutine</code>()は、もし指定したコルーチンが動いていない場合、何も処理をせず進行する(エラーも出ない)。</li>
<li>
<code>StopCoroutine()</code>で止めると、<code>dispose</code>や<code>finally</code>が呼ばれない。</li>
<li>親のGameObjectが非アクティブに成ると動作を停止する。(この場合、再開することはできない)→対策として絶対に破棄されないゲームオブジェクトにコルーチンを実行させる方法とか)</li>
<li>コンポーネントが<code>enable/disable</code>担っても動作を継続する。</li>
<li>コルーチンはメインスレッド上で動作している。つまり、<code>yield</code>で分けて処理を分散しても、<strong>その１つ１つの処理自体が重いと全体に影響する</strong>。例えば<code>StartCoroutine</code>が100回呼ばれて1フレームに100個<code>Instantiate</code>される処理とか)</li>
</ul>

<h3>
<span id="並列処理を走らせたい時" class="fragment"></span><a href="#%E4%B8%A6%E5%88%97%E5%87%A6%E7%90%86%E3%82%92%E8%B5%B0%E3%82%89%E3%81%9B%E3%81%9F%E3%81%84%E6%99%82"><i class="fa fa-link"></i></a>並列処理を走らせたい時</h3>

<div class="code-frame" data-lang="C#"><div class="highlight"><pre><code><span class="k">void</span> <span class="nf">Start</span> <span class="p">()</span>
<span class="p">{</span>
    <span class="nf">StartCoroutine</span> <span class="p">(</span> <span class="nf">Hoge</span><span class="p">()</span> <span class="p">);</span>
    <span class="nf">StartCoroutine</span> <span class="p">(</span> <span class="nf">Piyo</span><span class="p">()</span> <span class="p">);</span>
<span class="p">}</span>

<span class="k">private</span> <span class="n">IEnumerator</span> <span class="nf">Hoge</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span> <span class="p">(</span> <span class="s">"hoge"</span> <span class="p">);</span>
    <span class="k">yield</span> <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
    <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span> <span class="p">(</span> <span class="s">"hogehoge"</span> <span class="p">);</span>
    <span class="k">yield</span> <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
    <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span> <span class="p">(</span> <span class="s">"hogehogehoge"</span> <span class="p">);</span>
<span class="p">}</span>

<span class="k">private</span> <span class="n">IEnumerator</span> <span class="nf">Piyo</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span> <span class="p">(</span> <span class="s">"piyo"</span> <span class="p">);</span>
    <span class="k">yield</span> <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
    <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span> <span class="p">(</span> <span class="s">"piyopiyo"</span> <span class="p">);</span>
    <span class="k">yield</span> <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
    <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span> <span class="p">(</span> <span class="s">"piyopiyopiyo"</span> <span class="p">);</span>
<span class="p">}</span>

<span class="c1">//////result//////</span>
<span class="n">hoge</span>
<span class="n">piyo</span>
<span class="n">hogehoge</span>
<span class="n">piyopiyo</span>
<span class="n">hogehogehoge</span>
<span class="n">piyopiyopiyo</span>
<span class="c1">/////////////////</span>
</code></pre></div></div>

<h3>
<span id="コルーチンの途中で一定時間中断" class="fragment"></span><a href="#%E3%82%B3%E3%83%AB%E3%83%BC%E3%83%81%E3%83%B3%E3%81%AE%E9%80%94%E4%B8%AD%E3%81%A7%E4%B8%80%E5%AE%9A%E6%99%82%E9%96%93%E4%B8%AD%E6%96%AD"><i class="fa fa-link"></i></a>コルーチンの途中で一定時間中断</h3>

<div class="code-frame" data-lang="C#"><div class="highlight"><pre><code><span class="k">private</span> <span class="n">IEnumerator</span> <span class="nf">Hoge</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">//処理記述(1)</span>
    <span class="k">yield</span> <span class="k">return</span> <span class="k">new</span> <span class="nf">WaitForSeconds</span> <span class="p">(</span> <span class="m">1f</span> <span class="p">);</span>
    <span class="c1">//処理記述(2)</span>
    <span class="k">yield</span> <span class="k">return</span> <span class="k">new</span> <span class="nf">WaitForSeconds</span> <span class="p">(</span> <span class="m">1f</span> <span class="p">);</span>
    <span class="c1">//処理記述(3)</span>
    <span class="k">yield</span> <span class="k">return</span> <span class="k">new</span> <span class="nf">WaitForSeconds</span> <span class="p">(</span> <span class="m">1f</span> <span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<h3>
<span id="コルーチン単体の完了を待つ時" class="fragment"></span><a href="#%E3%82%B3%E3%83%AB%E3%83%BC%E3%83%81%E3%83%B3%E5%8D%98%E4%BD%93%E3%81%AE%E5%AE%8C%E4%BA%86%E3%82%92%E5%BE%85%E3%81%A4%E6%99%82"><i class="fa fa-link"></i></a>コルーチン(単体)の完了を待つ時</h3>

<p>例えばHogeの処理を先に終えてからPiyoしたい場合。</p>

<div class="code-frame" data-lang="C#"><div class="highlight"><pre><code><span class="n">IEnumerator</span> <span class="nf">Start</span> <span class="p">()</span>
<span class="p">{</span>
    <span class="k">yield</span> <span class="k">return</span> <span class="nf">StartCoroutine</span> <span class="p">(</span> <span class="nf">Hoge</span><span class="p">()</span> <span class="p">);</span>
    <span class="nf">StartCoroutine</span> <span class="p">(</span> <span class="nf">Piyo</span><span class="p">()</span> <span class="p">);</span>
<span class="p">}</span>

<span class="k">private</span> <span class="n">IEnumerator</span> <span class="nf">Hoge</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span> <span class="p">(</span> <span class="s">"hoge"</span> <span class="p">);</span>
    <span class="k">yield</span> <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
    <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span> <span class="p">(</span> <span class="s">"hogehoge"</span> <span class="p">);</span>
    <span class="k">yield</span> <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
    <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span> <span class="p">(</span> <span class="s">"hogehogehoge"</span> <span class="p">);</span>
<span class="p">}</span>

<span class="k">private</span> <span class="n">IEnumerator</span> <span class="nf">Piyo</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span> <span class="p">(</span> <span class="s">"piyo"</span> <span class="p">);</span>
    <span class="k">yield</span> <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
    <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span> <span class="p">(</span> <span class="s">"piyopiyo"</span> <span class="p">);</span>
    <span class="k">yield</span> <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
    <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span> <span class="p">(</span> <span class="s">"piyopiyopiyo"</span> <span class="p">);</span>
<span class="p">}</span>

<span class="c1">//////result//////</span>
<span class="n">hoge</span>
<span class="n">hogehoge</span>
<span class="n">hogehogehoge</span>
<span class="n">piyo</span>
<span class="n">piyopiyo</span>
<span class="n">piyopiyopiyo</span>
<span class="c1">/////////////////</span>
</code></pre></div></div>

<h3>
<span id="コルーチン複数の完了を待つ時" class="fragment"></span><a href="#%E3%82%B3%E3%83%AB%E3%83%BC%E3%83%81%E3%83%B3%E8%A4%87%E6%95%B0%E3%81%AE%E5%AE%8C%E4%BA%86%E3%82%92%E5%BE%85%E3%81%A4%E6%99%82"><i class="fa fa-link"></i></a>コルーチン(複数)の完了を待つ時</h3>

<p>例えばHogeとPiyoは同時に処理したいけど、Hugaは２つの処理が完全に終わってから処理を開始したい場合。</p>

<div class="code-frame" data-lang="C#"><div class="highlight"><pre><code><span class="n">IEnumerator</span> <span class="nf">Start</span> <span class="p">()</span>
<span class="p">{</span>
    <span class="n">Coroutine</span> <span class="n">coroutineHoge</span> <span class="p">=</span> <span class="nf">StartCoroutine</span> <span class="p">(</span> <span class="nf">Hoge</span><span class="p">()</span> <span class="p">);</span>
    <span class="n">Coroutine</span> <span class="n">coroutinePiyo</span> <span class="p">=</span> <span class="nf">StartCoroutine</span> <span class="p">(</span> <span class="nf">Piyo</span><span class="p">()</span> <span class="p">);</span>
    <span class="k">yield</span> <span class="k">return</span> <span class="n">coroutineHoge</span><span class="p">;</span>
    <span class="k">yield</span> <span class="k">return</span> <span class="n">coroutinePiyo</span><span class="p">;</span>
    <span class="nf">StartCoroutine</span> <span class="p">(</span> <span class="nf">Huga</span><span class="p">()</span> <span class="p">);</span>
<span class="p">}</span>

<span class="k">private</span> <span class="n">IEnumerator</span> <span class="nf">Hoge</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span> <span class="p">(</span> <span class="s">"hoge"</span> <span class="p">);</span>
    <span class="k">yield</span> <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
    <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span> <span class="p">(</span> <span class="s">"hogehoge"</span> <span class="p">);</span>
    <span class="k">yield</span> <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
    <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span> <span class="p">(</span> <span class="s">"hogehogehoge"</span> <span class="p">);</span>
<span class="p">}</span>

<span class="k">private</span> <span class="n">IEnumerator</span> <span class="nf">Piyo</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span> <span class="p">(</span> <span class="s">"piyo"</span> <span class="p">);</span>
    <span class="k">yield</span> <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
    <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span> <span class="p">(</span> <span class="s">"piyopiyo"</span> <span class="p">);</span>
    <span class="k">yield</span> <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
    <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span> <span class="p">(</span> <span class="s">"piyopiyopiyo"</span> <span class="p">);</span>
<span class="p">}</span>

<span class="k">private</span> <span class="n">IEnumerator</span> <span class="nf">Huga</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span> <span class="p">(</span> <span class="s">"huga"</span> <span class="p">);</span>
    <span class="k">yield</span> <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
    <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span> <span class="p">(</span> <span class="s">"hugahuga"</span> <span class="p">);</span>
    <span class="k">yield</span> <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
    <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span> <span class="p">(</span> <span class="s">"hugahuga"</span> <span class="p">);</span>
<span class="p">}</span>

<span class="c1">//////result//////</span>
<span class="n">hoge</span>
<span class="n">piyo</span>
<span class="n">hogehoge</span>
<span class="n">piyopiyo</span>
<span class="n">hogehogehoge</span>
<span class="n">piyopiyopiyo</span>
<span class="n">huga</span>
<span class="n">hugahuga</span>
<span class="n">hugahugahuga</span>
<span class="c1">/////////////////</span>
</code></pre></div></div>

<h3>
<span id="コルーチンを使って別のオブジェクトの状態を監視する" class="fragment"></span><a href="#%E3%82%B3%E3%83%AB%E3%83%BC%E3%83%81%E3%83%B3%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E5%88%A5%E3%81%AE%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E7%8A%B6%E6%85%8B%E3%82%92%E7%9B%A3%E8%A6%96%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>コルーチンを使って別のオブジェクトの状態を監視する</h3>

<p>UnityでAというオブジェクトが、別のBというオブジェクトのアニメーションや処理が終わったことを知りたい場合は、</p>

<ul>
<li>C#のDelegateを使う</li>
<li>AとBが相互に参照しあうようにして、BがAに完了を伝える</li>
</ul>

<p>という感じにコールバックという方法があります。</p>

<p>この方法を用いたくない(delegateを書きたくない、循環参照は避けたい)場合、コルーチンを使って別のオブジェクトの状態を監視することができます。</p>

<p>ただしDelegateなどに比べると、完了しだいすぐに通知できるわけではないので要注意。(スクリプトの実行順序によっては１フレーム待つケースがある)</p>

<div class="code-frame" data-lang="C#"><div class="highlight"><pre><code><span class="k">public</span> <span class="n">Hoge</span> <span class="n">piyo</span><span class="p">;</span>
<span class="k">private</span> <span class="n">IEnumerator</span> <span class="nf">StartPlay</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">piyo</span><span class="p">.</span><span class="nf">Play</span><span class="p">();</span>
    <span class="k">while</span> <span class="p">(</span> <span class="p">!</span><span class="n">piyo</span><span class="p">.</span><span class="n">isComplete</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// piyoのisComplete変数がtrueになるまで待機</span>
        <span class="k">yield</span> <span class="k">return</span> <span class="k">new</span> <span class="nf">WaitForEndOfFrame</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="c1">// childのアニメーションが終了したとき</span>
    <span class="c1">// (child.isCompleteがtrueになったとき)</span>
    <span class="c1">// ここより下にかかれた処理が実行される&amp;lt;/code&amp;gt;&amp;lt;/p&amp;gt;</span>
    <span class="c1">//シンプルに実装できるので、アニメーションを組み合わせた演出などを作る時に便利。</span>
<span class="p">}</span>
</code></pre></div></div>

<h3>
<span id="引数があるコルーチンを実行" class="fragment"></span><a href="#%E5%BC%95%E6%95%B0%E3%81%8C%E3%81%82%E3%82%8B%E3%82%B3%E3%83%AB%E3%83%BC%E3%83%81%E3%83%B3%E3%82%92%E5%AE%9F%E8%A1%8C"><i class="fa fa-link"></i></a>引数があるコルーチンを実行</h3>

<p>引数があるコルーチンに値を渡すには、<code>StartCoroutine</code>の引数内でコルーチン関数を呼び出します。</p>

<div class="code-frame" data-lang="C#"><div class="highlight"><pre><code><span class="k">void</span> <span class="nf">Start</span> <span class="p">()</span>
<span class="p">{</span>
    <span class="nf">StartCoroutine</span> <span class="p">(</span> <span class="nf">Hoge</span><span class="p">(</span><span class="m">10</span><span class="p">)</span> <span class="p">);</span>
<span class="p">}</span>

<span class="k">private</span> <span class="n">IEnumerator</span> <span class="nf">Hoge</span><span class="p">(</span> <span class="kt">int</span> <span class="n">num</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// 処理</span>
<span class="p">}</span>
</code></pre></div></div>

<h1>
<span id="コルーチンの実行タイミングと時間感覚" class="fragment"></span><a href="#%E3%82%B3%E3%83%AB%E3%83%BC%E3%83%81%E3%83%B3%E3%81%AE%E5%AE%9F%E8%A1%8C%E3%82%BF%E3%82%A4%E3%83%9F%E3%83%B3%E3%82%B0%E3%81%A8%E6%99%82%E9%96%93%E6%84%9F%E8%A6%9A"><i class="fa fa-link"></i></a>コルーチンの実行タイミングと時間感覚</h1>

<h3>
<span id="実行タイミング" class="fragment"></span><a href="#%E5%AE%9F%E8%A1%8C%E3%82%BF%E3%82%A4%E3%83%9F%E3%83%B3%E3%82%B0"><i class="fa fa-link"></i></a>実行タイミング</h3>

<p>これは描写間隔と同期されます。</p>

<p>つまり、WaitTimeを極小にした場合、Update()と同じタイミングで実行されます。</p>

<p><code>yield return new WaitForSeconds ( 0.00001f );</code>としても、１フレームに１回実行となります。</p>

<h3>
<span id="時間間隔の計測タイミング" class="fragment"></span><a href="#%E6%99%82%E9%96%93%E9%96%93%E9%9A%94%E3%81%AE%E8%A8%88%E6%B8%AC%E3%82%BF%E3%82%A4%E3%83%9F%E3%83%B3%E3%82%B0"><i class="fa fa-link"></i></a>時間間隔の計測タイミング</h3>

<p>上記のような極小タイミングだった場合、１フレームに何度も実行されないことからわかるように<strong>「フレーム毎に、規定時間を過ぎていた場合に実行する」という処理である</strong>と言えます。</p>

<p><code>Time.timescale</code>を少し小さくしてみると、その処理誤差が段々顕著になります。</p>

<p><code>WaitForSeconds</code>は<code>Time.timescale</code>の影響を受けますが、毎フレームのタイミングを送らせるものではないため、規定時間を経過したと判定され、毎フレーム実行されます。</p>

<p>→つまり、極小の待機時間にした場合、ほとんどUpdate()と同じ動きになり余す。</p>

<p>(<code>yield return null</code> の場合は時間関数を通らないので <code>Time.timescale = 0</code> とした場合でも影響は受けない。)</p>

<p>また、<code>yield return</code>で返す値が具体的にUnityのゲームループにおいてどこに差し込まれるかはUnityのマニュアルのScript Lifecycle Flowchartの図がわかりやすくなっています。<a href="https://camo.qiitausercontent.com/aa84aecb84c6e4c8b3a90c169c3e4a0446be92c8/687474703a2f2f6e6575652e63632f77702d636f6e74656e742f75706c6f6164732f323031342f31322f756e6974796c6966656379636c652e6a7067" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/http%3A%2F%2Fneue.cc%2Fwp-content%2Fuploads%2F2014%2F12%2Funitylifecycle.jpg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=8eba9726be77f7487389b21ab45e9afd" alt="" width="607" height="848" data-canonical-src="http://neue.cc/wp-content/uploads/2014/12/unitylifecycle.jpg" srcset="https://qiita-user-contents.imgix.net/http%3A%2F%2Fneue.cc%2Fwp-content%2Fuploads%2F2014%2F12%2Funitylifecycle.jpg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=7dd65fb99dba71352b59b963054981c0 1x" loading="lazy"></a></p>

<p>また、<a href="http://docs.unity3d.com/ja/current/Manual/ExecutionOrder.html" rel="nofollow noopener" target="_blank">「Unityスクリプトリファレンス イベント関数の実行順」</a>も参考になります。</p>

<h2>
<span id="カスタムコルーチンについて" class="fragment"></span><a href="#%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%A0%E3%82%B3%E3%83%AB%E3%83%BC%E3%83%81%E3%83%B3%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>カスタムコルーチンについて</h2>

<p>Unity5.3から実装された新機能です。</p>

<p><code>WaitForSeconds</code>のようなnewするとコルーチンとして使えるクラスを自作できるようになっています。<br>
(<code>CustomYieldInstruction</code>を継承したりラムダ式で評価してコルーチンの条件設定を行ったりが可能)</p>

<div class="code-frame" data-lang="C#"><div class="highlight"><pre><code><span class="n">IEnumerator</span> <span class="nf">Start</span> <span class="p">()</span>
<span class="p">{</span>
    <span class="k">yield</span> <span class="k">return</span> <span class="nf">WaitWhile</span><span class="p">(</span> <span class="p">()</span> <span class="p">-&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">Input</span><span class="p">.</span><span class="n">anykeyDown</span> <span class="p">--</span> <span class="k">false</span> <span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<ul>
<li><p>条件が満たされるまで待機する、WaitUntilが追加</p></li>
<li><p>条件が満たされている間は待機する、WaitWhileが追加</p></li>
<li><p>ファイルロードとかの非同期処理を管理するクラスが作りやすくなった。</p></li>
</ul>

<h1>
<span id="unity5x系以降の小ネタを知るのにオススメのスライド" class="fragment"></span><a href="#unity5x%E7%B3%BB%E4%BB%A5%E9%99%8D%E3%81%AE%E5%B0%8F%E3%83%8D%E3%82%BF%E3%82%92%E7%9F%A5%E3%82%8B%E3%81%AE%E3%81%AB%E3%82%AA%E3%82%B9%E3%82%B9%E3%83%A1%E3%81%AE%E3%82%B9%E3%83%A9%E3%82%A4%E3%83%89"><i class="fa fa-link"></i></a>Unity5.x系以降の小ネタを知るのにオススメのスライド</h1>

<p>9月に行われた<a href="https://connpass.com/event/95696/" rel="nofollow noopener" target="_blank">「Unity 非同期完全に理解した勉強会」</a>で登壇していたむろほしさんの資料がとても参考になります。是非コルーチンを使用する前にご一読ください。</p>

<p>いまさらだけど Coroutine：<a href="https://speakerdeck.com/ryotamurohoshi/imasaradakedoque-ren-siteokou-coroutine" class="autolink" rel="nofollow noopener" target="_blank">https://speakerdeck.com/ryotamurohoshi/imasaradakedoque-ren-siteokou-coroutine</a></p>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2F4_mio_11%2Fitems%2F3030f9a39f59cd68f705&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2F4_mio_11%2Fitems%2F3030f9a39f59cd68f705&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/4_mio_11/items/3030f9a39f59cd68f705/likers" class="css-1iupg5d">108</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">79</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/3030f9a39f59cd68f705/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/4_mio_11/items/3030f9a39f59cd68f705/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/4_mio_11/items/3030f9a39f59cd68f705/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/4_mio_11/items/3030f9a39f59cd68f705/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/4_mio_11/items/3030f9a39f59cd68f705.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-e1c5b69b-c6be-4092-9595-74b96b903b9a">{"authorAnalyticsTrackingId":null,"organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-846195fa-e1a4-4c39-bce3-844c66d44d82"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-846195fa-e1a4-4c39-bce3-844c66d44d82">{}</script>
      
<div id="LoginModal-react-component-cb4b30f7-a2cd-46f9-8df2-5d0faf836a1d"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-cb4b30f7-a2cd-46f9-8df2-5d0faf836a1d">{}</script>
      
<div id="StockModal-react-component-fd2eb23a-d9cc-45c3-b411-a7816929ab9a"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-fd2eb23a-d9cc-45c3-b411-a7816929ab9a">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;EDbC6ZxolGxa8Ivgg7wPZcJ+sfHWelf3ykwrmAkY4zJoFuvVlu2xmjt+B/oIgWvBjKoDfOnS/2kPyq9KiTgnXg==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\n\u003ch1\u003e\n\u003cspan id=\"最初に\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%9C%80%E5%88%9D%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e最初に\u003c/h1\u003e\n\n\u003cp\u003eどうも、\u003ca href=\"https://twitter.com/4_mio_11\" rel=\"nofollow noopener\" target=\"_blank\"\u003eろっさむ\u003c/a\u003eです。\u003c/p\u003e\n\n\u003cp\u003e引き続きUnity非同期を完全に理解するために今回はコルーチンについて見ていきたいと思います。また本記事は一度昔に個人ブログにあげていたものを修正を加えて再掲したものとなります。\u003c/p\u003e\n\n\u003cp\u003eUnity非同期完全に理解するための歩み：\u003cbr\u003e\n- 【Part0】\u003ca href=\"https://qiita.com/4_mio_11/items/3b83c11bb0fac4844604\" id=\"reference-806b6f06344f625fb451\"\u003eタスクとスレッドとプロセスの違いを知って非同期完全理解に近付く\u003c/a\u003e\u003cbr\u003e\n- 【Part1】\u003ca href=\"https://qiita.com/4_mio_11/items/3a0b06819d9591c5d410\" id=\"reference-6346ba15fe7ed8e6eed8\"\u003eUnity非同期完全に理解するための第一歩～非同期処理とは何か～\u003c/a\u003e\u003cbr\u003e\n- 【Part2】古来よりUnity非同期を実現していたコルーチンとは何者か？ ←今ココ！\u003cbr\u003e\n- 【Part3】\u003ca href=\"https://qiita.com/4_mio_11/items/f9b19c04509328b1e5c1\" id=\"reference-59e56c7edd73fe24998e\"\u003e非同期理解のためにasync/awaitとTaskの基礎を学んだ話\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"コルーチンについて\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B3%E3%83%AB%E3%83%BC%E3%83%81%E3%83%B3%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eコルーチンについて\u003c/h1\u003e\n\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eコルーチン\u003c/code\u003e\u003c/strong\u003eとは\u003cstrong\u003e処理を途中で中断して、任意のタイミング(次フレーム/一定秒後/完了後etc)で中断部分から処理を再開することができる機能\u003c/strong\u003eのことです。\u003c/p\u003e\n\n\u003cp\u003eC#2.0以降には\u003cstrong\u003e列挙可能なコレクションの列挙子(イテレーター)\u003c/strong\u003eを作成するための\u003cstrong\u003eイテレーター構文\u003c/strong\u003eが用意されています。イテレーター構文は「\u003cstrong\u003e\u003ccode\u003eyield(イェールド)\u003c/code\u003e\u003c/strong\u003e」キーワードによって、関数に\u003cstrong\u003e「実行途中で一旦処理を切り上げる機能」と「切り上げた箇所から再開する機能」\u003c/strong\u003eを与えることができます。つまり、イテレーター構文が作り上げる機能は、コルーチンの特徴そのものとも言えます。\u003c/p\u003e\n\n\u003cp\u003e通常の関数と見た目は似ていますが、コルーチンは処理を途中で中断して、\u003cstrong\u003e任意のタイミング(次フレーム/一定秒後/完了後etc)で中断部分から処理を再開\u003c/strong\u003eすることができます。\u003c/p\u003e\n\n\u003cp\u003eコルーチン自体はUnityやC#特有のものではなく、マイクロスレッドやファイバなどといった名前でいろんなところで利用されています。(\u003ca href=\"http://hiroakiuno.hatenablog.com/entries/2007/03/16\" rel=\"nofollow noopener\" target=\"_blank\"\u003e厳密な違いを解説しているサイト\u003c/a\u003e)\u003c/p\u003e\n\n\u003cp\u003eLua・Python・Moduka-2・Simula・Limboなどにも導入されてます。\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eマルチスレッド\u003c/code\u003e\u003c/strong\u003eでも原理的には同じことができるため現在はマルチスレッドが使われるケースが多いです。\u003cbr\u003e\n(マルチスレッドのメリットは、1.直接OSの支援を受け入れられる。2.エントリー/リターンの構造を変えずにコードを多重化できるので過去の言語との親和性が良い。)\u003c/p\u003e\n\n\u003cp\u003eマルチスレッドの場合はプログラマが同期制御を行わなければならないのでコルーチンのような簡易さはありません。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"スレッドとの違い\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B9%E3%83%AC%E3%83%83%E3%83%89%E3%81%A8%E3%81%AE%E9%81%95%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eスレッドとの違い\u003c/h3\u003e\n\n\u003cp\u003eコルーチンはシングルスレッドの環境で擬似的にマルチスレッドを実現するための手段ではありません。シングルスレッド環境でマルチスレッドを実現するのは(多くの場合VMで行う)グリーンスレッドとなります。コルーチンはシングルスレッドであり、マルチスレッドとは異なって、\u003cstrong\u003e外から切り替えを行うのではなく自身で中断ができる\u003c/strong\u003eことが利点です。また、マルチスレッドと違い\u003cstrong\u003e処理を他に明け渡さず、自身が処理を明示的に中断する必要\u003c/strong\u003eがあります。また、コンテキストも変わりません。そしてネストもできることから、マルチスレッドの代替ではないことがわかります(どちらかというとステートマシンのようなもの)。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"cのコルーチン\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#c%E3%81%AE%E3%82%B3%E3%83%AB%E3%83%BC%E3%83%81%E3%83%B3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eC#のコルーチン\u003c/h1\u003e\n\n\u003cp\u003e進捗情報の保持と、中段場所からの再開を行うのに反復子\u003ccode\u003eyield\u003c/code\u003eを用います。\u003c/p\u003e\n\n\u003cp\u003e反復子は\u003ccode\u003eIEnumerator\u003c/code\u003eインターフェースで表されます。\u003c/p\u003e\n\n\u003cp\u003eメソッドの戻り値を反復子の要素とする\u003ccode\u003eyield return\u003c/code\u003eがあり、これを用いることでメソッドをコルーチン化できます。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eIEnumerator\u003c/code\u003eは\u003ccode\u003eEnumerator(数え上げ)\u003c/code\u003eというように\u003ccode\u003eIterator\u003c/code\u003eのような感じで実装がされていて、\u003ccode\u003eMoveNext()\u003c/code\u003eと\u003ccode\u003eReset()\u003c/code\u003eというメソッドが存在しています。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eMoveNext()\u003c/code\u003eは前回の\u003cstrong\u003e\u003ccode\u003eyield return\u003c/code\u003e文の続きから処理を実行する\u003c/strong\u003eメソッドです。また、\u003ccode\u003eMoveNext()\u003c/code\u003eの戻り値は\u003cstrong\u003e次の数え上げが可能かどうか\u003c/strong\u003eがbool値で返ってきます。\u003c/p\u003e\n\n\u003cp\u003e詳しい使い方などの説明は以下サイトがオヌヌメ。\u003cbr\u003e\n\u003c/p\u003e\u003cp\u003e\u003ca href=\"http://tyheeeee.hateblo.jp/entry/2013/08/07/C%23%E3%81%AB%E3%81%8A%E3%81%91%E3%82%8Byield_return%E3%81%AE%E6%8C%99%E5%8B%95#fn1\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003c/a\u003e\u003ca href=\"http://tyheeeee.hateblo.jp/entry/2013/08/07/C%23%E3%81%AB%E3%81%8A%E3%81%91%E3%82%8Byield_return%E3%81%AE%E6%8C%99%E5%8B%95#fn1\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://tyheeeee.hateblo.jp/entry/2013/08/07/C%23%E3%81%AB%E3%81%8A%E3%81%91%E3%82%8Byield_return%E3%81%AE%E6%8C%99%E5%8B%95#fn1\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"unityのコルーチン\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#unity%E3%81%AE%E3%82%B3%E3%83%AB%E3%83%BC%E3%83%81%E3%83%B3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eUnityのコルーチン\u003c/h1\u003e\n\n\u003cp\u003e非同期処理を実現する手段のうちの一つです。Unityでは高負荷となる処理を実行する場合、複数のフレームに分割するか、\u003ccode\u003eC# Job System\u003c/code\u003eを用いるような並列処理を行います。この時フレーム単位に処理を分割する方法として、コルーチン機能が使用されていました。言語システムとしてはC#そのままであり、C#での\u003ccode\u003eMoveNext()\u003c/code\u003eの仕組みを利用してフレームごとに反復子を呼び出す\u003ccode\u003eStartCoroutine\u003c/code\u003eが用意されています。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"非同期処理の必要性\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%9D%9E%E5%90%8C%E6%9C%9F%E5%87%A6%E7%90%86%E3%81%AE%E5%BF%85%E8%A6%81%E6%80%A7\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e非同期処理の必要性\u003c/h3\u003e\n\n\u003cp\u003eアプリやゲームを作っているとほぼ100%ぶつかる問題として、\u003cstrong\u003eブロッキング処理(重たい同期処理)\u003c/strong\u003eがあげられます。１フレームにかかる処理が重たいと画面が引きつったように見えたり、入力の反応がなくなったりとデメリットが多いです。軽快なアプリを作成するための方法としては同期処理の非同期化が必要になってきます。Unityで非同期処理を行うためには、\u003cstrong\u003eC#の\u003ccode\u003easync/await\u003c/code\u003eと\u003ccode\u003eTask\u003c/code\u003eクラスか、コルーチンか、スレッド\u003c/strong\u003eを用います。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"コルーチンを使用するメリット\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B3%E3%83%AB%E3%83%BC%E3%83%81%E3%83%B3%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B%E3%83%A1%E3%83%AA%E3%83%83%E3%83%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eコルーチンを使用するメリット\u003c/h2\u003e\n\n\u003cp\u003eコルーチンを使用するメリットとしては大きく以下の2点があります。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"複数の処理を擬似並列できる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A4%87%E6%95%B0%E3%81%AE%E5%87%A6%E7%90%86%E3%82%92%E6%93%AC%E4%BC%BC%E4%B8%A6%E5%88%97%E3%81%A7%E3%81%8D%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e複数の処理を擬似並列できる。\u003c/h3\u003e\n\n\u003cp\u003e本来関数は一つずつしか実行できず、同時に実行するためにはマルチスレッドを利用する必要があります。コルーチンでは完全に並列ではありませんが、関数１の途中まで→関数２の途中まで→関数３の途中まで→関数１の続き、というような流れで\u003cstrong\u003e擬似的に並列処理を実現\u003c/strong\u003eできます。通信処理やロード処理といった時間がかかるけど画面が止まっては困る場合なんかに便利。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"状態を関数内で保持できる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%8A%B6%E6%85%8B%E3%82%92%E9%96%A2%E6%95%B0%E5%86%85%E3%81%A7%E4%BF%9D%E6%8C%81%E3%81%A7%E3%81%8D%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e状態を関数内で保持できる。\u003c/h3\u003e\n\n\u003cp\u003eゲームシーン等の遷移をするような処理ではクラスのメンバ変数やグローバル変数などにstate値を保持し、その値をswitch/ifによって処理を分岐させていたが、コルーチンを使うことによってstate値を保持する必要がなくなり、処理の流れも分かりやすくなります。\u003c/p\u003e\n\n\u003cp\u003e以下のような様々な場面で活用ができます。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e敵キャラのAIに使用。\u003c/li\u003e\n\u003cli\u003e\n\u003cstrong\u003eアニメーションや演出に使用\u003c/strong\u003e。(例えば複数のオブジェクトをアニメーションさせつつ全てのアニメが完了するのを待ってから次の処理に移ったり)\u003c/li\u003e\n\u003cli\u003e\n\u003cstrong\u003eダウンロード終了まで待機\u003c/strong\u003e。\u003c/li\u003e\n\u003cli\u003e重い処理を複数フレームにわたって実行し処理落ちしないようにする。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eUnityの場合は\u003ccode\u003eUpdate()\u003c/code\u003eが使えるので処理の数だけコンポーネントを作ればコルーチンを使わずとも同様のことが実現できるがその場合、処理終了後のコールバックの設計が必要になったりして、結構複雑なロジックになってしまいます。コルーチンを用いれば\u003cstrong\u003e処理終了後に自動的に元の位置に処理が戻ってくる\u003c/strong\u003eため、コールバックもいらないし、個々の処理が終わったかどうかを判定する特別な処理なども不要になります(コンポーネントに対するUpdate()の呼び出しよりもコルーチンの方がオーバーヘッドが少ないかもしれない)。\u003c/p\u003e\n\n\u003cp\u003e今回はUnityで使用するコルーチンに着目した記事としています。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"コルーチンの仕組み\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B3%E3%83%AB%E3%83%BC%E3%83%81%E3%83%B3%E3%81%AE%E4%BB%95%E7%B5%84%E3%81%BF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eコルーチンの仕組み\u003c/h2\u003e\n\n\u003cp\u003eコルーチンは戻り値がIEnumeratorのメソッドとして記述します。\u003c/p\u003e\n\n\u003cp\u003eIEnumeratorは「列挙子」というもので、コルーチンは「列挙された処理を順に実行」していくイメージ。\u003c/p\u003e\n\n\u003cp\u003eコルーチンの中では必ず\u003ccode\u003eyield\u003c/code\u003e演算子が登場します。\u003c/p\u003e\n\n\u003cp\u003e一般的にコルーチンのアップデートはUpdate関数の後に実行されます。\u003c/p\u003e\n\n\u003cp\u003e処理としては以下の通り。　※太字は代表的なもの。\u003c/p\u003e\n\n\u003ctable\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003cth\u003e記述\u003c/th\u003e\n\u003cth\u003e処理内容\u003c/th\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eyield return xx;\u003c/td\u003e\n\u003ctd\u003e処理(xx)の\n終了を\n待機する\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003cstrong\u003eyield return null;\nか yield;\u003c/strong\u003e\u003c/td\u003e\n\u003ctd\u003e1frame後に\n処理を\n再開する\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003cstrong\u003eyield return new WaitForSeconds(1f);\u003c/strong\u003e\u003c/td\u003e\n\u003ctd\u003e自分自身が\nUpdateの\nタイミングで\n実行されるのを\n1秒止める\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003cstrong\u003eyield break;\u003c/strong\u003e\u003c/td\u003e\n\u003ctd\u003e処理を途中で\n強制終了する\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd colspan=\"1\"\u003eyield return new WaitForEndOfFrame();\u003c/td\u003e\n\u003ctd colspan=\"1\"\u003e次のframeに\n再開する\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd colspan=\"1\"\u003eyield return new\nWaitUntil(再開条件)\u003c/td\u003e\n\u003ctd colspan=\"1\"\u003e再開条件に\n指定した\n関数が\ntrueを返すと\n再開する\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd colspan=\"1\"\u003eyield return new\nWaitWhile(待機条件)\u003c/td\u003e\n\u003ctd colspan=\"1\"\u003e待機条件に\n指定した\n関数が\nfalseを返すと\n再開する\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd colspan=\"1\"\u003eyield WaitForFixedUpdate()\u003c/td\u003e\n\u003ctd colspan=\"1\"\u003e全てのスクリプトで\nFixedUpdate\n呼び出し後に続行する\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd colspan=\"1\"\u003e\u003cstrong\u003eyield return\nStartCoroutine();\u003c/strong\u003e\u003c/td\u003e\n\u003ctd colspan=\"1\"\u003e別のコルーチンを\n新たに実行し\n終わるまで\n中断する\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd colspan=\"1\"\u003eyield return\n一部非同期オブジェクト;\u003c/td\u003e\n\u003ctd colspan=\"1\"\u003eその処理が\n終わるまで\nコルーチンを\n中断することができる\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003cp\u003e(一部非同期オブジェクト :WWWやAssetBundleのLoadAssetAsyncの返り値であるAssetBundleRequestが一部非同期オブジェクトとしてあげられる。)\u003c/p\u003e\n\n\u003cp\u003e(WaitForSeconds()もコルーチンの一つである。)\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"コルーチンの目的\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B3%E3%83%AB%E3%83%BC%E3%83%81%E3%83%B3%E3%81%AE%E7%9B%AE%E7%9A%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eコルーチンの目的\u003c/h1\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"ロジックの整理\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%AD%E3%82%B8%E3%83%83%E3%82%AF%E3%81%AE%E6%95%B4%E7%90%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eロジックの整理\u003c/h3\u003e\n\n\u003cp\u003e主要な処理から分岐した１セットの「ここからここまで」の処理を、\u003cstrong\u003e主要な処理の記述や定常的に行われる処理の記述を侵食しないで\u003c/strong\u003e別の箇所に書くことができる。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"処理の分割\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%87%A6%E7%90%86%E3%81%AE%E5%88%86%E5%89%B2\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e処理の分割\u003c/h3\u003e\n\n\u003cp\u003e\u003ccode\u003ecoroutine\u003c/code\u003e処理内での\u003ccode\u003eyield return\u003c/code\u003eまでの１ブロックは主要な\u003ccode\u003eUpdate\u003c/code\u003e１回と同期して行われるので\u003ccode\u003ecoroutine\u003c/code\u003e内での１回の処理量を\u003ccode\u003eyield return\u003c/code\u003eのブロックで適切に分解することで、\u003cstrong\u003e主要な処理を止めることなく\u003c/strong\u003e実行することができます。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"処理の待機\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%87%A6%E7%90%86%E3%81%AE%E5%BE%85%E6%A9%9F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e処理の待機\u003c/h3\u003e\n\n\u003cp\u003ecoroutine処理は、他に影響なく単独で処理を止めることができます。\u003ccode\u003eyield return WaitForSeconds(1f)\u003c/code\u003e;\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"コルーチンの書き方\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B3%E3%83%AB%E3%83%BC%E3%83%81%E3%83%B3%E3%81%AE%E6%9B%B8%E3%81%8D%E6%96%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eコルーチンの書き方\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"コルーチンの実行停止方法と引数\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B3%E3%83%AB%E3%83%BC%E3%83%81%E3%83%B3%E3%81%AE%E5%AE%9F%E8%A1%8C%E5%81%9C%E6%AD%A2%E6%96%B9%E6%B3%95%E3%81%A8%E5%BC%95%E6%95%B0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eコルーチンの実行・停止方法と引数\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003eStartCoroutine(...) / StopCoroutine(...)\u003c/code\u003eでコルーチンを操作する際に、三種類の引数を取ることができる。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"ienumerator型\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#ienumerator%E5%9E%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eIEnumerator型\u003c/h3\u003e\n\n\u003cp\u003eUnity4.5から\u003ccode\u003eIEnumerator\u003c/code\u003e型の引数を取るStopCoroutineのオーバーロードが追加され、\u003ccode\u003eStartCoroutine / StopCoroutine\u003c/code\u003eを行うにあたって\u003ccode\u003eIEnumerator\u003c/code\u003e型を引数に取る方が主流になった。\u003c/p\u003e\n\n\u003cp\u003eただしIEnumerator型のインスタンスを、クラス内のフィールドなどに保持しておく必要ができた。\u003c/p\u003e\n\n\u003cp\u003eStopCoroutineを使用して、停止したコルーチンを同じIEnumratorを指定して再スタートさせた場合はコルーチンの途中から再開してしまうので、初めから再スタートさせたい場合は再取得が必要。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eIEnumerator\u003c/span\u003e \u003cspan class=\"n\"\u003eHogeCoroutine\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eSet\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eHogeCoroutine\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eCour\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003eIEnumerator\u003c/span\u003e \u003cspan class=\"nf\"\u003eCour\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// 何か処理\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eStart\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eSet\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eStartCoroutine\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003eHogeCoroutine\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eStopCoroutine\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003eHogeCoroutine\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//以下、再スタートさせるための再取得\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eSet\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eStartCoroutine\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003eHogeCoroutine\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eHogeCoroutine\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"string型\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#string%E5%9E%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eString型\u003c/h3\u003e\n\n\u003cp\u003eUnity4.5以降はあまり使われてません。\u003c/p\u003e\n\n\u003cp\u003eStopCoroutineするに当たって設計上どうしてもIEnumerator型のインスタンスをクラス内のフィールドなどに保持しておきたくないような場合に使用します。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"coroutine型\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#coroutine%E5%9E%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eCoroutine型\u003c/h3\u003e\n\n\u003cp\u003e基本的な使用方法は\u003ccode\u003eIEnumerator\u003c/code\u003eと似ています。\u003cbr\u003e\n\u003ccode\u003eStartCoroutine\u003c/code\u003eの戻り値が\u003ccode\u003eCoroutine\u003c/code\u003e型なので、それを活用すれば直感的な書き方ができるかも?\u003c/p\u003e\n\n\u003cp\u003e終了を待ちたいコルーチンを呼び出す際、上記のようにCoroutine型の変数に\u003ccode\u003eStartCoroutine()\u003c/code\u003eの戻り値を代入する必要があります。これをしないとUnityにおいてのコルーチンの終了を正しくキャッチできません。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eIEnumerator\u003c/span\u003e \u003cspan class=\"nf\"\u003eCour\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// 何か処理\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eStart\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eCoroutine\u003c/span\u003e \u003cspan class=\"n\"\u003ecour\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eStartCoroutine\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003eHogeCoroutine\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eStopCoroutine\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003ecour\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eIEnumeratorの代わりにコルーチンのメソッド名を文字列で渡すことでコルーチンを実行・停止することができます。\u003cbr\u003e\n\u003cbr\u003e\u003c/p\u003e\n\n\u003cp\u003e(何故使用されないか :メソッド名の変更を行い、置き換えた場合に、Stringなので一緒には置き換わらない。つまり、コンパイルチェック上から外れてしまい、メソッド名が間違っていても実行されるまでエラーが発生しない。また、Stringで渡した場合は２つ以上の引数を持つコルーチンに値を渡すことができない。以上の理由で特別な理由がない限りはIEnumeratorを使用する方が良い。)\u003c/p\u003e\n\n\u003cp\u003e(Unity4.5以前のコルーチン実行・停止 :Unity4.5以前、StopCoroutineメソッドはstring型を引数に取るオーバーロードしかなかった。また、StopCoroutineで止めることができるコルーチンはstring型の引数のオーバーロードのStartCoroutineで始めたコルーチンのみだった。そのため、StopCoroutineでコルーチンを止めたい場合、Unity4.5以前はstring型を引数に取るStartCoroutineメソッドのオーバーロードを使う必要があった。)\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eStart\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eStartCoroutine\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Hoge\"\u003c/span\u003e \u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e10\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eIEnumerator\u003c/span\u003e \u003cspan class=\"nf\"\u003eHoge\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003eamp\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"n\"\u003elt\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e \u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e++\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eyield\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eWaitForSeconds\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"m\"\u003e1f\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e(\u003ccode\u003eStartCoroutine_Auto\u003c/code\u003e : \u003ccode\u003eStartCoroutine_Auto\u003c/code\u003eというメソッドがあるが、これは\u003ccode\u003eStartCoroutine\u003c/code\u003eの実装部分。\u003ccode\u003eStartCoroutine()\u003c/code\u003eは引数として取ったコルーチン\u003ccode\u003eStartCoroutine_Auto\u003c/code\u003eメソッドに渡し、例えばコルーチン内で\u003ccode\u003eWaitForSeconds\u003c/code\u003eをしていた場合、コルーチンを遅延対象として登録する。要するに\u003cstrong\u003e\u003ccode\u003eStartCoroutine\u003c/code\u003eは\u003ccode\u003eStartCoroutine_Auto\u003c/code\u003eを呼んでるだけ\u003c/strong\u003e。)\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"コルーチンの停止\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B3%E3%83%AB%E3%83%BC%E3%83%81%E3%83%B3%E3%81%AE%E5%81%9C%E6%AD%A2\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eコルーチンの停止\u003c/h2\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"stopallcoroutines\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#stopallcoroutines\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eStopAllCoroutines\u003c/h3\u003e\n\n\u003cp\u003e\u003ccode\u003eStopAllCoroutines\u003c/code\u003eを使用するとstring引数の\u003ccode\u003eStartCoroutine\u003c/code\u003eで始めたコルーチンも、\u003ccode\u003eIEnumerator\u003c/code\u003e引数の\u003ccode\u003eStartCoroutine\u003c/code\u003eで始めたコルーチンも全て止まります。しかし、止めたいコルーチン以外も止めてしまうので注意が必要となります。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"注意点\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%B3%A8%E6%84%8F%E7%82%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e注意点\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003eStopCoroutine\u003c/code\u003e()は、もし指定したコルーチンが動いていない場合、何も処理をせず進行する(エラーも出ない)。\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eStopCoroutine()\u003c/code\u003eで止めると、\u003ccode\u003edispose\u003c/code\u003eや\u003ccode\u003efinally\u003c/code\u003eが呼ばれない。\u003c/li\u003e\n\u003cli\u003e親のGameObjectが非アクティブに成ると動作を停止する。(この場合、再開することはできない)→対策として絶対に破棄されないゲームオブジェクトにコルーチンを実行させる方法とか)\u003c/li\u003e\n\u003cli\u003eコンポーネントが\u003ccode\u003eenable/disable\u003c/code\u003e担っても動作を継続する。\u003c/li\u003e\n\u003cli\u003eコルーチンはメインスレッド上で動作している。つまり、\u003ccode\u003eyield\u003c/code\u003eで分けて処理を分散しても、\u003cstrong\u003eその１つ１つの処理自体が重いと全体に影響する\u003c/strong\u003e。例えば\u003ccode\u003eStartCoroutine\u003c/code\u003eが100回呼ばれて1フレームに100個\u003ccode\u003eInstantiate\u003c/code\u003eされる処理とか)\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"並列処理を走らせたい時\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%B8%A6%E5%88%97%E5%87%A6%E7%90%86%E3%82%92%E8%B5%B0%E3%82%89%E3%81%9B%E3%81%9F%E3%81%84%E6%99%82\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e並列処理を走らせたい時\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eStart\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eStartCoroutine\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"nf\"\u003eHoge\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eStartCoroutine\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"nf\"\u003ePiyo\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eIEnumerator\u003c/span\u003e \u003cspan class=\"nf\"\u003eHoge\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"s\"\u003e\"hoge\"\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eyield\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"s\"\u003e\"hogehoge\"\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eyield\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"s\"\u003e\"hogehogehoge\"\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eIEnumerator\u003c/span\u003e \u003cspan class=\"nf\"\u003ePiyo\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"s\"\u003e\"piyo\"\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eyield\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"s\"\u003e\"piyopiyo\"\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eyield\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"s\"\u003e\"piyopiyopiyo\"\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e//////result//////\u003c/span\u003e\n\u003cspan class=\"n\"\u003ehoge\u003c/span\u003e\n\u003cspan class=\"n\"\u003epiyo\u003c/span\u003e\n\u003cspan class=\"n\"\u003ehogehoge\u003c/span\u003e\n\u003cspan class=\"n\"\u003epiyopiyo\u003c/span\u003e\n\u003cspan class=\"n\"\u003ehogehogehoge\u003c/span\u003e\n\u003cspan class=\"n\"\u003epiyopiyopiyo\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/////////////////\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"コルーチンの途中で一定時間中断\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B3%E3%83%AB%E3%83%BC%E3%83%81%E3%83%B3%E3%81%AE%E9%80%94%E4%B8%AD%E3%81%A7%E4%B8%80%E5%AE%9A%E6%99%82%E9%96%93%E4%B8%AD%E6%96%AD\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eコルーチンの途中で一定時間中断\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eIEnumerator\u003c/span\u003e \u003cspan class=\"nf\"\u003eHoge\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//処理記述(1)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eyield\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eWaitForSeconds\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"m\"\u003e1f\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//処理記述(2)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eyield\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eWaitForSeconds\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"m\"\u003e1f\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//処理記述(3)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eyield\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eWaitForSeconds\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"m\"\u003e1f\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"コルーチン単体の完了を待つ時\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B3%E3%83%AB%E3%83%BC%E3%83%81%E3%83%B3%E5%8D%98%E4%BD%93%E3%81%AE%E5%AE%8C%E4%BA%86%E3%82%92%E5%BE%85%E3%81%A4%E6%99%82\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eコルーチン(単体)の完了を待つ時\u003c/h3\u003e\n\n\u003cp\u003e例えばHogeの処理を先に終えてからPiyoしたい場合。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eIEnumerator\u003c/span\u003e \u003cspan class=\"nf\"\u003eStart\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eyield\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nf\"\u003eStartCoroutine\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"nf\"\u003eHoge\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eStartCoroutine\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"nf\"\u003ePiyo\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eIEnumerator\u003c/span\u003e \u003cspan class=\"nf\"\u003eHoge\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"s\"\u003e\"hoge\"\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eyield\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"s\"\u003e\"hogehoge\"\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eyield\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"s\"\u003e\"hogehogehoge\"\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eIEnumerator\u003c/span\u003e \u003cspan class=\"nf\"\u003ePiyo\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"s\"\u003e\"piyo\"\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eyield\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"s\"\u003e\"piyopiyo\"\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eyield\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"s\"\u003e\"piyopiyopiyo\"\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e//////result//////\u003c/span\u003e\n\u003cspan class=\"n\"\u003ehoge\u003c/span\u003e\n\u003cspan class=\"n\"\u003ehogehoge\u003c/span\u003e\n\u003cspan class=\"n\"\u003ehogehogehoge\u003c/span\u003e\n\u003cspan class=\"n\"\u003epiyo\u003c/span\u003e\n\u003cspan class=\"n\"\u003epiyopiyo\u003c/span\u003e\n\u003cspan class=\"n\"\u003epiyopiyopiyo\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/////////////////\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"コルーチン複数の完了を待つ時\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B3%E3%83%AB%E3%83%BC%E3%83%81%E3%83%B3%E8%A4%87%E6%95%B0%E3%81%AE%E5%AE%8C%E4%BA%86%E3%82%92%E5%BE%85%E3%81%A4%E6%99%82\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eコルーチン(複数)の完了を待つ時\u003c/h3\u003e\n\n\u003cp\u003e例えばHogeとPiyoは同時に処理したいけど、Hugaは２つの処理が完全に終わってから処理を開始したい場合。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eIEnumerator\u003c/span\u003e \u003cspan class=\"nf\"\u003eStart\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eCoroutine\u003c/span\u003e \u003cspan class=\"n\"\u003ecoroutineHoge\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eStartCoroutine\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"nf\"\u003eHoge\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eCoroutine\u003c/span\u003e \u003cspan class=\"n\"\u003ecoroutinePiyo\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eStartCoroutine\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"nf\"\u003ePiyo\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eyield\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003ecoroutineHoge\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eyield\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003ecoroutinePiyo\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eStartCoroutine\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"nf\"\u003eHuga\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eIEnumerator\u003c/span\u003e \u003cspan class=\"nf\"\u003eHoge\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"s\"\u003e\"hoge\"\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eyield\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"s\"\u003e\"hogehoge\"\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eyield\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"s\"\u003e\"hogehogehoge\"\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eIEnumerator\u003c/span\u003e \u003cspan class=\"nf\"\u003ePiyo\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"s\"\u003e\"piyo\"\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eyield\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"s\"\u003e\"piyopiyo\"\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eyield\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"s\"\u003e\"piyopiyopiyo\"\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eIEnumerator\u003c/span\u003e \u003cspan class=\"nf\"\u003eHuga\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"s\"\u003e\"huga\"\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eyield\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"s\"\u003e\"hugahuga\"\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eyield\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"s\"\u003e\"hugahuga\"\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e//////result//////\u003c/span\u003e\n\u003cspan class=\"n\"\u003ehoge\u003c/span\u003e\n\u003cspan class=\"n\"\u003epiyo\u003c/span\u003e\n\u003cspan class=\"n\"\u003ehogehoge\u003c/span\u003e\n\u003cspan class=\"n\"\u003epiyopiyo\u003c/span\u003e\n\u003cspan class=\"n\"\u003ehogehogehoge\u003c/span\u003e\n\u003cspan class=\"n\"\u003epiyopiyopiyo\u003c/span\u003e\n\u003cspan class=\"n\"\u003ehuga\u003c/span\u003e\n\u003cspan class=\"n\"\u003ehugahuga\u003c/span\u003e\n\u003cspan class=\"n\"\u003ehugahugahuga\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/////////////////\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"コルーチンを使って別のオブジェクトの状態を監視する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B3%E3%83%AB%E3%83%BC%E3%83%81%E3%83%B3%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E5%88%A5%E3%81%AE%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E7%8A%B6%E6%85%8B%E3%82%92%E7%9B%A3%E8%A6%96%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eコルーチンを使って別のオブジェクトの状態を監視する\u003c/h3\u003e\n\n\u003cp\u003eUnityでAというオブジェクトが、別のBというオブジェクトのアニメーションや処理が終わったことを知りたい場合は、\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eC#のDelegateを使う\u003c/li\u003e\n\u003cli\u003eAとBが相互に参照しあうようにして、BがAに完了を伝える\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eという感じにコールバックという方法があります。\u003c/p\u003e\n\n\u003cp\u003eこの方法を用いたくない(delegateを書きたくない、循環参照は避けたい)場合、コルーチンを使って別のオブジェクトの状態を監視することができます。\u003c/p\u003e\n\n\u003cp\u003eただしDelegateなどに比べると、完了しだいすぐに通知できるわけではないので要注意。(スクリプトの実行順序によっては１フレーム待つケースがある)\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eHoge\u003c/span\u003e \u003cspan class=\"n\"\u003epiyo\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eIEnumerator\u003c/span\u003e \u003cspan class=\"nf\"\u003eStartPlay\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003epiyo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ePlay\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ewhile\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"p\"\u003e!\u003c/span\u003e\u003cspan class=\"n\"\u003epiyo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eisComplete\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// piyoのisComplete変数がtrueになるまで待機\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eyield\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eWaitForEndOfFrame\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// childのアニメーションが終了したとき\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// (child.isCompleteがtrueになったとき)\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// ここより下にかかれた処理が実行される\u0026amp;lt;/code\u0026amp;gt;\u0026amp;lt;/p\u0026amp;gt;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//シンプルに実装できるので、アニメーションを組み合わせた演出などを作る時に便利。\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"引数があるコルーチンを実行\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%BC%95%E6%95%B0%E3%81%8C%E3%81%82%E3%82%8B%E3%82%B3%E3%83%AB%E3%83%BC%E3%83%81%E3%83%B3%E3%82%92%E5%AE%9F%E8%A1%8C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e引数があるコルーチンを実行\u003c/h3\u003e\n\n\u003cp\u003e引数があるコルーチンに値を渡すには、\u003ccode\u003eStartCoroutine\u003c/code\u003eの引数内でコルーチン関数を呼び出します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eStart\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eStartCoroutine\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"nf\"\u003eHoge\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eIEnumerator\u003c/span\u003e \u003cspan class=\"nf\"\u003eHoge\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// 処理\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"コルーチンの実行タイミングと時間感覚\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B3%E3%83%AB%E3%83%BC%E3%83%81%E3%83%B3%E3%81%AE%E5%AE%9F%E8%A1%8C%E3%82%BF%E3%82%A4%E3%83%9F%E3%83%B3%E3%82%B0%E3%81%A8%E6%99%82%E9%96%93%E6%84%9F%E8%A6%9A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eコルーチンの実行タイミングと時間感覚\u003c/h1\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"実行タイミング\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%9F%E8%A1%8C%E3%82%BF%E3%82%A4%E3%83%9F%E3%83%B3%E3%82%B0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e実行タイミング\u003c/h3\u003e\n\n\u003cp\u003eこれは描写間隔と同期されます。\u003c/p\u003e\n\n\u003cp\u003eつまり、WaitTimeを極小にした場合、Update()と同じタイミングで実行されます。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eyield return new WaitForSeconds ( 0.00001f );\u003c/code\u003eとしても、１フレームに１回実行となります。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"時間間隔の計測タイミング\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%99%82%E9%96%93%E9%96%93%E9%9A%94%E3%81%AE%E8%A8%88%E6%B8%AC%E3%82%BF%E3%82%A4%E3%83%9F%E3%83%B3%E3%82%B0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e時間間隔の計測タイミング\u003c/h3\u003e\n\n\u003cp\u003e上記のような極小タイミングだった場合、１フレームに何度も実行されないことからわかるように\u003cstrong\u003e「フレーム毎に、規定時間を過ぎていた場合に実行する」という処理である\u003c/strong\u003eと言えます。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eTime.timescale\u003c/code\u003eを少し小さくしてみると、その処理誤差が段々顕著になります。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eWaitForSeconds\u003c/code\u003eは\u003ccode\u003eTime.timescale\u003c/code\u003eの影響を受けますが、毎フレームのタイミングを送らせるものではないため、規定時間を経過したと判定され、毎フレーム実行されます。\u003c/p\u003e\n\n\u003cp\u003e→つまり、極小の待機時間にした場合、ほとんどUpdate()と同じ動きになり余す。\u003c/p\u003e\n\n\u003cp\u003e(\u003ccode\u003eyield return null\u003c/code\u003e の場合は時間関数を通らないので \u003ccode\u003eTime.timescale = 0\u003c/code\u003e とした場合でも影響は受けない。)\u003c/p\u003e\n\n\u003cp\u003eまた、\u003ccode\u003eyield return\u003c/code\u003eで返す値が具体的にUnityのゲームループにおいてどこに差し込まれるかはUnityのマニュアルのScript Lifecycle Flowchartの図がわかりやすくなっています。\u003ca href=\"https://camo.qiitausercontent.com/aa84aecb84c6e4c8b3a90c169c3e4a0446be92c8/687474703a2f2f6e6575652e63632f77702d636f6e74656e742f75706c6f6164732f323031342f31322f756e6974796c6966656379636c652e6a7067\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/http%3A%2F%2Fneue.cc%2Fwp-content%2Fuploads%2F2014%2F12%2Funitylifecycle.jpg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=8eba9726be77f7487389b21ab45e9afd\" alt=\"\" width=\"607\" height=\"848\" data-canonical-src=\"http://neue.cc/wp-content/uploads/2014/12/unitylifecycle.jpg\" srcset=\"https://qiita-user-contents.imgix.net/http%3A%2F%2Fneue.cc%2Fwp-content%2Fuploads%2F2014%2F12%2Funitylifecycle.jpg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=7dd65fb99dba71352b59b963054981c0 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eまた、\u003ca href=\"http://docs.unity3d.com/ja/current/Manual/ExecutionOrder.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003e「Unityスクリプトリファレンス イベント関数の実行順」\u003c/a\u003eも参考になります。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"カスタムコルーチンについて\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%A0%E3%82%B3%E3%83%AB%E3%83%BC%E3%83%81%E3%83%B3%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eカスタムコルーチンについて\u003c/h2\u003e\n\n\u003cp\u003eUnity5.3から実装された新機能です。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eWaitForSeconds\u003c/code\u003eのようなnewするとコルーチンとして使えるクラスを自作できるようになっています。\u003cbr\u003e\n(\u003ccode\u003eCustomYieldInstruction\u003c/code\u003eを継承したりラムダ式で評価してコルーチンの条件設定を行ったりが可能)\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eIEnumerator\u003c/span\u003e \u003cspan class=\"nf\"\u003eStart\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eyield\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nf\"\u003eWaitWhile\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003egt\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003eInput\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eanykeyDown\u003c/span\u003e \u003cspan class=\"p\"\u003e--\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003cp\u003e条件が満たされるまで待機する、WaitUntilが追加\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e条件が満たされている間は待機する、WaitWhileが追加\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eファイルロードとかの非同期処理を管理するクラスが作りやすくなった。\u003c/p\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"unity5x系以降の小ネタを知るのにオススメのスライド\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#unity5x%E7%B3%BB%E4%BB%A5%E9%99%8D%E3%81%AE%E5%B0%8F%E3%83%8D%E3%82%BF%E3%82%92%E7%9F%A5%E3%82%8B%E3%81%AE%E3%81%AB%E3%82%AA%E3%82%B9%E3%82%B9%E3%83%A1%E3%81%AE%E3%82%B9%E3%83%A9%E3%82%A4%E3%83%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eUnity5.x系以降の小ネタを知るのにオススメのスライド\u003c/h1\u003e\n\n\u003cp\u003e9月に行われた\u003ca href=\"https://connpass.com/event/95696/\" rel=\"nofollow noopener\" target=\"_blank\"\u003e「Unity 非同期完全に理解した勉強会」\u003c/a\u003eで登壇していたむろほしさんの資料がとても参考になります。是非コルーチンを使用する前にご一読ください。\u003c/p\u003e\n\n\u003cp\u003eいまさらだけど Coroutine：\u003ca href=\"https://speakerdeck.com/ryotamurohoshi/imasaradakedoque-ren-siteokou-coroutine\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://speakerdeck.com/ryotamurohoshi/imasaradakedoque-ren-siteokou-coroutine\u003c/a\u003e\u003c/p\u003e\n","createdAt":"2018-12-30T08:47:00Z","elapsedYearsFromLastModifiedAt":0,"encryptedId":"Usb0NZZewF7jOtG/W5tsYaoyorGU8bmB--edfF/c83rnC2yKKi--zrEEeSF+gzpABBmoDtKBjQ==","isBanned":false,"isDeprecated":false,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2021-06-22T18:47:20Z","likesCount":108,"linkUrl":"https://qiita.com/4_mio_11/items/3030f9a39f59cd68f705","organization":null,"originalId":753128,"stockedCount":79,"title":"古来よりUnity非同期を実現していたコルーチンとは何者か？","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%9C%80%E5%88%9D%E3%81%AB\"\u003e最初に\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B3%E3%83%AB%E3%83%BC%E3%83%81%E3%83%B3%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\"\u003eコルーチンについて\u003c/a\u003e\n\u003cul\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B9%E3%83%AC%E3%83%83%E3%83%89%E3%81%A8%E3%81%AE%E9%81%95%E3%81%84\"\u003eスレッドとの違い\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cli\u003e\n\u003ca href=\"#c%E3%81%AE%E3%82%B3%E3%83%AB%E3%83%BC%E3%83%81%E3%83%B3\"\u003eC#のコルーチン\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#unity%E3%81%AE%E3%82%B3%E3%83%AB%E3%83%BC%E3%83%81%E3%83%B3\"\u003eUnityのコルーチン\u003c/a\u003e\n\u003cul\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E9%9D%9E%E5%90%8C%E6%9C%9F%E5%87%A6%E7%90%86%E3%81%AE%E5%BF%85%E8%A6%81%E6%80%A7\"\u003e非同期処理の必要性\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B3%E3%83%AB%E3%83%BC%E3%83%81%E3%83%B3%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B%E3%83%A1%E3%83%AA%E3%83%83%E3%83%88\"\u003eコルーチンを使用するメリット\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E8%A4%87%E6%95%B0%E3%81%AE%E5%87%A6%E7%90%86%E3%82%92%E6%93%AC%E4%BC%BC%E4%B8%A6%E5%88%97%E3%81%A7%E3%81%8D%E3%82%8B\"\u003e複数の処理を擬似並列できる。\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%8A%B6%E6%85%8B%E3%82%92%E9%96%A2%E6%95%B0%E5%86%85%E3%81%A7%E4%BF%9D%E6%8C%81%E3%81%A7%E3%81%8D%E3%82%8B\"\u003e状態を関数内で保持できる。\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B3%E3%83%AB%E3%83%BC%E3%83%81%E3%83%B3%E3%81%AE%E4%BB%95%E7%B5%84%E3%81%BF\"\u003eコルーチンの仕組み\u003c/a\u003e\n\u003c/li\u003e\n\n\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B3%E3%83%AB%E3%83%BC%E3%83%81%E3%83%B3%E3%81%AE%E7%9B%AE%E7%9A%84\"\u003eコルーチンの目的\u003c/a\u003e\n\u003cul\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%AD%E3%82%B8%E3%83%83%E3%82%AF%E3%81%AE%E6%95%B4%E7%90%86\"\u003eロジックの整理\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%87%A6%E7%90%86%E3%81%AE%E5%88%86%E5%89%B2\"\u003e処理の分割\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%87%A6%E7%90%86%E3%81%AE%E5%BE%85%E6%A9%9F\"\u003e処理の待機\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\n\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B3%E3%83%AB%E3%83%BC%E3%83%81%E3%83%B3%E3%81%AE%E6%9B%B8%E3%81%8D%E6%96%B9\"\u003eコルーチンの書き方\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B3%E3%83%AB%E3%83%BC%E3%83%81%E3%83%B3%E3%81%AE%E5%AE%9F%E8%A1%8C%E5%81%9C%E6%AD%A2%E6%96%B9%E6%B3%95%E3%81%A8%E5%BC%95%E6%95%B0\"\u003eコルーチンの実行・停止方法と引数\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#ienumerator%E5%9E%8B\"\u003eIEnumerator型\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#string%E5%9E%8B\"\u003eString型\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#coroutine%E5%9E%8B\"\u003eCoroutine型\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B3%E3%83%AB%E3%83%BC%E3%83%81%E3%83%B3%E3%81%AE%E5%81%9C%E6%AD%A2\"\u003eコルーチンの停止\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#stopallcoroutines\"\u003eStopAllCoroutines\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%B3%A8%E6%84%8F%E7%82%B9\"\u003e注意点\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%B8%A6%E5%88%97%E5%87%A6%E7%90%86%E3%82%92%E8%B5%B0%E3%82%89%E3%81%9B%E3%81%9F%E3%81%84%E6%99%82\"\u003e並列処理を走らせたい時\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B3%E3%83%AB%E3%83%BC%E3%83%81%E3%83%B3%E3%81%AE%E9%80%94%E4%B8%AD%E3%81%A7%E4%B8%80%E5%AE%9A%E6%99%82%E9%96%93%E4%B8%AD%E6%96%AD\"\u003eコルーチンの途中で一定時間中断\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B3%E3%83%AB%E3%83%BC%E3%83%81%E3%83%B3%E5%8D%98%E4%BD%93%E3%81%AE%E5%AE%8C%E4%BA%86%E3%82%92%E5%BE%85%E3%81%A4%E6%99%82\"\u003eコルーチン(単体)の完了を待つ時\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B3%E3%83%AB%E3%83%BC%E3%83%81%E3%83%B3%E8%A4%87%E6%95%B0%E3%81%AE%E5%AE%8C%E4%BA%86%E3%82%92%E5%BE%85%E3%81%A4%E6%99%82\"\u003eコルーチン(複数)の完了を待つ時\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B3%E3%83%AB%E3%83%BC%E3%83%81%E3%83%B3%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E5%88%A5%E3%81%AE%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E7%8A%B6%E6%85%8B%E3%82%92%E7%9B%A3%E8%A6%96%E3%81%99%E3%82%8B\"\u003eコルーチンを使って別のオブジェクトの状態を監視する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%BC%95%E6%95%B0%E3%81%8C%E3%81%82%E3%82%8B%E3%82%B3%E3%83%AB%E3%83%BC%E3%83%81%E3%83%B3%E3%82%92%E5%AE%9F%E8%A1%8C\"\u003e引数があるコルーチンを実行\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B3%E3%83%AB%E3%83%BC%E3%83%81%E3%83%B3%E3%81%AE%E5%AE%9F%E8%A1%8C%E3%82%BF%E3%82%A4%E3%83%9F%E3%83%B3%E3%82%B0%E3%81%A8%E6%99%82%E9%96%93%E6%84%9F%E8%A6%9A\"\u003eコルーチンの実行タイミングと時間感覚\u003c/a\u003e\n\u003cul\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%AE%9F%E8%A1%8C%E3%82%BF%E3%82%A4%E3%83%9F%E3%83%B3%E3%82%B0\"\u003e実行タイミング\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%99%82%E9%96%93%E9%96%93%E9%9A%94%E3%81%AE%E8%A8%88%E6%B8%AC%E3%82%BF%E3%82%A4%E3%83%9F%E3%83%B3%E3%82%B0\"\u003e時間間隔の計測タイミング\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%A0%E3%82%B3%E3%83%AB%E3%83%BC%E3%83%81%E3%83%B3%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\"\u003eカスタムコルーチンについて\u003c/a\u003e\n\u003c/li\u003e\n\n\n\u003cli\u003e\n\u003ca href=\"#unity5x%E7%B3%BB%E4%BB%A5%E9%99%8D%E3%81%AE%E5%B0%8F%E3%83%8D%E3%82%BF%E3%82%92%E7%9F%A5%E3%82%8B%E3%81%AE%E3%81%AB%E3%82%AA%E3%82%B9%E3%82%B9%E3%83%A1%E3%81%AE%E3%82%B9%E3%83%A9%E3%82%A4%E3%83%89\"\u003eUnity5.x系以降の小ネタを知るのにオススメのスライド\u003c/a\u003e\n\u003c/li\u003e\n\n","totalPv":30851,"uuid":"3030f9a39f59cd68f705","banReason":null,"adventCalendarItem":{"day":17,"calendar":{"name":"一人Unity＆C#","urlName":"loneliness-c-sharp-unity","year":2018,"organization":null}},"author":{"encryptedId":"PR/w75qLfyJvXQl31F1C/B68BtY=--QBuhRsXtPH0q4Pdf--D3bWaEBOr3vI2P/r2gXRCw==","originalId":36899,"description":"スローペースで生きてます。","facebookUrl":null,"githubUrl":null,"isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"九谷 ろっさむ","profileImageUrl":"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/36899/profile-images/1569238333","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F36899%2Fprofile-images%2F1569238333?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=bb40b504fe756d2d83e40aae4addc05f","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F36899%2Fprofile-images%2F1569238333?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=065e9e19d665c9e712b695578649af76","urlName":"4_mio_11","websiteUrl":"","twitterUrl":"https://twitter.com/4_mio_11","twitterUrlName":"4_mio_11","revealedOrganizations":{"edges":[]}},"tags":[{"name":"C#","urlName":"csharp"},{"name":".NET","urlName":".net"},{"name":"Unity","urlName":"unity"},{"name":"非同期処理","urlName":"%e9%9d%9e%e5%90%8c%e6%9c%9f%e5%87%a6%e7%90%86"},{"name":"unity5","urlName":"unity5"}],"followingLikers":{"edges":[]},"comments":{"totalCount":1}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

<!DOCTYPE html><html><head><meta charset="utf-8" /><title>[C++/C#]C#をCOM参照可能にしてC+＋アプリから呼ぶ1 - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/tera1707/items/7e22812f27884d0e3c49" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="pHduuolNbLSK+n9UNwrtb51ZCgohjehDwuso3oNQbq/e7owol8wVOhiw2T8D0Tm8FPYZumCxm7riVC1pcsAmzA==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta property="og:type" content="article"><meta property="og:title" content="[C++/C#]C#をCOM参照可能にしてC+＋アプリから呼ぶ1 - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1XME1yS3k5REkxMURJLU9Da2tOUFRlV1BndWVGcC1XUHItaUR2ZU9CcS1PQmwtT0Jwa01yNzd5TDQ0S2k0NE9YNDRPcTQ0R0w0NEtKNVpHODQ0RzJNUSZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTU0JnR4dC1jbGlwPWVsbGlwc2lzJnR4dC1hbGlnbj1jZW50ZXIlMkNtaWRkbGUmcz02NTMyMDliN2QyZDI2OTViYWFkZWJmM2Q1NzhkNDU3Zg&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RSFJsY21FeE56QTMmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT00NSZ0eHQtYWxpZ249cmlnaHQlMkNib3R0b20mcz01OTFjMWUwZjM2MjIxODZiYTQzMTViMmZjOTU0MDFiYg&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=435a0b1b1cca54f1dcf50e94db9dd04e"><meta property="og:description" content="

やりたいこと

色々な事情があり、すでにC#で作ってあるライブラリを、C++のアプリから呼びたい。
(なので、タイトルは正確に言うと、C#のdllを、COM参照可能にしたC#dllでラップして、C++アプリから呼ぶが正しい)


..."><meta content="https://qiita.com/tera1707/items/7e22812f27884d0e3c49" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C++,C#,COM,dll" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 1nzh4zz 38fzdi helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-1nzh4zz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:16px 32px;background-color:#FBE69E;color:rgba(0,0,0,0.87);line-height:1.5;font-weight:600;}@media (max-width:770px){.css-1nzh4zz{padding:16px;}}.css-38fzdi{color:#CA832A;margin-right:4px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-d5e343d3-4c33-4309-aba1-a8c781b9c671"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Ftera1707%2Fitems%2F7e22812f27884d0e3c49">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Ftera1707%2Fitems%2F7e22812f27884d0e3c49">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-d5e343d3-4c33-4309-aba1-a8c781b9c671">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/cpp","name":"C++"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2019-05-21T23:10:10.000+09:00","dateModified":"2019-05-23T13:58:09.000+09:00","headline":"[C++/C#]C#をCOM参照可能にしてC+＋アプリから呼ぶ1","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1XME1yS3k5REkxMURJLU9Da2tOUFRlV1BndWVGcC1XUHItaUR2ZU9CcS1PQmwtT0Jwa01yNzd5TDQ0S2k0NE9YNDRPcTQ0R0w0NEtKNVpHODQ0RzJNUSZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTU0JnR4dC1jbGlwPWVsbGlwc2lzJnR4dC1hbGlnbj1jZW50ZXIlMkNtaWRkbGUmcz02NTMyMDliN2QyZDI2OTViYWFkZWJmM2Q1NzhkNDU3Zg\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RSFJsY21FeE56QTMmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT00NSZ0eHQtYWxpZ249cmlnaHQlMkNib3R0b20mcz01OTFjMWUwZjM2MjIxODZiYTQzMTViMmZjOTU0MDFiYg\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=435a0b1b1cca54f1dcf50e94db9dd04e","mainEntityOfPage":"https://qiita.com/tera1707/items/7e22812f27884d0e3c49","author":{"@type":"Person","address":"大阪","email":"tera1707@gmail.com","identifier":"tera1707","name":"tera1707","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Favatars0.githubusercontent.com%2Fu%2F19180456%3Fv%3D4?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=1ddd4d18cb0c4d9ee77ed7cff93f4ae1","url":"https://qiita.com/tera1707","description":"","memberOf":[]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://increments.connpass.com/event/211948/">Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催</a><a target="_blank" id="header_text_message_2" href="https://increments.connpass.com/event/211948/">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"tera1707","type":"items","id":"7e22812f27884d0e3c49"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"tera1707","type":"items","id":"7e22812f27884d0e3c49"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_1","message":"Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"tera1707","type":"items","id":"7e22812f27884d0e3c49"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_2","message":"Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/tera1707/items/7e22812f27884d0e3c49","location":"/tera1707/items/7e22812f27884d0e3c49","scheme":"https","host":"qiita.com","port":null,"pathname":"/tera1707/items/7e22812f27884d0e3c49","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"JiC+F082I7wqJuCo3wj6bu4S95qxrxOtGLEy6edpeGFcuVyFUbdaMrhsRsPr0y69Z73kKvCTYFQ4DjdeFvkwAg==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-70de2c4c-73f8-4261-adcf-7127d316deeb"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/tera1707/items/7e22812f27884d0e3c49/likers" class="css-1iupg5d">6</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">4</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/7e22812f27884d0e3c49/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/tera1707/items/7e22812f27884d0e3c49/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/tera1707/items/7e22812f27884d0e3c49/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/tera1707/items/7e22812f27884d0e3c49/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/tera1707/items/7e22812f27884d0e3c49.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-1nzh4zz"><span class="fa fa-fw fa-warning css-38fzdi"></span><p>More than 1 year has passed since last update.</p></div><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/tera1707"><img class="css-100alwu eyfquo10" src="https://avatars0.githubusercontent.com/u/19180456?v=4" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/tera1707" class="css-10ougpm">@<!-- -->tera1707</a><div class="css-1ay9vb9"><span><meta content="2019-05-21T14:10:10Z"/><time dateTime="2019-05-23T04:58:09Z" class="css-m19uds">updated at 2019-05-23</time></span></div></div></div></div></div><h1 class="css-cgzq40">[C++/C#]C#をCOM参照可能にしてC+＋アプリから呼ぶ1</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/cpp" class="css-4czcte">C++</a><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/com" class="css-4czcte">COM</a><a href="/tags/dll" class="css-4czcte">dll</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div>
<h1>
<span id="やりたいこと" class="fragment"></span><a href="#%E3%82%84%E3%82%8A%E3%81%9F%E3%81%84%E3%81%93%E3%81%A8"><i class="fa fa-link"></i></a>やりたいこと</h1>

<p>色々な事情があり、すでにC#で作ってあるライブラリを、C++のアプリから呼びたい。<br>
(なので、タイトルは正確に言うと、<code>C#のdllを、COM参照可能にしたC#dllでラップして、C++アプリから呼ぶ</code>が正しい)</p>

<h1>
<span id="関連項目目次" class="fragment"></span><a href="#%E9%96%A2%E9%80%A3%E9%A0%85%E7%9B%AE%E7%9B%AE%E6%AC%A1"><i class="fa fa-link"></i></a>関連項目目次</h1>

<ul>
<li><a href="https://qiita.com/tera1707/items/7e22812f27884d0e3c49">[C++/C#]C#をCOM参照可能にしてC+＋アプリから呼ぶ1</a></li>
<li><a href="https://qiita.com/tera1707/items/a12341d87ce0b47eba55" id="reference-f4ec933dbc5303d84f08">[C++/C#]C#をCOM参照可能にしてC+＋アプリから呼ぶ2</a></li>
</ul>

<h1>
<span id="やり方候補" class="fragment"></span><a href="#%E3%82%84%E3%82%8A%E6%96%B9%E5%80%99%E8%A3%9C"><i class="fa fa-link"></i></a>やり方候補</h1>

<p><a href="https://kagasu.hatenablog.com/entry/2017/12/31/220239#%E2%85%A1-CCLI%E3%82%92%E4%BD%BF%E3%81%86%E6%96%B9%E6%B3%95" rel="nofollow noopener" target="_blank">こちらのページ</a>にあるように、いろいろなやり方があるっぽい。</p>

<table>
<thead>
<tr>
<th style="text-align: left">やり方</th>
<th style="text-align: left">特徴</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left">1.作ってあるC#ライブラリをCOM参照可能なC#でラップする</td>
<td style="text-align: left">ラップC#を使う側のC++のコードが増える</td>
</tr>
<tr>
<td style="text-align: left">2.C++のアプリをC++/CLIでビルドしなおす</td>
<td style="text-align: left">・原則C++アプリの全テスト必要・ランタイム依存になる</td>
</tr>
<tr>
<td style="text-align: left">3.<a href="https://github.com/3F/DllExport/releases" rel="nofollow noopener" target="_blank">有志の方が作ったもの</a>を使用しC#(DLL)側で関数をエクスポートする</td>
<td style="text-align: left">C#(DLL)側のソースコードが無い場合利用できない</td>
</tr>
</tbody>
</table>

<p>今回は、1.の方法で実験をした。つまり、下記のような構成とする。</p>

<table>
<thead>
<tr>
<th style="text-align: left">プロジェクト名</th>
<th style="text-align: left">内容</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left">DllCsプロジェクト</td>
<td style="text-align: left">仮想[すでにC#で作ってあるライブラリ]</td>
</tr>
<tr>
<td style="text-align: left">DllCsComWrapperプロジェクト</td>
<td style="text-align: left">仮想[すでにC#で作ってあるライブラリのC#のCOMラッパー]</td>
</tr>
<tr>
<td style="text-align: left">ConsoleApplication1プロジェクト</td>
<td style="text-align: left">仮想[C#ライブラリを呼びたいC++アプリ]</td>
</tr>
</tbody>
</table>

<p><a href="https://camo.qiitausercontent.com/1d84862ebb66bf9ae043686837dbf1ff3aa74525/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335323630312f66353435353731652d323931642d373962632d636138362d6438343265613437656334372e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2Ff545571e-291d-79bc-ca86-d842ea47ec47.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=208541da5b247d0b34e826fd7e908c54" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/352601/f545571e-291d-79bc-ca86-d842ea47ec47.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2Ff545571e-291d-79bc-ca86-d842ea47ec47.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=fe2f04c29132bacd767435444d4a4867 1x" loading="lazy"></a></p>

<p>コードは、ほぼほぼ<a href="https://knowledge.rinpress.com/index.php/%EF%BC%A3%EF%BC%8B%EF%BC%8B%E3%81%AE%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%81%8B%E3%82%89%EF%BC%A3%EF%BC%83%E3%81%AE%EF%BC%A4%EF%BC%AC%EF%BC%AC%E3%82%92%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B" rel="nofollow noopener" target="_blank">こちら</a>のを参考にさせていただきました。ありがとうございます。</p>

<h1>
<span id="todo" class="fragment"></span><a href="#todo"><i class="fa fa-link"></i></a>ToDo</h1>

<h3>
<span id="仮想すでにcで作ってあるライブラリ-を実装" class="fragment"></span><a href="#%E4%BB%AE%E6%83%B3%E3%81%99%E3%81%A7%E3%81%ABc%E3%81%A7%E4%BD%9C%E3%81%A3%E3%81%A6%E3%81%82%E3%82%8B%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA-%E3%82%92%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>仮想[すでにC#で作ってあるライブラリ] を実装</h3>

<p>DllCsプロジェクトに、下記ファイルを追加。<br>
引数を2つ取ってそれを足した値を返すメソッド<code>Add</code>を持っている。</p>

<div class="code-frame" data-lang="c#">
<div class="code-lang"><span class="bold">DllCs.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">namespace</span> <span class="nn">DllCs</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">DllCsClass</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="k">static</span> <span class="kt">int</span> <span class="nf">Add</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="n">a</span> <span class="p">+</span> <span class="n">b</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<h3>
<span id="仮想すでにcで作ってあるライブラリのcのcomラッパー-を実装" class="fragment"></span><a href="#%E4%BB%AE%E6%83%B3%E3%81%99%E3%81%A7%E3%81%ABc%E3%81%A7%E4%BD%9C%E3%81%A3%E3%81%A6%E3%81%82%E3%82%8B%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%81%AEc%E3%81%AEcom%E3%83%A9%E3%83%83%E3%83%91%E3%83%BC-%E3%82%92%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>仮想[すでにC#で作ってあるライブラリのC#のCOMラッパー] を実装</h3>

<p>DllCsComWrapperプロジェクトに、下記のファイルを追加。<br>
上のファイルをラップしたメソッドを持っている。</p>

<div class="code-frame" data-lang="c#">
<div class="code-lang"><span class="bold">DllCsComWrapper.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">DllCs</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Runtime.InteropServices</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">DllCsComWrapper</span>
<span class="p">{</span>
    <span class="p">[</span><span class="nf">ComVisible</span><span class="p">(</span><span class="k">true</span><span class="p">)]</span>
    <span class="p">[</span><span class="nf">ClassInterface</span><span class="p">(</span><span class="n">ClassInterfaceType</span><span class="p">.</span><span class="n">AutoDual</span><span class="p">)]</span>
    <span class="p">[</span><span class="nf">Guid</span><span class="p">(</span><span class="s">"85555B74-E2E0-4493-9869-3CE95F13CB99"</span><span class="p">)]</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">DllCsComWrapperClass</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="n">Int32</span> <span class="nf">Add</span><span class="p">(</span><span class="n">Int32</span> <span class="n">param1</span><span class="p">,</span> <span class="n">Int32</span> <span class="n">param2</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">int</span> <span class="n">ret</span> <span class="p">=</span> <span class="n">DllCsClass</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">param1</span><span class="p">,</span> <span class="n">param2</span><span class="p">);</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">Int32</span><span class="p">)</span><span class="n">ret</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<h3>
<span id="仮想すでにcで作ってあるライブラリのcのcomラッパー-のプロジェクト設定をする" class="fragment"></span><a href="#%E4%BB%AE%E6%83%B3%E3%81%99%E3%81%A7%E3%81%ABc%E3%81%A7%E4%BD%9C%E3%81%A3%E3%81%A6%E3%81%82%E3%82%8B%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%81%AEc%E3%81%AEcom%E3%83%A9%E3%83%83%E3%83%91%E3%83%BC-%E3%81%AE%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E8%A8%AD%E5%AE%9A%E3%82%92%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>仮想[すでにC#で作ってあるライブラリのC#のCOMラッパー] のプロジェクト設定をする</h3>

<p>まず「アセンブリをCOM参照可能にする」にチェックを入れる。<br>
<a href="https://camo.qiitausercontent.com/a1cf2a7cadfab46cec32d2da28b1f6dc26a6b595/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335323630312f65393132663961612d653235622d626538382d316166362d6139366436616362313439382e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2Fe912f9aa-e25b-be88-1af6-a96d6acb1498.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=df6f3e1d760c1c0ff379f245d0832134" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/352601/e912f9aa-e25b-be88-1af6-a96d6acb1498.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2Fe912f9aa-e25b-be88-1af6-a96d6acb1498.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=96623b90d87ea9642c20e642a64e46d6 1x" loading="lazy"></a><br>
<a href="https://camo.qiitausercontent.com/68b8b1c76f8b4ab8bc504545655300e3733fc04d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335323630312f38623836613166372d306266662d656566632d643437302d3737643133323334643635372e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2F8b86a1f7-0bff-eefc-d470-77d13234d657.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=9007489cacb2beac534126412fcf0d6b" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/352601/8b86a1f7-0bff-eefc-d470-77d13234d657.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2F8b86a1f7-0bff-eefc-d470-77d13234d657.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=1c386f1a909ac1655ccc854dc36961c6 1x" loading="lazy"></a></p>

<p>次に「COM相互運用機能の登録」にチェックを入れる。<br>
<a href="https://camo.qiitausercontent.com/c158187b21fcdfcf59998218f2aa105831a27376/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335323630312f34323537373134312d343636392d643931662d636637652d3463633632343830396132622e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2F42577141-4669-d91f-cf7e-4cc624809a2b.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=b171f836c8d8760c8a8d23ed926c22cb" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/352601/42577141-4669-d91f-cf7e-4cc624809a2b.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2F42577141-4669-d91f-cf7e-4cc624809a2b.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=a93b694b9cdd6ae6482ed8e8d7295881 1x" loading="lazy"></a></p>

<p>※「COM相互運用機能の登録」は、後で出てくるregasmによるレジストリ登録をビルド時に自動でやってくれる機能と思われる。そのため、作成中のデバッグ時はチェックあった方が便利だが、これにチェックが入っていると、デバッグ中はCOMの登録が行われるため動いていたが、本番機ではCOM登録が行われないため動かない、となってしまうため注意が必要。</p>

<p>クラスには、下記の属性をつける（とりあえずおまじないとして、動くものをつくる。後で詳細調べること。）<br>
- ComVisible<br>
- ClassInterface<br>
- Guid　→VisualStudioのGUID付与ツールを使用する([ツール] &gt; [GUIDの作成]から。)</p>

<p>※<code>using DllCs;</code>を追加し、DllCsのdllを参照に追加しておくこと。</p>

<h3>
<span id="仮想cライブラリを呼びたいcアプリ-を実装する" class="fragment"></span><a href="#%E4%BB%AE%E6%83%B3c%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%82%92%E5%91%BC%E3%81%B3%E3%81%9F%E3%81%84c%E3%82%A2%E3%83%97%E3%83%AA-%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>仮想[C#ライブラリを呼びたいC++アプリ] を実装する</h3>

<p>ConsoleApplication1に下記のファイルを追加。</p>

<div class="code-frame" data-lang="c++">
<div class="code-lang"><span class="bold">ConsoleApplication1.cpp</span></div>
<div class="highlight"><pre class="with-code"><code><span class="cp">#include "pch.h"
#include &lt;iostream&gt;
#include &lt;Windows.h&gt;//追加
</span>
<span class="c1">//グローバル変数</span>
<span class="n">IDispatch</span> <span class="o">*</span><span class="n">pIDisp</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="n">IUnknown</span> <span class="o">*</span><span class="n">pIUnk</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>

<span class="c1">//プロトタイプ宣言</span>
<span class="kt">long</span> <span class="nf">_Init</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">long</span> <span class="nf">_Finalize</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">long</span> <span class="nf">_Add</span><span class="p">(</span><span class="kt">long</span> <span class="n">p_Number1</span><span class="p">,</span> <span class="kt">long</span> <span class="n">p_Number2</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">//変数宣言</span>
    <span class="kt">int</span> <span class="n">l_Result</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="c1">//初期処理</span>
    <span class="n">_Init</span><span class="p">();</span>

    <span class="c1">//合計処理</span>
    <span class="n">l_Result</span> <span class="o">=</span> <span class="n">_Add</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">500</span><span class="p">);</span>

    <span class="c1">//後処理</span>
    <span class="n">_Finalize</span><span class="p">();</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">"Calc Result : %d"</span><span class="p">,</span> <span class="n">l_Result</span><span class="p">);</span>

    <span class="k">return</span> <span class="n">l_Result</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">//***************************************************************************//</span>
<span class="c1">//初期化関数</span>
<span class="c1">//***************************************************************************//</span>
<span class="kt">long</span> <span class="nf">_Init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">CLSID</span> <span class="n">clsid</span><span class="p">;</span>

    <span class="c1">//COM初期化</span>
    <span class="o">::</span><span class="n">CoInitialize</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>

    <span class="c1">//ProcIDからCLSIDを取得（ネームスペース名．クラス名）</span>
    <span class="n">HRESULT</span> <span class="n">h_result</span> <span class="o">=</span> <span class="n">CLSIDFromProgID</span><span class="p">(</span><span class="s">L"DllCsComWrapper.DllCsComWrapperClass"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">clsid</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">FAILED</span><span class="p">(</span><span class="n">h_result</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">//Instanceの生成</span>
    <span class="n">h_result</span> <span class="o">=</span> <span class="n">CoCreateInstance</span><span class="p">(</span><span class="n">clsid</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">CLSCTX_INPROC_SERVER</span><span class="p">,</span> <span class="n">IID_IUnknown</span><span class="p">,</span> <span class="p">(</span><span class="kt">void</span><span class="o">**</span><span class="p">)</span><span class="o">&amp;</span><span class="n">pIUnk</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">FAILED</span><span class="p">(</span><span class="n">h_result</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">2</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">//インターフェースの取得（pIDispは共通変数）</span>
    <span class="n">h_result</span> <span class="o">=</span> <span class="n">pIUnk</span><span class="o">-&gt;</span><span class="n">QueryInterface</span><span class="p">(</span><span class="n">IID_IDispatch</span><span class="p">,</span> <span class="p">(</span><span class="kt">void</span><span class="o">**</span><span class="p">)</span><span class="o">&amp;</span><span class="n">pIDisp</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">FAILED</span><span class="p">(</span><span class="n">h_result</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">3</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">//正常終了</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">//***************************************************************************//</span>
<span class="c1">//修了処理</span>
<span class="c1">//***************************************************************************//</span>
<span class="kt">long</span> <span class="nf">_Finalize</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">pIDisp</span><span class="o">-&gt;</span><span class="n">Release</span><span class="p">();</span>
    <span class="n">pIUnk</span><span class="o">-&gt;</span><span class="n">Release</span><span class="p">();</span>
    <span class="o">::</span><span class="n">CoUninitialize</span><span class="p">();</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">//***************************************************************************//</span>
<span class="c1">//合計処理呼出処理</span>
<span class="c1">//***************************************************************************//</span>
<span class="kt">long</span> <span class="nf">_Add</span><span class="p">(</span><span class="kt">long</span> <span class="n">p_Number1</span><span class="p">,</span> <span class="kt">long</span> <span class="n">p_Number2</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//DISPIDの取得（関数名の設定）</span>
    <span class="n">DISPID</span> <span class="n">dispid</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">OLECHAR</span> <span class="o">*</span><span class="n">Func_Name</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">SysAllocString</span> <span class="p">(</span><span class="s">L"Add"</span><span class="p">)</span> <span class="p">};</span>
    <span class="n">HRESULT</span> <span class="n">h_result</span> <span class="o">=</span> <span class="n">pIDisp</span><span class="o">-&gt;</span><span class="n">GetIDsOfNames</span><span class="p">(</span><span class="n">IID_NULL</span><span class="p">,</span> <span class="n">Func_Name</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">LOCALE_SYSTEM_DEFAULT</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dispid</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">FAILED</span><span class="p">(</span><span class="n">h_result</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">//パラメータ作成</span>
    <span class="n">DISPPARAMS</span> <span class="n">params</span><span class="p">;</span>
    <span class="o">::</span><span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">params</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">DISPPARAMS</span><span class="p">));</span>

    <span class="n">params</span><span class="p">.</span><span class="n">cNamedArgs</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">params</span><span class="p">.</span><span class="n">rgdispidNamedArgs</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="n">params</span><span class="p">.</span><span class="n">cArgs</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="c1">//呼び出す関数の引数の数</span>

    <span class="c1">//引数設定（順番に注意…逆になる）</span>
    <span class="n">VARIANTARG</span><span class="o">*</span> <span class="n">pVarg</span> <span class="o">=</span> <span class="k">new</span> <span class="n">VARIANTARG</span><span class="p">[</span><span class="n">params</span><span class="p">.</span><span class="n">cArgs</span><span class="p">];</span>
    <span class="n">pVarg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">vt</span> <span class="o">=</span> <span class="n">VT_I4</span><span class="p">;</span>
    <span class="n">pVarg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">lVal</span> <span class="o">=</span> <span class="n">p_Number2</span><span class="p">;</span>
    <span class="n">pVarg</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">vt</span> <span class="o">=</span> <span class="n">VT_I4</span><span class="p">;</span>
    <span class="n">pVarg</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">lVal</span> <span class="o">=</span> <span class="n">p_Number1</span><span class="p">;</span>
    <span class="n">params</span><span class="p">.</span><span class="n">rgvarg</span> <span class="o">=</span> <span class="n">pVarg</span><span class="p">;</span>

    <span class="n">VARIANT</span> <span class="n">vRet</span><span class="p">;</span>
    <span class="n">VariantInit</span><span class="p">(</span><span class="o">&amp;</span><span class="n">vRet</span><span class="p">);</span>

    <span class="c1">//呼び出し</span>
    <span class="n">pIDisp</span><span class="o">-&gt;</span><span class="n">Invoke</span><span class="p">(</span><span class="n">dispid</span><span class="p">,</span> <span class="n">IID_NULL</span><span class="p">,</span> <span class="n">LOCALE_SYSTEM_DEFAULT</span><span class="p">,</span> <span class="n">DISPATCH_METHOD</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">params</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">vRet</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

    <span class="k">delete</span><span class="p">[]</span> <span class="n">pVarg</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">vRet</span><span class="p">.</span><span class="n">lVal</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>下記の処理を行っている。</p>

<ul>
<li>初期化処理

<ul>
<li>CoInitialize(NULL)を呼ぶ</li>
<li>ProcIDからCLSIDを取得</li>
<li>Instanceの生成</li>
<li>インターフェースの取得</li>
</ul>
</li>
<li>終了処理

<ul>
<li>Initで取得したものを解放

<ul>
<li>Instanceを開放</li>
<li>インターフェースを解放</li>
<li>CoUninitialize()を呼ぶ</li>
</ul>
</li>
</ul>
</li>
<li>Initと終了処理の間に、呼びたいC#のCOMラッパーを呼ぶ関数(ここでは<code>合計処理呼出処理</code>)を作る

<ul>
<li>メソッド名からIDを取得(GetIDsOfNames)</li>
<li>メソッドに渡すパラメータを作成(DISPPARAMS、VariantInitなど)</li>
<li>呼び出し実施(pIDisp-&gt;Invoke)</li>
</ul>
</li>
</ul>

<h3>
<span id="仮想cライブラリを呼びたいcアプリ-の注意点" class="fragment"></span><a href="#%E4%BB%AE%E6%83%B3c%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%82%92%E5%91%BC%E3%81%B3%E3%81%9F%E3%81%84c%E3%82%A2%E3%83%97%E3%83%AA-%E3%81%AE%E6%B3%A8%E6%84%8F%E7%82%B9"><i class="fa fa-link"></i></a>仮想[C#ライブラリを呼びたいC++アプリ] の注意点</h3>

<h4>
<span id="初期化処理について" class="fragment"></span><a href="#%E5%88%9D%E6%9C%9F%E5%8C%96%E5%87%A6%E7%90%86%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>初期化処理について</h4>

<p><code>CLSIDFromProgID(L"DllCsComWrapper.DllCsComWrapperClass", &amp;clsid);</code>の一つ目の引数は、C#のラッパークラスの「&lt;名前空間名&gt;.&lt;クラス名&gt;」にすること。</p>

<h4>
<span id="合計処理呼出処理について" class="fragment"></span><a href="#%E5%90%88%E8%A8%88%E5%87%A6%E7%90%86%E5%91%BC%E5%87%BA%E5%87%A6%E7%90%86%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>合計処理呼出処理について</h4>

<p><code>OLECHAR *Func_Name[] = { SysAllocString (L"Add") };</code>で定義する名前は、C#のラッパークラスの中の、呼びたいメソッド名にすること。</p>

<h4>
<span id="型について" class="fragment"></span><a href="#%E5%9E%8B%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>型について</h4>

<p>戻り値や引数をやり取りするときに、下記のような対応で型を決める必要がある。<br>
<a href="https://knowledge.rinpress.com/index.php/%EF%BC%A3%EF%BC%8B%EF%BC%8B%E3%81%AE%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%81%8B%E3%82%89%EF%BC%A3%EF%BC%83%E3%81%AE%EF%BC%A4%EF%BC%AC%EF%BC%AC%E3%82%92%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B" rel="nofollow noopener" target="_blank">こちら</a>の表より。</p>

<p><a href="https://camo.qiitausercontent.com/874476b8d65dfc3aef7715f7fab0ac88bb5d5e6c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335323630312f38366465363231612d303365332d323839642d323933362d6236373730396164666661312e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2F86de621a-03e3-289d-2936-b67709adffa1.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=3e6c027887ba32451047e427196058fb" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/352601/86de621a-03e3-289d-2936-b67709adffa1.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2F86de621a-03e3-289d-2936-b67709adffa1.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=f00360e00ad90e7109112793ce1185bd 1x" loading="lazy"></a></p>

<h3>
<span id="regasmでdllを登録" class="fragment"></span><a href="#regasm%E3%81%A7dll%E3%82%92%E7%99%BB%E9%8C%B2"><i class="fa fa-link"></i></a>regasmでdllを登録</h3>

<p>regasmを使用し、下記のコマンドで作成したラッパーDLLを登録する。</p>

<div class="code-frame" data-lang="bat"><div class="highlight"><pre class="with-code"><code><span class="kd">regasm</span> <span class="na">/codebase </span><span class="kd">DllCsComWrapper</span>.dll
</code></pre></div></div>

<p>※regasmのありかは、下記の通り(環境による？)<br>
32bit版：C:\Windows\Microsoft.NET\Framework\v4.0.30319<br>
64bit版：C:\Windows\Microsoft.NET\Framework64\v4.0.30319<br>
dllのプラットフォーム(32or64bit)により、32/64bitのあったものを使用しないと、うまく登録できない。</p>

<p>今回は、ここからregasm.exeをコピーして、実行するConsoleApplication1.exeと同じ階層に置いた。</p>

<h3>
<span id="作ったcアプリを実行" class="fragment"></span><a href="#%E4%BD%9C%E3%81%A3%E3%81%9Fc%E3%82%A2%E3%83%97%E3%83%AA%E3%82%92%E5%AE%9F%E8%A1%8C"><i class="fa fa-link"></i></a>作ったC++アプリを実行</h3>

<p>下記のようなbatを<strong>管理者権限で</strong>実行し、作成したアプリを実行。<br>
(面倒だったので、ここではregasmも実行時に毎回実行している)</p>

<div class="code-frame" data-lang="batchfile">
<div class="code-lang"><span class="bold">exerun.bat</span></div>
<div class="highlight"><pre class="with-code"><code>@echo <span class="na">off</span>
<span class="nb">cd</span> <span class="vm">%~dp0</span>
<span class="kd">regasm</span> <span class="na">/codebase </span><span class="kd">DllCsComWrapper</span>.dll
<span class="nb">start</span> <span class="na">/wait </span><span class="kd">ConsoleApplication1</span><span class="err">.exe</span>
<span class="nb">echo</span> <span class="kd">exe</span>からの戻り値は <span class="nv">%ERRORLEVEL%</span> です
<span class="nb">pause</span>
</code></pre></div>
</div>

<p>※ここで毎回regasmするなら、上の方でやっていた「COM相互運用機能の登録」のチェックはいらないっぽい。(デバッグするうえではあった方が便利)</p>

<h3>
<span id="実行結果" class="fragment"></span><a href="#%E5%AE%9F%E8%A1%8C%E7%B5%90%E6%9E%9C"><i class="fa fa-link"></i></a>実行結果</h3>

<p><a href="https://camo.qiitausercontent.com/0a43e952244a2080678b1c8c84de213cff0b30d6/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335323630312f61653366613730362d663863652d663031632d623934322d6232633137656134323438332e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2Fae3fa706-f8ce-f01c-b942-b2c17ea42483.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=3a8ca7d9d3c30f4980d7bc88ab500625" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/352601/ae3fa706-f8ce-f01c-b942-b2c17ea42483.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2Fae3fa706-f8ce-f01c-b942-b2c17ea42483.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=5d775c4cc5ce8d844a7623e34761f3ed 1x" loading="lazy"></a></p>

<h1>
<span id="追記190523" class="fragment"></span><a href="#%E8%BF%BD%E8%A8%98190523"><i class="fa fa-link"></i></a>追記(190523)</h1>

<p>C++からC#ラッパーに文字列を渡したいときは、下記のようにする。</p>

<div class="code-frame" data-lang="c#">
<div class="code-lang"><span class="bold">DllCsComWrapper.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">DllCs</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Runtime.InteropServices</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">DllCsComWrapper</span>
<span class="p">{</span>
    <span class="p">[</span><span class="nf">ComVisible</span><span class="p">(</span><span class="k">true</span><span class="p">)]</span>
    <span class="p">[</span><span class="nf">ClassInterface</span><span class="p">(</span><span class="n">ClassInterfaceType</span><span class="p">.</span><span class="n">AutoDual</span><span class="p">)]</span>
    <span class="p">[</span><span class="nf">Guid</span><span class="p">(</span><span class="s">"85555B74-E2E0-4493-9869-3CE95F13CB99"</span><span class="p">)]</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">DllCsComWrapperClass</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="n">Int32</span> <span class="nf">Add</span><span class="p">([</span><span class="nf">MarshalAs</span><span class="p">(</span><span class="n">UnmanagedType</span><span class="p">.</span><span class="n">BStr</span><span class="p">)]</span><span class="kt">string</span> <span class="n">str</span><span class="p">)</span> <span class="c1">// ★マーシャリングする！</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">str</span><span class="p">);</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">Int32</span><span class="p">)</span><span class="m">11</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div>
</div>

<p>受け取る文字列を、マーシャリングすることが必要。<br>
※とりあえず文字列をラッパーに渡せることを見たいため、C#のライブラリを呼ぶ処理は割愛。</p>

<div class="code-frame" data-lang="c++">
<div class="code-lang"><span class="bold">ConsoleApplication1.cpp</span></div>
<div class="highlight"><pre class="with-code"><code><span class="kt">long</span> <span class="nf">_Add</span><span class="p">(</span><span class="kt">long</span> <span class="n">p_Number1</span><span class="p">,</span> <span class="kt">long</span> <span class="n">p_Number2</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//DISPIDの取得（関数名の設定）</span>
    <span class="n">DISPID</span> <span class="n">dispid</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">OLECHAR</span> <span class="o">*</span><span class="n">Func_Name</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">SysAllocString</span> <span class="p">(</span><span class="s">L"Add"</span><span class="p">)</span> <span class="p">};</span>
    <span class="n">HRESULT</span> <span class="n">h_result</span> <span class="o">=</span> <span class="n">pIDisp</span><span class="o">-&gt;</span><span class="n">GetIDsOfNames</span><span class="p">(</span><span class="n">IID_NULL</span><span class="p">,</span> <span class="n">Func_Name</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">LOCALE_SYSTEM_DEFAULT</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dispid</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">FAILED</span><span class="p">(</span><span class="n">h_result</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">//パラメータ作成</span>
    <span class="n">DISPPARAMS</span> <span class="n">params</span><span class="p">;</span>
    <span class="o">::</span><span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">params</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">DISPPARAMS</span><span class="p">));</span>

    <span class="n">params</span><span class="p">.</span><span class="n">cNamedArgs</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">params</span><span class="p">.</span><span class="n">rgdispidNamedArgs</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="n">params</span><span class="p">.</span><span class="n">cArgs</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="c1">//呼び出す関数の引数の数</span>

    <span class="c1">//引数設定</span>
    <span class="n">VARIANT</span> <span class="n">var</span><span class="p">;</span>
    <span class="n">DISPPARAMS</span> <span class="n">dispParams</span><span class="p">;</span>
    <span class="n">var</span><span class="p">.</span><span class="n">vt</span> <span class="o">=</span> <span class="n">VT_BSTR</span><span class="p">;</span><span class="c1">// ★渡すデータの種別をBSTRにする</span>
    <span class="n">var</span><span class="p">.</span><span class="n">bstrVal</span> <span class="o">=</span> <span class="n">SysAllocString</span><span class="p">(</span><span class="s">L"mojiretsu"</span><span class="p">);</span><span class="c1">// ★渡す文字列</span>
    <span class="n">dispParams</span><span class="p">.</span><span class="n">cArgs</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">dispParams</span><span class="p">.</span><span class="n">rgvarg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">var</span><span class="p">;</span>
    <span class="n">dispParams</span><span class="p">.</span><span class="n">cNamedArgs</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">dispParams</span><span class="p">.</span><span class="n">rgdispidNamedArgs</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>

    <span class="n">VARIANT</span> <span class="n">vRet</span><span class="p">;</span>
    <span class="n">VariantInit</span><span class="p">(</span><span class="o">&amp;</span><span class="n">vRet</span><span class="p">);</span>

    <span class="c1">//呼び出し</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"[OK] Invoke start</span><span class="se">\r\n</span><span class="s">"</span><span class="p">);</span>
    <span class="n">h_result</span> <span class="o">=</span> <span class="n">pIDisp</span><span class="o">-&gt;</span><span class="n">Invoke</span><span class="p">(</span><span class="n">dispid</span><span class="p">,</span> <span class="n">IID_NULL</span><span class="p">,</span> <span class="n">LOCALE_SYSTEM_DEFAULT</span><span class="p">,</span> <span class="n">DISPATCH_METHOD</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dispParams</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">vRet</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">FAILED</span><span class="p">(</span><span class="n">h_result</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"[NG] Invoke failed</span><span class="se">\r\n</span><span class="s">"</span><span class="p">);</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">2</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">vRet</span><span class="p">.</span><span class="n">lVal</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</div>

<h1>
<span id="残項目" class="fragment"></span><a href="#%E6%AE%8B%E9%A0%85%E7%9B%AE"><i class="fa fa-link"></i></a>残項目</h1>

<ul>
<li>ラッパーC#の属性に何があるかとその効果(ComVisibleとか)</li>
</ul>

<h1>
<span id="コード" class="fragment"></span><a href="#%E3%82%B3%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>コード</h1>

<p><qiita-embed-ogp src="https://github.com/tera1707/WPF-/tree/master/025_CallCsDllFromCpp"></qiita-embed-ogp></p>

<h1>
<span id="参考" class="fragment"></span><a href="#%E5%8F%82%E8%80%83"><i class="fa fa-link"></i></a>参考</h1>

<p>コードのサンプル<br>
<a href="https://knowledge.rinpress.com/index.php/%EF%BC%A3%EF%BC%8B%EF%BC%8B%E3%81%AE%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%81%8B%E3%82%89%EF%BC%A3%EF%BC%83%E3%81%AE%EF%BC%A4%EF%BC%AC%EF%BC%AC%E3%82%92%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B" class="autolink" rel="nofollow noopener" target="_blank">https://knowledge.rinpress.com/index.php/%EF%BC%A3%EF%BC%8B%EF%BC%8B%E3%81%AE%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%81%8B%E3%82%89%EF%BC%A3%EF%BC%83%E3%81%AE%EF%BC%A4%EF%BC%AC%EF%BC%AC%E3%82%92%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B</a></p>

<p>C++からC#を呼ぶいろんな方法<br>
<a href="https://kagasu.hatenablog.com/entry/2017/12/31/220239#%E2%85%A1-CCLI%E3%82%92%E4%BD%BF%E3%81%86%E6%96%B9%E6%B3%95" class="autolink" rel="nofollow noopener" target="_blank">https://kagasu.hatenablog.com/entry/2017/12/31/220239#%E2%85%A1-CCLI%E3%82%92%E4%BD%BF%E3%81%86%E6%96%B9%E6%B3%95</a></p>

<p>コードのサンプル2<br>
<a href="https://azulean.me/2009/03/08/c%E3%81%A7com%E3%82%92%E4%BD%9C%E3%82%8B%EF%BC%88%E3%81%A8%E3%82%8A%E3%81%82%E3%81%88%E3%81%9A%E5%8B%95%E3%81%8F%E3%81%A8%E3%81%93%E3%82%8D%E3%81%BE%E3%81%A7%EF%BC%89/" class="autolink" rel="nofollow noopener" target="_blank">https://azulean.me/2009/03/08/c%E3%81%A7com%E3%82%92%E4%BD%9C%E3%82%8B%EF%BC%88%E3%81%A8%E3%82%8A%E3%81%82%E3%81%88%E3%81%9A%E5%8B%95%E3%81%8F%E3%81%A8%E3%81%93%E3%82%8D%E3%81%BE%E3%81%A7%EF%BC%89/</a></p>

<p>C++からC# DLL 超超超入門(3.の方法)<br>
<a href="https://qiita.com/Midori_co583826/items/58d56e202f104ebf867a" class="autolink" id="reference-ff8e8fb566ae75fe5a02">https://qiita.com/Midori_co583826/items/58d56e202f104ebf867a</a></p>

<p>GUIDの登録<br>
<a href="http://tech.nitoyon.com/ja/blog/2008/07/31/c-sharp-com/" class="autolink" rel="nofollow noopener" target="_blank">http://tech.nitoyon.com/ja/blog/2008/07/31/c-sharp-com/</a></p>

<p>あまり参考にならなかったが、コードのサンプル<br>
<a href="https://www.84kure.com/blog/2014/07/17/c-c%E3%81%8B%E3%82%89c%E3%81%AEdll%E3%82%92%E5%91%BC%E3%81%B6%E6%96%B9%E6%B3%95/" class="autolink" rel="nofollow noopener" target="_blank">https://www.84kure.com/blog/2014/07/17/c-c%E3%81%8B%E3%82%89c%E3%81%AEdll%E3%82%92%E5%91%BC%E3%81%B6%E6%96%B9%E6%B3%95/</a></p>

<p>文字列を渡すときのマーシャリング(BSTR ⇒ string)<br>
<a href="https://docs.microsoft.com/ja-jp/dotnet/framework/interop/default-marshaling-for-strings" class="autolink" rel="nofollow noopener" target="_blank">https://docs.microsoft.com/ja-jp/dotnet/framework/interop/default-marshaling-for-strings</a></p>

<p>COMラッパーに文字列を渡したいときに参考にしたサンプル<br>
<a href="https://www.acot.net/WMI/sample4.html" class="autolink" rel="nofollow noopener" target="_blank">https://www.acot.net/WMI/sample4.html</a></p>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Ftera1707%2Fitems%2F7e22812f27884d0e3c49&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Ftera1707%2Fitems%2F7e22812f27884d0e3c49&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/tera1707/items/7e22812f27884d0e3c49/likers" class="css-1iupg5d">6</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">4</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/7e22812f27884d0e3c49/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/tera1707/items/7e22812f27884d0e3c49/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/tera1707/items/7e22812f27884d0e3c49/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/tera1707/items/7e22812f27884d0e3c49/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/tera1707/items/7e22812f27884d0e3c49.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-70de2c4c-73f8-4261-adcf-7127d316deeb">{"authorAnalyticsTrackingId":"UA-140152640-1","organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-4b1cf88d-812d-44c1-8208-485f4475bfba"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-4b1cf88d-812d-44c1-8208-485f4475bfba">{}</script>
      
<div id="LoginModal-react-component-9df518a6-e34b-47c8-ac78-ae6bdf15bdc4"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-9df518a6-e34b-47c8-ac78-ae6bdf15bdc4">{}</script>
      
<div id="StockModal-react-component-a6006996-baa5-42c1-be6e-5c989d27d5ae"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-a6006996-baa5-42c1-be6e-5c989d27d5ae">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;cqYbj278qufE7AJwn3x8Pd9ji/NhaW3X301wd/0jafwIP/kdcH3TaVampBurp6juVsyYQyBVHi7/8nXADLMhnw==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\n\u003ch1\u003e\n\u003cspan id=\"やりたいこと\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%84%E3%82%8A%E3%81%9F%E3%81%84%E3%81%93%E3%81%A8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eやりたいこと\u003c/h1\u003e\n\n\u003cp\u003e色々な事情があり、すでにC#で作ってあるライブラリを、C++のアプリから呼びたい。\u003cbr\u003e\n(なので、タイトルは正確に言うと、\u003ccode\u003eC#のdllを、COM参照可能にしたC#dllでラップして、C++アプリから呼ぶ\u003c/code\u003eが正しい)\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"関連項目目次\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%96%A2%E9%80%A3%E9%A0%85%E7%9B%AE%E7%9B%AE%E6%AC%A1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e関連項目目次\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://qiita.com/tera1707/items/7e22812f27884d0e3c49\"\u003e[C++/C#]C#をCOM参照可能にしてC+＋アプリから呼ぶ1\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://qiita.com/tera1707/items/a12341d87ce0b47eba55\" id=\"reference-f4ec933dbc5303d84f08\"\u003e[C++/C#]C#をCOM参照可能にしてC+＋アプリから呼ぶ2\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"やり方候補\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%84%E3%82%8A%E6%96%B9%E5%80%99%E8%A3%9C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eやり方候補\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"https://kagasu.hatenablog.com/entry/2017/12/31/220239#%E2%85%A1-CCLI%E3%82%92%E4%BD%BF%E3%81%86%E6%96%B9%E6%B3%95\" rel=\"nofollow noopener\" target=\"_blank\"\u003eこちらのページ\u003c/a\u003eにあるように、いろいろなやり方があるっぽい。\u003c/p\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align: left\"\u003eやり方\u003c/th\u003e\n\u003cth style=\"text-align: left\"\u003e特徴\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e1.作ってあるC#ライブラリをCOM参照可能なC#でラップする\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eラップC#を使う側のC++のコードが増える\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e2.C++のアプリをC++/CLIでビルドしなおす\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e・原則C++アプリの全テスト必要・ランタイム依存になる\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e3.\u003ca href=\"https://github.com/3F/DllExport/releases\" rel=\"nofollow noopener\" target=\"_blank\"\u003e有志の方が作ったもの\u003c/a\u003eを使用しC#(DLL)側で関数をエクスポートする\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eC#(DLL)側のソースコードが無い場合利用できない\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003cp\u003e今回は、1.の方法で実験をした。つまり、下記のような構成とする。\u003c/p\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align: left\"\u003eプロジェクト名\u003c/th\u003e\n\u003cth style=\"text-align: left\"\u003e内容\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003eDllCsプロジェクト\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e仮想[すでにC#で作ってあるライブラリ]\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003eDllCsComWrapperプロジェクト\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e仮想[すでにC#で作ってあるライブラリのC#のCOMラッパー]\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003eConsoleApplication1プロジェクト\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e仮想[C#ライブラリを呼びたいC++アプリ]\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/1d84862ebb66bf9ae043686837dbf1ff3aa74525/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335323630312f66353435353731652d323931642d373962632d636138362d6438343265613437656334372e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2Ff545571e-291d-79bc-ca86-d842ea47ec47.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=208541da5b247d0b34e826fd7e908c54\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/352601/f545571e-291d-79bc-ca86-d842ea47ec47.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2Ff545571e-291d-79bc-ca86-d842ea47ec47.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=fe2f04c29132bacd767435444d4a4867 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eコードは、ほぼほぼ\u003ca href=\"https://knowledge.rinpress.com/index.php/%EF%BC%A3%EF%BC%8B%EF%BC%8B%E3%81%AE%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%81%8B%E3%82%89%EF%BC%A3%EF%BC%83%E3%81%AE%EF%BC%A4%EF%BC%AC%EF%BC%AC%E3%82%92%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B\" rel=\"nofollow noopener\" target=\"_blank\"\u003eこちら\u003c/a\u003eのを参考にさせていただきました。ありがとうございます。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"todo\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#todo\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eToDo\u003c/h1\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"仮想すでにcで作ってあるライブラリ-を実装\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BB%AE%E6%83%B3%E3%81%99%E3%81%A7%E3%81%ABc%E3%81%A7%E4%BD%9C%E3%81%A3%E3%81%A6%E3%81%82%E3%82%8B%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA-%E3%82%92%E5%AE%9F%E8%A3%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e仮想[すでにC#で作ってあるライブラリ] を実装\u003c/h3\u003e\n\n\u003cp\u003eDllCsプロジェクトに、下記ファイルを追加。\u003cbr\u003e\n引数を2つ取ってそれを足した値を返すメソッド\u003ccode\u003eAdd\u003c/code\u003eを持っている。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eDllCs.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eDllCs\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eDllCsClass\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"仮想すでにcで作ってあるライブラリのcのcomラッパー-を実装\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BB%AE%E6%83%B3%E3%81%99%E3%81%A7%E3%81%ABc%E3%81%A7%E4%BD%9C%E3%81%A3%E3%81%A6%E3%81%82%E3%82%8B%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%81%AEc%E3%81%AEcom%E3%83%A9%E3%83%83%E3%83%91%E3%83%BC-%E3%82%92%E5%AE%9F%E8%A3%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e仮想[すでにC#で作ってあるライブラリのC#のCOMラッパー] を実装\u003c/h3\u003e\n\n\u003cp\u003eDllCsComWrapperプロジェクトに、下記のファイルを追加。\u003cbr\u003e\n上のファイルをラップしたメソッドを持っている。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eDllCsComWrapper.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eDllCs\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Runtime.InteropServices\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eDllCsComWrapper\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eComVisible\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eClassInterface\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eClassInterfaceType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAutoDual\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"85555B74-E2E0-4493-9869-3CE95F13CB99\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eDllCsComWrapperClass\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eInt32\u003c/span\u003e \u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eInt32\u003c/span\u003e \u003cspan class=\"n\"\u003eparam1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eInt32\u003c/span\u003e \u003cspan class=\"n\"\u003eparam2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eret\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eDllCsClass\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eparam1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eparam2\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eInt32\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eret\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"仮想すでにcで作ってあるライブラリのcのcomラッパー-のプロジェクト設定をする\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BB%AE%E6%83%B3%E3%81%99%E3%81%A7%E3%81%ABc%E3%81%A7%E4%BD%9C%E3%81%A3%E3%81%A6%E3%81%82%E3%82%8B%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%81%AEc%E3%81%AEcom%E3%83%A9%E3%83%83%E3%83%91%E3%83%BC-%E3%81%AE%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E8%A8%AD%E5%AE%9A%E3%82%92%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e仮想[すでにC#で作ってあるライブラリのC#のCOMラッパー] のプロジェクト設定をする\u003c/h3\u003e\n\n\u003cp\u003eまず「アセンブリをCOM参照可能にする」にチェックを入れる。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/a1cf2a7cadfab46cec32d2da28b1f6dc26a6b595/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335323630312f65393132663961612d653235622d626538382d316166362d6139366436616362313439382e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2Fe912f9aa-e25b-be88-1af6-a96d6acb1498.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=df6f3e1d760c1c0ff379f245d0832134\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/352601/e912f9aa-e25b-be88-1af6-a96d6acb1498.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2Fe912f9aa-e25b-be88-1af6-a96d6acb1498.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=96623b90d87ea9642c20e642a64e46d6 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/68b8b1c76f8b4ab8bc504545655300e3733fc04d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335323630312f38623836613166372d306266662d656566632d643437302d3737643133323334643635372e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2F8b86a1f7-0bff-eefc-d470-77d13234d657.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=9007489cacb2beac534126412fcf0d6b\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/352601/8b86a1f7-0bff-eefc-d470-77d13234d657.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2F8b86a1f7-0bff-eefc-d470-77d13234d657.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=1c386f1a909ac1655ccc854dc36961c6 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e次に「COM相互運用機能の登録」にチェックを入れる。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/c158187b21fcdfcf59998218f2aa105831a27376/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335323630312f34323537373134312d343636392d643931662d636637652d3463633632343830396132622e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2F42577141-4669-d91f-cf7e-4cc624809a2b.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=b171f836c8d8760c8a8d23ed926c22cb\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/352601/42577141-4669-d91f-cf7e-4cc624809a2b.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2F42577141-4669-d91f-cf7e-4cc624809a2b.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=a93b694b9cdd6ae6482ed8e8d7295881 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e※「COM相互運用機能の登録」は、後で出てくるregasmによるレジストリ登録をビルド時に自動でやってくれる機能と思われる。そのため、作成中のデバッグ時はチェックあった方が便利だが、これにチェックが入っていると、デバッグ中はCOMの登録が行われるため動いていたが、本番機ではCOM登録が行われないため動かない、となってしまうため注意が必要。\u003c/p\u003e\n\n\u003cp\u003eクラスには、下記の属性をつける（とりあえずおまじないとして、動くものをつくる。後で詳細調べること。）\u003cbr\u003e\n- ComVisible\u003cbr\u003e\n- ClassInterface\u003cbr\u003e\n- Guid　→VisualStudioのGUID付与ツールを使用する([ツール] \u0026gt; [GUIDの作成]から。)\u003c/p\u003e\n\n\u003cp\u003e※\u003ccode\u003eusing DllCs;\u003c/code\u003eを追加し、DllCsのdllを参照に追加しておくこと。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"仮想cライブラリを呼びたいcアプリ-を実装する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BB%AE%E6%83%B3c%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%82%92%E5%91%BC%E3%81%B3%E3%81%9F%E3%81%84c%E3%82%A2%E3%83%97%E3%83%AA-%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e仮想[C#ライブラリを呼びたいC++アプリ] を実装する\u003c/h3\u003e\n\n\u003cp\u003eConsoleApplication1に下記のファイルを追加。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c++\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eConsoleApplication1.cpp\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"cp\"\u003e#include \"pch.h\"\n#include \u0026lt;iostream\u0026gt;\n#include \u0026lt;Windows.h\u0026gt;//追加\n\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//グローバル変数\u003c/span\u003e\n\u003cspan class=\"n\"\u003eIDispatch\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003epIDisp\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003eIUnknown\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003epIUnk\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e//プロトタイプ宣言\u003c/span\u003e\n\u003cspan class=\"kt\"\u003elong\u003c/span\u003e \u003cspan class=\"nf\"\u003e_Init\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evoid\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"kt\"\u003elong\u003c/span\u003e \u003cspan class=\"nf\"\u003e_Finalize\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evoid\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"kt\"\u003elong\u003c/span\u003e \u003cspan class=\"nf\"\u003e_Add\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003elong\u003c/span\u003e \u003cspan class=\"n\"\u003ep_Number1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003elong\u003c/span\u003e \u003cspan class=\"n\"\u003ep_Number2\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"nf\"\u003emain\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//変数宣言\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003el_Result\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e//初期処理\u003c/span\u003e\n    \u003cspan class=\"n\"\u003e_Init\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e//合計処理\u003c/span\u003e\n    \u003cspan class=\"n\"\u003el_Result\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003e_Add\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e300\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e500\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e//後処理\u003c/span\u003e\n    \u003cspan class=\"n\"\u003e_Finalize\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003eprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Calc Result : %d\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003el_Result\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003el_Result\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e//***************************************************************************//\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//初期化関数\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//***************************************************************************//\u003c/span\u003e\n\u003cspan class=\"kt\"\u003elong\u003c/span\u003e \u003cspan class=\"nf\"\u003e_Init\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evoid\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eCLSID\u003c/span\u003e \u003cspan class=\"n\"\u003eclsid\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e//COM初期化\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eCoInitialize\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e//ProcIDからCLSIDを取得（ネームスペース名．クラス名）\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eHRESULT\u003c/span\u003e \u003cspan class=\"n\"\u003eh_result\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eCLSIDFromProgID\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003eL\"DllCsComWrapper.DllCsComWrapperClass\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003eclsid\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eFAILED\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eh_result\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e//Instanceの生成\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eh_result\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eCoCreateInstance\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eclsid\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eCLSCTX_INPROC_SERVER\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIID_IUnknown\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evoid\u003c/span\u003e\u003cspan class=\"o\"\u003e**\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003epIUnk\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eFAILED\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eh_result\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e//インターフェースの取得（pIDispは共通変数）\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eh_result\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003epIUnk\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eQueryInterface\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIID_IDispatch\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evoid\u003c/span\u003e\u003cspan class=\"o\"\u003e**\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003epIDisp\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eFAILED\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eh_result\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e//正常終了\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e//***************************************************************************//\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//修了処理\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//***************************************************************************//\u003c/span\u003e\n\u003cspan class=\"kt\"\u003elong\u003c/span\u003e \u003cspan class=\"nf\"\u003e_Finalize\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evoid\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003epIDisp\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eRelease\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"n\"\u003epIUnk\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eRelease\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eCoUninitialize\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e//***************************************************************************//\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//合計処理呼出処理\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//***************************************************************************//\u003c/span\u003e\n\u003cspan class=\"kt\"\u003elong\u003c/span\u003e \u003cspan class=\"nf\"\u003e_Add\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003elong\u003c/span\u003e \u003cspan class=\"n\"\u003ep_Number1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003elong\u003c/span\u003e \u003cspan class=\"n\"\u003ep_Number2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//DISPIDの取得（関数名の設定）\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eDISPID\u003c/span\u003e \u003cspan class=\"n\"\u003edispid\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eOLECHAR\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eFunc_Name\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003eSysAllocString\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003eL\"Add\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eHRESULT\u003c/span\u003e \u003cspan class=\"n\"\u003eh_result\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003epIDisp\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eGetIDsOfNames\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIID_NULL\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eFunc_Name\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eLOCALE_SYSTEM_DEFAULT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003edispid\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eFAILED\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eh_result\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e//パラメータ作成\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eDISPPARAMS\u003c/span\u003e \u003cspan class=\"n\"\u003eparams\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ememset\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003eparams\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003esizeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDISPPARAMS\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003eparams\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecNamedArgs\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eparams\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ergdispidNamedArgs\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eparams\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecArgs\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e//呼び出す関数の引数の数\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e//引数設定（順番に注意…逆になる）\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eVARIANTARG\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003epVarg\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eVARIANTARG\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eparams\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"n\"\u003epVarg\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003evt\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eVT_I4\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003epVarg\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003elVal\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ep_Number2\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003epVarg\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003evt\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eVT_I4\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003epVarg\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003elVal\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ep_Number1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eparams\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ergvarg\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003epVarg\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003eVARIANT\u003c/span\u003e \u003cspan class=\"n\"\u003evRet\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eVariantInit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003evRet\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e//呼び出し\u003c/span\u003e\n    \u003cspan class=\"n\"\u003epIDisp\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eInvoke\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edispid\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIID_NULL\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eLOCALE_SYSTEM_DEFAULT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eDISPATCH_METHOD\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003eparams\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003evRet\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003edelete\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003epVarg\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003evRet\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elVal\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e下記の処理を行っている。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e初期化処理\n\n\u003cul\u003e\n\u003cli\u003eCoInitialize(NULL)を呼ぶ\u003c/li\u003e\n\u003cli\u003eProcIDからCLSIDを取得\u003c/li\u003e\n\u003cli\u003eInstanceの生成\u003c/li\u003e\n\u003cli\u003eインターフェースの取得\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e終了処理\n\n\u003cul\u003e\n\u003cli\u003eInitで取得したものを解放\n\n\u003cul\u003e\n\u003cli\u003eInstanceを開放\u003c/li\u003e\n\u003cli\u003eインターフェースを解放\u003c/li\u003e\n\u003cli\u003eCoUninitialize()を呼ぶ\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eInitと終了処理の間に、呼びたいC#のCOMラッパーを呼ぶ関数(ここでは\u003ccode\u003e合計処理呼出処理\u003c/code\u003e)を作る\n\n\u003cul\u003e\n\u003cli\u003eメソッド名からIDを取得(GetIDsOfNames)\u003c/li\u003e\n\u003cli\u003eメソッドに渡すパラメータを作成(DISPPARAMS、VariantInitなど)\u003c/li\u003e\n\u003cli\u003e呼び出し実施(pIDisp-\u0026gt;Invoke)\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"仮想cライブラリを呼びたいcアプリ-の注意点\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BB%AE%E6%83%B3c%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%82%92%E5%91%BC%E3%81%B3%E3%81%9F%E3%81%84c%E3%82%A2%E3%83%97%E3%83%AA-%E3%81%AE%E6%B3%A8%E6%84%8F%E7%82%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e仮想[C#ライブラリを呼びたいC++アプリ] の注意点\u003c/h3\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"初期化処理について\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%88%9D%E6%9C%9F%E5%8C%96%E5%87%A6%E7%90%86%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e初期化処理について\u003c/h4\u003e\n\n\u003cp\u003e\u003ccode\u003eCLSIDFromProgID(L\"DllCsComWrapper.DllCsComWrapperClass\", \u0026amp;clsid);\u003c/code\u003eの一つ目の引数は、C#のラッパークラスの「\u0026lt;名前空間名\u0026gt;.\u0026lt;クラス名\u0026gt;」にすること。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"合計処理呼出処理について\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%90%88%E8%A8%88%E5%87%A6%E7%90%86%E5%91%BC%E5%87%BA%E5%87%A6%E7%90%86%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e合計処理呼出処理について\u003c/h4\u003e\n\n\u003cp\u003e\u003ccode\u003eOLECHAR *Func_Name[] = { SysAllocString (L\"Add\") };\u003c/code\u003eで定義する名前は、C#のラッパークラスの中の、呼びたいメソッド名にすること。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"型について\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%9E%8B%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e型について\u003c/h4\u003e\n\n\u003cp\u003e戻り値や引数をやり取りするときに、下記のような対応で型を決める必要がある。\u003cbr\u003e\n\u003ca href=\"https://knowledge.rinpress.com/index.php/%EF%BC%A3%EF%BC%8B%EF%BC%8B%E3%81%AE%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%81%8B%E3%82%89%EF%BC%A3%EF%BC%83%E3%81%AE%EF%BC%A4%EF%BC%AC%EF%BC%AC%E3%82%92%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B\" rel=\"nofollow noopener\" target=\"_blank\"\u003eこちら\u003c/a\u003eの表より。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/874476b8d65dfc3aef7715f7fab0ac88bb5d5e6c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335323630312f38366465363231612d303365332d323839642d323933362d6236373730396164666661312e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2F86de621a-03e3-289d-2936-b67709adffa1.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=3e6c027887ba32451047e427196058fb\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/352601/86de621a-03e3-289d-2936-b67709adffa1.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2F86de621a-03e3-289d-2936-b67709adffa1.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=f00360e00ad90e7109112793ce1185bd 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"regasmでdllを登録\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#regasm%E3%81%A7dll%E3%82%92%E7%99%BB%E9%8C%B2\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eregasmでdllを登録\u003c/h3\u003e\n\n\u003cp\u003eregasmを使用し、下記のコマンドで作成したラッパーDLLを登録する。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"bat\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003eregasm\u003c/span\u003e \u003cspan class=\"na\"\u003e/codebase \u003c/span\u003e\u003cspan class=\"kd\"\u003eDllCsComWrapper\u003c/span\u003e.dll\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e※regasmのありかは、下記の通り(環境による？)\u003cbr\u003e\n32bit版：C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\u003cbr\u003e\n64bit版：C:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\u003cbr\u003e\ndllのプラットフォーム(32or64bit)により、32/64bitのあったものを使用しないと、うまく登録できない。\u003c/p\u003e\n\n\u003cp\u003e今回は、ここからregasm.exeをコピーして、実行するConsoleApplication1.exeと同じ階層に置いた。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"作ったcアプリを実行\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BD%9C%E3%81%A3%E3%81%9Fc%E3%82%A2%E3%83%97%E3%83%AA%E3%82%92%E5%AE%9F%E8%A1%8C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e作ったC++アプリを実行\u003c/h3\u003e\n\n\u003cp\u003e下記のようなbatを\u003cstrong\u003e管理者権限で\u003c/strong\u003e実行し、作成したアプリを実行。\u003cbr\u003e\n(面倒だったので、ここではregasmも実行時に毎回実行している)\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"batchfile\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eexerun.bat\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e@echo \u003cspan class=\"na\"\u003eoff\u003c/span\u003e\n\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e \u003cspan class=\"vm\"\u003e%~dp0\u003c/span\u003e\n\u003cspan class=\"kd\"\u003eregasm\u003c/span\u003e \u003cspan class=\"na\"\u003e/codebase \u003c/span\u003e\u003cspan class=\"kd\"\u003eDllCsComWrapper\u003c/span\u003e.dll\n\u003cspan class=\"nb\"\u003estart\u003c/span\u003e \u003cspan class=\"na\"\u003e/wait \u003c/span\u003e\u003cspan class=\"kd\"\u003eConsoleApplication1\u003c/span\u003e\u003cspan class=\"err\"\u003e.exe\u003c/span\u003e\n\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"kd\"\u003eexe\u003c/span\u003eからの戻り値は \u003cspan class=\"nv\"\u003e%ERRORLEVEL%\u003c/span\u003e です\n\u003cspan class=\"nb\"\u003epause\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e※ここで毎回regasmするなら、上の方でやっていた「COM相互運用機能の登録」のチェックはいらないっぽい。(デバッグするうえではあった方が便利)\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"実行結果\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%9F%E8%A1%8C%E7%B5%90%E6%9E%9C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e実行結果\u003c/h3\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/0a43e952244a2080678b1c8c84de213cff0b30d6/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335323630312f61653366613730362d663863652d663031632d623934322d6232633137656134323438332e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2Fae3fa706-f8ce-f01c-b942-b2c17ea42483.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=3a8ca7d9d3c30f4980d7bc88ab500625\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/352601/ae3fa706-f8ce-f01c-b942-b2c17ea42483.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2Fae3fa706-f8ce-f01c-b942-b2c17ea42483.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=5d775c4cc5ce8d844a7623e34761f3ed 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"追記190523\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%BF%BD%E8%A8%98190523\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e追記(190523)\u003c/h1\u003e\n\n\u003cp\u003eC++からC#ラッパーに文字列を渡したいときは、下記のようにする。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eDllCsComWrapper.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eDllCs\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Runtime.InteropServices\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eDllCsComWrapper\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eComVisible\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eClassInterface\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eClassInterfaceType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAutoDual\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"85555B74-E2E0-4493-9869-3CE95F13CB99\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eDllCsComWrapperClass\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eInt32\u003c/span\u003e \u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e\u003cspan class=\"nf\"\u003eMarshalAs\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eUnmanagedType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBStr\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ★マーシャリングする！\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eInt32\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"m\"\u003e11\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e受け取る文字列を、マーシャリングすることが必要。\u003cbr\u003e\n※とりあえず文字列をラッパーに渡せることを見たいため、C#のライブラリを呼ぶ処理は割愛。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c++\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eConsoleApplication1.cpp\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003elong\u003c/span\u003e \u003cspan class=\"nf\"\u003e_Add\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003elong\u003c/span\u003e \u003cspan class=\"n\"\u003ep_Number1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003elong\u003c/span\u003e \u003cspan class=\"n\"\u003ep_Number2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//DISPIDの取得（関数名の設定）\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eDISPID\u003c/span\u003e \u003cspan class=\"n\"\u003edispid\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eOLECHAR\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eFunc_Name\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003eSysAllocString\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003eL\"Add\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eHRESULT\u003c/span\u003e \u003cspan class=\"n\"\u003eh_result\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003epIDisp\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eGetIDsOfNames\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIID_NULL\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eFunc_Name\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eLOCALE_SYSTEM_DEFAULT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003edispid\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eFAILED\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eh_result\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e//パラメータ作成\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eDISPPARAMS\u003c/span\u003e \u003cspan class=\"n\"\u003eparams\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ememset\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003eparams\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003esizeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDISPPARAMS\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003eparams\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecNamedArgs\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eparams\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ergdispidNamedArgs\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eparams\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecArgs\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e//呼び出す関数の引数の数\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e//引数設定\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eVARIANT\u003c/span\u003e \u003cspan class=\"n\"\u003evar\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eDISPPARAMS\u003c/span\u003e \u003cspan class=\"n\"\u003edispParams\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003evar\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evt\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eVT_BSTR\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"c1\"\u003e// ★渡すデータの種別をBSTRにする\u003c/span\u003e\n    \u003cspan class=\"n\"\u003evar\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ebstrVal\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eSysAllocString\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003eL\"mojiretsu\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\u003cspan class=\"c1\"\u003e// ★渡す文字列\u003c/span\u003e\n    \u003cspan class=\"n\"\u003edispParams\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecArgs\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003edispParams\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ergvarg\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003evar\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003edispParams\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecNamedArgs\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003edispParams\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ergdispidNamedArgs\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003eVARIANT\u003c/span\u003e \u003cspan class=\"n\"\u003evRet\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eVariantInit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003evRet\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e//呼び出し\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"[OK] Invoke start\u003c/span\u003e\u003cspan class=\"se\"\u003e\\r\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eh_result\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003epIDisp\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eInvoke\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edispid\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIID_NULL\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eLOCALE_SYSTEM_DEFAULT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eDISPATCH_METHOD\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003edispParams\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003evRet\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eFAILED\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eh_result\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"[NG] Invoke failed\u003c/span\u003e\u003cspan class=\"se\"\u003e\\r\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003evRet\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elVal\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"残項目\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%AE%8B%E9%A0%85%E7%9B%AE\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e残項目\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003eラッパーC#の属性に何があるかとその効果(ComVisibleとか)\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"コード\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B3%E3%83%BC%E3%83%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eコード\u003c/h1\u003e\n\n\u003cp\u003e\u003cqiita-embed-ogp src=\"https://github.com/tera1707/WPF-/tree/master/025_CallCsDllFromCpp\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"参考\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8F%82%E8%80%83\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e参考\u003c/h1\u003e\n\n\u003cp\u003eコードのサンプル\u003cbr\u003e\n\u003ca href=\"https://knowledge.rinpress.com/index.php/%EF%BC%A3%EF%BC%8B%EF%BC%8B%E3%81%AE%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%81%8B%E3%82%89%EF%BC%A3%EF%BC%83%E3%81%AE%EF%BC%A4%EF%BC%AC%EF%BC%AC%E3%82%92%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://knowledge.rinpress.com/index.php/%EF%BC%A3%EF%BC%8B%EF%BC%8B%E3%81%AE%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%81%8B%E3%82%89%EF%BC%A3%EF%BC%83%E3%81%AE%EF%BC%A4%EF%BC%AC%EF%BC%AC%E3%82%92%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eC++からC#を呼ぶいろんな方法\u003cbr\u003e\n\u003ca href=\"https://kagasu.hatenablog.com/entry/2017/12/31/220239#%E2%85%A1-CCLI%E3%82%92%E4%BD%BF%E3%81%86%E6%96%B9%E6%B3%95\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://kagasu.hatenablog.com/entry/2017/12/31/220239#%E2%85%A1-CCLI%E3%82%92%E4%BD%BF%E3%81%86%E6%96%B9%E6%B3%95\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eコードのサンプル2\u003cbr\u003e\n\u003ca href=\"https://azulean.me/2009/03/08/c%E3%81%A7com%E3%82%92%E4%BD%9C%E3%82%8B%EF%BC%88%E3%81%A8%E3%82%8A%E3%81%82%E3%81%88%E3%81%9A%E5%8B%95%E3%81%8F%E3%81%A8%E3%81%93%E3%82%8D%E3%81%BE%E3%81%A7%EF%BC%89/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://azulean.me/2009/03/08/c%E3%81%A7com%E3%82%92%E4%BD%9C%E3%82%8B%EF%BC%88%E3%81%A8%E3%82%8A%E3%81%82%E3%81%88%E3%81%9A%E5%8B%95%E3%81%8F%E3%81%A8%E3%81%93%E3%82%8D%E3%81%BE%E3%81%A7%EF%BC%89/\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eC++からC# DLL 超超超入門(3.の方法)\u003cbr\u003e\n\u003ca href=\"https://qiita.com/Midori_co583826/items/58d56e202f104ebf867a\" class=\"autolink\" id=\"reference-ff8e8fb566ae75fe5a02\"\u003ehttps://qiita.com/Midori_co583826/items/58d56e202f104ebf867a\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eGUIDの登録\u003cbr\u003e\n\u003ca href=\"http://tech.nitoyon.com/ja/blog/2008/07/31/c-sharp-com/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://tech.nitoyon.com/ja/blog/2008/07/31/c-sharp-com/\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eあまり参考にならなかったが、コードのサンプル\u003cbr\u003e\n\u003ca href=\"https://www.84kure.com/blog/2014/07/17/c-c%E3%81%8B%E3%82%89c%E3%81%AEdll%E3%82%92%E5%91%BC%E3%81%B6%E6%96%B9%E6%B3%95/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://www.84kure.com/blog/2014/07/17/c-c%E3%81%8B%E3%82%89c%E3%81%AEdll%E3%82%92%E5%91%BC%E3%81%B6%E6%96%B9%E6%B3%95/\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e文字列を渡すときのマーシャリング(BSTR ⇒ string)\u003cbr\u003e\n\u003ca href=\"https://docs.microsoft.com/ja-jp/dotnet/framework/interop/default-marshaling-for-strings\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://docs.microsoft.com/ja-jp/dotnet/framework/interop/default-marshaling-for-strings\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eCOMラッパーに文字列を渡したいときに参考にしたサンプル\u003cbr\u003e\n\u003ca href=\"https://www.acot.net/WMI/sample4.html\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://www.acot.net/WMI/sample4.html\u003c/a\u003e\u003c/p\u003e\n","createdAt":"2019-05-21T14:10:10Z","elapsedYearsFromLastModifiedAt":2,"encryptedId":"tp9TkLCPID3rGHPN6vBPha6AS5f+p+Po--kGkK9O3vpLpFEBan--oCBnbPVusUBaAkL4vAXANA==","isBanned":false,"isDeprecated":true,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2019-05-23T04:58:09Z","likesCount":6,"linkUrl":"https://qiita.com/tera1707/items/7e22812f27884d0e3c49","organization":null,"originalId":902877,"stockedCount":4,"title":"[C++/C#]C#をCOM参照可能にしてC+＋アプリから呼ぶ1","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%84%E3%82%8A%E3%81%9F%E3%81%84%E3%81%93%E3%81%A8\"\u003eやりたいこと\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E9%96%A2%E9%80%A3%E9%A0%85%E7%9B%AE%E7%9B%AE%E6%AC%A1\"\u003e関連項目目次\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%84%E3%82%8A%E6%96%B9%E5%80%99%E8%A3%9C\"\u003eやり方候補\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#todo\"\u003eToDo\u003c/a\u003e\n\u003cul\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%BB%AE%E6%83%B3%E3%81%99%E3%81%A7%E3%81%ABc%E3%81%A7%E4%BD%9C%E3%81%A3%E3%81%A6%E3%81%82%E3%82%8B%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA-%E3%82%92%E5%AE%9F%E8%A3%85\"\u003e仮想[すでにC#で作ってあるライブラリ] を実装\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%BB%AE%E6%83%B3%E3%81%99%E3%81%A7%E3%81%ABc%E3%81%A7%E4%BD%9C%E3%81%A3%E3%81%A6%E3%81%82%E3%82%8B%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%81%AEc%E3%81%AEcom%E3%83%A9%E3%83%83%E3%83%91%E3%83%BC-%E3%82%92%E5%AE%9F%E8%A3%85\"\u003e仮想[すでにC#で作ってあるライブラリのC#のCOMラッパー] を実装\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%BB%AE%E6%83%B3%E3%81%99%E3%81%A7%E3%81%ABc%E3%81%A7%E4%BD%9C%E3%81%A3%E3%81%A6%E3%81%82%E3%82%8B%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%81%AEc%E3%81%AEcom%E3%83%A9%E3%83%83%E3%83%91%E3%83%BC-%E3%81%AE%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E8%A8%AD%E5%AE%9A%E3%82%92%E3%81%99%E3%82%8B\"\u003e仮想[すでにC#で作ってあるライブラリのC#のCOMラッパー] のプロジェクト設定をする\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%BB%AE%E6%83%B3c%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%82%92%E5%91%BC%E3%81%B3%E3%81%9F%E3%81%84c%E3%82%A2%E3%83%97%E3%83%AA-%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B\"\u003e仮想[C#ライブラリを呼びたいC++アプリ] を実装する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%BB%AE%E6%83%B3c%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%82%92%E5%91%BC%E3%81%B3%E3%81%9F%E3%81%84c%E3%82%A2%E3%83%97%E3%83%AA-%E3%81%AE%E6%B3%A8%E6%84%8F%E7%82%B9\"\u003e仮想[C#ライブラリを呼びたいC++アプリ] の注意点\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%88%9D%E6%9C%9F%E5%8C%96%E5%87%A6%E7%90%86%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\"\u003e初期化処理について\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%90%88%E8%A8%88%E5%87%A6%E7%90%86%E5%91%BC%E5%87%BA%E5%87%A6%E7%90%86%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\"\u003e合計処理呼出処理について\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%9E%8B%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\"\u003e型について\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#regasm%E3%81%A7dll%E3%82%92%E7%99%BB%E9%8C%B2\"\u003eregasmでdllを登録\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%BD%9C%E3%81%A3%E3%81%9Fc%E3%82%A2%E3%83%97%E3%83%AA%E3%82%92%E5%AE%9F%E8%A1%8C\"\u003e作ったC++アプリを実行\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%AE%9F%E8%A1%8C%E7%B5%90%E6%9E%9C\"\u003e実行結果\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cli\u003e\n\u003ca href=\"#%E8%BF%BD%E8%A8%98190523\"\u003e追記(190523)\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%AE%8B%E9%A0%85%E7%9B%AE\"\u003e残項目\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B3%E3%83%BC%E3%83%89\"\u003eコード\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%8F%82%E8%80%83\"\u003e参考\u003c/a\u003e\n\u003c/li\u003e\n\n","totalPv":5007,"uuid":"7e22812f27884d0e3c49","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"/bWS3g0dq6SzGeTbOC8/KdZwuD6S--DmuKRfxR7hEXRz/3--aNPjpo3YFiNppes5EjM8hA==","originalId":352601,"description":"","facebookUrl":null,"githubUrl":"https://github.com/tera1707","isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"","profileImageUrl":"https://avatars0.githubusercontent.com/u/19180456?v=4","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Favatars0.githubusercontent.com%2Fu%2F19180456%3Fv%3D4?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=d374ef2a13106c43b12251ae9f724ca0","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Favatars0.githubusercontent.com%2Fu%2F19180456%3Fv%3D4?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=1ddd4d18cb0c4d9ee77ed7cff93f4ae1","urlName":"tera1707","websiteUrl":"","twitterUrl":null,"twitterUrlName":null,"revealedOrganizations":{"edges":[]}},"tags":[{"name":"C++","urlName":"cpp"},{"name":"C#","urlName":"csharp"},{"name":"COM","urlName":"com"},{"name":"dll","urlName":"dll"}],"followingLikers":{"edges":[]},"comments":{"totalCount":0}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

More than 3 years have passed since last update.私はWPFアプリを書く際、Messengerパターンの構築にPrismのEventAggregatorを使用するのですが、ちょっとハマったので共有します。以下のコードは、私の環境ではうまく動作しません。（Prism.Core以外に、ReactivePropertyを使用しています。）・ViewModel・Viewのコードビハインド・View実行後、ボタンを押下してもメッセージが表示されません。知識不足により私には詳しく分からないのですが、ポイントはViewのコードビハインドに記述されたこの部分です。ここのコールバックのラムダ式がガベージコレクションにより回収されてしまいます。
その理由は、PrismのEventAggregatorがコールバックを弱参照しているからです。
これにより、イベント購読側でメモリリークは起きなくなりますが、上述のようなコードを書くと早すぎる回収が発生してしまうようです。
（ローカル変数helloではなく、文字列を直接指定すると正しく動作しました。ラムダ式の変数束縛に関係があるのでしょうか？）対策は簡単です。上記のようにPubSubEvent.Subscribe()の第2引数にtrueを指定することにより、コールバックを強参照させることができます。
メモリリークには充分注意しましょう。PrismのEventAggregatorはコールバックを弱参照することを頭の片隅に覚えておきましょう。
以上です。



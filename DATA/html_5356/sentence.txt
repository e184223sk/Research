More than 3 years have passed since last update.ミニゲームを作ってUnityを学ぶ！[3Dマインスイーパー編]前回は通常ブロックと爆弾ブロックを並べたフィールドを作成し、カメラがフィールドの中心を向くような実装を行いました。今回はプレイヤーの入力によってブロックを開けたりマーカーをつけたりといった、ブロックを操作する仕組みを実装していきます。まずはプレイヤーの入力を受け取れるようにSceneMainとBlockManagerを修正します。1: BlockManagerをインスペクタから設定これでプレイヤーの左クリックと右クリックを受け取ることができるようになりました。
続いてクリックに対応したアクションを実装していきます。右クリックでブロックにマーカーをつける機能を実装します。右クリックのタイミングでカメラの位置からマウスポインタの置かれた位置に向かって画面奥へ進むRayを飛ばし、Rayが接触したオブジェクトがブロックだった場合にはクリックの対象になったBlockModelのChangeCheckFlg()を呼び出しています。参考： Unityのレイキャストとは何ぞや？そして呼び出されたBlockModel#ChangeCheckFlg()の内容がこちら。対象になったブロックがまだ開かれていない場合はプロパティのIsCheckを反転させ、その結果によってUVマップを変更することでブロックの上面にチェックマークを表示したり消したりしています。続いて、左クリックでブロックを開ける機能を実装します。少しわかりづらいので1つずつ確認していきますが、今回の追記部分にはLINQやラムダ式、匿名メソッドといった要素が含まれていますので、もしつまづいてしまった場合は以下の紹介記事を参考にしてみてください。参考： 【LINQの前に】ラムダ式？デリゲート？Func？な人へのまとめ左クリックの入力を受け取ると、右クリックのときと同じようにRayを飛ばして対象になるブロックオブジェクトを取得します。対象を取得できた場合はそのブロックに爆弾が設置されているかの判定を行い、通常のブロックだった場合にOpenBlock()を実行します。もしも爆弾ブロックを左クリックしている場合はそこにマーカーが付いているかの判定を行い、マーカーが付いていない場合はゲームオーバー（今はコメントアウト）となります。フィールド内のxy座標を引数に渡すことで該当ポジションに存在するBlockModelをListから取得して返します。フィールド内のxy座標を引数に渡すことでその周囲1マス内にあるBlockModelを新しく生成したListに格納して返します。引数に与えられた対象のブロックがまだ開かれていなく、マーカーもつけられていない場合にBlockModel#Open()を呼び出しています。BlockModel#Open()を呼び出す際には周囲1マスに設置されている爆弾の数を引数に与えることで対象ブロックの上面に適切なテクスチャを表示していますが、このとき周囲に爆弾が1つも設置されていない場合は周囲のブロックを対象にして再度BlockManager#OpenBlock()を実行します。これによって爆弾が無いエリアのブロックが連鎖的に開いていくことになります。以上でブロックの操作が完成しました。
まだゲームクリアやゲームオーバーの概念がなく爆弾ブロックを開くこともできませんが、プロジェクトを実行することでマインスイーパーのようなものが出来上がっていることが確認できます。次のページに進む
イントロダクションに戻る




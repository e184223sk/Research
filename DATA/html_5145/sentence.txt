More than 3 years have passed since last update.本当にチートシート。以下の設定を行えばOK。Visual Studio 2017でASP.NET Coreアプリケーションのプロジェクトを作成すると、どのアプリケーション形式を選択してもMicrosoft.AspNetCore.Allをいうパッケージを参照したプロジェクトが作成されます。このMicrosoft.AspNetCore.Allパッケージは結構な量のパッケージをまとめたメタパッケージで、確かにこれを参照すればASP.NET Coreを使用したWebアプリケーションを開発するために必要なものが入っているのですが、場合によっては不要なパッケージの参照も含まれているため一部の人にとっては嬉しくないパッケージになっています。また、デフォルトで作成された構成設定のソースコードもブラックボックス化されており、本当に必要な構成だけが設定されているのかどうかわかりにくくなっています。私も余計な参照設定は極力なくして開発をするため、このMicrosoft.AspNetCore.Allに依存せずに必要最低限なパッケージ参照と構成設定で開発を始めるためのメモとして残しておきます。以降は最小構成の設定から徐々に機能を追加していくように記述してあります。KestrelというASP.NET Coreが内包しているWebサーバーを使用して、単純にHTTPリクエストを受け付けてHTTPレスポンスを返すASP.NET Coreアプリケーションを構築します。
恐らくこの構成がASP.NET Coreアプリケーションの一番小さい構成になると思います。まずはcsprojファイルを開いてMicrosoft.AspNetCore.Allのパッケージを削除し、Microsoft.AspNetCore.Server.Kestrelパッケージを追加します。次にProgram.csを開いて、以下のようにコードを書き直します。最後にStartup.csを開いて、コードを以下のように書き直します。ここまで書き直したら、アプリケーションを起動してみましょう。サーバーが立ち上がってWebブラウザで既定のURLにアクセスすると以下のように表示されると思います。ちなみにProgram.csで以下のように記述すればStartup.csを用意しなくても済みます。KestrelのみのWebサーバーだと複数のURLを扱うのに手間がかかるので、次はASP.NET Core MVCを使用したWeb APIサーバーを構築します。
これを使えばURLルーティング機能の付いたWeb APIサーバーの構築が出来ます。(実際にはもっと色んな機能が付いてきますが。)csprojファイルを開いてMicrosoft.AspNetCore.Mvc.Coreパッケージを追加します。次にStartup.csを以下のように修正します。最後にコントローラを追加します。今回はValueController.csをいうファイル名にしてプロジェクトディレクトリに作成したControllersフォルダに配置しましょう。(プロジェクトディレクトリ直下に配置しても構わないんですが後々のメンテナビリティのためにフォルダを切っておくことをオススメします。)これでアプリケーションを実行して、/Value/Indexにアクセスしてみると以下のように表示されます。今度は画面のあるWebアプリケーションを構築します。csprojファイルでMicrosoft.AspNetCore.Mvc.Coreパッケージの参照を削除し、Microsoft.AspNetCore.Mvcパッケージの参照を追加します。次にStartup.csを以下のように修正します。コントローラとビューを追加します。コントローラはさっき作成したControllersフォルダ内にコントローラのcsファイルを配置し、ビューは新しくViewフォルダを作成して更にその下にコントローラ名と同じフォルダを作成し、アクション名がファイル名となるようにcshtmlファイルを配置します。今回はコントローラをHomeController.cs、ビューをIndex.cshtmlとします。このまま実行して該当のURLにアクセスしても何も表示されません。
というのもASP.NET Core MVCはビューのファイルをプロジェクトディレクトリを基点として/Views/[コントローラ名]/[アクション名].cshtmlで探しに行くため、プロジェクトディレクトリを明示的に設定する必要があるようです。
プロジェクトディレクトリの設定はProgram.csで行います。Program.csファイルを以下のように修正します。これでアプリケーションを実行して、/Home/Indexにアクセスしてみると以下のように表示されます。先頭のTL;DRにまとまってます。



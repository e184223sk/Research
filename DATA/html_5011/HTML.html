<!DOCTYPE html><html><head><meta charset="utf-8" /><title>ひつじコレクション - 9. ゲームの開始と終了 - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/YzRoid/items/ffffffb5f1511e846cbd" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="gZ6Icqd3d2QpqZCpYPCvPWyLkto7xh4/CUX498leerY9weNkVFu4Uh6WGt7IUfk3oADSz/15luwr9xw7pKcRuA==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta property="og:type" content="article"><meta property="og:title" content="ひつじコレクション - 9. ゲームの開始と終了 - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND00NEd5NDRHazQ0R1k0NEt6NDRPczQ0S3Y0NEszNDRPbjQ0T3pJQzBnT1M0ZzQ0S3k0NE84NDRPZzQ0R3U2WmFMNWFlTDQ0R281N1dDNUxxRyZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTU0JnR4dC1jbGlwPWVsbGlwc2lzJnR4dC1hbGlnbj1jZW50ZXIlMkNtaWRkbGUmcz00ZjJlYWY5OTU3M2EwZDYwMDkxMWIxNjQxZTk4OTQ0MA&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RRmw2VW05cFpBJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NDUmdHh0LWFsaWduPXJpZ2h0JTJDYm90dG9tJnM9NTBjMTUyNzQzNWE1MWIwYzgzNjA4YTZkYTMxOGE2ZTk&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=a5b5ab82b86027c54629c6d0ae17a11f"><meta property="og:description" content="ミニゲームを作ってUnityを学ぶ！[ひつじコレクション編]


第9回目: ゲームの開始と終了


前回はサクサクっと画面内にミニマップを表示する機能を実装しました。
次はひと通り遊べるようになったひつじコレクションについて、ゲーム..."><meta content="https://qiita.com/YzRoid/items/ffffffb5f1511e846cbd" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#,game,Unity,Unity入門" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 1nzh4zz 38fzdi helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-1nzh4zz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:16px 32px;background-color:#FBE69E;color:rgba(0,0,0,0.87);line-height:1.5;font-weight:600;}@media (max-width:770px){.css-1nzh4zz{padding:16px;}}.css-38fzdi{color:#CA832A;margin-right:4px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-46374fbe-df03-42ff-96c4-fd21f12615d1"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2FYzRoid%2Fitems%2Fffffffb5f1511e846cbd">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2FYzRoid%2Fitems%2Fffffffb5f1511e846cbd">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-46374fbe-df03-42ff-96c4-fd21f12615d1">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2018-06-09T16:14:10.000+09:00","dateModified":"2018-06-12T09:59:09.000+09:00","headline":"ひつじコレクション - 9. ゲームの開始と終了","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND00NEd5NDRHazQ0R1k0NEt6NDRPczQ0S3Y0NEszNDRPbjQ0T3pJQzBnT1M0ZzQ0S3k0NE84NDRPZzQ0R3U2WmFMNWFlTDQ0R281N1dDNUxxRyZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTU0JnR4dC1jbGlwPWVsbGlwc2lzJnR4dC1hbGlnbj1jZW50ZXIlMkNtaWRkbGUmcz00ZjJlYWY5OTU3M2EwZDYwMDkxMWIxNjQxZTk4OTQ0MA\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RRmw2VW05cFpBJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NDUmdHh0LWFsaWduPXJpZ2h0JTJDYm90dG9tJnM9NTBjMTUyNzQzNWE1MWIwYzgzNjA4YTZkYTMxOGE2ZTk\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=a5b5ab82b86027c54629c6d0ae17a11f","mainEntityOfPage":"https://qiita.com/YzRoid/items/ffffffb5f1511e846cbd","author":{"@type":"Person","address":"","email":null,"identifier":"YzRoid","name":"YzRoid","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F239877%2Fprofile-images%2F1519195494?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=2fcbd90d54d7bc05cc2fbb8b49f9a2ea","url":"https://qiita.com/YzRoid","description":"JavaでAndroid用アプリ作ったりしてます。\r\nただいまUnity勉強中！","memberOf":[]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://increments.connpass.com/event/211948/">【9/9(木)開催】Qiitaの過去と未来についてお話しします！Qiita エンジニアフェスタ 2021 Online Meetup</a><a target="_blank" id="header_text_message_2" href="https://increments.connpass.com/event/211948/">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"YzRoid","type":"items","id":"ffffffb5f1511e846cbd"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"【9/9(木)開催】Qiitaの過去と未来についてお話しします！Qiita エンジニアフェスタ 2021 Online Meetup","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"YzRoid","type":"items","id":"ffffffb5f1511e846cbd"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":2,"pos_id":"header_text_message_1","message":"【9/9(木)開催】Qiitaの過去と未来についてお話しします！Qiita エンジニアフェスタ 2021 Online Meetup","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"YzRoid","type":"items","id":"ffffffb5f1511e846cbd"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":2,"pos_id":"header_text_message_2","message":"【9/9(木)開催】Qiitaの過去と未来についてお話しします！Qiita エンジニアフェスタ 2021 Online Meetup","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/YzRoid/items/ffffffb5f1511e846cbd","location":"/YzRoid/items/ffffffb5f1511e846cbd","scheme":"https","host":"qiita.com","port":null,"pathname":"/YzRoid/items/ffffffb5f1511e846cbd","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"MlZdE6KqixSmWiKLhvALsRbDMyo3JyRZQtDzkk4EpOmOCTYFUYZEIpFlqPwuUV272khzP/GYrIpgYhdeI/3P5w==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-d7821c35-c829-4862-864d-52dfc4f943a4"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/YzRoid/items/ffffffb5f1511e846cbd/likers" class="css-1iupg5d">0</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">1</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/ffffffb5f1511e846cbd/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/YzRoid/items/ffffffb5f1511e846cbd/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/YzRoid/items/ffffffb5f1511e846cbd/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/YzRoid/items/ffffffb5f1511e846cbd/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/YzRoid/items/ffffffb5f1511e846cbd.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-1nzh4zz"><span class="fa fa-fw fa-warning css-38fzdi"></span><p>More than 3 years have passed since last update.</p></div><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/YzRoid"><img class="css-100alwu eyfquo10" src="https://qiita-image-store.s3.amazonaws.com/0/239877/profile-images/1519195494" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/YzRoid" class="css-10ougpm">@<!-- -->YzRoid</a><div class="css-1ay9vb9"><span><meta content="2018-06-09T07:14:10Z"/><time dateTime="2018-06-12T00:59:09Z" class="css-m19uds">updated at 2018-06-12</time></span></div></div></div></div></div><h1 class="css-cgzq40">ひつじコレクション - 9. ゲームの開始と終了</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/game" class="css-4czcte">game</a><a href="/tags/unity" class="css-4czcte">Unity</a><a href="/tags/unity%e5%85%a5%e9%96%80" class="css-4czcte">Unity入門</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div><p><a href="https://qiita.com/YzRoid/items/8dfd6c168b916ac82a0d" id="reference-7e9103d5e19272acaf94">ミニゲームを作ってUnityを学ぶ！[ひつじコレクション編]</a></p>

<h3>
<span id="第9回目-ゲームの開始と終了" class="fragment"></span><a href="#%E7%AC%AC9%E5%9B%9E%E7%9B%AE-%E3%82%B2%E3%83%BC%E3%83%A0%E3%81%AE%E9%96%8B%E5%A7%8B%E3%81%A8%E7%B5%82%E4%BA%86"><i class="fa fa-link"></i></a><strong>第9回目: ゲームの開始と終了</strong>
</h3>

<p>前回はサクサクっと画面内にミニマップを表示する機能を実装しました。<br>
次はひと通り遊べるようになったひつじコレクションについて、ゲームとしての開始と終わりの概念を実装します。</p>

<p>今回の実装はゲームとしての見栄えに大きな変化はありませんが、オンラインランキングを実装する際など後々重要な仕組みになります。</p>

<h1>
<span id="シーンを制御する" class="fragment"></span><a href="#%E3%82%B7%E3%83%BC%E3%83%B3%E3%82%92%E5%88%B6%E5%BE%A1%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>シーンを制御する</h1>

<p>一般的なUnityのプロジェクトは例えばタイトル画面のシーン、実際にプレイするシーン、結果表示のシーンなど複数のシーンから構成されていて、それらを適切なタイミングで切り替えることでゲームとしての開始や終了を表現しています。</p>

<p>一方で今回のひつじコレクションのように1つのシーンで成り立ってしまう小規模なゲームの場合は、この開始と終了を<strong>シーン内の状態を制御する</strong>ことで表現します。</p>

<ul>
<li>ゼロポジションに「SceneMain」という名前の空オブジェクトを配置</li>
<li>同じく「SceneMain」という名前のスクリプトを作成し、それをSceneMainオブジェクトにアタッチ</li>
</ul>

<div class="code-frame" data-lang="cs">
<div class="code-lang"><span class="bold">SceneMain.cs</span></div>
<div class="highlight"><pre class="with-code"><code>
<span class="k">using</span> <span class="nn">System.Collections</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">SceneMain</span> <span class="p">:</span> <span class="n">MonoBehaviour</span>
    <span class="p">{</span>

        <span class="k">private</span> <span class="n">GameController</span> <span class="n">mGame</span><span class="p">;</span>

        <span class="k">void</span> <span class="nf">Awake</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">mGame</span> <span class="p">=</span> <span class="n">GameController</span><span class="p">.</span><span class="n">Instance</span><span class="p">;</span>
            <span class="n">mGame</span><span class="p">.</span><span class="nf">Init</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="c1">//--------</span>
        <span class="c1">// 状態 //</span>
        <span class="c1">//---------------------------------------------------------------------------------</span>

        <span class="k">private</span> <span class="k">enum</span> <span class="n">STATE</span>
        <span class="p">{</span>
            <span class="n">LOAD_STAGE</span><span class="p">,</span>
            <span class="n">PLAY</span><span class="p">,</span>
            <span class="n">GAME_OVER</span>
        <span class="p">}</span>
        <span class="k">private</span> <span class="n">STATE</span> <span class="n">mState</span> <span class="p">=</span> <span class="n">STATE</span><span class="p">.</span><span class="n">LOAD_STAGE</span><span class="p">;</span>

        <span class="c1">//--------</span>
        <span class="c1">// 更新 //</span>
        <span class="c1">//---------------------------------------------------------------------------------</span>

        <span class="k">void</span> <span class="nf">Update</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">switch</span> <span class="p">(</span><span class="n">mState</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="c1">// ステージの生成</span>
                <span class="k">case</span> <span class="n">STATE</span><span class="p">.</span><span class="n">LOAD_STAGE</span><span class="p">:</span>
                    <span class="n">mGame</span><span class="p">.</span><span class="n">StageManager</span><span class="p">.</span><span class="nf">LoadStage</span><span class="p">(</span><span class="m">1</span><span class="p">);</span>
                    <span class="n">mState</span> <span class="p">=</span> <span class="n">STATE</span><span class="p">.</span><span class="n">PLAY</span><span class="p">;</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="c1">// プレイ中</span>
                <span class="k">case</span> <span class="n">STATE</span><span class="p">.</span><span class="n">PLAY</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">mGame</span><span class="p">.</span><span class="n">IsGameOver</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="n">mState</span> <span class="p">=</span> <span class="n">STATE</span><span class="p">.</span><span class="n">GAME_OVER</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

</code></pre></div>
</div>

<p>プロジェクト開始時にステージをファイルから生成してPLAY状態へ遷移。<br>
GameControllerのプロパティ<strong>「IsGameOver」</strong>がtrueになったタイミングでGAME_OVER状態へ遷移。<br>
このように適切なタイミングでシーンの状態「mState」を変更することによってUpdate()の処理を切り替えています。</p>

<p>また併せてGameControllerとStageManagerについて、SceneMainに対応するための修正を行います。</p>

<ul>
<li>SceneMain#Awake()でGameControllerの初期化を行うため、StageManagerの該当部分を修正</li>
</ul>

<div class="code-frame" data-lang="cs">
<div class="code-lang"><span class="bold">StageManager.cs</span></div>
<div class="highlight"><pre class="with-code"><code>
    <span class="k">void</span> <span class="nf">Start</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">GameController</span> <span class="n">game</span> <span class="p">=</span> <span class="n">GameController</span><span class="p">.</span><span class="n">Instance</span><span class="p">;</span>
        <span class="n">game</span><span class="p">.</span><span class="nf">Init</span><span class="p">();</span>
        <span class="n">game</span><span class="p">.</span><span class="n">StageManager</span> <span class="p">=</span> <span class="k">this</span><span class="p">;</span>

        <span class="n">mConstructor</span> <span class="p">=</span> <span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">StageConstructor</span><span class="p">&gt;();</span>
        <span class="nf">LoadStage</span><span class="p">(</span><span class="m">1</span><span class="p">);</span>

        <span class="nf">StartCoroutine</span><span class="p">(</span><span class="s">"PopupFollower"</span><span class="p">);</span>
    <span class="p">}</span>

<span class="err">↓以下のように修正</span>

    <span class="k">void</span> <span class="nf">Start</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">GameController</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="n">StageManager</span> <span class="p">=</span> <span class="k">this</span><span class="p">;</span>
        <span class="n">mConstructor</span> <span class="p">=</span> <span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">StageConstructor</span><span class="p">&gt;();</span>

        <span class="nf">StartCoroutine</span><span class="p">(</span><span class="s">"PopupFollower"</span><span class="p">);</span>
    <span class="p">}</span>

</code></pre></div>
</div>

<ul>
<li>GameControllerを修正</li>
</ul>

<div class="code-frame" data-lang="cs">
<div class="code-lang"><span class="bold">GameController.cs</span></div>
<div class="highlight"><pre class="with-code"><code>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">Init</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">Application</span><span class="p">.</span><span class="n">targetFrameRate</span> <span class="p">=</span> <span class="m">30</span><span class="p">;</span>
            <span class="n">Scorer</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Scorer</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="c1">//----------</span>
        <span class="c1">// フラグ //</span>
        <span class="c1">//---------------------------------------------------------------------------------</span>

        <span class="k">public</span> <span class="kt">bool</span> <span class="n">IsGameOver</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

</code></pre></div>
</div>

<p>GameControllerにはゲームオーバーに関するフラグを追加し、Init()ですっかり忘れていたフレームレートの設定を行いました。<br>
これ以降、各スクリプトのUpdate()は1秒間に30回の頻度で呼び出されるようになります。</p>

<h1>
<span id="enterキーでゲームを開始する" class="fragment"></span><a href="#enter%E3%82%AD%E3%83%BC%E3%81%A7%E3%82%B2%E3%83%BC%E3%83%A0%E3%82%92%E9%96%8B%E5%A7%8B%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>Enterキーでゲームを開始する</h1>

<p>今まではプロジェクトを実行した瞬間から操作可能な、いわゆるゲームが始まっている状態でしたが、この開始方法をプレイヤーが自分のタイミングで決定できるように修正していきます。</p>

<h3>
<span id="playerオブジェクトユニティちゃんの制御" class="fragment"></span><a href="#player%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%83%A6%E3%83%8B%E3%83%86%E3%82%A3%E3%81%A1%E3%82%83%E3%82%93%E3%81%AE%E5%88%B6%E5%BE%A1"><i class="fa fa-link"></i></a>Playerオブジェクト（ユニティちゃん）の制御</h3>

<p>まずはユニティちゃんについて、プロジェクト開始時点ではプレイヤーの操作入力を受け付けない状態にします。</p>

<ul>
<li>PlayerActionを修正</li>
</ul>

<div class="code-frame" data-lang="cs">
<div class="code-lang"><span class="bold">PlayerAction.cs</span></div>
<div class="highlight"><pre class="with-code"><code>
        <span class="k">void</span> <span class="nf">Start</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">mTrans</span> <span class="p">=</span> <span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">Transform</span><span class="p">&gt;();</span>
            <span class="n">mRigid</span> <span class="p">=</span> <span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">Rigidbody</span><span class="p">&gt;();</span>
            <span class="n">mAnim</span> <span class="p">=</span> <span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">PlayerAnimation</span><span class="p">&gt;();</span>
<span class="err">修正</span>        <span class="n">State</span> <span class="p">=</span> <span class="n">STATE</span><span class="p">.</span><span class="n">DEFAULT</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">OnIdle</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">State</span> <span class="p">=</span> <span class="n">STATE</span><span class="p">.</span><span class="n">IDLE</span><span class="p">;</span>
        <span class="p">}</span>

</code></pre></div>
</div>

<ul>
<li>StageConstructorにメソッドを追加</li>
</ul>

<div class="code-frame" data-lang="cs">
<div class="code-lang"><span class="bold">StageConstructor.cs</span></div>
<div class="highlight"><pre class="with-code"><code>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">OnActivePlayer</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">Player</span><span class="p">.</span><span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">PlayerAction</span><span class="p">&gt;().</span><span class="nf">OnIdle</span><span class="p">();</span>
        <span class="p">}</span>

</code></pre></div>
</div>

<p>初期状態のStateをIDLEからDEFAULTに変更し、新しくOnIdle()を追加しました。<br>
これによってユニティちゃんはStageConstructor#OnActivePlayer()が実行されるまでプレイヤーの操作入力を受け付けない状態になります。</p>

<h3>
<span id="チェイサーの制御" class="fragment"></span><a href="#%E3%83%81%E3%82%A7%E3%82%A4%E3%82%B5%E3%83%BC%E3%81%AE%E5%88%B6%E5%BE%A1"><i class="fa fa-link"></i></a>チェイサーの制御</h3>

<p>敵キャラクターについても同様に、プロジェクト開始時点ではAI行動を無効にしてその場に待機させます。</p>

<ul>
<li>ChaserModelを修正</li>
</ul>

<div class="code-frame" data-lang="cs">
<div class="code-lang"><span class="bold">ChaserModel.cs</span></div>
<div class="highlight"><pre class="with-code"><code>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">Init</span><span class="p">(</span><span class="kt">float</span> <span class="n">speed</span><span class="p">,</span> <span class="kt">float</span> <span class="n">incSpeed</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">mSpeed</span> <span class="p">=</span> <span class="n">speed</span><span class="p">;</span>
            <span class="n">mIncSpeed</span> <span class="p">=</span> <span class="n">incSpeed</span><span class="p">;</span>
            <span class="n">mAi</span><span class="p">.</span><span class="nf">ApplySpeed</span><span class="p">(</span><span class="n">mSpeed</span><span class="p">);</span>

<span class="err">ここを削除</span>  <span class="n">IsActive</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
        <span class="p">}</span>

</code></pre></div>
</div>

<ul>
<li>StageConstructorにメソッドを追加</li>
</ul>

<div class="code-frame" data-lang="cs">
<div class="code-lang"><span class="bold">StageConstructor.cs</span></div>
<div class="highlight"><pre class="with-code"><code>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">OnActiveChaser</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="n">ChaserModel</span> <span class="n">model</span> <span class="k">in</span> <span class="n">mChaserList</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">model</span><span class="p">.</span><span class="n">IsActive</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">OffActiveChaser</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="n">ChaserModel</span> <span class="n">model</span> <span class="k">in</span> <span class="n">mChaserList</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">model</span><span class="p">.</span><span class="n">gameObject</span><span class="p">.</span><span class="nf">SetActive</span><span class="p">(</span><span class="k">false</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

</code></pre></div>
</div>

<p>敵キャラクターはStageConstructorのOnActiveChaser()が実行されるまでAIによる移動を行わずその場に待機します。<br>
また同時に、全てのChaser~オブジェクトを非アクティブにするためのメソッド、OffActiveChaser()を追加しています。</p>

<h3>
<span id="ポップアップの制御" class="fragment"></span><a href="#%E3%83%9D%E3%83%83%E3%83%97%E3%82%A2%E3%83%83%E3%83%97%E3%81%AE%E5%88%B6%E5%BE%A1"><i class="fa fa-link"></i></a>ポップアップの制御</h3>

<p>さらにフォロワーのポップアップについて、こちらもプロジェクト開始時点ではポップアップさせるかどうかの判定を行わないようにします。</p>

<ul>
<li>StageManagerを修正</li>
</ul>

<div class="code-frame" data-lang="cs">
<div class="code-lang"><span class="bold">StageManager.cs</span></div>
<div class="highlight"><pre class="with-code"><code>
        <span class="k">void</span> <span class="nf">Start</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">GameController</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="n">StageManager</span> <span class="p">=</span> <span class="k">this</span><span class="p">;</span>
            <span class="n">mConstructor</span> <span class="p">=</span> <span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">StageConstructor</span><span class="p">&gt;();</span>

<span class="err">ここを削除</span>  <span class="nf">StartCoroutine</span><span class="p">(</span><span class="s">"PopupFollower"</span><span class="p">);</span>
        <span class="p">}</span>

</code></pre></div>
</div>

<h3>
<span id="ゲーム開始時の初期化" class="fragment"></span><a href="#%E3%82%B2%E3%83%BC%E3%83%A0%E9%96%8B%E5%A7%8B%E6%99%82%E3%81%AE%E5%88%9D%E6%9C%9F%E5%8C%96"><i class="fa fa-link"></i></a>ゲーム開始時の初期化</h3>

<p>上記のユニティちゃん、敵キャラクター、ポップアップそれぞれに対応するため、StageManagerにゲーム開始時の初期化メソッドを追加します。</p>

<ul>
<li>StageManagerにメソッドを追加</li>
</ul>

<div class="code-frame" data-lang="cs">
<div class="code-lang"><span class="bold">StageManager.cs</span></div>
<div class="highlight"><pre class="with-code"><code>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">StartGame</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="c1">// プレイヤーとチェイサーの行動開始</span>
            <span class="n">mConstructor</span><span class="p">.</span><span class="nf">OnActivePlayer</span><span class="p">();</span>
            <span class="n">mConstructor</span><span class="p">.</span><span class="nf">OnActiveChaser</span><span class="p">();</span>

            <span class="c1">// コルーチンを開始</span>
            <span class="nf">StartCoroutine</span><span class="p">(</span><span class="s">"PopupFollower"</span><span class="p">);</span>
        <span class="p">}</span>

</code></pre></div>
</div>

<h3>
<span id="enterキーを受け付ける" class="fragment"></span><a href="#enter%E3%82%AD%E3%83%BC%E3%82%92%E5%8F%97%E3%81%91%E4%BB%98%E3%81%91%E3%82%8B"><i class="fa fa-link"></i></a>Enterキーを受け付ける</h3>

<p>最後に、SeneMainにEnterキーの入力を監視する仕組みを実装します。</p>

<ul>
<li>SceneMainを修正</li>
</ul>

<div class="code-frame" data-lang="cs">
<div class="code-lang"><span class="bold">SceneMain.cs</span></div>
<div class="highlight"><pre class="with-code"><code>
        <span class="k">private</span> <span class="k">enum</span> <span class="n">STATE</span>
        <span class="p">{</span>
            <span class="n">LOAD_STAGE</span><span class="p">,</span>
<span class="err">追加</span>        <span class="n">WAIT_ENTER_KEY</span><span class="p">,</span>
            <span class="n">PLAY</span><span class="p">,</span>
            <span class="n">GAME_OVER</span>
        <span class="p">}</span>

        <span class="k">void</span> <span class="nf">Update</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">switch</span> <span class="p">(</span><span class="n">mState</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="c1">// ステージの生成</span>
                <span class="k">case</span> <span class="n">STATE</span><span class="p">.</span><span class="n">LOAD_STAGE</span><span class="p">:</span>
                    <span class="n">mGame</span><span class="p">.</span><span class="n">StageManager</span><span class="p">.</span><span class="nf">LoadStage</span><span class="p">(</span><span class="m">1</span><span class="p">);</span>
<span class="err">修正</span>                <span class="n">mState</span> <span class="p">=</span> <span class="n">STATE</span><span class="p">.</span><span class="n">WAIT_ENTER_KEY</span><span class="p">;</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="c1">// Enter入力でゲームを開始</span>
<span class="err">追加</span>            <span class="k">case</span> <span class="n">STATE</span><span class="p">.</span><span class="n">WAIT_ENTER_KEY</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nf">WaitEnter</span><span class="p">())</span>
                    <span class="p">{</span>
                        <span class="n">mGame</span><span class="p">.</span><span class="n">StageManager</span><span class="p">.</span><span class="nf">StartGame</span><span class="p">();</span>
                        <span class="n">mState</span> <span class="p">=</span> <span class="n">STATE</span><span class="p">.</span><span class="n">PLAY</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="c1">// プレイ中</span>
                <span class="k">case</span> <span class="n">STATE</span><span class="p">.</span><span class="n">PLAY</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">mGame</span><span class="p">.</span><span class="n">IsGameOver</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="n">mState</span> <span class="p">=</span> <span class="n">STATE</span><span class="p">.</span><span class="n">GAME_OVER</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">//--------</span>
        <span class="c1">// 入力 //</span>
        <span class="c1">//---------------------------------------------------------------------------------</span>

        <span class="k">private</span> <span class="kt">bool</span> <span class="nf">WaitEnter</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">Input</span><span class="p">.</span><span class="nf">GetKeyDown</span><span class="p">(</span><span class="n">KeyCode</span><span class="p">.</span><span class="n">Return</span><span class="p">))</span> <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
            <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
        <span class="p">}</span>

</code></pre></div>
</div>

<p>以上でEnterキーによってゲームを開始する仕組みが完成しました。</p>

<p><a href="https://camo.qiitausercontent.com/15922db3e5c98e6ed672401d7291b793d08e56f3/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3233393837372f33303838663331332d303666332d393563382d313161332d3131663235393732323337382e6a706567" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F239877%2F3088f313-06f3-95c8-11a3-11f259722378.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=8d8823e8794c9429eb793f2ec71bb3fc" alt="action_sheep_ss_9_1.jpg" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/239877/3088f313-06f3-95c8-11a3-11f259722378.jpeg" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F239877%2F3088f313-06f3-95c8-11a3-11f259722378.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=98d9642b81c4d448ccf56894dfe50d9b 1x" loading="lazy"></a></p>

<p>プロジェクトを実行後、Enterキーを押すことでゲームが開始します。</p>

<h1>
<span id="ゲームの終了処理を実装" class="fragment"></span><a href="#%E3%82%B2%E3%83%BC%E3%83%A0%E3%81%AE%E7%B5%82%E4%BA%86%E5%87%A6%E7%90%86%E3%82%92%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>ゲームの終了処理を実装</h1>

<p>先ほどStageManagerにゲーム開始時の初期化メソッドを追加したように、同じくStageManagerに終了処理に関するメソッドを追加します。</p>

<ul>
<li>StageManagerにメソッドを追加</li>
</ul>

<div class="code-frame" data-lang="cs">
<div class="code-lang"><span class="bold">StageManager.cs</span></div>
<div class="highlight"><pre class="with-code"><code>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">EndGame</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="c1">// チェイサーを除去</span>
            <span class="n">mConstructor</span><span class="p">.</span><span class="nf">OffActiveChaser</span><span class="p">();</span>

            <span class="c1">// コルーチン終了</span>
            <span class="nf">StopAllCoroutines</span><span class="p">();</span>

            <span class="c1">// フラグを立てる</span>
            <span class="n">GameController</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="n">IsGameOver</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
        <span class="p">}</span>

</code></pre></div>
</div>

<p>EndGame()ではゲームの終了に必要な処理を行うと同時に、フラグを立てることでシーンの状態をGAME_OVERに遷移させています。</p>

<h3>
<span id="アニメーションイベントの設定" class="fragment"></span><a href="#%E3%82%A2%E3%83%8B%E3%83%A1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E3%81%AE%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>アニメーションイベントの設定</h3>

<p>ゲームオーバーのタイミングはプレイヤーがチェイサーと接触してその場で回転。<br>
その後のダウンアニメーションで地面に倒れ込んだ直後に設定します。</p>

<ul>
<li>PlayerActionにメソッドを追加</li>
</ul>

<div class="code-frame" data-lang="cs">
<div class="code-lang"><span class="bold">PlayerAction.cs</span></div>
<div class="highlight"><pre class="with-code"><code>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">EndDownAnimation</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">GameController</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="n">StageManager</span><span class="p">.</span><span class="nf">EndGame</span><span class="p">();</span>
        <span class="p">}</span>

</code></pre></div>
</div>

<p>今回のようにアニメーション再生時の特定タイミングでメソッドを呼び出す場合は第1回で解説したようにアニメーションイベントを利用します。</p>

<ul>
<li>UnityChan/SD_unitychan/Animations/SD_unitychan_motion_humanoidを選択</li>
<li>Animationsタグ内、Clipsに表示されている項目からKneelDownのクリップを選択</li>
<li>さらに下に進み、Events項目を開いて以下のようにイベントを設定</li>
</ul>

<p><a href="https://camo.qiitausercontent.com/de411f15772abfb013e27686b864e576954237a0/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3233393837372f34643065313238382d313235342d336338372d313030392d6136316333613431363066362e6a706567" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F239877%2F4d0e1288-1254-3c87-1009-a61c3a4160f6.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=e95829e96b57128369c4edae03d7f0c1" alt="action_sheep_ss_9_3.jpg" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/239877/4d0e1288-1254-3c87-1009-a61c3a4160f6.jpeg" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F239877%2F4d0e1288-1254-3c87-1009-a61c3a4160f6.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=cd0e939b24826ca3890049fb4f7a45a1 1x" loading="lazy"></a></p>

<p>ユニティちゃんがその場に倒れ込んだタイミングでEndDownAnimation()が呼び出され、さらにStageManager.EndGame()が実行されます。</p>

<h1>
<span id="リスタート機能を実装する" class="fragment"></span><a href="#%E3%83%AA%E3%82%B9%E3%82%BF%E3%83%BC%E3%83%88%E6%A9%9F%E8%83%BD%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>リスタート機能を実装する</h1>

<p>以上でゲームに開始と終了の概念を実装できました。<br>
最後に、ゲームをはじめからやり直す機能を追加します。</p>

<ul>
<li>GameControllerにシーンを再読み込みするメソッドを追加</li>
</ul>

<div class="code-frame" data-lang="cs">
<div class="code-lang"><span class="bold">GameController.cs</span></div>
<div class="highlight"><pre class="with-code"><code>
        <span class="c1">//-------------</span>
        <span class="c1">// シーン管理 //</span>
        <span class="c1">//---------------------------------------------------------------------------------</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">OnRestartButton</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">SceneManager</span><span class="p">.</span><span class="nf">LoadScene</span><span class="p">(</span><span class="n">SceneManager</span><span class="p">.</span><span class="nf">GetActiveScene</span><span class="p">().</span><span class="n">name</span><span class="p">);</span>
        <span class="p">}</span>

</code></pre></div>
</div>

<ul>
<li>SceneMainを修正してリスタートの入力を受け付ける</li>
</ul>

<div class="code-frame" data-lang="cs">
<div class="code-lang"><span class="bold">SceneMain.cs</span></div>
<div class="highlight"><pre class="with-code"><code>
        <span class="k">void</span> <span class="nf">Update</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="nf">CheckBackspaceInput</span><span class="p">();</span>

            <span class="k">switch</span> <span class="p">(</span><span class="n">mState</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="c1">// ステージの生成</span>
                <span class="k">case</span> <span class="n">STATE</span><span class="p">.</span><span class="n">LOAD_STAGE</span><span class="p">:</span>
                    <span class="n">mGame</span><span class="p">.</span><span class="n">StageManager</span><span class="p">.</span><span class="nf">LoadStage</span><span class="p">(</span><span class="m">1</span><span class="p">);</span>
                    <span class="n">mState</span> <span class="p">=</span> <span class="n">STATE</span><span class="p">.</span><span class="n">WAIT_ENTER_KEY</span><span class="p">;</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="c1">// Enter入力でゲームを開始</span>
                <span class="k">case</span> <span class="n">STATE</span><span class="p">.</span><span class="n">WAIT_ENTER_KEY</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nf">WaitEnter</span><span class="p">())</span>
                    <span class="p">{</span>
                        <span class="n">mGame</span><span class="p">.</span><span class="n">StageManager</span><span class="p">.</span><span class="nf">StartGame</span><span class="p">();</span>
                        <span class="n">mState</span> <span class="p">=</span> <span class="n">STATE</span><span class="p">.</span><span class="n">PLAY</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="c1">// プレイ中</span>
                <span class="k">case</span> <span class="n">STATE</span><span class="p">.</span><span class="n">PLAY</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">mGame</span><span class="p">.</span><span class="n">IsGameOver</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="n">mState</span> <span class="p">=</span> <span class="n">STATE</span><span class="p">.</span><span class="n">GAME_OVER</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">CheckBackspaceInput</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">Input</span><span class="p">.</span><span class="nf">GetKeyDown</span><span class="p">(</span><span class="n">KeyCode</span><span class="p">.</span><span class="n">Backspace</span><span class="p">))</span> <span class="n">mGame</span><span class="p">.</span><span class="nf">OnRestartButton</span><span class="p">();</span>
        <span class="p">}</span>

</code></pre></div>
</div>

<p>SceneMainの現在のmStateに関係なく、BackSpaceキーの入力を感知したタイミングでシーンを再読み込みすることでゲームを開始前の状態へ戻します。</p>

<p><a href="https://camo.qiitausercontent.com/0ad8257b73eee99f5bb954074415953bbf8bd491/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3233393837372f33386264393138612d313333352d386433652d333631302d6435653336646363623433372e6a706567" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F239877%2F38bd918a-1335-8d3e-3610-d5e36dccb437.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=4208d719a9b138fcdf01322ae0e37dce" alt="action_sheep_ss_9_2.jpg" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/239877/38bd918a-1335-8d3e-3610-d5e36dccb437.jpeg" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F239877%2F38bd918a-1335-8d3e-3610-d5e36dccb437.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=7a6e3c85e50d325242cb03553a63ec5e 1x" loading="lazy"></a></p>

<p><font color="blue">＊ゲームをリスタートした際に画面が暗くなってしまう場合は以下の設定を行ってください。</font></p>

<ol>
<li>メニュー&gt;Window&gt;Lighting&gt;Settingsを選択</li>
<li>Auto Generateのチェックを外す</li>
<li>Generate Lightingをクリック</li>
</ol>

<h3>
<span id="gamecontrollerについての注意" class="fragment"></span><a href="#gamecontroller%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E3%81%AE%E6%B3%A8%E6%84%8F"><i class="fa fa-link"></i></a>GameControllerについての注意</h3>

<p><font color="red">シーンを再読み込みすると各オブジェクトやそれにアタッチされているスクリプトなどは破棄されて新しく生成されなおしますが、シングルトンかつシーン内に配置されていないクラスGameControllerに関しては生成されている唯一のインスタンスが破棄されず同じインスタンスをそのまま参照する形になります。</font></p>

<p>つまりゲームオーバーの際に一度trueになったIsGameOverフラグはシーンを再読み込みしてもtrueになったままの状態ですので、ゲームを完全に開始前の状態に戻すにはこのフラグを初期化する必要があります。</p>

<ul>
<li>GameControllerを修正</li>
</ul>

<div class="code-frame" data-lang="cs">
<div class="code-lang"><span class="bold">GameController.cs</span></div>
<div class="highlight"><pre class="with-code"><code>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">Init</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">Application</span><span class="p">.</span><span class="n">targetFrameRate</span> <span class="p">=</span> <span class="m">30</span><span class="p">;</span>
<span class="err">追加</span>        <span class="n">IsGameOver</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
            <span class="n">Scorer</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Scorer</span><span class="p">();</span>
        <span class="p">}</span>

</code></pre></div>
</div>

<p><a href="https://camo.qiitausercontent.com/15922db3e5c98e6ed672401d7291b793d08e56f3/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3233393837372f33303838663331332d303666332d393563382d313161332d3131663235393732323337382e6a706567" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F239877%2F3088f313-06f3-95c8-11a3-11f259722378.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=8d8823e8794c9429eb793f2ec71bb3fc" alt="action_sheep_ss_9_1.jpg" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/239877/3088f313-06f3-95c8-11a3-11f259722378.jpeg" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F239877%2F3088f313-06f3-95c8-11a3-11f259722378.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=98d9642b81c4d448ccf56894dfe50d9b 1x" loading="lazy"></a></p>

<p>前回から見栄えは全く変わりありませんが、これでひつじコレクションに開始・終了の概念とやり直しの機能を実装することができました。</p>

<hr>

<p><a href="https://qiita.com/YzRoid/items/9a8c7db065a868ace439" id="reference-b84ebe4f06918ea91725">次のページに進む</a><br>
<a href="https://qiita.com/YzRoid/items/8dfd6c168b916ac82a0d">イントロダクションに戻る</a><br>
<br><br>
</p><div>
<a href="https://camo.qiitausercontent.com/b7f5c1536b1b8a520ce9101cbe8ebe580b36c643/687474703a2f2f756e6974792d6368616e2e636f6d2f696d616765732f696d6167654c6963656e73654c6f676f2e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/http%3A%2F%2Funity-chan.com%2Fimages%2FimageLicenseLogo.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=df2f88d1680d5cfda3b5cd578cecd9e7" alt="ユニティちゃんライセンス" data-canonical-src="http://unity-chan.com/images/imageLicenseLogo.png" srcset="https://qiita-user-contents.imgix.net/http%3A%2F%2Funity-chan.com%2Fimages%2FimageLicenseLogo.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=5f8c3e3bf036718b80ae66194430772a 1x" loading="lazy"></a><p>この作品は<a href="http://unity-chan.com/contents/license_jp/" rel="nofollow noopener" target="_blank">ユニティちゃんライセンス条項</a>の元に提供されています</p>
</div><br>
<br><br>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2FYzRoid%2Fitems%2Fffffffb5f1511e846cbd&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2FYzRoid%2Fitems%2Fffffffb5f1511e846cbd&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/YzRoid/items/ffffffb5f1511e846cbd/likers" class="css-1iupg5d">0</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">1</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/ffffffb5f1511e846cbd/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/YzRoid/items/ffffffb5f1511e846cbd/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/YzRoid/items/ffffffb5f1511e846cbd/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/YzRoid/items/ffffffb5f1511e846cbd/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/YzRoid/items/ffffffb5f1511e846cbd.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-d7821c35-c829-4862-864d-52dfc4f943a4">{"authorAnalyticsTrackingId":null,"organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-b05d5e9f-bcca-4234-896a-f4aba393ba5e"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-b05d5e9f-bcca-4234-896a-f4aba393ba5e">{}</script>
      
<div id="LoginModal-react-component-907f67e8-5294-48bb-ae1a-b07430d93faa"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-907f67e8-5294-48bb-ae1a-b07430d93faa">{}</script>
      
<div id="StockModal-react-component-f2e57295-3ae0-4864-a085-762fc074cb83"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-f2e57295-3ae0-4864-a085-762fc074cb83">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;uzX6QEG+DLxHJxfbENqbpU+Ai94MiAVmoc/q28O8LJcHapFWspLDinAYnay4e82vgwvLy8o3jbWDfQ4XrkVHmQ==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\u003cp\u003e\u003ca href=\"https://qiita.com/YzRoid/items/8dfd6c168b916ac82a0d\" id=\"reference-7e9103d5e19272acaf94\"\u003eミニゲームを作ってUnityを学ぶ！[ひつじコレクション編]\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"第9回目-ゲームの開始と終了\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%AC%AC9%E5%9B%9E%E7%9B%AE-%E3%82%B2%E3%83%BC%E3%83%A0%E3%81%AE%E9%96%8B%E5%A7%8B%E3%81%A8%E7%B5%82%E4%BA%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003cstrong\u003e第9回目: ゲームの開始と終了\u003c/strong\u003e\n\u003c/h3\u003e\n\n\u003cp\u003e前回はサクサクっと画面内にミニマップを表示する機能を実装しました。\u003cbr\u003e\n次はひと通り遊べるようになったひつじコレクションについて、ゲームとしての開始と終わりの概念を実装します。\u003c/p\u003e\n\n\u003cp\u003e今回の実装はゲームとしての見栄えに大きな変化はありませんが、オンラインランキングを実装する際など後々重要な仕組みになります。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"シーンを制御する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B7%E3%83%BC%E3%83%B3%E3%82%92%E5%88%B6%E5%BE%A1%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eシーンを制御する\u003c/h1\u003e\n\n\u003cp\u003e一般的なUnityのプロジェクトは例えばタイトル画面のシーン、実際にプレイするシーン、結果表示のシーンなど複数のシーンから構成されていて、それらを適切なタイミングで切り替えることでゲームとしての開始や終了を表現しています。\u003c/p\u003e\n\n\u003cp\u003e一方で今回のひつじコレクションのように1つのシーンで成り立ってしまう小規模なゲームの場合は、この開始と終了を\u003cstrong\u003eシーン内の状態を制御する\u003c/strong\u003eことで表現します。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eゼロポジションに「SceneMain」という名前の空オブジェクトを配置\u003c/li\u003e\n\u003cli\u003e同じく「SceneMain」という名前のスクリプトを作成し、それをSceneMainオブジェクトにアタッチ\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eSceneMain.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Collections\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Collections.Generic\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eUnityEngine\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eSceneMain\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eMonoBehaviour\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eGameController\u003c/span\u003e \u003cspan class=\"n\"\u003emGame\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eAwake\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003emGame\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eGameController\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eInstance\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003emGame\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eInit\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e//--------\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 状態 //\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//---------------------------------------------------------------------------------\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003eenum\u003c/span\u003e \u003cspan class=\"n\"\u003eSTATE\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eLOAD_STAGE\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ePLAY\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eGAME_OVER\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eSTATE\u003c/span\u003e \u003cspan class=\"n\"\u003emState\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eSTATE\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLOAD_STAGE\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e//--------\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 更新 //\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//---------------------------------------------------------------------------------\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eUpdate\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eswitch\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emState\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// ステージの生成\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"n\"\u003eSTATE\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLOAD_STAGE\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003emGame\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eStageManager\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLoadStage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003emState\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eSTATE\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePLAY\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// プレイ中\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"n\"\u003eSTATE\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePLAY\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emGame\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIsGameOver\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003emState\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eSTATE\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGAME_OVER\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eプロジェクト開始時にステージをファイルから生成してPLAY状態へ遷移。\u003cbr\u003e\nGameControllerのプロパティ\u003cstrong\u003e「IsGameOver」\u003c/strong\u003eがtrueになったタイミングでGAME_OVER状態へ遷移。\u003cbr\u003e\nこのように適切なタイミングでシーンの状態「mState」を変更することによってUpdate()の処理を切り替えています。\u003c/p\u003e\n\n\u003cp\u003eまた併せてGameControllerとStageManagerについて、SceneMainに対応するための修正を行います。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eSceneMain#Awake()でGameControllerの初期化を行うため、StageManagerの該当部分を修正\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eStageManager.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\n    \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eStart\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eGameController\u003c/span\u003e \u003cspan class=\"n\"\u003egame\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eGameController\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eInstance\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003egame\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eInit\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"n\"\u003egame\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eStageManager\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003emConstructor\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eGetComponent\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eStageConstructor\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eLoadStage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"nf\"\u003eStartCoroutine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"PopupFollower\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"err\"\u003e↓以下のように修正\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eStart\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eGameController\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eInstance\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eStageManager\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003emConstructor\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eGetComponent\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eStageConstructor\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n\n        \u003cspan class=\"nf\"\u003eStartCoroutine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"PopupFollower\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cul\u003e\n\u003cli\u003eGameControllerを修正\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eGameController.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eInit\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eApplication\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etargetFrameRate\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e30\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eScorer\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eScorer\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e//----------\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// フラグ //\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//---------------------------------------------------------------------------------\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eIsGameOver\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eGameControllerにはゲームオーバーに関するフラグを追加し、Init()ですっかり忘れていたフレームレートの設定を行いました。\u003cbr\u003e\nこれ以降、各スクリプトのUpdate()は1秒間に30回の頻度で呼び出されるようになります。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"enterキーでゲームを開始する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#enter%E3%82%AD%E3%83%BC%E3%81%A7%E3%82%B2%E3%83%BC%E3%83%A0%E3%82%92%E9%96%8B%E5%A7%8B%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eEnterキーでゲームを開始する\u003c/h1\u003e\n\n\u003cp\u003e今まではプロジェクトを実行した瞬間から操作可能な、いわゆるゲームが始まっている状態でしたが、この開始方法をプレイヤーが自分のタイミングで決定できるように修正していきます。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"playerオブジェクトユニティちゃんの制御\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#player%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%83%A6%E3%83%8B%E3%83%86%E3%82%A3%E3%81%A1%E3%82%83%E3%82%93%E3%81%AE%E5%88%B6%E5%BE%A1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ePlayerオブジェクト（ユニティちゃん）の制御\u003c/h3\u003e\n\n\u003cp\u003eまずはユニティちゃんについて、プロジェクト開始時点ではプレイヤーの操作入力を受け付けない状態にします。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003ePlayerActionを修正\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ePlayerAction.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\n        \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eStart\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003emTrans\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eGetComponent\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eTransform\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003emRigid\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eGetComponent\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eRigidbody\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003emAnim\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eGetComponent\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ePlayerAnimation\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n\u003cspan class=\"err\"\u003e修正\u003c/span\u003e        \u003cspan class=\"n\"\u003eState\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eSTATE\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDEFAULT\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnIdle\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eState\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eSTATE\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIDLE\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cul\u003e\n\u003cli\u003eStageConstructorにメソッドを追加\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eStageConstructor.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnActivePlayer\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ePlayer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGetComponent\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ePlayerAction\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;().\u003c/span\u003e\u003cspan class=\"nf\"\u003eOnIdle\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e初期状態のStateをIDLEからDEFAULTに変更し、新しくOnIdle()を追加しました。\u003cbr\u003e\nこれによってユニティちゃんはStageConstructor#OnActivePlayer()が実行されるまでプレイヤーの操作入力を受け付けない状態になります。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"チェイサーの制御\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%81%E3%82%A7%E3%82%A4%E3%82%B5%E3%83%BC%E3%81%AE%E5%88%B6%E5%BE%A1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eチェイサーの制御\u003c/h3\u003e\n\n\u003cp\u003e敵キャラクターについても同様に、プロジェクト開始時点ではAI行動を無効にしてその場に待機させます。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eChaserModelを修正\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eChaserModel.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eInit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"n\"\u003espeed\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"n\"\u003eincSpeed\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003emSpeed\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003espeed\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003emIncSpeed\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eincSpeed\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003emAi\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eApplySpeed\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emSpeed\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"err\"\u003eここを削除\u003c/span\u003e  \u003cspan class=\"n\"\u003eIsActive\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cul\u003e\n\u003cli\u003eStageConstructorにメソッドを追加\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eStageConstructor.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnActiveChaser\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eChaserModel\u003c/span\u003e \u003cspan class=\"n\"\u003emodel\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003emChaserList\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003emodel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIsActive\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOffActiveChaser\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eChaserModel\u003c/span\u003e \u003cspan class=\"n\"\u003emodel\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003emChaserList\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003emodel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003egameObject\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSetActive\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e敵キャラクターはStageConstructorのOnActiveChaser()が実行されるまでAIによる移動を行わずその場に待機します。\u003cbr\u003e\nまた同時に、全てのChaser~オブジェクトを非アクティブにするためのメソッド、OffActiveChaser()を追加しています。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"ポップアップの制御\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%9D%E3%83%83%E3%83%97%E3%82%A2%E3%83%83%E3%83%97%E3%81%AE%E5%88%B6%E5%BE%A1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eポップアップの制御\u003c/h3\u003e\n\n\u003cp\u003eさらにフォロワーのポップアップについて、こちらもプロジェクト開始時点ではポップアップさせるかどうかの判定を行わないようにします。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eStageManagerを修正\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eStageManager.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\n        \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eStart\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eGameController\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eInstance\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eStageManager\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003emConstructor\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eGetComponent\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eStageConstructor\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n\n\u003cspan class=\"err\"\u003eここを削除\u003c/span\u003e  \u003cspan class=\"nf\"\u003eStartCoroutine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"PopupFollower\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"ゲーム開始時の初期化\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B2%E3%83%BC%E3%83%A0%E9%96%8B%E5%A7%8B%E6%99%82%E3%81%AE%E5%88%9D%E6%9C%9F%E5%8C%96\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eゲーム開始時の初期化\u003c/h3\u003e\n\n\u003cp\u003e上記のユニティちゃん、敵キャラクター、ポップアップそれぞれに対応するため、StageManagerにゲーム開始時の初期化メソッドを追加します。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eStageManagerにメソッドを追加\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eStageManager.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eStartGame\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// プレイヤーとチェイサーの行動開始\u003c/span\u003e\n            \u003cspan class=\"n\"\u003emConstructor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eOnActivePlayer\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003emConstructor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eOnActiveChaser\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// コルーチンを開始\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eStartCoroutine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"PopupFollower\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"enterキーを受け付ける\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#enter%E3%82%AD%E3%83%BC%E3%82%92%E5%8F%97%E3%81%91%E4%BB%98%E3%81%91%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eEnterキーを受け付ける\u003c/h3\u003e\n\n\u003cp\u003e最後に、SeneMainにEnterキーの入力を監視する仕組みを実装します。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eSceneMainを修正\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eSceneMain.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003eenum\u003c/span\u003e \u003cspan class=\"n\"\u003eSTATE\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eLOAD_STAGE\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003cspan class=\"err\"\u003e追加\u003c/span\u003e        \u003cspan class=\"n\"\u003eWAIT_ENTER_KEY\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ePLAY\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eGAME_OVER\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eUpdate\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eswitch\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emState\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// ステージの生成\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"n\"\u003eSTATE\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLOAD_STAGE\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003emGame\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eStageManager\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLoadStage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"err\"\u003e修正\u003c/span\u003e                \u003cspan class=\"n\"\u003emState\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eSTATE\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWAIT_ENTER_KEY\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// Enter入力でゲームを開始\u003c/span\u003e\n\u003cspan class=\"err\"\u003e追加\u003c/span\u003e            \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"n\"\u003eSTATE\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWAIT_ENTER_KEY\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nf\"\u003eWaitEnter\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003emGame\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eStageManager\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eStartGame\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003emState\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eSTATE\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePLAY\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// プレイ中\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"n\"\u003eSTATE\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePLAY\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emGame\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIsGameOver\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003emState\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eSTATE\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGAME_OVER\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e//--------\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 入力 //\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//---------------------------------------------------------------------------------\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"nf\"\u003eWaitEnter\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eInput\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetKeyDown\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eKeyCode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eReturn\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e以上でEnterキーによってゲームを開始する仕組みが完成しました。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/15922db3e5c98e6ed672401d7291b793d08e56f3/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3233393837372f33303838663331332d303666332d393563382d313161332d3131663235393732323337382e6a706567\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F239877%2F3088f313-06f3-95c8-11a3-11f259722378.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=8d8823e8794c9429eb793f2ec71bb3fc\" alt=\"action_sheep_ss_9_1.jpg\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/239877/3088f313-06f3-95c8-11a3-11f259722378.jpeg\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F239877%2F3088f313-06f3-95c8-11a3-11f259722378.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=98d9642b81c4d448ccf56894dfe50d9b 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eプロジェクトを実行後、Enterキーを押すことでゲームが開始します。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"ゲームの終了処理を実装\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B2%E3%83%BC%E3%83%A0%E3%81%AE%E7%B5%82%E4%BA%86%E5%87%A6%E7%90%86%E3%82%92%E5%AE%9F%E8%A3%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eゲームの終了処理を実装\u003c/h1\u003e\n\n\u003cp\u003e先ほどStageManagerにゲーム開始時の初期化メソッドを追加したように、同じくStageManagerに終了処理に関するメソッドを追加します。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eStageManagerにメソッドを追加\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eStageManager.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eEndGame\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// チェイサーを除去\u003c/span\u003e\n            \u003cspan class=\"n\"\u003emConstructor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eOffActiveChaser\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// コルーチン終了\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eStopAllCoroutines\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// フラグを立てる\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eGameController\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eInstance\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIsGameOver\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eEndGame()ではゲームの終了に必要な処理を行うと同時に、フラグを立てることでシーンの状態をGAME_OVERに遷移させています。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"アニメーションイベントの設定\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%A2%E3%83%8B%E3%83%A1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E3%81%AE%E8%A8%AD%E5%AE%9A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eアニメーションイベントの設定\u003c/h3\u003e\n\n\u003cp\u003eゲームオーバーのタイミングはプレイヤーがチェイサーと接触してその場で回転。\u003cbr\u003e\nその後のダウンアニメーションで地面に倒れ込んだ直後に設定します。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003ePlayerActionにメソッドを追加\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ePlayerAction.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eEndDownAnimation\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eGameController\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eInstance\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eStageManager\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEndGame\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e今回のようにアニメーション再生時の特定タイミングでメソッドを呼び出す場合は第1回で解説したようにアニメーションイベントを利用します。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eUnityChan/SD_unitychan/Animations/SD_unitychan_motion_humanoidを選択\u003c/li\u003e\n\u003cli\u003eAnimationsタグ内、Clipsに表示されている項目からKneelDownのクリップを選択\u003c/li\u003e\n\u003cli\u003eさらに下に進み、Events項目を開いて以下のようにイベントを設定\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/de411f15772abfb013e27686b864e576954237a0/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3233393837372f34643065313238382d313235342d336338372d313030392d6136316333613431363066362e6a706567\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F239877%2F4d0e1288-1254-3c87-1009-a61c3a4160f6.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=e95829e96b57128369c4edae03d7f0c1\" alt=\"action_sheep_ss_9_3.jpg\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/239877/4d0e1288-1254-3c87-1009-a61c3a4160f6.jpeg\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F239877%2F4d0e1288-1254-3c87-1009-a61c3a4160f6.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=cd0e939b24826ca3890049fb4f7a45a1 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eユニティちゃんがその場に倒れ込んだタイミングでEndDownAnimation()が呼び出され、さらにStageManager.EndGame()が実行されます。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"リスタート機能を実装する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%AA%E3%82%B9%E3%82%BF%E3%83%BC%E3%83%88%E6%A9%9F%E8%83%BD%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eリスタート機能を実装する\u003c/h1\u003e\n\n\u003cp\u003e以上でゲームに開始と終了の概念を実装できました。\u003cbr\u003e\n最後に、ゲームをはじめからやり直す機能を追加します。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eGameControllerにシーンを再読み込みするメソッドを追加\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eGameController.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\n        \u003cspan class=\"c1\"\u003e//-------------\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// シーン管理 //\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//---------------------------------------------------------------------------------\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnRestartButton\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eSceneManager\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLoadScene\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eSceneManager\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetActiveScene\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cul\u003e\n\u003cli\u003eSceneMainを修正してリスタートの入力を受け付ける\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eSceneMain.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\n        \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eUpdate\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eCheckBackspaceInput\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n            \u003cspan class=\"k\"\u003eswitch\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emState\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// ステージの生成\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"n\"\u003eSTATE\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLOAD_STAGE\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003emGame\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eStageManager\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLoadStage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003emState\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eSTATE\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWAIT_ENTER_KEY\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// Enter入力でゲームを開始\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"n\"\u003eSTATE\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWAIT_ENTER_KEY\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nf\"\u003eWaitEnter\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003emGame\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eStageManager\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eStartGame\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003emState\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eSTATE\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePLAY\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// プレイ中\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"n\"\u003eSTATE\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePLAY\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emGame\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIsGameOver\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003emState\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eSTATE\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGAME_OVER\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eCheckBackspaceInput\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eInput\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetKeyDown\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eKeyCode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBackspace\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"n\"\u003emGame\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eOnRestartButton\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eSceneMainの現在のmStateに関係なく、BackSpaceキーの入力を感知したタイミングでシーンを再読み込みすることでゲームを開始前の状態へ戻します。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/0ad8257b73eee99f5bb954074415953bbf8bd491/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3233393837372f33386264393138612d313333352d386433652d333631302d6435653336646363623433372e6a706567\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F239877%2F38bd918a-1335-8d3e-3610-d5e36dccb437.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=4208d719a9b138fcdf01322ae0e37dce\" alt=\"action_sheep_ss_9_2.jpg\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/239877/38bd918a-1335-8d3e-3610-d5e36dccb437.jpeg\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F239877%2F38bd918a-1335-8d3e-3610-d5e36dccb437.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=7a6e3c85e50d325242cb03553a63ec5e 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cfont color=\"blue\"\u003e＊ゲームをリスタートした際に画面が暗くなってしまう場合は以下の設定を行ってください。\u003c/font\u003e\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eメニュー\u0026gt;Window\u0026gt;Lighting\u0026gt;Settingsを選択\u003c/li\u003e\n\u003cli\u003eAuto Generateのチェックを外す\u003c/li\u003e\n\u003cli\u003eGenerate Lightingをクリック\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"gamecontrollerについての注意\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#gamecontroller%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E3%81%AE%E6%B3%A8%E6%84%8F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eGameControllerについての注意\u003c/h3\u003e\n\n\u003cp\u003e\u003cfont color=\"red\"\u003eシーンを再読み込みすると各オブジェクトやそれにアタッチされているスクリプトなどは破棄されて新しく生成されなおしますが、シングルトンかつシーン内に配置されていないクラスGameControllerに関しては生成されている唯一のインスタンスが破棄されず同じインスタンスをそのまま参照する形になります。\u003c/font\u003e\u003c/p\u003e\n\n\u003cp\u003eつまりゲームオーバーの際に一度trueになったIsGameOverフラグはシーンを再読み込みしてもtrueになったままの状態ですので、ゲームを完全に開始前の状態に戻すにはこのフラグを初期化する必要があります。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eGameControllerを修正\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eGameController.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eInit\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eApplication\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etargetFrameRate\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e30\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"err\"\u003e追加\u003c/span\u003e        \u003cspan class=\"n\"\u003eIsGameOver\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eScorer\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eScorer\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/15922db3e5c98e6ed672401d7291b793d08e56f3/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3233393837372f33303838663331332d303666332d393563382d313161332d3131663235393732323337382e6a706567\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F239877%2F3088f313-06f3-95c8-11a3-11f259722378.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=8d8823e8794c9429eb793f2ec71bb3fc\" alt=\"action_sheep_ss_9_1.jpg\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/239877/3088f313-06f3-95c8-11a3-11f259722378.jpeg\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F239877%2F3088f313-06f3-95c8-11a3-11f259722378.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=98d9642b81c4d448ccf56894dfe50d9b 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e前回から見栄えは全く変わりありませんが、これでひつじコレクションに開始・終了の概念とやり直しの機能を実装することができました。\u003c/p\u003e\n\n\u003chr\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita.com/YzRoid/items/9a8c7db065a868ace439\" id=\"reference-b84ebe4f06918ea91725\"\u003e次のページに進む\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://qiita.com/YzRoid/items/8dfd6c168b916ac82a0d\"\u003eイントロダクションに戻る\u003c/a\u003e\u003cbr\u003e\n\u003cbr\u003e\u003cbr\u003e\n\u003c/p\u003e\u003cdiv\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/b7f5c1536b1b8a520ce9101cbe8ebe580b36c643/687474703a2f2f756e6974792d6368616e2e636f6d2f696d616765732f696d6167654c6963656e73654c6f676f2e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/http%3A%2F%2Funity-chan.com%2Fimages%2FimageLicenseLogo.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=df2f88d1680d5cfda3b5cd578cecd9e7\" alt=\"ユニティちゃんライセンス\" data-canonical-src=\"http://unity-chan.com/images/imageLicenseLogo.png\" srcset=\"https://qiita-user-contents.imgix.net/http%3A%2F%2Funity-chan.com%2Fimages%2FimageLicenseLogo.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=5f8c3e3bf036718b80ae66194430772a 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cp\u003eこの作品は\u003ca href=\"http://unity-chan.com/contents/license_jp/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eユニティちゃんライセンス条項\u003c/a\u003eの元に提供されています\u003c/p\u003e\n\u003c/div\u003e\u003cbr\u003e\n\u003cbr\u003e\u003cbr\u003e\n","createdAt":"2018-06-09T07:14:10Z","elapsedYearsFromLastModifiedAt":3,"encryptedId":"nIbGFhpT5oE0VE6xMJ9BOlsPgJAhh3I6--jLjg5uS/plfiUdCO--4rjJiED9z1zzNynBx+89eg==","isBanned":false,"isDeprecated":true,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2018-06-12T00:59:09Z","likesCount":0,"linkUrl":"https://qiita.com/YzRoid/items/ffffffb5f1511e846cbd","organization":null,"originalId":655738,"stockedCount":1,"title":"ひつじコレクション - 9. ゲームの開始と終了","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%AC%AC9%E5%9B%9E%E7%9B%AE-%E3%82%B2%E3%83%BC%E3%83%A0%E3%81%AE%E9%96%8B%E5%A7%8B%E3%81%A8%E7%B5%82%E4%BA%86\"\u003e第9回目: ゲームの開始と終了\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B7%E3%83%BC%E3%83%B3%E3%82%92%E5%88%B6%E5%BE%A1%E3%81%99%E3%82%8B\"\u003eシーンを制御する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#enter%E3%82%AD%E3%83%BC%E3%81%A7%E3%82%B2%E3%83%BC%E3%83%A0%E3%82%92%E9%96%8B%E5%A7%8B%E3%81%99%E3%82%8B\"\u003eEnterキーでゲームを開始する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#player%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%83%A6%E3%83%8B%E3%83%86%E3%82%A3%E3%81%A1%E3%82%83%E3%82%93%E3%81%AE%E5%88%B6%E5%BE%A1\"\u003ePlayerオブジェクト（ユニティちゃん）の制御\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%81%E3%82%A7%E3%82%A4%E3%82%B5%E3%83%BC%E3%81%AE%E5%88%B6%E5%BE%A1\"\u003eチェイサーの制御\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%9D%E3%83%83%E3%83%97%E3%82%A2%E3%83%83%E3%83%97%E3%81%AE%E5%88%B6%E5%BE%A1\"\u003eポップアップの制御\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B2%E3%83%BC%E3%83%A0%E9%96%8B%E5%A7%8B%E6%99%82%E3%81%AE%E5%88%9D%E6%9C%9F%E5%8C%96\"\u003eゲーム開始時の初期化\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#enter%E3%82%AD%E3%83%BC%E3%82%92%E5%8F%97%E3%81%91%E4%BB%98%E3%81%91%E3%82%8B\"\u003eEnterキーを受け付ける\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B2%E3%83%BC%E3%83%A0%E3%81%AE%E7%B5%82%E4%BA%86%E5%87%A6%E7%90%86%E3%82%92%E5%AE%9F%E8%A3%85\"\u003eゲームの終了処理を実装\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%A2%E3%83%8B%E3%83%A1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E3%81%AE%E8%A8%AD%E5%AE%9A\"\u003eアニメーションイベントの設定\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%AA%E3%82%B9%E3%82%BF%E3%83%BC%E3%83%88%E6%A9%9F%E8%83%BD%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B\"\u003eリスタート機能を実装する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#gamecontroller%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E3%81%AE%E6%B3%A8%E6%84%8F\"\u003eGameControllerについての注意\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":876,"uuid":"ffffffb5f1511e846cbd","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"dUm191QSECePgkeiQMORNnBxdMK1--9dm3Cw/iB3tzBxQz--t0eWbfqH27AH5fJirHBrTw==","originalId":239877,"description":"JavaでAndroid用アプリ作ったりしてます。\r\nただいまUnity勉強中！","facebookUrl":null,"githubUrl":null,"isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"YzRoid","profileImageUrl":"https://qiita-image-store.s3.amazonaws.com/0/239877/profile-images/1519195494","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F239877%2Fprofile-images%2F1519195494?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=f13ea2064a54622182605fa6059ec04c","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F239877%2Fprofile-images%2F1519195494?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=2fcbd90d54d7bc05cc2fbb8b49f9a2ea","urlName":"YzRoid","websiteUrl":"","twitterUrl":null,"twitterUrlName":null,"revealedOrganizations":{"edges":[]}},"tags":[{"name":"C#","urlName":"csharp"},{"name":"game","urlName":"game"},{"name":"Unity","urlName":"unity"},{"name":"Unity入門","urlName":"unity%e5%85%a5%e9%96%80"}],"followingLikers":{"edges":[]},"comments":{"totalCount":0}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

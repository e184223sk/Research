<!DOCTYPE html><html><head><meta charset="utf-8" /><title>共変戻り値と反変引数 - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/7shi/items/39a222b5928bf0b6f745" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="UQrLfyqvtM8wVNr1nHT98oXkeJ2smMXYKWLVqnN/SzwTBq5/nYxcpQy9wheUL5xMrYJPp79Bc6uQ+iUS3k29oQ==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta content="@7shi" name="twitter:creator" /><meta property="og:type" content="article"><meta property="og:title" content="共変戻り値と反変引数 - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND01WVd4NWFTSjVvaTc0NEtLNVlDazQ0R281WS1ONWFTSjVieVY1cFd3JnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NTQmdHh0LWNsaXA9ZWxsaXBzaXMmdHh0LWFsaWduPWNlbnRlciUyQ21pZGRsZSZzPTE3NWRkOWVjN2NmYmM2OTk3ODQwMTA0MTEyOWZmZThk&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RRGR6YUdrJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NDUmdHh0LWFsaWduPXJpZ2h0JTJDYm90dG9tJnM9MmE1NDhlMzQ4ZTU2NWY0OGUxNzg0NDM1ODE0YTNiNmM&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=bafd07f554e3e93ca1d415a60510638d"><meta property="og:description" content="C#を学習すると共変と反変という用語がでてきます。難しそうな用語ですが、その取っ掛かりとして戻り値と引数に的を絞って図によるイメージで説明します。数学的な知識は前提としませんし、コードも簡単なものしか出て来ません。型周りの知識を整理す..."><meta content="https://qiita.com/7shi/items/39a222b5928bf0b6f745" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 1nzh4zz 38fzdi helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-1nzh4zz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:16px 32px;background-color:#FBE69E;color:rgba(0,0,0,0.87);line-height:1.5;font-weight:600;}@media (max-width:770px){.css-1nzh4zz{padding:16px;}}.css-38fzdi{color:#CA832A;margin-right:4px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-383a3f02-55db-402b-b756-a1e3ec84ffd3"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2F7shi%2Fitems%2F39a222b5928bf0b6f745">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2F7shi%2Fitems%2F39a222b5928bf0b6f745">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-383a3f02-55db-402b-b756-a1e3ec84ffd3">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2016-11-27T01:56:57.000+09:00","dateModified":"2016-11-29T15:57:10.000+09:00","headline":"共変戻り値と反変引数","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND01WVd4NWFTSjVvaTc0NEtLNVlDazQ0R281WS1ONWFTSjVieVY1cFd3JnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NTQmdHh0LWNsaXA9ZWxsaXBzaXMmdHh0LWFsaWduPWNlbnRlciUyQ21pZGRsZSZzPTE3NWRkOWVjN2NmYmM2OTk3ODQwMTA0MTEyOWZmZThk\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RRGR6YUdrJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NDUmdHh0LWFsaWduPXJpZ2h0JTJDYm90dG9tJnM9MmE1NDhlMzQ4ZTU2NWY0OGUxNzg0NDM1ODE0YTNiNmM\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=bafd07f554e3e93ca1d415a60510638d","mainEntityOfPage":"https://qiita.com/7shi/items/39a222b5928bf0b6f745","author":{"@type":"Person","address":null,"email":null,"identifier":"7shi","name":"7shi","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2Fprofile-images%2F1473685823?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=4c3ba9e38885eb4fc97bd058b57afbf9","url":"https://qiita.com/7shi","description":null,"memberOf":[]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://increments.connpass.com/event/211948/">「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催</a><a target="_blank" id="header_text_message_2" href="https://increments.connpass.com/event/211948/">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"7shi","type":"items","id":"39a222b5928bf0b6f745"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"7shi","type":"items","id":"39a222b5928bf0b6f745"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":0,"pos_id":"header_text_message_1","message":"「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"7shi","type":"items","id":"39a222b5928bf0b6f745"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":0,"pos_id":"header_text_message_2","message":"「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/7shi/items/39a222b5928bf0b6f745","location":"/7shi/items/39a222b5928bf0b6f745","scheme":"https","host":"qiita.com","port":null,"pathname":"/7shi/items/39a222b5928bf0b6f745","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"/v7E7Y3lhsOC0DitoFsj+p3mZ/rPkegBZjHP1WqwNza88qHtOsZuqb45IE+oAEJEtYBQwNxIXnLfqT9tx4LBqw==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-e8403bc6-c2be-48ff-b81c-ce518fb43531"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/7shi/items/39a222b5928bf0b6f745/likers" class="css-1iupg5d">103</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">85</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/39a222b5928bf0b6f745/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/7shi/items/39a222b5928bf0b6f745/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/7shi/items/39a222b5928bf0b6f745/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/7shi/items/39a222b5928bf0b6f745/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/7shi/items/39a222b5928bf0b6f745.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-1nzh4zz"><span class="fa fa-fw fa-warning css-38fzdi"></span><p>More than 3 years have passed since last update.</p></div><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/7shi"><img class="css-100alwu eyfquo10" src="https://qiita-image-store.s3.amazonaws.com/0/32057/profile-images/1473685823" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/7shi" class="css-10ougpm">@<!-- -->7shi</a><div class="css-1ay9vb9"><span><meta content="2016-11-26T16:56:57Z"/><time dateTime="2016-11-29T06:57:10Z" class="css-m19uds">updated at 2016-11-29</time></span></div></div></div></div></div><h1 class="css-cgzq40">共変戻り値と反変引数</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div><p>C#を学習すると共変と反変という用語がでてきます。難しそうな用語ですが、その取っ掛かりとして戻り値と引数に的を絞って図によるイメージで説明します。数学的な知識は前提としませんし、コードも簡単なものしか出て来ません。型周りの知識を整理するのにも役立つでしょう。</p>

<p>この記事で最終的に説明したいことは、次のようにデリゲートから参照するメソッドの戻り値や引数の型を変える規則についてです。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="n">C</span> <span class="nf">Foo</span><span class="p">(</span><span class="n">A</span> <span class="n">a</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="k">new</span> <span class="nf">C</span><span class="p">();</span> <span class="p">}</span>  <span class="c1">// 戻り値はBの派生クラスC、引数はBの基底クラスA</span>
<span class="k">delegate</span> <span class="n">B</span> <span class="nf">Delg</span><span class="p">(</span><span class="n">B</span> <span class="n">b</span><span class="p">);</span>           <span class="c1">// 戻り値と引数ともにB</span>
<span class="n">Delg</span> <span class="n">d</span> <span class="p">=</span> <span class="n">Foo</span><span class="p">;</span>                   <span class="c1">// 型が一致しないのに、なぜ許されるのか？</span>
</code></pre></div></div>

<p>この規則はイメージしにくく混乱を招きがちですが、図による直感的な説明を試みます。</p>

<p>※ 具体例で用語に慣れることも目的としています。なるべく話を単純にするため、ジェネリックとの関係には触れません。</p>

<h1>
<span id="継承" class="fragment"></span><a href="#%E7%B6%99%E6%89%BF"><i class="fa fa-link"></i></a>継承</h1>

<p>例として、<code>A</code>を継承した<code>B</code>というクラスを考えます。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">class</span> <span class="nc">A</span> <span class="p">{}</span>
<span class="k">class</span> <span class="nc">B</span> <span class="p">:</span> <span class="n">A</span> <span class="p">{}</span>
</code></pre></div></div>

<p>継承を包含関係で図示すれば、視点によって次の2種類が考えられます。</p>

<table>
<thead>
<tr>
<th style="text-align: center">視点</th>
<th style="text-align: center">図</th>
<th>概要</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center">型</td>
<td style="text-align: center"><a href="https://camo.qiitausercontent.com/7e0b251db5024d0da3677f57a3f3a3834252afda/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33323035372f64333766396362352d646437642d633063382d623362302d6462323364613437386432652e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2Fd37f9cb5-dd7d-c0c8-b3b0-db23da478d2e.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=a1a30f7a7c2d9189fbd82eacb1b0acf9" alt="1_A⊃B.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/32057/d37f9cb5-dd7d-c0c8-b3b0-db23da478d2e.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2Fd37f9cb5-dd7d-c0c8-b3b0-db23da478d2e.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=e8df1e37dd90b0f53567c463bf2c5411 1x" loading="lazy"></a></td>
<td>
<code>B</code> を <code>A</code> として扱えることから、<code>A</code> が <code>B</code> を含むイメージ<br><code>A a = new B();</code>
</td>
</tr>
<tr>
<td style="text-align: center">実装</td>
<td style="text-align: center"><a href="https://camo.qiitausercontent.com/d2117a7a8630e872b91170c47703b6ddb4e7229c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33323035372f34646536656262632d366666332d363330322d653331372d3038393233663766336133312e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2F4de6ebbc-6ff3-6302-e317-08923f7f3a31.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=3cc634773a4d424c323e3053d9be5757" alt="2_A⊂B.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/32057/4de6ebbc-6ff3-6302-e317-08923f7f3a31.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2F4de6ebbc-6ff3-6302-e317-08923f7f3a31.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=329f4918a3bf108484aa8a39eae9391e 1x" loading="lazy"></a></td>
<td>
<code>A</code> を継承した <code>B</code> が実装を追加することから、<code>B</code> が <code>A</code> を含むイメージ</td>
</tr>
</tbody>
</table>

<p>まったく逆の図ですが、どちらかが正しいというものではなく、目的に応じて選択することになります。今回は<strong>型が話題の中心</strong>のため、「型」の図を使用します。</p>

<h2>
<span id="図の例" class="fragment"></span><a href="#%E5%9B%B3%E3%81%AE%E4%BE%8B"><i class="fa fa-link"></i></a>図の例</h2>

<p>先ほどの図に<code>Object</code>と<code>String</code>を追加してみます。</p>

<p><a href="https://camo.qiitausercontent.com/49caf385e8653e9e04f8f32aee742badcbe90a39/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33323035372f30336637323566382d643830392d623435322d303838662d3039363930616437316565302e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2F03f725f8-d809-b452-088f-09690ad71ee0.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=26d121c9fce343c6066a294d588ac000" alt="3_ObjStrAB.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/32057/03f725f8-d809-b452-088f-09690ad71ee0.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2F03f725f8-d809-b452-088f-09690ad71ee0.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=3c5ff2cc5ccf07e12cc7d37174e01edf 1x" loading="lazy"></a></p>

<p>図の見方というか、イメージが湧いたでしょうか。</p>

<h1>
<span id="共変反変" class="fragment"></span><a href="#%E5%85%B1%E5%A4%89%E5%8F%8D%E5%A4%89"><i class="fa fa-link"></i></a>共変・反変</h1>

<p>MSDN では次のように説明されています。（「」内の訳語を補っています）</p>

<p><a href="https://msdn.microsoft.com/ja-jp/library/dd799517(v=vs.110).aspx" rel="nofollow noopener" target="_blank">ジェネリックの共変性と反変性</a> より</p>

<blockquote>
<ul>
<li>「共変」Covariance<br>最初に指定された型よりも強い派生型を使用できるようにします。</li>
<li>「反変」Contravariance<br>最初に指定された型よりも一般的な (弱い派生の) 型を使用できるようにします。</li>
</ul>
</blockquote>

<p>「強い」「弱い」は「狭い」「広い」とも表現されることがあります。ここでは当面必要な範囲で割り切って、継承に限定して話を進めます。</p>

<ul>
<li>共変：型の制限を強める（対象範囲を狭める） → 継承先の派生クラスに変更すること</li>
<li>反変：型の制限を弱める（対象範囲を広げる） → 継承元の基底クラスに変更すること</li>
</ul>

<p>便宜上、継承が進む方向と<strong>共</strong>通なのが「<strong>共</strong>変」と覚えておけば良いでしょう。</p>

<p>図で考えれば、内側への矢印が共変、外側への矢印が反変となります。「狭い」「広い」というイメージも表現されています。</p>

<p><a href="https://camo.qiitausercontent.com/8eb17f1a577a359bff9476a2249f99dcad611e3a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33323035372f32343562373035302d616662332d366339622d396266362d3532393939373038323362382e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2F245b7050-afb3-6c9b-9bf6-5299970823b8.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=28b2b2b98dd85eb83d59be079268b485" alt="4_共変・反変.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/32057/245b7050-afb3-6c9b-9bf6-5299970823b8.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2F245b7050-afb3-6c9b-9bf6-5299970823b8.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=b89c47a3a5bd82545c793244672d42b3 1x" loading="lazy"></a></p>

<p>※ これは説明のためのイメージに過ぎず、実際に何か物理的な広さを持っているわけではありません。</p>

<h2>
<span id="ruby" class="fragment"></span><a href="#ruby"><i class="fa fa-link"></i></a>Ruby</h2>

<p>イメージを補強するため、Rubyでの継承の書式を紹介します。</p>

<p>※ この記事でRubyが出て来るのはここだけです。</p>

<p>クラスの定義で、C#では継承関係を <code>:</code> で表しますが、Rubyでは <code>&lt;</code> で表します。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">C#</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">class</span> <span class="nc">A</span> <span class="p">{}</span>
<span class="k">class</span> <span class="nc">B</span> <span class="p">:</span> <span class="n">A</span> <span class="p">{}</span>
</code></pre></div>
</div>

<div class="code-frame" data-lang="rb">
<div class="code-lang"><span class="bold">Ruby</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">class</span> <span class="nc">A</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">B</span> <span class="o">&lt;</span> <span class="no">A</span>
<span class="k">end</span>
</code></pre></div>
</div>

<p><code>&lt;</code> は矢印として捉えて <code>B</code> は <code>A</code> から派生する（B ← A）というイメージが持てます。それが<strong>共変</strong>の方向です。</p>

<p>※ この矢印は<a href="https://ja.wikipedia.org/wiki/%E3%82%AF%E3%83%A9%E3%82%B9%E5%9B%B3" rel="nofollow noopener" target="_blank">UMLのクラス図</a>とは逆向きなのに注意してください。</p>

<p>今回の図にこじつければ、<code>B &lt; A</code> はサイズ比較で <code>A</code> が広いとも解釈できます。</p>

<p><a href="https://camo.qiitausercontent.com/2b2747c44921e0a74aed09b0ccdfa4a04456a81f/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33323035372f64333363383937612d386536362d353461352d356163392d6563616561663835336238612e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2Fd33c897a-8e66-54a5-5ac9-ecaeaf853b8a.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=4a03df28025a272f49de6baddb3cbc06" alt="1_A⊃B.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/32057/d33c897a-8e66-54a5-5ac9-ecaeaf853b8a.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2Fd33c897a-8e66-54a5-5ac9-ecaeaf853b8a.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=1b92bf5069149197339b267d17d9522a 1x" loading="lazy"></a></p>

<h1>
<span id="参照" class="fragment"></span><a href="#%E5%8F%82%E7%85%A7"><i class="fa fa-link"></i></a>参照</h1>

<p>図による型のイメージに慣れるため、ここからしばらくは基本的な言語仕様を図で説明します。</p>

<p>説明には <code>B</code> を継承した <code>C</code> も使用します。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">A→B→C</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">class</span> <span class="nc">A</span> <span class="p">{}</span>
<span class="k">class</span> <span class="nc">B</span> <span class="p">:</span> <span class="n">A</span> <span class="p">{}</span>
<span class="k">class</span> <span class="nc">C</span> <span class="p">:</span> <span class="n">B</span> <span class="p">{}</span>
</code></pre></div>
</div>

<p><a href="https://camo.qiitausercontent.com/802718b1b0fa45ab552466fd7d2e9a17e4358585/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33323035372f31396365623935662d363934662d386139652d633462642d3139303437376161623964662e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2F19ceb95f-694f-8a9e-c4bd-190477aab9df.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=9f258a741aef2522ca84ff4086178bf0" alt="5_A⊃B⊃C.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/32057/19ceb95f-694f-8a9e-c4bd-190477aab9df.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2F19ceb95f-694f-8a9e-c4bd-190477aab9df.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=2b52cd7fda8a5dc61a0c44629d4380b8 1x" loading="lazy"></a></p>

<p>インスタンスを生成して変数に代入する書式を示します。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="n">A</span> <span class="n">a</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">A</span><span class="p">();</span>
<span class="n">B</span> <span class="n">b</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">B</span><span class="p">();</span>
<span class="n">C</span> <span class="n">c</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">C</span><span class="p">();</span>
</code></pre></div></div>

<p>これを変化させて結果を観察します。</p>

<h2>
<span id="右辺の型を変化" class="fragment"></span><a href="#%E5%8F%B3%E8%BE%BA%E3%81%AE%E5%9E%8B%E3%82%92%E5%A4%89%E5%8C%96"><i class="fa fa-link"></i></a>右辺の型を変化</h2>

<p>左辺を <code>B</code> に固定して、右辺の型を変化させてみます。<code>B</code> が入るのは当然として、<code>A</code> はエラー、<code>C</code> はOKです。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="n">B</span> <span class="n">b</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">A</span><span class="p">();</span>  <span class="c1">// エラー</span>
<span class="n">B</span> <span class="n">b</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">B</span><span class="p">();</span>  <span class="c1">// OK</span>
<span class="n">B</span> <span class="n">b</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">C</span><span class="p">();</span>  <span class="c1">// OK</span>
</code></pre></div></div>

<p>これを図で考えれば、大きい箱に小さいオブジェクトは入るのに対して、その逆はできないとイメージできます。<code>B</code> の通り口より大きな <code>A</code> は通り抜けができません。</p>

<p><a href="https://camo.qiitausercontent.com/0d4ff8018f37cc8b9d96218b1e9a2dbedc27929e/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33323035372f30396337303631362d306338362d666535362d373130302d6236616334623164353235662e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2F09c70616-0c86-fe56-7100-b6ac4b1d525f.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=cb6026e3bafd47ed0c27da420278cea9" alt="6_右辺.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/32057/09c70616-0c86-fe56-7100-b6ac4b1d525f.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2F09c70616-0c86-fe56-7100-b6ac4b1d525f.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=de0ef5d5167c5b8042920c23d901457a 1x" loading="lazy"></a></p>

<p>※ 実際には、参照型は値型と異なりインスタンス本体が代入されるわけではありません。あくまで説明のためのイメージです。</p>

<h2>
<span id="左辺の型を変化" class="fragment"></span><a href="#%E5%B7%A6%E8%BE%BA%E3%81%AE%E5%9E%8B%E3%82%92%E5%A4%89%E5%8C%96"><i class="fa fa-link"></i></a>左辺の型を変化</h2>

<p>次に右辺を <code>B</code> に固定して、左辺の型を変化させてみます。<code>B</code> が入るのは当然として、<code>A</code> はOK、<code>C</code> はエラーです。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="n">A</span> <span class="n">a</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">B</span><span class="p">();</span>  <span class="c1">// OK</span>
<span class="n">B</span> <span class="n">b</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">B</span><span class="p">();</span>  <span class="c1">// OK</span>
<span class="n">C</span> <span class="n">c</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">B</span><span class="p">();</span>  <span class="c1">// エラー</span>
</code></pre></div></div>

<p>先ほどと同様に通路が通れるかどうかでイメージできます。</p>

<p><a href="https://camo.qiitausercontent.com/b6416bfa5fd0b30a9e9bb28ab015635f33c985f3/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33323035372f38653033393663612d313033322d613061352d303765392d3565326363633132626432382e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2F8e0396ca-1032-a0a5-07e9-5e2ccc12bd28.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=96317eb83faecb7596fbf0fd48bfe9a5" alt="7_左辺.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/32057/8e0396ca-1032-a0a5-07e9-5e2ccc12bd28.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2F8e0396ca-1032-a0a5-07e9-5e2ccc12bd28.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=1e41eddc1f1affc8bd20c8894fb2144a 1x" loading="lazy"></a></p>

<h2>
<span id="共変とアップキャスト" class="fragment"></span><a href="#%E5%85%B1%E5%A4%89%E3%81%A8%E3%82%A2%E3%83%83%E3%83%97%E3%82%AD%E3%83%A3%E3%82%B9%E3%83%88"><i class="fa fa-link"></i></a>共変とアップキャスト</h2>

<p><code>A a = new B();</code> は左辺が <code>A</code> の型ですが、<code>A</code> は派生クラスの <code>B</code> を含むため、<code>new B()</code> が代入できます。このように左辺に注目して「<code>A</code> だから <code>B</code> もいける」と考えることは、普段のプログラミングでも感覚的に行っているのではないでしょうか。</p>

<p>この考え方を形式的に <code>A</code> → <code>B</code> と表せば、継承が進む方向のため<strong>共変</strong>だと解釈できます。このように普段感覚的に行っていることに名前を付けたと捉えれば、少しは抵抗感が減るかもしれません。</p>

<p>また右辺に注目すれば、暗黙で <code>A a = (A)new B();</code> という <code>B</code> → <code>A</code> のキャストが行われているとも考えられます。このような基底クラスへのキャストを<strong>アップキャスト</strong>と呼びます。</p>

<p>左辺に注目するか右辺に注目するかで、型の変化が逆向きになっていることに注意してください。これは後でも出て来ますが、どこを基準に考えるかということが重要になります。</p>

<h1>
<span id="メソッド" class="fragment"></span><a href="#%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89"><i class="fa fa-link"></i></a>メソッド</h1>

<p>メソッドを図にすれば、入力（引数）と出力（戻り値）のある箱として表現できます。</p>

<p>※ ここでは簡単のため、戻り値がない（<code>void</code>）メソッドを除外します。</p>

<p>引数と戻り値ともに <code>B</code> のメソッド <code>Foo</code> を考えます。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="n">B</span> <span class="nf">Foo</span><span class="p">(</span><span class="n">B</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">B</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<p><a href="https://camo.qiitausercontent.com/8f1ec81ac26e1500ecf5442e47cb0e2e31123bb4/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33323035372f61346230383831372d393364302d323661652d636164302d6364383534363335613031382e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2Fa4b08817-93d0-26ae-cad0-cd854635a018.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=b9a499840576a35fa907c4ec481209fc" alt="8_Foo.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/32057/a4b08817-93d0-26ae-cad0-cd854635a018.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2Fa4b08817-93d0-26ae-cad0-cd854635a018.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=1839df5f748a724c72d04f56dbae0533 1x" loading="lazy"></a></p>

<h2>
<span id="引数" class="fragment"></span><a href="#%E5%BC%95%E6%95%B0"><i class="fa fa-link"></i></a>引数</h2>

<p><code>Foo</code> の引数に別の型を渡すことを考えます。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">呼び出し側</span></div>
<div class="highlight"><pre class="with-code"><code><span class="nf">Foo</span><span class="p">(</span><span class="k">new</span> <span class="nf">A</span><span class="p">());</span>  <span class="c1">// エラー</span>
<span class="nf">Foo</span><span class="p">(</span><span class="k">new</span> <span class="nf">C</span><span class="p">());</span>  <span class="c1">// OK</span>
</code></pre></div>
</div>

<p>代入と同様に <code>A</code> は通り抜けできず、<code>C</code> は通り抜けできるとイメージできます。</p>

<p><a href="https://camo.qiitausercontent.com/faec29bb25ddd94ff8c8456787fa15b457f25d97/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33323035372f65393666366231652d323261652d363761662d623138302d3032386138373463616463332e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2Fe96f6b1e-22ae-67af-b180-028a874cadc3.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=2b82e32d324280fca46565743f09dddd" alt="9_Foo引数.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/32057/e96f6b1e-22ae-67af-b180-028a874cadc3.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2Fe96f6b1e-22ae-67af-b180-028a874cadc3.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=f2747b9ac2d4af25de868d68b2184002 1x" loading="lazy"></a></p>

<p>引数 <code>B b</code> へ参照を代入していると考えれば、本質的には <code>B b = new A();</code> と同じ条件だと分かります。</p>

<h2>
<span id="戻り値" class="fragment"></span><a href="#%E6%88%BB%E3%82%8A%E5%80%A4"><i class="fa fa-link"></i></a>戻り値</h2>

<p>今度は戻り値の方を変えてみます。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="n">B</span> <span class="nf">Foo</span><span class="p">(</span><span class="n">B</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">A</span><span class="p">();</span>  <span class="c1">// エラー</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">C</span><span class="p">();</span>  <span class="c1">// OK</span>
<span class="p">}</span>
</code></pre></div></div>

<p>やはり通り抜けでイメージできます。<code>A</code> は大き過ぎて外に出られません。</p>

<p><a href="https://camo.qiitausercontent.com/ab014842f3bab75b278a006b88896d3db096a947/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33323035372f65333734666362612d346134322d613639362d363735312d6364663734333930383362662e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2Fe374fcba-4a42-a696-6751-cdf7439083bf.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=28d06741def9f80e37c94227cb2fa3ea" alt="10_Foo戻り値.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/32057/e374fcba-4a42-a696-6751-cdf7439083bf.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2Fe374fcba-4a42-a696-6751-cdf7439083bf.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=25e794a87b976f5ee0a1c856f76bcb65 1x" loading="lazy"></a></p>

<h2>
<span id="受け取り" class="fragment"></span><a href="#%E5%8F%97%E3%81%91%E5%8F%96%E3%82%8A"><i class="fa fa-link"></i></a>受け取り</h2>

<p>メソッドの戻り値を受け取ることを考えます。メソッドから出て来たオブジェクトを漏れなく受け取るには、受け口はメソッドの戻り値と同じか広く取る必要があります。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="n">A</span> <span class="n">a</span> <span class="p">=</span> <span class="nf">Foo</span><span class="p">(</span><span class="k">null</span><span class="p">);</span>  <span class="c1">// OK</span>
<span class="n">B</span> <span class="n">b</span> <span class="p">=</span> <span class="nf">Foo</span><span class="p">(</span><span class="k">null</span><span class="p">);</span>  <span class="c1">// OK</span>
<span class="n">C</span> <span class="n">c</span> <span class="p">=</span> <span class="nf">Foo</span><span class="p">(</span><span class="k">null</span><span class="p">);</span>  <span class="c1">// エラー</span>
</code></pre></div></div>

<p><a href="https://camo.qiitausercontent.com/5ded36169c7a0a7a541fb1e1ab434a9c62195b65/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33323035372f34366563613066622d383365642d303061642d336362322d3163323462316236396437372e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2F46eca0fb-83ed-00ad-3cb2-1c24b1b69d77.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=0d0b712e7dce673c27b0518b3e6b6cdb" alt="11_Foo代入.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/32057/46eca0fb-83ed-00ad-3cb2-1c24b1b69d77.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2F46eca0fb-83ed-00ad-3cb2-1c24b1b69d77.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=08c104565bd44519b0604832c0382cae 1x" loading="lazy"></a></p>

<p>このように出入口をつなぐ場合、型の変化は進行方向に向かって広がること（暗黙のアップキャスト）しか許されないことが分かります。</p>

<p><a href="https://camo.qiitausercontent.com/d81f77fb37dab8cba52fad9fca3fab5344ecba00/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33323035372f35326235336336302d663261312d303265622d666538302d6538613239303565646636622e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2F52b53c60-f2a1-02eb-fe80-e8a2905edf6b.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=0eb75107921a30d6a2ce762408a55d38" alt="12_進行方向.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/32057/52b53c60-f2a1-02eb-fe80-e8a2905edf6b.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2F52b53c60-f2a1-02eb-fe80-e8a2905edf6b.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=53b737270906a449db2074d9a616c43c 1x" loading="lazy"></a></p>

<h1>
<span id="デリゲート" class="fragment"></span><a href="#%E3%83%87%E3%83%AA%E3%82%B2%E3%83%BC%E3%83%88"><i class="fa fa-link"></i></a>デリゲート</h1>

<p>オブジェクトを変数に代入するように、メソッドはデリゲートに代入できます。</p>

<p>※ マルチキャストデリゲートまで考えればこの言い方は不正確ですが、デリゲートにまつわる共変・反変の理解を優先するため、単純化して説明します。</p>

<p>引数と戻り値ともに <code>B</code> のデリゲート <code>Delg</code> を考えます。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">delegate</span> <span class="n">B</span> <span class="nf">Delg</span><span class="p">(</span><span class="n">B</span> <span class="n">b</span><span class="p">);</span>
</code></pre></div></div>

<p>デリゲートを図にすれば、メソッドと同じように入力（引数）と出力（戻り値）のある箱として表現できます。</p>

<p><a href="https://camo.qiitausercontent.com/ab6417c4034d386d0748f28a01ed37156ac07d5a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33323035372f62656433616163382d306461612d326564382d383530322d6162343963613030343064632e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2Fbed3aac8-0daa-2ed8-8502-ab49ca0040dc.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=cdbb734261558e454aaab413f1e62898" alt="13_Delg.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/32057/bed3aac8-0daa-2ed8-8502-ab49ca0040dc.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2Fbed3aac8-0daa-2ed8-8502-ab49ca0040dc.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=ea1170fc17780d60719047eb46e7f4f0 1x" loading="lazy"></a></p>

<p>デリゲート単体で呼び出すことはできません。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="n">Delg</span> <span class="n">d</span><span class="p">;</span>
<span class="nf">d</span><span class="p">(</span><span class="k">new</span> <span class="nf">B</span><span class="p">());</span>  <span class="c1">// エラー</span>
</code></pre></div></div>

<p><a href="https://camo.qiitausercontent.com/d4fbd6eebed1d9a0639d0c221d7510d2ec6c9227/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33323035372f30353662623265642d343738332d313064622d623936332d3330373435623630373961302e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2F056bb2ed-4783-10db-b963-30745b6079a0.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=b1612a5823e6ffd331d712e44d831dfc" alt="14_DelgEmpty.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/32057/056bb2ed-4783-10db-b963-30745b6079a0.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2F056bb2ed-4783-10db-b963-30745b6079a0.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=b8c12459be99719ac99a32e6f79e4060 1x" loading="lazy"></a></p>

<p>メソッドを割り当てれば呼び出せるようになります。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="n">Delg</span> <span class="n">d</span> <span class="p">=</span> <span class="n">Foo</span><span class="p">;</span>
<span class="nf">d</span><span class="p">(</span><span class="k">new</span> <span class="nf">B</span><span class="p">());</span>
</code></pre></div></div>

<p><a href="https://camo.qiitausercontent.com/5b1a017ddc3c9c9818bdb5f581b77133bde9e27f/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33323035372f62633839303636632d353431342d653164312d323061382d3130663238666133613262612e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2Fbc89066c-5414-e1d1-20a8-10f28fa3a2ba.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=60e4380fc3f170f8abf47e6232dc0c93" alt="15_DelgFoo.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/32057/bc89066c-5414-e1d1-20a8-10f28fa3a2ba.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2Fbc89066c-5414-e1d1-20a8-10f28fa3a2ba.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=a3b80fe406b036fa5839aa429ea0f2cd 1x" loading="lazy"></a></p>

<p>※ 実際にはデリゲートからメソッドが参照されており、中に入るわけではありません。あくまで説明のためのイメージです。</p>

<p>さて、ここまでは準備でした。いよいよここから先がこの記事の核心です。</p>

<h2>
<span id="共変戻り値" class="fragment"></span><a href="#%E5%85%B1%E5%A4%89%E6%88%BB%E3%82%8A%E5%80%A4"><i class="fa fa-link"></i></a>共変戻り値</h2>

<p>戻り値の異なるメソッドを用意します。</p>

<p>※ 後で引数を変える都合上、戻り値と引数を接尾辞として追加しています。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="n">A</span> <span class="nf">FooAB</span><span class="p">(</span><span class="n">B</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">A</span><span class="p">();</span>
<span class="p">}</span>

<span class="n">C</span> <span class="nf">FooCB</span><span class="p">(</span><span class="n">B</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">C</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<p>これを <code>Delg</code> に割り当てようとすると、<code>FooAB</code> はエラーになりますが、<code>FooCB</code> はOKです。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="n">Delg</span> <span class="n">d</span> <span class="p">=</span> <span class="n">FooAB</span><span class="p">;</span>  <span class="c1">// エラー</span>
<span class="n">Delg</span> <span class="n">d</span> <span class="p">=</span> <span class="n">FooCB</span><span class="p">;</span>  <span class="c1">// OK</span>
</code></pre></div></div>

<p>メソッドから出て来た戻り値がデリゲートを通り抜けられるかどうかでイメージできます。</p>

<p><a href="https://camo.qiitausercontent.com/301580e7db66de6b570939e774579a47fc14a9de/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33323035372f65316531653665632d323461302d323164392d323439312d6566323162666632353939312e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2Fe1e1e6ec-24a0-21d9-2491-ef21bff25991.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=48045eefa656a0c8bb2ded0873f038b8" alt="16_共変戻り値.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/32057/e1e1e6ec-24a0-21d9-2491-ef21bff25991.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2Fe1e1e6ec-24a0-21d9-2491-ef21bff25991.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=690cdf31cfd3ad7f2ffa6d8c90fea831 1x" loading="lazy"></a></p>

<p>メソッドの方が狭ければ通り抜けられます。デリゲートの型からメソッドの型を見れば <code>B</code> → <code>C</code> となり共変です。このようにデリゲートが共変の戻り値を受け付けることを<strong>共変戻り値</strong>と呼びます。</p>

<p>進行方向に対して広がることしか許されないという原則を満たしています。戻り値をデリゲートから見ると進行方向とは逆になることに注意が必要です。</p>

<h2>
<span id="反変引数" class="fragment"></span><a href="#%E5%8F%8D%E5%A4%89%E5%BC%95%E6%95%B0"><i class="fa fa-link"></i></a>反変引数</h2>

<p>今度は引数の型を変えてみます。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="n">B</span> <span class="nf">FooBA</span> <span class="p">(</span><span class="n">A</span> <span class="n">a</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">B</span> <span class="p">();</span>
<span class="p">}</span>

<span class="n">B</span> <span class="nf">FooBC</span> <span class="p">(</span><span class="n">C</span> <span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">B</span> <span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<p>これを <code>Delg</code> に割り当てようとすると、<code>FooBA</code> はOKですが、<code>FooBC</code> はエラーになります。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="n">Delg</span> <span class="n">d</span> <span class="p">=</span> <span class="n">FooBA</span><span class="p">;</span>  <span class="c1">// OK</span>
<span class="n">Delg</span> <span class="n">d</span> <span class="p">=</span> <span class="n">FooBC</span><span class="p">;</span>  <span class="c1">// エラー</span>
</code></pre></div></div>

<p>戻り値と同様に、引数がデリゲートを通り抜けられるかどうかでイメージできます。外から見えているのはデリゲートの引数型 <code>B</code> であることに注意してください。</p>

<p><a href="https://camo.qiitausercontent.com/fff0b752263eb4aaf0eced758d345e96b5fafa4e/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33323035372f66646161373363642d646133662d613566622d356363642d6532633139343236393631392e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2Ffdaa73cd-da3f-a5fb-5ccd-e2c194269619.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=ea6c3af8f81eabbbba28744b18aec7f6" alt="17_反変引数.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/32057/fdaa73cd-da3f-a5fb-5ccd-e2c194269619.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2Ffdaa73cd-da3f-a5fb-5ccd-e2c194269619.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=8dc6227aaf048f4ada0d6327f1ed89af 1x" loading="lazy"></a></p>

<p>※ 右の図は <code>C</code> なら通り抜けられそうですが、デリゲートは <code>B</code> を通すことを保証しないといけないため、<code>B</code> が通らないのは認められません。</p>

<p>メソッドの方が広ければ通り抜けられます。デリゲートの型からメソッドの型を見れば <code>B</code> → <code>A</code> となり反変です。このようにデリゲートが反変の引数を受け付けることを<strong>反変引数</strong>と呼びます（あまり一般的な用語ではありません）。</p>

<p>ここでも進行方向に対して広がることしか許されないという原則を満たしています。戻り値とは逆になっているのは、進行方向ではなくデリゲートを基準に見ているためです。戻り値では進行方向とは逆になっています。</p>

<p><a href="https://camo.qiitausercontent.com/97bd04ded89e4109d4fe2c1a64d8199b0ce2a036/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33323035372f35356462376636362d316663362d396334362d633333642d3561373139346165613062612e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2F55db7f66-1fc6-9c46-c33d-5a7194aea0ba.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=ca49f9c2b453c7e3025328a49bc32eeb" alt="18_共変・反変.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/32057/55db7f66-1fc6-9c46-c33d-5a7194aea0ba.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2F55db7f66-1fc6-9c46-c33d-5a7194aea0ba.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=7f870719b55b2f3a67f4b9a683fbf3c8 1x" loading="lazy"></a></p>

<p>このように共変・反変を考えるときは、どこを基準に見ているのかを押さえておかないと混乱します。</p>

<p>※ この図式を一般化して、入力に関係するものは反変、出力に関係するものは共変という図式を意識しておけば、この記事では言及しませんがジェネリックとの絡みも理解しやすくなるでしょう。</p>

<h1>
<span id="オーバーライド" class="fragment"></span><a href="#%E3%82%AA%E3%83%BC%E3%83%90%E3%83%BC%E3%83%A9%E3%82%A4%E3%83%89"><i class="fa fa-link"></i></a>オーバーライド</h1>

<p>派生クラスでメソッドをオーバーライドするケースを考えます。</p>

<p>引数の型を変えるとメソッドのオーバーロードとして扱われてしまうため、引数の型を変えることはできません。戻り値も型を変えるとエラーになります。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">C#</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">class</span> <span class="nc">A</span> <span class="p">{}</span>
<span class="k">class</span> <span class="nc">B</span> <span class="p">:</span> <span class="n">A</span> <span class="p">{}</span>
<span class="k">class</span> <span class="nc">C</span> <span class="p">:</span> <span class="n">B</span> <span class="p">{}</span>

<span class="k">class</span> <span class="nc">Test1</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="k">virtual</span> <span class="n">B</span> <span class="nf">Apply</span><span class="p">(</span><span class="n">B</span> <span class="n">b</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">B</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">Test2</span> <span class="p">:</span> <span class="n">Test1</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="k">override</span> <span class="n">B</span> <span class="nf">Apply</span><span class="p">(</span><span class="n">A</span> <span class="n">b</span><span class="p">)</span>  <span class="c1">// エラー: オーバーライド元がない</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">B</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">protected</span> <span class="k">override</span> <span class="n">C</span> <span class="nf">Apply</span><span class="p">(</span><span class="n">B</span> <span class="n">b</span><span class="p">)</span>  <span class="c1">// エラー: 共変戻り値不可</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">C</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>このようにオーバーライドでは型を変えることはできません。デリゲートの方が柔軟です。</p>

<h2>
<span id="java" class="fragment"></span><a href="#java"><i class="fa fa-link"></i></a>Java</h2>

<p>参考までにJavaのことを書いておきます。</p>

<p>Javaでも引数の型を変えるとオーバーロードとして扱われる点は同じですが、共変戻り値は認められています。</p>

<div class="code-frame" data-lang="java">
<div class="code-lang"><span class="bold">Java</span></div>
<div class="highlight"><pre class="with-code"><code><span class="kd">class</span> <span class="nc">A</span> <span class="o">{}</span>
<span class="kd">class</span> <span class="nc">B</span> <span class="kd">extends</span> <span class="no">A</span> <span class="o">{}</span>
<span class="kd">class</span> <span class="nc">C</span> <span class="kd">extends</span> <span class="no">B</span> <span class="o">{}</span>

<span class="kd">class</span> <span class="nc">Test1</span> <span class="o">{</span>
    <span class="kd">protected</span> <span class="no">B</span> <span class="nf">apply</span><span class="o">(</span><span class="no">B</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">B</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Test2</span> <span class="kd">extends</span> <span class="nc">Test1</span> <span class="o">{</span>
    <span class="kd">protected</span> <span class="no">B</span> <span class="nf">apply</span><span class="o">(</span><span class="no">A</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>  <span class="c1">// 単なるオーバーロード</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">B</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">protected</span> <span class="no">C</span> <span class="nf">apply</span><span class="o">(</span><span class="no">B</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>  <span class="c1">// OK: 共変戻り値</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">C</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
</div>

<p>Javaのメソッドはデフォルトでオーバーライドが可能なため、C#と異なり <code>virtual</code>, <code>override</code> キーワードはありません。逆に、オーバーライドを禁止するとき <code>final</code> を明示します。</p>

<h1>
<span id="参考" class="fragment"></span><a href="#%E5%8F%82%E8%80%83"><i class="fa fa-link"></i></a>参考</h1>

<ul>
<li><a href="https://en.wikipedia.org/wiki/Covariant_return_type" rel="nofollow noopener" target="_blank">Covariant return type</a></li>
<li><a href="https://ja.wikipedia.org/wiki/%E5%85%B1%E5%A4%89%E6%80%A7%E3%81%A8%E5%8F%8D%E5%A4%89%E6%80%A7_(%E8%A8%88%E7%AE%97%E6%A9%9F%E7%A7%91%E5%AD%A6)" rel="nofollow noopener" target="_blank">共変性と反変性 (計算機科学)</a></li>
</ul>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2F7shi%2Fitems%2F39a222b5928bf0b6f745&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2F7shi%2Fitems%2F39a222b5928bf0b6f745&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/7shi/items/39a222b5928bf0b6f745/likers" class="css-1iupg5d">103</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">85</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/39a222b5928bf0b6f745/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/7shi/items/39a222b5928bf0b6f745/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/7shi/items/39a222b5928bf0b6f745/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/7shi/items/39a222b5928bf0b6f745/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/7shi/items/39a222b5928bf0b6f745.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-e8403bc6-c2be-48ff-b81c-ce518fb43531">{"authorAnalyticsTrackingId":null,"organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-2ff22313-9045-48a4-9ac2-9e6344a6ed6e"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-2ff22313-9045-48a4-9ac2-9e6344a6ed6e">{}</script>
      
<div id="LoginModal-react-component-add59ac5-bead-4779-bfe7-cec05e04a915"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-add59ac5-bead-4779-bfe7-cec05e04a915">{}</script>
      
<div id="StockModal-react-component-09d7dc35-bda3-4c22-b4fb-4f421551f7d7"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-09d7dc35-bda3-4c22-b4fb-4f421551f7d7">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;hokCLrCXcwkoj+BWm751B2xJRN1ghqHfMlPxBHi3z2bEhWcuB7SbYxRm+LST5RS5RC9z53NfF6yLywG81YU5+w==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\u003cp\u003eC#を学習すると共変と反変という用語がでてきます。難しそうな用語ですが、その取っ掛かりとして戻り値と引数に的を絞って図によるイメージで説明します。数学的な知識は前提としませんし、コードも簡単なものしか出て来ません。型周りの知識を整理するのにも役立つでしょう。\u003c/p\u003e\n\n\u003cp\u003eこの記事で最終的に説明したいことは、次のようにデリゲートから参照するメソッドの戻り値や引数の型を変える規則についてです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eC\u003c/span\u003e \u003cspan class=\"nf\"\u003eFoo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eA\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eC\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e  \u003cspan class=\"c1\"\u003e// 戻り値はBの派生クラスC、引数はBの基底クラスA\u003c/span\u003e\n\u003cspan class=\"k\"\u003edelegate\u003c/span\u003e \u003cspan class=\"n\"\u003eB\u003c/span\u003e \u003cspan class=\"nf\"\u003eDelg\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eB\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e           \u003cspan class=\"c1\"\u003e// 戻り値と引数ともにB\u003c/span\u003e\n\u003cspan class=\"n\"\u003eDelg\u003c/span\u003e \u003cspan class=\"n\"\u003ed\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eFoo\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e                   \u003cspan class=\"c1\"\u003e// 型が一致しないのに、なぜ許されるのか？\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこの規則はイメージしにくく混乱を招きがちですが、図による直感的な説明を試みます。\u003c/p\u003e\n\n\u003cp\u003e※ 具体例で用語に慣れることも目的としています。なるべく話を単純にするため、ジェネリックとの関係には触れません。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"継承\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%B6%99%E6%89%BF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e継承\u003c/h1\u003e\n\n\u003cp\u003e例として、\u003ccode\u003eA\u003c/code\u003eを継承した\u003ccode\u003eB\u003c/code\u003eというクラスを考えます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eA\u003c/span\u003e \u003cspan class=\"p\"\u003e{}\u003c/span\u003e\n\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eB\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eA\u003c/span\u003e \u003cspan class=\"p\"\u003e{}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e継承を包含関係で図示すれば、視点によって次の2種類が考えられます。\u003c/p\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align: center\"\u003e視点\u003c/th\u003e\n\u003cth style=\"text-align: center\"\u003e図\u003c/th\u003e\n\u003cth\u003e概要\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003e型\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e\u003ca href=\"https://camo.qiitausercontent.com/7e0b251db5024d0da3677f57a3f3a3834252afda/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33323035372f64333766396362352d646437642d633063382d623362302d6462323364613437386432652e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2Fd37f9cb5-dd7d-c0c8-b3b0-db23da478d2e.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=a1a30f7a7c2d9189fbd82eacb1b0acf9\" alt=\"1_A⊃B.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/32057/d37f9cb5-dd7d-c0c8-b3b0-db23da478d2e.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2Fd37f9cb5-dd7d-c0c8-b3b0-db23da478d2e.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=e8df1e37dd90b0f53567c463bf2c5411 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e\n\u003ccode\u003eB\u003c/code\u003e を \u003ccode\u003eA\u003c/code\u003e として扱えることから、\u003ccode\u003eA\u003c/code\u003e が \u003ccode\u003eB\u003c/code\u003e を含むイメージ\u003cbr\u003e\u003ccode\u003eA a = new B();\u003c/code\u003e\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003e実装\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e\u003ca href=\"https://camo.qiitausercontent.com/d2117a7a8630e872b91170c47703b6ddb4e7229c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33323035372f34646536656262632d366666332d363330322d653331372d3038393233663766336133312e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2F4de6ebbc-6ff3-6302-e317-08923f7f3a31.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=3cc634773a4d424c323e3053d9be5757\" alt=\"2_A⊂B.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/32057/4de6ebbc-6ff3-6302-e317-08923f7f3a31.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2F4de6ebbc-6ff3-6302-e317-08923f7f3a31.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=329f4918a3bf108484aa8a39eae9391e 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e\n\u003ccode\u003eA\u003c/code\u003e を継承した \u003ccode\u003eB\u003c/code\u003e が実装を追加することから、\u003ccode\u003eB\u003c/code\u003e が \u003ccode\u003eA\u003c/code\u003e を含むイメージ\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003cp\u003eまったく逆の図ですが、どちらかが正しいというものではなく、目的に応じて選択することになります。今回は\u003cstrong\u003e型が話題の中心\u003c/strong\u003eのため、「型」の図を使用します。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"図の例\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%9B%B3%E3%81%AE%E4%BE%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e図の例\u003c/h2\u003e\n\n\u003cp\u003e先ほどの図に\u003ccode\u003eObject\u003c/code\u003eと\u003ccode\u003eString\u003c/code\u003eを追加してみます。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/49caf385e8653e9e04f8f32aee742badcbe90a39/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33323035372f30336637323566382d643830392d623435322d303838662d3039363930616437316565302e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2F03f725f8-d809-b452-088f-09690ad71ee0.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=26d121c9fce343c6066a294d588ac000\" alt=\"3_ObjStrAB.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/32057/03f725f8-d809-b452-088f-09690ad71ee0.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2F03f725f8-d809-b452-088f-09690ad71ee0.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=3c5ff2cc5ccf07e12cc7d37174e01edf 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e図の見方というか、イメージが湧いたでしょうか。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"共変反変\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%85%B1%E5%A4%89%E5%8F%8D%E5%A4%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e共変・反変\u003c/h1\u003e\n\n\u003cp\u003eMSDN では次のように説明されています。（「」内の訳語を補っています）\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://msdn.microsoft.com/ja-jp/library/dd799517(v=vs.110).aspx\" rel=\"nofollow noopener\" target=\"_blank\"\u003eジェネリックの共変性と反変性\u003c/a\u003e より\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cul\u003e\n\u003cli\u003e「共変」Covariance\u003cbr\u003e最初に指定された型よりも強い派生型を使用できるようにします。\u003c/li\u003e\n\u003cli\u003e「反変」Contravariance\u003cbr\u003e最初に指定された型よりも一般的な (弱い派生の) 型を使用できるようにします。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e「強い」「弱い」は「狭い」「広い」とも表現されることがあります。ここでは当面必要な範囲で割り切って、継承に限定して話を進めます。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e共変：型の制限を強める（対象範囲を狭める） → 継承先の派生クラスに変更すること\u003c/li\u003e\n\u003cli\u003e反変：型の制限を弱める（対象範囲を広げる） → 継承元の基底クラスに変更すること\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e便宜上、継承が進む方向と\u003cstrong\u003e共\u003c/strong\u003e通なのが「\u003cstrong\u003e共\u003c/strong\u003e変」と覚えておけば良いでしょう。\u003c/p\u003e\n\n\u003cp\u003e図で考えれば、内側への矢印が共変、外側への矢印が反変となります。「狭い」「広い」というイメージも表現されています。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/8eb17f1a577a359bff9476a2249f99dcad611e3a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33323035372f32343562373035302d616662332d366339622d396266362d3532393939373038323362382e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2F245b7050-afb3-6c9b-9bf6-5299970823b8.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=28b2b2b98dd85eb83d59be079268b485\" alt=\"4_共変・反変.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/32057/245b7050-afb3-6c9b-9bf6-5299970823b8.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2F245b7050-afb3-6c9b-9bf6-5299970823b8.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=b89c47a3a5bd82545c793244672d42b3 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e※ これは説明のためのイメージに過ぎず、実際に何か物理的な広さを持っているわけではありません。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ruby\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#ruby\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eRuby\u003c/h2\u003e\n\n\u003cp\u003eイメージを補強するため、Rubyでの継承の書式を紹介します。\u003c/p\u003e\n\n\u003cp\u003e※ この記事でRubyが出て来るのはここだけです。\u003c/p\u003e\n\n\u003cp\u003eクラスの定義で、C#では継承関係を \u003ccode\u003e:\u003c/code\u003e で表しますが、Rubyでは \u003ccode\u003e\u0026lt;\u003c/code\u003e で表します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eC#\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eA\u003c/span\u003e \u003cspan class=\"p\"\u003e{}\u003c/span\u003e\n\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eB\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eA\u003c/span\u003e \u003cspan class=\"p\"\u003e{}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"rb\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eRuby\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eA\u003c/span\u003e\n\u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eB\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"no\"\u003eA\u003c/span\u003e\n\u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003e\u0026lt;\u003c/code\u003e は矢印として捉えて \u003ccode\u003eB\u003c/code\u003e は \u003ccode\u003eA\u003c/code\u003e から派生する（B ← A）というイメージが持てます。それが\u003cstrong\u003e共変\u003c/strong\u003eの方向です。\u003c/p\u003e\n\n\u003cp\u003e※ この矢印は\u003ca href=\"https://ja.wikipedia.org/wiki/%E3%82%AF%E3%83%A9%E3%82%B9%E5%9B%B3\" rel=\"nofollow noopener\" target=\"_blank\"\u003eUMLのクラス図\u003c/a\u003eとは逆向きなのに注意してください。\u003c/p\u003e\n\n\u003cp\u003e今回の図にこじつければ、\u003ccode\u003eB \u0026lt; A\u003c/code\u003e はサイズ比較で \u003ccode\u003eA\u003c/code\u003e が広いとも解釈できます。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/2b2747c44921e0a74aed09b0ccdfa4a04456a81f/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33323035372f64333363383937612d386536362d353461352d356163392d6563616561663835336238612e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2Fd33c897a-8e66-54a5-5ac9-ecaeaf853b8a.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=4a03df28025a272f49de6baddb3cbc06\" alt=\"1_A⊃B.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/32057/d33c897a-8e66-54a5-5ac9-ecaeaf853b8a.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2Fd33c897a-8e66-54a5-5ac9-ecaeaf853b8a.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=1b92bf5069149197339b267d17d9522a 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"参照\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8F%82%E7%85%A7\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e参照\u003c/h1\u003e\n\n\u003cp\u003e図による型のイメージに慣れるため、ここからしばらくは基本的な言語仕様を図で説明します。\u003c/p\u003e\n\n\u003cp\u003e説明には \u003ccode\u003eB\u003c/code\u003e を継承した \u003ccode\u003eC\u003c/code\u003e も使用します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eA→B→C\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eA\u003c/span\u003e \u003cspan class=\"p\"\u003e{}\u003c/span\u003e\n\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eB\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eA\u003c/span\u003e \u003cspan class=\"p\"\u003e{}\u003c/span\u003e\n\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eC\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eB\u003c/span\u003e \u003cspan class=\"p\"\u003e{}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/802718b1b0fa45ab552466fd7d2e9a17e4358585/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33323035372f31396365623935662d363934662d386139652d633462642d3139303437376161623964662e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2F19ceb95f-694f-8a9e-c4bd-190477aab9df.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=9f258a741aef2522ca84ff4086178bf0\" alt=\"5_A⊃B⊃C.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/32057/19ceb95f-694f-8a9e-c4bd-190477aab9df.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2F19ceb95f-694f-8a9e-c4bd-190477aab9df.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=2b52cd7fda8a5dc61a0c44629d4380b8 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eインスタンスを生成して変数に代入する書式を示します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eA\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eA\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"n\"\u003eB\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eB\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"n\"\u003eC\u003c/span\u003e \u003cspan class=\"n\"\u003ec\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eC\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれを変化させて結果を観察します。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"右辺の型を変化\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8F%B3%E8%BE%BA%E3%81%AE%E5%9E%8B%E3%82%92%E5%A4%89%E5%8C%96\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e右辺の型を変化\u003c/h2\u003e\n\n\u003cp\u003e左辺を \u003ccode\u003eB\u003c/code\u003e に固定して、右辺の型を変化させてみます。\u003ccode\u003eB\u003c/code\u003e が入るのは当然として、\u003ccode\u003eA\u003c/code\u003e はエラー、\u003ccode\u003eC\u003c/code\u003e はOKです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eB\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eA\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e  \u003cspan class=\"c1\"\u003e// エラー\u003c/span\u003e\n\u003cspan class=\"n\"\u003eB\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eB\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e  \u003cspan class=\"c1\"\u003e// OK\u003c/span\u003e\n\u003cspan class=\"n\"\u003eB\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eC\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e  \u003cspan class=\"c1\"\u003e// OK\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれを図で考えれば、大きい箱に小さいオブジェクトは入るのに対して、その逆はできないとイメージできます。\u003ccode\u003eB\u003c/code\u003e の通り口より大きな \u003ccode\u003eA\u003c/code\u003e は通り抜けができません。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/0d4ff8018f37cc8b9d96218b1e9a2dbedc27929e/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33323035372f30396337303631362d306338362d666535362d373130302d6236616334623164353235662e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2F09c70616-0c86-fe56-7100-b6ac4b1d525f.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=cb6026e3bafd47ed0c27da420278cea9\" alt=\"6_右辺.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/32057/09c70616-0c86-fe56-7100-b6ac4b1d525f.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2F09c70616-0c86-fe56-7100-b6ac4b1d525f.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=de0ef5d5167c5b8042920c23d901457a 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e※ 実際には、参照型は値型と異なりインスタンス本体が代入されるわけではありません。あくまで説明のためのイメージです。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"左辺の型を変化\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%B7%A6%E8%BE%BA%E3%81%AE%E5%9E%8B%E3%82%92%E5%A4%89%E5%8C%96\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e左辺の型を変化\u003c/h2\u003e\n\n\u003cp\u003e次に右辺を \u003ccode\u003eB\u003c/code\u003e に固定して、左辺の型を変化させてみます。\u003ccode\u003eB\u003c/code\u003e が入るのは当然として、\u003ccode\u003eA\u003c/code\u003e はOK、\u003ccode\u003eC\u003c/code\u003e はエラーです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eA\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eB\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e  \u003cspan class=\"c1\"\u003e// OK\u003c/span\u003e\n\u003cspan class=\"n\"\u003eB\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eB\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e  \u003cspan class=\"c1\"\u003e// OK\u003c/span\u003e\n\u003cspan class=\"n\"\u003eC\u003c/span\u003e \u003cspan class=\"n\"\u003ec\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eB\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e  \u003cspan class=\"c1\"\u003e// エラー\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e先ほどと同様に通路が通れるかどうかでイメージできます。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/b6416bfa5fd0b30a9e9bb28ab015635f33c985f3/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33323035372f38653033393663612d313033322d613061352d303765392d3565326363633132626432382e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2F8e0396ca-1032-a0a5-07e9-5e2ccc12bd28.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=96317eb83faecb7596fbf0fd48bfe9a5\" alt=\"7_左辺.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/32057/8e0396ca-1032-a0a5-07e9-5e2ccc12bd28.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2F8e0396ca-1032-a0a5-07e9-5e2ccc12bd28.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=1e41eddc1f1affc8bd20c8894fb2144a 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"共変とアップキャスト\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%85%B1%E5%A4%89%E3%81%A8%E3%82%A2%E3%83%83%E3%83%97%E3%82%AD%E3%83%A3%E3%82%B9%E3%83%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e共変とアップキャスト\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003eA a = new B();\u003c/code\u003e は左辺が \u003ccode\u003eA\u003c/code\u003e の型ですが、\u003ccode\u003eA\u003c/code\u003e は派生クラスの \u003ccode\u003eB\u003c/code\u003e を含むため、\u003ccode\u003enew B()\u003c/code\u003e が代入できます。このように左辺に注目して「\u003ccode\u003eA\u003c/code\u003e だから \u003ccode\u003eB\u003c/code\u003e もいける」と考えることは、普段のプログラミングでも感覚的に行っているのではないでしょうか。\u003c/p\u003e\n\n\u003cp\u003eこの考え方を形式的に \u003ccode\u003eA\u003c/code\u003e → \u003ccode\u003eB\u003c/code\u003e と表せば、継承が進む方向のため\u003cstrong\u003e共変\u003c/strong\u003eだと解釈できます。このように普段感覚的に行っていることに名前を付けたと捉えれば、少しは抵抗感が減るかもしれません。\u003c/p\u003e\n\n\u003cp\u003eまた右辺に注目すれば、暗黙で \u003ccode\u003eA a = (A)new B();\u003c/code\u003e という \u003ccode\u003eB\u003c/code\u003e → \u003ccode\u003eA\u003c/code\u003e のキャストが行われているとも考えられます。このような基底クラスへのキャストを\u003cstrong\u003eアップキャスト\u003c/strong\u003eと呼びます。\u003c/p\u003e\n\n\u003cp\u003e左辺に注目するか右辺に注目するかで、型の変化が逆向きになっていることに注意してください。これは後でも出て来ますが、どこを基準に考えるかということが重要になります。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"メソッド\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eメソッド\u003c/h1\u003e\n\n\u003cp\u003eメソッドを図にすれば、入力（引数）と出力（戻り値）のある箱として表現できます。\u003c/p\u003e\n\n\u003cp\u003e※ ここでは簡単のため、戻り値がない（\u003ccode\u003evoid\u003c/code\u003e）メソッドを除外します。\u003c/p\u003e\n\n\u003cp\u003e引数と戻り値ともに \u003ccode\u003eB\u003c/code\u003e のメソッド \u003ccode\u003eFoo\u003c/code\u003e を考えます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eB\u003c/span\u003e \u003cspan class=\"nf\"\u003eFoo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eB\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eB\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/8f1ec81ac26e1500ecf5442e47cb0e2e31123bb4/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33323035372f61346230383831372d393364302d323661652d636164302d6364383534363335613031382e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2Fa4b08817-93d0-26ae-cad0-cd854635a018.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=b9a499840576a35fa907c4ec481209fc\" alt=\"8_Foo.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/32057/a4b08817-93d0-26ae-cad0-cd854635a018.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2Fa4b08817-93d0-26ae-cad0-cd854635a018.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=1839df5f748a724c72d04f56dbae0533 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"引数\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%BC%95%E6%95%B0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e引数\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003eFoo\u003c/code\u003e の引数に別の型を渡すことを考えます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e呼び出し側\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"nf\"\u003eFoo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eA\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e  \u003cspan class=\"c1\"\u003e// エラー\u003c/span\u003e\n\u003cspan class=\"nf\"\u003eFoo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eC\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e  \u003cspan class=\"c1\"\u003e// OK\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e代入と同様に \u003ccode\u003eA\u003c/code\u003e は通り抜けできず、\u003ccode\u003eC\u003c/code\u003e は通り抜けできるとイメージできます。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/faec29bb25ddd94ff8c8456787fa15b457f25d97/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33323035372f65393666366231652d323261652d363761662d623138302d3032386138373463616463332e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2Fe96f6b1e-22ae-67af-b180-028a874cadc3.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=2b82e32d324280fca46565743f09dddd\" alt=\"9_Foo引数.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/32057/e96f6b1e-22ae-67af-b180-028a874cadc3.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2Fe96f6b1e-22ae-67af-b180-028a874cadc3.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=f2747b9ac2d4af25de868d68b2184002 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e引数 \u003ccode\u003eB b\u003c/code\u003e へ参照を代入していると考えれば、本質的には \u003ccode\u003eB b = new A();\u003c/code\u003e と同じ条件だと分かります。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"戻り値\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%88%BB%E3%82%8A%E5%80%A4\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e戻り値\u003c/h2\u003e\n\n\u003cp\u003e今度は戻り値の方を変えてみます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eB\u003c/span\u003e \u003cspan class=\"nf\"\u003eFoo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eB\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eA\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e  \u003cspan class=\"c1\"\u003e// エラー\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eC\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e  \u003cspan class=\"c1\"\u003e// OK\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eやはり通り抜けでイメージできます。\u003ccode\u003eA\u003c/code\u003e は大き過ぎて外に出られません。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/ab014842f3bab75b278a006b88896d3db096a947/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33323035372f65333734666362612d346134322d613639362d363735312d6364663734333930383362662e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2Fe374fcba-4a42-a696-6751-cdf7439083bf.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=28d06741def9f80e37c94227cb2fa3ea\" alt=\"10_Foo戻り値.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/32057/e374fcba-4a42-a696-6751-cdf7439083bf.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2Fe374fcba-4a42-a696-6751-cdf7439083bf.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=25e794a87b976f5ee0a1c856f76bcb65 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"受け取り\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8F%97%E3%81%91%E5%8F%96%E3%82%8A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e受け取り\u003c/h2\u003e\n\n\u003cp\u003eメソッドの戻り値を受け取ることを考えます。メソッドから出て来たオブジェクトを漏れなく受け取るには、受け口はメソッドの戻り値と同じか広く取る必要があります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eA\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eFoo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e  \u003cspan class=\"c1\"\u003e// OK\u003c/span\u003e\n\u003cspan class=\"n\"\u003eB\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eFoo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e  \u003cspan class=\"c1\"\u003e// OK\u003c/span\u003e\n\u003cspan class=\"n\"\u003eC\u003c/span\u003e \u003cspan class=\"n\"\u003ec\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eFoo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e  \u003cspan class=\"c1\"\u003e// エラー\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/5ded36169c7a0a7a541fb1e1ab434a9c62195b65/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33323035372f34366563613066622d383365642d303061642d336362322d3163323462316236396437372e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2F46eca0fb-83ed-00ad-3cb2-1c24b1b69d77.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=0d0b712e7dce673c27b0518b3e6b6cdb\" alt=\"11_Foo代入.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/32057/46eca0fb-83ed-00ad-3cb2-1c24b1b69d77.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2F46eca0fb-83ed-00ad-3cb2-1c24b1b69d77.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=08c104565bd44519b0604832c0382cae 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eこのように出入口をつなぐ場合、型の変化は進行方向に向かって広がること（暗黙のアップキャスト）しか許されないことが分かります。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/d81f77fb37dab8cba52fad9fca3fab5344ecba00/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33323035372f35326235336336302d663261312d303265622d666538302d6538613239303565646636622e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2F52b53c60-f2a1-02eb-fe80-e8a2905edf6b.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=0eb75107921a30d6a2ce762408a55d38\" alt=\"12_進行方向.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/32057/52b53c60-f2a1-02eb-fe80-e8a2905edf6b.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2F52b53c60-f2a1-02eb-fe80-e8a2905edf6b.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=53b737270906a449db2074d9a616c43c 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"デリゲート\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%87%E3%83%AA%E3%82%B2%E3%83%BC%E3%83%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eデリゲート\u003c/h1\u003e\n\n\u003cp\u003eオブジェクトを変数に代入するように、メソッドはデリゲートに代入できます。\u003c/p\u003e\n\n\u003cp\u003e※ マルチキャストデリゲートまで考えればこの言い方は不正確ですが、デリゲートにまつわる共変・反変の理解を優先するため、単純化して説明します。\u003c/p\u003e\n\n\u003cp\u003e引数と戻り値ともに \u003ccode\u003eB\u003c/code\u003e のデリゲート \u003ccode\u003eDelg\u003c/code\u003e を考えます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003edelegate\u003c/span\u003e \u003cspan class=\"n\"\u003eB\u003c/span\u003e \u003cspan class=\"nf\"\u003eDelg\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eB\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eデリゲートを図にすれば、メソッドと同じように入力（引数）と出力（戻り値）のある箱として表現できます。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/ab6417c4034d386d0748f28a01ed37156ac07d5a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33323035372f62656433616163382d306461612d326564382d383530322d6162343963613030343064632e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2Fbed3aac8-0daa-2ed8-8502-ab49ca0040dc.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=cdbb734261558e454aaab413f1e62898\" alt=\"13_Delg.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/32057/bed3aac8-0daa-2ed8-8502-ab49ca0040dc.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2Fbed3aac8-0daa-2ed8-8502-ab49ca0040dc.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=ea1170fc17780d60719047eb46e7f4f0 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eデリゲート単体で呼び出すことはできません。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eDelg\u003c/span\u003e \u003cspan class=\"n\"\u003ed\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"nf\"\u003ed\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eB\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e  \u003cspan class=\"c1\"\u003e// エラー\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/d4fbd6eebed1d9a0639d0c221d7510d2ec6c9227/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33323035372f30353662623265642d343738332d313064622d623936332d3330373435623630373961302e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2F056bb2ed-4783-10db-b963-30745b6079a0.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=b1612a5823e6ffd331d712e44d831dfc\" alt=\"14_DelgEmpty.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/32057/056bb2ed-4783-10db-b963-30745b6079a0.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2F056bb2ed-4783-10db-b963-30745b6079a0.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=b8c12459be99719ac99a32e6f79e4060 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eメソッドを割り当てれば呼び出せるようになります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eDelg\u003c/span\u003e \u003cspan class=\"n\"\u003ed\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eFoo\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"nf\"\u003ed\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eB\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/5b1a017ddc3c9c9818bdb5f581b77133bde9e27f/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33323035372f62633839303636632d353431342d653164312d323061382d3130663238666133613262612e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2Fbc89066c-5414-e1d1-20a8-10f28fa3a2ba.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=60e4380fc3f170f8abf47e6232dc0c93\" alt=\"15_DelgFoo.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/32057/bc89066c-5414-e1d1-20a8-10f28fa3a2ba.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2Fbc89066c-5414-e1d1-20a8-10f28fa3a2ba.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=a3b80fe406b036fa5839aa429ea0f2cd 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e※ 実際にはデリゲートからメソッドが参照されており、中に入るわけではありません。あくまで説明のためのイメージです。\u003c/p\u003e\n\n\u003cp\u003eさて、ここまでは準備でした。いよいよここから先がこの記事の核心です。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"共変戻り値\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%85%B1%E5%A4%89%E6%88%BB%E3%82%8A%E5%80%A4\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e共変戻り値\u003c/h2\u003e\n\n\u003cp\u003e戻り値の異なるメソッドを用意します。\u003c/p\u003e\n\n\u003cp\u003e※ 後で引数を変える都合上、戻り値と引数を接尾辞として追加しています。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eA\u003c/span\u003e \u003cspan class=\"nf\"\u003eFooAB\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eB\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eA\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003eC\u003c/span\u003e \u003cspan class=\"nf\"\u003eFooCB\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eB\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eC\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれを \u003ccode\u003eDelg\u003c/code\u003e に割り当てようとすると、\u003ccode\u003eFooAB\u003c/code\u003e はエラーになりますが、\u003ccode\u003eFooCB\u003c/code\u003e はOKです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eDelg\u003c/span\u003e \u003cspan class=\"n\"\u003ed\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eFooAB\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e  \u003cspan class=\"c1\"\u003e// エラー\u003c/span\u003e\n\u003cspan class=\"n\"\u003eDelg\u003c/span\u003e \u003cspan class=\"n\"\u003ed\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eFooCB\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e  \u003cspan class=\"c1\"\u003e// OK\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eメソッドから出て来た戻り値がデリゲートを通り抜けられるかどうかでイメージできます。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/301580e7db66de6b570939e774579a47fc14a9de/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33323035372f65316531653665632d323461302d323164392d323439312d6566323162666632353939312e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2Fe1e1e6ec-24a0-21d9-2491-ef21bff25991.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=48045eefa656a0c8bb2ded0873f038b8\" alt=\"16_共変戻り値.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/32057/e1e1e6ec-24a0-21d9-2491-ef21bff25991.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2Fe1e1e6ec-24a0-21d9-2491-ef21bff25991.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=690cdf31cfd3ad7f2ffa6d8c90fea831 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eメソッドの方が狭ければ通り抜けられます。デリゲートの型からメソッドの型を見れば \u003ccode\u003eB\u003c/code\u003e → \u003ccode\u003eC\u003c/code\u003e となり共変です。このようにデリゲートが共変の戻り値を受け付けることを\u003cstrong\u003e共変戻り値\u003c/strong\u003eと呼びます。\u003c/p\u003e\n\n\u003cp\u003e進行方向に対して広がることしか許されないという原則を満たしています。戻り値をデリゲートから見ると進行方向とは逆になることに注意が必要です。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"反変引数\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8F%8D%E5%A4%89%E5%BC%95%E6%95%B0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e反変引数\u003c/h2\u003e\n\n\u003cp\u003e今度は引数の型を変えてみます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eB\u003c/span\u003e \u003cspan class=\"nf\"\u003eFooBA\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eA\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eB\u003c/span\u003e \u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003eB\u003c/span\u003e \u003cspan class=\"nf\"\u003eFooBC\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eC\u003c/span\u003e \u003cspan class=\"n\"\u003ec\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eB\u003c/span\u003e \u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれを \u003ccode\u003eDelg\u003c/code\u003e に割り当てようとすると、\u003ccode\u003eFooBA\u003c/code\u003e はOKですが、\u003ccode\u003eFooBC\u003c/code\u003e はエラーになります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eDelg\u003c/span\u003e \u003cspan class=\"n\"\u003ed\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eFooBA\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e  \u003cspan class=\"c1\"\u003e// OK\u003c/span\u003e\n\u003cspan class=\"n\"\u003eDelg\u003c/span\u003e \u003cspan class=\"n\"\u003ed\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eFooBC\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e  \u003cspan class=\"c1\"\u003e// エラー\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e戻り値と同様に、引数がデリゲートを通り抜けられるかどうかでイメージできます。外から見えているのはデリゲートの引数型 \u003ccode\u003eB\u003c/code\u003e であることに注意してください。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/fff0b752263eb4aaf0eced758d345e96b5fafa4e/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33323035372f66646161373363642d646133662d613566622d356363642d6532633139343236393631392e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2Ffdaa73cd-da3f-a5fb-5ccd-e2c194269619.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=ea6c3af8f81eabbbba28744b18aec7f6\" alt=\"17_反変引数.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/32057/fdaa73cd-da3f-a5fb-5ccd-e2c194269619.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2Ffdaa73cd-da3f-a5fb-5ccd-e2c194269619.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=8dc6227aaf048f4ada0d6327f1ed89af 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e※ 右の図は \u003ccode\u003eC\u003c/code\u003e なら通り抜けられそうですが、デリゲートは \u003ccode\u003eB\u003c/code\u003e を通すことを保証しないといけないため、\u003ccode\u003eB\u003c/code\u003e が通らないのは認められません。\u003c/p\u003e\n\n\u003cp\u003eメソッドの方が広ければ通り抜けられます。デリゲートの型からメソッドの型を見れば \u003ccode\u003eB\u003c/code\u003e → \u003ccode\u003eA\u003c/code\u003e となり反変です。このようにデリゲートが反変の引数を受け付けることを\u003cstrong\u003e反変引数\u003c/strong\u003eと呼びます（あまり一般的な用語ではありません）。\u003c/p\u003e\n\n\u003cp\u003eここでも進行方向に対して広がることしか許されないという原則を満たしています。戻り値とは逆になっているのは、進行方向ではなくデリゲートを基準に見ているためです。戻り値では進行方向とは逆になっています。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/97bd04ded89e4109d4fe2c1a64d8199b0ce2a036/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33323035372f35356462376636362d316663362d396334362d633333642d3561373139346165613062612e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2F55db7f66-1fc6-9c46-c33d-5a7194aea0ba.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=ca49f9c2b453c7e3025328a49bc32eeb\" alt=\"18_共変・反変.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/32057/55db7f66-1fc6-9c46-c33d-5a7194aea0ba.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2F55db7f66-1fc6-9c46-c33d-5a7194aea0ba.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=7f870719b55b2f3a67f4b9a683fbf3c8 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eこのように共変・反変を考えるときは、どこを基準に見ているのかを押さえておかないと混乱します。\u003c/p\u003e\n\n\u003cp\u003e※ この図式を一般化して、入力に関係するものは反変、出力に関係するものは共変という図式を意識しておけば、この記事では言及しませんがジェネリックとの絡みも理解しやすくなるでしょう。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"オーバーライド\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%AA%E3%83%BC%E3%83%90%E3%83%BC%E3%83%A9%E3%82%A4%E3%83%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eオーバーライド\u003c/h1\u003e\n\n\u003cp\u003e派生クラスでメソッドをオーバーライドするケースを考えます。\u003c/p\u003e\n\n\u003cp\u003e引数の型を変えるとメソッドのオーバーロードとして扱われてしまうため、引数の型を変えることはできません。戻り値も型を変えるとエラーになります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eC#\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eA\u003c/span\u003e \u003cspan class=\"p\"\u003e{}\u003c/span\u003e\n\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eB\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eA\u003c/span\u003e \u003cspan class=\"p\"\u003e{}\u003c/span\u003e\n\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eC\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eB\u003c/span\u003e \u003cspan class=\"p\"\u003e{}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eTest1\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprotected\u003c/span\u003e \u003cspan class=\"k\"\u003evirtual\u003c/span\u003e \u003cspan class=\"n\"\u003eB\u003c/span\u003e \u003cspan class=\"nf\"\u003eApply\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eB\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eB\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eTest2\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eTest1\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprotected\u003c/span\u003e \u003cspan class=\"k\"\u003eoverride\u003c/span\u003e \u003cspan class=\"n\"\u003eB\u003c/span\u003e \u003cspan class=\"nf\"\u003eApply\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eA\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e  \u003cspan class=\"c1\"\u003e// エラー: オーバーライド元がない\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eB\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eprotected\u003c/span\u003e \u003cspan class=\"k\"\u003eoverride\u003c/span\u003e \u003cspan class=\"n\"\u003eC\u003c/span\u003e \u003cspan class=\"nf\"\u003eApply\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eB\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e  \u003cspan class=\"c1\"\u003e// エラー: 共変戻り値不可\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eC\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eこのようにオーバーライドでは型を変えることはできません。デリゲートの方が柔軟です。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"java\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#java\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eJava\u003c/h2\u003e\n\n\u003cp\u003e参考までにJavaのことを書いておきます。\u003c/p\u003e\n\n\u003cp\u003eJavaでも引数の型を変えるとオーバーロードとして扱われる点は同じですが、共変戻り値は認められています。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"java\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eJava\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eA\u003c/span\u003e \u003cspan class=\"o\"\u003e{}\u003c/span\u003e\n\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eB\u003c/span\u003e \u003cspan class=\"kd\"\u003eextends\u003c/span\u003e \u003cspan class=\"no\"\u003eA\u003c/span\u003e \u003cspan class=\"o\"\u003e{}\u003c/span\u003e\n\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eC\u003c/span\u003e \u003cspan class=\"kd\"\u003eextends\u003c/span\u003e \u003cspan class=\"no\"\u003eB\u003c/span\u003e \u003cspan class=\"o\"\u003e{}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eTest1\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003eprotected\u003c/span\u003e \u003cspan class=\"no\"\u003eB\u003c/span\u003e \u003cspan class=\"nf\"\u003eapply\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"no\"\u003eB\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eB\u003c/span\u003e\u003cspan class=\"o\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eTest2\u003c/span\u003e \u003cspan class=\"kd\"\u003eextends\u003c/span\u003e \u003cspan class=\"nc\"\u003eTest1\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003eprotected\u003c/span\u003e \u003cspan class=\"no\"\u003eB\u003c/span\u003e \u003cspan class=\"nf\"\u003eapply\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"no\"\u003eA\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e  \u003cspan class=\"c1\"\u003e// 単なるオーバーロード\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eB\u003c/span\u003e\u003cspan class=\"o\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"kd\"\u003eprotected\u003c/span\u003e \u003cspan class=\"no\"\u003eC\u003c/span\u003e \u003cspan class=\"nf\"\u003eapply\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"no\"\u003eB\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e  \u003cspan class=\"c1\"\u003e// OK: 共変戻り値\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eC\u003c/span\u003e\u003cspan class=\"o\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eJavaのメソッドはデフォルトでオーバーライドが可能なため、C#と異なり \u003ccode\u003evirtual\u003c/code\u003e, \u003ccode\u003eoverride\u003c/code\u003e キーワードはありません。逆に、オーバーライドを禁止するとき \u003ccode\u003efinal\u003c/code\u003e を明示します。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"参考\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8F%82%E8%80%83\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e参考\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://en.wikipedia.org/wiki/Covariant_return_type\" rel=\"nofollow noopener\" target=\"_blank\"\u003eCovariant return type\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://ja.wikipedia.org/wiki/%E5%85%B1%E5%A4%89%E6%80%A7%E3%81%A8%E5%8F%8D%E5%A4%89%E6%80%A7_(%E8%A8%88%E7%AE%97%E6%A9%9F%E7%A7%91%E5%AD%A6)\" rel=\"nofollow noopener\" target=\"_blank\"\u003e共変性と反変性 (計算機科学)\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n","createdAt":"2016-11-26T16:56:57Z","elapsedYearsFromLastModifiedAt":4,"encryptedId":"OJm9WVlqAekrQXvMEz6uC3t7oquFQXtO--OWwywfesIxJeuLgI--4NG5kOH4HQVZlonxAyp7/g==","isBanned":false,"isDeprecated":true,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2016-11-29T06:57:10Z","likesCount":103,"linkUrl":"https://qiita.com/7shi/items/39a222b5928bf0b6f745","organization":null,"originalId":441365,"stockedCount":85,"title":"共変戻り値と反変引数","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%B6%99%E6%89%BF\"\u003e継承\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%9B%B3%E3%81%AE%E4%BE%8B\"\u003e図の例\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%85%B1%E5%A4%89%E5%8F%8D%E5%A4%89\"\u003e共変・反変\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#ruby\"\u003eRuby\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%8F%82%E7%85%A7\"\u003e参照\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%8F%B3%E8%BE%BA%E3%81%AE%E5%9E%8B%E3%82%92%E5%A4%89%E5%8C%96\"\u003e右辺の型を変化\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%B7%A6%E8%BE%BA%E3%81%AE%E5%9E%8B%E3%82%92%E5%A4%89%E5%8C%96\"\u003e左辺の型を変化\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%85%B1%E5%A4%89%E3%81%A8%E3%82%A2%E3%83%83%E3%83%97%E3%82%AD%E3%83%A3%E3%82%B9%E3%83%88\"\u003e共変とアップキャスト\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89\"\u003eメソッド\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%BC%95%E6%95%B0\"\u003e引数\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%88%BB%E3%82%8A%E5%80%A4\"\u003e戻り値\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%8F%97%E3%81%91%E5%8F%96%E3%82%8A\"\u003e受け取り\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%87%E3%83%AA%E3%82%B2%E3%83%BC%E3%83%88\"\u003eデリゲート\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%85%B1%E5%A4%89%E6%88%BB%E3%82%8A%E5%80%A4\"\u003e共変戻り値\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%8F%8D%E5%A4%89%E5%BC%95%E6%95%B0\"\u003e反変引数\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%AA%E3%83%BC%E3%83%90%E3%83%BC%E3%83%A9%E3%82%A4%E3%83%89\"\u003eオーバーライド\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#java\"\u003eJava\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%8F%82%E8%80%83\"\u003e参考\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":16383,"uuid":"39a222b5928bf0b6f745","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"DLaj3DnZYxEr/9uDrdZrI62js2o=--23w3MQGc9QV4Nt8r--inmx4sZeBYeQbnZlkz8lBw==","originalId":32057,"description":"","facebookUrl":null,"githubUrl":null,"isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"","profileImageUrl":"https://qiita-image-store.s3.amazonaws.com/0/32057/profile-images/1473685823","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2Fprofile-images%2F1473685823?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=050373db111a10c8f77047dc7223ca42","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F32057%2Fprofile-images%2F1473685823?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=4c3ba9e38885eb4fc97bd058b57afbf9","urlName":"7shi","websiteUrl":null,"twitterUrl":"https://twitter.com/7shi","twitterUrlName":"7shi","revealedOrganizations":{"edges":[]}},"tags":[{"name":"C#","urlName":"csharp"}],"followingLikers":{"edges":[]},"comments":{"totalCount":1}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

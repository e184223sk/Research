More than 1 year has passed since last update.Unity-DOTSで作る2D弾幕シューティングの例の三回目です。という感じで弾を撃つわけですが、弾を撃つにあたって必要なIComponentDataの定義をしていきます。
基本的なルールとして定めているのは下記のようなものです。これを下記のようなIComponentDataで表現しています。Gunのパラメータが死ぬほど多いですね。
調整できる箇所は多いに越したことはないからしょうがないですね。例えば二つの銃を持つ敵を作成する、という場合、下記のような手順を踏みます。
1. 「敵である」かつ「射手である」というEntityを作成します。
2. 「親を持つ」かつ「銃である」というEntityを二つ作成し、1. のEntityの参照を持たせておきます
3. 「銃である」Entityは、それぞれ連射間隔や親が射撃可能な状態であるかということを処理しつつ、「弾である」Entityを作成していきます。敵のEntityを作成する箇所のコードを抜粋して記載します。ここでやっているのは下記のようなことです。
1. 敵EntityのComponentTypeを選定して、アーキタイプを作る
2. そのアーキタイプでEntityを作る
3. それぞれのコンポーネントに初期設定をするComponentTypeの設定について、ベタ書きしてあるのはすべての敵に共通するComponentTypeになります。
敵ごとに違ったアーキタイプを持ちたいという場合もあるかと思うので、①で作った外部DBに「敵が個別に持っているコンポーネント」の一覧テーブルを作成しておき、そのデータを起動時に読み込んでアーキタイプに追加する、というようなことをやっています。ステージキューの箇所で、敵のスポーンと武装が別のイベントになっていたのは、一つの敵に対して複数の銃を設定したかったためです。
何も銃を持っていない敵を出現させてから、それぞれの銃を個別に敵に載せていくというようなイメージになります。「親を持つ」という表現は銃に限らず「敵を親に持つ敵」も可能なので、多関節のようなものもこの形式で表現できるかと思います。
プレイヤーに関しては、「プレイヤーである」かつ「射手である」という形で表現できるので、同じくGunnerのIComponentDataが使えます。



More than 1 year has passed since last update.スマートフォンは各種センサーもりもり、通信インターフェース複数、RFIDリーダライタなど全部乗せのリッチなIoTデバイスです。
加速度センサー、磁気センサー、照度センサー、GPS（センサーか？）、Wifi、BlueTooth、カメラ、マイクetc etc...
実際、これらの機能をArduinoなどにモジュールで付け足していったら数万はいくんじゃないかなと思います。これらが安ければ1万円ぐらいで手に入るのです。すごいですよね。これらセンサーの値はアイデア次第でとても面白い使い方ができます。
問題はそのアイデアですが、そんな雲をつかむような話ではなく、ただセンサーの値を取得して眺めて幸せになるにはどうすればいいのか、という話です。Xamarin.Essentialsというライブラリを使うと、共通コードからこれらOS固有の機能を呼び出すことができます。
なので、まずはXamarin.EsssentialsをNuGetからインストールしましょう。
Visual StudioでXamrin.Formsのプロジェクトを作成、NuGetで「xamarin.essentials」と検索すれば出てきます。Xamarin.Essentialsを利用すると以下の機能をXamarin.Formsアプリの中で、OSごとの固有のコードではなく共通コードから使うことができます。
センサーだけでなくいろいろな端末の機能も使えます。
素晴らしい！こちらのXamarin.Essentialsの概要のページでは、機能概要の項のリストで各機能にリンクが張ってあります。それらのリンクの先には各機能の実装方法がコードとともに紹介されていて、そのとおりに実装するだけでその機能を使うことができるという、とても良いチュートリアルにもなっています。
これをもとに各機能の動きを確認してみるとよいでしょう。例えば、「コンパス」の使ってみましょう。
Xamarin.Formsのプロジェクトを作ってXamarin.Essentialsをインストールしてあるとします。
ちなみに、Xamarin.Essentialsは共通コードから使うので各OSのプロジェクトにではなく共通コードのプロジェクトにだけインストールします。
Xamarin.Essentialsのコンパス機能は、Compassクラスを使います。このクラスの使い方はとてもシンプルで、ReadingChangedイベントとStart、Stopメソッド、そして動いているかどうかの状態を表すIsMonitoringプロパティだけです。
データの取得頻度はSensorSpeed構造体をStartメソッドの引数として渡すことで指定することができます。ポイントは以下のとおりです。とても簡単ですね。
コンパスから取得した値をLabelコントロールに表示するだけのアプリケーションは以下のとおりです。公式サイトの説明を読んでいただいてもわかるとおり、とても簡単に端末の機能を使えることがわかると思います。
今回はコンパス機能を例に紹介しましたが、これが特別に簡単なわけではなく他の機能も大体こんな感じです。
各種センサーを簡単に、しかも共通のコードで複数のプラットフォームで使えるのですから、わくわくがとまりませんね。このコードはGitHubに公開してあります。
https://github.com/shuheydev/XamarinEssentialsCompassTestそして、Xamarin.Essentialsの機能をセンサーを中心にいろいろ突っ込んで表示させるアプリも公開しておきます。
https://github.com/shuheydev/XamarinFormsEssentialsTest各センサーのいろいろな値を表示するようになっています。
少なくともXamarin.Essentialsで取得できるセンサーの値をSensorSpeed.UIの速度で取得し続けますし、GPSが10秒おきに位置情報をとったりと割といい感じにバッテリーを消費していきます。
しかし、センサーの値が変化し続ける様子を見るのはきっと楽しいと思います。
おすすめです。



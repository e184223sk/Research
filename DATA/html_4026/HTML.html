<!DOCTYPE html><html><head><meta charset="utf-8" /><title>foreachについて本気出して調べてみた - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/NCT48/items/d8394d587e9fee969ca9" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="rCMyjVH8h/6YBu5p77sHNU2mEsMIsVoGu0nvtOxspsv2karKxToouGUnOfP9w7tztqtaQ+A4/gM08vPl7ELysg==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta property="og:type" content="article"><meta property="og:title" content="foreachについて本気出して調べてみた - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1abTl5WldGamFPT0JxLU9CcE9PQmhPT0JwdWFjck9hd2wtV0h1dU9CbC1PQnB1aXF2LU9CdWVPQnB1T0J2LU9CbncmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT01NCZ0eHQtY2xpcD1lbGxpcHNpcyZ0eHQtYWxpZ249Y2VudGVyJTJDbWlkZGxlJnM9MWQ1ZDdjNGFmZDczMjY4ZDljYzY4MmE2MDAwMmU3YTg&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RRTVEVkRRNCZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTQ1JnR4dC1hbGlnbj1yaWdodCUyQ2JvdHRvbSZzPTUzYjcxZWIwMGYzYjAzOWEwZDE3MmU2MWViNWI4OTUz&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=617947092be7a7e9244e24a0a9e99ace"><meta property="og:description" content="

はじめに

前回 はList＜T＞について、色々と書いて見ました。

今回は前回割愛したもののうち、foreachついて色々書きたいと思います。

おまけ程度にVisual Studioのおかしな挙動についても少し書いてます。

..."><meta content="https://qiita.com/NCT48/items/d8394d587e9fee969ca9" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#,VisualStudio" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 1nzh4zz 38fzdi helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-1nzh4zz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:16px 32px;background-color:#FBE69E;color:rgba(0,0,0,0.87);line-height:1.5;font-weight:600;}@media (max-width:770px){.css-1nzh4zz{padding:16px;}}.css-38fzdi{color:#CA832A;margin-right:4px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-528c9f9c-a0c9-41e0-ba6f-4e403ba97d65"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2FNCT48%2Fitems%2Fd8394d587e9fee969ca9">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2FNCT48%2Fitems%2Fd8394d587e9fee969ca9">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-528c9f9c-a0c9-41e0-ba6f-4e403ba97d65">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2019-01-15T17:01:54.000+09:00","dateModified":"2019-01-17T09:17:22.000+09:00","headline":"foreachについて本気出して調べてみた","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1abTl5WldGamFPT0JxLU9CcE9PQmhPT0JwdWFjck9hd2wtV0h1dU9CbC1PQnB1aXF2LU9CdWVPQnB1T0J2LU9CbncmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT01NCZ0eHQtY2xpcD1lbGxpcHNpcyZ0eHQtYWxpZ249Y2VudGVyJTJDbWlkZGxlJnM9MWQ1ZDdjNGFmZDczMjY4ZDljYzY4MmE2MDAwMmU3YTg\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RRTVEVkRRNCZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTQ1JnR4dC1hbGlnbj1yaWdodCUyQ2JvdHRvbSZzPTUzYjcxZWIwMGYzYjAzOWEwZDE3MmU2MWViNWI4OTUz\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=617947092be7a7e9244e24a0a9e99ace","mainEntityOfPage":"https://qiita.com/NCT48/items/d8394d587e9fee969ca9","author":{"@type":"Person","address":"静岡","email":null,"identifier":"NCT48","name":"NCT48","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Favatars0.githubusercontent.com%2Fu%2F44828045%3Fv%3D4?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=43d79fdd304f677acc9fb57f5123633e","url":"https://qiita.com/NCT48","description":"モチベが上がらないだけで生きてますよ","memberOf":[]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://increments.connpass.com/event/211948/">Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催</a><a target="_blank" id="header_text_message_2" href="https://increments.connpass.com/event/211948/">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"NCT48","type":"items","id":"d8394d587e9fee969ca9"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"NCT48","type":"items","id":"d8394d587e9fee969ca9"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_1","message":"Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"NCT48","type":"items","id":"d8394d587e9fee969ca9"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_2","message":"Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/NCT48/items/d8394d587e9fee969ca9","location":"/NCT48/items/d8394d587e9fee969ca9","scheme":"https","host":"qiita.com","port":null,"pathname":"/NCT48/items/d8394d587e9fee969ca9","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"6sw+3hNRmPhj2Smt7Vo0fFSnwQ8G+GSzKKEqMau+f72wfqaZh5c3vp74/jf/Iog6r6qJj+5xwLanGjZgq5ArxA==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-4a1cab1a-3844-49cc-9e73-728403dab12b"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/NCT48/items/d8394d587e9fee969ca9/likers" class="css-1iupg5d">54</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">39</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/d8394d587e9fee969ca9/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/NCT48/items/d8394d587e9fee969ca9/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/NCT48/items/d8394d587e9fee969ca9/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/NCT48/items/d8394d587e9fee969ca9/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/NCT48/items/d8394d587e9fee969ca9.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-1nzh4zz"><span class="fa fa-fw fa-warning css-38fzdi"></span><p>More than 1 year has passed since last update.</p></div><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/NCT48"><img class="css-100alwu eyfquo10" src="https://avatars0.githubusercontent.com/u/44828045?v=4" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/NCT48" class="css-10ougpm">@<!-- -->NCT48</a><div class="css-1ay9vb9"><span><meta content="2019-01-15T08:01:54Z"/><time dateTime="2019-01-17T00:17:22Z" class="css-m19uds">updated at 2019-01-17</time></span></div></div></div></div></div><h1 class="css-cgzq40">foreachについて本気出して調べてみた</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/visualstudio" class="css-4czcte">VisualStudio</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div>
<h1>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h1>

<p><a href="https://qiita.com/NCT48/items/5ca2df4e3dbd053cd9f7" id="reference-0469dfdbc9038f596876">前回</a> はList＜T＞について、色々と書いて見ました。</p>

<p>今回は前回割愛したもののうち、<code>foreach</code>ついて色々書きたいと思います。</p>

<p>おまけ程度にVisual Studioのおかしな挙動についても少し書いてます。</p>

<p>C#が用意している構文の中身について知りたい<del>ちょっと変わった</del>人向けです。</p>

<p>今回も独学で書いている部分が多いので、間違ってたらガンガン指摘してください。</p>

<p><del>タイトルは特に思いつかなかったので前回と同じなのは秘密。</del></p>

<h1>
<span id="foreachとは" class="fragment"></span><a href="#foreach%E3%81%A8%E3%81%AF"><i class="fa fa-link"></i></a>foreachとは</h1>

<p><code>List</code>や配列等の要素を1つずつ取り出すための構文。</p>

<p>「C#入門」とか「初心者向けC#」とか読んでも必ず出てくる。</p>

<p>実は内部で結構複雑なことをやってるけど、それをおくびにも出さない凄いお方。</p>

<p>最近はLINQに出番を奪われることもあるが、まだまだ現役バリバリ。</p>

<h1>
<span id="foreachのあれやこれや" class="fragment"></span><a href="#foreach%E3%81%AE%E3%81%82%E3%82%8C%E3%82%84%E3%81%93%E3%82%8C%E3%82%84"><i class="fa fa-link"></i></a>foreachのあれやこれや</h1>

<h2>
<span id="foreachってどうなってるの" class="fragment"></span><a href="#foreach%E3%81%A3%E3%81%A6%E3%81%A9%E3%81%86%E3%81%AA%E3%81%A3%E3%81%A6%E3%82%8B%E3%81%AE"><i class="fa fa-link"></i></a>foreachってどうなってるの？</h2>

<p>まずはソースコードから。</p>

<div class="code-frame" data-lang="c#"><div class="highlight"><pre class="with-code"><code><span class="kt">var</span> <span class="n">listStr</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;()</span> <span class="p">{</span> <span class="s">"aaa"</span><span class="p">,</span> <span class="s">"abc"</span><span class="p">,</span> <span class="s">"bbc"</span><span class="p">,</span> <span class="s">"aba"</span><span class="p">,</span> <span class="s">"cbc"</span><span class="p">,</span> <span class="s">"bcc"</span> <span class="p">};</span>

<span class="k">foreach</span> <span class="p">(</span><span class="kt">string</span> <span class="n">item</span> <span class="k">in</span> <span class="n">listStr</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="s">"a"</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p><code>List</code>を使ったことがあるのに、<code>foreach</code>を使った事が無い人はいないと思います。</p>

<p><code>for</code>で書いていた、</p>

<ul>
<li>初期化条件</li>
<li>終了条件</li>
<li>インクリメント条件</li>
</ul>

<p>がいらないので、非常に便利です。勝手に最初から最後までやってくれます。</p>

<p>でも、いらないと言っても誰かが条件を設定しなければならないはずです。誰がやってくれてるんでしょうかね？</p>

<p>その秘密は<code>foreach</code>の真の姿に隠されています。</p>

<p>2019/01/17</p>

<p>大嘘でした。(2回目)</p>

<p>インターフェース越しに展開すると仮想呼び出しのコストが掛かるので、<code>List&lt;T&gt;</code>内部の構造体に展開されます。(情報ありがとうございます。)</p>

<div class="code-frame" data-lang="c#"><div class="highlight"><pre class="with-code"><code><span class="kt">var</span> <span class="n">listStr</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;()</span> <span class="p">{</span> <span class="s">"aaa"</span><span class="p">,</span> <span class="s">"abc"</span><span class="p">,</span> <span class="s">"bbc"</span><span class="p">,</span> <span class="s">"aba"</span><span class="p">,</span> <span class="s">"cbc"</span><span class="p">,</span> <span class="s">"bcc"</span> <span class="p">};</span>

<span class="c1">//(1)</span>
<span class="c1">//IEnumerator&lt;string&gt; e = listStr.GetEnumerator();</span>
<span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;.</span><span class="n">Enumerator</span> <span class="n">e</span> <span class="p">=</span> <span class="n">listStr</span><span class="p">.</span><span class="nf">GetEnumerator</span><span class="p">();</span>
<span class="c1">//(2)</span>
<span class="k">while</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="nf">MoveNext</span><span class="p">())</span>
<span class="p">{</span>
    <span class="c1">//(3)</span>
    <span class="kt">string</span> <span class="n">item</span> <span class="p">=</span> <span class="n">e</span><span class="p">.</span><span class="n">Current</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="s">"a"</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p><code>foreach</code>はコンパイルするとこんな感じに展開されます。</p>

<p>突然大量の見たこともないメソッドやらプロパティやらが溢れてきて面食らいますが、一つ一つ解説していきますので安心(?)してください。</p>

<p>話がそれますが、今回のように「実際に利用者が書いたコード」と「コンパイラの展開結果」が一致しないことは多々あります。</p>

<p>これは<strong>シンタックスシュガー</strong>と呼ばれる機能で、糖衣構文なんて呼んだりもします。</p>

<p>話を戻して、まずは(1)を見てください。</p>

<div class="code-frame" data-lang="c#"><div class="highlight"><pre class="with-code"><code><span class="c1">//(1)</span>
<span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;.</span><span class="n">Enumerator</span> <span class="n">e</span> <span class="p">=</span> <span class="n">listStr</span><span class="p">.</span><span class="nf">GetEnumerator</span><span class="p">();</span>
</code></pre></div></div>

<p><code>GetEnumerator</code>は、<code>List</code>クラスのメソッドです。</p>

<div class="code-frame" data-lang="c#"><div class="highlight"><pre class="with-code"><code><span class="n">IEnumerator</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;.</span><span class="nf">GetEnumerator</span><span class="p">()</span> 
<span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">Enumerator</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>突然出てきました。<code>IEnumerable&lt;T&gt;</code>インターフェースと<code>IEnumerator&lt;T&gt;</code>インターフェース、そして<code>Enumerator</code>構造体です。</p>

<p>順番に解説してきましょう。</p>

<h2>
<span id="ienumerabletインターフェースってなに" class="fragment"></span><a href="#ienumerablet%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9%E3%81%A3%E3%81%A6%E3%81%AA%E3%81%AB"><i class="fa fa-link"></i></a>IEnumerable＜T＞インターフェースってなに？</h2>

<p><del>実は、<code>foreach</code>が受け入れる事が出来る変数は、<strong>必ず<code>IEnumerable&lt;T&gt;</code>を継承している</strong>必要があります。</del></p>

<p>2019/01/16<br>
大嘘でした。正しくは、</p>

<ol>
<li>
<code>foreach</code>に投げる型が、<code>GetEnumerator</code>を実装している。</li>
<li>
<code>GetEnumerator</code>の戻り値の型が、<code>MoveNext</code>メソッドとパブリックな<code>Curent</code>プロパティを実装している。</li>
</ol>

<p>上記2つを満たしている必要があります。(情報ありがとうございます。)</p>

<p>I(インターフェース) + Enumerate(...を数え上げる) + able(出来る)なので、「数え上げる事が出来る(ことを規約する)インターフェース」といった感じの意味になります。(英語は苦手なので間違ってるかもしれません)</p>

<div class="code-frame" data-lang="c#"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">interface</span> <span class="nc">IEnumerable</span><span class="p">&lt;</span><span class="k">out</span> <span class="n">T</span><span class="p">&gt;</span> <span class="p">:</span> <span class="n">IEnumerable</span>
<span class="p">{</span>
    <span class="k">new</span> <span class="n">IEnumerator</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="nf">GetEnumerator</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<p>メソッドは1つのみです。ジェネリクスで指定された型の<code>IEnumerator&lt;T&gt;</code>を返すメソッドです。</p>

<p>ここで、改めて<code>List</code>クラスの定義を見てみます。</p>

<div class="code-frame" data-lang="c#"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">List</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="p">:</span> <span class="n">IList</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;,</span> <span class="n">System</span><span class="p">.</span><span class="n">Collections</span><span class="p">.</span><span class="n">IList</span><span class="p">,</span> <span class="n">IReadOnlyList</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span>
</code></pre></div></div>

<p><code>List</code>クラスが直接継承しているインターフェースは、<code>IList&lt;T&gt;</code>, <code>IList</code>, <code>IReadOnlyList&lt;T&gt;</code>の3つです。</p>

<p>そして、<code>IList&lt;T&gt;</code>は<code>ICollection&lt;T&gt;</code>を、<code>ICollection&lt;T&gt;</code>は<code>IEnumerable&lt;T&gt;</code>を、<code>IEnumerable&lt;T&gt;</code>は<code>IEnumerable</code>を継承しています。</p>

<p>さらに、<code>IList</code>は<code>ICollection</code>を、<code>ICollection</code>は<code>IEnumerable</code>を継承しています。</p>

<p>最後に、<code>IReadOnlyList&lt;T&gt;</code>は<code>IReadOnlyCollection&lt;T&gt;</code>を、<code>IReadOnlyCollection&lt;T&gt;</code>は<code>IEnumerable&lt;T&gt;</code>を、継承しています。</p>

<p>継承祭りですね。てんやわんやなので少し整理すると、Listクラスが継承しているインターフェースは、</p>

<ul>
<li><code>IList&lt;T&gt;</code></li>
<li><code>IList</code></li>
<li><code>ICollection&lt;T&gt;</code></li>
<li><code>ICollection</code></li>
<li><code>IEnumerable&lt;T&gt;</code></li>
<li><code>IEnumerable</code></li>
<li><code>IReadOnlyList&lt;T&gt;</code></li>
<li><code>IReadOnlyCollection&lt;T&gt;</code></li>
</ul>

<p>となります。</p>

<p>先述の通り、<code>IEnumerable&lt;T&gt;</code>を継承してるので、<code>foreach</code>は<code>List</code>を受け入れる事が可能です。</p>

<h3>
<span id="なんで同じ名前でジェネリクスしてたりしてなかったりするの" class="fragment"></span><a href="#%E3%81%AA%E3%82%93%E3%81%A7%E5%90%8C%E3%81%98%E5%90%8D%E5%89%8D%E3%81%A7%E3%82%B8%E3%82%A7%E3%83%8D%E3%83%AA%E3%82%AF%E3%82%B9%E3%81%97%E3%81%A6%E3%81%9F%E3%82%8A%E3%81%97%E3%81%A6%E3%81%AA%E3%81%8B%E3%81%A3%E3%81%9F%E3%82%8A%E3%81%99%E3%82%8B%E3%81%AE"><i class="fa fa-link"></i></a>なんで同じ名前でジェネリクスしてたり、してなかったりするの？</h3>

<p>また少し話がそれますが、<code>&lt;T&gt;</code>はジェネリクスだよ。って事は前回お話しました。</p>

<p>「<code>IList&lt;T&gt;</code>と<code>IList</code>って何がちゃうねん、コラ」と思う方もいると思います。</p>

<p>C#にジェネリクスの機能が追加されたのは、2005年、C#の2.0からです。</p>

<p>(僕がまだギリギリランドセルを背負ってたくらい昔の話です。)</p>

<p><code>IList</code>、<code>ICollection</code>、<code>IEnumerable</code>はそれ以前からC#に存在している方々です。</p>

<p>ジェネリクスが存在しないので、当然<code>List&lt;T&gt;</code>も存在しません。</p>

<p>このころは<code>List</code>的な物を使いたい場合、取り扱う型ごとに違うクラス、もしくは<code>object</code>で全てを受け入れるクラスを作っていたんだと思います。(<strong>推測です。</strong>このころの事は全然知らないので詳しい方、教えてください。)</p>

<p>これでは不便だろうと言うことで、ジェネリクスが誕生しました。そして、<code>IList&lt;T&gt;</code>、<code>ICollection&lt;T&gt;</code>、<code>IEnumerable&lt;T&gt;</code>、そして<code>List&lt;T&gt;</code>も合わせて生まれます。</p>

<p>誕生した所までは良かったんですが、「じゃあ今まで使ってたジェネリクスしてない(非ジェネリクス)コードはどうするんだ？」問題が発生します。</p>

<p>過去のコードが使用できなくなるような変更を<strong>破壊的変更</strong>と言いますが、C#は破壊的変更を避けるようにかなり慎重に機能の追加・修正を行っています。(破壊的変更を避けるのは、C#に限った話ではありませんけども)</p>

<p>そんな経緯があるので、非ジェネリクスインターフェースは残っています。</p>

<p><code>IReadOnlyList&lt;T&gt;</code>は、.Net Framework 4.5で追加された機能です。2012年、C#は5.0のなのでこんな話とは無縁です。なので、非ジェネリクスなインターフェースはいません。</p>

<p>(僕が社会人になる3年くらい前です。ずいぶんと最近な気がしますね。)</p>

<h2>
<span id="ienumeratortインターフェースってなに" class="fragment"></span><a href="#ienumeratort%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9%E3%81%A3%E3%81%A6%E3%81%AA%E3%81%AB"><i class="fa fa-link"></i></a>IEnumerator＜T＞インターフェースってなに？</h2>

<p><code>IEnumerable&lt;T&gt;</code>は<code>List</code>が継承していました。では、<code>IEnumerator&lt;T&gt;</code>はどこにあるんでしょうか？</p>

<p>こいつは<code>Enumerator</code>構造体が継承しています。まず先に、<code>IEnumerator&lt;T&gt;</code>の定義から。</p>

<p>I(インターフェース) + Enumerate(...を数え上げる) + or(もの)なので、「数え上げる処理をする(ことを規約する)インターフェース」といった感じの意味になります。(英語は苦手なので以下略)</p>

<p><code>IEnumerator</code>には2つのメソッドと1つのプロパティが、<code>IEnumerator&lt;T&gt;</code>には1つのプロパティがあります。</p>

<div class="code-frame" data-lang="c#"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">interface</span> <span class="nc">IEnumerator</span>
<span class="p">{</span>
    <span class="kt">bool</span> <span class="nf">MoveNext</span><span class="p">();</span>
    <span class="n">Object</span> <span class="n">Current</span> 
    <span class="p">{</span>
        <span class="k">get</span><span class="p">;</span> 
    <span class="p">}</span>
    <span class="k">void</span> <span class="nf">Reset</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">interface</span> <span class="nc">IEnumerator</span><span class="p">&lt;</span><span class="k">out</span> <span class="n">T</span><span class="p">&gt;</span> <span class="p">:</span> <span class="n">IDisposable</span><span class="p">,</span> <span class="n">IEnumerator</span>
<span class="p">{</span>    
    <span class="k">new</span> <span class="n">T</span> <span class="n">Current</span> 
    <span class="p">{</span>
        <span class="k">get</span><span class="p">;</span> 
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p><code>foreach</code>は<code>IEnumerator</code>の<code>MoveNext</code>メソッドと<code>IEnumerator&lt;T&gt;</code>の<code>Current</code>プロパティを使用しています。</p>

<p>(本当は<code>IDisposable</code>の<code>Dispose</code>も使用しているのですが、<code>List</code>の場合、処理なしで実装されているので割愛)</p>

<h2>
<span id="enumerator構造体ってなに" class="fragment"></span><a href="#enumerator%E6%A7%8B%E9%80%A0%E4%BD%93%E3%81%A3%E3%81%A6%E3%81%AA%E3%81%AB"><i class="fa fa-link"></i></a>Enumerator構造体ってなに？</h2>

<p>この<code>Enumerator</code>構造体ですが、<code>List</code>クラスの内部に定義されているローカル構造体です。</p>

<div class="code-frame" data-lang="c#"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">struct</span> <span class="nc">Enumerator</span> <span class="p">:</span> <span class="n">IEnumerator</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;,</span> <span class="n">System</span><span class="p">.</span><span class="n">Collections</span><span class="p">.</span><span class="n">IEnumerator</span>
</code></pre></div></div>

<p><code>Enumerator</code>は、<code>IEnumerator&lt;T&gt;</code>と<code>IEnumerator</code>を継承しています。</p>

<p>そして、<code>IEnumerator&lt;T&gt;</code>は、<code>IDisposable</code>と<code>IEnumerator</code>を継承しています。</p>

<p>なので<code>Enumerator</code>構造体が継承しているインターフェースは、</p>

<ul>
<li><code>IEnumerator&lt;T&gt;</code></li>
<li><code>IEnumerator</code></li>
<li><code>IDisposable</code></li>
</ul>

<p>となります。</p>

<p>説明し終わったところで、改めて(1)に戻ります。</p>

<div class="code-frame" data-lang="c#"><div class="highlight"><pre class="with-code"><code><span class="c1">//(1)</span>
<span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;.</span><span class="n">Enumerator</span> <span class="n">e</span> <span class="p">=</span> <span class="n">listStr</span><span class="p">.</span><span class="nf">GetEnumerator</span><span class="p">();</span>

</code></pre></div></div>

<div class="code-frame" data-lang="c#"><div class="highlight"><pre class="with-code"><code><span class="n">IEnumerator</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;.</span><span class="nf">GetEnumerator</span><span class="p">()</span> 
<span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">Enumerator</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="p">}</span>

</code></pre></div></div>

<p><code>GetEnumerator</code>が呼び出された時、<code>Enumerator</code>のコンストラクタを実行しています。</p>

<p>引数は<code>this</code>なので、<code>List</code>自身ですね。</p>

<p><code>Enumerator</code>のコンストラクタとフィールドはこうなっています。</p>

<div class="code-frame" data-lang="c#"><div class="highlight"><pre class="with-code"><code><span class="k">private</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n">list</span><span class="p">;</span>
<span class="k">private</span> <span class="kt">int</span> <span class="n">index</span><span class="p">;</span>
<span class="k">private</span> <span class="kt">int</span> <span class="n">version</span><span class="p">;</span>
<span class="k">private</span> <span class="n">T</span> <span class="n">current</span><span class="p">;</span>

<span class="k">internal</span> <span class="nf">Enumerator</span><span class="p">(</span><span class="n">List</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n">list</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="n">list</span> <span class="p">=</span> <span class="n">list</span><span class="p">;</span>
    <span class="n">index</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
    <span class="n">version</span> <span class="p">=</span> <span class="n">list</span><span class="p">.</span><span class="n">_version</span><span class="p">;</span>
    <span class="n">current</span> <span class="p">=</span> <span class="k">default</span><span class="p">(</span><span class="n">T</span><span class="p">);</span>
<span class="p">}</span>

</code></pre></div></div>

<p>順を追ってみると、</p>

<ol>
<li>
<code>GetEnumerator</code>が呼び出された時、コンストラクタの引数に<code>List</code>自身を渡す。</li>
<li>
<code>Enumerator</code>内のフィールドにて、渡された<code>List</code>、初期<code>index</code>、渡された時点での<code>_version</code>、<code>current</code>を設定。</li>
</ol>

<p>これで終わりです。とてもシンプルですね。</p>

<p>次に(2)です。</p>

<div class="code-frame" data-lang="C#"><div class="highlight"><pre class="with-code"><code><span class="c1">//(2)</span>
<span class="k">while</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="nf">MoveNext</span><span class="p">())</span>

</code></pre></div></div>

<p>ループ処理の終了条件です。<code>Enumerator</code>内の実装はこうなっています。</p>

<div class="code-frame" data-lang="c#"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="kt">bool</span> <span class="nf">MoveNext</span><span class="p">()</span> 
<span class="p">{</span> 
    <span class="n">List</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n">localList</span> <span class="p">=</span> <span class="n">list</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">version</span> <span class="p">==</span> <span class="n">localList</span><span class="p">.</span><span class="n">_version</span> <span class="p">&amp;&amp;</span> <span class="p">((</span><span class="kt">uint</span><span class="p">)</span><span class="n">index</span> <span class="p">&lt;</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span><span class="n">localList</span><span class="p">.</span><span class="n">_size</span><span class="p">))</span> 
    <span class="p">{</span>                                                     
        <span class="n">current</span> <span class="p">=</span> <span class="n">localList</span><span class="p">.</span><span class="n">_items</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>                    
        <span class="n">index</span><span class="p">++;</span>
        <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nf">MoveNextRare</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">private</span> <span class="kt">bool</span> <span class="nf">MoveNextRare</span><span class="p">()</span>
<span class="p">{</span>                
    <span class="k">if</span> <span class="p">(</span><span class="n">version</span> <span class="p">!=</span> <span class="n">list</span><span class="p">.</span><span class="n">_version</span><span class="p">)</span> 
    <span class="p">{</span>
        <span class="n">ThrowHelper</span><span class="p">.</span><span class="nf">ThrowInvalidOperationException</span><span class="p">(</span><span class="n">ExceptionResource</span><span class="p">.</span><span class="n">InvalidOperation_EnumFailedVersion</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">index</span> <span class="p">=</span> <span class="n">list</span><span class="p">.</span><span class="n">_size</span> <span class="p">+</span> <span class="m">1</span><span class="p">;</span>
    <span class="n">current</span> <span class="p">=</span> <span class="k">default</span><span class="p">(</span><span class="n">T</span><span class="p">);</span>
    <span class="k">return</span> <span class="k">false</span><span class="p">;</span>                
<span class="p">}</span>

</code></pre></div></div>

<p>まず、コンストラクタで保存した<code>version</code>と<code>localList._version</code>が一致していて、<code>index</code>が0以上かつ、<code>localList._size</code>未満であるか確認しています。</p>

<p>条件を満たしていた場合は、<code>current</code>フィールドの値を書き換えて、<code>index</code>をインクリメント。次に進むことが出来たので<code>true</code>を返して終了です。</p>

<p>条件を満たしていない場合は、<code>version</code>と<code>localList._version</code>を確認し、一致していなければ<code>InvalidOperationException</code>を発行。そうでない場合は、`<code>current</code>を初期化。次に進めなかったので、<code>false</code>を返して終了です。</p>

<p>つまり、</p>

<ol>
<li>
<code>version</code>と<code>localList._version</code>が一致していない。→ <code>InvalidOperationException</code>を発行。</li>
<li>
<code>index</code>が0以上かつ、<code>localList._size</code>未満。→ <code>current</code>に値を設定して<code>true</code>を返す。</li>
<li>それ以外の場合。 → <code>current</code>を初期化してして<code>false</code>を返す。</li>
</ol>

<p>こうやってループの終了を判定しているんですね。(優先順位は上から)</p>

<p><a href="https://qiita.com/NCT48/items/5ca2df4e3dbd053cd9f7">前回</a>の記事の「コレクションの変更ってどうなってるの？」で割愛した「<code>foerach</code>も似たようなことをやっています。」がこの部分になります。</p>

<p>最後に(3)です。</p>

<div class="code-frame" data-lang="c#"><div class="highlight"><pre class="with-code"><code> <span class="c1">//(3)</span>
<span class="kt">string</span> <span class="n">item</span> <span class="p">=</span> <span class="n">e</span><span class="p">.</span><span class="n">Current</span><span class="p">;</span>

</code></pre></div></div>

<div class="code-frame" data-lang="c#"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="n">T</span> <span class="n">Current</span> 
<span class="p">{</span>
    <span class="k">get</span> 
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">current</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<p>ただのゲッターなので、特に言うこともありません。(2)で設定した値を取得しています。</p>

<h2>
<span id="これを知ってると何が出来るの" class="fragment"></span><a href="#%E3%81%93%E3%82%8C%E3%82%92%E7%9F%A5%E3%81%A3%E3%81%A6%E3%82%8B%E3%81%A8%E4%BD%95%E3%81%8C%E5%87%BA%E6%9D%A5%E3%82%8B%E3%81%AE"><i class="fa fa-link"></i></a>これを知ってると何が出来るの？</h2>

<p>自作のクラスを<code>foreach</code>に渡す事が出来るようになります！<del>おそらく意味はない</del></p>

<p><del>正直面倒くさいだけで</del>実用性は皆無ですが、勉強としては意味がある...んじゃないですかね。多分。</p>

<p>実際に作ってみました。</p>

<p>満たすべき要件</p>

<ol>
<li>要素を<code>Add</code>で追加できる。(メソッドの作成)</li>
<li>要素を<code>foreach</code>で取り出せる。(インターフェースの実装)</li>
</ol>

<p>この2つだけです。なので、取り出し時は入れた時とは逆順で出てきます。削除もインデクサでの取り出しも出来ません。それでいいんです、自作なので。</p>

<p>まずは<code>ListModoki</code>の作成です。</p>

<div class="code-frame" data-lang="c#"><div class="highlight"><pre class="with-code"><code><span class="k">partial</span> <span class="k">class</span> <span class="nc">ListModoki</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="p">:</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="n">ListValue</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n">head</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">void</span> <span class="nf">Add</span><span class="p">(</span><span class="n">T</span> <span class="n">v</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">head</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ListValue</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;(</span><span class="n">v</span><span class="p">,</span> <span class="n">head</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="n">IEnumerator</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="nf">GetEnumerator</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">ListNakami</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;(</span><span class="n">head</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">IEnumerator</span> <span class="n">IEnumerable</span><span class="p">.</span><span class="nf">GetEnumerator</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">ListNakami</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;(</span><span class="n">head</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<p><code>IEnumerable&lt;T&gt;</code>の部分です。(説明用にクラスをpartialで分割してますが、本来は不要です。)</p>

<p>先頭位置を記憶するための<code>head</code>を持っています。<code>ListValue&lt;T&gt;</code>は、値と次の要素を持ったクラスです(詳細は後述)。</p>

<div class="code-frame" data-lang="c#"><div class="highlight"><pre class="with-code"><code><span class="k">partial</span> <span class="k">class</span> <span class="nc">ListModoki</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="k">class</span> <span class="nc">ListNakami</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="p">:</span> <span class="n">IEnumerator</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span>
    <span class="p">{</span>
        <span class="k">private</span> <span class="n">ListValue</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n">current</span><span class="p">;</span>

        <span class="k">public</span> <span class="nf">ListNakami</span><span class="p">(</span><span class="n">ListValue</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n">current</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="n">current</span> <span class="p">=</span> <span class="n">current</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="n">T</span> <span class="n">Current</span>
        <span class="p">{</span>
            <span class="k">get</span>
            <span class="p">{</span>
                <span class="n">ListValue</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n">c</span> <span class="p">=</span> <span class="n">current</span><span class="p">;</span>
                <span class="n">current</span> <span class="p">=</span> <span class="n">c</span><span class="p">.</span><span class="n">Next</span><span class="p">;</span>
                <span class="k">return</span> <span class="n">c</span><span class="p">.</span><span class="n">Value</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="kt">object</span> <span class="n">IEnumerator</span><span class="p">.</span><span class="n">Current</span>
        <span class="p">{</span>
            <span class="k">get</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="n">Current</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="kt">bool</span> <span class="nf">MoveNext</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">current</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Dispose</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">Reset</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<p><code>IEnumerator&lt;T&gt;</code>の部分です。内部クラスとして定義してます。</p>

<p><code>Current</code>で値を取得する時についでに、次に進めています。</p>

<p>今回は<del>面倒なので</del>ここでしか使わないので<code>Current</code>に副作用を持たせていますが、<strong>かなり危険な行為</strong>です。</p>

<p>理由は一番最後におまけで書いておくので、読んでください。</p>

<div class="code-frame" data-lang="c#"><div class="highlight"><pre class="with-code"><code><span class="k">class</span> <span class="nc">ListValue</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="n">T</span> <span class="n">Value</span><span class="p">;</span>
    <span class="k">public</span> <span class="n">ListValue</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n">Next</span><span class="p">;</span>

    <span class="k">public</span> <span class="nf">ListValue</span><span class="p">(</span><span class="n">T</span> <span class="k">value</span><span class="p">,</span> <span class="n">ListValue</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n">next</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Value</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span>
        <span class="n">Next</span> <span class="p">=</span> <span class="n">next</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<p>最後に<code>ListModoki</code>の中身、<code>ListValue</code>です。自分の値と次の中身を持っています。</p>

<div class="code-frame" data-lang="c#"><div class="highlight"><pre class="with-code"><code><span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">ListModoki</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">modoki</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ListModoki</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;();</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="m">10</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
    <span class="p">{</span>
        <span class="n">modoki</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">foreach</span> <span class="p">(</span><span class="kt">int</span> <span class="n">item</span> <span class="k">in</span> <span class="n">modoki</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<p>実際に0から9まで値を追加した後、順番に取り出していきます。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>9
8
7
6
5
4
3
2
1
0
</code></pre></div></div>

<p>最初に言い訳したとおり、入れた時とは逆の順番で出てきます。さらに、インデクサでのアクセスが出来ないので、<code>for</code>は使用できません。(超不便)</p>

<p>既存のクラスでは実現できない要求が来た時に、覚えておくと役に立つ可能性は否定出来ないんじゃないかと思います。(超弱気)</p>

<h1>
<span id="おわりに" class="fragment"></span><a href="#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB"><i class="fa fa-link"></i></a>おわりに</h1>

<p>前回書けなかった部分のうち<code>IEnumerable&lt;T&gt;</code>について書こうと思ってたら<code>foreach</code>の話になってました。</p>

<p>自作の<code>ListModoki</code>を要求されることはまず無いと思います。どう考えても<code>List</code>の方が万能です。</p>

<p>次の内容は未定です。次があるかどうかも未定です。</p>

<h1>
<span id="おまけvisual-studioのバグ" class="fragment"></span><a href="#%E3%81%8A%E3%81%BE%E3%81%91visual-studio%E3%81%AE%E3%83%90%E3%82%B0"><i class="fa fa-link"></i></a>おまけ:Visual Studioのバグ...？</h1>

<p>ゲッターに副作用を持たせた状態で、Visual Studioでデバックを行うと<strong>バグ</strong>ります。</p>

<p>ウォッチ式やマウスオーバーした時に出るアレ(名前を知らない)で値を確認するたびに、<strong>その副作用が実行されます。</strong>今回の場合、勝手に<code>current</code>が進んでいきます。</p>

<p>結構深刻なバグの元になりかねないので、<strong>ゲッターに副作用を持たせるのは止めましょう</strong>。</p>

<p>簡単なテストを行なった画像を下に貼っておきます。(Visual Studio 2017です。)</p>

<p><a href="https://camo.qiitausercontent.com/c1458cff7eafb173b1ded64dc0c80c6c317172ac/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3331313935352f30633932373632332d343936302d353763622d623062662d3832363630313864336137332e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F311955%2F0c927623-4960-57cb-b0bf-8266018d3a73.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=73bfdfef4f1b820e816b86d9c4c969ae" alt="getter.PNG" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/311955/0c927623-4960-57cb-b0bf-8266018d3a73.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F311955%2F0c927623-4960-57cb-b0bf-8266018d3a73.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=4eb96658cfcf04c428a72088173658b4 1x" loading="lazy"></a></p>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2FNCT48%2Fitems%2Fd8394d587e9fee969ca9&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2FNCT48%2Fitems%2Fd8394d587e9fee969ca9&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/NCT48/items/d8394d587e9fee969ca9/likers" class="css-1iupg5d">54</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">39</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/d8394d587e9fee969ca9/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/NCT48/items/d8394d587e9fee969ca9/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/NCT48/items/d8394d587e9fee969ca9/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/NCT48/items/d8394d587e9fee969ca9/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/NCT48/items/d8394d587e9fee969ca9.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-4a1cab1a-3844-49cc-9e73-728403dab12b">{"authorAnalyticsTrackingId":null,"organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-7487bc2b-237f-480c-9d50-4001a0f6e836"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-7487bc2b-237f-480c-9d50-4001a0f6e836">{}</script>
      
<div id="LoginModal-react-component-ca754c24-0486-4a95-9b6a-9afc3d02dd63"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-ca754c24-0486-4a95-9b6a-9afc3d02dd63">{}</script>
      
<div id="StockModal-react-component-6422d819-39f1-4af1-83ee-b4b19209e38b"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-6422d819-39f1-4af1-83ee-b4b19209e38b">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;H49BdBF58/mZHCAcKsvio514aLTcm3Gae/ADbLAeplpFPdkzhb9cv2Q994Y4s17lZnUgNDQS1Z/0Sx89sDDyIw==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\n\u003ch1\u003e\n\u003cspan id=\"はじめに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eはじめに\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita.com/NCT48/items/5ca2df4e3dbd053cd9f7\" id=\"reference-0469dfdbc9038f596876\"\u003e前回\u003c/a\u003e はList＜T＞について、色々と書いて見ました。\u003c/p\u003e\n\n\u003cp\u003e今回は前回割愛したもののうち、\u003ccode\u003eforeach\u003c/code\u003eついて色々書きたいと思います。\u003c/p\u003e\n\n\u003cp\u003eおまけ程度にVisual Studioのおかしな挙動についても少し書いてます。\u003c/p\u003e\n\n\u003cp\u003eC#が用意している構文の中身について知りたい\u003cdel\u003eちょっと変わった\u003c/del\u003e人向けです。\u003c/p\u003e\n\n\u003cp\u003e今回も独学で書いている部分が多いので、間違ってたらガンガン指摘してください。\u003c/p\u003e\n\n\u003cp\u003e\u003cdel\u003eタイトルは特に思いつかなかったので前回と同じなのは秘密。\u003c/del\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"foreachとは\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#foreach%E3%81%A8%E3%81%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eforeachとは\u003c/h1\u003e\n\n\u003cp\u003e\u003ccode\u003eList\u003c/code\u003eや配列等の要素を1つずつ取り出すための構文。\u003c/p\u003e\n\n\u003cp\u003e「C#入門」とか「初心者向けC#」とか読んでも必ず出てくる。\u003c/p\u003e\n\n\u003cp\u003e実は内部で結構複雑なことをやってるけど、それをおくびにも出さない凄いお方。\u003c/p\u003e\n\n\u003cp\u003e最近はLINQに出番を奪われることもあるが、まだまだ現役バリバリ。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"foreachのあれやこれや\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#foreach%E3%81%AE%E3%81%82%E3%82%8C%E3%82%84%E3%81%93%E3%82%8C%E3%82%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eforeachのあれやこれや\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"foreachってどうなってるの\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#foreach%E3%81%A3%E3%81%A6%E3%81%A9%E3%81%86%E3%81%AA%E3%81%A3%E3%81%A6%E3%82%8B%E3%81%AE\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eforeachってどうなってるの？\u003c/h2\u003e\n\n\u003cp\u003eまずはソースコードから。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003elistStr\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"s\"\u003e\"aaa\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"abc\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"bbc\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"aba\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"cbc\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"bcc\"\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eitem\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003elistStr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eContains\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"a\"\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003eList\u003c/code\u003eを使ったことがあるのに、\u003ccode\u003eforeach\u003c/code\u003eを使った事が無い人はいないと思います。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003efor\u003c/code\u003eで書いていた、\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e初期化条件\u003c/li\u003e\n\u003cli\u003e終了条件\u003c/li\u003e\n\u003cli\u003eインクリメント条件\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eがいらないので、非常に便利です。勝手に最初から最後までやってくれます。\u003c/p\u003e\n\n\u003cp\u003eでも、いらないと言っても誰かが条件を設定しなければならないはずです。誰がやってくれてるんでしょうかね？\u003c/p\u003e\n\n\u003cp\u003eその秘密は\u003ccode\u003eforeach\u003c/code\u003eの真の姿に隠されています。\u003c/p\u003e\n\n\u003cp\u003e2019/01/17\u003c/p\u003e\n\n\u003cp\u003e大嘘でした。(2回目)\u003c/p\u003e\n\n\u003cp\u003eインターフェース越しに展開すると仮想呼び出しのコストが掛かるので、\u003ccode\u003eList\u0026lt;T\u0026gt;\u003c/code\u003e内部の構造体に展開されます。(情報ありがとうございます。)\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003elistStr\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"s\"\u003e\"aaa\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"abc\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"bbc\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"aba\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"cbc\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"bcc\"\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e//(1)\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//IEnumerator\u0026lt;string\u0026gt; e = listStr.GetEnumerator();\u003c/span\u003e\n\u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;.\u003c/span\u003e\u003cspan class=\"n\"\u003eEnumerator\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003elistStr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetEnumerator\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//(2)\u003c/span\u003e\n\u003cspan class=\"k\"\u003ewhile\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eMoveNext\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//(3)\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eitem\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCurrent\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eContains\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"a\"\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003eforeach\u003c/code\u003eはコンパイルするとこんな感じに展開されます。\u003c/p\u003e\n\n\u003cp\u003e突然大量の見たこともないメソッドやらプロパティやらが溢れてきて面食らいますが、一つ一つ解説していきますので安心(?)してください。\u003c/p\u003e\n\n\u003cp\u003e話がそれますが、今回のように「実際に利用者が書いたコード」と「コンパイラの展開結果」が一致しないことは多々あります。\u003c/p\u003e\n\n\u003cp\u003eこれは\u003cstrong\u003eシンタックスシュガー\u003c/strong\u003eと呼ばれる機能で、糖衣構文なんて呼んだりもします。\u003c/p\u003e\n\n\u003cp\u003e話を戻して、まずは(1)を見てください。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e//(1)\u003c/span\u003e\n\u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;.\u003c/span\u003e\u003cspan class=\"n\"\u003eEnumerator\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003elistStr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetEnumerator\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003eGetEnumerator\u003c/code\u003eは、\u003ccode\u003eList\u003c/code\u003eクラスのメソッドです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eIEnumerator\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eIEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetEnumerator\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eEnumerator\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e突然出てきました。\u003ccode\u003eIEnumerable\u0026lt;T\u0026gt;\u003c/code\u003eインターフェースと\u003ccode\u003eIEnumerator\u0026lt;T\u0026gt;\u003c/code\u003eインターフェース、そして\u003ccode\u003eEnumerator\u003c/code\u003e構造体です。\u003c/p\u003e\n\n\u003cp\u003e順番に解説してきましょう。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ienumerabletインターフェースってなに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#ienumerablet%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9%E3%81%A3%E3%81%A6%E3%81%AA%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eIEnumerable＜T＞インターフェースってなに？\u003c/h2\u003e\n\n\u003cp\u003e\u003cdel\u003e実は、\u003ccode\u003eforeach\u003c/code\u003eが受け入れる事が出来る変数は、\u003cstrong\u003e必ず\u003ccode\u003eIEnumerable\u0026lt;T\u0026gt;\u003c/code\u003eを継承している\u003c/strong\u003e必要があります。\u003c/del\u003e\u003c/p\u003e\n\n\u003cp\u003e2019/01/16\u003cbr\u003e\n大嘘でした。正しくは、\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e\n\u003ccode\u003eforeach\u003c/code\u003eに投げる型が、\u003ccode\u003eGetEnumerator\u003c/code\u003eを実装している。\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eGetEnumerator\u003c/code\u003eの戻り値の型が、\u003ccode\u003eMoveNext\u003c/code\u003eメソッドとパブリックな\u003ccode\u003eCurent\u003c/code\u003eプロパティを実装している。\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003e上記2つを満たしている必要があります。(情報ありがとうございます。)\u003c/p\u003e\n\n\u003cp\u003eI(インターフェース) + Enumerate(...を数え上げる) + able(出来る)なので、「数え上げる事が出来る(ことを規約する)インターフェース」といった感じの意味になります。(英語は苦手なので間違ってるかもしれません)\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003einterface\u003c/span\u003e \u003cspan class=\"nc\"\u003eIEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIEnumerable\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eIEnumerator\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetEnumerator\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eメソッドは1つのみです。ジェネリクスで指定された型の\u003ccode\u003eIEnumerator\u0026lt;T\u0026gt;\u003c/code\u003eを返すメソッドです。\u003c/p\u003e\n\n\u003cp\u003eここで、改めて\u003ccode\u003eList\u003c/code\u003eクラスの定義を見てみます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;,\u003c/span\u003e \u003cspan class=\"n\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCollections\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIList\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIReadOnlyList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003eList\u003c/code\u003eクラスが直接継承しているインターフェースは、\u003ccode\u003eIList\u0026lt;T\u0026gt;\u003c/code\u003e, \u003ccode\u003eIList\u003c/code\u003e, \u003ccode\u003eIReadOnlyList\u0026lt;T\u0026gt;\u003c/code\u003eの3つです。\u003c/p\u003e\n\n\u003cp\u003eそして、\u003ccode\u003eIList\u0026lt;T\u0026gt;\u003c/code\u003eは\u003ccode\u003eICollection\u0026lt;T\u0026gt;\u003c/code\u003eを、\u003ccode\u003eICollection\u0026lt;T\u0026gt;\u003c/code\u003eは\u003ccode\u003eIEnumerable\u0026lt;T\u0026gt;\u003c/code\u003eを、\u003ccode\u003eIEnumerable\u0026lt;T\u0026gt;\u003c/code\u003eは\u003ccode\u003eIEnumerable\u003c/code\u003eを継承しています。\u003c/p\u003e\n\n\u003cp\u003eさらに、\u003ccode\u003eIList\u003c/code\u003eは\u003ccode\u003eICollection\u003c/code\u003eを、\u003ccode\u003eICollection\u003c/code\u003eは\u003ccode\u003eIEnumerable\u003c/code\u003eを継承しています。\u003c/p\u003e\n\n\u003cp\u003e最後に、\u003ccode\u003eIReadOnlyList\u0026lt;T\u0026gt;\u003c/code\u003eは\u003ccode\u003eIReadOnlyCollection\u0026lt;T\u0026gt;\u003c/code\u003eを、\u003ccode\u003eIReadOnlyCollection\u0026lt;T\u0026gt;\u003c/code\u003eは\u003ccode\u003eIEnumerable\u0026lt;T\u0026gt;\u003c/code\u003eを、継承しています。\u003c/p\u003e\n\n\u003cp\u003e継承祭りですね。てんやわんやなので少し整理すると、Listクラスが継承しているインターフェースは、\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eIList\u0026lt;T\u0026gt;\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eIList\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eICollection\u0026lt;T\u0026gt;\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eICollection\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eIEnumerable\u0026lt;T\u0026gt;\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eIEnumerable\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eIReadOnlyList\u0026lt;T\u0026gt;\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eIReadOnlyCollection\u0026lt;T\u0026gt;\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eとなります。\u003c/p\u003e\n\n\u003cp\u003e先述の通り、\u003ccode\u003eIEnumerable\u0026lt;T\u0026gt;\u003c/code\u003eを継承してるので、\u003ccode\u003eforeach\u003c/code\u003eは\u003ccode\u003eList\u003c/code\u003eを受け入れる事が可能です。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"なんで同じ名前でジェネリクスしてたりしてなかったりするの\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AA%E3%82%93%E3%81%A7%E5%90%8C%E3%81%98%E5%90%8D%E5%89%8D%E3%81%A7%E3%82%B8%E3%82%A7%E3%83%8D%E3%83%AA%E3%82%AF%E3%82%B9%E3%81%97%E3%81%A6%E3%81%9F%E3%82%8A%E3%81%97%E3%81%A6%E3%81%AA%E3%81%8B%E3%81%A3%E3%81%9F%E3%82%8A%E3%81%99%E3%82%8B%E3%81%AE\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eなんで同じ名前でジェネリクスしてたり、してなかったりするの？\u003c/h3\u003e\n\n\u003cp\u003eまた少し話がそれますが、\u003ccode\u003e\u0026lt;T\u0026gt;\u003c/code\u003eはジェネリクスだよ。って事は前回お話しました。\u003c/p\u003e\n\n\u003cp\u003e「\u003ccode\u003eIList\u0026lt;T\u0026gt;\u003c/code\u003eと\u003ccode\u003eIList\u003c/code\u003eって何がちゃうねん、コラ」と思う方もいると思います。\u003c/p\u003e\n\n\u003cp\u003eC#にジェネリクスの機能が追加されたのは、2005年、C#の2.0からです。\u003c/p\u003e\n\n\u003cp\u003e(僕がまだギリギリランドセルを背負ってたくらい昔の話です。)\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eIList\u003c/code\u003e、\u003ccode\u003eICollection\u003c/code\u003e、\u003ccode\u003eIEnumerable\u003c/code\u003eはそれ以前からC#に存在している方々です。\u003c/p\u003e\n\n\u003cp\u003eジェネリクスが存在しないので、当然\u003ccode\u003eList\u0026lt;T\u0026gt;\u003c/code\u003eも存在しません。\u003c/p\u003e\n\n\u003cp\u003eこのころは\u003ccode\u003eList\u003c/code\u003e的な物を使いたい場合、取り扱う型ごとに違うクラス、もしくは\u003ccode\u003eobject\u003c/code\u003eで全てを受け入れるクラスを作っていたんだと思います。(\u003cstrong\u003e推測です。\u003c/strong\u003eこのころの事は全然知らないので詳しい方、教えてください。)\u003c/p\u003e\n\n\u003cp\u003eこれでは不便だろうと言うことで、ジェネリクスが誕生しました。そして、\u003ccode\u003eIList\u0026lt;T\u0026gt;\u003c/code\u003e、\u003ccode\u003eICollection\u0026lt;T\u0026gt;\u003c/code\u003e、\u003ccode\u003eIEnumerable\u0026lt;T\u0026gt;\u003c/code\u003e、そして\u003ccode\u003eList\u0026lt;T\u0026gt;\u003c/code\u003eも合わせて生まれます。\u003c/p\u003e\n\n\u003cp\u003e誕生した所までは良かったんですが、「じゃあ今まで使ってたジェネリクスしてない(非ジェネリクス)コードはどうするんだ？」問題が発生します。\u003c/p\u003e\n\n\u003cp\u003e過去のコードが使用できなくなるような変更を\u003cstrong\u003e破壊的変更\u003c/strong\u003eと言いますが、C#は破壊的変更を避けるようにかなり慎重に機能の追加・修正を行っています。(破壊的変更を避けるのは、C#に限った話ではありませんけども)\u003c/p\u003e\n\n\u003cp\u003eそんな経緯があるので、非ジェネリクスインターフェースは残っています。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eIReadOnlyList\u0026lt;T\u0026gt;\u003c/code\u003eは、.Net Framework 4.5で追加された機能です。2012年、C#は5.0のなのでこんな話とは無縁です。なので、非ジェネリクスなインターフェースはいません。\u003c/p\u003e\n\n\u003cp\u003e(僕が社会人になる3年くらい前です。ずいぶんと最近な気がしますね。)\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ienumeratortインターフェースってなに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#ienumeratort%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9%E3%81%A3%E3%81%A6%E3%81%AA%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eIEnumerator＜T＞インターフェースってなに？\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003eIEnumerable\u0026lt;T\u0026gt;\u003c/code\u003eは\u003ccode\u003eList\u003c/code\u003eが継承していました。では、\u003ccode\u003eIEnumerator\u0026lt;T\u0026gt;\u003c/code\u003eはどこにあるんでしょうか？\u003c/p\u003e\n\n\u003cp\u003eこいつは\u003ccode\u003eEnumerator\u003c/code\u003e構造体が継承しています。まず先に、\u003ccode\u003eIEnumerator\u0026lt;T\u0026gt;\u003c/code\u003eの定義から。\u003c/p\u003e\n\n\u003cp\u003eI(インターフェース) + Enumerate(...を数え上げる) + or(もの)なので、「数え上げる処理をする(ことを規約する)インターフェース」といった感じの意味になります。(英語は苦手なので以下略)\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eIEnumerator\u003c/code\u003eには2つのメソッドと1つのプロパティが、\u003ccode\u003eIEnumerator\u0026lt;T\u0026gt;\u003c/code\u003eには1つのプロパティがあります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003einterface\u003c/span\u003e \u003cspan class=\"nc\"\u003eIEnumerator\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"nf\"\u003eMoveNext\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eObject\u003c/span\u003e \u003cspan class=\"n\"\u003eCurrent\u003c/span\u003e \n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eReset\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003einterface\u003c/span\u003e \u003cspan class=\"nc\"\u003eIEnumerator\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIDisposable\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIEnumerator\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e    \n    \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eT\u003c/span\u003e \u003cspan class=\"n\"\u003eCurrent\u003c/span\u003e \n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003eforeach\u003c/code\u003eは\u003ccode\u003eIEnumerator\u003c/code\u003eの\u003ccode\u003eMoveNext\u003c/code\u003eメソッドと\u003ccode\u003eIEnumerator\u0026lt;T\u0026gt;\u003c/code\u003eの\u003ccode\u003eCurrent\u003c/code\u003eプロパティを使用しています。\u003c/p\u003e\n\n\u003cp\u003e(本当は\u003ccode\u003eIDisposable\u003c/code\u003eの\u003ccode\u003eDispose\u003c/code\u003eも使用しているのですが、\u003ccode\u003eList\u003c/code\u003eの場合、処理なしで実装されているので割愛)\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"enumerator構造体ってなに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#enumerator%E6%A7%8B%E9%80%A0%E4%BD%93%E3%81%A3%E3%81%A6%E3%81%AA%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eEnumerator構造体ってなに？\u003c/h2\u003e\n\n\u003cp\u003eこの\u003ccode\u003eEnumerator\u003c/code\u003e構造体ですが、\u003ccode\u003eList\u003c/code\u003eクラスの内部に定義されているローカル構造体です。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"nc\"\u003eEnumerator\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIEnumerator\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;,\u003c/span\u003e \u003cspan class=\"n\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCollections\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIEnumerator\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003eEnumerator\u003c/code\u003eは、\u003ccode\u003eIEnumerator\u0026lt;T\u0026gt;\u003c/code\u003eと\u003ccode\u003eIEnumerator\u003c/code\u003eを継承しています。\u003c/p\u003e\n\n\u003cp\u003eそして、\u003ccode\u003eIEnumerator\u0026lt;T\u0026gt;\u003c/code\u003eは、\u003ccode\u003eIDisposable\u003c/code\u003eと\u003ccode\u003eIEnumerator\u003c/code\u003eを継承しています。\u003c/p\u003e\n\n\u003cp\u003eなので\u003ccode\u003eEnumerator\u003c/code\u003e構造体が継承しているインターフェースは、\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eIEnumerator\u0026lt;T\u0026gt;\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eIEnumerator\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eIDisposable\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eとなります。\u003c/p\u003e\n\n\u003cp\u003e説明し終わったところで、改めて(1)に戻ります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e//(1)\u003c/span\u003e\n\u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;.\u003c/span\u003e\u003cspan class=\"n\"\u003eEnumerator\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003elistStr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetEnumerator\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eIEnumerator\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eIEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetEnumerator\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eEnumerator\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003eGetEnumerator\u003c/code\u003eが呼び出された時、\u003ccode\u003eEnumerator\u003c/code\u003eのコンストラクタを実行しています。\u003c/p\u003e\n\n\u003cp\u003e引数は\u003ccode\u003ethis\u003c/code\u003eなので、\u003ccode\u003eList\u003c/code\u003e自身ですね。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eEnumerator\u003c/code\u003eのコンストラクタとフィールドはこうなっています。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003elist\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eversion\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eT\u003c/span\u003e \u003cspan class=\"n\"\u003ecurrent\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003einternal\u003c/span\u003e \u003cspan class=\"nf\"\u003eEnumerator\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003elist\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elist\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003elist\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eversion\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003elist\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003e_version\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ecurrent\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003edefault\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e順を追ってみると、\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e\n\u003ccode\u003eGetEnumerator\u003c/code\u003eが呼び出された時、コンストラクタの引数に\u003ccode\u003eList\u003c/code\u003e自身を渡す。\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eEnumerator\u003c/code\u003e内のフィールドにて、渡された\u003ccode\u003eList\u003c/code\u003e、初期\u003ccode\u003eindex\u003c/code\u003e、渡された時点での\u003ccode\u003e_version\u003c/code\u003e、\u003ccode\u003ecurrent\u003c/code\u003eを設定。\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eこれで終わりです。とてもシンプルですね。\u003c/p\u003e\n\n\u003cp\u003e次に(2)です。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e//(2)\u003c/span\u003e\n\u003cspan class=\"k\"\u003ewhile\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eMoveNext\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eループ処理の終了条件です。\u003ccode\u003eEnumerator\u003c/code\u003e内の実装はこうなっています。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"nf\"\u003eMoveNext\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \n\u003cspan class=\"p\"\u003e{\u003c/span\u003e \n    \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003elocalList\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003elist\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eversion\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003elocalList\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003e_version\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"kt\"\u003euint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003euint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003elocalList\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003e_size\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e                                                     \n        \u003cspan class=\"n\"\u003ecurrent\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003elocalList\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003e_items\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e                    \n        \u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e++;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nf\"\u003eMoveNextRare\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"nf\"\u003eMoveNextRare\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e                \n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eversion\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003elist\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003e_version\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eThrowHelper\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eThrowInvalidOperationException\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eExceptionResource\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eInvalidOperation_EnumFailedVersion\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003elist\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003e_size\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ecurrent\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003edefault\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e                \n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eまず、コンストラクタで保存した\u003ccode\u003eversion\u003c/code\u003eと\u003ccode\u003elocalList._version\u003c/code\u003eが一致していて、\u003ccode\u003eindex\u003c/code\u003eが0以上かつ、\u003ccode\u003elocalList._size\u003c/code\u003e未満であるか確認しています。\u003c/p\u003e\n\n\u003cp\u003e条件を満たしていた場合は、\u003ccode\u003ecurrent\u003c/code\u003eフィールドの値を書き換えて、\u003ccode\u003eindex\u003c/code\u003eをインクリメント。次に進むことが出来たので\u003ccode\u003etrue\u003c/code\u003eを返して終了です。\u003c/p\u003e\n\n\u003cp\u003e条件を満たしていない場合は、\u003ccode\u003eversion\u003c/code\u003eと\u003ccode\u003elocalList._version\u003c/code\u003eを確認し、一致していなければ\u003ccode\u003eInvalidOperationException\u003c/code\u003eを発行。そうでない場合は、`\u003ccode\u003ecurrent\u003c/code\u003eを初期化。次に進めなかったので、\u003ccode\u003efalse\u003c/code\u003eを返して終了です。\u003c/p\u003e\n\n\u003cp\u003eつまり、\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e\n\u003ccode\u003eversion\u003c/code\u003eと\u003ccode\u003elocalList._version\u003c/code\u003eが一致していない。→ \u003ccode\u003eInvalidOperationException\u003c/code\u003eを発行。\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eindex\u003c/code\u003eが0以上かつ、\u003ccode\u003elocalList._size\u003c/code\u003e未満。→ \u003ccode\u003ecurrent\u003c/code\u003eに値を設定して\u003ccode\u003etrue\u003c/code\u003eを返す。\u003c/li\u003e\n\u003cli\u003eそれ以外の場合。 → \u003ccode\u003ecurrent\u003c/code\u003eを初期化してして\u003ccode\u003efalse\u003c/code\u003eを返す。\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eこうやってループの終了を判定しているんですね。(優先順位は上から)\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita.com/NCT48/items/5ca2df4e3dbd053cd9f7\"\u003e前回\u003c/a\u003eの記事の「コレクションの変更ってどうなってるの？」で割愛した「\u003ccode\u003efoerach\u003c/code\u003eも似たようなことをやっています。」がこの部分になります。\u003c/p\u003e\n\n\u003cp\u003e最後に(3)です。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e \u003cspan class=\"c1\"\u003e//(3)\u003c/span\u003e\n\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eitem\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCurrent\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eT\u003c/span\u003e \u003cspan class=\"n\"\u003eCurrent\u003c/span\u003e \n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eget\u003c/span\u003e \n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003ecurrent\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eただのゲッターなので、特に言うこともありません。(2)で設定した値を取得しています。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"これを知ってると何が出来るの\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%93%E3%82%8C%E3%82%92%E7%9F%A5%E3%81%A3%E3%81%A6%E3%82%8B%E3%81%A8%E4%BD%95%E3%81%8C%E5%87%BA%E6%9D%A5%E3%82%8B%E3%81%AE\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eこれを知ってると何が出来るの？\u003c/h2\u003e\n\n\u003cp\u003e自作のクラスを\u003ccode\u003eforeach\u003c/code\u003eに渡す事が出来るようになります！\u003cdel\u003eおそらく意味はない\u003c/del\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cdel\u003e正直面倒くさいだけで\u003c/del\u003e実用性は皆無ですが、勉強としては意味がある...んじゃないですかね。多分。\u003c/p\u003e\n\n\u003cp\u003e実際に作ってみました。\u003c/p\u003e\n\n\u003cp\u003e満たすべき要件\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e要素を\u003ccode\u003eAdd\u003c/code\u003eで追加できる。(メソッドの作成)\u003c/li\u003e\n\u003cli\u003e要素を\u003ccode\u003eforeach\u003c/code\u003eで取り出せる。(インターフェースの実装)\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eこの2つだけです。なので、取り出し時は入れた時とは逆順で出てきます。削除もインデクサでの取り出しも出来ません。それでいいんです、自作なので。\u003c/p\u003e\n\n\u003cp\u003eまずは\u003ccode\u003eListModoki\u003c/code\u003eの作成です。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epartial\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eListModoki\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eListValue\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ehead\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e \u003cspan class=\"n\"\u003ev\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ehead\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eListValue\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"n\"\u003ev\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ehead\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eIEnumerator\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetEnumerator\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eListNakami\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"n\"\u003ehead\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003eIEnumerator\u003c/span\u003e \u003cspan class=\"n\"\u003eIEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetEnumerator\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eListNakami\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"n\"\u003ehead\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003eIEnumerable\u0026lt;T\u0026gt;\u003c/code\u003eの部分です。(説明用にクラスをpartialで分割してますが、本来は不要です。)\u003c/p\u003e\n\n\u003cp\u003e先頭位置を記憶するための\u003ccode\u003ehead\u003c/code\u003eを持っています。\u003ccode\u003eListValue\u0026lt;T\u0026gt;\u003c/code\u003eは、値と次の要素を持ったクラスです(詳細は後述)。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epartial\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eListModoki\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eListNakami\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIEnumerator\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eListValue\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ecurrent\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eListNakami\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eListValue\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ecurrent\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecurrent\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecurrent\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eT\u003c/span\u003e \u003cspan class=\"n\"\u003eCurrent\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eget\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eListValue\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ec\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecurrent\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"n\"\u003ecurrent\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ec\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNext\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003ec\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"kt\"\u003eobject\u003c/span\u003e \u003cspan class=\"n\"\u003eIEnumerator\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCurrent\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eget\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eCurrent\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"nf\"\u003eMoveNext\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecurrent\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eDispose\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eReset\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003eIEnumerator\u0026lt;T\u0026gt;\u003c/code\u003eの部分です。内部クラスとして定義してます。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eCurrent\u003c/code\u003eで値を取得する時についでに、次に進めています。\u003c/p\u003e\n\n\u003cp\u003e今回は\u003cdel\u003e面倒なので\u003c/del\u003eここでしか使わないので\u003ccode\u003eCurrent\u003c/code\u003eに副作用を持たせていますが、\u003cstrong\u003eかなり危険な行為\u003c/strong\u003eです。\u003c/p\u003e\n\n\u003cp\u003e理由は一番最後におまけで書いておくので、読んでください。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eListValue\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eT\u003c/span\u003e \u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eListValue\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eNext\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eListValue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e \u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eListValue\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003enext\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eValue\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eNext\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enext\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e最後に\u003ccode\u003eListModoki\u003c/code\u003eの中身、\u003ccode\u003eListValue\u003c/code\u003eです。自分の値と次の中身を持っています。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eMain\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eListModoki\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003emodoki\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eListModoki\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"m\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003emodoki\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eitem\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003emodoki\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e実際に0から9まで値を追加した後、順番に取り出していきます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e9\n8\n7\n6\n5\n4\n3\n2\n1\n0\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e最初に言い訳したとおり、入れた時とは逆の順番で出てきます。さらに、インデクサでのアクセスが出来ないので、\u003ccode\u003efor\u003c/code\u003eは使用できません。(超不便)\u003c/p\u003e\n\n\u003cp\u003e既存のクラスでは実現できない要求が来た時に、覚えておくと役に立つ可能性は否定出来ないんじゃないかと思います。(超弱気)\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"おわりに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eおわりに\u003c/h1\u003e\n\n\u003cp\u003e前回書けなかった部分のうち\u003ccode\u003eIEnumerable\u0026lt;T\u0026gt;\u003c/code\u003eについて書こうと思ってたら\u003ccode\u003eforeach\u003c/code\u003eの話になってました。\u003c/p\u003e\n\n\u003cp\u003e自作の\u003ccode\u003eListModoki\u003c/code\u003eを要求されることはまず無いと思います。どう考えても\u003ccode\u003eList\u003c/code\u003eの方が万能です。\u003c/p\u003e\n\n\u003cp\u003e次の内容は未定です。次があるかどうかも未定です。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"おまけvisual-studioのバグ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%8A%E3%81%BE%E3%81%91visual-studio%E3%81%AE%E3%83%90%E3%82%B0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eおまけ:Visual Studioのバグ...？\u003c/h1\u003e\n\n\u003cp\u003eゲッターに副作用を持たせた状態で、Visual Studioでデバックを行うと\u003cstrong\u003eバグ\u003c/strong\u003eります。\u003c/p\u003e\n\n\u003cp\u003eウォッチ式やマウスオーバーした時に出るアレ(名前を知らない)で値を確認するたびに、\u003cstrong\u003eその副作用が実行されます。\u003c/strong\u003e今回の場合、勝手に\u003ccode\u003ecurrent\u003c/code\u003eが進んでいきます。\u003c/p\u003e\n\n\u003cp\u003e結構深刻なバグの元になりかねないので、\u003cstrong\u003eゲッターに副作用を持たせるのは止めましょう\u003c/strong\u003e。\u003c/p\u003e\n\n\u003cp\u003e簡単なテストを行なった画像を下に貼っておきます。(Visual Studio 2017です。)\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/c1458cff7eafb173b1ded64dc0c80c6c317172ac/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3331313935352f30633932373632332d343936302d353763622d623062662d3832363630313864336137332e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F311955%2F0c927623-4960-57cb-b0bf-8266018d3a73.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=73bfdfef4f1b820e816b86d9c4c969ae\" alt=\"getter.PNG\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/311955/0c927623-4960-57cb-b0bf-8266018d3a73.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F311955%2F0c927623-4960-57cb-b0bf-8266018d3a73.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=4eb96658cfcf04c428a72088173658b4 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n","createdAt":"2019-01-15T08:01:54Z","elapsedYearsFromLastModifiedAt":2,"encryptedId":"H5Aozl53jSaSHlv623MM3WDkIvpsCIYG--TPaC9MM91y9LNNoX--erkciT8F+AaYxfvBVkhy+A==","isBanned":false,"isDeprecated":true,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2019-01-17T00:17:22Z","likesCount":54,"linkUrl":"https://qiita.com/NCT48/items/d8394d587e9fee969ca9","organization":null,"originalId":766380,"stockedCount":39,"title":"foreachについて本気出して調べてみた","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003eはじめに\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#foreach%E3%81%A8%E3%81%AF\"\u003eforeachとは\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#foreach%E3%81%AE%E3%81%82%E3%82%8C%E3%82%84%E3%81%93%E3%82%8C%E3%82%84\"\u003eforeachのあれやこれや\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#foreach%E3%81%A3%E3%81%A6%E3%81%A9%E3%81%86%E3%81%AA%E3%81%A3%E3%81%A6%E3%82%8B%E3%81%AE\"\u003eforeachってどうなってるの？\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#ienumerablet%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9%E3%81%A3%E3%81%A6%E3%81%AA%E3%81%AB\"\u003eIEnumerable＜T＞インターフェースってなに？\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%AA%E3%82%93%E3%81%A7%E5%90%8C%E3%81%98%E5%90%8D%E5%89%8D%E3%81%A7%E3%82%B8%E3%82%A7%E3%83%8D%E3%83%AA%E3%82%AF%E3%82%B9%E3%81%97%E3%81%A6%E3%81%9F%E3%82%8A%E3%81%97%E3%81%A6%E3%81%AA%E3%81%8B%E3%81%A3%E3%81%9F%E3%82%8A%E3%81%99%E3%82%8B%E3%81%AE\"\u003eなんで同じ名前でジェネリクスしてたり、してなかったりするの？\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#ienumeratort%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9%E3%81%A3%E3%81%A6%E3%81%AA%E3%81%AB\"\u003eIEnumerator＜T＞インターフェースってなに？\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#enumerator%E6%A7%8B%E9%80%A0%E4%BD%93%E3%81%A3%E3%81%A6%E3%81%AA%E3%81%AB\"\u003eEnumerator構造体ってなに？\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%93%E3%82%8C%E3%82%92%E7%9F%A5%E3%81%A3%E3%81%A6%E3%82%8B%E3%81%A8%E4%BD%95%E3%81%8C%E5%87%BA%E6%9D%A5%E3%82%8B%E3%81%AE\"\u003eこれを知ってると何が出来るの？\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB\"\u003eおわりに\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%8A%E3%81%BE%E3%81%91visual-studio%E3%81%AE%E3%83%90%E3%82%B0\"\u003eおまけ:Visual Studioのバグ...？\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":13579,"uuid":"d8394d587e9fee969ca9","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"PMNuAvaWcYF7dGPMGtYm9abi3lcR--z2EmXYIdOEDCvF4d--ae5MeJfbc8zNxsQmkEDltg==","originalId":311955,"description":"モチベが上がらないだけで生きてますよ","facebookUrl":null,"githubUrl":"https://github.com/NCT48","isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"","profileImageUrl":"https://avatars0.githubusercontent.com/u/44828045?v=4","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Favatars0.githubusercontent.com%2Fu%2F44828045%3Fv%3D4?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=ef1c426038e06b9d80bebb1425dd61f2","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Favatars0.githubusercontent.com%2Fu%2F44828045%3Fv%3D4?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=43d79fdd304f677acc9fb57f5123633e","urlName":"NCT48","websiteUrl":"","twitterUrl":null,"twitterUrlName":null,"revealedOrganizations":{"edges":[]}},"tags":[{"name":"C#","urlName":"csharp"},{"name":"VisualStudio","urlName":"visualstudio"}],"followingLikers":{"edges":[]},"comments":{"totalCount":10}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

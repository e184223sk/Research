<!DOCTYPE html><html><head><meta charset="utf-8" /><title>AzureのFace APIを使って顔の類似度を判定する① - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/koob/items/b649e463842b1c16f297" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="U89GM5cKSQkD61PTV/ABJ7AtZqe8FmJDG3WMO5fAIfr+Kj2ExGMXNXMCFoYlRMP+ea2MH8FVYuGM2B0u67s26w==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta content="@koob12340160" name="twitter:creator" /><meta property="og:type" content="article"><meta property="og:title" content="AzureのFace APIを使って顔の類似度を判定する① - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1RWHAxY21YamdhNUdZV05sSUVGUVNlT0NrdVM5di1PQm8tT0JwdW1obE9PQnJ1bWhudVM4dk9XNnB1T0NrdVdJcE9XdW11T0JtZU9DaS1LUm9BJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NTQmdHh0LWNsaXA9ZWxsaXBzaXMmdHh0LWFsaWduPWNlbnRlciUyQ21pZGRsZSZzPTNiNTYwYWM4N2I1ZTJkNjczYTI2MWFjYTA3NmIyMDFl&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RR3R2YjJJJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NDUmdHh0LWFsaWduPXJpZ2h0JTJDYm90dG9tJnM9MDYxNjM5MTI5NzAzYzI5ODk0MzYxN2U4NzY2YTVkYmQ&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=54d66b4dc5f6becb655f607752cb8888"><meta property="og:description" content="

作るもの

比較元の画像（base）に写っている人が、比較先の画像（target）に写っている人とどれだけ似ているかを表示してくれるコンソールアプリ。

書いてる内に妙に長くなってしまったので、①ではそれぞれの画像の顔の検出までを..."><meta content="https://qiita.com/koob/items/b649e463842b1c16f297" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#,.NETFramework,Json.NET,FaceAPI,CognitiveServices" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 1nzh4zz 38fzdi helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-1nzh4zz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:16px 32px;background-color:#FBE69E;color:rgba(0,0,0,0.87);line-height:1.5;font-weight:600;}@media (max-width:770px){.css-1nzh4zz{padding:16px;}}.css-38fzdi{color:#CA832A;margin-right:4px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-5bae6fbd-8740-44f1-a4f4-d1f74f0b3d71"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Fkoob%2Fitems%2Fb649e463842b1c16f297">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Fkoob%2Fitems%2Fb649e463842b1c16f297">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-5bae6fbd-8740-44f1-a4f4-d1f74f0b3d71">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2019-05-19T00:44:59.000+09:00","dateModified":"2019-05-19T00:44:59.000+09:00","headline":"AzureのFace APIを使って顔の類似度を判定する①","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1RWHAxY21YamdhNUdZV05sSUVGUVNlT0NrdVM5di1PQm8tT0JwdW1obE9PQnJ1bWhudVM4dk9XNnB1T0NrdVdJcE9XdW11T0JtZU9DaS1LUm9BJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NTQmdHh0LWNsaXA9ZWxsaXBzaXMmdHh0LWFsaWduPWNlbnRlciUyQ21pZGRsZSZzPTNiNTYwYWM4N2I1ZTJkNjczYTI2MWFjYTA3NmIyMDFl\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RR3R2YjJJJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NDUmdHh0LWFsaWduPXJpZ2h0JTJDYm90dG9tJnM9MDYxNjM5MTI5NzAzYzI5ODk0MzYxN2U4NzY2YTVkYmQ\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=54d66b4dc5f6becb655f607752cb8888","mainEntityOfPage":"https://qiita.com/koob/items/b649e463842b1c16f297","author":{"@type":"Person","address":"","email":null,"identifier":"koob","name":"koob","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F403060%2Fprofile-images%2F1557060036?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=1fcd3420393a77ba6585d7f8ec45ad7d","url":"https://qiita.com/koob","description":"基幹系システム開発が主な業務の5年目30歳ITエンジニアです。\r\n会社ではC#, VB.NET。\r\nリングフィット継続中。","memberOf":[]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://zine.qiita.com/interview/202105-uzabase/?utm_source=qiita&amp;utm_medium=header-banner">プロダクト全体の「エコシステム」を考えるユーザベースの開発手法とは？</a><a target="_blank" id="header_text_message_2" href="https://zine.qiita.com/interview/202105-uzabase/?utm_source=qiita&amp;utm_medium=header-banner">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"koob","type":"items","id":"b649e463842b1c16f297"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"プロダクト全体の「エコシステム」を考えるユーザベースの開発手法とは？","url":"https://zine.qiita.com/interview/202105-uzabase/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"koob","type":"items","id":"b649e463842b1c16f297"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_1","message":"プロダクト全体の「エコシステム」を考えるユーザベースの開発手法とは？","url":"https://zine.qiita.com/interview/202105-uzabase/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"koob","type":"items","id":"b649e463842b1c16f297"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_2","message":"プロダクト全体の「エコシステム」を考えるユーザベースの開発手法とは？","url":"https://zine.qiita.com/interview/202105-uzabase/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/koob/items/b649e463842b1c16f297","location":"/koob/items/b649e463842b1c16f297","scheme":"https","host":"qiita.com","port":null,"pathname":"/koob/items/b649e463842b1c16f297","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"15+VTlfNIagiiX5rqWdUA97+QlCVpep0vlQSHVucJ/t6eu75BKR/lFJgOz7b05baF36o6Ojm6tYp+YMIJ+cw6g==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-ac031b78-55cb-4fd9-ad71-e75aaf4624a3"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/koob/items/b649e463842b1c16f297/likers" class="css-1iupg5d">4</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">6</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/b649e463842b1c16f297/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/koob/items/b649e463842b1c16f297/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/koob/items/b649e463842b1c16f297/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/koob/items/b649e463842b1c16f297/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/koob/items/b649e463842b1c16f297.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-1nzh4zz"><span class="fa fa-fw fa-warning css-38fzdi"></span><p>More than 1 year has passed since last update.</p></div><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/koob"><img class="css-100alwu eyfquo10" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/403060/profile-images/1557060036" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/koob" class="css-10ougpm">@<!-- -->koob</a><div class="css-1ay9vb9"><time dateTime="2019-05-18T15:44:59Z" class="css-m19uds">posted at 2019-05-18</time></div></div></div></div></div><h1 class="css-cgzq40">AzureのFace APIを使って顔の類似度を判定する①</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/.netframework" class="css-4czcte">.NETFramework</a><a href="/tags/json.net" class="css-4czcte">Json.NET</a><a href="/tags/faceapi" class="css-4czcte">FaceAPI</a><a href="/tags/cognitiveservices" class="css-4czcte">CognitiveServices</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div>
<h1>
<span id="作るもの" class="fragment"></span><a href="#%E4%BD%9C%E3%82%8B%E3%82%82%E3%81%AE"><i class="fa fa-link"></i></a>作るもの</h1>

<p>比較元の画像（base）に写っている人が、比較先の画像（target）に写っている人とどれだけ似ているかを表示してくれるコンソールアプリ。</p>

<p>書いてる内に妙に長くなってしまったので、①ではそれぞれの画像の顔の検出までを実装していきます。</p>

<h1>
<span id="完成版の実行結果" class="fragment"></span><a href="#%E5%AE%8C%E6%88%90%E7%89%88%E3%81%AE%E5%AE%9F%E8%A1%8C%E7%B5%90%E6%9E%9C"><i class="fa fa-link"></i></a>完成版の実行結果</h1>

<p>以下の画像を使用して、比較元画像の男性に対する、比較先画像の男女の類似度を判定させます。</p>

<p>↓比較元画像↓<br>
<a href="https://camo.qiitausercontent.com/e06d01df8c259cb792562b7c45b8ec4a2992ebf0/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3430333036302f63313838613035652d366238612d653633302d386364332d6164323165393664643139362e6a706567" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F403060%2Fc188a05e-6b8a-e630-8cd3-ad21e96dd196.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=9ee0993a8363c4a88871bab340e5dcf7" alt="test1.jpg" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/403060/c188a05e-6b8a-e630-8cd3-ad21e96dd196.jpeg" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F403060%2Fc188a05e-6b8a-e630-8cd3-ad21e96dd196.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=28b3d3fbabbe62a42ffe3b0fddfc39f4 1x" loading="lazy"></a></p>

<p>↓比較先画像↓<br>
<a href="https://camo.qiitausercontent.com/29bf9428bca78fba48d0d7457c1f20a4ec43e8ea/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3430333036302f64366361663934312d353665362d623266362d353937372d3930616162653830393162342e6a706567" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F403060%2Fd6caf941-56e6-b2f6-5977-90aabe8091b4.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=7cd67e9a112d6862391848802766c056" alt="test3.jpg" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/403060/d6caf941-56e6-b2f6-5977-90aabe8091b4.jpeg" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F403060%2Fd6caf941-56e6-b2f6-5977-90aabe8091b4.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=3d8fcd673ac0c6f3e7762117f53210dc 1x" loading="lazy"></a></p>

<p>アプリを実行すると、以下のように検出箇所と割り振られたFaceIDを確認できます。<br>
<a href="https://camo.qiitausercontent.com/3059887be9a084f77d2f3c7438feeaf1cea544c4/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3430333036302f34613664653637352d356633382d653533652d663465632d3838353331663130343731622e706e67" target="_blank" rel="nofollow noopener"><img width="521" alt="キャプチャ.PNG" src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F403060%2F4a6de675-5f38-e53e-f4ec-88531f10471b.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=4f8b3de94e14f8246f4ac7e39b53ab41" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/403060/4a6de675-5f38-e53e-f4ec-88531f10471b.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F403060%2F4a6de675-5f38-e53e-f4ec-88531f10471b.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=5ceda15d4e877ef32340807652e5d815 1x" loading="lazy"></a><br>
<a href="https://camo.qiitausercontent.com/326aaacad261a23ceb69a6afca4f6a3888aca063/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3430333036302f38653732393864302d376639632d613332342d366333382d6439333364373532613962612e706e67" target="_blank" rel="nofollow noopener"><img width="690" alt="キャプチャ2.PNG" src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F403060%2F8e7298d0-7f9c-a324-6c38-d933d752a9ba.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=8aab7d604dc371360950e6fa904fd124" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/403060/8e7298d0-7f9c-a324-6c38-d933d752a9ba.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F403060%2F8e7298d0-7f9c-a324-6c38-d933d752a9ba.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=6121325daafdcf581fde5d42729e9160 1x" loading="lazy"></a></p>

<p>また、比較元画像のFaceIDとの類似度をコンソール上で表示します。</p>

<div class="code-frame" data-lang="console"><div class="highlight"><pre><code><span class="go">■FaceID：[0c8be41b-6d64-4a46-afcd-e4d70b78da12] との類似度判定
　7b05c4b3-4ffd-49aa-b0f2-14ca87dccff1 : 54.08％
　560bc9a3-6e68-442d-bc39-fcd2f21a32b1 : 8.98％
</span></code></pre></div></div>

<p>この場合、ちゃんと男性との類似度が高めに、女性との類似度が低めになっていますね。<br>
（高めにとは言ってもそんなに数値高くないですが…）</p>

<p>これは完全に体感ですが、48％（APIからの戻り値が0.48）以上あれば、同一人物と判断してもよさそうです。<br>
ちなみに、もし比較元画像から2人以上の顔が検出されれば、それぞれとの類似度が表示されることになります。</p>

<h1>
<span id="環境使ったもの" class="fragment"></span><a href="#%E7%92%B0%E5%A2%83%E4%BD%BF%E3%81%A3%E3%81%9F%E3%82%82%E3%81%AE"><i class="fa fa-link"></i></a>環境、使ったもの</h1>

<ul>
<li>Windows10</li>
<li>C# 7.0</li>
<li>.NET Framework 4.7.2</li>
<li>Visual Studio 2017 Community
※2019と行ったり来たりしてたけど</li>
<li>Microsoft Face API</li>
<li>OpenCVSharp 3</li>
<li>Json.NET 12.0.2</li>
</ul>

<h1>
<span id="face-findsimilarについて" class="fragment"></span><a href="#face-findsimilar%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>Face FindSimilarについて</h1>

<p>今回はCognitive ServicesのFace APIから、Face FindSimilarという機能をアプリのメインとします。<br>
Cognitive Servicesは、Microsoft Azureの提供するAIや機械学習に関するサービス群のことです。<br>
Face FindSimilarは比較元となるFaceID（検出した顔情報に一意に割り振られるID）と、比較先となるFaceIDの配列や事前に作成した顔グループを渡すことで、比較先の顔が比較元とどれだけ似ているのかを返してくれる機能です。</p>

<p>ちなみにFaceIDを取得するにはFace Detect機能を使用する必要があるので、そちらも同時に実装していきます。<br>
というか①ではそっちの実装がメインになります…</p>

<p>※Face Detect機能のみの単純な実装は、前回の<a href="https://qiita.com/koob/items/f6ccb764715040ddf699" id="reference-4ad697cd3089c7547dcc">【10分でできる】AzureのFace APIを使って画像から顔を検出する</a>で紹介しています。<br>
とりあえずFace APIを使ってみたいという方や、画像に写っている人の性別、年齢、特徴、感情などが検出できればいいという方はそちらを参照されることをお勧めします。<br>
今回は画像の加工などもあるため、さすがに10分でとはいきませんでした( ;∀;)</p>

<h4>
<span id="face-apiへpostする際の各パラメータなど" class="fragment"></span><a href="#face-api%E3%81%B8post%E3%81%99%E3%82%8B%E9%9A%9B%E3%81%AE%E5%90%84%E3%83%91%E3%83%A9%E3%83%A1%E3%83%BC%E3%82%BF%E3%81%AA%E3%81%A9"><i class="fa fa-link"></i></a>Face APIへPOSTする際の各パラメータなど</h4>

<p><strong>Face Detect</strong></p>

<ul>
<li>リクエストヘッダ：

<ul>
<li>Content-Type：<code>"application/octet-stream"</code>
</li>
<li>Ocp-Apim-Subscription-Key：Face APIキー</li>
</ul>
</li>
<li>リクエストボディ：

<ul>
<li>url：画像のバイナリデータ</li>
</ul>
</li>
<li>POST先のURL：<code>エンドポイント + "/detect" + "?returnFaceId=true&amp;returnFaceLandmarks=false"</code>
</li>
</ul>

<p><strong>Face FindSimilar</strong></p>

<ul>
<li>リクエストヘッダ：

<ul>
<li>Content-Type：<code>"application/json"</code>
</li>
<li>Ocp-Apim-Subscription-Key：Face APIキー</li>
</ul>
</li>
<li>リクエストボディ：

<ul>
<li>faceId：Face Detectで取得する一意のID。取得後24時間で期限切れとなります。</li>
<li>faceListId：ユーザー指定の一意の候補顔リスト。（今回は未使用）</li>
<li>LargefaceListId：ユーザー指定の一意の候補顔リスト。（今回は未使用）</li>
<li>faceIds：Face Detectで取得する一意のIDの配列。</li>
<li>maxNumOfCandidatesReturned（オプション）：比較先となるfaceIdの内、上位何番目までの顔情報を返すか（デフォルトは20）</li>
<li>mode（オプション）：判定方法。<code>"matchPerson"</code>または<code>"matchFace"</code>を指定。</li>
</ul>
</li>
<li>POST先のURL：<code>エンドポイント + "/findsimilars"</code>
</li>
</ul>

<p>参考：<br>
<a href="https://westus.dev.cognitive.microsoft.com/docs/services/563879b61984550e40cbbe8d/operations/563879b61984550f30395236" rel="nofollow noopener" target="_blank">Face Detect APIリファレンス</a><br>
<a href="https://westus.dev.cognitive.microsoft.com/docs/services/563879b61984550e40cbbe8d/operations/563879b61984550f30395237" rel="nofollow noopener" target="_blank">Face FindSimilar APIリファレンス</a></p>

<h1>
<span id="作成手順" class="fragment"></span><a href="#%E4%BD%9C%E6%88%90%E6%89%8B%E9%A0%86"><i class="fa fa-link"></i></a>作成手順</h1>

<h4>
<span id="だいたいこんな感じ" class="fragment"></span><a href="#%E3%81%A0%E3%81%84%E3%81%9F%E3%81%84%E3%81%93%E3%82%93%E3%81%AA%E6%84%9F%E3%81%98"><i class="fa fa-link"></i></a>だいたいこんな感じ</h4>

<ol>
<li>（準備）</li>
<li>Face Detectから顔情報を取得</li>
<li>Face Detectから戻り値の受け取り</li>
<li>OpenCVSharpで検出箇所を画像に描画</li>
<li>Face FindSimilarで類似度の判定</li>
</ol>

<p>以下、この手順で実装を進めていきます。</p>

<h2>
<span id="1-準備" class="fragment"></span><a href="#1-%E6%BA%96%E5%82%99"><i class="fa fa-link"></i></a>1. 準備</h2>

<h4>
<span id="コンソールアプリを新規作成" class="fragment"></span><a href="#%E3%82%B3%E3%83%B3%E3%82%BD%E3%83%BC%E3%83%AB%E3%82%A2%E3%83%97%E3%83%AA%E3%82%92%E6%96%B0%E8%A6%8F%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>コンソールアプリを新規作成</h4>

<p>作りましょう。<br>
名前はとりあえず「FindSimilar」とします。<br>
<a href="https://camo.qiitausercontent.com/1574c6930261efde761b41ad4ca352d9475afd07/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3430333036302f35383632313163372d346263382d643335642d373333382d3564383436323466643331652e706e67" target="_blank" rel="nofollow noopener"><img width="708" alt="キャプチャ1.PNG" src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F403060%2F586211c7-4bc8-d35d-7338-5d84624fd31e.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=d71264ac397768add5d1641aaf9f2113" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/403060/586211c7-4bc8-d35d-7338-5d84624fd31e.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F403060%2F586211c7-4bc8-d35d-7338-5d84624fd31e.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=362bfb35129436f5c03772c4e39a4e8c 1x" loading="lazy"></a><br>
<a href="https://camo.qiitausercontent.com/460c47fee5c9f9a37677e96e0a8c3e85498dc02d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3430333036302f31336364303534372d616466362d663161392d346465362d3530636239623731333033392e706e67" target="_blank" rel="nofollow noopener"><img width="917" alt="キャプチャ2.PNG" src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F403060%2F13cd0547-adf6-f1a9-4de6-50cb9b713039.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=79c4371b900c3186a105f84c72951a2e" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/403060/13cd0547-adf6-f1a9-4de6-50cb9b713039.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F403060%2F13cd0547-adf6-f1a9-4de6-50cb9b713039.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=be9841df89602505fc73f892f000ab7a 1x" loading="lazy"></a></p>

<p>ついでに「Program.cs」ファイルの名前も変えちゃいます。<br>
ソリューションエクスプローラー上で「Program.cs」のファイル名を「FaceFindSimilar.cs」と変更すると、class名も「Program」から「FaceFindSimilar」となったかと思います。<br>
<a href="https://camo.qiitausercontent.com/a284f5f69b865f97df90eaf85f9c2fa74c19dc30/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3430333036302f65323337616265302d393466362d343930652d613836612d6161373463343261333233312e706e67" target="_blank" rel="nofollow noopener"><img width="917" alt="キャプチャ3.PNG" src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F403060%2Fe237abe0-94f6-490e-a86a-aa74c42a3231.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=0d054f0deed29dcd76d2b8d01fce6f8c" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/403060/e237abe0-94f6-490e-a86a-aa74c42a3231.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F403060%2Fe237abe0-94f6-490e-a86a-aa74c42a3231.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=2b84cbcab132a9e26580480d02040a86 1x" loading="lazy"></a></p>

<h4>
<span id="設定ファイルの記述" class="fragment"></span><a href="#%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E8%A8%98%E8%BF%B0"><i class="fa fa-link"></i></a>設定ファイルの記述</h4>

<p>APIキーと、APIにアクセスする為のエンドポイントをApp.configに持たせます。<br>
<code>appSettings</code>タグとその中身が追加した部分です。</p>

<div class="code-frame" data-lang="config">
<div class="code-lang"><span class="bold">App.config</span></div>
<div class="highlight"><pre><code>&lt;?<span class="n">xml</span> <span class="n">version</span>=<span class="s2">"1.0"</span> <span class="n">encoding</span>=<span class="s2">"utf-8"</span> ?&gt;
&lt;<span class="n">configuration</span>&gt;
    &lt;<span class="n">startup</span>&gt; 
        &lt;<span class="n">supportedRuntime</span> <span class="n">version</span>=<span class="s2">"v4.0"</span> <span class="n">sku</span>=<span class="s2">".NETFramework,Version=v4.7.2"</span> /&gt;
    &lt;/<span class="n">startup</span>&gt;
    &lt;<span class="n">appSettings</span>&gt;
      &lt;<span class="n">add</span> <span class="n">key</span>=<span class="s2">"subscriptionKey"</span> <span class="n">value</span>=<span class="s2">"Your API Key"</span> /&gt;
      &lt;<span class="n">add</span> <span class="n">key</span>=<span class="s2">"requestUrl"</span> <span class="n">value</span>=<span class="s2">"https://westcentralus.api.cognitive.microsoft.com/face/v1.0/"</span> /&gt;
    &lt;/<span class="n">appSettings</span>&gt;
&lt;/<span class="n">configuration</span>&gt;
</code></pre></div>
</div>

<p><code>"subscriptionKey"</code>のvalueにAPIキーを、<code>"requestUrl"</code>のvalueにFace APIキー取得時に表示されたエンドポイントを記載してください。</p>

<h2>
<span id="2-face-detectから顔情報を取得" class="fragment"></span><a href="#2-face-detect%E3%81%8B%E3%82%89%E9%A1%94%E6%83%85%E5%A0%B1%E3%82%92%E5%8F%96%E5%BE%97"><i class="fa fa-link"></i></a>2. Face Detectから顔情報を取得</h2>

<p>OpenCVSharp、Face FindSimilarを使う上で必要な情報を、Face Detectから取得しましょう。</p>

<h4>
<span id="facedetectcsファイルの作成" class="fragment"></span><a href="#facedetectcs%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>FaceDetect.csファイルの作成</h4>

<p>すべての処理をFaceFindSimilar.csファイルに書くと読みにくいので、FaceDetect.csファイルを作成し、Face Detect機能による顔の検出処理はすべてそこに記述することにします。</p>

<p>「Ctrl」＋「Shift」＋「A」で「新しい項目の追加」ウィンドウを開きましょう。<br>
<a href="https://camo.qiitausercontent.com/b6bda384ad583195170d5b5d733a522ccbd729d7/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3430333036302f37356438656662382d663135352d623266662d623962312d6561633231666331636365622e706e67" target="_blank" rel="nofollow noopener"><img width="707" alt="キャプチャ4.PNG" src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F403060%2F75d8efb8-f155-b2ff-b9b1-eac21fc1cceb.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=fc5ecebd15efd280566cedcd92732214" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/403060/75d8efb8-f155-b2ff-b9b1-eac21fc1cceb.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F403060%2F75d8efb8-f155-b2ff-b9b1-eac21fc1cceb.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=6dd85643b88783fd68207fe83a04176b 1x" loading="lazy"></a><br>
「クラス」を選択し、名前は「FaceDetect.cs」とします。<br>
作成できたら、以下のようになると思います。<br>
<a href="https://camo.qiitausercontent.com/67cd50a94a6cebf36b27d1a30b1829db1d1a00ab/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3430333036302f63626163336430622d623561662d636433342d343138342d6264323062323032373861362e706e67" target="_blank" rel="nofollow noopener"><img width="917" alt="キャプチャ5.PNG" src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F403060%2Fcbac3d0b-b5af-cd34-4184-bd20b20278a6.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=ad501412c54149037cde9991461f6073" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/403060/cbac3d0b-b5af-cd34-4184-bd20b20278a6.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F403060%2Fcbac3d0b-b5af-cd34-4184-bd20b20278a6.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=a1606b35e28b541cbaef0d7df10b95f4 1x" loading="lazy"></a></p>

<h4>
<span id="戻り値はなにか" class="fragment"></span><a href="#%E6%88%BB%E3%82%8A%E5%80%A4%E3%81%AF%E3%81%AA%E3%81%AB%E3%81%8B"><i class="fa fa-link"></i></a>戻り値はなにか</h4>

<p>メインメソッドからFaceDetectクラスのメソッド（Detectメソッドとします）を呼び出して、検出した顔のIDやOpenCVSharpで枠を描画する為の座標を取得するわけですが、まずはその時Detectメソッドに渡す引数と、Detectメソッドから欲しい情報を整理してみます。</p>

<h5>
<span id="引数" class="fragment"></span><a href="#%E5%BC%95%E6%95%B0"><i class="fa fa-link"></i></a>引数</h5>

<p>Face DetectはAPIに対してURLだけ渡せばいいので、比較元画像のURLと比較先画像のURLを渡してあげようと思います。<br>
ただし、URLをただの文字列や配列として渡すと比較元と比較先の区別がつかなくなるので、今回はdictionary型にして以下のように渡したいと思います。</p>

<ul>
<li>Key:　"base" (string)　Value: "比較元URL" (string)</li>
<li>Key:　"target" (string)　Value: "比較先URL" (string)</li>
</ul>

<h5>
<span id="戻り値" class="fragment"></span><a href="#%E6%88%BB%E3%82%8A%E5%80%A4"><i class="fa fa-link"></i></a>戻り値</h5>

<p>顔情報の検出後、FaceFindSimilarクラス側で必要な情報は以下になります。<br>
検出箇所の座標は、OpenCVSharpで検出箇所を描画する為に必要になります。</p>

<ul>
<li>取得元： "base" or "target" (string)</li>
<li>取得元URL： "比較元URL" or "比較先URL" (string)</li>
<li>検出した顔のID (string)</li>
<li>検出箇所の座標（x軸） (int)</li>
<li>検出箇所の座標（y軸） (int)</li>
<li>検出箇所の座標（左上からの幅） (int)</li>
<li>検出箇所の座標（左上からの高さ） (int)</li>
</ul>

<p>戻り値が多いので、今回は上記を含む「FaceInfo」クラス型を作成し、そのリストを返してあげることにしました。<br>
<code>namespace FaceFindSimilar</code>の中に、以下のようにクラスとプロパティを追加します。</p>

<div class="code-frame" data-lang="c#">
<div class="code-lang"><span class="bold">FaceDetect.cs</span></div>
<div class="highlight"><pre><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Linq</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Text</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Threading.Tasks</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">FindSimilar</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">FaceInfo</span>
    <span class="p">{</span>
        <span class="c1">// 取得元： "base" or "target" (string)</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">faceDivision</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="c1">// 取得元URL： "比較元URL" or "比較先URL" (string)</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">sourceUrl</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="c1">// 検出した顔のID (string)</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">faceId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="c1">// 検出箇所の座標（x軸） (int)</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">recLeft</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="c1">// 検出箇所の座標（y軸） (int)</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">recTop</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="c1">// 検出箇所の座標（左上からの幅） (int)</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">recWidth</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="c1">// 検出箇所の座標（左上からの高さ） (int)</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">recHeight</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">class</span> <span class="nc">FaceDetect</span>
    <span class="p">{</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div>
</div>

<h4>
<span id="detectメソッドの実装" class="fragment"></span><a href="#detect%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%AE%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>Detectメソッドの実装</h4>

<p>次に、実際にFindSimilarメソッドから呼び出されるDetectメソッドを、FaceDetectクラスの中に記述していきます。</p>

<div class="code-frame" data-lang="c#">
<div class="code-lang"><span class="bold">FaceDetect.cs</span></div>
<div class="highlight"><pre><code>    <span class="k">class</span> <span class="nc">FaceDetect</span>
    <span class="p">{</span>
        <span class="k">static</span> <span class="k">public</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">FaceInfo</span><span class="p">&gt;</span> <span class="nf">Detect</span><span class="p">(</span><span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;</span> <span class="n">imageUrls</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">List</span><span class="p">&lt;</span><span class="n">FaceInfo</span><span class="p">&gt;</span> <span class="n">faceInfoList</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">FaceInfo</span><span class="p">&gt;();</span>

            <span class="k">try</span>
            <span class="p">{</span>
                <span class="c1">//faceInfoList = ImageAnalysisRequest(imageUrls).Result;</span>
            <span class="p">}</span>
            <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"例外："</span> <span class="p">+</span> <span class="n">e</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="n">faceInfoList</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div>
</div>

<p>Detectメソッドは戻り値となる顔情報を返すだけです。<br>
実際にFace API Detectから顔情報を取得してくる処理は、Try~Catchの中で現在コメントアウトされているImageAnalysisRequestメソッドで行います。</p>

<h4>
<span id="imageanalysisrequestメソッド--α-の実装" class="fragment"></span><a href="#imageanalysisrequest%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89--%CE%B1-%E3%81%AE%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>ImageAnalysisRequestメソッド ＋ α の実装</h4>

<p>FaceDetectクラスの中に、Face API Detectの呼び出し処理を追加します。<br>
また、APIに渡す画像はバイナリデータにする為、そのためのGetImageAsByteArrayメソッドも追加しています。</p>

<div class="code-frame" data-lang="c#">
<div class="code-lang"><span class="bold">FaceDetect.cs</span></div>
<div class="highlight"><pre><code>        <span class="c1">// Face API Detectを使用して画像分析を行う</span>
        <span class="k">static</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">List</span><span class="p">&lt;</span><span class="n">FaceInfo</span><span class="p">&gt;&gt;</span> <span class="nf">ImageAnalysisRequest</span><span class="p">(</span><span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;</span> <span class="n">imageUrls</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">List</span><span class="p">&lt;</span><span class="n">FaceInfo</span><span class="p">&gt;</span> <span class="n">faceInfoList</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">FaceInfo</span><span class="p">&gt;();</span>
            <span class="n">HttpClient</span> <span class="n">client</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HttpClient</span><span class="p">();</span>

            <span class="c1">// リクエストヘッダー</span>
            <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Ocp-Apim-Subscription-Key"</span><span class="p">,</span> <span class="n">ConfigurationManager</span><span class="p">.</span><span class="n">AppSettings</span><span class="p">[</span><span class="s">"subscriptionKey"</span><span class="p">]);</span>

            <span class="c1">// リクエストパラメータ</span>
            <span class="kt">string</span> <span class="n">requestParameters</span> <span class="p">=</span> <span class="s">"returnFaceId=true&amp;returnFaceLandmarks=false"</span><span class="p">;</span>

            <span class="kt">string</span> <span class="n">uri</span> <span class="p">=</span> <span class="n">ConfigurationManager</span><span class="p">.</span><span class="n">AppSettings</span><span class="p">[</span><span class="s">"requestUrl"</span><span class="p">]</span> <span class="p">+</span> <span class="s">"detect"</span> <span class="p">+</span> <span class="s">"?"</span> <span class="p">+</span> <span class="n">requestParameters</span><span class="p">;</span>

            <span class="c1">// 画像ファイルを一枚ずつ処理する</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="n">KeyValuePair</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;</span> <span class="n">item</span> <span class="k">in</span> <span class="n">imageUrls</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="kt">string</span> <span class="n">contentString</span> <span class="p">=</span> <span class="kt">string</span><span class="p">.</span><span class="n">Empty</span><span class="p">;</span>

                <span class="kt">byte</span><span class="p">[]</span> <span class="n">byteData</span> <span class="p">=</span> <span class="nf">GetImageAsByteArray</span><span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="n">Value</span><span class="p">);</span>

                <span class="c1">// 画像から顔を検出</span>
                <span class="k">using</span> <span class="p">(</span><span class="n">ByteArrayContent</span> <span class="n">content</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ByteArrayContent</span><span class="p">(</span><span class="n">byteData</span><span class="p">))</span>
                <span class="p">{</span>
                    <span class="c1">// リクエストヘッダーの作成</span>
                    <span class="n">content</span><span class="p">.</span><span class="n">Headers</span><span class="p">.</span><span class="n">ContentType</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MediaTypeHeaderValue</span><span class="p">(</span><span class="s">"application/octet-stream"</span><span class="p">);</span>

                    <span class="c1">// Face APIの呼び出し</span>
                    <span class="n">HttpResponseMessage</span> <span class="n">response</span> <span class="p">=</span> <span class="k">await</span> <span class="n">client</span><span class="p">.</span><span class="nf">PostAsync</span><span class="p">(</span><span class="n">uri</span><span class="p">,</span> <span class="n">content</span><span class="p">);</span>

                    <span class="c1">// 実行結果からJSONの取得</span>
                    <span class="n">contentString</span> <span class="p">=</span> <span class="k">await</span> <span class="n">response</span><span class="p">.</span><span class="n">Content</span><span class="p">.</span><span class="nf">ReadAsStringAsync</span><span class="p">();</span>
                <span class="p">}</span>

            <span class="p">}</span>

            <span class="k">return</span> <span class="n">faceInfoList</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// 画像をバイナリデータに変換</span>
        <span class="k">static</span> <span class="kt">byte</span><span class="p">[]</span> <span class="nf">GetImageAsByteArray</span><span class="p">(</span><span class="kt">string</span> <span class="n">imageFilePath</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">using</span> <span class="p">(</span><span class="n">FileStream</span> <span class="n">fileStream</span> <span class="p">=</span>
                <span class="k">new</span> <span class="nf">FileStream</span><span class="p">(</span><span class="n">imageFilePath</span><span class="p">,</span> <span class="n">FileMode</span><span class="p">.</span><span class="n">Open</span><span class="p">,</span> <span class="n">FileAccess</span><span class="p">.</span><span class="n">Read</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="n">BinaryReader</span> <span class="n">binaryReader</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">BinaryReader</span><span class="p">(</span><span class="n">fileStream</span><span class="p">);</span>
                <span class="k">return</span> <span class="n">binaryReader</span><span class="p">.</span><span class="nf">ReadBytes</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">fileStream</span><span class="p">.</span><span class="n">Length</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

</code></pre></div>
</div>

<p>これだけだと色々参照エラーが出ると思うので、参照に以下<code>System.Configuration</code>を追加して、<br>
<a href="https://camo.qiitausercontent.com/3a73e4da87467c5469c80174c5c900e21cf705a7/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3430333036302f62323531643534632d333132302d646137372d346562362d6364343630643630316334622e706e67" target="_blank" rel="nofollow noopener"><img width="591" alt="キャプチャ3.PNG" src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F403060%2Fb251d54c-3120-da77-4eb6-cd460d601c4b.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=999a181b916ccc616d39a45c81f7c8e9" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/403060/b251d54c-3120-da77-4eb6-cd460d601c4b.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F403060%2Fb251d54c-3120-da77-4eb6-cd460d601c4b.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=640f0df42fef2720a18e97b1b981bb79 1x" loading="lazy"></a><br>
以下のusingも追加します。</p>

<div class="code-frame" data-lang="c#"><div class="highlight"><pre><code><span class="k">using</span> <span class="nn">System.IO</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Net.Http</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Net.Http.Headers</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Configuration</span><span class="p">;</span>
</code></pre></div></div>

<p>何をやっているかというと、引数として受け取った画像ファイルのdictionaryを一つずつ取り出して、Face API Detectに渡したその実行結果、つまりFaceIDや検出箇所の座標を取得しています。<br>
リクエストパラメータにもっと色々指定することで、検出した顔の推定年齢、感情や髪色その他までわかるのですが、今回は必要ないので必要最低限<code>"returnFaceId=true&amp;returnFaceLandmarks=false"</code>だけ指定しています。</p>

<p>この時点ではまだアプリケーションを実行できませんが、もし比較先画像のファイルパスが<code>item.Value</code>に入っていた場合、以下のようなJSON文字列が<code>contentString</code>から取得できるはずです。</p>

<div class="code-frame" data-lang="json"><div class="highlight"><pre><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"faceId"</span><span class="p">:</span><span class="s2">"46086930-6e5b-4c54-956b-1d72de419266"</span><span class="w">
    </span><span class="p">,</span><span class="nl">"faceRectangle"</span><span class="p">:{</span><span class="nl">"top"</span><span class="p">:</span><span class="mi">260</span><span class="p">,</span><span class="nl">"left"</span><span class="p">:</span><span class="mi">765</span><span class="p">,</span><span class="nl">"width"</span><span class="p">:</span><span class="mi">148</span><span class="p">,</span><span class="nl">"height"</span><span class="p">:</span><span class="mi">148</span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="p">,{</span><span class="w">
    </span><span class="nl">"faceId"</span><span class="p">:</span><span class="s2">"f8410c80-b7ff-4d05-bd1f-75a7f3cb2cc8"</span><span class="w">
    </span><span class="p">,</span><span class="nl">"faceRectangle"</span><span class="p">:{</span><span class="nl">"top"</span><span class="p">:</span><span class="mi">347</span><span class="p">,</span><span class="nl">"left"</span><span class="p">:</span><span class="mi">545</span><span class="p">,</span><span class="nl">"width"</span><span class="p">:</span><span class="mi">124</span><span class="p">,</span><span class="nl">"height"</span><span class="p">:</span><span class="mi">124</span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<p><code>faceId</code>が、検出できた顔に割り振られた一意のID。<br>
<code>faceRectangle</code>の配列が、検出された位置の座標です。<br>
この時点では2人分の顔が検出され、配列として返ってきています。</p>

<p>今はただのJSONなので、今度はこれを戻り値の型である独自クラス<code>FaceInfo</code>型のListに整形する必用があります。<br>
整形するにあたってはJSONをstring型の配列として扱いたいので、ここではJSONをC#で扱う為のライブラリ<strong>「Json.NET」</strong>を使って整形したいと思います。</p>

<p>まず、Json.NETをNuGetから取得しましょう。<br>
VisualStudioの「プロジェクト」メニューから「NuGetパッケージの管理」を選択します。<br>
<a href="https://camo.qiitausercontent.com/a5a10e6ceaeb84aadd19bd58485149961844ce67/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3430333036302f34373161303438632d323036382d323632642d356363662d3565663734393531626135362e706e67" target="_blank" rel="nofollow noopener"><img width="704" alt="キャプチャ4.PNG" src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F403060%2F471a048c-2068-262d-5ccf-5ef74951ba56.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=bc87f23fc83aa40885deb745ac3c456c" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/403060/471a048c-2068-262d-5ccf-5ef74951ba56.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F403060%2F471a048c-2068-262d-5ccf-5ef74951ba56.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=684008c179d1e03c6a260c3a39878773 1x" loading="lazy"></a><br>
NuGetの管理画面が開くので、「参照」を選択し、検索窓に「Newtonsoft.Json」と入力。ロケットのアイコンのライブラリが表示されるので選択して、インストールボタンをクリックします。<br>
現時点でのバージョンは12.0.2でした。<br>
<a href="https://camo.qiitausercontent.com/7a0de25f2b8e21119273b8fd882f8885f716fea9/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3430333036302f64326164373862382d653865612d333030362d613934642d3633323361363361343533662e706e67" target="_blank" rel="nofollow noopener"><img width="723" alt="キャプチャ5.PNG" src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F403060%2Fd2ad78b8-e8ea-3006-a94d-6323a63a453f.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=2f8fc054f6bea40771a71e724851c2a2" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/403060/d2ad78b8-e8ea-3006-a94d-6323a63a453f.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F403060%2Fd2ad78b8-e8ea-3006-a94d-6323a63a453f.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=77b32305f0f89c123d9c436c5565da06 1x" loading="lazy"></a><br>
インストールが正常に完了すれば、ソリューションエクスプローラーの参照先に「Newtonsoft.Json」が追加されているはずです。<br>
<a href="https://camo.qiitausercontent.com/a0c4ad3e969efd1abf467ca6b8735ab324ce4b1e/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3430333036302f34633932386139642d346432322d313334392d303031372d6437643562623963333163322e706e67" target="_blank" rel="nofollow noopener"><img width="191" alt="キャプチャ6.PNG" src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F403060%2F4c928a9d-4d22-1349-0017-d7d5bb9c31c2.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=3117981e8ceeed1124fdbabcd55d2716" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/403060/4c928a9d-4d22-1349-0017-d7d5bb9c31c2.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F403060%2F4c928a9d-4d22-1349-0017-d7d5bb9c31c2.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=f53ae48c52053f74686f53a3118e3701 1x" loading="lazy"></a><br>
無事参照追加できていたら、FaceDetect.csファイルに処理を追加します。<br>
「追加箇所 From(～To)」となっている箇所が新たに追記した部分です。<br>
※このファイルの修正はここまでなので、全文を載せます。</p>

<div class="code-frame" data-lang="c#">
<div class="code-lang"><span class="bold">FaceDetect.cs</span></div>
<div class="highlight"><pre><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Linq</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Text</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Threading.Tasks</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.IO</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Net.Http</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Net.Http.Headers</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Configuration</span><span class="p">;</span>
<span class="c1">// 追加箇所 From-----------------------------------------------------------------</span>
<span class="k">using</span> <span class="nn">Newtonsoft.Json.Linq</span><span class="p">;</span>
<span class="c1">// 追加箇所 To-------------------------------------------------------------------</span>

<span class="k">namespace</span> <span class="nn">FindSimilar</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">FaceInfo</span>
    <span class="p">{</span>
        <span class="c1">// 取得元： "base" or "target" (string)</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">faceDivision</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="c1">// 取得元URL： "比較元URL" or "比較先URL" (string)</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">sourceUrl</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="c1">// 検出した顔のID (string)</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">faceId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="c1">// 検出箇所の座標（x軸） (int)</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">recLeft</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="c1">// 検出箇所の座標（y軸） (int)</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">recTop</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="c1">// 検出箇所の座標（左上からの幅） (int)</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">recWidth</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="c1">// 検出箇所の座標（左上からの高さ） (int)</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">recHeight</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">class</span> <span class="nc">FaceDetect</span>
    <span class="p">{</span>
        <span class="k">static</span> <span class="k">public</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">FaceInfo</span><span class="p">&gt;</span> <span class="nf">Detect</span><span class="p">(</span><span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;</span> <span class="n">imageUrls</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">List</span><span class="p">&lt;</span><span class="n">FaceInfo</span><span class="p">&gt;</span> <span class="n">faceInfoList</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">FaceInfo</span><span class="p">&gt;();</span>

            <span class="k">try</span>
            <span class="p">{</span>
                <span class="n">faceInfoList</span> <span class="p">=</span> <span class="nf">ImageAnalysisRequest</span><span class="p">(</span><span class="n">imageUrls</span><span class="p">).</span><span class="n">Result</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"例外："</span> <span class="p">+</span> <span class="n">e</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="n">faceInfoList</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// Face API Detectを使用して画像分析を行う</span>
        <span class="k">static</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">List</span><span class="p">&lt;</span><span class="n">FaceInfo</span><span class="p">&gt;&gt;</span> <span class="nf">ImageAnalysisRequest</span><span class="p">(</span><span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;</span> <span class="n">imageUrls</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">List</span><span class="p">&lt;</span><span class="n">FaceInfo</span><span class="p">&gt;</span> <span class="n">faceInfoList</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">FaceInfo</span><span class="p">&gt;();</span>
            <span class="n">HttpClient</span> <span class="n">client</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HttpClient</span><span class="p">();</span>

            <span class="c1">// リクエストヘッダー</span>
            <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Ocp-Apim-Subscription-Key"</span><span class="p">,</span> <span class="n">ConfigurationManager</span><span class="p">.</span><span class="n">AppSettings</span><span class="p">[</span><span class="s">"subscriptionKey"</span><span class="p">]);</span>

            <span class="c1">// リクエストパラメータ</span>
            <span class="kt">string</span> <span class="n">requestParameters</span> <span class="p">=</span> <span class="s">"returnFaceId=true&amp;returnFaceLandmarks=false"</span><span class="p">;</span>

            <span class="kt">string</span> <span class="n">uri</span> <span class="p">=</span> <span class="n">ConfigurationManager</span><span class="p">.</span><span class="n">AppSettings</span><span class="p">[</span><span class="s">"requestUrl"</span><span class="p">]</span> <span class="p">+</span> <span class="s">"detect"</span> <span class="p">+</span> <span class="s">"?"</span> <span class="p">+</span> <span class="n">requestParameters</span><span class="p">;</span>

            <span class="c1">// 画像ファイルを一枚ずつ処理する</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="n">KeyValuePair</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;</span> <span class="n">item</span> <span class="k">in</span> <span class="n">imageUrls</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="kt">string</span> <span class="n">contentString</span> <span class="p">=</span> <span class="kt">string</span><span class="p">.</span><span class="n">Empty</span><span class="p">;</span>

                <span class="kt">byte</span><span class="p">[]</span> <span class="n">byteData</span> <span class="p">=</span> <span class="nf">GetImageAsByteArray</span><span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="n">Value</span><span class="p">);</span>

                <span class="c1">// 画像から顔を検出</span>
                <span class="k">using</span> <span class="p">(</span><span class="n">ByteArrayContent</span> <span class="n">content</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ByteArrayContent</span><span class="p">(</span><span class="n">byteData</span><span class="p">))</span>
                <span class="p">{</span>
                    <span class="c1">// リクエストヘッダーの作成</span>
                    <span class="n">content</span><span class="p">.</span><span class="n">Headers</span><span class="p">.</span><span class="n">ContentType</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MediaTypeHeaderValue</span><span class="p">(</span><span class="s">"application/octet-stream"</span><span class="p">);</span>

                    <span class="c1">// Face APIの呼び出し</span>
                    <span class="n">HttpResponseMessage</span> <span class="n">response</span> <span class="p">=</span> <span class="k">await</span> <span class="n">client</span><span class="p">.</span><span class="nf">PostAsync</span><span class="p">(</span><span class="n">uri</span><span class="p">,</span> <span class="n">content</span><span class="p">);</span>

                    <span class="c1">// 実行結果からJSONの取得</span>
                    <span class="n">contentString</span> <span class="p">=</span> <span class="k">await</span> <span class="n">response</span><span class="p">.</span><span class="n">Content</span><span class="p">.</span><span class="nf">ReadAsStringAsync</span><span class="p">();</span>
                <span class="p">}</span>

                <span class="c1">// 追加箇所 From-----------------------------------------------------------------</span>
                <span class="c1">// 戻り値となるリストへ顔情報を追加していく</span>
                <span class="n">JArray</span> <span class="n">jArray</span> <span class="p">=</span> <span class="n">JArray</span><span class="p">.</span><span class="nf">Parse</span><span class="p">(</span><span class="n">contentString</span><span class="p">);</span>
                <span class="k">foreach</span> <span class="p">(</span><span class="n">JObject</span> <span class="n">jObj</span> <span class="k">in</span> <span class="n">jArray</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="c1">// 顔情報をFaceInfoクラス型に整形する</span>
                    <span class="n">FaceInfo</span> <span class="n">faceInfo</span> <span class="p">=</span> <span class="nf">CreateFaceInfo</span><span class="p">(</span><span class="n">jObj</span><span class="p">,</span> <span class="n">item</span><span class="p">);</span>

                    <span class="n">faceInfoList</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">faceInfo</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="c1">// 追加箇所 To-------------------------------------------------------------------</span>

            <span class="p">}</span>

            <span class="k">return</span> <span class="n">faceInfoList</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// 追加箇所 From-----------------------------------------------------------------</span>
        <span class="c1">// FaceInfoクラス型のインスタンスを作成</span>
        <span class="k">static</span> <span class="n">FaceInfo</span> <span class="nf">CreateFaceInfo</span><span class="p">(</span><span class="n">JObject</span> <span class="n">jObj</span><span class="p">,</span> <span class="n">KeyValuePair</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;</span> <span class="n">keyValue</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">JValue</span> <span class="n">jValFaceId</span> <span class="p">=</span> <span class="p">(</span><span class="n">JValue</span><span class="p">)</span><span class="n">jObj</span><span class="p">[</span><span class="s">"faceId"</span><span class="p">];</span>
            <span class="n">JValue</span> <span class="n">jValRectLeft</span> <span class="p">=</span> <span class="p">(</span><span class="n">JValue</span><span class="p">)</span><span class="n">jObj</span><span class="p">[</span><span class="s">"faceRectangle"</span><span class="p">][</span><span class="s">"left"</span><span class="p">];</span>
            <span class="n">JValue</span> <span class="n">jValRectTop</span> <span class="p">=</span> <span class="p">(</span><span class="n">JValue</span><span class="p">)</span><span class="n">jObj</span><span class="p">[</span><span class="s">"faceRectangle"</span><span class="p">][</span><span class="s">"top"</span><span class="p">];</span>
            <span class="n">JValue</span> <span class="n">jValRectWidth</span> <span class="p">=</span> <span class="p">(</span><span class="n">JValue</span><span class="p">)</span><span class="n">jObj</span><span class="p">[</span><span class="s">"faceRectangle"</span><span class="p">][</span><span class="s">"width"</span><span class="p">];</span>
            <span class="n">JValue</span> <span class="n">jValRectHeight</span> <span class="p">=</span> <span class="p">(</span><span class="n">JValue</span><span class="p">)</span><span class="n">jObj</span><span class="p">[</span><span class="s">"faceRectangle"</span><span class="p">][</span><span class="s">"height"</span><span class="p">];</span>

            <span class="n">FaceInfo</span> <span class="n">faceInfo</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">FaceInfo</span><span class="p">();</span>
            <span class="n">faceInfo</span><span class="p">.</span><span class="n">faceDivision</span> <span class="p">=</span> <span class="n">keyValue</span><span class="p">.</span><span class="n">Key</span><span class="p">;</span>
            <span class="n">faceInfo</span><span class="p">.</span><span class="n">sourceUrl</span> <span class="p">=</span> <span class="n">keyValue</span><span class="p">.</span><span class="n">Value</span><span class="p">;</span>
            <span class="n">faceInfo</span><span class="p">.</span><span class="n">faceId</span> <span class="p">=</span> <span class="n">jValFaceId</span><span class="p">.</span><span class="nf">ToString</span><span class="p">();</span>
            <span class="n">faceInfo</span><span class="p">.</span><span class="n">recLeft</span> <span class="p">=</span> <span class="kt">int</span><span class="p">.</span><span class="nf">Parse</span><span class="p">(</span><span class="n">jValRectLeft</span><span class="p">.</span><span class="nf">ToString</span><span class="p">());</span>
            <span class="n">faceInfo</span><span class="p">.</span><span class="n">recTop</span> <span class="p">=</span> <span class="kt">int</span><span class="p">.</span><span class="nf">Parse</span><span class="p">(</span><span class="n">jValRectTop</span><span class="p">.</span><span class="nf">ToString</span><span class="p">());</span>
            <span class="n">faceInfo</span><span class="p">.</span><span class="n">recWidth</span> <span class="p">=</span> <span class="kt">int</span><span class="p">.</span><span class="nf">Parse</span><span class="p">(</span><span class="n">jValRectWidth</span><span class="p">.</span><span class="nf">ToString</span><span class="p">());</span>
            <span class="n">faceInfo</span><span class="p">.</span><span class="n">recHeight</span> <span class="p">=</span> <span class="kt">int</span><span class="p">.</span><span class="nf">Parse</span><span class="p">(</span><span class="n">jValRectHeight</span><span class="p">.</span><span class="nf">ToString</span><span class="p">());</span>

            <span class="k">return</span> <span class="n">faceInfo</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="c1">// 追加箇所 To-------------------------------------------------------------------</span>

        <span class="c1">// 画像をバイナリデータに変換</span>
        <span class="k">static</span> <span class="kt">byte</span><span class="p">[]</span> <span class="nf">GetImageAsByteArray</span><span class="p">(</span><span class="kt">string</span> <span class="n">imageFilePath</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">using</span> <span class="p">(</span><span class="n">FileStream</span> <span class="n">fileStream</span> <span class="p">=</span>
                <span class="k">new</span> <span class="nf">FileStream</span><span class="p">(</span><span class="n">imageFilePath</span><span class="p">,</span> <span class="n">FileMode</span><span class="p">.</span><span class="n">Open</span><span class="p">,</span> <span class="n">FileAccess</span><span class="p">.</span><span class="n">Read</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="n">BinaryReader</span> <span class="n">binaryReader</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">BinaryReader</span><span class="p">(</span><span class="n">fileStream</span><span class="p">);</span>
                <span class="k">return</span> <span class="n">binaryReader</span><span class="p">.</span><span class="nf">ReadBytes</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">fileStream</span><span class="p">.</span><span class="n">Length</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>追加箇所ではFace Detectの結果JSONを入れていた<code>contentString</code>を、JArray型というJson.NET独自の配列にパースしています。<br>
その後foreachで配列の数だけCreateFaceInfoメソッドを呼んでFaceInfo型に整形した後、<code>faceInfoList</code>というListにAddしていきます。</p>

<p>本当は上記のような方法ではなく、<code>faceInfoList = JsonConvert.DeserializeObject&lt;List&lt;FaceInfo&gt;&gt;(contentString);</code>として一文で書ければよかったのですが、今回は戻り値にどの画像から取得してきたのかという情報を付加したかったので、最終的にこの形に落ち着きました。<br>
戻り値の型を<code>List&lt;FaceInfo&gt;</code>ではなく<code>Dictionary&lt;string, List&lt;FaceInfo&gt;&gt;</code>としてKeyに"base" または "target"を指定してあげればよかったような気もしますが、そうすると受け取り側の処理がまた煩雑になりそうだったので、とりあえず今回はこれで。</p>

<p>ここまででFace Detect側の処理は終了です。<br>
（長かった…）</p>

<p>最後に、FaceFindSimilar.cs側で値を受け取れるか確認して、①は終了したいと思います。<br>
もう少しだけお付き合いくださいませ。</p>

<h2>
<span id="3-face-detectから戻り値の受け取り" class="fragment"></span><a href="#3-face-detect%E3%81%8B%E3%82%89%E6%88%BB%E3%82%8A%E5%80%A4%E3%81%AE%E5%8F%97%E3%81%91%E5%8F%96%E3%82%8A"><i class="fa fa-link"></i></a>3. Face Detectから戻り値の受け取り</h2>

<p>FaceFindSimilar.csファイルのFaceFindSimilarクラス内部を以下のように記述します。</p>

<div class="code-frame" data-lang="c#">
<div class="code-lang"><span class="bold">FaceFindSimilar.cs</span></div>
<div class="highlight"><pre><code>    <span class="k">class</span> <span class="nc">FaceFindSimilar</span>
    <span class="p">{</span>
        <span class="k">const</span> <span class="kt">string</span> <span class="n">URL_BASE</span> <span class="p">=</span> <span class="s">"ローカル画像ファイルのパス（比較元）"</span><span class="p">;</span>
        <span class="k">const</span> <span class="kt">string</span> <span class="n">URL_TARGET</span> <span class="p">=</span> <span class="s">"ローカル画像ファイルのパス（比較先）"</span><span class="p">;</span>
        <span class="k">const</span> <span class="kt">string</span> <span class="n">DIVISION_BASE</span> <span class="p">=</span> <span class="s">"base"</span><span class="p">;</span> <span class="c1">// 区分：比較元</span>
        <span class="k">const</span> <span class="kt">string</span> <span class="n">DIVISION_TARGET</span> <span class="p">=</span> <span class="s">"target"</span><span class="p">;</span> <span class="c1">// 区分：比較先</span>

        <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;</span> <span class="n">imageUrls</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;();</span>
            <span class="n">imageUrls</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">DIVISION_BASE</span><span class="p">,</span> <span class="n">URL_BASE</span><span class="p">);</span>
            <span class="n">imageUrls</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">DIVISION_TARGET</span><span class="p">,</span> <span class="n">URL_TARGET</span><span class="p">);</span>

            <span class="c1">// Face DetectからfaceIdその他を取得</span>
            <span class="n">List</span><span class="p">&lt;</span><span class="n">FaceInfo</span><span class="p">&gt;</span> <span class="n">faceInfoList</span> <span class="p">=</span> <span class="n">FaceDetect</span><span class="p">.</span><span class="nf">Detect</span><span class="p">(</span><span class="n">imageUrls</span><span class="p">);</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">faceInfoList</span><span class="p">.</span><span class="nf">Exists</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">faceDivision</span> <span class="p">==</span> <span class="n">DIVISION_BASE</span><span class="p">)</span>
                <span class="p">&amp;&amp;</span> <span class="n">faceInfoList</span><span class="p">.</span><span class="nf">Exists</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">faceDivision</span> <span class="p">==</span> <span class="n">DIVISION_TARGET</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"顔が検出できました。:"</span><span class="p">);</span>

                <span class="k">foreach</span> <span class="p">(</span><span class="n">FaceInfo</span> <span class="n">faceInfo</span> <span class="k">in</span> <span class="n">faceInfoList</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"faceDivision: "</span> <span class="p">+</span> <span class="n">faceInfo</span><span class="p">.</span><span class="n">faceDivision</span> <span class="p">+</span> <span class="s">" , sourceUrl: "</span> <span class="p">+</span> <span class="n">faceInfo</span><span class="p">.</span><span class="n">sourceUrl</span>
                        <span class="p">+</span><span class="n">Environment</span><span class="p">.</span><span class="n">NewLine</span> <span class="p">+</span> <span class="s">"faceId: "</span> <span class="p">+</span> <span class="n">faceInfo</span><span class="p">.</span><span class="n">faceId</span>
                        <span class="p">+</span><span class="n">Environment</span><span class="p">.</span><span class="n">NewLine</span> <span class="p">+</span> <span class="s">"Rectangle: {"</span> <span class="p">+</span> <span class="n">faceInfo</span><span class="p">.</span><span class="n">recLeft</span> <span class="p">+</span> <span class="s">", "</span> <span class="p">+</span> <span class="n">faceInfo</span><span class="p">.</span><span class="n">recTop</span> <span class="p">+</span> <span class="s">", "</span> <span class="p">+</span> <span class="n">faceInfo</span><span class="p">.</span><span class="n">recWidth</span> <span class="p">+</span> <span class="s">", "</span> <span class="p">+</span> <span class="n">faceInfo</span><span class="p">.</span><span class="n">recHeight</span> <span class="p">+</span> <span class="s">"}"</span>
                        <span class="p">+</span><span class="n">Environment</span><span class="p">.</span><span class="n">NewLine</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"顔が検出できませんでした。"</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="n">Console</span><span class="p">.</span><span class="nf">ReadLine</span><span class="p">();</span>

        <span class="p">}</span>
    <span class="p">}</span>

</code></pre></div>
</div>

<p>定数<code>URL_BASE</code>と<code>URL_TARGET</code>に対してローカル画像のパス（今回は冒頭の画像を指定しています）を指定して実行すると、以下のような値が取れるかと思います。</p>

<div class="code-frame" data-lang="console"><div class="highlight"><pre><code><span class="go">顔が検出できました。:
faceDivision: base , sourceUrl: 比較元画像のファイルパス
faceId: 206b61c0-6539-4ad8-bf01-2fd8c18537c1
Rectangle: {874, 241, 210, 210}

faceDivision: target , sourceUrl: 比較先画像のファイルパス
faceId: 68b07497-0502-41e9-9af1-290348848b1e
Rectangle: {765, 260, 148, 148}

faceDivision: target , sourceUrl: 比較先画像のファイルパス
faceId: 2df5c831-f10c-475e-a6c8-734a3cc8c04e
Rectangle: {545, 347, 124, 124}
</span></code></pre></div></div>

<p>Face Detectを使用して、その戻り値を取得できました。<br>
次回②で、本題のFace FindSimilarを使用して類似度の判定を行いたいと思います。</p>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Fkoob%2Fitems%2Fb649e463842b1c16f297&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Fkoob%2Fitems%2Fb649e463842b1c16f297&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/koob/items/b649e463842b1c16f297/likers" class="css-1iupg5d">4</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">6</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/b649e463842b1c16f297/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/koob/items/b649e463842b1c16f297/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/koob/items/b649e463842b1c16f297/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/koob/items/b649e463842b1c16f297/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/koob/items/b649e463842b1c16f297.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-ac031b78-55cb-4fd9-ad71-e75aaf4624a3">{"authorAnalyticsTrackingId":null,"organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-0b2aa98a-7199-4391-a888-514a0b4ff67f"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-0b2aa98a-7199-4391-a888-514a0b4ff67f">{}</script>
      
<div id="LoginModal-react-component-3c297212-954d-4483-a75f-4a7c6e5c9dce"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-3c297212-954d-4483-a75f-4a7c6e5c9dce">{}</script>
      
<div id="StockModal-react-component-1d53a2d3-c05d-4938-a7f7-409b91220688"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-1d53a2d3-c05d-4938-a7f7-409b91220688">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;MCUnragQ8uvKBcl7TwPs1b/KYumQ1vqrobgT7dWnTPydwFwa+3ms17rsjC49ty4MdkqIUe2V+gk2FYL4qdxb7Q==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\n\u003ch1\u003e\n\u003cspan id=\"作るもの\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BD%9C%E3%82%8B%E3%82%82%E3%81%AE\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e作るもの\u003c/h1\u003e\n\n\u003cp\u003e比較元の画像（base）に写っている人が、比較先の画像（target）に写っている人とどれだけ似ているかを表示してくれるコンソールアプリ。\u003c/p\u003e\n\n\u003cp\u003e書いてる内に妙に長くなってしまったので、①ではそれぞれの画像の顔の検出までを実装していきます。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"完成版の実行結果\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%8C%E6%88%90%E7%89%88%E3%81%AE%E5%AE%9F%E8%A1%8C%E7%B5%90%E6%9E%9C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e完成版の実行結果\u003c/h1\u003e\n\n\u003cp\u003e以下の画像を使用して、比較元画像の男性に対する、比較先画像の男女の類似度を判定させます。\u003c/p\u003e\n\n\u003cp\u003e↓比較元画像↓\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/e06d01df8c259cb792562b7c45b8ec4a2992ebf0/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3430333036302f63313838613035652d366238612d653633302d386364332d6164323165393664643139362e6a706567\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F403060%2Fc188a05e-6b8a-e630-8cd3-ad21e96dd196.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=9ee0993a8363c4a88871bab340e5dcf7\" alt=\"test1.jpg\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/403060/c188a05e-6b8a-e630-8cd3-ad21e96dd196.jpeg\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F403060%2Fc188a05e-6b8a-e630-8cd3-ad21e96dd196.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=28b3d3fbabbe62a42ffe3b0fddfc39f4 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e↓比較先画像↓\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/29bf9428bca78fba48d0d7457c1f20a4ec43e8ea/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3430333036302f64366361663934312d353665362d623266362d353937372d3930616162653830393162342e6a706567\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F403060%2Fd6caf941-56e6-b2f6-5977-90aabe8091b4.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=7cd67e9a112d6862391848802766c056\" alt=\"test3.jpg\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/403060/d6caf941-56e6-b2f6-5977-90aabe8091b4.jpeg\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F403060%2Fd6caf941-56e6-b2f6-5977-90aabe8091b4.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=3d8fcd673ac0c6f3e7762117f53210dc 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eアプリを実行すると、以下のように検出箇所と割り振られたFaceIDを確認できます。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/3059887be9a084f77d2f3c7438feeaf1cea544c4/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3430333036302f34613664653637352d356633382d653533652d663465632d3838353331663130343731622e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg width=\"521\" alt=\"キャプチャ.PNG\" src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F403060%2F4a6de675-5f38-e53e-f4ec-88531f10471b.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=4f8b3de94e14f8246f4ac7e39b53ab41\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/403060/4a6de675-5f38-e53e-f4ec-88531f10471b.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F403060%2F4a6de675-5f38-e53e-f4ec-88531f10471b.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=5ceda15d4e877ef32340807652e5d815 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/326aaacad261a23ceb69a6afca4f6a3888aca063/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3430333036302f38653732393864302d376639632d613332342d366333382d6439333364373532613962612e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg width=\"690\" alt=\"キャプチャ2.PNG\" src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F403060%2F8e7298d0-7f9c-a324-6c38-d933d752a9ba.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=8aab7d604dc371360950e6fa904fd124\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/403060/8e7298d0-7f9c-a324-6c38-d933d752a9ba.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F403060%2F8e7298d0-7f9c-a324-6c38-d933d752a9ba.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=6121325daafdcf581fde5d42729e9160 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eまた、比較元画像のFaceIDとの類似度をコンソール上で表示します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"console\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"go\"\u003e■FaceID：[0c8be41b-6d64-4a46-afcd-e4d70b78da12] との類似度判定\n　7b05c4b3-4ffd-49aa-b0f2-14ca87dccff1 : 54.08％\n　560bc9a3-6e68-442d-bc39-fcd2f21a32b1 : 8.98％\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこの場合、ちゃんと男性との類似度が高めに、女性との類似度が低めになっていますね。\u003cbr\u003e\n（高めにとは言ってもそんなに数値高くないですが…）\u003c/p\u003e\n\n\u003cp\u003eこれは完全に体感ですが、48％（APIからの戻り値が0.48）以上あれば、同一人物と判断してもよさそうです。\u003cbr\u003e\nちなみに、もし比較元画像から2人以上の顔が検出されれば、それぞれとの類似度が表示されることになります。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"環境使ったもの\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%92%B0%E5%A2%83%E4%BD%BF%E3%81%A3%E3%81%9F%E3%82%82%E3%81%AE\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e環境、使ったもの\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003eWindows10\u003c/li\u003e\n\u003cli\u003eC# 7.0\u003c/li\u003e\n\u003cli\u003e.NET Framework 4.7.2\u003c/li\u003e\n\u003cli\u003eVisual Studio 2017 Community\n※2019と行ったり来たりしてたけど\u003c/li\u003e\n\u003cli\u003eMicrosoft Face API\u003c/li\u003e\n\u003cli\u003eOpenCVSharp 3\u003c/li\u003e\n\u003cli\u003eJson.NET 12.0.2\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"face-findsimilarについて\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#face-findsimilar%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eFace FindSimilarについて\u003c/h1\u003e\n\n\u003cp\u003e今回はCognitive ServicesのFace APIから、Face FindSimilarという機能をアプリのメインとします。\u003cbr\u003e\nCognitive Servicesは、Microsoft Azureの提供するAIや機械学習に関するサービス群のことです。\u003cbr\u003e\nFace FindSimilarは比較元となるFaceID（検出した顔情報に一意に割り振られるID）と、比較先となるFaceIDの配列や事前に作成した顔グループを渡すことで、比較先の顔が比較元とどれだけ似ているのかを返してくれる機能です。\u003c/p\u003e\n\n\u003cp\u003eちなみにFaceIDを取得するにはFace Detect機能を使用する必要があるので、そちらも同時に実装していきます。\u003cbr\u003e\nというか①ではそっちの実装がメインになります…\u003c/p\u003e\n\n\u003cp\u003e※Face Detect機能のみの単純な実装は、前回の\u003ca href=\"https://qiita.com/koob/items/f6ccb764715040ddf699\" id=\"reference-4ad697cd3089c7547dcc\"\u003e【10分でできる】AzureのFace APIを使って画像から顔を検出する\u003c/a\u003eで紹介しています。\u003cbr\u003e\nとりあえずFace APIを使ってみたいという方や、画像に写っている人の性別、年齢、特徴、感情などが検出できればいいという方はそちらを参照されることをお勧めします。\u003cbr\u003e\n今回は画像の加工などもあるため、さすがに10分でとはいきませんでした( ;∀;)\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"face-apiへpostする際の各パラメータなど\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#face-api%E3%81%B8post%E3%81%99%E3%82%8B%E9%9A%9B%E3%81%AE%E5%90%84%E3%83%91%E3%83%A9%E3%83%A1%E3%83%BC%E3%82%BF%E3%81%AA%E3%81%A9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eFace APIへPOSTする際の各パラメータなど\u003c/h4\u003e\n\n\u003cp\u003e\u003cstrong\u003eFace Detect\u003c/strong\u003e\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eリクエストヘッダ：\n\n\u003cul\u003e\n\u003cli\u003eContent-Type：\u003ccode\u003e\"application/octet-stream\"\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003eOcp-Apim-Subscription-Key：Face APIキー\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eリクエストボディ：\n\n\u003cul\u003e\n\u003cli\u003eurl：画像のバイナリデータ\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003ePOST先のURL：\u003ccode\u003eエンドポイント + \"/detect\" + \"?returnFaceId=true\u0026amp;returnFaceLandmarks=false\"\u003c/code\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e\u003cstrong\u003eFace FindSimilar\u003c/strong\u003e\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eリクエストヘッダ：\n\n\u003cul\u003e\n\u003cli\u003eContent-Type：\u003ccode\u003e\"application/json\"\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003eOcp-Apim-Subscription-Key：Face APIキー\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eリクエストボディ：\n\n\u003cul\u003e\n\u003cli\u003efaceId：Face Detectで取得する一意のID。取得後24時間で期限切れとなります。\u003c/li\u003e\n\u003cli\u003efaceListId：ユーザー指定の一意の候補顔リスト。（今回は未使用）\u003c/li\u003e\n\u003cli\u003eLargefaceListId：ユーザー指定の一意の候補顔リスト。（今回は未使用）\u003c/li\u003e\n\u003cli\u003efaceIds：Face Detectで取得する一意のIDの配列。\u003c/li\u003e\n\u003cli\u003emaxNumOfCandidatesReturned（オプション）：比較先となるfaceIdの内、上位何番目までの顔情報を返すか（デフォルトは20）\u003c/li\u003e\n\u003cli\u003emode（オプション）：判定方法。\u003ccode\u003e\"matchPerson\"\u003c/code\u003eまたは\u003ccode\u003e\"matchFace\"\u003c/code\u003eを指定。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003ePOST先のURL：\u003ccode\u003eエンドポイント + \"/findsimilars\"\u003c/code\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e参考：\u003cbr\u003e\n\u003ca href=\"https://westus.dev.cognitive.microsoft.com/docs/services/563879b61984550e40cbbe8d/operations/563879b61984550f30395236\" rel=\"nofollow noopener\" target=\"_blank\"\u003eFace Detect APIリファレンス\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://westus.dev.cognitive.microsoft.com/docs/services/563879b61984550e40cbbe8d/operations/563879b61984550f30395237\" rel=\"nofollow noopener\" target=\"_blank\"\u003eFace FindSimilar APIリファレンス\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"作成手順\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BD%9C%E6%88%90%E6%89%8B%E9%A0%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e作成手順\u003c/h1\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"だいたいこんな感じ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%A0%E3%81%84%E3%81%9F%E3%81%84%E3%81%93%E3%82%93%E3%81%AA%E6%84%9F%E3%81%98\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eだいたいこんな感じ\u003c/h4\u003e\n\n\u003col\u003e\n\u003cli\u003e（準備）\u003c/li\u003e\n\u003cli\u003eFace Detectから顔情報を取得\u003c/li\u003e\n\u003cli\u003eFace Detectから戻り値の受け取り\u003c/li\u003e\n\u003cli\u003eOpenCVSharpで検出箇所を画像に描画\u003c/li\u003e\n\u003cli\u003eFace FindSimilarで類似度の判定\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003e以下、この手順で実装を進めていきます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"1-準備\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#1-%E6%BA%96%E5%82%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e1. 準備\u003c/h2\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"コンソールアプリを新規作成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B3%E3%83%B3%E3%82%BD%E3%83%BC%E3%83%AB%E3%82%A2%E3%83%97%E3%83%AA%E3%82%92%E6%96%B0%E8%A6%8F%E4%BD%9C%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eコンソールアプリを新規作成\u003c/h4\u003e\n\n\u003cp\u003e作りましょう。\u003cbr\u003e\n名前はとりあえず「FindSimilar」とします。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/1574c6930261efde761b41ad4ca352d9475afd07/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3430333036302f35383632313163372d346263382d643335642d373333382d3564383436323466643331652e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg width=\"708\" alt=\"キャプチャ1.PNG\" src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F403060%2F586211c7-4bc8-d35d-7338-5d84624fd31e.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=d71264ac397768add5d1641aaf9f2113\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/403060/586211c7-4bc8-d35d-7338-5d84624fd31e.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F403060%2F586211c7-4bc8-d35d-7338-5d84624fd31e.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=362bfb35129436f5c03772c4e39a4e8c 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/460c47fee5c9f9a37677e96e0a8c3e85498dc02d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3430333036302f31336364303534372d616466362d663161392d346465362d3530636239623731333033392e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg width=\"917\" alt=\"キャプチャ2.PNG\" src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F403060%2F13cd0547-adf6-f1a9-4de6-50cb9b713039.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=79c4371b900c3186a105f84c72951a2e\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/403060/13cd0547-adf6-f1a9-4de6-50cb9b713039.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F403060%2F13cd0547-adf6-f1a9-4de6-50cb9b713039.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=be9841df89602505fc73f892f000ab7a 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eついでに「Program.cs」ファイルの名前も変えちゃいます。\u003cbr\u003e\nソリューションエクスプローラー上で「Program.cs」のファイル名を「FaceFindSimilar.cs」と変更すると、class名も「Program」から「FaceFindSimilar」となったかと思います。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/a284f5f69b865f97df90eaf85f9c2fa74c19dc30/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3430333036302f65323337616265302d393466362d343930652d613836612d6161373463343261333233312e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg width=\"917\" alt=\"キャプチャ3.PNG\" src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F403060%2Fe237abe0-94f6-490e-a86a-aa74c42a3231.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=0d054f0deed29dcd76d2b8d01fce6f8c\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/403060/e237abe0-94f6-490e-a86a-aa74c42a3231.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F403060%2Fe237abe0-94f6-490e-a86a-aa74c42a3231.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=2b84cbcab132a9e26580480d02040a86 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"設定ファイルの記述\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E8%A8%98%E8%BF%B0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e設定ファイルの記述\u003c/h4\u003e\n\n\u003cp\u003eAPIキーと、APIにアクセスする為のエンドポイントをApp.configに持たせます。\u003cbr\u003e\n\u003ccode\u003eappSettings\u003c/code\u003eタグとその中身が追加した部分です。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"config\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eApp.config\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u0026lt;?\u003cspan class=\"n\"\u003exml\u003c/span\u003e \u003cspan class=\"n\"\u003eversion\u003c/span\u003e=\u003cspan class=\"s2\"\u003e\"1.0\"\u003c/span\u003e \u003cspan class=\"n\"\u003eencoding\u003c/span\u003e=\u003cspan class=\"s2\"\u003e\"utf-8\"\u003c/span\u003e ?\u0026gt;\n\u0026lt;\u003cspan class=\"n\"\u003econfiguration\u003c/span\u003e\u0026gt;\n    \u0026lt;\u003cspan class=\"n\"\u003estartup\u003c/span\u003e\u0026gt; \n        \u0026lt;\u003cspan class=\"n\"\u003esupportedRuntime\u003c/span\u003e \u003cspan class=\"n\"\u003eversion\u003c/span\u003e=\u003cspan class=\"s2\"\u003e\"v4.0\"\u003c/span\u003e \u003cspan class=\"n\"\u003esku\u003c/span\u003e=\u003cspan class=\"s2\"\u003e\".NETFramework,Version=v4.7.2\"\u003c/span\u003e /\u0026gt;\n    \u0026lt;/\u003cspan class=\"n\"\u003estartup\u003c/span\u003e\u0026gt;\n    \u0026lt;\u003cspan class=\"n\"\u003eappSettings\u003c/span\u003e\u0026gt;\n      \u0026lt;\u003cspan class=\"n\"\u003eadd\u003c/span\u003e \u003cspan class=\"n\"\u003ekey\u003c/span\u003e=\u003cspan class=\"s2\"\u003e\"subscriptionKey\"\u003c/span\u003e \u003cspan class=\"n\"\u003evalue\u003c/span\u003e=\u003cspan class=\"s2\"\u003e\"Your API Key\"\u003c/span\u003e /\u0026gt;\n      \u0026lt;\u003cspan class=\"n\"\u003eadd\u003c/span\u003e \u003cspan class=\"n\"\u003ekey\u003c/span\u003e=\u003cspan class=\"s2\"\u003e\"requestUrl\"\u003c/span\u003e \u003cspan class=\"n\"\u003evalue\u003c/span\u003e=\u003cspan class=\"s2\"\u003e\"https://westcentralus.api.cognitive.microsoft.com/face/v1.0/\"\u003c/span\u003e /\u0026gt;\n    \u0026lt;/\u003cspan class=\"n\"\u003eappSettings\u003c/span\u003e\u0026gt;\n\u0026lt;/\u003cspan class=\"n\"\u003econfiguration\u003c/span\u003e\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003e\"subscriptionKey\"\u003c/code\u003eのvalueにAPIキーを、\u003ccode\u003e\"requestUrl\"\u003c/code\u003eのvalueにFace APIキー取得時に表示されたエンドポイントを記載してください。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"2-face-detectから顔情報を取得\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#2-face-detect%E3%81%8B%E3%82%89%E9%A1%94%E6%83%85%E5%A0%B1%E3%82%92%E5%8F%96%E5%BE%97\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2. Face Detectから顔情報を取得\u003c/h2\u003e\n\n\u003cp\u003eOpenCVSharp、Face FindSimilarを使う上で必要な情報を、Face Detectから取得しましょう。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"facedetectcsファイルの作成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#facedetectcs%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E4%BD%9C%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eFaceDetect.csファイルの作成\u003c/h4\u003e\n\n\u003cp\u003eすべての処理をFaceFindSimilar.csファイルに書くと読みにくいので、FaceDetect.csファイルを作成し、Face Detect機能による顔の検出処理はすべてそこに記述することにします。\u003c/p\u003e\n\n\u003cp\u003e「Ctrl」＋「Shift」＋「A」で「新しい項目の追加」ウィンドウを開きましょう。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/b6bda384ad583195170d5b5d733a522ccbd729d7/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3430333036302f37356438656662382d663135352d623266662d623962312d6561633231666331636365622e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg width=\"707\" alt=\"キャプチャ4.PNG\" src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F403060%2F75d8efb8-f155-b2ff-b9b1-eac21fc1cceb.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=fc5ecebd15efd280566cedcd92732214\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/403060/75d8efb8-f155-b2ff-b9b1-eac21fc1cceb.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F403060%2F75d8efb8-f155-b2ff-b9b1-eac21fc1cceb.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=6dd85643b88783fd68207fe83a04176b 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n「クラス」を選択し、名前は「FaceDetect.cs」とします。\u003cbr\u003e\n作成できたら、以下のようになると思います。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/67cd50a94a6cebf36b27d1a30b1829db1d1a00ab/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3430333036302f63626163336430622d623561662d636433342d343138342d6264323062323032373861362e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg width=\"917\" alt=\"キャプチャ5.PNG\" src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F403060%2Fcbac3d0b-b5af-cd34-4184-bd20b20278a6.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=ad501412c54149037cde9991461f6073\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/403060/cbac3d0b-b5af-cd34-4184-bd20b20278a6.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F403060%2Fcbac3d0b-b5af-cd34-4184-bd20b20278a6.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=a1606b35e28b541cbaef0d7df10b95f4 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"戻り値はなにか\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%88%BB%E3%82%8A%E5%80%A4%E3%81%AF%E3%81%AA%E3%81%AB%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e戻り値はなにか\u003c/h4\u003e\n\n\u003cp\u003eメインメソッドからFaceDetectクラスのメソッド（Detectメソッドとします）を呼び出して、検出した顔のIDやOpenCVSharpで枠を描画する為の座標を取得するわけですが、まずはその時Detectメソッドに渡す引数と、Detectメソッドから欲しい情報を整理してみます。\u003c/p\u003e\n\n\u003ch5\u003e\n\u003cspan id=\"引数\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%BC%95%E6%95%B0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e引数\u003c/h5\u003e\n\n\u003cp\u003eFace DetectはAPIに対してURLだけ渡せばいいので、比較元画像のURLと比較先画像のURLを渡してあげようと思います。\u003cbr\u003e\nただし、URLをただの文字列や配列として渡すと比較元と比較先の区別がつかなくなるので、今回はdictionary型にして以下のように渡したいと思います。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eKey:　\"base\" (string)　Value: \"比較元URL\" (string)\u003c/li\u003e\n\u003cli\u003eKey:　\"target\" (string)　Value: \"比較先URL\" (string)\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch5\u003e\n\u003cspan id=\"戻り値\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%88%BB%E3%82%8A%E5%80%A4\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e戻り値\u003c/h5\u003e\n\n\u003cp\u003e顔情報の検出後、FaceFindSimilarクラス側で必要な情報は以下になります。\u003cbr\u003e\n検出箇所の座標は、OpenCVSharpで検出箇所を描画する為に必要になります。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e取得元： \"base\" or \"target\" (string)\u003c/li\u003e\n\u003cli\u003e取得元URL： \"比較元URL\" or \"比較先URL\" (string)\u003c/li\u003e\n\u003cli\u003e検出した顔のID (string)\u003c/li\u003e\n\u003cli\u003e検出箇所の座標（x軸） (int)\u003c/li\u003e\n\u003cli\u003e検出箇所の座標（y軸） (int)\u003c/li\u003e\n\u003cli\u003e検出箇所の座標（左上からの幅） (int)\u003c/li\u003e\n\u003cli\u003e検出箇所の座標（左上からの高さ） (int)\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e戻り値が多いので、今回は上記を含む「FaceInfo」クラス型を作成し、そのリストを返してあげることにしました。\u003cbr\u003e\n\u003ccode\u003enamespace FaceFindSimilar\u003c/code\u003eの中に、以下のようにクラスとプロパティを追加します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eFaceDetect.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Collections.Generic\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Linq\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Text\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Threading.Tasks\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eFindSimilar\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eFaceInfo\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 取得元： \"base\" or \"target\" (string)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003efaceDivision\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// 取得元URL： \"比較元URL\" or \"比較先URL\" (string)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003esourceUrl\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// 検出した顔のID (string)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003efaceId\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// 検出箇所の座標（x軸） (int)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003erecLeft\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// 検出箇所の座標（y軸） (int)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003erecTop\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// 検出箇所の座標（左上からの幅） (int)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003erecWidth\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// 検出箇所の座標（左上からの高さ） (int)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003erecHeight\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eFaceDetect\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"detectメソッドの実装\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#detect%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%AE%E5%AE%9F%E8%A3%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eDetectメソッドの実装\u003c/h4\u003e\n\n\u003cp\u003e次に、実際にFindSimilarメソッドから呼び出されるDetectメソッドを、FaceDetectクラスの中に記述していきます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eFaceDetect.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e    \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eFaceDetect\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eFaceInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eDetect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDictionary\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eimageUrls\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eFaceInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003efaceInfoList\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eFaceInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n\n            \u003cspan class=\"k\"\u003etry\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e//faceInfoList = ImageAnalysisRequest(imageUrls).Result;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ecatch\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eException\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"例外：\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003efaceInfoList\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eDetectメソッドは戻り値となる顔情報を返すだけです。\u003cbr\u003e\n実際にFace API Detectから顔情報を取得してくる処理は、Try~Catchの中で現在コメントアウトされているImageAnalysisRequestメソッドで行います。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"imageanalysisrequestメソッド--α-の実装\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#imageanalysisrequest%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89--%CE%B1-%E3%81%AE%E5%AE%9F%E8%A3%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eImageAnalysisRequestメソッド ＋ α の実装\u003c/h4\u003e\n\n\u003cp\u003eFaceDetectクラスの中に、Face API Detectの呼び出し処理を追加します。\u003cbr\u003e\nまた、APIに渡す画像はバイナリデータにする為、そのためのGetImageAsByteArrayメソッドも追加しています。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eFaceDetect.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e        \u003cspan class=\"c1\"\u003e// Face API Detectを使用して画像分析を行う\u003c/span\u003e\n        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eFaceInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eImageAnalysisRequest\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDictionary\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eimageUrls\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eFaceInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003efaceInfoList\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eFaceInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eHttpClient\u003c/span\u003e \u003cspan class=\"n\"\u003eclient\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eHttpClient\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// リクエストヘッダー\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eclient\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDefaultRequestHeaders\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Ocp-Apim-Subscription-Key\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eConfigurationManager\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAppSettings\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"subscriptionKey\"\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// リクエストパラメータ\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003erequestParameters\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"returnFaceId=true\u0026amp;returnFaceLandmarks=false\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n            \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003euri\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eConfigurationManager\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAppSettings\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"requestUrl\"\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\"detect\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\"?\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003erequestParameters\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// 画像ファイルを一枚ずつ処理する\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eKeyValuePair\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eitem\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003eimageUrls\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003econtentString\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEmpty\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n                \u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003ebyteData\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetImageAsByteArray\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n                \u003cspan class=\"c1\"\u003e// 画像から顔を検出\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eByteArrayContent\u003c/span\u003e \u003cspan class=\"n\"\u003econtent\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eByteArrayContent\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebyteData\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"c1\"\u003e// リクエストヘッダーの作成\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003econtent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eHeaders\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eContentType\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMediaTypeHeaderValue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"application/octet-stream\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n                    \u003cspan class=\"c1\"\u003e// Face APIの呼び出し\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003eHttpResponseMessage\u003c/span\u003e \u003cspan class=\"n\"\u003eresponse\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eclient\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ePostAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003euri\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003econtent\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n                    \u003cspan class=\"c1\"\u003e// 実行結果からJSONの取得\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003econtentString\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eresponse\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eContent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReadAsStringAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003efaceInfoList\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// 画像をバイナリデータに変換\u003c/span\u003e\n        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetImageAsByteArray\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eimageFilePath\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eFileStream\u003c/span\u003e \u003cspan class=\"n\"\u003efileStream\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e\n                \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eFileStream\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eimageFilePath\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eFileMode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eOpen\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eFileAccess\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRead\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eBinaryReader\u003c/span\u003e \u003cspan class=\"n\"\u003ebinaryReader\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eBinaryReader\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efileStream\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003ebinaryReader\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReadBytes\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003efileStream\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eこれだけだと色々参照エラーが出ると思うので、参照に以下\u003ccode\u003eSystem.Configuration\u003c/code\u003eを追加して、\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/3a73e4da87467c5469c80174c5c900e21cf705a7/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3430333036302f62323531643534632d333132302d646137372d346562362d6364343630643630316334622e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg width=\"591\" alt=\"キャプチャ3.PNG\" src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F403060%2Fb251d54c-3120-da77-4eb6-cd460d601c4b.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=999a181b916ccc616d39a45c81f7c8e9\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/403060/b251d54c-3120-da77-4eb6-cd460d601c4b.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F403060%2Fb251d54c-3120-da77-4eb6-cd460d601c4b.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=640f0df42fef2720a18e97b1b981bb79 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n以下のusingも追加します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.IO\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Net.Http\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Net.Http.Headers\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Configuration\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e何をやっているかというと、引数として受け取った画像ファイルのdictionaryを一つずつ取り出して、Face API Detectに渡したその実行結果、つまりFaceIDや検出箇所の座標を取得しています。\u003cbr\u003e\nリクエストパラメータにもっと色々指定することで、検出した顔の推定年齢、感情や髪色その他までわかるのですが、今回は必要ないので必要最低限\u003ccode\u003e\"returnFaceId=true\u0026amp;returnFaceLandmarks=false\"\u003c/code\u003eだけ指定しています。\u003c/p\u003e\n\n\u003cp\u003eこの時点ではまだアプリケーションを実行できませんが、もし比較先画像のファイルパスが\u003ccode\u003eitem.Value\u003c/code\u003eに入っていた場合、以下のようなJSON文字列が\u003ccode\u003econtentString\u003c/code\u003eから取得できるはずです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"json\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"faceId\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"46086930-6e5b-4c54-956b-1d72de419266\"\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"nl\"\u003e\"faceRectangle\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:{\u003c/span\u003e\u003cspan class=\"nl\"\u003e\"top\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"mi\"\u003e260\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"nl\"\u003e\"left\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"mi\"\u003e765\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"nl\"\u003e\"width\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"mi\"\u003e148\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"nl\"\u003e\"height\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"mi\"\u003e148\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"p\"\u003e,{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"faceId\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"f8410c80-b7ff-4d05-bd1f-75a7f3cb2cc8\"\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"nl\"\u003e\"faceRectangle\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:{\u003c/span\u003e\u003cspan class=\"nl\"\u003e\"top\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"mi\"\u003e347\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"nl\"\u003e\"left\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"mi\"\u003e545\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"nl\"\u003e\"width\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"mi\"\u003e124\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"nl\"\u003e\"height\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"mi\"\u003e124\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003efaceId\u003c/code\u003eが、検出できた顔に割り振られた一意のID。\u003cbr\u003e\n\u003ccode\u003efaceRectangle\u003c/code\u003eの配列が、検出された位置の座標です。\u003cbr\u003e\nこの時点では2人分の顔が検出され、配列として返ってきています。\u003c/p\u003e\n\n\u003cp\u003e今はただのJSONなので、今度はこれを戻り値の型である独自クラス\u003ccode\u003eFaceInfo\u003c/code\u003e型のListに整形する必用があります。\u003cbr\u003e\n整形するにあたってはJSONをstring型の配列として扱いたいので、ここではJSONをC#で扱う為のライブラリ\u003cstrong\u003e「Json.NET」\u003c/strong\u003eを使って整形したいと思います。\u003c/p\u003e\n\n\u003cp\u003eまず、Json.NETをNuGetから取得しましょう。\u003cbr\u003e\nVisualStudioの「プロジェクト」メニューから「NuGetパッケージの管理」を選択します。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/a5a10e6ceaeb84aadd19bd58485149961844ce67/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3430333036302f34373161303438632d323036382d323632642d356363662d3565663734393531626135362e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg width=\"704\" alt=\"キャプチャ4.PNG\" src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F403060%2F471a048c-2068-262d-5ccf-5ef74951ba56.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=bc87f23fc83aa40885deb745ac3c456c\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/403060/471a048c-2068-262d-5ccf-5ef74951ba56.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F403060%2F471a048c-2068-262d-5ccf-5ef74951ba56.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=684008c179d1e03c6a260c3a39878773 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\nNuGetの管理画面が開くので、「参照」を選択し、検索窓に「Newtonsoft.Json」と入力。ロケットのアイコンのライブラリが表示されるので選択して、インストールボタンをクリックします。\u003cbr\u003e\n現時点でのバージョンは12.0.2でした。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/7a0de25f2b8e21119273b8fd882f8885f716fea9/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3430333036302f64326164373862382d653865612d333030362d613934642d3633323361363361343533662e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg width=\"723\" alt=\"キャプチャ5.PNG\" src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F403060%2Fd2ad78b8-e8ea-3006-a94d-6323a63a453f.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=2f8fc054f6bea40771a71e724851c2a2\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/403060/d2ad78b8-e8ea-3006-a94d-6323a63a453f.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F403060%2Fd2ad78b8-e8ea-3006-a94d-6323a63a453f.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=77b32305f0f89c123d9c436c5565da06 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\nインストールが正常に完了すれば、ソリューションエクスプローラーの参照先に「Newtonsoft.Json」が追加されているはずです。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/a0c4ad3e969efd1abf467ca6b8735ab324ce4b1e/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3430333036302f34633932386139642d346432322d313334392d303031372d6437643562623963333163322e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg width=\"191\" alt=\"キャプチャ6.PNG\" src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F403060%2F4c928a9d-4d22-1349-0017-d7d5bb9c31c2.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=3117981e8ceeed1124fdbabcd55d2716\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/403060/4c928a9d-4d22-1349-0017-d7d5bb9c31c2.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F403060%2F4c928a9d-4d22-1349-0017-d7d5bb9c31c2.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=f53ae48c52053f74686f53a3118e3701 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n無事参照追加できていたら、FaceDetect.csファイルに処理を追加します。\u003cbr\u003e\n「追加箇所 From(～To)」となっている箇所が新たに追記した部分です。\u003cbr\u003e\n※このファイルの修正はここまでなので、全文を載せます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eFaceDetect.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Collections.Generic\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Linq\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Text\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Threading.Tasks\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.IO\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Net.Http\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Net.Http.Headers\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Configuration\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 追加箇所 From-----------------------------------------------------------------\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eNewtonsoft.Json.Linq\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 追加箇所 To-------------------------------------------------------------------\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eFindSimilar\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eFaceInfo\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 取得元： \"base\" or \"target\" (string)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003efaceDivision\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// 取得元URL： \"比較元URL\" or \"比較先URL\" (string)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003esourceUrl\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// 検出した顔のID (string)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003efaceId\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// 検出箇所の座標（x軸） (int)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003erecLeft\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// 検出箇所の座標（y軸） (int)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003erecTop\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// 検出箇所の座標（左上からの幅） (int)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003erecWidth\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// 検出箇所の座標（左上からの高さ） (int)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003erecHeight\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eFaceDetect\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eFaceInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eDetect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDictionary\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eimageUrls\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eFaceInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003efaceInfoList\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eFaceInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n\n            \u003cspan class=\"k\"\u003etry\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003efaceInfoList\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eImageAnalysisRequest\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eimageUrls\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003eResult\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ecatch\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eException\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"例外：\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003efaceInfoList\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// Face API Detectを使用して画像分析を行う\u003c/span\u003e\n        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eFaceInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eImageAnalysisRequest\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDictionary\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eimageUrls\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eFaceInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003efaceInfoList\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eFaceInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eHttpClient\u003c/span\u003e \u003cspan class=\"n\"\u003eclient\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eHttpClient\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// リクエストヘッダー\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eclient\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDefaultRequestHeaders\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Ocp-Apim-Subscription-Key\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eConfigurationManager\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAppSettings\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"subscriptionKey\"\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// リクエストパラメータ\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003erequestParameters\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"returnFaceId=true\u0026amp;returnFaceLandmarks=false\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n            \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003euri\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eConfigurationManager\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAppSettings\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"requestUrl\"\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\"detect\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\"?\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003erequestParameters\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// 画像ファイルを一枚ずつ処理する\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eKeyValuePair\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eitem\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003eimageUrls\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003econtentString\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEmpty\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n                \u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003ebyteData\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetImageAsByteArray\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n                \u003cspan class=\"c1\"\u003e// 画像から顔を検出\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eByteArrayContent\u003c/span\u003e \u003cspan class=\"n\"\u003econtent\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eByteArrayContent\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebyteData\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"c1\"\u003e// リクエストヘッダーの作成\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003econtent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eHeaders\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eContentType\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMediaTypeHeaderValue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"application/octet-stream\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n                    \u003cspan class=\"c1\"\u003e// Face APIの呼び出し\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003eHttpResponseMessage\u003c/span\u003e \u003cspan class=\"n\"\u003eresponse\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eclient\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ePostAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003euri\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003econtent\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n                    \u003cspan class=\"c1\"\u003e// 実行結果からJSONの取得\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003econtentString\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eresponse\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eContent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReadAsStringAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n                \u003cspan class=\"c1\"\u003e// 追加箇所 From-----------------------------------------------------------------\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// 戻り値となるリストへ顔情報を追加していく\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eJArray\u003c/span\u003e \u003cspan class=\"n\"\u003ejArray\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eJArray\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eParse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003econtentString\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eJObject\u003c/span\u003e \u003cspan class=\"n\"\u003ejObj\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003ejArray\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"c1\"\u003e// 顔情報をFaceInfoクラス型に整形する\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003eFaceInfo\u003c/span\u003e \u003cspan class=\"n\"\u003efaceInfo\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eCreateFaceInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ejObj\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n                    \u003cspan class=\"n\"\u003efaceInfoList\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efaceInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// 追加箇所 To-------------------------------------------------------------------\u003c/span\u003e\n\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003efaceInfoList\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// 追加箇所 From-----------------------------------------------------------------\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// FaceInfoクラス型のインスタンスを作成\u003c/span\u003e\n        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eFaceInfo\u003c/span\u003e \u003cspan class=\"nf\"\u003eCreateFaceInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eJObject\u003c/span\u003e \u003cspan class=\"n\"\u003ejObj\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eKeyValuePair\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ekeyValue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eJValue\u003c/span\u003e \u003cspan class=\"n\"\u003ejValFaceId\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eJValue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003ejObj\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"faceId\"\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eJValue\u003c/span\u003e \u003cspan class=\"n\"\u003ejValRectLeft\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eJValue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003ejObj\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"faceRectangle\"\u003c/span\u003e\u003cspan class=\"p\"\u003e][\u003c/span\u003e\u003cspan class=\"s\"\u003e\"left\"\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eJValue\u003c/span\u003e \u003cspan class=\"n\"\u003ejValRectTop\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eJValue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003ejObj\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"faceRectangle\"\u003c/span\u003e\u003cspan class=\"p\"\u003e][\u003c/span\u003e\u003cspan class=\"s\"\u003e\"top\"\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eJValue\u003c/span\u003e \u003cspan class=\"n\"\u003ejValRectWidth\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eJValue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003ejObj\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"faceRectangle\"\u003c/span\u003e\u003cspan class=\"p\"\u003e][\u003c/span\u003e\u003cspan class=\"s\"\u003e\"width\"\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eJValue\u003c/span\u003e \u003cspan class=\"n\"\u003ejValRectHeight\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eJValue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003ejObj\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"faceRectangle\"\u003c/span\u003e\u003cspan class=\"p\"\u003e][\u003c/span\u003e\u003cspan class=\"s\"\u003e\"height\"\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\n            \u003cspan class=\"n\"\u003eFaceInfo\u003c/span\u003e \u003cspan class=\"n\"\u003efaceInfo\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eFaceInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003efaceInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efaceDivision\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ekeyValue\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eKey\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003efaceInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esourceUrl\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ekeyValue\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003efaceInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efaceId\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ejValFaceId\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToString\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003efaceInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003erecLeft\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eParse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ejValRectLeft\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToString\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n            \u003cspan class=\"n\"\u003efaceInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003erecTop\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eParse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ejValRectTop\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToString\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n            \u003cspan class=\"n\"\u003efaceInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003erecWidth\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eParse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ejValRectWidth\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToString\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n            \u003cspan class=\"n\"\u003efaceInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003erecHeight\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eParse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ejValRectHeight\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToString\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003efaceInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 追加箇所 To-------------------------------------------------------------------\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// 画像をバイナリデータに変換\u003c/span\u003e\n        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetImageAsByteArray\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eimageFilePath\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eFileStream\u003c/span\u003e \u003cspan class=\"n\"\u003efileStream\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e\n                \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eFileStream\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eimageFilePath\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eFileMode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eOpen\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eFileAccess\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRead\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eBinaryReader\u003c/span\u003e \u003cspan class=\"n\"\u003ebinaryReader\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eBinaryReader\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efileStream\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003ebinaryReader\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReadBytes\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003efileStream\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e追加箇所ではFace Detectの結果JSONを入れていた\u003ccode\u003econtentString\u003c/code\u003eを、JArray型というJson.NET独自の配列にパースしています。\u003cbr\u003e\nその後foreachで配列の数だけCreateFaceInfoメソッドを呼んでFaceInfo型に整形した後、\u003ccode\u003efaceInfoList\u003c/code\u003eというListにAddしていきます。\u003c/p\u003e\n\n\u003cp\u003e本当は上記のような方法ではなく、\u003ccode\u003efaceInfoList = JsonConvert.DeserializeObject\u0026lt;List\u0026lt;FaceInfo\u0026gt;\u0026gt;(contentString);\u003c/code\u003eとして一文で書ければよかったのですが、今回は戻り値にどの画像から取得してきたのかという情報を付加したかったので、最終的にこの形に落ち着きました。\u003cbr\u003e\n戻り値の型を\u003ccode\u003eList\u0026lt;FaceInfo\u0026gt;\u003c/code\u003eではなく\u003ccode\u003eDictionary\u0026lt;string, List\u0026lt;FaceInfo\u0026gt;\u0026gt;\u003c/code\u003eとしてKeyに\"base\" または \"target\"を指定してあげればよかったような気もしますが、そうすると受け取り側の処理がまた煩雑になりそうだったので、とりあえず今回はこれで。\u003c/p\u003e\n\n\u003cp\u003eここまででFace Detect側の処理は終了です。\u003cbr\u003e\n（長かった…）\u003c/p\u003e\n\n\u003cp\u003e最後に、FaceFindSimilar.cs側で値を受け取れるか確認して、①は終了したいと思います。\u003cbr\u003e\nもう少しだけお付き合いくださいませ。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"3-face-detectから戻り値の受け取り\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#3-face-detect%E3%81%8B%E3%82%89%E6%88%BB%E3%82%8A%E5%80%A4%E3%81%AE%E5%8F%97%E3%81%91%E5%8F%96%E3%82%8A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e3. Face Detectから戻り値の受け取り\u003c/h2\u003e\n\n\u003cp\u003eFaceFindSimilar.csファイルのFaceFindSimilarクラス内部を以下のように記述します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eFaceFindSimilar.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e    \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eFaceFindSimilar\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eURL_BASE\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"ローカル画像ファイルのパス（比較元）\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eURL_TARGET\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"ローカル画像ファイルのパス（比較先）\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eDIVISION_BASE\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"base\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 区分：比較元\u003c/span\u003e\n        \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eDIVISION_TARGET\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"target\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 区分：比較先\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eMain\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eDictionary\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eimageUrls\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eDictionary\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eimageUrls\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDIVISION_BASE\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eURL_BASE\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eimageUrls\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDIVISION_TARGET\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eURL_TARGET\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// Face DetectからfaceIdその他を取得\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eFaceInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003efaceInfoList\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eFaceDetect\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDetect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eimageUrls\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efaceInfoList\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eExists\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efaceDivision\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eDIVISION_BASE\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003efaceInfoList\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eExists\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efaceDivision\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eDIVISION_TARGET\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"顔が検出できました。:\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n                \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eFaceInfo\u003c/span\u003e \u003cspan class=\"n\"\u003efaceInfo\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003efaceInfoList\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"faceDivision: \"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003efaceInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efaceDivision\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\" , sourceUrl: \"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003efaceInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esourceUrl\u003c/span\u003e\n                        \u003cspan class=\"p\"\u003e+\u003c/span\u003e\u003cspan class=\"n\"\u003eEnvironment\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNewLine\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\"faceId: \"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003efaceInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efaceId\u003c/span\u003e\n                        \u003cspan class=\"p\"\u003e+\u003c/span\u003e\u003cspan class=\"n\"\u003eEnvironment\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNewLine\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Rectangle: {\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003efaceInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003erecLeft\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\", \"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003efaceInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003erecTop\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\", \"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003efaceInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003erecWidth\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\", \"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003efaceInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003erecHeight\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\"}\"\u003c/span\u003e\n                        \u003cspan class=\"p\"\u003e+\u003c/span\u003e\u003cspan class=\"n\"\u003eEnvironment\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNewLine\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"顔が検出できませんでした。\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n            \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReadLine\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e定数\u003ccode\u003eURL_BASE\u003c/code\u003eと\u003ccode\u003eURL_TARGET\u003c/code\u003eに対してローカル画像のパス（今回は冒頭の画像を指定しています）を指定して実行すると、以下のような値が取れるかと思います。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"console\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"go\"\u003e顔が検出できました。:\nfaceDivision: base , sourceUrl: 比較元画像のファイルパス\nfaceId: 206b61c0-6539-4ad8-bf01-2fd8c18537c1\nRectangle: {874, 241, 210, 210}\n\nfaceDivision: target , sourceUrl: 比較先画像のファイルパス\nfaceId: 68b07497-0502-41e9-9af1-290348848b1e\nRectangle: {765, 260, 148, 148}\n\nfaceDivision: target , sourceUrl: 比較先画像のファイルパス\nfaceId: 2df5c831-f10c-475e-a6c8-734a3cc8c04e\nRectangle: {545, 347, 124, 124}\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eFace Detectを使用して、その戻り値を取得できました。\u003cbr\u003e\n次回②で、本題のFace FindSimilarを使用して類似度の判定を行いたいと思います。\u003c/p\u003e\n","createdAt":"2019-05-18T15:44:59Z","elapsedYearsFromLastModifiedAt":2,"encryptedId":"9caFFSEuPiEFMxEkMajstnOgYk4wBlMN--xDEi2mVStJuL9nOp--e29/Wb6aecI70wFlQJuFeA==","isBanned":false,"isDeprecated":true,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":false,"lastModifiedAt":"2019-05-18T15:44:59Z","likesCount":4,"linkUrl":"https://qiita.com/koob/items/b649e463842b1c16f297","organization":null,"originalId":900164,"stockedCount":6,"title":"AzureのFace APIを使って顔の類似度を判定する①","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%BD%9C%E3%82%8B%E3%82%82%E3%81%AE\"\u003e作るもの\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%AE%8C%E6%88%90%E7%89%88%E3%81%AE%E5%AE%9F%E8%A1%8C%E7%B5%90%E6%9E%9C\"\u003e完成版の実行結果\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%92%B0%E5%A2%83%E4%BD%BF%E3%81%A3%E3%81%9F%E3%82%82%E3%81%AE\"\u003e環境、使ったもの\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#face-findsimilar%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\"\u003eFace FindSimilarについて\u003c/a\u003e\n\u003cul\u003e\n\u003cul\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#face-api%E3%81%B8post%E3%81%99%E3%82%8B%E9%9A%9B%E3%81%AE%E5%90%84%E3%83%91%E3%83%A9%E3%83%A1%E3%83%BC%E3%82%BF%E3%81%AA%E3%81%A9\"\u003eFace APIへPOSTする際の各パラメータなど\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/ul\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\n\n\u003cli\u003e\n\u003ca href=\"#%E4%BD%9C%E6%88%90%E6%89%8B%E9%A0%86\"\u003e作成手順\u003c/a\u003e\n\u003cul\u003e\n\u003cul\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%A0%E3%81%84%E3%81%9F%E3%81%84%E3%81%93%E3%82%93%E3%81%AA%E6%84%9F%E3%81%98\"\u003eだいたいこんな感じ\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/ul\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\n\n\u003cli\u003e\n\u003ca href=\"#1-%E6%BA%96%E5%82%99\"\u003e1. 準備\u003c/a\u003e\n\u003cul\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B3%E3%83%B3%E3%82%BD%E3%83%BC%E3%83%AB%E3%82%A2%E3%83%97%E3%83%AA%E3%82%92%E6%96%B0%E8%A6%8F%E4%BD%9C%E6%88%90\"\u003eコンソールアプリを新規作成\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E8%A8%98%E8%BF%B0\"\u003e設定ファイルの記述\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\n\n\u003cli\u003e\n\u003ca href=\"#2-face-detect%E3%81%8B%E3%82%89%E9%A1%94%E6%83%85%E5%A0%B1%E3%82%92%E5%8F%96%E5%BE%97\"\u003e2. Face Detectから顔情報を取得\u003c/a\u003e\n\u003cul\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#facedetectcs%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E4%BD%9C%E6%88%90\"\u003eFaceDetect.csファイルの作成\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%88%BB%E3%82%8A%E5%80%A4%E3%81%AF%E3%81%AA%E3%81%AB%E3%81%8B\"\u003e戻り値はなにか\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%BC%95%E6%95%B0\"\u003e引数\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%88%BB%E3%82%8A%E5%80%A4\"\u003e戻り値\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#detect%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%AE%E5%AE%9F%E8%A3%85\"\u003eDetectメソッドの実装\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#imageanalysisrequest%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89--%CE%B1-%E3%81%AE%E5%AE%9F%E8%A3%85\"\u003eImageAnalysisRequestメソッド ＋ α の実装\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\n\n\u003cli\u003e\n\u003ca href=\"#3-face-detect%E3%81%8B%E3%82%89%E6%88%BB%E3%82%8A%E5%80%A4%E3%81%AE%E5%8F%97%E3%81%91%E5%8F%96%E3%82%8A\"\u003e3. Face Detectから戻り値の受け取り\u003c/a\u003e\n\u003c/li\u003e\n\n\n\n","totalPv":3388,"uuid":"b649e463842b1c16f297","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"1fPEF1jYzom/L3r+yNtRVyM4P2+6--RLuCjgX63mOnvo1H--JFnzlJ5NQZWdaO2glpB8lQ==","originalId":403060,"description":"基幹系システム開発が主な業務の5年目30歳ITエンジニアです。\r\n会社ではC#, VB.NET。\r\nリングフィット継続中。","facebookUrl":null,"githubUrl":null,"isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"","profileImageUrl":"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/403060/profile-images/1557060036","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F403060%2Fprofile-images%2F1557060036?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=455a75aba96df1c9b8e2d8e34ac53b4e","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F403060%2Fprofile-images%2F1557060036?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=1fcd3420393a77ba6585d7f8ec45ad7d","urlName":"koob","websiteUrl":"","twitterUrl":"https://twitter.com/koob12340160","twitterUrlName":"koob12340160","revealedOrganizations":{"edges":[]}},"tags":[{"name":"C#","urlName":"csharp"},{"name":".NETFramework","urlName":".netframework"},{"name":"Json.NET","urlName":"json.net"},{"name":"FaceAPI","urlName":"faceapi"},{"name":"CognitiveServices","urlName":"cognitiveservices"}],"followingLikers":{"edges":[]},"comments":{"totalCount":0}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

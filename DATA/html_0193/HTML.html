<!DOCTYPE html><html><head><meta charset="utf-8" /><title>.NET 5におけるOrderBy(keySelector).First(predicate)の計算量が増える破壊的変更と、それから考える.NET 5の立ち位置 - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/RyotaMurohoshi/items/3d932647c2fd33b80f70" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="axNx11nP6mmJ+7vdUgftp3yjglqJulCargwbvplTUzOcIbd7FeVFx2ZjvnhauulryxhT9EbtU6QGFNgCzPMrTg==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta content="@RyotaMurohoshi" name="twitter:creator" /><meta property="og:type" content="article"><meta property="og:title" content=".NET 5におけるOrderBy(keySelector).First(predicate)の計算量が増える破壊的変更と、それから考える.NET 5の立ち位置 - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1MazVGVkNBMTQ0R3I0NEdLNDRHUjQ0S0xUM0prWlhKQ2VTaHJaWGxUWld4bFkzUnZjaWt1Um1seWMzUW9jSEpsWkdsallYUmxLZU9CcnVpb2lPZXVsLW1Iai1PQmpPV2lsLU9CaU9PQ2ktZWd0T1dqaXVlYWhPV2tpZWFidE9PQnFPT0FnZU9CbmVPQ2pPT0JpLU9DaWVpQWctT0JpT09DaXk1T1JWUWdOZU9CcnVlcmktT0JvZVM5amVlOXJnJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NTQmdHh0LWNsaXA9ZWxsaXBzaXMmdHh0LWFsaWduPWNlbnRlciUyQ21pZGRsZSZzPWM5MDQ2MzI2MzQ1ZTFhMDliM2M0MDEwM2FiMjEzNmFj&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RRko1YjNSaFRYVnliMmh2YzJocCZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTQ1JnR4dC1hbGlnbj1yaWdodCUyQ2JvdHRvbSZzPWM4YzI0YzcyN2ZlNmRlMTczYTY2NjAwZDNkNGM4N2Y0&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=8c27ab64c8b323487c3fd1fb003050a3"><meta property="og:description" content="『.NET 5は、.NET Core 3.1の次期バージョンであると同時に、.NET Framework 4.8の移行先でもある。』

そんなことを.NET 5の破壊的変更リスト一覧にある「Complexity of LINQ Ord..."><meta content="https://qiita.com/RyotaMurohoshi/items/3d932647c2fd33b80f70" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#,.NET,LINQ,.NETFramework,.NETCore" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-39f61bf6-1af7-48bd-aab0-de990507e79a"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2FRyotaMurohoshi%2Fitems%2F3d932647c2fd33b80f70">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2FRyotaMurohoshi%2Fitems%2F3d932647c2fd33b80f70">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-39f61bf6-1af7-48bd-aab0-de990507e79a">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2020-12-24T01:24:54.000+09:00","dateModified":"2020-12-25T00:06:06.000+09:00","headline":".NET 5におけるOrderBy(keySelector).First(predicate)の計算量が増える破壊的変更と、それから考える.NET 5の立ち位置","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1MazVGVkNBMTQ0R3I0NEdLNDRHUjQ0S0xUM0prWlhKQ2VTaHJaWGxUWld4bFkzUnZjaWt1Um1seWMzUW9jSEpsWkdsallYUmxLZU9CcnVpb2lPZXVsLW1Iai1PQmpPV2lsLU9CaU9PQ2ktZWd0T1dqaXVlYWhPV2tpZWFidE9PQnFPT0FnZU9CbmVPQ2pPT0JpLU9DaWVpQWctT0JpT09DaXk1T1JWUWdOZU9CcnVlcmktT0JvZVM5amVlOXJnJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NTQmdHh0LWNsaXA9ZWxsaXBzaXMmdHh0LWFsaWduPWNlbnRlciUyQ21pZGRsZSZzPWM5MDQ2MzI2MzQ1ZTFhMDliM2M0MDEwM2FiMjEzNmFj\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RRko1YjNSaFRYVnliMmh2YzJocCZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTQ1JnR4dC1hbGlnbj1yaWdodCUyQ2JvdHRvbSZzPWM4YzI0YzcyN2ZlNmRlMTczYTY2NjAwZDNkNGM4N2Y0\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=8c27ab64c8b323487c3fd1fb003050a3","mainEntityOfPage":"https://qiita.com/RyotaMurohoshi/items/3d932647c2fd33b80f70","author":{"@type":"Person","address":"","email":"ryotamurohoshi@gmail.com","identifier":"RyotaMurohoshi","name":"RyotaMurohoshi","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F4125%2Fprofile-images%2F1502026161?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=debc0abd71c258d50474dcf003f262a2","url":"https://qiita.com/RyotaMurohoshi","description":"プログラミングが大好きで、 C#が大好きで、 .NETが大好きで、 LINQが大好きで、 JVM言語が大好きで、 ゲームで遊ぶことが大好きで、 ゲーム開発が大好きで、 頑張るのが大好きで、 Unityが大好きだったから...！","memberOf":[]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://zine.qiita.com/interview/202107-hitachi/?utm_source=qiita&amp;utm_medium=header-banner">グループ会社出納業務の証票処理を70％自動化。日立のAI-OCR技術とは？</a><a target="_blank" id="header_text_message_2" href="https://zine.qiita.com/interview/202107-hitachi/?utm_source=qiita&amp;utm_medium=header-banner">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"RyotaMurohoshi","type":"items","id":"3d932647c2fd33b80f70"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"グループ会社出納業務の証票処理を70％自動化。日立のAI-OCR技術とは？","url":"https://zine.qiita.com/interview/202107-hitachi/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"RyotaMurohoshi","type":"items","id":"3d932647c2fd33b80f70"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_1","message":"グループ会社出納業務の証票処理を70％自動化。日立のAI-OCR技術とは？","url":"https://zine.qiita.com/interview/202107-hitachi/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"RyotaMurohoshi","type":"items","id":"3d932647c2fd33b80f70"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_2","message":"グループ会社出納業務の証票処理を70％自動化。日立のAI-OCR技術とは？","url":"https://zine.qiita.com/interview/202107-hitachi/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/RyotaMurohoshi/items/3d932647c2fd33b80f70","location":"/RyotaMurohoshi/items/3d932647c2fd33b80f70","scheme":"https","host":"qiita.com","port":null,"pathname":"/RyotaMurohoshi/items/3d932647c2fd33b80f70","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"7jT97lgd79yE79U9OUVQPPU+v9auRMVOujhq7QFULiIZBjtCFDdAcmt30Jgx+FTwQoVueGETxnASIKlRVPRWXw==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-a22a69a3-5dd5-466e-9b99-92c866b842d0"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/RyotaMurohoshi/items/3d932647c2fd33b80f70/likers" class="css-1iupg5d">27</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">11</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/3d932647c2fd33b80f70/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/RyotaMurohoshi/items/3d932647c2fd33b80f70/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/RyotaMurohoshi/items/3d932647c2fd33b80f70/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/RyotaMurohoshi/items/3d932647c2fd33b80f70/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/RyotaMurohoshi/items/3d932647c2fd33b80f70.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-helsa7"><div class="css-8qb8m4"><div class="it-AdcalRibbon"><span><a href="/advent-calendar/2020/csharplang" class="it-AdcalRibbon_title">C#<!-- --> Advent Calendar<!-- --> <!-- -->2020</a>Day 25</span></div><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/RyotaMurohoshi"><img class="css-100alwu eyfquo10" src="https://qiita-image-store.s3.amazonaws.com/0/4125/profile-images/1502026161" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/RyotaMurohoshi" class="css-10ougpm">@<!-- -->RyotaMurohoshi</a><div class="css-1ay9vb9"><span><meta content="2020-12-23T16:24:54Z"/><time dateTime="2020-12-24T15:06:06Z" class="css-m19uds">updated at 2020-12-24</time></span></div></div></div></div></div><h1 class="css-cgzq40">.NET 5におけるOrderBy(keySelector).First(predicate)の計算量が増える破壊的変更と、それから考える.NET 5の立ち位置</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/.net" class="css-4czcte">.NET</a><a href="/tags/linq" class="css-4czcte">LINQ</a><a href="/tags/.netframework" class="css-4czcte">.NETFramework</a><a href="/tags/.netcore" class="css-4czcte">.NETCore</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div><p>『.NET 5は、.NET Core 3.1の次期バージョンであると同時に、.NET Framework 4.8の移行先でもある。』</p>

<p>そんなことを<a href="https://docs.microsoft.com/en-us/dotnet/core/compatibility/5.0" rel="nofollow noopener" target="_blank">.NET 5の破壊的変更リスト一覧</a>にある「<a href="https://docs.microsoft.com/en-us/dotnet/core/compatibility/core-libraries/5.0/orderby-firstordefault-complexity-increase" rel="nofollow noopener" target="_blank">Complexity of LINQ OrderBy.First{OrDefault} increased</a>」から感じました。</p>

<p>この投稿では、その破壊的内容と背景を紹介します。</p>

<h1>
<span id="破壊的変更の概要" class="fragment"></span><a href="#%E7%A0%B4%E5%A3%8A%E7%9A%84%E5%A4%89%E6%9B%B4%E3%81%AE%E6%A6%82%E8%A6%81"><i class="fa fa-link"></i></a>破壊的変更の概要</h1>

<p>.NET 5の破壊的変更である「<a href="https://docs.microsoft.com/en-us/dotnet/core/compatibility/core-libraries/5.0/orderby-firstordefault-complexity-increase" rel="nofollow noopener" target="_blank">Complexity of LINQ OrderBy.First{OrDefault} increased</a>」の概要説明文は以下の通りです。</p>

<blockquote>
<p>The implementation of <code>OrderBy.First&lt;TSource&gt;(IEnumerable&lt;TSource&gt;, Func&lt;TSource,Boolean&gt;)</code> and <code>OrderBy.FirstOrDefault<br>
&lt;TSource&gt;(IEnumerable&lt;TSource&gt;, Func&lt;TSource,Boolean&gt;)</code> has changed, resulting in increased complexity for the operation.</p>
</blockquote>

<p>（.NET Core 3.1から比較し）<code>OrderBy(keySelector).First(predicate)</code>などの実装が変わり、計算量が増えた、と。</p>

<p>「計算量が増えた」</p>

<p>これだけ読むと、何事かとちょっとびっくりしますよね。</p>

<h1>
<span id="以前の実装と計算量" class="fragment"></span><a href="#%E4%BB%A5%E5%89%8D%E3%81%AE%E5%AE%9F%E8%A3%85%E3%81%A8%E8%A8%88%E7%AE%97%E9%87%8F"><i class="fa fa-link"></i></a>以前の実装と計算量</h1>

<p>まず<code>OrderBy(keySelector)</code>の計算量が.NET Coreではどうなっていたか把握しましょう。</p>

<p>ソートを行う処理では、計算量がO(n log n)かかりますよね。そして、<code>OrderBy(keySelector)</code>メソッドはソートを行うメソッドです。<code>OrderBy(keySelector)</code>メソッドの結果を列挙したら、その計算量はO(n log n)です。（C#に慣れている方はご存知の通り、<code>OrderBy(keySelector)</code>メソッドを呼び出したタイミングでソート処理がされるわけではなく、<code>OrderBy(keySelector)</code>の結果を列挙したタイミングで、ソート処理がされることに注意してください）</p>

<p>ところが.NET Coreでは、<code>OrderBy(keySelector)</code>の後に<code>First()</code>や<code>First(predicate)</code>がきた場合、なんとO(n)で計算できるような実装が行われていました。</p>

<p><code>OrderBy(keySelector).First()</code>の呼び出しを考えてみましょう。直接的な意味としては、「ソートした後、最初の要素を取得」しています。ということは、「一番小さい要素」を取得できればいいですね。であるのならば、この二つのメソッド呼び出しが連続する場合、ソート処理をする必要はありません。「全要素を列挙して、一番小さいもの」を取得すればいいですね。これならば、O(n log n)は必要なくてO(n)で計算できてしまいます。<code>OrderBy(keySelector).First()</code>と連続した呼び出しの場合、.NET Coreでは、ソートの処理を行っていません。（詳しくはこちらの「<a href="https://qiita.com/RyotaMurohoshi/items/5b515bf2ee544cc1b016" id="reference-2dd826fdf925a925edf0">.NETや.NET CoreのOrderBy(keySelector).First()はO(n log n)でなくてO(n)な件</a>」を読んでみてください）</p>

<p>では次に、<code>OrderBy(keySelector).First(predicate)</code>の呼び出しを考えてみましょう。意味としては、「ソートした後、条件を満たす最初の要素を取得」しています。ということは、「全要素を列挙して、predicateの条件をみたす内、一番小さいもの」を取得すればいいですね。これを実現するためには、全要素を一巡列挙するだけで良いので、ソートする必要はありません。こちらも、O(n log n)は必要なくてO(n)で計算できそうです。こちらも、.NET Coreでは、ソートの処理を行っていませんでした。</p>

<p>このように、.NET Coreの<code>OrderBy(keySelector)</code>と<code>First()</code>の連続呼び出し、<code>OrderBy(keySelector)</code>と<code>First(predicate)</code>の連続呼び出しでは、特別な工夫をしています。</p>

<hr>

<p>ところで、.NET Coreの<code>OrderBy(keySelector).First(predicate)</code>の実装には注意点があります。</p>

<p>それは、「.NET Coreの実装では、必ず全ての要素に対して、引数のpredicateを適用する」という点です。</p>

<p>もし仮に、<code>OrderBy(keySelector).First(predicate)</code>の実装が.NET Coreの実装と異なり、「シンプルにソートしたものの最初の要素を取得」していた場合を考えます。この場合、ソートでO(n log n)の計算量がかかりますが、一方でpredicateを適用するのは必ずしも全ての要素とは限りません。ソートした後、predicateを満たす最初の要素が見つかったタイミングで、後続の要素へ適用はされません。「1要素にのみ、predicateを適用する」ということもありえますし、「2要素にのみ、predicateを適用する」こともありえますし、「全ての要素に、predicateを適用する」こともありえます。</p>

<p>.NET Coreの<code>OrderBy(keySelector).First(predicate)</code>の実装、「必ず全ての要素に対して、引数のpredicateを適用する」は違和感を覚える人もいるかもしれません。内部実装とその意図を知っていないと、混乱するでしょう。</p>

<hr>

<p>一方で.NET Frameworkです。</p>

<p>.NET Frameworkでは、<code>OrderBy(keySelector).First(predicate)</code>の実装は、「シンプルにソートしたものの最初の要素を取得」と言う実装でした。ソートした後、predicateを満たす最初の要素が見つかったタイミングで、後続の要素へ適用はされません。「1要素にのみ、predicateを適用する」ということもありえますし、「2要素にのみ、predicateを適用する」こともありえますし、「全ての要素に、predicateを適用する」こともありえます。</p>

<p>O(n log n)だったわけです。</p>

<hr>

<p>まとめると</p>

<ul>
<li>.NET Coreの<code>OrderBy(keySelector).First(predicate)</code>の実装

<ul>
<li>O(n)で処理される</li>
<li>必ず全ての要素に引数のpredicateを適用する必要がある</li>
</ul>
</li>
<li>.NET Frameworkの<code>OrderBy(keySelector).First(predicate)</code>の実装

<ul>
<li>O(n log n)で処理される</li>
<li>引数のpredicateを適用されるのは、最初の1つだけかもしれないし、2つかもしれないし、n個すべてかもしれない</li>
</ul>
</li>
</ul>

<p>となります。</p>

<h1>
<span id="net-coreの最適化の実装の問題点" class="fragment"></span><a href="#net-core%E3%81%AE%E6%9C%80%E9%81%A9%E5%8C%96%E3%81%AE%E5%AE%9F%E8%A3%85%E3%81%AE%E5%95%8F%E9%A1%8C%E7%82%B9"><i class="fa fa-link"></i></a>.NET Coreの最適化の実装の問題点</h1>

<p>.NET Coreの<code>OrderBy(keySelector).First(predicate)</code>コードは最適化がされていて、一見とても良さそうですね。</p>

<p>しかし、.NET Frameworkから.NET Coreに移行した場合、問題になることがあります。それは「必ず全ての要素に引数のpredicateを適用する必要がある」という点です。</p>

<p>次のコードは、<a href="https://github.com/dotnet/runtime/issues/31554" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/dotnet/runtime/issues/31554</a> より、コードフォーマットを変えたコードです。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="c1">// これはLINQ中に副作用のあるメソッドを呼んでいる良くないコード</span>
<span class="kt">var</span> <span class="n">account</span> <span class="p">=</span> <span class="n">accounts</span>
    <span class="p">.</span><span class="nf">OrderBy</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">UsageCount</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">FirstOrDefault</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="nf">TryReserve</span><span class="p">(</span><span class="n">token</span><span class="p">));</span>
</code></pre></div></div>

<p>このコード中、<code>TryReserve</code>メソッドは副作用のあるメソッドです。そして、このコードを.NET Frameworkから.NET Coreに移行した時に問題が発生します。</p>

<p>.NET Frameworkの場合：</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>accountsのUsageCountが少ない人からTryReserveを試みて、一人でも成功したらそこで処理が終了。
予約ができるのは一要素もしくはどの要素も予約を行わない。
accountにはUsageCountが最小の要素が代入される。

</code></pre></div></div>

<p>.NET Coreの場合：</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>accounts全ての要素がTryReserveを試みる。
予約可能な要素が全て予約できてしまう。
accountにはUsageCountが最小の要素が代入される。
</code></pre></div></div>

<p>このようにこのコードを.NET Frameworkから.NET Coreに移行した時に、「全ての要素が予約を試みてしまい、予約可能な要素が全て予約できてしまう。」という問題が発生しまいますね。</p>

<p>私としてはこのコードは良くないコードだと思います。「副作用があるような処理をLINQの中で使うべきでない」からです。</p>

<p>良くないコードではあるのですが、実プロダクトとしてすでにこのようなコードがあり、移行した際にこのような問題が起こる可能性もあるのは確かです。</p>

<h1>
<span id="破壊的な変更の内容と理由" class="fragment"></span><a href="#%E7%A0%B4%E5%A3%8A%E7%9A%84%E3%81%AA%E5%A4%89%E6%9B%B4%E3%81%AE%E5%86%85%E5%AE%B9%E3%81%A8%E7%90%86%E7%94%B1"><i class="fa fa-link"></i></a>破壊的な変更の内容と理由</h1>

<p>ここでやっと、.NET 5での<code>OrderBy(keySelector).First(predicate)</code>の実装の破壊的な変更内容の紹介です。</p>

<p>NET 5での<code>OrderBy(keySelector).First(predicate)</code>は、.NET Core 3.1までの「O(n)で処理され、必ず全ての要素に引数のpredicateを適用する必要がある」実装ではなくなりました。「O(n log n)で処理される、引数のpredicateを適用されるのは、最初の1つだけかもしれないし、2つかもしれないし、n個すべてかもしれない」というシンプルな実装に変わりました。.NET Frameworkと同じ実装方針になったわけです。</p>

<p>計算量だけで言うと、O(n)から、O(n log n)に増えました。</p>

<p>「計算量が増えた」というよりも、「工夫していた実装を、シンプルで素直な実装に戻した」とも言えます。</p>

<p>「<a href="https://docs.microsoft.com/en-us/dotnet/core/compatibility/core-libraries/5.0/orderby-firstordefault-complexity-increase" rel="nofollow noopener" target="_blank">Complexity of LINQ OrderBy.First{OrDefault} increased</a>」の理由の説明には、以下のようにあります。</p>

<blockquote>
<p>The benefit of invoking the predicate fewer times outweighs a lower overall complexity, so the implementation that was introduced in .NET Core 1.0 was reverted. For more information, see this dotnet/runtime issue.</p>
</blockquote>

<p>なるほど「predicate」の呼び出し回数を少なくするメリットが、全体的な計算量を下げることを上回ったと。詳しくは、こちらの「<a href="https://github.com/dotnet/runtime/issues/31554" rel="nofollow noopener" target="_blank">dotnet/runtimeのissue</a>」を参考にとあります。先に紹介したコードは、このissueの概要で説明されているコードです。</p>

<p>.NET 5は、.NET Core 3.1の次期バージョンであると同時に、.NET Framework 4.8の移行先でもあります。もし仮に、「.NET 5の実装が、.NET Core 3.1と同じだったら」を想像しましょう。.NET Framework 4.8から.NET 5に移行した時に、先に紹介した問題が発生してしまう可能性は確かにあります。</p>

<p>パフォーマンス最適化はなくなるが、.NET 3.1から.NET 5で破壊的な変更を行い、.NET Framework 4.8と同じような挙動にする、というのにも納得できます。</p>

<hr>

<p>この破壊的変更を行っている「<a href="https://github.com/dotnet/runtime/pull/36643" rel="nofollow noopener" target="_blank">Pull Requestの説明</a>」は以下の通りです。</p>

<blockquote>
<p>The optimization removes the O(N log N) cost of the OrderBy. But it can result in executing the predicate passed to First{OrDefault} more than in .NET Framework; it would always execute it N times, whereas in .NET Framework it would execute it &lt;= N times. Developers have expressed concern about the change, in particular when using a relatively expensive predicate on a relatively short list, or when unadvisedly relying on side-effecting predicates.</p>

<p>This optimization has been in .NET Core since 1.0. If the original optimization is considered breaking from .NET Framework, then undoing it is breaking, too.</p>
</blockquote>

<h1>
<span id="自分の意見" class="fragment"></span><a href="#%E8%87%AA%E5%88%86%E3%81%AE%E6%84%8F%E8%A6%8B"><i class="fa fa-link"></i></a>自分の意見</h1>

<p>最後に自分の意見をいくつか述べたいと思います</p>

<ul>
<li>
<code>OrderBy(keySelector).First()</code>で最適化がかかるのは、いいと思う</li>
<li>けど↑のコードは自分じゃ書かないし、コードレビューなどの機会では、MinByなどを作って使うように指摘すると思う</li>
<li>.NET Coreの<code>OrderBy(keySelector).First(predicate)</code>の最適化、あんまり好きじゃない。予測・期待している挙動と違うから</li>
<li>こちらも↑のコードは自分じゃ書かないし、コードレビューなどの機会では、Whereと共に、MinByを使うように指摘すると思う</li>
<li>副作用のあるコードをLINQで書くな！副作用あるなら、foreachしてくれ！</li>
<li>.NET 5は.NET Framework 4.8の移行先でもあるので、結構気を遣うところもあるのかなーと思う</li>
<li>パフォーマンスのメリットよりも、予期しにくい挙動でバグを生む方がこわいなー</li>
<li>逆に.NET Core 3.1からの破壊的な変更になってしまうという側面もあるよなーとも思う

<ul>
<li>がしかし、全ての要素にpredicateを適用することに依存したコードってよくないよね</li>
<li>それから<code>OrderBy(keySelector).First()</code>ってそもそもそんなに書く機会ないよね？MinBy作ろ？使お？ね！</li>
</ul>
</li>
<li>.NETのコアライブラリ、いい加減MinBy/MaxByいれない？</li>
<li>コアライブラリの挙動の破壊的な変更、難しいなー </li>
</ul>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2FRyotaMurohoshi%2Fitems%2F3d932647c2fd33b80f70&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2FRyotaMurohoshi%2Fitems%2F3d932647c2fd33b80f70&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/RyotaMurohoshi/items/3d932647c2fd33b80f70/likers" class="css-1iupg5d">27</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">11</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/3d932647c2fd33b80f70/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/RyotaMurohoshi/items/3d932647c2fd33b80f70/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/RyotaMurohoshi/items/3d932647c2fd33b80f70/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/RyotaMurohoshi/items/3d932647c2fd33b80f70/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/RyotaMurohoshi/items/3d932647c2fd33b80f70.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-a22a69a3-5dd5-466e-9b99-92c866b842d0">{"authorAnalyticsTrackingId":"UA-52654704-1","organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-19ef7f7b-89e5-4c5c-bcab-b6d994d3b9ef"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-19ef7f7b-89e5-4c5c-bcab-b6d994d3b9ef">{}</script>
      
<div id="LoginModal-react-component-fdac24f4-900e-4490-8ddf-08078177766f"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-fdac24f4-900e-4490-8ddf-08078177766f">{}</script>
      
<div id="StockModal-react-component-492ea0d8-787d-45fa-8fdd-6bd0fe1abdf4"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-492ea0d8-787d-45fa-8fdd-6bd0fe1abdf4">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;zkxmoLDjSPEhMz4Ifb3o0YVIwwdRHpTnRMU+qI0pC/w5fqAM/MnnX86rO611AOwdMvMSqZ5Jl9ns3f0U2IlzgQ==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\u003cp\u003e『.NET 5は、.NET Core 3.1の次期バージョンであると同時に、.NET Framework 4.8の移行先でもある。』\u003c/p\u003e\n\n\u003cp\u003eそんなことを\u003ca href=\"https://docs.microsoft.com/en-us/dotnet/core/compatibility/5.0\" rel=\"nofollow noopener\" target=\"_blank\"\u003e.NET 5の破壊的変更リスト一覧\u003c/a\u003eにある「\u003ca href=\"https://docs.microsoft.com/en-us/dotnet/core/compatibility/core-libraries/5.0/orderby-firstordefault-complexity-increase\" rel=\"nofollow noopener\" target=\"_blank\"\u003eComplexity of LINQ OrderBy.First{OrDefault} increased\u003c/a\u003e」から感じました。\u003c/p\u003e\n\n\u003cp\u003eこの投稿では、その破壊的内容と背景を紹介します。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"破壊的変更の概要\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%A0%B4%E5%A3%8A%E7%9A%84%E5%A4%89%E6%9B%B4%E3%81%AE%E6%A6%82%E8%A6%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e破壊的変更の概要\u003c/h1\u003e\n\n\u003cp\u003e.NET 5の破壊的変更である「\u003ca href=\"https://docs.microsoft.com/en-us/dotnet/core/compatibility/core-libraries/5.0/orderby-firstordefault-complexity-increase\" rel=\"nofollow noopener\" target=\"_blank\"\u003eComplexity of LINQ OrderBy.First{OrDefault} increased\u003c/a\u003e」の概要説明文は以下の通りです。\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eThe implementation of \u003ccode\u003eOrderBy.First\u0026lt;TSource\u0026gt;(IEnumerable\u0026lt;TSource\u0026gt;, Func\u0026lt;TSource,Boolean\u0026gt;)\u003c/code\u003e and \u003ccode\u003eOrderBy.FirstOrDefault\u003cbr\u003e\n\u0026lt;TSource\u0026gt;(IEnumerable\u0026lt;TSource\u0026gt;, Func\u0026lt;TSource,Boolean\u0026gt;)\u003c/code\u003e has changed, resulting in increased complexity for the operation.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e（.NET Core 3.1から比較し）\u003ccode\u003eOrderBy(keySelector).First(predicate)\u003c/code\u003eなどの実装が変わり、計算量が増えた、と。\u003c/p\u003e\n\n\u003cp\u003e「計算量が増えた」\u003c/p\u003e\n\n\u003cp\u003eこれだけ読むと、何事かとちょっとびっくりしますよね。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"以前の実装と計算量\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BB%A5%E5%89%8D%E3%81%AE%E5%AE%9F%E8%A3%85%E3%81%A8%E8%A8%88%E7%AE%97%E9%87%8F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e以前の実装と計算量\u003c/h1\u003e\n\n\u003cp\u003eまず\u003ccode\u003eOrderBy(keySelector)\u003c/code\u003eの計算量が.NET Coreではどうなっていたか把握しましょう。\u003c/p\u003e\n\n\u003cp\u003eソートを行う処理では、計算量がO(n log n)かかりますよね。そして、\u003ccode\u003eOrderBy(keySelector)\u003c/code\u003eメソッドはソートを行うメソッドです。\u003ccode\u003eOrderBy(keySelector)\u003c/code\u003eメソッドの結果を列挙したら、その計算量はO(n log n)です。（C#に慣れている方はご存知の通り、\u003ccode\u003eOrderBy(keySelector)\u003c/code\u003eメソッドを呼び出したタイミングでソート処理がされるわけではなく、\u003ccode\u003eOrderBy(keySelector)\u003c/code\u003eの結果を列挙したタイミングで、ソート処理がされることに注意してください）\u003c/p\u003e\n\n\u003cp\u003eところが.NET Coreでは、\u003ccode\u003eOrderBy(keySelector)\u003c/code\u003eの後に\u003ccode\u003eFirst()\u003c/code\u003eや\u003ccode\u003eFirst(predicate)\u003c/code\u003eがきた場合、なんとO(n)で計算できるような実装が行われていました。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eOrderBy(keySelector).First()\u003c/code\u003eの呼び出しを考えてみましょう。直接的な意味としては、「ソートした後、最初の要素を取得」しています。ということは、「一番小さい要素」を取得できればいいですね。であるのならば、この二つのメソッド呼び出しが連続する場合、ソート処理をする必要はありません。「全要素を列挙して、一番小さいもの」を取得すればいいですね。これならば、O(n log n)は必要なくてO(n)で計算できてしまいます。\u003ccode\u003eOrderBy(keySelector).First()\u003c/code\u003eと連続した呼び出しの場合、.NET Coreでは、ソートの処理を行っていません。（詳しくはこちらの「\u003ca href=\"https://qiita.com/RyotaMurohoshi/items/5b515bf2ee544cc1b016\" id=\"reference-2dd826fdf925a925edf0\"\u003e.NETや.NET CoreのOrderBy(keySelector).First()はO(n log n)でなくてO(n)な件\u003c/a\u003e」を読んでみてください）\u003c/p\u003e\n\n\u003cp\u003eでは次に、\u003ccode\u003eOrderBy(keySelector).First(predicate)\u003c/code\u003eの呼び出しを考えてみましょう。意味としては、「ソートした後、条件を満たす最初の要素を取得」しています。ということは、「全要素を列挙して、predicateの条件をみたす内、一番小さいもの」を取得すればいいですね。これを実現するためには、全要素を一巡列挙するだけで良いので、ソートする必要はありません。こちらも、O(n log n)は必要なくてO(n)で計算できそうです。こちらも、.NET Coreでは、ソートの処理を行っていませんでした。\u003c/p\u003e\n\n\u003cp\u003eこのように、.NET Coreの\u003ccode\u003eOrderBy(keySelector)\u003c/code\u003eと\u003ccode\u003eFirst()\u003c/code\u003eの連続呼び出し、\u003ccode\u003eOrderBy(keySelector)\u003c/code\u003eと\u003ccode\u003eFirst(predicate)\u003c/code\u003eの連続呼び出しでは、特別な工夫をしています。\u003c/p\u003e\n\n\u003chr\u003e\n\n\u003cp\u003eところで、.NET Coreの\u003ccode\u003eOrderBy(keySelector).First(predicate)\u003c/code\u003eの実装には注意点があります。\u003c/p\u003e\n\n\u003cp\u003eそれは、「.NET Coreの実装では、必ず全ての要素に対して、引数のpredicateを適用する」という点です。\u003c/p\u003e\n\n\u003cp\u003eもし仮に、\u003ccode\u003eOrderBy(keySelector).First(predicate)\u003c/code\u003eの実装が.NET Coreの実装と異なり、「シンプルにソートしたものの最初の要素を取得」していた場合を考えます。この場合、ソートでO(n log n)の計算量がかかりますが、一方でpredicateを適用するのは必ずしも全ての要素とは限りません。ソートした後、predicateを満たす最初の要素が見つかったタイミングで、後続の要素へ適用はされません。「1要素にのみ、predicateを適用する」ということもありえますし、「2要素にのみ、predicateを適用する」こともありえますし、「全ての要素に、predicateを適用する」こともありえます。\u003c/p\u003e\n\n\u003cp\u003e.NET Coreの\u003ccode\u003eOrderBy(keySelector).First(predicate)\u003c/code\u003eの実装、「必ず全ての要素に対して、引数のpredicateを適用する」は違和感を覚える人もいるかもしれません。内部実装とその意図を知っていないと、混乱するでしょう。\u003c/p\u003e\n\n\u003chr\u003e\n\n\u003cp\u003e一方で.NET Frameworkです。\u003c/p\u003e\n\n\u003cp\u003e.NET Frameworkでは、\u003ccode\u003eOrderBy(keySelector).First(predicate)\u003c/code\u003eの実装は、「シンプルにソートしたものの最初の要素を取得」と言う実装でした。ソートした後、predicateを満たす最初の要素が見つかったタイミングで、後続の要素へ適用はされません。「1要素にのみ、predicateを適用する」ということもありえますし、「2要素にのみ、predicateを適用する」こともありえますし、「全ての要素に、predicateを適用する」こともありえます。\u003c/p\u003e\n\n\u003cp\u003eO(n log n)だったわけです。\u003c/p\u003e\n\n\u003chr\u003e\n\n\u003cp\u003eまとめると\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e.NET Coreの\u003ccode\u003eOrderBy(keySelector).First(predicate)\u003c/code\u003eの実装\n\n\u003cul\u003e\n\u003cli\u003eO(n)で処理される\u003c/li\u003e\n\u003cli\u003e必ず全ての要素に引数のpredicateを適用する必要がある\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e.NET Frameworkの\u003ccode\u003eOrderBy(keySelector).First(predicate)\u003c/code\u003eの実装\n\n\u003cul\u003e\n\u003cli\u003eO(n log n)で処理される\u003c/li\u003e\n\u003cli\u003e引数のpredicateを適用されるのは、最初の1つだけかもしれないし、2つかもしれないし、n個すべてかもしれない\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eとなります。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"net-coreの最適化の実装の問題点\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#net-core%E3%81%AE%E6%9C%80%E9%81%A9%E5%8C%96%E3%81%AE%E5%AE%9F%E8%A3%85%E3%81%AE%E5%95%8F%E9%A1%8C%E7%82%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e.NET Coreの最適化の実装の問題点\u003c/h1\u003e\n\n\u003cp\u003e.NET Coreの\u003ccode\u003eOrderBy(keySelector).First(predicate)\u003c/code\u003eコードは最適化がされていて、一見とても良さそうですね。\u003c/p\u003e\n\n\u003cp\u003eしかし、.NET Frameworkから.NET Coreに移行した場合、問題になることがあります。それは「必ず全ての要素に引数のpredicateを適用する必要がある」という点です。\u003c/p\u003e\n\n\u003cp\u003e次のコードは、\u003ca href=\"https://github.com/dotnet/runtime/issues/31554\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/dotnet/runtime/issues/31554\u003c/a\u003e より、コードフォーマットを変えたコードです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// これはLINQ中に副作用のあるメソッドを呼んでいる良くないコード\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eaccount\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eaccounts\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eOrderBy\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUsageCount\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFirstOrDefault\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eTryReserve\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etoken\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこのコード中、\u003ccode\u003eTryReserve\u003c/code\u003eメソッドは副作用のあるメソッドです。そして、このコードを.NET Frameworkから.NET Coreに移行した時に問題が発生します。\u003c/p\u003e\n\n\u003cp\u003e.NET Frameworkの場合：\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003eaccountsのUsageCountが少ない人からTryReserveを試みて、一人でも成功したらそこで処理が終了。\n予約ができるのは一要素もしくはどの要素も予約を行わない。\naccountにはUsageCountが最小の要素が代入される。\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e.NET Coreの場合：\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003eaccounts全ての要素がTryReserveを試みる。\n予約可能な要素が全て予約できてしまう。\naccountにはUsageCountが最小の要素が代入される。\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこのようにこのコードを.NET Frameworkから.NET Coreに移行した時に、「全ての要素が予約を試みてしまい、予約可能な要素が全て予約できてしまう。」という問題が発生しまいますね。\u003c/p\u003e\n\n\u003cp\u003e私としてはこのコードは良くないコードだと思います。「副作用があるような処理をLINQの中で使うべきでない」からです。\u003c/p\u003e\n\n\u003cp\u003e良くないコードではあるのですが、実プロダクトとしてすでにこのようなコードがあり、移行した際にこのような問題が起こる可能性もあるのは確かです。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"破壊的な変更の内容と理由\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%A0%B4%E5%A3%8A%E7%9A%84%E3%81%AA%E5%A4%89%E6%9B%B4%E3%81%AE%E5%86%85%E5%AE%B9%E3%81%A8%E7%90%86%E7%94%B1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e破壊的な変更の内容と理由\u003c/h1\u003e\n\n\u003cp\u003eここでやっと、.NET 5での\u003ccode\u003eOrderBy(keySelector).First(predicate)\u003c/code\u003eの実装の破壊的な変更内容の紹介です。\u003c/p\u003e\n\n\u003cp\u003eNET 5での\u003ccode\u003eOrderBy(keySelector).First(predicate)\u003c/code\u003eは、.NET Core 3.1までの「O(n)で処理され、必ず全ての要素に引数のpredicateを適用する必要がある」実装ではなくなりました。「O(n log n)で処理される、引数のpredicateを適用されるのは、最初の1つだけかもしれないし、2つかもしれないし、n個すべてかもしれない」というシンプルな実装に変わりました。.NET Frameworkと同じ実装方針になったわけです。\u003c/p\u003e\n\n\u003cp\u003e計算量だけで言うと、O(n)から、O(n log n)に増えました。\u003c/p\u003e\n\n\u003cp\u003e「計算量が増えた」というよりも、「工夫していた実装を、シンプルで素直な実装に戻した」とも言えます。\u003c/p\u003e\n\n\u003cp\u003e「\u003ca href=\"https://docs.microsoft.com/en-us/dotnet/core/compatibility/core-libraries/5.0/orderby-firstordefault-complexity-increase\" rel=\"nofollow noopener\" target=\"_blank\"\u003eComplexity of LINQ OrderBy.First{OrDefault} increased\u003c/a\u003e」の理由の説明には、以下のようにあります。\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eThe benefit of invoking the predicate fewer times outweighs a lower overall complexity, so the implementation that was introduced in .NET Core 1.0 was reverted. For more information, see this dotnet/runtime issue.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eなるほど「predicate」の呼び出し回数を少なくするメリットが、全体的な計算量を下げることを上回ったと。詳しくは、こちらの「\u003ca href=\"https://github.com/dotnet/runtime/issues/31554\" rel=\"nofollow noopener\" target=\"_blank\"\u003edotnet/runtimeのissue\u003c/a\u003e」を参考にとあります。先に紹介したコードは、このissueの概要で説明されているコードです。\u003c/p\u003e\n\n\u003cp\u003e.NET 5は、.NET Core 3.1の次期バージョンであると同時に、.NET Framework 4.8の移行先でもあります。もし仮に、「.NET 5の実装が、.NET Core 3.1と同じだったら」を想像しましょう。.NET Framework 4.8から.NET 5に移行した時に、先に紹介した問題が発生してしまう可能性は確かにあります。\u003c/p\u003e\n\n\u003cp\u003eパフォーマンス最適化はなくなるが、.NET 3.1から.NET 5で破壊的な変更を行い、.NET Framework 4.8と同じような挙動にする、というのにも納得できます。\u003c/p\u003e\n\n\u003chr\u003e\n\n\u003cp\u003eこの破壊的変更を行っている「\u003ca href=\"https://github.com/dotnet/runtime/pull/36643\" rel=\"nofollow noopener\" target=\"_blank\"\u003ePull Requestの説明\u003c/a\u003e」は以下の通りです。\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eThe optimization removes the O(N log N) cost of the OrderBy. But it can result in executing the predicate passed to First{OrDefault} more than in .NET Framework; it would always execute it N times, whereas in .NET Framework it would execute it \u0026lt;= N times. Developers have expressed concern about the change, in particular when using a relatively expensive predicate on a relatively short list, or when unadvisedly relying on side-effecting predicates.\u003c/p\u003e\n\n\u003cp\u003eThis optimization has been in .NET Core since 1.0. If the original optimization is considered breaking from .NET Framework, then undoing it is breaking, too.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"自分の意見\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%87%AA%E5%88%86%E3%81%AE%E6%84%8F%E8%A6%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e自分の意見\u003c/h1\u003e\n\n\u003cp\u003e最後に自分の意見をいくつか述べたいと思います\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003eOrderBy(keySelector).First()\u003c/code\u003eで最適化がかかるのは、いいと思う\u003c/li\u003e\n\u003cli\u003eけど↑のコードは自分じゃ書かないし、コードレビューなどの機会では、MinByなどを作って使うように指摘すると思う\u003c/li\u003e\n\u003cli\u003e.NET Coreの\u003ccode\u003eOrderBy(keySelector).First(predicate)\u003c/code\u003eの最適化、あんまり好きじゃない。予測・期待している挙動と違うから\u003c/li\u003e\n\u003cli\u003eこちらも↑のコードは自分じゃ書かないし、コードレビューなどの機会では、Whereと共に、MinByを使うように指摘すると思う\u003c/li\u003e\n\u003cli\u003e副作用のあるコードをLINQで書くな！副作用あるなら、foreachしてくれ！\u003c/li\u003e\n\u003cli\u003e.NET 5は.NET Framework 4.8の移行先でもあるので、結構気を遣うところもあるのかなーと思う\u003c/li\u003e\n\u003cli\u003eパフォーマンスのメリットよりも、予期しにくい挙動でバグを生む方がこわいなー\u003c/li\u003e\n\u003cli\u003e逆に.NET Core 3.1からの破壊的な変更になってしまうという側面もあるよなーとも思う\n\n\u003cul\u003e\n\u003cli\u003eがしかし、全ての要素にpredicateを適用することに依存したコードってよくないよね\u003c/li\u003e\n\u003cli\u003eそれから\u003ccode\u003eOrderBy(keySelector).First()\u003c/code\u003eってそもそもそんなに書く機会ないよね？MinBy作ろ？使お？ね！\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e.NETのコアライブラリ、いい加減MinBy/MaxByいれない？\u003c/li\u003e\n\u003cli\u003eコアライブラリの挙動の破壊的な変更、難しいなー \u003c/li\u003e\n\u003c/ul\u003e\n","createdAt":"2020-12-23T16:24:54Z","elapsedYearsFromLastModifiedAt":0,"encryptedId":"qBiNo/tWGjD8+Qg2X9KmyiJ8lypOr29VHA==--Ywibj2YBZQxWahdN--eJ0bBFzGgvwP+lv1NmiteQ==","isBanned":false,"isDeprecated":false,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2020-12-24T15:06:06Z","likesCount":27,"linkUrl":"https://qiita.com/RyotaMurohoshi/items/3d932647c2fd33b80f70","organization":null,"originalId":1365606,"stockedCount":11,"title":".NET 5におけるOrderBy(keySelector).First(predicate)の計算量が増える破壊的変更と、それから考える.NET 5の立ち位置","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%A0%B4%E5%A3%8A%E7%9A%84%E5%A4%89%E6%9B%B4%E3%81%AE%E6%A6%82%E8%A6%81\"\u003e破壊的変更の概要\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%BB%A5%E5%89%8D%E3%81%AE%E5%AE%9F%E8%A3%85%E3%81%A8%E8%A8%88%E7%AE%97%E9%87%8F\"\u003e以前の実装と計算量\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#net-core%E3%81%AE%E6%9C%80%E9%81%A9%E5%8C%96%E3%81%AE%E5%AE%9F%E8%A3%85%E3%81%AE%E5%95%8F%E9%A1%8C%E7%82%B9\"\u003e.NET Coreの最適化の実装の問題点\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%A0%B4%E5%A3%8A%E7%9A%84%E3%81%AA%E5%A4%89%E6%9B%B4%E3%81%AE%E5%86%85%E5%AE%B9%E3%81%A8%E7%90%86%E7%94%B1\"\u003e破壊的な変更の内容と理由\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E8%87%AA%E5%88%86%E3%81%AE%E6%84%8F%E8%A6%8B\"\u003e自分の意見\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":4685,"uuid":"3d932647c2fd33b80f70","banReason":null,"adventCalendarItem":{"day":25,"calendar":{"name":"C#","urlName":"csharplang","year":2020,"organization":null}},"author":{"encryptedId":"GF+wNWOBx7xXFYjuae2jbzMHxw==--q7ANo4eS2dkZrWDu--ZAxJZu0baIgCSgE/O61Eew==","originalId":4125,"description":"プログラミングが大好きで、 C#が大好きで、 .NETが大好きで、 LINQが大好きで、 JVM言語が大好きで、 ゲームで遊ぶことが大好きで、 ゲーム開発が大好きで、 頑張るのが大好きで、 Unityが大好きだったから...！","facebookUrl":"https://facebook.com/ryota.murohoshi","githubUrl":"https://github.com/RyotaMurohoshi","isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"Ryota Murohoshi","profileImageUrl":"https://qiita-image-store.s3.amazonaws.com/0/4125/profile-images/1502026161","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F4125%2Fprofile-images%2F1502026161?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=ac6cc1a5c7bd2eafbd5fbd1291b8ecfb","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F4125%2Fprofile-images%2F1502026161?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=debc0abd71c258d50474dcf003f262a2","urlName":"RyotaMurohoshi","websiteUrl":"http://mrstar-memo.hatenablog.com/","twitterUrl":"https://twitter.com/RyotaMurohoshi","twitterUrlName":"RyotaMurohoshi","revealedOrganizations":{"edges":[]}},"tags":[{"name":"C#","urlName":"csharp"},{"name":".NET","urlName":".net"},{"name":"LINQ","urlName":"linq"},{"name":".NETFramework","urlName":".netframework"},{"name":".NETCore","urlName":".netcore"}],"followingLikers":{"edges":[]},"comments":{"totalCount":0}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

More than 3 years have passed since last update.ミニゲームを作ってUnityを学ぶ！[ひつじコレクション編]前回はプレイヤーの邪魔をする敵キャラクター（チェイサー）をゲームに登場させて3種類の行動パターンを実装しましたが、思ったより長くなってしまったためコードを読み解いてもらうような解説になってしまいました。そちらは後程スキをみて解説を付け足すとして、今回はチェイサーに対する当たり判定を実装していきます。話が前後しますがチェイサーとの接触時の処理について、プレイヤーがチェイサーと接触した際、あるいは追従しているフォロワーがチェイサーと接触した際にはまずメソッドAを実行し、その数秒後にメソッドBを実行するといった遅延処理の仕組みが必要になります。この遅延処理をUnityで行うにはInvoke()またはコルーチンを利用するのが一般的です。参考: スクリプトの処理の実行タイミングを操作する今回はこちらの参考にさせていただいた記事に習って、簡単に遅延処理が実行できるようMonoBehaviourを拡張します。MonoBehaviourを継承し、遅延処理を行うためのコルーチンを定義したシンプルなクラスです。
このCustomMonoBehaviourを継承したクラスは通常のMonoBehaviourを継承することで利用できる機能に加えて、遅延処理を簡単に導入することができます。MonBehaviour（Unityスクリプトリファレンス）それでは実際にCustomMonoBehaviourを継承してプレイヤーに当たり判定の実装と接触時の処理を追加していきます。遅延処理を行っている部分はOnRoll()の最後の行です。
プレイヤーはチェイサーに接触するとその場で回転を始め、その1秒後にOnDown()を実行します。また回転開始のタイミングで操作不能となり、現段階では事実上のゲームオーバーとなります。続いて、フォロワーがチェイサーと接触した際の処理を実装していきます。チェイサーと接触したフォロワーは自身の接触をPlayerActionに通知します。
PlayerActionは通知を受け取ると、接触したフォロワーとそれより後ろを追従していた全てのフォロワーに対してBlowOff()を実行することで吹き飛ばされるアクションを開始させ、BlowOff()を呼び出されたフォロワーはその3秒後にSleep()を実行することで休眠状態（次のポップアップまで待機する状態）になります。フォロワーとしてウサギさんのアセットを使用している場合は飛び跳ねるアニメーションによってチェイサーとの接触を避けているように見える場合がありますが、AnimatorのApplyRootMotionのチェックを外しているため実際の当たり判定はアニメーションの影響を受けず、常に地面近くに存在しています。次のページに進む
イントロダクションに戻る

この作品はユニティちゃんライセンス条項の元に提供されています



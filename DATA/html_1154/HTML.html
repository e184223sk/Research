<!DOCTYPE html><html><head><meta charset="utf-8" /><title>Xamarin.FormsでAndroid向けTwitterアプリケーションを開発したときに困ったこと ~WebView編~ - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/HexagramNM/items/ccbaf1345c4109e2e626" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="n1PVzSvQv0lIiHYzUlUiEksJDHQPOs6od2RytisTPAF3DzXxccKBAHRlvuUKPnIA04SlDjFAEE2vQmRQwaWawA==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta property="og:type" content="article"><meta property="og:title" content="Xamarin.FormsでAndroid向けTwitterアプリケーションを開発したときに困ったこと ~WebView編~ - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1XR0Z0WVhKcGJpNUdiM0p0Yy1PQnAwRnVaSEp2YVdUbGtKSGpnWkZVZDJsMGRHVnk0NEtpNDRPWDQ0T3E0NEt4NDRPODQ0SzM0NE9uNDRPejQ0S1M2WmFMNTVtNjQ0R1g0NEdmNDRHbzQ0R040NEdyNVp1dzQ0R2o0NEdmNDRHVDQ0R29JSDVYWldKV2FXVjM1N2VvZmcmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT01NCZ0eHQtY2xpcD1lbGxpcHNpcyZ0eHQtYWxpZ249Y2VudGVyJTJDbWlkZGxlJnM9MmQ2M2YxYmY0YzA4OWNkZjhmOWE3OGY1NGM0NWI5ZTY&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RRWhsZUdGbmNtRnRUazAmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT00NSZ0eHQtYWxpZ249cmlnaHQlMkNib3R0b20mcz02MDhmOTE5MGU1Zjg3YzBhMDdlZjJhZTU0YjE3MDVhYw&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=8a2b6a4c2165db1dfd3e1e185805a5a7"><meta property="og:description" content="N.Mです．

最近はAndroid用のアプリケーション，&quot;TLExtension&quot;を作っていました．AndroidでTwitter用のブラウザを見つつ，タブ操作で簡単に今まで作ってきたTwitter用ツールも利用できるアプリケーショ..."><meta content="https://qiita.com/HexagramNM/items/ccbaf1345c4109e2e626" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#,Xamarin.Android,Xamarin.Forms" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 1nzh4zz 38fzdi helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-1nzh4zz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:16px 32px;background-color:#FBE69E;color:rgba(0,0,0,0.87);line-height:1.5;font-weight:600;}@media (max-width:770px){.css-1nzh4zz{padding:16px;}}.css-38fzdi{color:#CA832A;margin-right:4px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-90a83326-6f8c-4a23-b039-05a6cadc4253"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2FHexagramNM%2Fitems%2Fccbaf1345c4109e2e626">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2FHexagramNM%2Fitems%2Fccbaf1345c4109e2e626">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-90a83326-6f8c-4a23-b039-05a6cadc4253">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2020-06-29T20:00:29.000+09:00","dateModified":"2020-07-03T20:18:12.000+09:00","headline":"Xamarin.FormsでAndroid向けTwitterアプリケーションを開発したときに困ったこと ~WebView編~","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1XR0Z0WVhKcGJpNUdiM0p0Yy1PQnAwRnVaSEp2YVdUbGtKSGpnWkZVZDJsMGRHVnk0NEtpNDRPWDQ0T3E0NEt4NDRPODQ0SzM0NE9uNDRPejQ0S1M2WmFMNTVtNjQ0R1g0NEdmNDRHbzQ0R040NEdyNVp1dzQ0R2o0NEdmNDRHVDQ0R29JSDVYWldKV2FXVjM1N2VvZmcmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT01NCZ0eHQtY2xpcD1lbGxpcHNpcyZ0eHQtYWxpZ249Y2VudGVyJTJDbWlkZGxlJnM9MmQ2M2YxYmY0YzA4OWNkZjhmOWE3OGY1NGM0NWI5ZTY\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RRWhsZUdGbmNtRnRUazAmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT00NSZ0eHQtYWxpZ249cmlnaHQlMkNib3R0b20mcz02MDhmOTE5MGU1Zjg3YzBhMDdlZjJhZTU0YjE3MDVhYw\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=8a2b6a4c2165db1dfd3e1e185805a5a7","mainEntityOfPage":"https://qiita.com/HexagramNM/items/ccbaf1345c4109e2e626","author":{"@type":"Person","address":"Saitama, Japan","email":null,"identifier":"HexagramNM","name":"HexagramNM","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fs3-ap-northeast-1.amazonaws.com%2Fqiita-image-store%2F0%2F152791%2F64efa0a9e408c344d22b59e10d7c31cb626a0dd5%2Fx_large.png%3F1603642943?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=6fa692caba26234d279afd0ce8193ce6","url":"https://qiita.com/HexagramNM","description":"「欲しいものは作れるなら作る」をモットーに活動しているプログラマです。主に趣味プロで詰まったことなどを記事にします。","memberOf":[]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://zine.qiita.com/interview/202107-hitachi-3/?utm_source=qiita&amp;utm_medium=header-banner">日立の研究者が、2年間ドイツ人工知能研究センターで学んだこと</a><a target="_blank" id="header_text_message_2" href="https://zine.qiita.com/interview/202107-hitachi-3/?utm_source=qiita&amp;utm_medium=header-banner">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"HexagramNM","type":"items","id":"ccbaf1345c4109e2e626"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"日立の研究者が、2年間ドイツ人工知能研究センターで学んだこと","url":"https://zine.qiita.com/interview/202107-hitachi-3/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"HexagramNM","type":"items","id":"ccbaf1345c4109e2e626"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":0,"pos_id":"header_text_message_1","message":"日立の研究者が、2年間ドイツ人工知能研究センターで学んだこと","url":"https://zine.qiita.com/interview/202107-hitachi-3/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"HexagramNM","type":"items","id":"ccbaf1345c4109e2e626"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":0,"pos_id":"header_text_message_2","message":"日立の研究者が、2年間ドイツ人工知能研究センターで学んだこと","url":"https://zine.qiita.com/interview/202107-hitachi-3/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/HexagramNM/items/ccbaf1345c4109e2e626","location":"/HexagramNM/items/ccbaf1345c4109e2e626","scheme":"https","host":"qiita.com","port":null,"pathname":"/HexagramNM/items/ccbaf1345c4109e2e626","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"7UM1IfrmwUXGQOcvkOdeSjmFuL3R+J7CG0IIgezg/+MFH9UdoPT/DPqtL/nIjA5YoQgRx++CQCfDZB5nBlZZIg==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-8af77e12-e942-47f3-9554-117a376e3c31"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/HexagramNM/items/ccbaf1345c4109e2e626/likers" class="css-1iupg5d">1</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">0</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/ccbaf1345c4109e2e626/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/HexagramNM/items/ccbaf1345c4109e2e626/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/HexagramNM/items/ccbaf1345c4109e2e626/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/HexagramNM/items/ccbaf1345c4109e2e626/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/HexagramNM/items/ccbaf1345c4109e2e626.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-1nzh4zz"><span class="fa fa-fw fa-warning css-38fzdi"></span><p>More than 1 year has passed since last update.</p></div><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/HexagramNM"><img class="css-100alwu eyfquo10" src="https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/152791/64efa0a9e408c344d22b59e10d7c31cb626a0dd5/x_large.png?1603642943" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/HexagramNM" class="css-10ougpm">@<!-- -->HexagramNM</a><div class="css-1ay9vb9"><span><meta content="2020-06-29T11:00:29Z"/><time dateTime="2020-07-03T11:18:12Z" class="css-m19uds">updated at 2020-07-03</time></span></div></div></div></div></div><h1 class="css-cgzq40">Xamarin.FormsでAndroid向けTwitterアプリケーションを開発したときに困ったこと ~WebView編~</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/xamarin.android" class="css-4czcte">Xamarin.Android</a><a href="/tags/xamarin.forms" class="css-4czcte">Xamarin.Forms</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div><p>N.Mです．</p>

<p>最近はAndroid用のアプリケーション，"TLExtension"を作っていました．AndroidでTwitter用のブラウザを見つつ，タブ操作で簡単に今まで作ってきたTwitter用ツールも利用できるアプリケーションです．自分用に作ったので，アプリ自体の公開はしていませんが，ひな型部分のソースコードはGitHubにも公開しました．</p>

<p><a href="https://github.com/HexagramNM/TLExtension" rel="nofollow noopener" target="_blank">TLExtension</a></p>

<p>このアプリはXamarin.Formsを利用して作っているのですが，今回の記事はこれを作る際に困ったこととその解決策をまとめたものとなっております．<br>
（主にAndroidアプリをXamarin.Formsで開発する際に，こんな機能はどう作ればいいのかといった内容になります。）</p>

<p><del>結局，Xamarin.Formsにあるプラットフォーム共通の機能じゃ足りないので，Xamarin.Androidでの実装が必要になるわけですが...</del></p>

<p>長くなってしまったので，2回に分けてお送りします．今回はWebView周りの話です．<br>
（次回は画像や動画などの処理に関する<a href="https://qiita.com/HexagramNM/items/90a0f03e0d3d455d0d40" id="reference-8e41495a05a96ac9fd5f">メディア編</a>です。）</p>

<h1>
<span id="webview内に表示されたhtml取得" class="fragment"></span><a href="#webview%E5%86%85%E3%81%AB%E8%A1%A8%E7%A4%BA%E3%81%95%E3%82%8C%E3%81%9Fhtml%E5%8F%96%E5%BE%97"><i class="fa fa-link"></i></a>WebView内に表示されたHTML取得</h1>

<p>参考：<a href="https://github.com/xamarin/xamarin-forms-samples/tree/master/CustomRenderers/HybridWebView/Droid" rel="nofollow noopener" target="_blank">https://github.com/xamarin/xamarin-forms-samples/tree/master/CustomRenderers/HybridWebView/Droid</a></p>

<p>CoreTweetでREST APIの認証を取得する際に，<a href="https://qiita.com/HexagramNM/items/6cd192cabcb666dafe0b" id="reference-6f9e7d99c2c79175b574">過去の記事</a>でも触れたように，PIN番号の入力を自動化しようとすると，HTMLからPIN番号を抽出し，C#側で使えるようにする必要があります．また，Twitter内でのページ遷移（ホーム画面から個々のツイート画面への遷移など）では，WebView.Sourceに格納されるURLが変化しないためか，Navigatingなどのイベントも反応しません．TwitterのページのHTMLソースにはそのページのURLがあるので，これを取得すれば，遷移したかどうかがわかります．こんな感じで，なにかとC#側でHTMLを取得する必要があります．これを実現するには以下のような手順でjavascriptとC#を連携できるようにする必要があります．</p>

<p>① <code>Xamarin.Forms.WebView</code>クラスを継承して，自作の<code>WebView</code>クラスを作ります．（自分のリポジトリでは，<code>TLExtensionWebView</code>というクラス名にしています．）</p>

<p>② Android側のプロジェクトで<code>WebViewRenderer</code>クラスを作成します．（<code>Xamarin.Forms.Platform.Android.WebViewRenderer</code>，自分のリポジトリでは<code>TLExtensionWebViweRenderer</code>というクラス名にしています．）この<code>WebViewRenderer</code>と1で作った<code>WebView</code>を以下のようにして連携させます．このように連携すると，<code>WebViewRender.Element</code>に連携した<code>WebView</code>が格納されます．</p>

<div class="code-frame" data-lang="C#"><div class="highlight"><pre><code><span class="c1">//以下の文章をWebViewRenderクラスを宣言しているところの直前に記述します．</span>
<span class="p">[</span><span class="n">assembly</span><span class="p">:</span> <span class="nf">ExportRenderer</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">TLExtensionWebView</span><span class="p">),</span> <span class="k">typeof</span><span class="p">(</span><span class="n">TLExtensionWebViewRenderer</span><span class="p">))]</span>
</code></pre></div></div>

<p>③ javascriptから呼び出せるメソッドを格納した<code>JSBridge</code>クラス（<code>Java.Lang.Object</code>を継承）を作ります．コード自体はリポジトリ内の<code>JSBridge.cs</code>を参考にしてほしいですが，クラス内のメソッドの前に以下のように記述することで，javascript内でC#のそのメソッドを呼び出せるようになります．<code>Export</code>の中に書いた文字列が，javascript内でのメソッド名になります．</p>

<div class="code-frame" data-lang="C#"><div class="highlight"><pre><code><span class="c1">//以下の文章をjavascriptで呼び出したい，JSBridgeのメソッドの直前に記述します．</span>
<span class="p">[</span><span class="n">JavascriptInterface</span><span class="p">]</span>
<span class="p">[</span><span class="nf">Export</span><span class="p">(</span><span class="s">"invokeAction"</span><span class="p">)]</span>
</code></pre></div></div>

<p>④ <code>WebViewRenderer</code>クラスの<code>OnElementChanged</code>メソッドに以下を追加します．</p>

<div class="code-frame" data-lang="C#"><div class="highlight"><pre><code><span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">OldElement</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">Control</span><span class="p">.</span><span class="nf">RemoveJavascriptInterface</span><span class="p">(</span><span class="s">"jsBridge"</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">NewElement</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
<span class="p">{</span>    
    <span class="n">Control</span><span class="p">.</span><span class="nf">AddJavascriptInterface</span><span class="p">(</span><span class="k">new</span> <span class="nf">JSBridge</span><span class="p">(</span><span class="k">this</span><span class="p">),</span> <span class="s">"jsBridge"</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>⑤ これで，<code>Xamarin.Forms.WebView</code>の<code>Eval</code>メソッドや<code>Android.Webkit.WebView</code>の<code>EvaluateJavascript</code>メソッドに<code>javascript: jsBridge.invokeAction();</code>を渡すと，<code>JSBridge</code>クラスのメソッドが呼び出されます（<code>jsBridge</code>は④の<code>AddJavascriptInterface</code>で登録した名前，<code>invokeAction</code>は③の<code>Export</code>に登録した名前にです．）．<code>JSBridge</code>クラスのメソッドの引数として文字列を渡せるようにしておけば，<code>javascript: jsBridge.invokeAction(document.documentElement.outerHTML);</code>で，そのページのHTMLをC#に取得することができます．</p>

<p>⑥ <code>Xamarin.Forms</code>の<code>WebView</code>でこの取得したHTMLを使用するならば，<code>WebViewRenderer</code>で<code>JSBridge</code>からデータを受け取り，<code>WebViewRenderer.Element</code>にそのデータを渡します．</p>

<h1>
<span id="動画の全画面表示" class="fragment"></span><a href="#%E5%8B%95%E7%94%BB%E3%81%AE%E5%85%A8%E7%94%BB%E9%9D%A2%E8%A1%A8%E7%A4%BA"><i class="fa fa-link"></i></a>動画の全画面表示</h1>

<p>参考：<a href="https://github.com/mhaggag/XFAndroidFullScreenWebView" rel="nofollow noopener" target="_blank">https://github.com/mhaggag/XFAndroidFullScreenWebView</a></p>

<p>デフォルトだと，Twitterの動画で全画面表示を押しても全画面になりません（全画面表示になったという通知が<code>Xamarin.Forms</code>側までいかないためだと思っています）．全画面表示になったかは，<code>Xamarin.Forms.Platform.Android.FormsWebChromeClient</code>クラスを使えば検知できるので，ここから<code>Xamarin.Forms</code>側まで通知を伝えていきます．</p>

<p>① フルスクリーンに入った時のイベント用の<code>EventArgs</code>を作ります．（自分のリポジトリでは<code>TLExtensionWebChromeClient.cs</code>にあります．）</p>

<div class="code-frame" data-lang="C#"><div class="highlight"><pre><code><span class="k">public</span> <span class="k">class</span> <span class="nc">EnterFullScreenRequestedEventArgs</span> <span class="p">:</span> <span class="n">EventArgs</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="n">View</span> <span class="n">View</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="nf">EnterFullScreenRequestedEventArgs</span><span class="p">(</span><span class="n">View</span> <span class="n">view</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">View</span> <span class="p">=</span> <span class="n">view</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>② <code>FormsWebChromeClient</code>クラスを作ります（自分のリポジトリでは<code>TLExtensionWebChromeClient</code>）．全画面表示になると<code>OnShowCustomView</code>が，全画面表示が終了すると<code>OnHideCustomView</code>が呼び出されます．</p>

<div class="code-frame" data-lang="C#"><div class="highlight"><pre><code><span class="k">public</span> <span class="k">class</span> <span class="nc">TLExtensionWebChromeClient</span> <span class="p">:</span> <span class="n">FormsWebChromeClient</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">event</span> <span class="n">EventHandler</span><span class="p">&lt;</span><span class="n">EnterFullScreenRequestedEventArgs</span><span class="p">&gt;</span> <span class="n">EnterFullScreenRequested</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">event</span> <span class="n">EventHandler</span> <span class="n">ExitFullScreenRequested</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">OnHideCustomView</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">ExitFullScreenRequested</span><span class="p">?.</span><span class="nf">Invoke</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">EventArgs</span><span class="p">.</span><span class="n">Empty</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">OnShowCustomView</span><span class="p">(</span><span class="n">View</span> <span class="n">view</span><span class="p">,</span> <span class="n">ICustomViewCallback</span> <span class="n">callback</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">EnterFullScreenRequested</span><span class="p">?.</span><span class="nf">Invoke</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="k">new</span> <span class="nf">EnterFullScreenRequestedEventArgs</span><span class="p">(</span><span class="n">view</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>③ <code>Xamarin.Forms</code>側の<code>WebView</code>クラスに以下のフルスクリーンになった時，解除されたときのアクションを追加します．</p>

<div class="code-frame" data-lang="C#"><div class="highlight"><pre><code><span class="k">public</span> <span class="k">static</span> <span class="k">readonly</span> <span class="n">BindableProperty</span> <span class="n">EnterFullScreenCmmandProperty</span> <span class="p">=</span>
            <span class="n">BindableProperty</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span>
            <span class="n">propertyName</span><span class="p">:</span> <span class="s">"EnterFullScreenCommand"</span><span class="p">,</span>
            <span class="n">returnType</span><span class="p">:</span> <span class="k">typeof</span><span class="p">(</span><span class="n">ICommand</span><span class="p">),</span>
            <span class="n">declaringType</span><span class="p">:</span> <span class="k">typeof</span><span class="p">(</span><span class="n">TLExtensionWebView</span><span class="p">),</span>
            <span class="n">defaultValue</span><span class="p">:</span> <span class="k">new</span> <span class="nf">Command</span><span class="p">(</span><span class="k">async</span> <span class="p">(</span><span class="n">view</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="k">await</span> <span class="nf">DefaultEnterAsync</span><span class="p">((</span><span class="n">View</span><span class="p">)</span><span class="n">view</span><span class="p">))</span>
            <span class="p">);</span>

<span class="k">public</span> <span class="n">ICommand</span> <span class="n">EnterFullScreenCommand</span>
<span class="p">{</span>
    <span class="k">get</span> <span class="p">=&gt;</span> <span class="p">(</span><span class="n">ICommand</span><span class="p">)</span><span class="nf">GetValue</span><span class="p">(</span><span class="n">EnterFullScreenCmmandProperty</span><span class="p">);</span>
    <span class="k">set</span> <span class="p">=&gt;</span> <span class="nf">SetValue</span><span class="p">(</span><span class="n">EnterFullScreenCmmandProperty</span><span class="p">,</span> <span class="k">value</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">static</span> <span class="k">readonly</span> <span class="n">BindableProperty</span> <span class="n">ExitFullScreenCmmandProperty</span> <span class="p">=</span>
            <span class="n">BindableProperty</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span>
            <span class="n">propertyName</span><span class="p">:</span> <span class="s">"ExitFullScreenCommand"</span><span class="p">,</span>
            <span class="n">returnType</span><span class="p">:</span> <span class="k">typeof</span><span class="p">(</span><span class="n">ICommand</span><span class="p">),</span>
            <span class="n">declaringType</span><span class="p">:</span> <span class="k">typeof</span><span class="p">(</span><span class="n">TLExtensionWebView</span><span class="p">),</span>
            <span class="n">defaultValue</span><span class="p">:</span> <span class="k">new</span> <span class="nf">Command</span><span class="p">(</span><span class="k">async</span> <span class="p">(</span><span class="n">view</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="k">await</span> <span class="nf">DefaultExitAsync</span><span class="p">())</span>
            <span class="p">);</span>

<span class="k">public</span> <span class="n">ICommand</span> <span class="n">ExitFullScreenCommand</span>
<span class="p">{</span>
    <span class="k">get</span> <span class="p">=&gt;</span> <span class="p">(</span><span class="n">ICommand</span><span class="p">)</span><span class="nf">GetValue</span><span class="p">(</span><span class="n">ExitFullScreenCmmandProperty</span><span class="p">);</span>
    <span class="k">set</span> <span class="p">=&gt;</span> <span class="nf">SetValue</span><span class="p">(</span><span class="n">ExitFullScreenCmmandProperty</span><span class="p">,</span> <span class="k">value</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">//フルスクリーンを実現するためのメソッド</span>
<span class="k">private</span> <span class="k">static</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">DefaultEnterAsync</span><span class="p">(</span><span class="n">View</span> <span class="n">view</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">page</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ContentPage</span>
    <span class="p">{</span>
        <span class="n">Content</span> <span class="p">=</span> <span class="n">view</span>
    <span class="p">};</span>
    <span class="k">await</span> <span class="n">Application</span><span class="p">.</span><span class="n">Current</span><span class="p">.</span><span class="n">MainPage</span><span class="p">.</span><span class="n">Navigation</span><span class="p">.</span><span class="nf">PushModalAsync</span><span class="p">(</span><span class="n">page</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">private</span> <span class="k">static</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">DefaultExitAsync</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">await</span> <span class="n">Application</span><span class="p">.</span><span class="n">Current</span><span class="p">.</span><span class="n">MainPage</span><span class="p">.</span><span class="n">Navigation</span><span class="p">.</span><span class="nf">PopModalAsync</span><span class="p">();</span>
<span class="p">}</span>
<span class="c1">//フルスクリーンを実現するためのメソッド　ここまで</span>
</code></pre></div></div>

<p>④ <code>WebViewRenderer</code>クラスに②で作った<code>FormsWebChromeClient</code>を登録します．<code>FormsWebChromeClient</code>で全画面表示の通知が発生したら，③で実装した<code>DefaultEnterAsync</code>や<code>DefaultExitAsync</code>が呼び出されるように，処理を繋げます．（以下はフルスクリーン対応に必要な部分のみ抜き出しています．）</p>

<div class="code-frame" data-lang="C#"><div class="highlight"><pre><code><span class="k">public</span> <span class="k">class</span> <span class="nc">TLExtensionWebViewRenderer</span> <span class="p">:</span> <span class="n">WebViewRenderer</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="n">TLExtensionWebView</span> <span class="n">_webView</span><span class="p">;</span>
    <span class="k">private</span> <span class="n">TLExtensionWebChromeClient</span> <span class="n">webClient</span><span class="p">;</span>

    <span class="k">public</span> <span class="nf">TLExtensionWebViewRenderer</span><span class="p">(</span><span class="n">Context</span> <span class="n">context</span><span class="p">)</span> <span class="p">:</span> <span class="k">base</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">webClient</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">TLExtensionWebChromeClient</span><span class="p">();</span>
        <span class="n">webClient</span><span class="p">.</span><span class="n">EnterFullScreenRequested</span> <span class="p">+=</span> <span class="n">OnEnterFullScreenRequested</span><span class="p">;</span>
        <span class="n">webClient</span><span class="p">.</span><span class="n">ExitFullScreenRequested</span> <span class="p">+=</span> <span class="n">OnExitFullScreenRequested</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">OnElementChanged</span><span class="p">(</span><span class="n">ElementChangedEventArgs</span><span class="p">&lt;</span><span class="n">Xamarin</span><span class="p">.</span><span class="n">Forms</span><span class="p">.</span><span class="n">WebView</span><span class="p">&gt;</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
        <span class="k">base</span><span class="p">.</span><span class="nf">OnElementChanged</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">NewElement</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Control</span><span class="p">.</span><span class="nf">SetWebChromeClient</span><span class="p">(</span><span class="n">webClient</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">_webView</span> <span class="p">=</span> <span class="p">(</span><span class="n">TLExtensionWebView</span><span class="p">)</span><span class="n">e</span><span class="p">.</span><span class="n">NewElement</span><span class="p">;</span>            
    <span class="p">}</span>

    <span class="c1">//フルスクリーンにするための追加メソッド</span>
    <span class="k">protected</span> <span class="k">override</span> <span class="n">FormsWebChromeClient</span> <span class="nf">GetFormsWebChromeClient</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">webClient</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">void</span> <span class="nf">OnEnterFullScreenRequested</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">EnterFullScreenRequestedEventArgs</span> <span class="n">eventArgs</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">_webView</span><span class="p">.</span><span class="n">EnterFullScreenCommand</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">&amp;&amp;</span> <span class="n">_webView</span><span class="p">.</span><span class="n">EnterFullScreenCommand</span><span class="p">.</span><span class="nf">CanExecute</span><span class="p">(</span><span class="k">null</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">_webView</span><span class="p">.</span><span class="n">EnterFullScreenCommand</span><span class="p">.</span><span class="nf">Execute</span><span class="p">(</span><span class="n">eventArgs</span><span class="p">.</span><span class="n">View</span><span class="p">.</span><span class="nf">ToView</span><span class="p">());</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">void</span> <span class="nf">OnExitFullScreenRequested</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">EventArgs</span> <span class="n">eventArgs</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">_webView</span><span class="p">.</span><span class="n">ExitFullScreenCommand</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">&amp;&amp;</span> <span class="n">_webView</span><span class="p">.</span><span class="n">ExitFullScreenCommand</span><span class="p">.</span><span class="nf">CanExecute</span><span class="p">(</span><span class="k">null</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">_webView</span><span class="p">.</span><span class="n">ExitFullScreenCommand</span><span class="p">.</span><span class="nf">Execute</span><span class="p">(</span><span class="k">null</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>全画面表示になるときは</p>

<p><code>TLExtensionWebChromeClient.OnShowCustomView</code>→<code>TLExtensionWebViewRenderer.OnEnterFullScreenRequsted</code>→<code>TLExtensionWebView.DefaultEnterAsync</code>の順で</p>

<p>全画面表示が解除されるときは</p>

<p><code>TLExtensionWebChromeClient.OnHideCustomView</code>→<code>TLExtensionWebViewRenderer.OnExitFullScreenRequsted</code>→<code>TLExtensionWebView.DefaultExitAsync</code>の順で</p>

<p>呼び出され，<code>Xamarin.Forms</code>側まで通知が行くようになり，全画面表示に対応できるようになります．</p>

<h1>
<span id="ソフトウェアキーボード表示時のwebviewの縮小" class="fragment"></span><a href="#%E3%82%BD%E3%83%95%E3%83%88%E3%82%A6%E3%82%A7%E3%82%A2%E3%82%AD%E3%83%BC%E3%83%9C%E3%83%BC%E3%83%89%E8%A1%A8%E7%A4%BA%E6%99%82%E3%81%AEwebview%E3%81%AE%E7%B8%AE%E5%B0%8F"><i class="fa fa-link"></i></a>ソフトウェアキーボード表示時のWebViewの縮小</h1>

<p>参考：<a href="https://qiita.com/amay077/items/6fcdec829a96bc604532" id="reference-0b0a48b21fd86dfc047f">https://qiita.com/amay077/items/6fcdec829a96bc604532</a></p>

<p>デフォルトのWebViewでTwitterのリプライをしようとすると，ソフトウェアキーボードが邪魔で自分が書いているツイートが見えなくなります．</p>

<p>ひとまず，<code>Xamarin.Android</code>側の<code>MainActivity</code>の<code>OnCreate</code>メソッドに以下を入れれば解決します．</p>

<div class="code-frame" data-lang="C#"><div class="highlight"><pre><code><span class="c1">//appにはMainActivityでロードするAppクラスのオブジェクトを入れておく．</span>

<span class="n">app</span><span class="p">.</span><span class="n">On</span><span class="p">&lt;</span><span class="n">Xamarin</span><span class="p">.</span><span class="n">Forms</span><span class="p">.</span><span class="n">PlatformConfiguration</span><span class="p">.</span><span class="n">Android</span><span class="p">&gt;().</span>
    <span class="nf">UseWindowSoftInputModeAdjust</span><span class="p">(</span><span class="n">WindowSoftInputModeAdjust</span><span class="p">.</span><span class="n">Resize</span><span class="p">);</span>
</code></pre></div></div>

<p>しかし，検索で文字を打ち，サジェストを選択したときに，キーボードは閉じるがWebViewが縮んだままになるケースがありました．この場合は後述するリロードに，いったんWebViewを非表示にしてから，表示する処理を加えると，1,2回のリロードでもとに戻るようになりました．（自分用のアプリなので，ひとまずこれで妥協．）</p>

<h1>
<span id="twitter外のページに遷移したときなどにchromeなどの別ブラウザで開く" class="fragment"></span><a href="#twitter%E5%A4%96%E3%81%AE%E3%83%9A%E3%83%BC%E3%82%B8%E3%81%AB%E9%81%B7%E7%A7%BB%E3%81%97%E3%81%9F%E3%81%A8%E3%81%8D%E3%81%AA%E3%81%A9%E3%81%ABchrome%E3%81%AA%E3%81%A9%E3%81%AE%E5%88%A5%E3%83%96%E3%83%A9%E3%82%A6%E3%82%B6%E3%81%A7%E9%96%8B%E3%81%8F"><i class="fa fa-link"></i></a>Twitter外のページに遷移したときなどに，Chromeなどの別ブラウザで開く</h1>

<p>参考：<a href="https://itblogdsi.blog.fc2.com/blog-entry-171.html" rel="nofollow noopener" target="_blank">https://itblogdsi.blog.fc2.com/blog-entry-171.html</a></p>

<p><code>WebView</code>で遷移する際に，Chromeなどの別ブラウザで開く際には，<code>Xamarin.Android</code>側で別ブラウザを開くためのIntentを呼び出す必要があるみたいです．上記の記事が分かりやすいので，詳細はそちらをご覧ください．</p>

<p><code>Xamarin.Android</code>側の<code>OnPageStarted</code>で，遷移開始時に処理をする場合は，<code>OnPageStarted</code>は2回呼ばれることがあります．最初の<code>OnPageStarted</code>でブラウザを開き，<code>OnPageFinished</code>が呼ばれるまではブラウザを開かないようにする必要もあるようです．（参考：<a href="https://qiita.com/kikuchy/items/d0f5599a883e5e9350df" id="reference-b421dcdcefecfd77e68c">https://qiita.com/kikuchy/items/d0f5599a883e5e9350df</a>）</p>

<p>また，ページ遷移する際に<code>WebView</code>側もページ遷移しているので，<code>WebView.GoBack()</code>で戻らないと，遷移先のページが<code>WebView</code>に表示されたままになってしまいます．</p>

<h1>
<span id="webviewへのjavascript実行" class="fragment"></span><a href="#webview%E3%81%B8%E3%81%AEjavascript%E5%AE%9F%E8%A1%8C"><i class="fa fa-link"></i></a>WebViewへのjavascript実行</h1>

<p><code>WebView.Eval</code>でjavascriptのスクリプトを入れれば，実行できますが，どうやら1つの文しか処理できないようです．複数文を処理する場合は，それらを1つの関数にまとめて一度<code>WebView.Eval</code>で登録した後，2回目の<code>WebView.Eval</code>でその関数を呼び出す必要があるみたいです．</p>

<p>また，HTMLが更新されると登録されていた関数も消えてしまうのと，Twitterではページ表示後もHTMLの更新が頻繁に発生するため，javascriptの関数を使用するタイミングで，その都度<code>WebView.Eval</code>で関数を登録する必要があります．</p>

<h1>
<span id="webviewのリロード" class="fragment"></span><a href="#webview%E3%81%AE%E3%83%AA%E3%83%AD%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>WebViewのリロード</h1>

<p>最近の<code>Xamarin.Forms.WebView</code>には<code>reload</code>メソッドがあるみたいですが，自分が使用していた<code>Xamarin.Forms</code>が古かったためか（バージョンは3.0.0.561731），<code>reload</code>メソッドはありませんでした．</p>

<p>この場合は，<code>WebView</code>と連携している<code>WebViewRenderer</code>の<code>Control.Reload()</code>を呼ぶ必要があります．リロードボタンを作る際は<code>Xamarin.Forms.WebView</code>側に<code>Action</code>型の変数を用意しておき，<code>WebViewRenderer</code>でその変数に<code>Control.Reload()</code>を呼ぶアクションを登録する必要があります．リロードボタンのイベントで登録したアクションを発動します．</p>

<div class="code-frame" data-lang="C#"><div class="highlight"><pre><code><span class="c1">//WebViewRednererのOnElementChanged内</span>
<span class="c1">//reloadActionはWebView側の変数</span>

<span class="n">_webView</span> <span class="p">=</span> <span class="p">(</span><span class="n">TLExtensionWebView</span><span class="p">)</span><span class="n">e</span><span class="p">.</span><span class="n">NewElement</span><span class="p">;</span>
<span class="n">_webView</span><span class="p">.</span><span class="n">reloadAction</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Action</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="n">Control</span><span class="p">.</span><span class="nf">Reload</span><span class="p">();</span> <span class="p">});</span>
</code></pre></div></div>

<h1>
<span id="webviewの履歴削除" class="fragment"></span><a href="#webview%E3%81%AE%E5%B1%A5%E6%AD%B4%E5%89%8A%E9%99%A4"><i class="fa fa-link"></i></a>WebViewの履歴削除</h1>

<p>REST APIの認証が完了してから，認証ページに戻らないように，WebViewの履歴を消す処理も実装しました．しかし，履歴削除のメソッドは現在の<code>Xamarin.Forms.WebView</code>にも内容です．リロードの時と同じように，<code>WebView</code>と連携している<code>WebViewRenderer</code>の<code>Control.ClearHistory()</code>を呼ぶ必要があります．</p>

<h1>
<span id="おまけtabbedpageのスライド禁止" class="fragment"></span><a href="#%E3%81%8A%E3%81%BE%E3%81%91tabbedpage%E3%81%AE%E3%82%B9%E3%83%A9%E3%82%A4%E3%83%89%E7%A6%81%E6%AD%A2"><i class="fa fa-link"></i></a>（おまけ）TabbedPageのスライド禁止</h1>

<p>Twitterでは，画像表示時にその画像が複数枚ある場合は，横スライドで画像を切り替えます．<code>Xamarin.Forms.TabbedPage</code>を使っている場合，<code>TabbedPage</code>のタブ切替えのための横スライドと重なり，デフォルトだと正常に画像を切り替えることができなくなります．</p>

<p><code>TabbedPage</code>の横スライドによるタブ切替えを禁止するには，以下を呼び出します．</p>

<div class="code-frame" data-lang="C#"><div class="highlight"><pre><code><span class="c1">//thisTabbedPageはTabbedPageのオブジェクト</span>
<span class="c1">//falseをtrueにすると，スライドによるタブ切替えができるようになる．</span>

<span class="n">thisTabbedPage</span><span class="p">.</span><span class="n">On</span><span class="p">&lt;</span><span class="n">Xamarin</span><span class="p">.</span><span class="n">Forms</span><span class="p">.</span><span class="n">PlatformConfiguration</span><span class="p">.</span><span class="n">Android</span><span class="p">&gt;().</span><span class="nf">SetIsSwipePagingEnabled</span><span class="p">(</span><span class="k">false</span><span class="p">);</span>

</code></pre></div></div>

<h1>
<span id="まとめ" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>まとめ</h1>

<p><code>Xamarin.Forms</code>で開発してても，<code>WebView</code>に少し複雑な機能を追加しようとするとAndroid側の実装が必要になってしまうようです．<code>Xamarin.Forms.WebView</code>と連携している<code>Xamarin.Forms.Platform.Android.WebViewRenderer</code>から，Android固有の実装を追加する場合が多いので，<code>webView</code>を用いるAndroidアプリケーションを開発する場合は，この<code>WebViewRenderer</code>にお世話になる機会も多くなるかと思います．</p>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2FHexagramNM%2Fitems%2Fccbaf1345c4109e2e626&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2FHexagramNM%2Fitems%2Fccbaf1345c4109e2e626&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/HexagramNM/items/ccbaf1345c4109e2e626/likers" class="css-1iupg5d">1</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">0</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/ccbaf1345c4109e2e626/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/HexagramNM/items/ccbaf1345c4109e2e626/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/HexagramNM/items/ccbaf1345c4109e2e626/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/HexagramNM/items/ccbaf1345c4109e2e626/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/HexagramNM/items/ccbaf1345c4109e2e626.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-8af77e12-e942-47f3-9554-117a376e3c31">{"authorAnalyticsTrackingId":null,"organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-d7b8849f-1a04-4664-b73f-196d8d24a314"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-d7b8849f-1a04-4664-b73f-196d8d24a314">{}</script>
      
<div id="LoginModal-react-component-77ef8b36-b13e-4aeb-a858-d9279b523c94"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-77ef8b36-b13e-4aeb-a858-d9279b523c94">{}</script>
      
<div id="StockModal-react-component-0bae2fa8-b2d3-450f-b196-349500e9aa4d"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-0bae2fa8-b2d3-450f-b196-349500e9aa4d">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;OYu6cExrgOSDbYhfWnrzqLqehMrDP48XkGJ9D8lS0CnR11pMFnm+rb+AQIkCEaO6IhMtsP1FUfJIRGvpI+R26A==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\u003cp\u003eN.Mです．\u003c/p\u003e\n\n\u003cp\u003e最近はAndroid用のアプリケーション，\"TLExtension\"を作っていました．AndroidでTwitter用のブラウザを見つつ，タブ操作で簡単に今まで作ってきたTwitter用ツールも利用できるアプリケーションです．自分用に作ったので，アプリ自体の公開はしていませんが，ひな型部分のソースコードはGitHubにも公開しました．\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://github.com/HexagramNM/TLExtension\" rel=\"nofollow noopener\" target=\"_blank\"\u003eTLExtension\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eこのアプリはXamarin.Formsを利用して作っているのですが，今回の記事はこれを作る際に困ったこととその解決策をまとめたものとなっております．\u003cbr\u003e\n（主にAndroidアプリをXamarin.Formsで開発する際に，こんな機能はどう作ればいいのかといった内容になります。）\u003c/p\u003e\n\n\u003cp\u003e\u003cdel\u003e結局，Xamarin.Formsにあるプラットフォーム共通の機能じゃ足りないので，Xamarin.Androidでの実装が必要になるわけですが...\u003c/del\u003e\u003c/p\u003e\n\n\u003cp\u003e長くなってしまったので，2回に分けてお送りします．今回はWebView周りの話です．\u003cbr\u003e\n（次回は画像や動画などの処理に関する\u003ca href=\"https://qiita.com/HexagramNM/items/90a0f03e0d3d455d0d40\" id=\"reference-8e41495a05a96ac9fd5f\"\u003eメディア編\u003c/a\u003eです。）\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"webview内に表示されたhtml取得\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#webview%E5%86%85%E3%81%AB%E8%A1%A8%E7%A4%BA%E3%81%95%E3%82%8C%E3%81%9Fhtml%E5%8F%96%E5%BE%97\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eWebView内に表示されたHTML取得\u003c/h1\u003e\n\n\u003cp\u003e参考：\u003ca href=\"https://github.com/xamarin/xamarin-forms-samples/tree/master/CustomRenderers/HybridWebView/Droid\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/xamarin/xamarin-forms-samples/tree/master/CustomRenderers/HybridWebView/Droid\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eCoreTweetでREST APIの認証を取得する際に，\u003ca href=\"https://qiita.com/HexagramNM/items/6cd192cabcb666dafe0b\" id=\"reference-6f9e7d99c2c79175b574\"\u003e過去の記事\u003c/a\u003eでも触れたように，PIN番号の入力を自動化しようとすると，HTMLからPIN番号を抽出し，C#側で使えるようにする必要があります．また，Twitter内でのページ遷移（ホーム画面から個々のツイート画面への遷移など）では，WebView.Sourceに格納されるURLが変化しないためか，Navigatingなどのイベントも反応しません．TwitterのページのHTMLソースにはそのページのURLがあるので，これを取得すれば，遷移したかどうかがわかります．こんな感じで，なにかとC#側でHTMLを取得する必要があります．これを実現するには以下のような手順でjavascriptとC#を連携できるようにする必要があります．\u003c/p\u003e\n\n\u003cp\u003e① \u003ccode\u003eXamarin.Forms.WebView\u003c/code\u003eクラスを継承して，自作の\u003ccode\u003eWebView\u003c/code\u003eクラスを作ります．（自分のリポジトリでは，\u003ccode\u003eTLExtensionWebView\u003c/code\u003eというクラス名にしています．）\u003c/p\u003e\n\n\u003cp\u003e② Android側のプロジェクトで\u003ccode\u003eWebViewRenderer\u003c/code\u003eクラスを作成します．（\u003ccode\u003eXamarin.Forms.Platform.Android.WebViewRenderer\u003c/code\u003e，自分のリポジトリでは\u003ccode\u003eTLExtensionWebViweRenderer\u003c/code\u003eというクラス名にしています．）この\u003ccode\u003eWebViewRenderer\u003c/code\u003eと1で作った\u003ccode\u003eWebView\u003c/code\u003eを以下のようにして連携させます．このように連携すると，\u003ccode\u003eWebViewRender.Element\u003c/code\u003eに連携した\u003ccode\u003eWebView\u003c/code\u003eが格納されます．\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e//以下の文章をWebViewRenderクラスを宣言しているところの直前に記述します．\u003c/span\u003e\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eassembly\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nf\"\u003eExportRenderer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eTLExtensionWebView\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eTLExtensionWebViewRenderer\u003c/span\u003e\u003cspan class=\"p\"\u003e))]\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e③ javascriptから呼び出せるメソッドを格納した\u003ccode\u003eJSBridge\u003c/code\u003eクラス（\u003ccode\u003eJava.Lang.Object\u003c/code\u003eを継承）を作ります．コード自体はリポジトリ内の\u003ccode\u003eJSBridge.cs\u003c/code\u003eを参考にしてほしいですが，クラス内のメソッドの前に以下のように記述することで，javascript内でC#のそのメソッドを呼び出せるようになります．\u003ccode\u003eExport\u003c/code\u003eの中に書いた文字列が，javascript内でのメソッド名になります．\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e//以下の文章をjavascriptで呼び出したい，JSBridgeのメソッドの直前に記述します．\u003c/span\u003e\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eJavascriptInterface\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eExport\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"invokeAction\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e④ \u003ccode\u003eWebViewRenderer\u003c/code\u003eクラスの\u003ccode\u003eOnElementChanged\u003c/code\u003eメソッドに以下を追加します．\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eOldElement\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eControl\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRemoveJavascriptInterface\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"jsBridge\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNewElement\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e    \n    \u003cspan class=\"n\"\u003eControl\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAddJavascriptInterface\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eJSBridge\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"s\"\u003e\"jsBridge\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e⑤ これで，\u003ccode\u003eXamarin.Forms.WebView\u003c/code\u003eの\u003ccode\u003eEval\u003c/code\u003eメソッドや\u003ccode\u003eAndroid.Webkit.WebView\u003c/code\u003eの\u003ccode\u003eEvaluateJavascript\u003c/code\u003eメソッドに\u003ccode\u003ejavascript: jsBridge.invokeAction();\u003c/code\u003eを渡すと，\u003ccode\u003eJSBridge\u003c/code\u003eクラスのメソッドが呼び出されます（\u003ccode\u003ejsBridge\u003c/code\u003eは④の\u003ccode\u003eAddJavascriptInterface\u003c/code\u003eで登録した名前，\u003ccode\u003einvokeAction\u003c/code\u003eは③の\u003ccode\u003eExport\u003c/code\u003eに登録した名前にです．）．\u003ccode\u003eJSBridge\u003c/code\u003eクラスのメソッドの引数として文字列を渡せるようにしておけば，\u003ccode\u003ejavascript: jsBridge.invokeAction(document.documentElement.outerHTML);\u003c/code\u003eで，そのページのHTMLをC#に取得することができます．\u003c/p\u003e\n\n\u003cp\u003e⑥ \u003ccode\u003eXamarin.Forms\u003c/code\u003eの\u003ccode\u003eWebView\u003c/code\u003eでこの取得したHTMLを使用するならば，\u003ccode\u003eWebViewRenderer\u003c/code\u003eで\u003ccode\u003eJSBridge\u003c/code\u003eからデータを受け取り，\u003ccode\u003eWebViewRenderer.Element\u003c/code\u003eにそのデータを渡します．\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"動画の全画面表示\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8B%95%E7%94%BB%E3%81%AE%E5%85%A8%E7%94%BB%E9%9D%A2%E8%A1%A8%E7%A4%BA\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e動画の全画面表示\u003c/h1\u003e\n\n\u003cp\u003e参考：\u003ca href=\"https://github.com/mhaggag/XFAndroidFullScreenWebView\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/mhaggag/XFAndroidFullScreenWebView\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eデフォルトだと，Twitterの動画で全画面表示を押しても全画面になりません（全画面表示になったという通知が\u003ccode\u003eXamarin.Forms\u003c/code\u003e側までいかないためだと思っています）．全画面表示になったかは，\u003ccode\u003eXamarin.Forms.Platform.Android.FormsWebChromeClient\u003c/code\u003eクラスを使えば検知できるので，ここから\u003ccode\u003eXamarin.Forms\u003c/code\u003e側まで通知を伝えていきます．\u003c/p\u003e\n\n\u003cp\u003e① フルスクリーンに入った時のイベント用の\u003ccode\u003eEventArgs\u003c/code\u003eを作ります．（自分のリポジトリでは\u003ccode\u003eTLExtensionWebChromeClient.cs\u003c/code\u003eにあります．）\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eEnterFullScreenRequestedEventArgs\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eEventArgs\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eView\u003c/span\u003e \u003cspan class=\"n\"\u003eView\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eEnterFullScreenRequestedEventArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eView\u003c/span\u003e \u003cspan class=\"n\"\u003eview\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eView\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eview\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e② \u003ccode\u003eFormsWebChromeClient\u003c/code\u003eクラスを作ります（自分のリポジトリでは\u003ccode\u003eTLExtensionWebChromeClient\u003c/code\u003e）．全画面表示になると\u003ccode\u003eOnShowCustomView\u003c/code\u003eが，全画面表示が終了すると\u003ccode\u003eOnHideCustomView\u003c/code\u003eが呼び出されます．\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eTLExtensionWebChromeClient\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eFormsWebChromeClient\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eevent\u003c/span\u003e \u003cspan class=\"n\"\u003eEventHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eEnterFullScreenRequestedEventArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eEnterFullScreenRequested\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eevent\u003c/span\u003e \u003cspan class=\"n\"\u003eEventHandler\u003c/span\u003e \u003cspan class=\"n\"\u003eExitFullScreenRequested\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eoverride\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnHideCustomView\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eExitFullScreenRequested\u003c/span\u003e\u003cspan class=\"p\"\u003e?.\u003c/span\u003e\u003cspan class=\"nf\"\u003eInvoke\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eEventArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEmpty\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eoverride\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnShowCustomView\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eView\u003c/span\u003e \u003cspan class=\"n\"\u003eview\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eICustomViewCallback\u003c/span\u003e \u003cspan class=\"n\"\u003ecallback\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eEnterFullScreenRequested\u003c/span\u003e\u003cspan class=\"p\"\u003e?.\u003c/span\u003e\u003cspan class=\"nf\"\u003eInvoke\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eEnterFullScreenRequestedEventArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eview\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e③ \u003ccode\u003eXamarin.Forms\u003c/code\u003e側の\u003ccode\u003eWebView\u003c/code\u003eクラスに以下のフルスクリーンになった時，解除されたときのアクションを追加します．\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eBindableProperty\u003c/span\u003e \u003cspan class=\"n\"\u003eEnterFullScreenCmmandProperty\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eBindableProperty\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n            \u003cspan class=\"n\"\u003epropertyName\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e\"EnterFullScreenCommand\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ereturnType\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eICommand\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n            \u003cspan class=\"n\"\u003edeclaringType\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eTLExtensionWebView\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n            \u003cspan class=\"n\"\u003edefaultValue\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eCommand\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eview\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"nf\"\u003eDefaultEnterAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003eView\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eview\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eICommand\u003c/span\u003e \u003cspan class=\"n\"\u003eEnterFullScreenCommand\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eget\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eICommand\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetValue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eEnterFullScreenCmmandProperty\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eset\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eSetValue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eEnterFullScreenCmmandProperty\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eBindableProperty\u003c/span\u003e \u003cspan class=\"n\"\u003eExitFullScreenCmmandProperty\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eBindableProperty\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n            \u003cspan class=\"n\"\u003epropertyName\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e\"ExitFullScreenCommand\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ereturnType\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eICommand\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n            \u003cspan class=\"n\"\u003edeclaringType\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eTLExtensionWebView\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n            \u003cspan class=\"n\"\u003edefaultValue\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eCommand\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eview\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"nf\"\u003eDefaultExitAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eICommand\u003c/span\u003e \u003cspan class=\"n\"\u003eExitFullScreenCommand\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eget\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eICommand\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetValue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eExitFullScreenCmmandProperty\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eset\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eSetValue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eExitFullScreenCmmandProperty\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e//フルスクリーンを実現するためのメソッド\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e \u003cspan class=\"nf\"\u003eDefaultEnterAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eView\u003c/span\u003e \u003cspan class=\"n\"\u003eview\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003epage\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eContentPage\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eContent\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eview\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eApplication\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCurrent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMainPage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNavigation\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ePushModalAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e \u003cspan class=\"nf\"\u003eDefaultExitAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eApplication\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCurrent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMainPage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNavigation\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ePopModalAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//フルスクリーンを実現するためのメソッド　ここまで\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e④ \u003ccode\u003eWebViewRenderer\u003c/code\u003eクラスに②で作った\u003ccode\u003eFormsWebChromeClient\u003c/code\u003eを登録します．\u003ccode\u003eFormsWebChromeClient\u003c/code\u003eで全画面表示の通知が発生したら，③で実装した\u003ccode\u003eDefaultEnterAsync\u003c/code\u003eや\u003ccode\u003eDefaultExitAsync\u003c/code\u003eが呼び出されるように，処理を繋げます．（以下はフルスクリーン対応に必要な部分のみ抜き出しています．）\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eTLExtensionWebViewRenderer\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eWebViewRenderer\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eTLExtensionWebView\u003c/span\u003e \u003cspan class=\"n\"\u003e_webView\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eTLExtensionWebChromeClient\u003c/span\u003e \u003cspan class=\"n\"\u003ewebClient\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eTLExtensionWebViewRenderer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eContext\u003c/span\u003e \u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003ebase\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ewebClient\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eTLExtensionWebChromeClient\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ewebClient\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEnterFullScreenRequested\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"n\"\u003eOnEnterFullScreenRequested\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ewebClient\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eExitFullScreenRequested\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"n\"\u003eOnExitFullScreenRequested\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eprotected\u003c/span\u003e \u003cspan class=\"k\"\u003eoverride\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnElementChanged\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eElementChangedEventArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eXamarin\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eForms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWebView\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ebase\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eOnElementChanged\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNewElement\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eControl\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSetWebChromeClient\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ewebClient\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"n\"\u003e_webView\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eTLExtensionWebView\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNewElement\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e            \n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e//フルスクリーンにするための追加メソッド\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprotected\u003c/span\u003e \u003cspan class=\"k\"\u003eoverride\u003c/span\u003e \u003cspan class=\"n\"\u003eFormsWebChromeClient\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetFormsWebChromeClient\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003ewebClient\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnEnterFullScreenRequested\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eobject\u003c/span\u003e \u003cspan class=\"n\"\u003esender\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eEnterFullScreenRequestedEventArgs\u003c/span\u003e \u003cspan class=\"n\"\u003eeventArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e_webView\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEnterFullScreenCommand\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003e_webView\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEnterFullScreenCommand\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCanExecute\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003e_webView\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEnterFullScreenCommand\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eExecute\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eeventArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eView\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToView\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnExitFullScreenRequested\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eobject\u003c/span\u003e \u003cspan class=\"n\"\u003esender\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eEventArgs\u003c/span\u003e \u003cspan class=\"n\"\u003eeventArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e_webView\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eExitFullScreenCommand\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003e_webView\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eExitFullScreenCommand\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCanExecute\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003e_webView\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eExitFullScreenCommand\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eExecute\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e全画面表示になるときは\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eTLExtensionWebChromeClient.OnShowCustomView\u003c/code\u003e→\u003ccode\u003eTLExtensionWebViewRenderer.OnEnterFullScreenRequsted\u003c/code\u003e→\u003ccode\u003eTLExtensionWebView.DefaultEnterAsync\u003c/code\u003eの順で\u003c/p\u003e\n\n\u003cp\u003e全画面表示が解除されるときは\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eTLExtensionWebChromeClient.OnHideCustomView\u003c/code\u003e→\u003ccode\u003eTLExtensionWebViewRenderer.OnExitFullScreenRequsted\u003c/code\u003e→\u003ccode\u003eTLExtensionWebView.DefaultExitAsync\u003c/code\u003eの順で\u003c/p\u003e\n\n\u003cp\u003e呼び出され，\u003ccode\u003eXamarin.Forms\u003c/code\u003e側まで通知が行くようになり，全画面表示に対応できるようになります．\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"ソフトウェアキーボード表示時のwebviewの縮小\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%BD%E3%83%95%E3%83%88%E3%82%A6%E3%82%A7%E3%82%A2%E3%82%AD%E3%83%BC%E3%83%9C%E3%83%BC%E3%83%89%E8%A1%A8%E7%A4%BA%E6%99%82%E3%81%AEwebview%E3%81%AE%E7%B8%AE%E5%B0%8F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eソフトウェアキーボード表示時のWebViewの縮小\u003c/h1\u003e\n\n\u003cp\u003e参考：\u003ca href=\"https://qiita.com/amay077/items/6fcdec829a96bc604532\" id=\"reference-0b0a48b21fd86dfc047f\"\u003ehttps://qiita.com/amay077/items/6fcdec829a96bc604532\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eデフォルトのWebViewでTwitterのリプライをしようとすると，ソフトウェアキーボードが邪魔で自分が書いているツイートが見えなくなります．\u003c/p\u003e\n\n\u003cp\u003eひとまず，\u003ccode\u003eXamarin.Android\u003c/code\u003e側の\u003ccode\u003eMainActivity\u003c/code\u003eの\u003ccode\u003eOnCreate\u003c/code\u003eメソッドに以下を入れれば解決します．\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e//appにはMainActivityでロードするAppクラスのオブジェクトを入れておく．\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003eapp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eOn\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eXamarin\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eForms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePlatformConfiguration\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAndroid\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;().\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eUseWindowSoftInputModeAdjust\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eWindowSoftInputModeAdjust\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eResize\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eしかし，検索で文字を打ち，サジェストを選択したときに，キーボードは閉じるがWebViewが縮んだままになるケースがありました．この場合は後述するリロードに，いったんWebViewを非表示にしてから，表示する処理を加えると，1,2回のリロードでもとに戻るようになりました．（自分用のアプリなので，ひとまずこれで妥協．）\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"twitter外のページに遷移したときなどにchromeなどの別ブラウザで開く\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#twitter%E5%A4%96%E3%81%AE%E3%83%9A%E3%83%BC%E3%82%B8%E3%81%AB%E9%81%B7%E7%A7%BB%E3%81%97%E3%81%9F%E3%81%A8%E3%81%8D%E3%81%AA%E3%81%A9%E3%81%ABchrome%E3%81%AA%E3%81%A9%E3%81%AE%E5%88%A5%E3%83%96%E3%83%A9%E3%82%A6%E3%82%B6%E3%81%A7%E9%96%8B%E3%81%8F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eTwitter外のページに遷移したときなどに，Chromeなどの別ブラウザで開く\u003c/h1\u003e\n\n\u003cp\u003e参考：\u003ca href=\"https://itblogdsi.blog.fc2.com/blog-entry-171.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://itblogdsi.blog.fc2.com/blog-entry-171.html\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eWebView\u003c/code\u003eで遷移する際に，Chromeなどの別ブラウザで開く際には，\u003ccode\u003eXamarin.Android\u003c/code\u003e側で別ブラウザを開くためのIntentを呼び出す必要があるみたいです．上記の記事が分かりやすいので，詳細はそちらをご覧ください．\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eXamarin.Android\u003c/code\u003e側の\u003ccode\u003eOnPageStarted\u003c/code\u003eで，遷移開始時に処理をする場合は，\u003ccode\u003eOnPageStarted\u003c/code\u003eは2回呼ばれることがあります．最初の\u003ccode\u003eOnPageStarted\u003c/code\u003eでブラウザを開き，\u003ccode\u003eOnPageFinished\u003c/code\u003eが呼ばれるまではブラウザを開かないようにする必要もあるようです．（参考：\u003ca href=\"https://qiita.com/kikuchy/items/d0f5599a883e5e9350df\" id=\"reference-b421dcdcefecfd77e68c\"\u003ehttps://qiita.com/kikuchy/items/d0f5599a883e5e9350df\u003c/a\u003e）\u003c/p\u003e\n\n\u003cp\u003eまた，ページ遷移する際に\u003ccode\u003eWebView\u003c/code\u003e側もページ遷移しているので，\u003ccode\u003eWebView.GoBack()\u003c/code\u003eで戻らないと，遷移先のページが\u003ccode\u003eWebView\u003c/code\u003eに表示されたままになってしまいます．\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"webviewへのjavascript実行\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#webview%E3%81%B8%E3%81%AEjavascript%E5%AE%9F%E8%A1%8C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eWebViewへのjavascript実行\u003c/h1\u003e\n\n\u003cp\u003e\u003ccode\u003eWebView.Eval\u003c/code\u003eでjavascriptのスクリプトを入れれば，実行できますが，どうやら1つの文しか処理できないようです．複数文を処理する場合は，それらを1つの関数にまとめて一度\u003ccode\u003eWebView.Eval\u003c/code\u003eで登録した後，2回目の\u003ccode\u003eWebView.Eval\u003c/code\u003eでその関数を呼び出す必要があるみたいです．\u003c/p\u003e\n\n\u003cp\u003eまた，HTMLが更新されると登録されていた関数も消えてしまうのと，Twitterではページ表示後もHTMLの更新が頻繁に発生するため，javascriptの関数を使用するタイミングで，その都度\u003ccode\u003eWebView.Eval\u003c/code\u003eで関数を登録する必要があります．\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"webviewのリロード\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#webview%E3%81%AE%E3%83%AA%E3%83%AD%E3%83%BC%E3%83%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eWebViewのリロード\u003c/h1\u003e\n\n\u003cp\u003e最近の\u003ccode\u003eXamarin.Forms.WebView\u003c/code\u003eには\u003ccode\u003ereload\u003c/code\u003eメソッドがあるみたいですが，自分が使用していた\u003ccode\u003eXamarin.Forms\u003c/code\u003eが古かったためか（バージョンは3.0.0.561731），\u003ccode\u003ereload\u003c/code\u003eメソッドはありませんでした．\u003c/p\u003e\n\n\u003cp\u003eこの場合は，\u003ccode\u003eWebView\u003c/code\u003eと連携している\u003ccode\u003eWebViewRenderer\u003c/code\u003eの\u003ccode\u003eControl.Reload()\u003c/code\u003eを呼ぶ必要があります．リロードボタンを作る際は\u003ccode\u003eXamarin.Forms.WebView\u003c/code\u003e側に\u003ccode\u003eAction\u003c/code\u003e型の変数を用意しておき，\u003ccode\u003eWebViewRenderer\u003c/code\u003eでその変数に\u003ccode\u003eControl.Reload()\u003c/code\u003eを呼ぶアクションを登録する必要があります．リロードボタンのイベントで登録したアクションを発動します．\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e//WebViewRednererのOnElementChanged内\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//reloadActionはWebView側の変数\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003e_webView\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eTLExtensionWebView\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNewElement\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003e_webView\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ereloadAction\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eAction\u003c/span\u003e\u003cspan class=\"p\"\u003e(()\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003eControl\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReload\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"webviewの履歴削除\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#webview%E3%81%AE%E5%B1%A5%E6%AD%B4%E5%89%8A%E9%99%A4\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eWebViewの履歴削除\u003c/h1\u003e\n\n\u003cp\u003eREST APIの認証が完了してから，認証ページに戻らないように，WebViewの履歴を消す処理も実装しました．しかし，履歴削除のメソッドは現在の\u003ccode\u003eXamarin.Forms.WebView\u003c/code\u003eにも内容です．リロードの時と同じように，\u003ccode\u003eWebView\u003c/code\u003eと連携している\u003ccode\u003eWebViewRenderer\u003c/code\u003eの\u003ccode\u003eControl.ClearHistory()\u003c/code\u003eを呼ぶ必要があります．\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"おまけtabbedpageのスライド禁止\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%8A%E3%81%BE%E3%81%91tabbedpage%E3%81%AE%E3%82%B9%E3%83%A9%E3%82%A4%E3%83%89%E7%A6%81%E6%AD%A2\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e（おまけ）TabbedPageのスライド禁止\u003c/h1\u003e\n\n\u003cp\u003eTwitterでは，画像表示時にその画像が複数枚ある場合は，横スライドで画像を切り替えます．\u003ccode\u003eXamarin.Forms.TabbedPage\u003c/code\u003eを使っている場合，\u003ccode\u003eTabbedPage\u003c/code\u003eのタブ切替えのための横スライドと重なり，デフォルトだと正常に画像を切り替えることができなくなります．\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eTabbedPage\u003c/code\u003eの横スライドによるタブ切替えを禁止するには，以下を呼び出します．\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e//thisTabbedPageはTabbedPageのオブジェクト\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//falseをtrueにすると，スライドによるタブ切替えができるようになる．\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003ethisTabbedPage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eOn\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eXamarin\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eForms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePlatformConfiguration\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAndroid\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;().\u003c/span\u003e\u003cspan class=\"nf\"\u003eSetIsSwipePagingEnabled\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"まとめ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eまとめ\u003c/h1\u003e\n\n\u003cp\u003e\u003ccode\u003eXamarin.Forms\u003c/code\u003eで開発してても，\u003ccode\u003eWebView\u003c/code\u003eに少し複雑な機能を追加しようとするとAndroid側の実装が必要になってしまうようです．\u003ccode\u003eXamarin.Forms.WebView\u003c/code\u003eと連携している\u003ccode\u003eXamarin.Forms.Platform.Android.WebViewRenderer\u003c/code\u003eから，Android固有の実装を追加する場合が多いので，\u003ccode\u003ewebView\u003c/code\u003eを用いるAndroidアプリケーションを開発する場合は，この\u003ccode\u003eWebViewRenderer\u003c/code\u003eにお世話になる機会も多くなるかと思います．\u003c/p\u003e\n","createdAt":"2020-06-29T11:00:29Z","elapsedYearsFromLastModifiedAt":1,"encryptedId":"SuMUK7/+bQPaLmy6XFbrdt1v150lMClKIg==--o74m48kJvH3Q+WyG--36qLgAdxG0q6RUsnSiLsNw==","isBanned":false,"isDeprecated":true,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2020-07-03T11:18:12Z","likesCount":1,"linkUrl":"https://qiita.com/HexagramNM/items/ccbaf1345c4109e2e626","organization":null,"originalId":1254796,"stockedCount":0,"title":"Xamarin.FormsでAndroid向けTwitterアプリケーションを開発したときに困ったこと ~WebView編~","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#webview%E5%86%85%E3%81%AB%E8%A1%A8%E7%A4%BA%E3%81%95%E3%82%8C%E3%81%9Fhtml%E5%8F%96%E5%BE%97\"\u003eWebView内に表示されたHTML取得\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%8B%95%E7%94%BB%E3%81%AE%E5%85%A8%E7%94%BB%E9%9D%A2%E8%A1%A8%E7%A4%BA\"\u003e動画の全画面表示\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%BD%E3%83%95%E3%83%88%E3%82%A6%E3%82%A7%E3%82%A2%E3%82%AD%E3%83%BC%E3%83%9C%E3%83%BC%E3%83%89%E8%A1%A8%E7%A4%BA%E6%99%82%E3%81%AEwebview%E3%81%AE%E7%B8%AE%E5%B0%8F\"\u003eソフトウェアキーボード表示時のWebViewの縮小\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#twitter%E5%A4%96%E3%81%AE%E3%83%9A%E3%83%BC%E3%82%B8%E3%81%AB%E9%81%B7%E7%A7%BB%E3%81%97%E3%81%9F%E3%81%A8%E3%81%8D%E3%81%AA%E3%81%A9%E3%81%ABchrome%E3%81%AA%E3%81%A9%E3%81%AE%E5%88%A5%E3%83%96%E3%83%A9%E3%82%A6%E3%82%B6%E3%81%A7%E9%96%8B%E3%81%8F\"\u003eTwitter外のページに遷移したときなどに，Chromeなどの別ブラウザで開く\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#webview%E3%81%B8%E3%81%AEjavascript%E5%AE%9F%E8%A1%8C\"\u003eWebViewへのjavascript実行\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#webview%E3%81%AE%E3%83%AA%E3%83%AD%E3%83%BC%E3%83%89\"\u003eWebViewのリロード\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#webview%E3%81%AE%E5%B1%A5%E6%AD%B4%E5%89%8A%E9%99%A4\"\u003eWebViewの履歴削除\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%8A%E3%81%BE%E3%81%91tabbedpage%E3%81%AE%E3%82%B9%E3%83%A9%E3%82%A4%E3%83%89%E7%A6%81%E6%AD%A2\"\u003e（おまけ）TabbedPageのスライド禁止\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"\u003eまとめ\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":928,"uuid":"ccbaf1345c4109e2e626","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"6CjVhjYdyqwzBOulpMmMv/YZT5ei--s+E+VzA9u4AFuZRi--VLehHo0uFtg7ao1wKYLxcw==","originalId":152791,"description":"「欲しいものは作れるなら作る」をモットーに活動しているプログラマです。主に趣味プロで詰まったことなどを記事にします。","facebookUrl":null,"githubUrl":null,"isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"N.M","profileImageUrl":"https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/152791/64efa0a9e408c344d22b59e10d7c31cb626a0dd5/x_large.png?1603642943","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fs3-ap-northeast-1.amazonaws.com%2Fqiita-image-store%2F0%2F152791%2F64efa0a9e408c344d22b59e10d7c31cb626a0dd5%2Fx_large.png%3F1603642943?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=5c46e997dcdad68bf86ab686068bdf89","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fs3-ap-northeast-1.amazonaws.com%2Fqiita-image-store%2F0%2F152791%2F64efa0a9e408c344d22b59e10d7c31cb626a0dd5%2Fx_large.png%3F1603642943?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=6fa692caba26234d279afd0ce8193ce6","urlName":"HexagramNM","websiteUrl":"http://nmsgameproject.web.fc2.com/","twitterUrl":null,"twitterUrlName":null,"revealedOrganizations":{"edges":[]}},"tags":[{"name":"C#","urlName":"csharp"},{"name":"Xamarin.Android","urlName":"xamarin.android"},{"name":"Xamarin.Forms","urlName":"xamarin.forms"}],"followingLikers":{"edges":[]},"comments":{"totalCount":0}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

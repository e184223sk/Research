<!DOCTYPE html><html><head><meta charset="utf-8" /><title>Unityアプリを高速・安定化するために見直すべき事を9選まとめてみた - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/yoship1639/items/7339a6201b44a24fbdfe" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="/FDrqssMURs4ki/nP1t7uHN4Bk9uPzuoqaJ+XXRdcLKJCO+HN9zz2BpT+b13cZDADjWkvevaqmQd+aHhav375A==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta content="@yoship1639" name="twitter:creator" /><meta property="og:type" content="article"><meta property="og:title" content="Unityアプリを高速・安定化するために見直すべき事を9選まとめてみた - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1WVzVwZEhuamdxTGpnNWZqZzZyamdwTHBxNWpwZ0pfamc3dmxyb25scnBybGpKYmpnWm5qZ292amdaX2pnb0hqZ2F2b3Bvdm5tN1RqZ1puamdibmpnWTNrdW92amdwSTU2WUc0NDRHLTQ0R280NEtCNDRHbTQ0R180NEdmJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NTQmdHh0LWNsaXA9ZWxsaXBzaXMmdHh0LWFsaWduPWNlbnRlciUyQ21pZGRsZSZzPTgzNmM2OTYzMWJhYjJjYTE4OTMyM2IwZTY3MWQ4YWRk&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RSGx2YzJocGNERTJNemsmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT00NSZ0eHQtYWxpZ249cmlnaHQlMkNib3R0b20mcz1mZjIzNDk4ZWU2OGQ2ZWJjMDdhYThjOTBjYTYwODY0MQ&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=f8cbd53ceb5989d35f2e966357c87268"><meta property="og:description" content="本記事は 【unityプロ技】 Advent Calendar 2019 16日目の記事です。
本記事で記載されたソースコードはすべてパブリックドメインです。

修正履歴
・12/18 インスタンシングの説明を修正


はじめに

U..."><meta content="https://qiita.com/yoship1639/items/7339a6201b44a24fbdfe" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#,Unity3D,Unity,最適化" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-b5f50825-7e35-49df-b212-1870f325fa70"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Fyoship1639%2Fitems%2F7339a6201b44a24fbdfe">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Fyoship1639%2Fitems%2F7339a6201b44a24fbdfe">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-b5f50825-7e35-49df-b212-1870f325fa70">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2019-12-12T13:27:06.000+09:00","dateModified":"2021-06-18T15:14:13.000+09:00","headline":"Unityアプリを高速・安定化するために見直すべき事を9選まとめてみた","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1WVzVwZEhuamdxTGpnNWZqZzZyamdwTHBxNWpwZ0pfamc3dmxyb25scnBybGpKYmpnWm5qZ292amdaX2pnb0hqZ2F2b3Bvdm5tN1RqZ1puamdibmpnWTNrdW92amdwSTU2WUc0NDRHLTQ0R280NEtCNDRHbTQ0R180NEdmJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NTQmdHh0LWNsaXA9ZWxsaXBzaXMmdHh0LWFsaWduPWNlbnRlciUyQ21pZGRsZSZzPTgzNmM2OTYzMWJhYjJjYTE4OTMyM2IwZTY3MWQ4YWRk\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RSGx2YzJocGNERTJNemsmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT00NSZ0eHQtYWxpZ249cmlnaHQlMkNib3R0b20mcz1mZjIzNDk4ZWU2OGQ2ZWJjMDdhYThjOTBjYTYwODY0MQ\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=f8cbd53ceb5989d35f2e966357c87268","mainEntityOfPage":"https://qiita.com/yoship1639/items/7339a6201b44a24fbdfe","author":{"@type":"Person","address":"","email":"yoship1639@gmail.com","identifier":"yoship1639","name":"yoship1639","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F113595%2Fprofile-images%2F1594732889?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=716c2b13f79841ad7658dcce03a19ac2","url":"https://qiita.com/yoship1639","description":"ゲームエンジニア。C#er。バックエンドも触る。ゲーム、ゲームエンジン、仮想通貨等を自作していました。フロントエンドから物理ベースシェーダまで幅広く対応可能。理解しやすく正しい記事を記述することを心がけます。","memberOf":[{"@type":"Organization","address":"オンライン@Slack","legalName":"Unityゲーム開発者ギルド","image":"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/5e3ba3bb442371003e6b5d4618ef627b9b478357/original.jpg?1570216541","logo":"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/f7eb993765ddcdb2c5e6890556c43ea3de8fbfb7/original.jpg?1570215690","identifier":"unity-game-dev-guild","description":"趣味・仕事問わずUnityでゲームを作っている開発者のみで構成されるオンラインコミュニティです。Unityでゲームを開発・運用するにあたって必要なあらゆる知見を共有することを目的とします。"}]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://increments.connpass.com/event/211948/">「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催</a><a target="_blank" id="header_text_message_2" href="https://increments.connpass.com/event/211948/">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"yoship1639","type":"items","id":"7339a6201b44a24fbdfe"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"yoship1639","type":"items","id":"7339a6201b44a24fbdfe"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":0,"pos_id":"header_text_message_1","message":"「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"yoship1639","type":"items","id":"7339a6201b44a24fbdfe"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":0,"pos_id":"header_text_message_2","message":"「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/yoship1639/items/7339a6201b44a24fbdfe","location":"/yoship1639/items/7339a6201b44a24fbdfe","scheme":"https","host":"qiita.com","port":null,"pathname":"/yoship1639/items/7339a6201b44a24fbdfe","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"ObFnDso2LM+P5YHhO/Xyu5E9DW9QzggAQm6xeXqBWtpM6WMjNuaODK0kV7tz3xnD7HCvndUrmcz2NW7FZCHRjA==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-d19f936f-1f54-480b-b269-16162a9047f5"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/yoship1639/items/7339a6201b44a24fbdfe/likers" class="css-1iupg5d">315</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">289</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/7339a6201b44a24fbdfe/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/yoship1639/items/7339a6201b44a24fbdfe/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/yoship1639/items/7339a6201b44a24fbdfe/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/yoship1639/items/7339a6201b44a24fbdfe/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/yoship1639/items/7339a6201b44a24fbdfe.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-helsa7"><div class="css-8qb8m4"><div class="it-AdcalRibbon"><span><a href="/advent-calendar/2019/unityforpro" class="it-AdcalRibbon_title">【unityプロ技】<!-- --> Advent Calendar<!-- --> <!-- -->2019</a>Day 16</span></div><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/yoship1639"><img class="css-100alwu eyfquo10" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/113595/profile-images/1594732889" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/yoship1639" class="css-10ougpm">@<!-- -->yoship1639</a><div class="css-1ay9vb9"><span><meta content="2019-12-12T04:27:06Z"/><time dateTime="2021-06-18T06:14:13Z" class="css-m19uds">updated at 2021-06-18</time></span></div></div></div></div></div><h1 class="css-cgzq40">Unityアプリを高速・安定化するために見直すべき事を9選まとめてみた</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/unity3d" class="css-4czcte">Unity3D</a><a href="/tags/unity" class="css-4czcte">Unity</a><a href="/tags/%e6%9c%80%e9%81%a9%e5%8c%96" class="css-4czcte">最適化</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div><p>本記事は <a href="https://qiita.com/advent-calendar/2019/unityforpro">【unityプロ技】 Advent Calendar 2019</a> 16日目の記事です。<br>
本記事で記載されたソースコードはすべて<code>パブリックドメイン</code>です。</p>

<p>修正履歴<br>
・12/18 インスタンシングの説明を修正</p>

<h1>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h1>

<p>Unityアプリを安定化させるために試行錯誤を繰り返している<a href="https://twitter.com/yoship1639" rel="nofollow noopener" target="_blank">yoship1639</a>です。</p>

<p>社内ではフロント側の開発基盤構成選定や共通基盤開発、ロジック、物理シミュレーション、ビジュアル周り(カメラワーク、シェーダ、演出)、最適化等様々なタスクを担当しています。</p>

<p>Unityはゲーム開発を大幅に効率化できる素晴らしいツールですが、そのすべての最適化が自動で行われる訳ではない事はご存じかと思います。詰まるところ、開発者側が最適化の手法を知っていなければUnityアプリの安定した動作を確保することはできません。しかし、参考文献が散見されどこを見直せばいいのか分からなかったりリファレンスを熟読してもよく分からなかったりすることもあるかと思います。</p>

<p>近年のスマートフォンは性能が高くなりつつありますが、すべてのユーザが高性能なスペックのスマートフォンを持ち合わせている訳ではありません。ユーザのスマートフォン1台の平均使用年数は4年を超えています。つまり、平均～低スペックなスマートフォンでも安定した動作を保証できなければユーザの満足度を高めることはできないので、高速かつ安定した動作は非常に重要となります。</p>

<p>そこで、高速かつ安定した動作を手に入れるためにどこを見直せばいいのかを9選でまとめてみました。安定した動作を提供するために、自分は何をしたらいいのかを知り、どこを直せばいいのかを認識し、実際に見直していただければと思います。</p>

<p>※筆者のUnity現環境は2018.4.12fのため本記事の設定内容もそれに準じています。<br>
※本記事は特定プラットフォーム専用の最適化の記事ではありませんがスマートフォン向けアプリに寄った記事となります。</p>

<h1>
<span id="見直すべき事9選" class="fragment"></span><a href="#%E8%A6%8B%E7%9B%B4%E3%81%99%E3%81%B9%E3%81%8D%E4%BA%8B9%E9%81%B8"><i class="fa fa-link"></i></a>見直すべき事9選</h1>

<h2>
<span id="プロファイラをまず見る" class="fragment"></span><a href="#%E3%83%97%E3%83%AD%E3%83%95%E3%82%A1%E3%82%A4%E3%83%A9%E3%82%92%E3%81%BE%E3%81%9A%E8%A6%8B%E3%82%8B"><i class="fa fa-link"></i></a>プロファイラをまず見る</h2>

<p>まず一番最初にやるべき事は<strong>プロファイラを見る事</strong>です。これを見れば自分のUnityアプリのどこがボトルネックになっているのかをほぼ確実に特定できます。どこが悪さしているのかを認識するのは一番大事なところなので、絶対に見ましょう。</p>

<p>プロファイラは[Window] - [Analysis] - [Profiler]で確認できます。</p>

<p><a href="https://camo.qiitausercontent.com/d788f11649140cbc8ca59a443bf1efebbb7feb46/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3131333539352f35346563633938302d646130332d666466312d356164622d3433376330613531333938322e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F113595%2F54ecc980-da03-fdf1-5adb-437c0a513982.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=197f52619b0187740cca99d5a0df400a" alt="performance002.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/113595/54ecc980-da03-fdf1-5adb-437c0a513982.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F113595%2F54ecc980-da03-fdf1-5adb-437c0a513982.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=aba3cd02af8fd1210eef58cb3530b69b 1x" loading="lazy"></a></p>

<p>プロファイラを起動したら<em>Record</em>を押下しエディタでデバッグプレイしてください、プロファイラが動作し各種グラフを見ることができます。重要なのは、<strong>CPU Usage</strong>です。CPUがどのような使われ方をしているのかとフレームレートを知ることができます。</p>

<p>CPU Usageは恐らく大体の方が上図の形になっているのではないかと思います。なぜなら、比較的高性能なPCで作業しているはずなので。重要なのは<strong>4~5年前の低スペックスマートフォン実機のプロファイル</strong>です。このプロファイルが本当のプロファイル結果となります。(実機でのプロファイルのやり方等は説明しないので各自調べてください)</p>

<p>実機のプロファイルを見ていただくと、恐らくかなりグラフが乱れているのではないかと思います。既に乱れずに高速かつ安定に動作していたら本記事の目標を達成しているので以降の内容は参考程度に眺めていただければ幸いです。安定していない場合は、60fpsを常に下回る事を目標に見直していただければと思います。</p>

<p>CPU Usageのグラフの詳細と対処を説明します。</p>

<h3>
<span id="rendering" class="fragment"></span><a href="#rendering"><i class="fa fa-link"></i></a>Rendering</h3>

<p>緑色のグラフは描画全般にかかった時間を示しています。主に不透明・透明オブジェクトの描画、影処理、遅延描画処理、ポストプロセス処理、UI描画処理にかかった時間がここに含まれています。このグラフがCPUの大部分を占めている場合は、描画系の処理の仕方を見直さなければなりません。</p>

<p>Renderingが悪さをしていると判明した場合、次に見るべきは<strong>GPU Usage</strong>と<strong>Rendering</strong>です。GPU Usageはデフォルトで隠れているのでAdd ProfilerからGPUを選択しGPUプロファイリングを有効にしてください。すると先程説明した描画の詳細をグラフで見ることができます。</p>

<p>GPUプロファイルとRenderingプロファイルの詳細と対処は <a href="#6-%E6%8F%8F%E7%94%BB%E5%91%A8%E3%82%8A%E3%82%92%E8%A6%8B%E7%9B%B4%E3%81%99">6. 描画周りを見直す</a> と <a href="#7-%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80%E3%83%9E%E3%83%86%E3%83%AA%E3%82%A2%E3%83%AB%E5%91%A8%E3%82%8A%E3%82%92%E8%A6%8B%E7%9B%B4%E3%81%99">7.シェーダ・マテリアル周りを見直す</a>、<a href="#8-%E3%83%A9%E3%82%A4%E3%83%88%E3%82%B7%E3%83%A3%E3%83%89%E3%82%A6%E5%91%A8%E3%82%8A%E3%82%92%E8%A6%8B%E7%9B%B4%E3%81%99">8. ライト・シャドウ周りを見直す</a> を見ていただければと思います。</p>

<h3>
<span id="scripts" class="fragment"></span><a href="#scripts"><i class="fa fa-link"></i></a>Scripts</h3>

<p>青色のグラフはスクリプト全般にかかった時間を示しています。独自にコーディングしたスクリプトやUnityビルトインスクリプト(MonoBehaviourなど)がScriptsに含まれています。ここが乱れていたりスパイク(一瞬だけすごく時間がかかっている)が立っていたりする場合スクリプト周りを見直さなければなりません。</p>

<p>スクリプト周りの対処は <a href="#5-%E3%83%A1%E3%83%A2%E3%83%AA%E5%91%A8%E3%82%8A%E3%82%92%E8%A6%8B%E7%9B%B4%E3%81%99">5. メモリ周りを見直す</a> と <a href="#9-%E3%82%B3%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0%E3%82%92%E8%A6%8B%E7%9B%B4%E3%81%99">9. コーディングを見直す</a> を見てください。</p>

<h3>
<span id="physics" class="fragment"></span><a href="#physics"><i class="fa fa-link"></i></a>Physics</h3>

<p>オレンジ色のグラフは物理処理全般にかかった時間を示しています。剛体(Rigidbody)、衝突判定、拘束処理、レイキャスト、トリガーなどが含まれています。このグラフは比較的乱れやすくスパイクも立ちやすいので、物理処理を多用している場合は優先的に見直した方が良いです。</p>

<p>物理処理周りの対処は <a href="#4-%E7%89%A9%E7%90%86%E5%91%A8%E3%82%8A%E3%82%92%E8%A6%8B%E7%9B%B4%E3%81%99">4. 物理周りを見直す</a> を見てください。</p>

<h3>
<span id="animation" class="fragment"></span><a href="#animation"><i class="fa fa-link"></i></a>Animation</h3>

<p>水色のグラフはアニメーション全般にかかった時間を示しています。AnimatorやAnimationによるFK,IKのスキンメッシュアニメーション(ボーンアニメーション)がここに含まれています。アニメーション数が多かったりボーンやIK構造が複雑だと乱れやすくなります。</p>

<p>アニメーション周りの対処は <a href="3-%E3%82%A2%E3%83%8B%E3%83%A1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%92%E8%A6%8B%E7%9B%B4%E3%81%99">3. アニメーションを見直す</a> を見てください。</p>

<h3>
<span id="garbagecollector" class="fragment"></span><a href="#garbagecollector"><i class="fa fa-link"></i></a>GarbageCollector</h3>

<p>黄土色の様なよく分からない色のグラフはガベージコレクションにかかった時間を表しています。メモリ管理が甘いとスパイクが頻繁に立ちその度に一瞬アプリが硬直します。</p>

<p>GC周りの対処は <a href="#5-%E3%83%A1%E3%83%A2%E3%83%AA%E5%91%A8%E3%82%8A%E3%82%92%E8%A6%8B%E7%9B%B4%E3%81%99">5. メモリ周りを見直す</a> を見てください。</p>

<h3>
<span id="ui" class="fragment"></span><a href="#ui"><i class="fa fa-link"></i></a>UI</h3>

<p>紫色のグラフはUI全般にかかった時間を示しています。説明するまでもなくUIのレイアウトや描画がここに含まれています。様々なテキストやテクスチャを動かしたりたくさん描画したりすると重くなったりします。</p>

<p>UI周りの対処は <a href="#2-ui%E5%91%A8%E3%82%8A%E3%82%92%E8%A6%8B%E7%9B%B4%E3%81%99">2. UI周りを見直す</a> と <a href="#6-%E6%8F%8F%E7%94%BB%E5%91%A8%E3%82%8A%E3%82%92%E8%A6%8B%E7%9B%B4%E3%81%99">6. 描画周りを見直す</a>、 <a href="#7-%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80%E3%83%9E%E3%83%86%E3%83%AA%E3%82%A2%E3%83%AB%E5%91%A8%E3%82%8A%E3%82%92%E8%A6%8B%E7%9B%B4%E3%81%99">7.シェーダ・マテリアル周りを見直す</a> を見てください。</p>

<h3>
<span id="その他vsync-global-illmination-other" class="fragment"></span><a href="#%E3%81%9D%E3%81%AE%E4%BB%96vsync-global-illmination-other"><i class="fa fa-link"></i></a>その他(VSync, Global Illmination, Other)</h3>

<p>上記以外のVSync, Global Illmination, Otherは基本気にしなくて大丈夫です。一応簡単に説明すると、</p>

<ul>
<li>Vsync : リフレッシュレートに合わせてCPUを待機させている時間</li>
<li>Global Illmination : 大域照明(環境光や反射光を考慮した照明)にかかった時間。非常に重いため高精細表現をしない限り使わない</li>
<li>Other : それ以外にかかった時間。分別不能な内部処理のため考慮しなくていい。</li>
</ul>

<p>となります。</p>

<p>プロファイラでボトルネックが判明したら、実際に見直していきます。</p>

<h2>
<span id="1-クオリティ設定を見直す" class="fragment"></span><a href="#1-%E3%82%AF%E3%82%AA%E3%83%AA%E3%83%86%E3%82%A3%E8%A8%AD%E5%AE%9A%E3%82%92%E8%A6%8B%E7%9B%B4%E3%81%99"><i class="fa fa-link"></i></a>1. クオリティ設定を見直す</h2>

<p>一番最初に確認するべき事ではないですが、Unityのクオリティ設定を見直すだけでも動作が改善されます。スマートフォン向けアプリはオーバースペックな設定をするべきではないので、ぜひ見直していきましょう。</p>

<p>[Edit] - [Project Settings] - [Quality]を開いてください。すると以下の画面が表示されます。</p>

<p><a href="https://camo.qiitausercontent.com/d15937ac035863bb88812205be81eff047021ec5/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3131333539352f30613731353335622d313963652d333535392d363039642d3831653530326465636431382e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F113595%2F0a71535b-19ce-3559-609d-81e502decd18.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=821016fcce63e77c1d78b0a29ba2b0d7" alt="performance003.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/113595/0a71535b-19ce-3559-609d-81e502decd18.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F113595%2F0a71535b-19ce-3559-609d-81e502decd18.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=66e27b7f4298520d363b787c93f050a3 1x" loading="lazy"></a></p>

<p>設定すべきは以下の項目です。<br>
※ケースバイケースなので自分のプロジェクトにあった設定をしてください</p>

<h4>
<span id="pixel-light-count-を小さくするもしくは0にする" class="fragment"></span><a href="#pixel-light-count-%E3%82%92%E5%B0%8F%E3%81%95%E3%81%8F%E3%81%99%E3%82%8B%E3%82%82%E3%81%97%E3%81%8F%E3%81%AF0%E3%81%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>Pixel Light Count を小さくする。もしくは0にする</h4>

<p>もし、プロジェクト内で<strong>ライトを使っていない場合</strong>はPixel Light Countを0にしてください。ライトを扱っている場合はできる限り小さい値にしてください。これで無駄なライト処理が省かれます。</p>

<h4>
<span id="texture-qualityを下げる" class="fragment"></span><a href="#texture-quality%E3%82%92%E4%B8%8B%E3%81%92%E3%82%8B"><i class="fa fa-link"></i></a>Texture Qualityを下げる</h4>

<p>高精細なスプライトやテクスチャを必要としていない場合はHalf Res以下にしましょう。</p>

<h4>
<span id="anisotropic-texturesをオフにする" class="fragment"></span><a href="#anisotropic-textures%E3%82%92%E3%82%AA%E3%83%95%E3%81%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>Anisotropic Texturesをオフにする</h4>

<p>異方性フィルタリングを扱わない場合はDisableにしましょう。</p>

<h4>
<span id="anti-aliasingをオフにする" class="fragment"></span><a href="#anti-aliasing%E3%82%92%E3%82%AA%E3%83%95%E3%81%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>Anti Aliasingをオフにする</h4>

<p>ジャギーが気になる場合を除いてDisableにしましょう。</p>

<h4>
<span id="soft-particlesをオフにする" class="fragment"></span><a href="#soft-particles%E3%82%92%E3%82%AA%E3%83%95%E3%81%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>Soft Particlesをオフにする</h4>

<p>ポリゴンとの境界付近にパーティクルを描画しないのであればSoft Particleは必要ないのでオフにしましょう。</p>

<h4>
<span id="realtime-reflection-probesをオフにする" class="fragment"></span><a href="#realtime-reflection-probes%E3%82%92%E3%82%AA%E3%83%95%E3%81%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>Realtime Reflection Probesをオフにする</h4>

<p>スマートフォンアプリなら必要ないことがほとんどなのでオフにしましょう。</p>

<h4>
<span id="resolution-scaling-fixed-dpi-factorを下げる" class="fragment"></span><a href="#resolution-scaling-fixed-dpi-factor%E3%82%92%E4%B8%8B%E3%81%92%E3%82%8B"><i class="fa fa-link"></i></a>Resolution Scaling Fixed DPI Factorを下げる</h4>

<p>スマートフォンは解像度が高く描画負荷も大きいため0.5くらいにしても問題ないです。</p>

<h4>
<span id="texture-streamingをオフにする" class="fragment"></span><a href="#texture-streaming%E3%82%92%E3%82%AA%E3%83%95%E3%81%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>Texture Streamingをオフにする</h4>

<p>普段使わないはずなのでオフにしましょう。</p>

<h4>
<span id="shadowsを無効にする" class="fragment"></span><a href="#shadows%E3%82%92%E7%84%A1%E5%8A%B9%E3%81%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>Shadowsを無効にする</h4>

<p>もしプロジェクト内で<strong>影を扱わない</strong>のであればShadowsをDisable Shadowsにしましょう。影の計算が省かれます。</p>

<h4>
<span id="shadow-resolutionを下げる" class="fragment"></span><a href="#shadow-resolution%E3%82%92%E4%B8%8B%E3%81%92%E3%82%8B"><i class="fa fa-link"></i></a>Shadow Resolutionを下げる</h4>

<p>影の深度バッファ解像度です。高いと描画負荷も高いので低くしましょう。</p>

<h4>
<span id="blend-weightsを少なくする" class="fragment"></span><a href="#blend-weights%E3%82%92%E5%B0%91%E3%81%AA%E3%81%8F%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>Blend Weightsを少なくする</h4>

<p>スキニングのボーンブレンド数です。精細なスキンメッシュアニメーションを求めていないのであれば1 Boneにしましょう。</p>

<h4>
<span id="vsync-countを無効にする" class="fragment"></span><a href="#vsync-count%E3%82%92%E7%84%A1%E5%8A%B9%E3%81%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>VSync Countを無効にする</h4>

<p>画面のリフレッシュレートに合わせて同期させるかの設定です。基本的に自分でプロジェクトにあったフレームレートを設定した方がよいのでDon't Syncにしましょう。次に以下のコードでフレームレートを設定できます。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>Application.targetFrameRate = 60;
</code></pre></div></div>

<h4>
<span id="particle-raycast-budgetを下げる" class="fragment"></span><a href="#particle-raycast-budget%E3%82%92%E4%B8%8B%E3%81%92%E3%82%8B"><i class="fa fa-link"></i></a>Particle Raycast Budgetを下げる</h4>

<p>パーティクルの衝突レイキャストの最大数です。パーティクルの品質を求めていないのであれば4, 16辺りに設定しましょう。</p>

<h2>
<span id="2-ui周りを見直す" class="fragment"></span><a href="#2-ui%E5%91%A8%E3%82%8A%E3%82%92%E8%A6%8B%E7%9B%B4%E3%81%99"><i class="fa fa-link"></i></a>2. UI周りを見直す</h2>

<p>UIを最適化したい場合、キャンバスの仕様とバッチングというものを知らなければなりません。</p>

<h4>
<span id="静的なcanvasと動的なcanvasを分ける" class="fragment"></span><a href="#%E9%9D%99%E7%9A%84%E3%81%AAcanvas%E3%81%A8%E5%8B%95%E7%9A%84%E3%81%AAcanvas%E3%82%92%E5%88%86%E3%81%91%E3%82%8B"><i class="fa fa-link"></i></a>静的なCanvasと動的なCanvasを分ける</h4>

<p>UIキャンバスは、<strong>内容に変化がなければ描画負荷はほぼかかりません</strong>（内容は、位置の変更、テクスチャの差し替え、マテリアルの差し替え等です）。Unityは賢いので同じ内容のものを毎回計算し直すということをしません。逆を言えば内容に変化があったらキャンバス内すべての再構築処理が走ります。しかし、何も変化がないキャンバスというのは難しいものです。なので<strong>変化のない静的キャンバスと変化が多い動的キャンバスに分ける</strong>のが最適解となります。これにより、動的な箇所のみ再計算させることができます。見落としがちな項目なので注意しましょう。</p>

<h4>
<span id="テクスチャはできるだけまとめる" class="fragment"></span><a href="#%E3%83%86%E3%82%AF%E3%82%B9%E3%83%81%E3%83%A3%E3%81%AF%E3%81%A7%E3%81%8D%E3%82%8B%E3%81%A0%E3%81%91%E3%81%BE%E3%81%A8%E3%82%81%E3%82%8B"><i class="fa fa-link"></i></a>テクスチャはできるだけまとめる</h4>

<p>バッチングというのは、簡単に説明すると一度にまとめて描画するということです。UIは同一マテリアルかつ同一テクスチャのオブジェクトをまとめて描画することをします。これによりいくら同じテクスチャを描画しまくっても描画負荷がほぼ変わらないのです。逆を言えば、マテリアルやテクスチャが変化するとバッチングは効かなくなります。なので、なるべく同一マテリアルかつ同一テクスチャであることを心掛けなければなりません。しかし、マテリアルは共通化できてもテクスチャを共通化するのは普通できません。</p>

<p>UnityにはSprite Atlasという機能があります。これはテクスチャを１つにまとめてパッキングするというものです。これを使うことで複数テクスチャが１つのテクスチャになるので、あとはマテリアルの変更をしない限り、１度のバッチでまとめて描画することができるようになります。ぜひ活用しましょう。</p>

<p>UIは基本的に上記２つを意識するだけで十分最適化できます。</p>

<h2>
<span id="3-アニメーションを見直す" class="fragment"></span><a href="#3-%E3%82%A2%E3%83%8B%E3%83%A1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%92%E8%A6%8B%E7%9B%B4%E3%81%99"><i class="fa fa-link"></i></a>3. アニメーションを見直す</h2>

<p>アニメーションの負荷ははボーンのスキニング負荷とほぼ同値です。つまりスキニング負荷を抑える様に意識することが重要となります。</p>

<h4>
<span id="ボーンの数を減らす" class="fragment"></span><a href="#%E3%83%9C%E3%83%BC%E3%83%B3%E3%81%AE%E6%95%B0%E3%82%92%E6%B8%9B%E3%82%89%E3%81%99"><i class="fa fa-link"></i></a>ボーンの数を減らす</h4>

<p>これは安直な案ですが一番効果があります。なぜならスキニング負荷が純粋に減るからです。そのため、扱うモデルのボーン構造自体が重要となります。例えば、カメラが寄ることがないのに手の指にまでボーンが入っていたりすると、指先まで見えることがないのにその分無駄な処理を行っていることになります。なので、モデルのポリゴン削減だけでなく、ボーンの削減も一緒に考えるのがいいでしょう。</p>

<h4>
<span id="ikをなるべく使わない" class="fragment"></span><a href="#ik%E3%82%92%E3%81%AA%E3%82%8B%E3%81%B9%E3%81%8F%E4%BD%BF%E3%82%8F%E3%81%AA%E3%81%84"><i class="fa fa-link"></i></a>IKをなるべく使わない</h4>

<p>IK(インバースキネマティクス)は負荷の高い処理です。ボーンの先からボーンの根元まで計算を繰り返すので通常のスキニングより処理負荷がかかります。そのため、どうしてもIKが必要な場面を除いては、IKをFKに焼いてしまいIKを無くしてしまうのが良いでしょう。</p>

<h4>
<span id="画面に映る時のみアニメーションさせる" class="fragment"></span><a href="#%E7%94%BB%E9%9D%A2%E3%81%AB%E6%98%A0%E3%82%8B%E6%99%82%E3%81%AE%E3%81%BF%E3%82%A2%E3%83%8B%E3%83%A1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%95%E3%81%9B%E3%82%8B"><i class="fa fa-link"></i></a>画面に映る時のみアニメーションさせる</h4>

<p>画面外にあるモデルをアニメーションさせるのは、どうしても必要な場合を除いて皆無です。なので、画面内に映る場合のみアニメーションさせるようにしましょう。この設定は簡単にでき、Skinned Mesh RendererのUpdate When Offscreenをオフにすればいいだけです。デフォルトでオフになっていますが、今一度見直しましょう。</p>

<h4>
<span id="gpuにスキニングさせる" class="fragment"></span><a href="#gpu%E3%81%AB%E3%82%B9%E3%82%AD%E3%83%8B%E3%83%B3%E3%82%B0%E3%81%95%E3%81%9B%E3%82%8B"><i class="fa fa-link"></i></a>GPUにスキニングさせる</h4>

<p>スキニングは通常CPUが担当します。トランスフォームの階層構造を持つ行列やクォータニオンの計算をGPUに担当させるのは結構骨の折れるコーディングだからです。しかし、Unityではチェックボックス１つでGPUにスキニングを担当させることができます。行列演算に関しては右に出るものがないGPUなので、処理の高速化が望めます。</p>

<p>プレイヤー設定のOther SettingsにGPU Skinningという項目があるので、オンにしましょう。これで、自動的にGPUスキニングになります。(※古すぎる端末だと効果がない可能性があります)</p>

<p>注意点としては、逆にGPU負荷が高くなりすぎて処理が遅くなってしまうことがあります。CPUとGPUの丁度いいバランスを見つけてそれに合った設定をするようにしましょう。</p>

<h2>
<span id="4-物理周りを見直す" class="fragment"></span><a href="#4-%E7%89%A9%E7%90%86%E5%91%A8%E3%82%8A%E3%82%92%E8%A6%8B%E7%9B%B4%E3%81%99"><i class="fa fa-link"></i></a>4. 物理周りを見直す</h2>

<p>物理周りを見直したい場合、物理エンジンそのものの特性をある程度知る必要があります。</p>

<h4>
<span id="rigidbody-collider-jointは最低限にする" class="fragment"></span><a href="#rigidbody-collider-joint%E3%81%AF%E6%9C%80%E4%BD%8E%E9%99%90%E3%81%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>Rigidbody, Collider, Jointは最低限にする</h4>

<p>まず、Unityは物理エンジンとしてPhysXを使っています。内製のものもありますがデフォルトはPhysXです。物理エンジンは基本的に物理世界を内部で作り、RigidbodyやColliderを登録し、毎フレームシミュレーションを行い、シミュレーション結果を返します。レイキャストは個別に受け付けています。UnityのコンポーネントであるRigidbodyやColliderは内部でPhysXのRigidbodyとColliderと結びついているんですね。</p>

<p>そんな物理エンジンですが、想像通り基本重いです。古い端末だと顕著に重くなります。重さはRigidbodyやColliderの数に比例します。特にRigidbodyは重いです。なので、無駄な使い方をしないように心がけるのが良いです。例えば、自由落下するだけならわざわざRigidbodyを使わなくてもコードで-Y方向に移動させればいいですし、複雑な衝突をしない限り単純なコードで代用できるならなるべくそうすべきです。</p>

<p>当たり前のことを綴っているだけですが、一番負荷を削減できる事なので常に意識しましょう。</p>

<h4>
<span id="なるべく動かさない" class="fragment"></span><a href="#%E3%81%AA%E3%82%8B%E3%81%B9%E3%81%8F%E5%8B%95%E3%81%8B%E3%81%95%E3%81%AA%E3%81%84"><i class="fa fa-link"></i></a>なるべく動かさない</h4>

<p>実は、RigidbodyやColliderの数が多くても負荷がかからない様にする方法があります。それは、<strong>動かさない</strong>ことです。物理エンジンはstaticもしくは動かないと判断したオブジェクトはsleep状態に入り無駄な物理処理を行わない様になります。なので、なるべく物理オブジェクトは動かさない様にしましょう。</p>

<h4>
<span id="シーンの途中でrigidbodyやcolliderを追加しない" class="fragment"></span><a href="#%E3%82%B7%E3%83%BC%E3%83%B3%E3%81%AE%E9%80%94%E4%B8%AD%E3%81%A7rigidbody%E3%82%84collider%E3%82%92%E8%BF%BD%E5%8A%A0%E3%81%97%E3%81%AA%E3%81%84"><i class="fa fa-link"></i></a>シーンの途中でRigidbodyやColliderを追加しない</h4>

<p>シーンの開始ではなく途中でRigidbodyやColliderを追加したくなる時もあるかと思いますが、なるべく控えてください。Unityコンポーネントとして追加されるだけでなく物理世界にも初期登録処理を行わなければならないので結構負荷がかかります。</p>

<p>なのでRigidbodyとColliderを途中で追加したい場合は、予めコンポーネントとして追加しシーンの最初に</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre><code><span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">Rigidbody</span><span class="p">&gt;().</span><span class="n">isKinematic</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
<span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">Collider</span><span class="p">&gt;().</span><span class="n">enabled</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
</code></pre></div></div>

<p>有効にしたい時に</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre><code><span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">Rigidbody</span><span class="p">&gt;().</span><span class="n">isKinematic</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
<span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">Collider</span><span class="p">&gt;().</span><span class="n">enabled</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
</code></pre></div></div>

<p>として初期化処理の負荷をシーン開始時に持っていきましょう。(長くなるのでGetComponentをインラインで書いてますがキャッシュもしくはSerialize Fieldを使ってください)</p>

<h4>
<span id="精度を下げて軽くする" class="fragment"></span><a href="#%E7%B2%BE%E5%BA%A6%E3%82%92%E4%B8%8B%E3%81%92%E3%81%A6%E8%BB%BD%E3%81%8F%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>精度を下げて軽くする</h4>

<p>Unityの物理エンジンの精度はプロジェクト設定から変更することができます。<br>
[Edit] - [Project Settings] - [Physics]を開くと物理エンジンの設定が可能です。<br>
基本的にはいじらない方が良いですが、精度を細かく調整したい場合は以下の4つを設定するのが良いです。</p>

<ul>
<li><strong>Sleep Threshold</strong></li>
</ul>

<p>剛体がスリープ状態に入る運動エネルギーの閾値です。デフォルトは0.005で、この値を下回った剛体はスリープ状態に入ります。大量の剛体オブジェクトを扱い、細かな運動を求めていないのであれば、この値を上げましょう。</p>

<ul>
<li><strong>Default Contact Offset</strong></li>
</ul>

<p>コライダー同士が衝突したと判定する距離です。デフォルトは0.01です。0に近づけすぎると物理挙動がおかしくなります。大量のコライダーを扱い、かつ精度を求めていないのであれば、この値を上げましょう。</p>

<ul>
<li><strong>Default Solver Iterations</strong></li>
</ul>

<p>ジョイントや重なり合った剛体同士の物理的な相互作用を行うタスク(ソルバー)の処理数です。デフォルトは6で、この値を上げると不安定な物理挙動が少なくなります。この値も、物理挙動が変に見えない最低値を指定してあげましょう。</p>

<ul>
<li><strong>Fixed Timestep</strong></li>
</ul>

<p>この設定項目は[Project Settings] - [Time]にあります。Time.fixedDeltaTimeの値であり、物理シミュレーションのフレームレートを表します。デフォルトは0.02で物理シミュレーションは50fpsであることが分かります。60fpsのゲームを想定しているのであれば0.02のままで良いですが、30fpsのゲームを想定している場合は、無駄に物理シミュレーションを行う事になるので0.04に設定してあげるのがいいでしょう。</p>

<h2>
<span id="5-メモリ周りを見直す" class="fragment"></span><a href="#5-%E3%83%A1%E3%83%A2%E3%83%AA%E5%91%A8%E3%82%8A%E3%82%92%E8%A6%8B%E7%9B%B4%E3%81%99"><i class="fa fa-link"></i></a>5. メモリ周りを見直す</h2>

<p>メモリ管理はプログラミングにおいて避けては通れない問題です、たとえそれがUnityであっても。想像すればわかる通り、Instantiateはmallocと同じでヒープに動的に領域を確保します。Destroyを行うとDisposeが走り、使用されなくなったヒープが一定サイズ以上に達すると動的にGCが走ってしまいます。スタックとヒープを意識しなければならないのはUnityでも同じなので気を付けましょう。</p>

<h4>
<span id="確保されたメモリを認識し減らすことを心掛ける" class="fragment"></span><a href="#%E7%A2%BA%E4%BF%9D%E3%81%95%E3%82%8C%E3%81%9F%E3%83%A1%E3%83%A2%E3%83%AA%E3%82%92%E8%AA%8D%E8%AD%98%E3%81%97%E6%B8%9B%E3%82%89%E3%81%99%E3%81%93%E3%81%A8%E3%82%92%E5%BF%83%E6%8E%9B%E3%81%91%E3%82%8B"><i class="fa fa-link"></i></a>確保されたメモリを認識し、減らすことを心掛ける</h4>

<p>メモリ周りを見直す前に、自分のゲームがどの程度メモリを使っているのか認識しましょう。スマートフォン向けであれば、例えばメモリ容量2GBに対して1GBを超えるようなメモリを確保していると動作が不安定になったりしますので、しっかり認識した方がいいです。</p>

<p>プロファイラの[Memory]項目を選択すると以下の様な表示がされると思います。これを見れば現在どのリソースがどの位のメモリが確保されているのかがわかります。（下記はEditor上のプロファイラなので本来は実機のプロファイルを見たほうがいいです）</p>

<p><a href="https://camo.qiitausercontent.com/90a6ca6a0bacd49135bdb2ad99cd1f84cfee41d0/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3131333539352f37363263643436342d326338652d323235612d333034662d3137313134393564343936312e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F113595%2F762cd464-2c8e-225a-304f-1711495d4961.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=8ff8c9ebc5575a419c639d8dcd6be65e" alt="performance004.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/113595/762cd464-2c8e-225a-304f-1711495d4961.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F113595%2F762cd464-2c8e-225a-304f-1711495d4961.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=59ffcc15f021fb611bc9d6bd3474aaa5 1x" loading="lazy"></a></p>

<p>上記のUsed Totalが全体でどの位のメモリを使っているかを示しています。この値が大きかったり乱高下していたりするとGCが頻繁に発生する事になります。</p>

<p>その他の項目はメモリの内訳となります。例えば上記だとTexturesが一番多く141.8MB使われていることになるので、ここを減らすことを心掛けたほうが良いとわかります。</p>

<p>自分のゲームのメモリ領域がどの様な使われ方をしているのかをここでしっかり認識してください。</p>

<h4>
<span id="プールキャッシュを多用する" class="fragment"></span><a href="#%E3%83%97%E3%83%BC%E3%83%AB%E3%82%AD%E3%83%A3%E3%83%83%E3%82%B7%E3%83%A5%E3%82%92%E5%A4%9A%E7%94%A8%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>プール・キャッシュを多用する</h4>

<p>メモリはシーンの開始時に一気に確保・解放し、シーン中はできる限り確保・解放しないことを心掛けてください。理由は単純で、メモリの動的確保・解放による負荷やGCの発生を極限まで抑える事ができるからです。そのためにもプールやキャッシュの考え方は非常に有効です。</p>

<p>プール・キャッシュは予めデータを確保し(Unityでいえばシーンの開始時)、そのデータを使いまわすことを意味しています。例えば、シューティングゲームがいい例です。シューティングゲームにおいて弾は常に発生するもので、もしプールを使わず弾の発射時にInstantiateしていたら、その度に動的にメモリが確保されることになり、GCが頻発し非常によろしくないです。これを回避するには、予め画面上に表示されるであろう弾の最大数分Instantiateしておき、画面外などに弾を配置しておいて、必要な時に必要な場所に配置することが望ましいです。こうすることで弾オブジェクトの動的な確保や解放が行われることがなくなるので、GCも発生せず動作も安定します。</p>

<p>ぜひ、プールやキャッシュは有効活用してください。</p>

<h4>
<span id="アンロードを忘れない" class="fragment"></span><a href="#%E3%82%A2%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89%E3%82%92%E5%BF%98%E3%82%8C%E3%81%AA%E3%81%84"><i class="fa fa-link"></i></a>アンロードを忘れない</h4>

<p>意外と忘れがちな事として挙げられるのがアセットのアンロードです。他にも通信周りやファイルIO周りのアンロードも挙げられます。アンロードの何がいいかと言うと、メモリリークを無くすことができ、かつメモリの領域を増やすことができます。アンロードしないままにするとメモリ領域を圧迫し続け非常によろしくないので、注意しましょう。</p>

<h2>
<span id="6-描画周りを見直す" class="fragment"></span><a href="#6-%E6%8F%8F%E7%94%BB%E5%91%A8%E3%82%8A%E3%82%92%E8%A6%8B%E7%9B%B4%E3%81%99"><i class="fa fa-link"></i></a>6. 描画周りを見直す</h2>

<p>Unityの中で恐らく一番重いであろう処理は描画です。描画周りの最適化は、シェーダの特性を知っていれば知っている程最適化することができます。ぜひ今一度見直しましょう。</p>

<h4>
<span id="描画に関する用語を理解する" class="fragment"></span><a href="#%E6%8F%8F%E7%94%BB%E3%81%AB%E9%96%A2%E3%81%99%E3%82%8B%E7%94%A8%E8%AA%9E%E3%82%92%E7%90%86%E8%A7%A3%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>描画に関する用語を理解する</h4>

<p>描画に関する用語は非常に多くあります。GPUプロファイルとRenderingプロファイルでも記載されている用語とその意味を知ることは非常に大事なことなので、この機会にぜひ理解していただければと思います。Unityの描画を最適化する上で必要な用語は以下の通りです。マテリアルやシェーダが絡むので、詳細は <a href="#7-%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80%E3%83%9E%E3%83%86%E3%83%AA%E3%82%A2%E3%83%AB%E5%91%A8%E3%82%8A%E3%82%92%E8%A6%8B%E7%9B%B4%E3%81%99">7.シェーダ・マテリアル周りを見直す</a> で説明します。</p>

<ul>
<li><strong>Opaque</strong></li>
</ul>

<p>不透明描画を指す。基本的な描画はこれに当てはまる。</p>

<ul>
<li><strong>Transparent</strong></li>
</ul>

<p>透明描画を指す。不透明描画よりコストがかかる。</p>

<ul>
<li><strong>Post Process</strong></li>
</ul>

<p>画面全体のエフェクトを指す。かなり高価なのでどうしても必要な場面以外では使用しない事を推奨。</p>

<ul>
<li><strong>Batch</strong></li>
</ul>

<p>同一マテリアルである等のバッチング条件を満たした結合メッシュ単位の描画処理を指す。バッチ数を減らすこと自体が描画負荷を下げる事に繋がる。</p>

<ul>
<li><strong>Set Pass Call</strong></li>
</ul>

<p>マテリアルの設定値をシェーダ側に伝える処理を指す。シーン上のマテリアル数がここに影響してくる。このコール数が少ないほどパフォーマンスが上昇する。</p>

<ul>
<li><strong>Triangles</strong></li>
</ul>

<p>所謂ポリゴン数。頂点シェーダのパフォーマンスに影響するので、Trianglesが少ないほどパフォーマンスが良くなる。</p>

<ul>
<li><strong>Vertices</strong></li>
</ul>

<p>頂点数。これも頂点シェーダのパフォーマンスに影響する。少ない方が良い。</p>

<h4>
<span id="オクルージョンカリングを有効活用する" class="fragment"></span><a href="#%E3%82%AA%E3%82%AF%E3%83%AB%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E3%82%AB%E3%83%AA%E3%83%B3%E3%82%B0%E3%82%92%E6%9C%89%E5%8A%B9%E6%B4%BB%E7%94%A8%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>オクルージョンカリングを有効活用する</h4>

<p>オブジェクト数が多い時に有効なのはオクルージョンカリングです。これはオブジェクトの後ろに隠れているオブジェクトの描画を行わないというもので、ドローコール数自体を下げパフォーマンスを上げる事ができる非常に優れた手法です。似たカリング手法にフラスタムカリングがあります。これはカメラの描画領域外のオブジェクトを描画しないというものです。似ているので注意しましょう。</p>

<p>フラスタムカリングはUnityは自動で行ってくれますが、オクルージョンカリングは手順を踏まなければ自動で行ってくれません。比較的簡単に設定できるので、ぜひ設定しましょう。</p>

<p>まず、シーン上で動かないオブジェクトを選択します(フィールドや小物等)。次に選択したオブジェクトが遮蔽物になるか遮蔽されるものになるかを決めます。例えば、フィールド上に配置された小物は遮蔽されるもので、壁などは遮蔽物となりますね。決めたらインスペクタ上で遮蔽物はOcculuder Static, 遮蔽されるものはOccludee Staticを指定してあげましょう。Staticの隣の逆▼から選ぶことができます。</p>

<p><a href="https://camo.qiitausercontent.com/01c5b88a4e34b6ca7328bacebfe3e66024818c61/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3131333539352f62383137646565632d646262302d333062652d326564302d3665346363383631313363302e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F113595%2Fb817deec-dbb0-30be-2ed0-6e4cc86113c0.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=614ee1f50ab03fd413ee7653d930113d" alt="performance006.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/113595/b817deec-dbb0-30be-2ed0-6e4cc86113c0.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F113595%2Fb817deec-dbb0-30be-2ed0-6e4cc86113c0.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=e48d838af0ee381f68aea9153b4aa8a2 1x" loading="lazy"></a></p>

<p>指定が終えたら、[Window] - [Rendering] - [Occlusion Culling]を選択します。するとオクルージョンカリング設定が開かれるので、そのまま[Bake]でオクルージョンエリアを作成しましょう。これで、カメラに隠れたもの(遮蔽されるもの)は描画対象外になります。</p>

<p>動くものには適用されないので、動かないとわかっているオブジェクトにだけ設定してあげましょう。</p>

<h4>
<span id="ポストプロセスをなるべく使わない" class="fragment"></span><a href="#%E3%83%9D%E3%82%B9%E3%83%88%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E3%82%92%E3%81%AA%E3%82%8B%E3%81%B9%E3%81%8F%E4%BD%BF%E3%82%8F%E3%81%AA%E3%81%84"><i class="fa fa-link"></i></a>ポストプロセスをなるべく使わない</h4>

<p>ポストプロセスは、アンチエイリアスやブラー、ブルームといった描画が終わった後のエフェクト効果を指します。これらはすべてピクセルシェーダで行われるので非常に高価な処理となります（画面全体の1ピクセル毎にエフェクト効果を適用するイメージ）。そのため、スマートフォン向けアプリではできる限り使うべきではありません。見た目はよくなりますが非常に重いです。パフォーマンスとグラフィックのトレードオフの代表格なので注意しましょう。</p>

<h4>
<span id="モデルにlodを適用し無駄な頂点シェーダ処理を省く" class="fragment"></span><a href="#%E3%83%A2%E3%83%87%E3%83%AB%E3%81%ABlod%E3%82%92%E9%81%A9%E7%94%A8%E3%81%97%E7%84%A1%E9%A7%84%E3%81%AA%E9%A0%82%E7%82%B9%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80%E5%87%A6%E7%90%86%E3%82%92%E7%9C%81%E3%81%8F"><i class="fa fa-link"></i></a>モデルにLODを適用し無駄な頂点シェーダ処理を省く</h4>

<p>モデルの描画に使用されるシェーダは基本、頂点シェーダとピクセルシェーダ(フラグメントシェーダ)に分かれています(それ以外もあります)。頂点シェーダのパフォーマンスはモデルの頂点数に依存し、ピクセルシェーダのパフォーマンスは画面に映るピクセル数と解像度に依存します。</p>

<p>しかし、例えばモデルがすごく遠くに描画された場合を考えてみましょう。ピクセルシェーダはモデルのピクセル数が減るので処理負荷も減りますが、頂点シェーダはモデルの頂点数に依存するので負荷は下がりません。これは非常に無駄な処理となります。</p>

<p>そこで、有効となるのがモデルにLOD(Level Of Detail)を適用することです。LODはカメラからの距離によってモデルのメッシュを使い分ける事で、遠くに行けば行くほどローポリのモデルを使います。これにより無駄な頂点シェーダを無くしパフォーマンスを向上させることができます。</p>

<p>ゲームオブジェクトのコンポーネントとして[LOD Group]を追加し、それぞれの距離に応じたメッシュを指定してあげればOKです。メッシュを複数用意しなくてはならないので少し大変ではありますが、ぜひ活用してみてはいかがでしょうか。</p>

<h2>
<span id="7-シェーダマテリアル周りを見直す" class="fragment"></span><a href="#7-%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80%E3%83%9E%E3%83%86%E3%83%AA%E3%82%A2%E3%83%AB%E5%91%A8%E3%82%8A%E3%82%92%E8%A6%8B%E7%9B%B4%E3%81%99"><i class="fa fa-link"></i></a>7. シェーダ・マテリアル周りを見直す</h2>

<p>描画に関連するものの中で、マテリアルやシェーダに関連する項目はここで説明します。描画というのは、内部でマテリアルデータを使ってシェーダプログラムを走らせることを指すので、マテリアルやシェーダの扱いというのは非常に大事になります。ぜひ見直していただければと思います。</p>

<h4>
<span id="なるべくマテリアルシェーダを統一する" class="fragment"></span><a href="#%E3%81%AA%E3%82%8B%E3%81%B9%E3%81%8F%E3%83%9E%E3%83%86%E3%83%AA%E3%82%A2%E3%83%AB%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80%E3%82%92%E7%B5%B1%E4%B8%80%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>なるべくマテリアル(シェーダ)を統一する</h4>

<p>マテリアルを扱う上で一番大事なのは、マテリアルを可能な限り統一することです。これは非常に重要なので留意してください。なぜ重要かというと、共通のマテリアルを使うことでBatchがまとまり、マテリアル切り替えによるSetPass Callが純粋に減るからです。つまり、シェーダプログラムを走らせる回数が少なくなるのでパフォーマンスも良くなります。逆に、マテリアルやシェーダがバラバラだとBatchやSetPass Callがその分増えるのでパフォーマンスは落ちます。</p>

<p>シェーダを扱う方であれば分かる事ですが、マテリアルというのはシェーダ(GPU)に渡すパラメータを指し、シェーダはそのままシェーダプログラムの事を指します。ドローコール(シェーダプログラムを実行する事)はパラメータ、メッシュ、シェーダが変わる度に呼ばなければならないので、パラメータは少なく、メッシュはまとめて、シェーダ切り替えも少なくする事が最適化の一番の近道ということになります。</p>

<p>なので、テクスチャを１つにまとめるのが良いというのは上記の理由からなのです。</p>

<h4>
<span id="インスタンシングを使う" class="fragment"></span><a href="#%E3%82%A4%E3%83%B3%E3%82%B9%E3%82%BF%E3%83%B3%E3%82%B7%E3%83%B3%E3%82%B0%E3%82%92%E4%BD%BF%E3%81%86"><i class="fa fa-link"></i></a>インスタンシングを使う</h4>

<p>Batchを少なくする事(メッシュをまとめる事)が大事だと先ほど述べましたが、Unityは自動的にはメッシュをまとめてくれません。<del>まとめるにはインスタンシングというものを有効にしなければなりません。インスタンシングとは、同一マテリアルのオブジェクトのメッシュインデックスをつなげる事を指し、詰まるところメッシュをまとめるということになります。</del></p>

<p>※12/18追記、バッチとインスタンシングの説明がごっちゃになっていたので修正します。<br>
Unityはdynamic batchを有効にするとまとめる事の出来るメッシュインデックス配列を動的につなげる事で１つのバッチにします。メッシュは同一メッシュでなくても構いません。この処理はCPU上で行われます。一方、インスタンシングを有効にすると、GPU内に同一メッシュのtransformリストを生成し、このリストを使ってシェーダを走らせることであたかも１バッチで描画しているようにします。この処理はGPU内部のみで行われるためCPU負荷がかかりません。バッチはCPUでインデックスを動的につなげるのでCPU負荷がかかりやすいので注意してください。</p>

<p>インスタンシングは簡単にでき、マテリアルのチェックボックスにチェックを入れればいいだけです。</p>

<p><a href="https://camo.qiitausercontent.com/744a5bcc2d80c4781a9e6ee397c6a4529bb9d050/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3131333539352f61626638383538352d346162352d613235642d393631652d3665616236336233626533632e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F113595%2Fabf88585-4ab5-a25d-961e-6eab63b3be3c.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=813bc9b207a90027f37d053e66f81ff4" alt="performance007.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/113595/abf88585-4ab5-a25d-961e-6eab63b3be3c.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F113595%2Fabf88585-4ab5-a25d-961e-6eab63b3be3c.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=675f092fe327108e83331486bc77b262 1x" loading="lazy"></a></p>

<p>ビルトインシェーダであれば[Enable GPU Instancing]という項目があるのでチェックを入れてあげましょう。ただし注意点として、同一マテリアルのオブジェクトが複数あることが前提となります。１つしかないオブジェクトなのにインスタンシングを有効にしてしまうとインスタンシングの準備コード分無駄な処理を行う事になるので逆にパフォーマンスが落ちます。注意してください。</p>

<h4>
<span id="自作シェーダの無駄を取り除く" class="fragment"></span><a href="#%E8%87%AA%E4%BD%9C%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80%E3%81%AE%E7%84%A1%E9%A7%84%E3%82%92%E5%8F%96%E3%82%8A%E9%99%A4%E3%81%8F"><i class="fa fa-link"></i></a>自作シェーダの無駄を取り除く</h4>

<p>自作シェーダを使用している場合、シェーダのパフォーマンスは描画パフォーマンスに直結しますので、無駄な処理をしていないかぜひ見直してください。</p>

<ul>
<li><strong>精度を下げる</strong></li>
</ul>

<p>floatは高精度で使いたくなりますがシェーダでfloatが必要な場合は意外と少ないです。スタンドアロンであればfloatでもパフォーマンスに影響はあまり出ないですが、スマートフォンだとシェーダの精度でもパフォーマンスに影響が出やすいので、なるべく下げる様にしましょう。</p>

<p>基本的に以下の様に指定してあげるのが良いです。</p>

<p>頂点データや法線データ, 計算関連：half<br>
色データ：fixed</p>

<ul>
<li><strong>if, forを展開する</strong></li>
</ul>

<p>GPUはifやforが苦手です。最近は使用しても処理の影響が少なくなってきましたが、それでも使うのはできるだけ避けたほうが良いです。解決法としては以下の様にするのが良いでしょう。</p>

<p>if：lerpやstepで代用<br>
for：unrollして展開してしまう</p>

<ul>
<li><strong>ピクセルシェーダの計算を頂点シェーダに持ってくる</strong></li>
</ul>

<p>頂点シェーダに対してピクセルシェーダは計算量が多いことがほとんどです。頂点シェーダは頂点数依存ですが、ピクセルシェーダは画面解像度依存だからです。例えば解像度1080x1920で画面いっぱいにモデルを描画するとなると約200万のピクセルシェーダが走ることになります。それならば、多くても数万レベルの頂点シェーダにピクセルシェーダで行う予定だった処理を持って行けば約1/100で済むことになりますね。ライティングは頂点シェーダに持っていけることがほとんどなので、移動しても見た目に影響が出ないのであれば移動させましょう。</p>

<ul>
<li><strong>高価な関数をなるべく使わない</strong></li>
</ul>

<p>シェーダには処理の重い関数があります。それらを認識した上でコーディングする事をお勧めします。1ピクセルに対し1回以上下記の関数を使わないようにしましょう。</p>

<p>処理の重い関数：pow, exp, log, cos, sin, tan</p>

<h4>
<span id="なるべくモバイルに最適化されたビルトインシェーダを使う" class="fragment"></span><a href="#%E3%81%AA%E3%82%8B%E3%81%B9%E3%81%8F%E3%83%A2%E3%83%90%E3%82%A4%E3%83%AB%E3%81%AB%E6%9C%80%E9%81%A9%E5%8C%96%E3%81%95%E3%82%8C%E3%81%9F%E3%83%93%E3%83%AB%E3%83%88%E3%82%A4%E3%83%B3%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80%E3%82%92%E4%BD%BF%E3%81%86"><i class="fa fa-link"></i></a>なるべくモバイルに最適化されたビルトインシェーダを使う</h4>

<p>Unityにはモバイルに最適化されたシェーダが用意されています。基本的に自作シェーダより処理が軽いので、なるべく利用するようにしてください。パーティクルも同様です。</p>

<h2>
<span id="8-ライトシャドウ周りを見直す" class="fragment"></span><a href="#8-%E3%83%A9%E3%82%A4%E3%83%88%E3%82%B7%E3%83%A3%E3%83%89%E3%82%A6%E5%91%A8%E3%82%8A%E3%82%92%E8%A6%8B%E7%9B%B4%E3%81%99"><i class="fa fa-link"></i></a>8. ライト・シャドウ周りを見直す</h2>

<p>ライトとシャドウはどちらも重い処理です。なぜ重いかを理解して見直すようにしましょう。</p>

<h4>
<span id="無駄にライトを増やさない" class="fragment"></span><a href="#%E7%84%A1%E9%A7%84%E3%81%AB%E3%83%A9%E3%82%A4%E3%83%88%E3%82%92%E5%A2%97%E3%82%84%E3%81%95%E3%81%AA%E3%81%84"><i class="fa fa-link"></i></a>無駄にライトを増やさない</h4>

<p>シーン上のライトの数は極力少なくすることをお勧めします（正確にはモデルにリアルタイムで影響するライト数）。なぜかというと、ライトの数に比例してシェーダプログラムを走らせる回数も増えるからです。これはシェーダの性質上そうするしか正確にライトの計算ができないため、ライトの数が増えたらその分ライト計算ループ処理が増えると認識してください。ForwardAddのないシェーダであれば影響しませんが、ForwardAddのあるシェーダはもろ影響します。注意しましょう。</p>

<h4>
<span id="シャドウキャストレシーブシャドウは最小限に" class="fragment"></span><a href="#%E3%82%B7%E3%83%A3%E3%83%89%E3%82%A6%E3%82%AD%E3%83%A3%E3%82%B9%E3%83%88%E3%83%AC%E3%82%B7%E3%83%BC%E3%83%96%E3%82%B7%E3%83%A3%E3%83%89%E3%82%A6%E3%81%AF%E6%9C%80%E5%B0%8F%E9%99%90%E3%81%AB"><i class="fa fa-link"></i></a>シャドウキャスト、レシーブシャドウは最小限に</h4>

<p>影の影響を受ける必要のないオブジェクトはレシーブシャドウをオフにし、影を発生させる必要のないシーンではシャドウキャストをオフにしましょう。そもそも影を扱わないのであれば、ライトのShadow TypeをNo Shadowsにしてしまいましょう。</p>

<p>なぜ影が重いかというと、影を描画するためには影を発生させるオブジェクトの深度バッファを予め計算しなければならないからです。つまり影を発生させるというのは、モデルを影用に描画しているということになります。そして、それは影の深度バッファの解像度分負荷が増えます。だから影は重いのです。影の有無、深度バッファ解像度だけで処理速度が2~3ms変わったりします。注意しましょう。</p>

<h2>
<span id="9-コーディングを見直す" class="fragment"></span><a href="#9-%E3%82%B3%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0%E3%82%92%E8%A6%8B%E7%9B%B4%E3%81%99"><i class="fa fa-link"></i></a>9. コーディングを見直す</h2>

<p>メモリ周りと関係してくるので説明が被るかもしれませんが、今一度理解を深めていただければと思います。</p>

<h4>
<span id="シーンの途中でinstantiatedestroyを使わない" class="fragment"></span><a href="#%E3%82%B7%E3%83%BC%E3%83%B3%E3%81%AE%E9%80%94%E4%B8%AD%E3%81%A7instantiatedestroy%E3%82%92%E4%BD%BF%E3%82%8F%E3%81%AA%E3%81%84"><i class="fa fa-link"></i></a>シーンの途中でInstantiate、Destroyを使わない</h4>

<p>シーンの途中でInstantiate、Destroyを使わないようにしましょう。メモリの確保、解放が直に来るのでパフォーマンスとGCの関係上よろしくないです。なので、ゲームオブジェクトの追加はシーン中にはせず、シーン開始時に最大数分確保し、必要な時に<code>gameObject.SetActive(true);</code>必要がなくなった時は<code>gameObject.SetActive(false);</code>としましょう。</p>

<h4>
<span id="キャッシュを多用する" class="fragment"></span><a href="#%E3%82%AD%E3%83%A3%E3%83%83%E3%82%B7%E3%83%A5%E3%82%92%E5%A4%9A%E7%94%A8%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>キャッシュを多用する</h4>

<p>GetComponent、FindObject系はUpdate中に行わないようにしましょう。Update中に検索を行うのは無駄です。Unityは内部で自動的にキャッシュしてくれるなんてことはありません。自分でStartやAwake時にキャッシュし、それを使うようにしましょう。</p>

<h4>
<span id="高価な関数計算を認識する" class="fragment"></span><a href="#%E9%AB%98%E4%BE%A1%E3%81%AA%E9%96%A2%E6%95%B0%E8%A8%88%E7%AE%97%E3%82%92%E8%AA%8D%E8%AD%98%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>高価な関数・計算を認識する</h4>

<p><a href="#7-%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80%E3%83%9E%E3%83%86%E3%83%AA%E3%82%A2%E3%83%AB%E5%91%A8%E3%82%8A%E3%82%92%E8%A6%8B%E7%9B%B4%E3%81%99">7.シェーダ・マテリアル周りを見直す</a> でも説明しましたが高価な関数や計算はシェーダでもスクリプトでも変わりません。重いものは重いです。Unityマニュアルにもこう書いてあります。</p>

<blockquote>
<p>超越関数 (Mathf.Sin、Mathf.Pow など)、除算、平方根は、すべて乗算の時間の 100 倍ほどかかります。大きなスケールで考えると大した時間ではないですが、それらを各フレームで何千回も呼び出すと、それは積もって大きくなります。</p>
</blockquote>

<p>除算は逆数を掛けるという処理に代替できますし、長さの比較はmagnitude同士ではなくsqrMagnitude同士で比較した方がはるかに高速です。なるべく高速な処理を行うように心がけましょう。</p>

<h1>
<span id="まとめ" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>まとめ</h1>

<p>いかがでしたでしょうか。既に知っていた最適化手法もあれば、初めて知った手法もあったのではないでしょうか。</p>

<p>上記すべてを実践する必要は全くありません。見た目とのトレードオフなものがほとんどなので。自分に合った見直しを行っていただければ十分です。</p>

<p>簡単にまとめると、以下の様になります。</p>

<ul>
<li>不必要なオブジェクト・コンポーネントは置かない</li>
<li>シーン中に動的生成・破棄はなるべくしない</li>
<li>重い処理を認識してなるべく使わない</li>
</ul>

<p>まだ紹介しきれていない手法も複数ありますが、それはまた別の機会に紹介できればと思います。<br>
それでは。</p>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Fyoship1639%2Fitems%2F7339a6201b44a24fbdfe&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Fyoship1639%2Fitems%2F7339a6201b44a24fbdfe&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/yoship1639/items/7339a6201b44a24fbdfe/likers" class="css-1iupg5d">315</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">289</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/7339a6201b44a24fbdfe/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/yoship1639/items/7339a6201b44a24fbdfe/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/yoship1639/items/7339a6201b44a24fbdfe/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/yoship1639/items/7339a6201b44a24fbdfe/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/yoship1639/items/7339a6201b44a24fbdfe.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-d19f936f-1f54-480b-b269-16162a9047f5">{"authorAnalyticsTrackingId":null,"organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-081cc08f-46aa-4d71-9d64-dae878e1140f"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-081cc08f-46aa-4d71-9d64-dae878e1140f">{}</script>
      
<div id="LoginModal-react-component-45136786-8bf1-458d-bee8-865662ac6b8a"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-45136786-8bf1-458d-bee8-865662ac6b8a">{}</script>
      
<div id="StockModal-react-component-ab6ebb0c-62f4-4195-85a9-ac61d7767282"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-ab6ebb0c-62f4-4195-85a9-ac61d7767282">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;Y52NFFGysbj5yVpEhEVE+wRHe2s9ndjKLRXqhop7bwYWxYk5rWITe9sIjB7Mb6+DeQrZmbh4SQaZTjU6lNvkUA==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\u003cp\u003e本記事は \u003ca href=\"https://qiita.com/advent-calendar/2019/unityforpro\"\u003e【unityプロ技】 Advent Calendar 2019\u003c/a\u003e 16日目の記事です。\u003cbr\u003e\n本記事で記載されたソースコードはすべて\u003ccode\u003eパブリックドメイン\u003c/code\u003eです。\u003c/p\u003e\n\n\u003cp\u003e修正履歴\u003cbr\u003e\n・12/18 インスタンシングの説明を修正\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"はじめに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eはじめに\u003c/h1\u003e\n\n\u003cp\u003eUnityアプリを安定化させるために試行錯誤を繰り返している\u003ca href=\"https://twitter.com/yoship1639\" rel=\"nofollow noopener\" target=\"_blank\"\u003eyoship1639\u003c/a\u003eです。\u003c/p\u003e\n\n\u003cp\u003e社内ではフロント側の開発基盤構成選定や共通基盤開発、ロジック、物理シミュレーション、ビジュアル周り(カメラワーク、シェーダ、演出)、最適化等様々なタスクを担当しています。\u003c/p\u003e\n\n\u003cp\u003eUnityはゲーム開発を大幅に効率化できる素晴らしいツールですが、そのすべての最適化が自動で行われる訳ではない事はご存じかと思います。詰まるところ、開発者側が最適化の手法を知っていなければUnityアプリの安定した動作を確保することはできません。しかし、参考文献が散見されどこを見直せばいいのか分からなかったりリファレンスを熟読してもよく分からなかったりすることもあるかと思います。\u003c/p\u003e\n\n\u003cp\u003e近年のスマートフォンは性能が高くなりつつありますが、すべてのユーザが高性能なスペックのスマートフォンを持ち合わせている訳ではありません。ユーザのスマートフォン1台の平均使用年数は4年を超えています。つまり、平均～低スペックなスマートフォンでも安定した動作を保証できなければユーザの満足度を高めることはできないので、高速かつ安定した動作は非常に重要となります。\u003c/p\u003e\n\n\u003cp\u003eそこで、高速かつ安定した動作を手に入れるためにどこを見直せばいいのかを9選でまとめてみました。安定した動作を提供するために、自分は何をしたらいいのかを知り、どこを直せばいいのかを認識し、実際に見直していただければと思います。\u003c/p\u003e\n\n\u003cp\u003e※筆者のUnity現環境は2018.4.12fのため本記事の設定内容もそれに準じています。\u003cbr\u003e\n※本記事は特定プラットフォーム専用の最適化の記事ではありませんがスマートフォン向けアプリに寄った記事となります。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"見直すべき事9選\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A6%8B%E7%9B%B4%E3%81%99%E3%81%B9%E3%81%8D%E4%BA%8B9%E9%81%B8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e見直すべき事9選\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"プロファイラをまず見る\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%97%E3%83%AD%E3%83%95%E3%82%A1%E3%82%A4%E3%83%A9%E3%82%92%E3%81%BE%E3%81%9A%E8%A6%8B%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eプロファイラをまず見る\u003c/h2\u003e\n\n\u003cp\u003eまず一番最初にやるべき事は\u003cstrong\u003eプロファイラを見る事\u003c/strong\u003eです。これを見れば自分のUnityアプリのどこがボトルネックになっているのかをほぼ確実に特定できます。どこが悪さしているのかを認識するのは一番大事なところなので、絶対に見ましょう。\u003c/p\u003e\n\n\u003cp\u003eプロファイラは[Window] - [Analysis] - [Profiler]で確認できます。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/d788f11649140cbc8ca59a443bf1efebbb7feb46/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3131333539352f35346563633938302d646130332d666466312d356164622d3433376330613531333938322e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F113595%2F54ecc980-da03-fdf1-5adb-437c0a513982.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=197f52619b0187740cca99d5a0df400a\" alt=\"performance002.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/113595/54ecc980-da03-fdf1-5adb-437c0a513982.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F113595%2F54ecc980-da03-fdf1-5adb-437c0a513982.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=aba3cd02af8fd1210eef58cb3530b69b 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eプロファイラを起動したら\u003cem\u003eRecord\u003c/em\u003eを押下しエディタでデバッグプレイしてください、プロファイラが動作し各種グラフを見ることができます。重要なのは、\u003cstrong\u003eCPU Usage\u003c/strong\u003eです。CPUがどのような使われ方をしているのかとフレームレートを知ることができます。\u003c/p\u003e\n\n\u003cp\u003eCPU Usageは恐らく大体の方が上図の形になっているのではないかと思います。なぜなら、比較的高性能なPCで作業しているはずなので。重要なのは\u003cstrong\u003e4~5年前の低スペックスマートフォン実機のプロファイル\u003c/strong\u003eです。このプロファイルが本当のプロファイル結果となります。(実機でのプロファイルのやり方等は説明しないので各自調べてください)\u003c/p\u003e\n\n\u003cp\u003e実機のプロファイルを見ていただくと、恐らくかなりグラフが乱れているのではないかと思います。既に乱れずに高速かつ安定に動作していたら本記事の目標を達成しているので以降の内容は参考程度に眺めていただければ幸いです。安定していない場合は、60fpsを常に下回る事を目標に見直していただければと思います。\u003c/p\u003e\n\n\u003cp\u003eCPU Usageのグラフの詳細と対処を説明します。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"rendering\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#rendering\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eRendering\u003c/h3\u003e\n\n\u003cp\u003e緑色のグラフは描画全般にかかった時間を示しています。主に不透明・透明オブジェクトの描画、影処理、遅延描画処理、ポストプロセス処理、UI描画処理にかかった時間がここに含まれています。このグラフがCPUの大部分を占めている場合は、描画系の処理の仕方を見直さなければなりません。\u003c/p\u003e\n\n\u003cp\u003eRenderingが悪さをしていると判明した場合、次に見るべきは\u003cstrong\u003eGPU Usage\u003c/strong\u003eと\u003cstrong\u003eRendering\u003c/strong\u003eです。GPU Usageはデフォルトで隠れているのでAdd ProfilerからGPUを選択しGPUプロファイリングを有効にしてください。すると先程説明した描画の詳細をグラフで見ることができます。\u003c/p\u003e\n\n\u003cp\u003eGPUプロファイルとRenderingプロファイルの詳細と対処は \u003ca href=\"#6-%E6%8F%8F%E7%94%BB%E5%91%A8%E3%82%8A%E3%82%92%E8%A6%8B%E7%9B%B4%E3%81%99\"\u003e6. 描画周りを見直す\u003c/a\u003e と \u003ca href=\"#7-%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80%E3%83%9E%E3%83%86%E3%83%AA%E3%82%A2%E3%83%AB%E5%91%A8%E3%82%8A%E3%82%92%E8%A6%8B%E7%9B%B4%E3%81%99\"\u003e7.シェーダ・マテリアル周りを見直す\u003c/a\u003e、\u003ca href=\"#8-%E3%83%A9%E3%82%A4%E3%83%88%E3%82%B7%E3%83%A3%E3%83%89%E3%82%A6%E5%91%A8%E3%82%8A%E3%82%92%E8%A6%8B%E7%9B%B4%E3%81%99\"\u003e8. ライト・シャドウ周りを見直す\u003c/a\u003e を見ていただければと思います。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"scripts\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#scripts\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eScripts\u003c/h3\u003e\n\n\u003cp\u003e青色のグラフはスクリプト全般にかかった時間を示しています。独自にコーディングしたスクリプトやUnityビルトインスクリプト(MonoBehaviourなど)がScriptsに含まれています。ここが乱れていたりスパイク(一瞬だけすごく時間がかかっている)が立っていたりする場合スクリプト周りを見直さなければなりません。\u003c/p\u003e\n\n\u003cp\u003eスクリプト周りの対処は \u003ca href=\"#5-%E3%83%A1%E3%83%A2%E3%83%AA%E5%91%A8%E3%82%8A%E3%82%92%E8%A6%8B%E7%9B%B4%E3%81%99\"\u003e5. メモリ周りを見直す\u003c/a\u003e と \u003ca href=\"#9-%E3%82%B3%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0%E3%82%92%E8%A6%8B%E7%9B%B4%E3%81%99\"\u003e9. コーディングを見直す\u003c/a\u003e を見てください。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"physics\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#physics\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ePhysics\u003c/h3\u003e\n\n\u003cp\u003eオレンジ色のグラフは物理処理全般にかかった時間を示しています。剛体(Rigidbody)、衝突判定、拘束処理、レイキャスト、トリガーなどが含まれています。このグラフは比較的乱れやすくスパイクも立ちやすいので、物理処理を多用している場合は優先的に見直した方が良いです。\u003c/p\u003e\n\n\u003cp\u003e物理処理周りの対処は \u003ca href=\"#4-%E7%89%A9%E7%90%86%E5%91%A8%E3%82%8A%E3%82%92%E8%A6%8B%E7%9B%B4%E3%81%99\"\u003e4. 物理周りを見直す\u003c/a\u003e を見てください。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"animation\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#animation\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eAnimation\u003c/h3\u003e\n\n\u003cp\u003e水色のグラフはアニメーション全般にかかった時間を示しています。AnimatorやAnimationによるFK,IKのスキンメッシュアニメーション(ボーンアニメーション)がここに含まれています。アニメーション数が多かったりボーンやIK構造が複雑だと乱れやすくなります。\u003c/p\u003e\n\n\u003cp\u003eアニメーション周りの対処は \u003ca href=\"3-%E3%82%A2%E3%83%8B%E3%83%A1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%92%E8%A6%8B%E7%9B%B4%E3%81%99\"\u003e3. アニメーションを見直す\u003c/a\u003e を見てください。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"garbagecollector\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#garbagecollector\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eGarbageCollector\u003c/h3\u003e\n\n\u003cp\u003e黄土色の様なよく分からない色のグラフはガベージコレクションにかかった時間を表しています。メモリ管理が甘いとスパイクが頻繁に立ちその度に一瞬アプリが硬直します。\u003c/p\u003e\n\n\u003cp\u003eGC周りの対処は \u003ca href=\"#5-%E3%83%A1%E3%83%A2%E3%83%AA%E5%91%A8%E3%82%8A%E3%82%92%E8%A6%8B%E7%9B%B4%E3%81%99\"\u003e5. メモリ周りを見直す\u003c/a\u003e を見てください。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"ui\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#ui\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eUI\u003c/h3\u003e\n\n\u003cp\u003e紫色のグラフはUI全般にかかった時間を示しています。説明するまでもなくUIのレイアウトや描画がここに含まれています。様々なテキストやテクスチャを動かしたりたくさん描画したりすると重くなったりします。\u003c/p\u003e\n\n\u003cp\u003eUI周りの対処は \u003ca href=\"#2-ui%E5%91%A8%E3%82%8A%E3%82%92%E8%A6%8B%E7%9B%B4%E3%81%99\"\u003e2. UI周りを見直す\u003c/a\u003e と \u003ca href=\"#6-%E6%8F%8F%E7%94%BB%E5%91%A8%E3%82%8A%E3%82%92%E8%A6%8B%E7%9B%B4%E3%81%99\"\u003e6. 描画周りを見直す\u003c/a\u003e、 \u003ca href=\"#7-%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80%E3%83%9E%E3%83%86%E3%83%AA%E3%82%A2%E3%83%AB%E5%91%A8%E3%82%8A%E3%82%92%E8%A6%8B%E7%9B%B4%E3%81%99\"\u003e7.シェーダ・マテリアル周りを見直す\u003c/a\u003e を見てください。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"その他vsync-global-illmination-other\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%9D%E3%81%AE%E4%BB%96vsync-global-illmination-other\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eその他(VSync, Global Illmination, Other)\u003c/h3\u003e\n\n\u003cp\u003e上記以外のVSync, Global Illmination, Otherは基本気にしなくて大丈夫です。一応簡単に説明すると、\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eVsync : リフレッシュレートに合わせてCPUを待機させている時間\u003c/li\u003e\n\u003cli\u003eGlobal Illmination : 大域照明(環境光や反射光を考慮した照明)にかかった時間。非常に重いため高精細表現をしない限り使わない\u003c/li\u003e\n\u003cli\u003eOther : それ以外にかかった時間。分別不能な内部処理のため考慮しなくていい。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eとなります。\u003c/p\u003e\n\n\u003cp\u003eプロファイラでボトルネックが判明したら、実際に見直していきます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"1-クオリティ設定を見直す\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#1-%E3%82%AF%E3%82%AA%E3%83%AA%E3%83%86%E3%82%A3%E8%A8%AD%E5%AE%9A%E3%82%92%E8%A6%8B%E7%9B%B4%E3%81%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e1. クオリティ設定を見直す\u003c/h2\u003e\n\n\u003cp\u003e一番最初に確認するべき事ではないですが、Unityのクオリティ設定を見直すだけでも動作が改善されます。スマートフォン向けアプリはオーバースペックな設定をするべきではないので、ぜひ見直していきましょう。\u003c/p\u003e\n\n\u003cp\u003e[Edit] - [Project Settings] - [Quality]を開いてください。すると以下の画面が表示されます。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/d15937ac035863bb88812205be81eff047021ec5/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3131333539352f30613731353335622d313963652d333535392d363039642d3831653530326465636431382e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F113595%2F0a71535b-19ce-3559-609d-81e502decd18.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=821016fcce63e77c1d78b0a29ba2b0d7\" alt=\"performance003.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/113595/0a71535b-19ce-3559-609d-81e502decd18.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F113595%2F0a71535b-19ce-3559-609d-81e502decd18.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=66e27b7f4298520d363b787c93f050a3 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e設定すべきは以下の項目です。\u003cbr\u003e\n※ケースバイケースなので自分のプロジェクトにあった設定をしてください\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"pixel-light-count-を小さくするもしくは0にする\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#pixel-light-count-%E3%82%92%E5%B0%8F%E3%81%95%E3%81%8F%E3%81%99%E3%82%8B%E3%82%82%E3%81%97%E3%81%8F%E3%81%AF0%E3%81%AB%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ePixel Light Count を小さくする。もしくは0にする\u003c/h4\u003e\n\n\u003cp\u003eもし、プロジェクト内で\u003cstrong\u003eライトを使っていない場合\u003c/strong\u003eはPixel Light Countを0にしてください。ライトを扱っている場合はできる限り小さい値にしてください。これで無駄なライト処理が省かれます。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"texture-qualityを下げる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#texture-quality%E3%82%92%E4%B8%8B%E3%81%92%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eTexture Qualityを下げる\u003c/h4\u003e\n\n\u003cp\u003e高精細なスプライトやテクスチャを必要としていない場合はHalf Res以下にしましょう。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"anisotropic-texturesをオフにする\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#anisotropic-textures%E3%82%92%E3%82%AA%E3%83%95%E3%81%AB%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eAnisotropic Texturesをオフにする\u003c/h4\u003e\n\n\u003cp\u003e異方性フィルタリングを扱わない場合はDisableにしましょう。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"anti-aliasingをオフにする\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#anti-aliasing%E3%82%92%E3%82%AA%E3%83%95%E3%81%AB%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eAnti Aliasingをオフにする\u003c/h4\u003e\n\n\u003cp\u003eジャギーが気になる場合を除いてDisableにしましょう。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"soft-particlesをオフにする\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#soft-particles%E3%82%92%E3%82%AA%E3%83%95%E3%81%AB%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eSoft Particlesをオフにする\u003c/h4\u003e\n\n\u003cp\u003eポリゴンとの境界付近にパーティクルを描画しないのであればSoft Particleは必要ないのでオフにしましょう。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"realtime-reflection-probesをオフにする\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#realtime-reflection-probes%E3%82%92%E3%82%AA%E3%83%95%E3%81%AB%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eRealtime Reflection Probesをオフにする\u003c/h4\u003e\n\n\u003cp\u003eスマートフォンアプリなら必要ないことがほとんどなのでオフにしましょう。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"resolution-scaling-fixed-dpi-factorを下げる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#resolution-scaling-fixed-dpi-factor%E3%82%92%E4%B8%8B%E3%81%92%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eResolution Scaling Fixed DPI Factorを下げる\u003c/h4\u003e\n\n\u003cp\u003eスマートフォンは解像度が高く描画負荷も大きいため0.5くらいにしても問題ないです。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"texture-streamingをオフにする\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#texture-streaming%E3%82%92%E3%82%AA%E3%83%95%E3%81%AB%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eTexture Streamingをオフにする\u003c/h4\u003e\n\n\u003cp\u003e普段使わないはずなのでオフにしましょう。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"shadowsを無効にする\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#shadows%E3%82%92%E7%84%A1%E5%8A%B9%E3%81%AB%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eShadowsを無効にする\u003c/h4\u003e\n\n\u003cp\u003eもしプロジェクト内で\u003cstrong\u003e影を扱わない\u003c/strong\u003eのであればShadowsをDisable Shadowsにしましょう。影の計算が省かれます。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"shadow-resolutionを下げる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#shadow-resolution%E3%82%92%E4%B8%8B%E3%81%92%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eShadow Resolutionを下げる\u003c/h4\u003e\n\n\u003cp\u003e影の深度バッファ解像度です。高いと描画負荷も高いので低くしましょう。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"blend-weightsを少なくする\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#blend-weights%E3%82%92%E5%B0%91%E3%81%AA%E3%81%8F%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eBlend Weightsを少なくする\u003c/h4\u003e\n\n\u003cp\u003eスキニングのボーンブレンド数です。精細なスキンメッシュアニメーションを求めていないのであれば1 Boneにしましょう。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"vsync-countを無効にする\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#vsync-count%E3%82%92%E7%84%A1%E5%8A%B9%E3%81%AB%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eVSync Countを無効にする\u003c/h4\u003e\n\n\u003cp\u003e画面のリフレッシュレートに合わせて同期させるかの設定です。基本的に自分でプロジェクトにあったフレームレートを設定した方がよいのでDon't Syncにしましょう。次に以下のコードでフレームレートを設定できます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eApplication.targetFrameRate = 60;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"particle-raycast-budgetを下げる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#particle-raycast-budget%E3%82%92%E4%B8%8B%E3%81%92%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eParticle Raycast Budgetを下げる\u003c/h4\u003e\n\n\u003cp\u003eパーティクルの衝突レイキャストの最大数です。パーティクルの品質を求めていないのであれば4, 16辺りに設定しましょう。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"2-ui周りを見直す\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#2-ui%E5%91%A8%E3%82%8A%E3%82%92%E8%A6%8B%E7%9B%B4%E3%81%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2. UI周りを見直す\u003c/h2\u003e\n\n\u003cp\u003eUIを最適化したい場合、キャンバスの仕様とバッチングというものを知らなければなりません。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"静的なcanvasと動的なcanvasを分ける\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%9D%99%E7%9A%84%E3%81%AAcanvas%E3%81%A8%E5%8B%95%E7%9A%84%E3%81%AAcanvas%E3%82%92%E5%88%86%E3%81%91%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e静的なCanvasと動的なCanvasを分ける\u003c/h4\u003e\n\n\u003cp\u003eUIキャンバスは、\u003cstrong\u003e内容に変化がなければ描画負荷はほぼかかりません\u003c/strong\u003e（内容は、位置の変更、テクスチャの差し替え、マテリアルの差し替え等です）。Unityは賢いので同じ内容のものを毎回計算し直すということをしません。逆を言えば内容に変化があったらキャンバス内すべての再構築処理が走ります。しかし、何も変化がないキャンバスというのは難しいものです。なので\u003cstrong\u003e変化のない静的キャンバスと変化が多い動的キャンバスに分ける\u003c/strong\u003eのが最適解となります。これにより、動的な箇所のみ再計算させることができます。見落としがちな項目なので注意しましょう。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"テクスチャはできるだけまとめる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%86%E3%82%AF%E3%82%B9%E3%83%81%E3%83%A3%E3%81%AF%E3%81%A7%E3%81%8D%E3%82%8B%E3%81%A0%E3%81%91%E3%81%BE%E3%81%A8%E3%82%81%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eテクスチャはできるだけまとめる\u003c/h4\u003e\n\n\u003cp\u003eバッチングというのは、簡単に説明すると一度にまとめて描画するということです。UIは同一マテリアルかつ同一テクスチャのオブジェクトをまとめて描画することをします。これによりいくら同じテクスチャを描画しまくっても描画負荷がほぼ変わらないのです。逆を言えば、マテリアルやテクスチャが変化するとバッチングは効かなくなります。なので、なるべく同一マテリアルかつ同一テクスチャであることを心掛けなければなりません。しかし、マテリアルは共通化できてもテクスチャを共通化するのは普通できません。\u003c/p\u003e\n\n\u003cp\u003eUnityにはSprite Atlasという機能があります。これはテクスチャを１つにまとめてパッキングするというものです。これを使うことで複数テクスチャが１つのテクスチャになるので、あとはマテリアルの変更をしない限り、１度のバッチでまとめて描画することができるようになります。ぜひ活用しましょう。\u003c/p\u003e\n\n\u003cp\u003eUIは基本的に上記２つを意識するだけで十分最適化できます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"3-アニメーションを見直す\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#3-%E3%82%A2%E3%83%8B%E3%83%A1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%92%E8%A6%8B%E7%9B%B4%E3%81%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e3. アニメーションを見直す\u003c/h2\u003e\n\n\u003cp\u003eアニメーションの負荷ははボーンのスキニング負荷とほぼ同値です。つまりスキニング負荷を抑える様に意識することが重要となります。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"ボーンの数を減らす\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%9C%E3%83%BC%E3%83%B3%E3%81%AE%E6%95%B0%E3%82%92%E6%B8%9B%E3%82%89%E3%81%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eボーンの数を減らす\u003c/h4\u003e\n\n\u003cp\u003eこれは安直な案ですが一番効果があります。なぜならスキニング負荷が純粋に減るからです。そのため、扱うモデルのボーン構造自体が重要となります。例えば、カメラが寄ることがないのに手の指にまでボーンが入っていたりすると、指先まで見えることがないのにその分無駄な処理を行っていることになります。なので、モデルのポリゴン削減だけでなく、ボーンの削減も一緒に考えるのがいいでしょう。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"ikをなるべく使わない\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#ik%E3%82%92%E3%81%AA%E3%82%8B%E3%81%B9%E3%81%8F%E4%BD%BF%E3%82%8F%E3%81%AA%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eIKをなるべく使わない\u003c/h4\u003e\n\n\u003cp\u003eIK(インバースキネマティクス)は負荷の高い処理です。ボーンの先からボーンの根元まで計算を繰り返すので通常のスキニングより処理負荷がかかります。そのため、どうしてもIKが必要な場面を除いては、IKをFKに焼いてしまいIKを無くしてしまうのが良いでしょう。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"画面に映る時のみアニメーションさせる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%94%BB%E9%9D%A2%E3%81%AB%E6%98%A0%E3%82%8B%E6%99%82%E3%81%AE%E3%81%BF%E3%82%A2%E3%83%8B%E3%83%A1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%95%E3%81%9B%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e画面に映る時のみアニメーションさせる\u003c/h4\u003e\n\n\u003cp\u003e画面外にあるモデルをアニメーションさせるのは、どうしても必要な場合を除いて皆無です。なので、画面内に映る場合のみアニメーションさせるようにしましょう。この設定は簡単にでき、Skinned Mesh RendererのUpdate When Offscreenをオフにすればいいだけです。デフォルトでオフになっていますが、今一度見直しましょう。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"gpuにスキニングさせる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#gpu%E3%81%AB%E3%82%B9%E3%82%AD%E3%83%8B%E3%83%B3%E3%82%B0%E3%81%95%E3%81%9B%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eGPUにスキニングさせる\u003c/h4\u003e\n\n\u003cp\u003eスキニングは通常CPUが担当します。トランスフォームの階層構造を持つ行列やクォータニオンの計算をGPUに担当させるのは結構骨の折れるコーディングだからです。しかし、Unityではチェックボックス１つでGPUにスキニングを担当させることができます。行列演算に関しては右に出るものがないGPUなので、処理の高速化が望めます。\u003c/p\u003e\n\n\u003cp\u003eプレイヤー設定のOther SettingsにGPU Skinningという項目があるので、オンにしましょう。これで、自動的にGPUスキニングになります。(※古すぎる端末だと効果がない可能性があります)\u003c/p\u003e\n\n\u003cp\u003e注意点としては、逆にGPU負荷が高くなりすぎて処理が遅くなってしまうことがあります。CPUとGPUの丁度いいバランスを見つけてそれに合った設定をするようにしましょう。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"4-物理周りを見直す\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#4-%E7%89%A9%E7%90%86%E5%91%A8%E3%82%8A%E3%82%92%E8%A6%8B%E7%9B%B4%E3%81%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e4. 物理周りを見直す\u003c/h2\u003e\n\n\u003cp\u003e物理周りを見直したい場合、物理エンジンそのものの特性をある程度知る必要があります。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"rigidbody-collider-jointは最低限にする\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#rigidbody-collider-joint%E3%81%AF%E6%9C%80%E4%BD%8E%E9%99%90%E3%81%AB%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eRigidbody, Collider, Jointは最低限にする\u003c/h4\u003e\n\n\u003cp\u003eまず、Unityは物理エンジンとしてPhysXを使っています。内製のものもありますがデフォルトはPhysXです。物理エンジンは基本的に物理世界を内部で作り、RigidbodyやColliderを登録し、毎フレームシミュレーションを行い、シミュレーション結果を返します。レイキャストは個別に受け付けています。UnityのコンポーネントであるRigidbodyやColliderは内部でPhysXのRigidbodyとColliderと結びついているんですね。\u003c/p\u003e\n\n\u003cp\u003eそんな物理エンジンですが、想像通り基本重いです。古い端末だと顕著に重くなります。重さはRigidbodyやColliderの数に比例します。特にRigidbodyは重いです。なので、無駄な使い方をしないように心がけるのが良いです。例えば、自由落下するだけならわざわざRigidbodyを使わなくてもコードで-Y方向に移動させればいいですし、複雑な衝突をしない限り単純なコードで代用できるならなるべくそうすべきです。\u003c/p\u003e\n\n\u003cp\u003e当たり前のことを綴っているだけですが、一番負荷を削減できる事なので常に意識しましょう。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"なるべく動かさない\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AA%E3%82%8B%E3%81%B9%E3%81%8F%E5%8B%95%E3%81%8B%E3%81%95%E3%81%AA%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eなるべく動かさない\u003c/h4\u003e\n\n\u003cp\u003e実は、RigidbodyやColliderの数が多くても負荷がかからない様にする方法があります。それは、\u003cstrong\u003e動かさない\u003c/strong\u003eことです。物理エンジンはstaticもしくは動かないと判断したオブジェクトはsleep状態に入り無駄な物理処理を行わない様になります。なので、なるべく物理オブジェクトは動かさない様にしましょう。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"シーンの途中でrigidbodyやcolliderを追加しない\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B7%E3%83%BC%E3%83%B3%E3%81%AE%E9%80%94%E4%B8%AD%E3%81%A7rigidbody%E3%82%84collider%E3%82%92%E8%BF%BD%E5%8A%A0%E3%81%97%E3%81%AA%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eシーンの途中でRigidbodyやColliderを追加しない\u003c/h4\u003e\n\n\u003cp\u003eシーンの開始ではなく途中でRigidbodyやColliderを追加したくなる時もあるかと思いますが、なるべく控えてください。Unityコンポーネントとして追加されるだけでなく物理世界にも初期登録処理を行わなければならないので結構負荷がかかります。\u003c/p\u003e\n\n\u003cp\u003eなのでRigidbodyとColliderを途中で追加したい場合は、予めコンポーネントとして追加しシーンの最初に\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eGetComponent\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eRigidbody\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;().\u003c/span\u003e\u003cspan class=\"n\"\u003eisKinematic\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003eGetComponent\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eCollider\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;().\u003c/span\u003e\u003cspan class=\"n\"\u003eenabled\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e有効にしたい時に\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eGetComponent\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eRigidbody\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;().\u003c/span\u003e\u003cspan class=\"n\"\u003eisKinematic\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003eGetComponent\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eCollider\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;().\u003c/span\u003e\u003cspan class=\"n\"\u003eenabled\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eとして初期化処理の負荷をシーン開始時に持っていきましょう。(長くなるのでGetComponentをインラインで書いてますがキャッシュもしくはSerialize Fieldを使ってください)\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"精度を下げて軽くする\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%B2%BE%E5%BA%A6%E3%82%92%E4%B8%8B%E3%81%92%E3%81%A6%E8%BB%BD%E3%81%8F%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e精度を下げて軽くする\u003c/h4\u003e\n\n\u003cp\u003eUnityの物理エンジンの精度はプロジェクト設定から変更することができます。\u003cbr\u003e\n[Edit] - [Project Settings] - [Physics]を開くと物理エンジンの設定が可能です。\u003cbr\u003e\n基本的にはいじらない方が良いですが、精度を細かく調整したい場合は以下の4つを設定するのが良いです。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eSleep Threshold\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e剛体がスリープ状態に入る運動エネルギーの閾値です。デフォルトは0.005で、この値を下回った剛体はスリープ状態に入ります。大量の剛体オブジェクトを扱い、細かな運動を求めていないのであれば、この値を上げましょう。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eDefault Contact Offset\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eコライダー同士が衝突したと判定する距離です。デフォルトは0.01です。0に近づけすぎると物理挙動がおかしくなります。大量のコライダーを扱い、かつ精度を求めていないのであれば、この値を上げましょう。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eDefault Solver Iterations\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eジョイントや重なり合った剛体同士の物理的な相互作用を行うタスク(ソルバー)の処理数です。デフォルトは6で、この値を上げると不安定な物理挙動が少なくなります。この値も、物理挙動が変に見えない最低値を指定してあげましょう。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eFixed Timestep\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eこの設定項目は[Project Settings] - [Time]にあります。Time.fixedDeltaTimeの値であり、物理シミュレーションのフレームレートを表します。デフォルトは0.02で物理シミュレーションは50fpsであることが分かります。60fpsのゲームを想定しているのであれば0.02のままで良いですが、30fpsのゲームを想定している場合は、無駄に物理シミュレーションを行う事になるので0.04に設定してあげるのがいいでしょう。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"5-メモリ周りを見直す\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#5-%E3%83%A1%E3%83%A2%E3%83%AA%E5%91%A8%E3%82%8A%E3%82%92%E8%A6%8B%E7%9B%B4%E3%81%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e5. メモリ周りを見直す\u003c/h2\u003e\n\n\u003cp\u003eメモリ管理はプログラミングにおいて避けては通れない問題です、たとえそれがUnityであっても。想像すればわかる通り、Instantiateはmallocと同じでヒープに動的に領域を確保します。Destroyを行うとDisposeが走り、使用されなくなったヒープが一定サイズ以上に達すると動的にGCが走ってしまいます。スタックとヒープを意識しなければならないのはUnityでも同じなので気を付けましょう。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"確保されたメモリを認識し減らすことを心掛ける\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%A2%BA%E4%BF%9D%E3%81%95%E3%82%8C%E3%81%9F%E3%83%A1%E3%83%A2%E3%83%AA%E3%82%92%E8%AA%8D%E8%AD%98%E3%81%97%E6%B8%9B%E3%82%89%E3%81%99%E3%81%93%E3%81%A8%E3%82%92%E5%BF%83%E6%8E%9B%E3%81%91%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e確保されたメモリを認識し、減らすことを心掛ける\u003c/h4\u003e\n\n\u003cp\u003eメモリ周りを見直す前に、自分のゲームがどの程度メモリを使っているのか認識しましょう。スマートフォン向けであれば、例えばメモリ容量2GBに対して1GBを超えるようなメモリを確保していると動作が不安定になったりしますので、しっかり認識した方がいいです。\u003c/p\u003e\n\n\u003cp\u003eプロファイラの[Memory]項目を選択すると以下の様な表示がされると思います。これを見れば現在どのリソースがどの位のメモリが確保されているのかがわかります。（下記はEditor上のプロファイラなので本来は実機のプロファイルを見たほうがいいです）\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/90a6ca6a0bacd49135bdb2ad99cd1f84cfee41d0/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3131333539352f37363263643436342d326338652d323235612d333034662d3137313134393564343936312e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F113595%2F762cd464-2c8e-225a-304f-1711495d4961.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=8ff8c9ebc5575a419c639d8dcd6be65e\" alt=\"performance004.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/113595/762cd464-2c8e-225a-304f-1711495d4961.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F113595%2F762cd464-2c8e-225a-304f-1711495d4961.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=59ffcc15f021fb611bc9d6bd3474aaa5 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e上記のUsed Totalが全体でどの位のメモリを使っているかを示しています。この値が大きかったり乱高下していたりするとGCが頻繁に発生する事になります。\u003c/p\u003e\n\n\u003cp\u003eその他の項目はメモリの内訳となります。例えば上記だとTexturesが一番多く141.8MB使われていることになるので、ここを減らすことを心掛けたほうが良いとわかります。\u003c/p\u003e\n\n\u003cp\u003e自分のゲームのメモリ領域がどの様な使われ方をしているのかをここでしっかり認識してください。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"プールキャッシュを多用する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%97%E3%83%BC%E3%83%AB%E3%82%AD%E3%83%A3%E3%83%83%E3%82%B7%E3%83%A5%E3%82%92%E5%A4%9A%E7%94%A8%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eプール・キャッシュを多用する\u003c/h4\u003e\n\n\u003cp\u003eメモリはシーンの開始時に一気に確保・解放し、シーン中はできる限り確保・解放しないことを心掛けてください。理由は単純で、メモリの動的確保・解放による負荷やGCの発生を極限まで抑える事ができるからです。そのためにもプールやキャッシュの考え方は非常に有効です。\u003c/p\u003e\n\n\u003cp\u003eプール・キャッシュは予めデータを確保し(Unityでいえばシーンの開始時)、そのデータを使いまわすことを意味しています。例えば、シューティングゲームがいい例です。シューティングゲームにおいて弾は常に発生するもので、もしプールを使わず弾の発射時にInstantiateしていたら、その度に動的にメモリが確保されることになり、GCが頻発し非常によろしくないです。これを回避するには、予め画面上に表示されるであろう弾の最大数分Instantiateしておき、画面外などに弾を配置しておいて、必要な時に必要な場所に配置することが望ましいです。こうすることで弾オブジェクトの動的な確保や解放が行われることがなくなるので、GCも発生せず動作も安定します。\u003c/p\u003e\n\n\u003cp\u003eぜひ、プールやキャッシュは有効活用してください。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"アンロードを忘れない\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%A2%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89%E3%82%92%E5%BF%98%E3%82%8C%E3%81%AA%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eアンロードを忘れない\u003c/h4\u003e\n\n\u003cp\u003e意外と忘れがちな事として挙げられるのがアセットのアンロードです。他にも通信周りやファイルIO周りのアンロードも挙げられます。アンロードの何がいいかと言うと、メモリリークを無くすことができ、かつメモリの領域を増やすことができます。アンロードしないままにするとメモリ領域を圧迫し続け非常によろしくないので、注意しましょう。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"6-描画周りを見直す\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#6-%E6%8F%8F%E7%94%BB%E5%91%A8%E3%82%8A%E3%82%92%E8%A6%8B%E7%9B%B4%E3%81%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e6. 描画周りを見直す\u003c/h2\u003e\n\n\u003cp\u003eUnityの中で恐らく一番重いであろう処理は描画です。描画周りの最適化は、シェーダの特性を知っていれば知っている程最適化することができます。ぜひ今一度見直しましょう。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"描画に関する用語を理解する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%8F%8F%E7%94%BB%E3%81%AB%E9%96%A2%E3%81%99%E3%82%8B%E7%94%A8%E8%AA%9E%E3%82%92%E7%90%86%E8%A7%A3%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e描画に関する用語を理解する\u003c/h4\u003e\n\n\u003cp\u003e描画に関する用語は非常に多くあります。GPUプロファイルとRenderingプロファイルでも記載されている用語とその意味を知ることは非常に大事なことなので、この機会にぜひ理解していただければと思います。Unityの描画を最適化する上で必要な用語は以下の通りです。マテリアルやシェーダが絡むので、詳細は \u003ca href=\"#7-%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80%E3%83%9E%E3%83%86%E3%83%AA%E3%82%A2%E3%83%AB%E5%91%A8%E3%82%8A%E3%82%92%E8%A6%8B%E7%9B%B4%E3%81%99\"\u003e7.シェーダ・マテリアル周りを見直す\u003c/a\u003e で説明します。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eOpaque\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e不透明描画を指す。基本的な描画はこれに当てはまる。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eTransparent\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e透明描画を指す。不透明描画よりコストがかかる。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003ePost Process\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e画面全体のエフェクトを指す。かなり高価なのでどうしても必要な場面以外では使用しない事を推奨。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eBatch\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e同一マテリアルである等のバッチング条件を満たした結合メッシュ単位の描画処理を指す。バッチ数を減らすこと自体が描画負荷を下げる事に繋がる。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eSet Pass Call\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eマテリアルの設定値をシェーダ側に伝える処理を指す。シーン上のマテリアル数がここに影響してくる。このコール数が少ないほどパフォーマンスが上昇する。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eTriangles\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e所謂ポリゴン数。頂点シェーダのパフォーマンスに影響するので、Trianglesが少ないほどパフォーマンスが良くなる。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eVertices\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e頂点数。これも頂点シェーダのパフォーマンスに影響する。少ない方が良い。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"オクルージョンカリングを有効活用する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%AA%E3%82%AF%E3%83%AB%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E3%82%AB%E3%83%AA%E3%83%B3%E3%82%B0%E3%82%92%E6%9C%89%E5%8A%B9%E6%B4%BB%E7%94%A8%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eオクルージョンカリングを有効活用する\u003c/h4\u003e\n\n\u003cp\u003eオブジェクト数が多い時に有効なのはオクルージョンカリングです。これはオブジェクトの後ろに隠れているオブジェクトの描画を行わないというもので、ドローコール数自体を下げパフォーマンスを上げる事ができる非常に優れた手法です。似たカリング手法にフラスタムカリングがあります。これはカメラの描画領域外のオブジェクトを描画しないというものです。似ているので注意しましょう。\u003c/p\u003e\n\n\u003cp\u003eフラスタムカリングはUnityは自動で行ってくれますが、オクルージョンカリングは手順を踏まなければ自動で行ってくれません。比較的簡単に設定できるので、ぜひ設定しましょう。\u003c/p\u003e\n\n\u003cp\u003eまず、シーン上で動かないオブジェクトを選択します(フィールドや小物等)。次に選択したオブジェクトが遮蔽物になるか遮蔽されるものになるかを決めます。例えば、フィールド上に配置された小物は遮蔽されるもので、壁などは遮蔽物となりますね。決めたらインスペクタ上で遮蔽物はOcculuder Static, 遮蔽されるものはOccludee Staticを指定してあげましょう。Staticの隣の逆▼から選ぶことができます。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/01c5b88a4e34b6ca7328bacebfe3e66024818c61/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3131333539352f62383137646565632d646262302d333062652d326564302d3665346363383631313363302e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F113595%2Fb817deec-dbb0-30be-2ed0-6e4cc86113c0.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=614ee1f50ab03fd413ee7653d930113d\" alt=\"performance006.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/113595/b817deec-dbb0-30be-2ed0-6e4cc86113c0.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F113595%2Fb817deec-dbb0-30be-2ed0-6e4cc86113c0.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=e48d838af0ee381f68aea9153b4aa8a2 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e指定が終えたら、[Window] - [Rendering] - [Occlusion Culling]を選択します。するとオクルージョンカリング設定が開かれるので、そのまま[Bake]でオクルージョンエリアを作成しましょう。これで、カメラに隠れたもの(遮蔽されるもの)は描画対象外になります。\u003c/p\u003e\n\n\u003cp\u003e動くものには適用されないので、動かないとわかっているオブジェクトにだけ設定してあげましょう。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"ポストプロセスをなるべく使わない\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%9D%E3%82%B9%E3%83%88%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E3%82%92%E3%81%AA%E3%82%8B%E3%81%B9%E3%81%8F%E4%BD%BF%E3%82%8F%E3%81%AA%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eポストプロセスをなるべく使わない\u003c/h4\u003e\n\n\u003cp\u003eポストプロセスは、アンチエイリアスやブラー、ブルームといった描画が終わった後のエフェクト効果を指します。これらはすべてピクセルシェーダで行われるので非常に高価な処理となります（画面全体の1ピクセル毎にエフェクト効果を適用するイメージ）。そのため、スマートフォン向けアプリではできる限り使うべきではありません。見た目はよくなりますが非常に重いです。パフォーマンスとグラフィックのトレードオフの代表格なので注意しましょう。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"モデルにlodを適用し無駄な頂点シェーダ処理を省く\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%A2%E3%83%87%E3%83%AB%E3%81%ABlod%E3%82%92%E9%81%A9%E7%94%A8%E3%81%97%E7%84%A1%E9%A7%84%E3%81%AA%E9%A0%82%E7%82%B9%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80%E5%87%A6%E7%90%86%E3%82%92%E7%9C%81%E3%81%8F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eモデルにLODを適用し無駄な頂点シェーダ処理を省く\u003c/h4\u003e\n\n\u003cp\u003eモデルの描画に使用されるシェーダは基本、頂点シェーダとピクセルシェーダ(フラグメントシェーダ)に分かれています(それ以外もあります)。頂点シェーダのパフォーマンスはモデルの頂点数に依存し、ピクセルシェーダのパフォーマンスは画面に映るピクセル数と解像度に依存します。\u003c/p\u003e\n\n\u003cp\u003eしかし、例えばモデルがすごく遠くに描画された場合を考えてみましょう。ピクセルシェーダはモデルのピクセル数が減るので処理負荷も減りますが、頂点シェーダはモデルの頂点数に依存するので負荷は下がりません。これは非常に無駄な処理となります。\u003c/p\u003e\n\n\u003cp\u003eそこで、有効となるのがモデルにLOD(Level Of Detail)を適用することです。LODはカメラからの距離によってモデルのメッシュを使い分ける事で、遠くに行けば行くほどローポリのモデルを使います。これにより無駄な頂点シェーダを無くしパフォーマンスを向上させることができます。\u003c/p\u003e\n\n\u003cp\u003eゲームオブジェクトのコンポーネントとして[LOD Group]を追加し、それぞれの距離に応じたメッシュを指定してあげればOKです。メッシュを複数用意しなくてはならないので少し大変ではありますが、ぜひ活用してみてはいかがでしょうか。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"7-シェーダマテリアル周りを見直す\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#7-%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80%E3%83%9E%E3%83%86%E3%83%AA%E3%82%A2%E3%83%AB%E5%91%A8%E3%82%8A%E3%82%92%E8%A6%8B%E7%9B%B4%E3%81%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e7. シェーダ・マテリアル周りを見直す\u003c/h2\u003e\n\n\u003cp\u003e描画に関連するものの中で、マテリアルやシェーダに関連する項目はここで説明します。描画というのは、内部でマテリアルデータを使ってシェーダプログラムを走らせることを指すので、マテリアルやシェーダの扱いというのは非常に大事になります。ぜひ見直していただければと思います。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"なるべくマテリアルシェーダを統一する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AA%E3%82%8B%E3%81%B9%E3%81%8F%E3%83%9E%E3%83%86%E3%83%AA%E3%82%A2%E3%83%AB%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80%E3%82%92%E7%B5%B1%E4%B8%80%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eなるべくマテリアル(シェーダ)を統一する\u003c/h4\u003e\n\n\u003cp\u003eマテリアルを扱う上で一番大事なのは、マテリアルを可能な限り統一することです。これは非常に重要なので留意してください。なぜ重要かというと、共通のマテリアルを使うことでBatchがまとまり、マテリアル切り替えによるSetPass Callが純粋に減るからです。つまり、シェーダプログラムを走らせる回数が少なくなるのでパフォーマンスも良くなります。逆に、マテリアルやシェーダがバラバラだとBatchやSetPass Callがその分増えるのでパフォーマンスは落ちます。\u003c/p\u003e\n\n\u003cp\u003eシェーダを扱う方であれば分かる事ですが、マテリアルというのはシェーダ(GPU)に渡すパラメータを指し、シェーダはそのままシェーダプログラムの事を指します。ドローコール(シェーダプログラムを実行する事)はパラメータ、メッシュ、シェーダが変わる度に呼ばなければならないので、パラメータは少なく、メッシュはまとめて、シェーダ切り替えも少なくする事が最適化の一番の近道ということになります。\u003c/p\u003e\n\n\u003cp\u003eなので、テクスチャを１つにまとめるのが良いというのは上記の理由からなのです。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"インスタンシングを使う\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%A4%E3%83%B3%E3%82%B9%E3%82%BF%E3%83%B3%E3%82%B7%E3%83%B3%E3%82%B0%E3%82%92%E4%BD%BF%E3%81%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eインスタンシングを使う\u003c/h4\u003e\n\n\u003cp\u003eBatchを少なくする事(メッシュをまとめる事)が大事だと先ほど述べましたが、Unityは自動的にはメッシュをまとめてくれません。\u003cdel\u003eまとめるにはインスタンシングというものを有効にしなければなりません。インスタンシングとは、同一マテリアルのオブジェクトのメッシュインデックスをつなげる事を指し、詰まるところメッシュをまとめるということになります。\u003c/del\u003e\u003c/p\u003e\n\n\u003cp\u003e※12/18追記、バッチとインスタンシングの説明がごっちゃになっていたので修正します。\u003cbr\u003e\nUnityはdynamic batchを有効にするとまとめる事の出来るメッシュインデックス配列を動的につなげる事で１つのバッチにします。メッシュは同一メッシュでなくても構いません。この処理はCPU上で行われます。一方、インスタンシングを有効にすると、GPU内に同一メッシュのtransformリストを生成し、このリストを使ってシェーダを走らせることであたかも１バッチで描画しているようにします。この処理はGPU内部のみで行われるためCPU負荷がかかりません。バッチはCPUでインデックスを動的につなげるのでCPU負荷がかかりやすいので注意してください。\u003c/p\u003e\n\n\u003cp\u003eインスタンシングは簡単にでき、マテリアルのチェックボックスにチェックを入れればいいだけです。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/744a5bcc2d80c4781a9e6ee397c6a4529bb9d050/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3131333539352f61626638383538352d346162352d613235642d393631652d3665616236336233626533632e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F113595%2Fabf88585-4ab5-a25d-961e-6eab63b3be3c.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=813bc9b207a90027f37d053e66f81ff4\" alt=\"performance007.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/113595/abf88585-4ab5-a25d-961e-6eab63b3be3c.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F113595%2Fabf88585-4ab5-a25d-961e-6eab63b3be3c.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=675f092fe327108e83331486bc77b262 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eビルトインシェーダであれば[Enable GPU Instancing]という項目があるのでチェックを入れてあげましょう。ただし注意点として、同一マテリアルのオブジェクトが複数あることが前提となります。１つしかないオブジェクトなのにインスタンシングを有効にしてしまうとインスタンシングの準備コード分無駄な処理を行う事になるので逆にパフォーマンスが落ちます。注意してください。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"自作シェーダの無駄を取り除く\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%87%AA%E4%BD%9C%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80%E3%81%AE%E7%84%A1%E9%A7%84%E3%82%92%E5%8F%96%E3%82%8A%E9%99%A4%E3%81%8F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e自作シェーダの無駄を取り除く\u003c/h4\u003e\n\n\u003cp\u003e自作シェーダを使用している場合、シェーダのパフォーマンスは描画パフォーマンスに直結しますので、無駄な処理をしていないかぜひ見直してください。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e精度を下げる\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003efloatは高精度で使いたくなりますがシェーダでfloatが必要な場合は意外と少ないです。スタンドアロンであればfloatでもパフォーマンスに影響はあまり出ないですが、スマートフォンだとシェーダの精度でもパフォーマンスに影響が出やすいので、なるべく下げる様にしましょう。\u003c/p\u003e\n\n\u003cp\u003e基本的に以下の様に指定してあげるのが良いです。\u003c/p\u003e\n\n\u003cp\u003e頂点データや法線データ, 計算関連：half\u003cbr\u003e\n色データ：fixed\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eif, forを展開する\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eGPUはifやforが苦手です。最近は使用しても処理の影響が少なくなってきましたが、それでも使うのはできるだけ避けたほうが良いです。解決法としては以下の様にするのが良いでしょう。\u003c/p\u003e\n\n\u003cp\u003eif：lerpやstepで代用\u003cbr\u003e\nfor：unrollして展開してしまう\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eピクセルシェーダの計算を頂点シェーダに持ってくる\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e頂点シェーダに対してピクセルシェーダは計算量が多いことがほとんどです。頂点シェーダは頂点数依存ですが、ピクセルシェーダは画面解像度依存だからです。例えば解像度1080x1920で画面いっぱいにモデルを描画するとなると約200万のピクセルシェーダが走ることになります。それならば、多くても数万レベルの頂点シェーダにピクセルシェーダで行う予定だった処理を持って行けば約1/100で済むことになりますね。ライティングは頂点シェーダに持っていけることがほとんどなので、移動しても見た目に影響が出ないのであれば移動させましょう。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e高価な関数をなるべく使わない\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eシェーダには処理の重い関数があります。それらを認識した上でコーディングする事をお勧めします。1ピクセルに対し1回以上下記の関数を使わないようにしましょう。\u003c/p\u003e\n\n\u003cp\u003e処理の重い関数：pow, exp, log, cos, sin, tan\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"なるべくモバイルに最適化されたビルトインシェーダを使う\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AA%E3%82%8B%E3%81%B9%E3%81%8F%E3%83%A2%E3%83%90%E3%82%A4%E3%83%AB%E3%81%AB%E6%9C%80%E9%81%A9%E5%8C%96%E3%81%95%E3%82%8C%E3%81%9F%E3%83%93%E3%83%AB%E3%83%88%E3%82%A4%E3%83%B3%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80%E3%82%92%E4%BD%BF%E3%81%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eなるべくモバイルに最適化されたビルトインシェーダを使う\u003c/h4\u003e\n\n\u003cp\u003eUnityにはモバイルに最適化されたシェーダが用意されています。基本的に自作シェーダより処理が軽いので、なるべく利用するようにしてください。パーティクルも同様です。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"8-ライトシャドウ周りを見直す\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#8-%E3%83%A9%E3%82%A4%E3%83%88%E3%82%B7%E3%83%A3%E3%83%89%E3%82%A6%E5%91%A8%E3%82%8A%E3%82%92%E8%A6%8B%E7%9B%B4%E3%81%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e8. ライト・シャドウ周りを見直す\u003c/h2\u003e\n\n\u003cp\u003eライトとシャドウはどちらも重い処理です。なぜ重いかを理解して見直すようにしましょう。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"無駄にライトを増やさない\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%84%A1%E9%A7%84%E3%81%AB%E3%83%A9%E3%82%A4%E3%83%88%E3%82%92%E5%A2%97%E3%82%84%E3%81%95%E3%81%AA%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e無駄にライトを増やさない\u003c/h4\u003e\n\n\u003cp\u003eシーン上のライトの数は極力少なくすることをお勧めします（正確にはモデルにリアルタイムで影響するライト数）。なぜかというと、ライトの数に比例してシェーダプログラムを走らせる回数も増えるからです。これはシェーダの性質上そうするしか正確にライトの計算ができないため、ライトの数が増えたらその分ライト計算ループ処理が増えると認識してください。ForwardAddのないシェーダであれば影響しませんが、ForwardAddのあるシェーダはもろ影響します。注意しましょう。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"シャドウキャストレシーブシャドウは最小限に\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B7%E3%83%A3%E3%83%89%E3%82%A6%E3%82%AD%E3%83%A3%E3%82%B9%E3%83%88%E3%83%AC%E3%82%B7%E3%83%BC%E3%83%96%E3%82%B7%E3%83%A3%E3%83%89%E3%82%A6%E3%81%AF%E6%9C%80%E5%B0%8F%E9%99%90%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eシャドウキャスト、レシーブシャドウは最小限に\u003c/h4\u003e\n\n\u003cp\u003e影の影響を受ける必要のないオブジェクトはレシーブシャドウをオフにし、影を発生させる必要のないシーンではシャドウキャストをオフにしましょう。そもそも影を扱わないのであれば、ライトのShadow TypeをNo Shadowsにしてしまいましょう。\u003c/p\u003e\n\n\u003cp\u003eなぜ影が重いかというと、影を描画するためには影を発生させるオブジェクトの深度バッファを予め計算しなければならないからです。つまり影を発生させるというのは、モデルを影用に描画しているということになります。そして、それは影の深度バッファの解像度分負荷が増えます。だから影は重いのです。影の有無、深度バッファ解像度だけで処理速度が2~3ms変わったりします。注意しましょう。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"9-コーディングを見直す\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#9-%E3%82%B3%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0%E3%82%92%E8%A6%8B%E7%9B%B4%E3%81%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e9. コーディングを見直す\u003c/h2\u003e\n\n\u003cp\u003eメモリ周りと関係してくるので説明が被るかもしれませんが、今一度理解を深めていただければと思います。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"シーンの途中でinstantiatedestroyを使わない\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B7%E3%83%BC%E3%83%B3%E3%81%AE%E9%80%94%E4%B8%AD%E3%81%A7instantiatedestroy%E3%82%92%E4%BD%BF%E3%82%8F%E3%81%AA%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eシーンの途中でInstantiate、Destroyを使わない\u003c/h4\u003e\n\n\u003cp\u003eシーンの途中でInstantiate、Destroyを使わないようにしましょう。メモリの確保、解放が直に来るのでパフォーマンスとGCの関係上よろしくないです。なので、ゲームオブジェクトの追加はシーン中にはせず、シーン開始時に最大数分確保し、必要な時に\u003ccode\u003egameObject.SetActive(true);\u003c/code\u003e必要がなくなった時は\u003ccode\u003egameObject.SetActive(false);\u003c/code\u003eとしましょう。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"キャッシュを多用する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%AD%E3%83%A3%E3%83%83%E3%82%B7%E3%83%A5%E3%82%92%E5%A4%9A%E7%94%A8%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eキャッシュを多用する\u003c/h4\u003e\n\n\u003cp\u003eGetComponent、FindObject系はUpdate中に行わないようにしましょう。Update中に検索を行うのは無駄です。Unityは内部で自動的にキャッシュしてくれるなんてことはありません。自分でStartやAwake時にキャッシュし、それを使うようにしましょう。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"高価な関数計算を認識する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%AB%98%E4%BE%A1%E3%81%AA%E9%96%A2%E6%95%B0%E8%A8%88%E7%AE%97%E3%82%92%E8%AA%8D%E8%AD%98%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e高価な関数・計算を認識する\u003c/h4\u003e\n\n\u003cp\u003e\u003ca href=\"#7-%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80%E3%83%9E%E3%83%86%E3%83%AA%E3%82%A2%E3%83%AB%E5%91%A8%E3%82%8A%E3%82%92%E8%A6%8B%E7%9B%B4%E3%81%99\"\u003e7.シェーダ・マテリアル周りを見直す\u003c/a\u003e でも説明しましたが高価な関数や計算はシェーダでもスクリプトでも変わりません。重いものは重いです。Unityマニュアルにもこう書いてあります。\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e超越関数 (Mathf.Sin、Mathf.Pow など)、除算、平方根は、すべて乗算の時間の 100 倍ほどかかります。大きなスケールで考えると大した時間ではないですが、それらを各フレームで何千回も呼び出すと、それは積もって大きくなります。\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e除算は逆数を掛けるという処理に代替できますし、長さの比較はmagnitude同士ではなくsqrMagnitude同士で比較した方がはるかに高速です。なるべく高速な処理を行うように心がけましょう。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"まとめ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eまとめ\u003c/h1\u003e\n\n\u003cp\u003eいかがでしたでしょうか。既に知っていた最適化手法もあれば、初めて知った手法もあったのではないでしょうか。\u003c/p\u003e\n\n\u003cp\u003e上記すべてを実践する必要は全くありません。見た目とのトレードオフなものがほとんどなので。自分に合った見直しを行っていただければ十分です。\u003c/p\u003e\n\n\u003cp\u003e簡単にまとめると、以下の様になります。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e不必要なオブジェクト・コンポーネントは置かない\u003c/li\u003e\n\u003cli\u003eシーン中に動的生成・破棄はなるべくしない\u003c/li\u003e\n\u003cli\u003e重い処理を認識してなるべく使わない\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eまだ紹介しきれていない手法も複数ありますが、それはまた別の機会に紹介できればと思います。\u003cbr\u003e\nそれでは。\u003c/p\u003e\n","createdAt":"2019-12-12T04:27:06Z","elapsedYearsFromLastModifiedAt":0,"encryptedId":"+SHFePBIhSrzjdGdtjjn+2V1OHAuyyVs5w==--uV9lculjAMpCAB1z--alTF7WYFSNEIBBZgeBICMg==","isBanned":false,"isDeprecated":false,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2021-06-18T06:14:13Z","likesCount":315,"linkUrl":"https://qiita.com/yoship1639/items/7339a6201b44a24fbdfe","organization":null,"originalId":1108720,"stockedCount":289,"title":"Unityアプリを高速・安定化するために見直すべき事を9選まとめてみた","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003eはじめに\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E8%A6%8B%E7%9B%B4%E3%81%99%E3%81%B9%E3%81%8D%E4%BA%8B9%E9%81%B8\"\u003e見直すべき事9選\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%97%E3%83%AD%E3%83%95%E3%82%A1%E3%82%A4%E3%83%A9%E3%82%92%E3%81%BE%E3%81%9A%E8%A6%8B%E3%82%8B\"\u003eプロファイラをまず見る\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#rendering\"\u003eRendering\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#scripts\"\u003eScripts\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#physics\"\u003ePhysics\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#animation\"\u003eAnimation\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#garbagecollector\"\u003eGarbageCollector\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#ui\"\u003eUI\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%9D%E3%81%AE%E4%BB%96vsync-global-illmination-other\"\u003eその他(VSync, Global Illmination, Other)\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#1-%E3%82%AF%E3%82%AA%E3%83%AA%E3%83%86%E3%82%A3%E8%A8%AD%E5%AE%9A%E3%82%92%E8%A6%8B%E7%9B%B4%E3%81%99\"\u003e1. クオリティ設定を見直す\u003c/a\u003e\n\u003cul\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#pixel-light-count-%E3%82%92%E5%B0%8F%E3%81%95%E3%81%8F%E3%81%99%E3%82%8B%E3%82%82%E3%81%97%E3%81%8F%E3%81%AF0%E3%81%AB%E3%81%99%E3%82%8B\"\u003ePixel Light Count を小さくする。もしくは0にする\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#texture-quality%E3%82%92%E4%B8%8B%E3%81%92%E3%82%8B\"\u003eTexture Qualityを下げる\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#anisotropic-textures%E3%82%92%E3%82%AA%E3%83%95%E3%81%AB%E3%81%99%E3%82%8B\"\u003eAnisotropic Texturesをオフにする\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#anti-aliasing%E3%82%92%E3%82%AA%E3%83%95%E3%81%AB%E3%81%99%E3%82%8B\"\u003eAnti Aliasingをオフにする\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#soft-particles%E3%82%92%E3%82%AA%E3%83%95%E3%81%AB%E3%81%99%E3%82%8B\"\u003eSoft Particlesをオフにする\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#realtime-reflection-probes%E3%82%92%E3%82%AA%E3%83%95%E3%81%AB%E3%81%99%E3%82%8B\"\u003eRealtime Reflection Probesをオフにする\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#resolution-scaling-fixed-dpi-factor%E3%82%92%E4%B8%8B%E3%81%92%E3%82%8B\"\u003eResolution Scaling Fixed DPI Factorを下げる\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#texture-streaming%E3%82%92%E3%82%AA%E3%83%95%E3%81%AB%E3%81%99%E3%82%8B\"\u003eTexture Streamingをオフにする\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#shadows%E3%82%92%E7%84%A1%E5%8A%B9%E3%81%AB%E3%81%99%E3%82%8B\"\u003eShadowsを無効にする\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#shadow-resolution%E3%82%92%E4%B8%8B%E3%81%92%E3%82%8B\"\u003eShadow Resolutionを下げる\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#blend-weights%E3%82%92%E5%B0%91%E3%81%AA%E3%81%8F%E3%81%99%E3%82%8B\"\u003eBlend Weightsを少なくする\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#vsync-count%E3%82%92%E7%84%A1%E5%8A%B9%E3%81%AB%E3%81%99%E3%82%8B\"\u003eVSync Countを無効にする\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#particle-raycast-budget%E3%82%92%E4%B8%8B%E3%81%92%E3%82%8B\"\u003eParticle Raycast Budgetを下げる\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#2-ui%E5%91%A8%E3%82%8A%E3%82%92%E8%A6%8B%E7%9B%B4%E3%81%99\"\u003e2. UI周りを見直す\u003c/a\u003e\n\u003cul\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E9%9D%99%E7%9A%84%E3%81%AAcanvas%E3%81%A8%E5%8B%95%E7%9A%84%E3%81%AAcanvas%E3%82%92%E5%88%86%E3%81%91%E3%82%8B\"\u003e静的なCanvasと動的なCanvasを分ける\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%86%E3%82%AF%E3%82%B9%E3%83%81%E3%83%A3%E3%81%AF%E3%81%A7%E3%81%8D%E3%82%8B%E3%81%A0%E3%81%91%E3%81%BE%E3%81%A8%E3%82%81%E3%82%8B\"\u003eテクスチャはできるだけまとめる\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cli\u003e\n\u003ca href=\"#3-%E3%82%A2%E3%83%8B%E3%83%A1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%92%E8%A6%8B%E7%9B%B4%E3%81%99\"\u003e3. アニメーションを見直す\u003c/a\u003e\n\u003cul\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%9C%E3%83%BC%E3%83%B3%E3%81%AE%E6%95%B0%E3%82%92%E6%B8%9B%E3%82%89%E3%81%99\"\u003eボーンの数を減らす\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#ik%E3%82%92%E3%81%AA%E3%82%8B%E3%81%B9%E3%81%8F%E4%BD%BF%E3%82%8F%E3%81%AA%E3%81%84\"\u003eIKをなるべく使わない\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%94%BB%E9%9D%A2%E3%81%AB%E6%98%A0%E3%82%8B%E6%99%82%E3%81%AE%E3%81%BF%E3%82%A2%E3%83%8B%E3%83%A1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%95%E3%81%9B%E3%82%8B\"\u003e画面に映る時のみアニメーションさせる\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#gpu%E3%81%AB%E3%82%B9%E3%82%AD%E3%83%8B%E3%83%B3%E3%82%B0%E3%81%95%E3%81%9B%E3%82%8B\"\u003eGPUにスキニングさせる\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\n\n\u003cli\u003e\n\u003ca href=\"#4-%E7%89%A9%E7%90%86%E5%91%A8%E3%82%8A%E3%82%92%E8%A6%8B%E7%9B%B4%E3%81%99\"\u003e4. 物理周りを見直す\u003c/a\u003e\n\u003cul\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#rigidbody-collider-joint%E3%81%AF%E6%9C%80%E4%BD%8E%E9%99%90%E3%81%AB%E3%81%99%E3%82%8B\"\u003eRigidbody, Collider, Jointは最低限にする\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%AA%E3%82%8B%E3%81%B9%E3%81%8F%E5%8B%95%E3%81%8B%E3%81%95%E3%81%AA%E3%81%84\"\u003eなるべく動かさない\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B7%E3%83%BC%E3%83%B3%E3%81%AE%E9%80%94%E4%B8%AD%E3%81%A7rigidbody%E3%82%84collider%E3%82%92%E8%BF%BD%E5%8A%A0%E3%81%97%E3%81%AA%E3%81%84\"\u003eシーンの途中でRigidbodyやColliderを追加しない\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%B2%BE%E5%BA%A6%E3%82%92%E4%B8%8B%E3%81%92%E3%81%A6%E8%BB%BD%E3%81%8F%E3%81%99%E3%82%8B\"\u003e精度を下げて軽くする\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\n\n\u003cli\u003e\n\u003ca href=\"#5-%E3%83%A1%E3%83%A2%E3%83%AA%E5%91%A8%E3%82%8A%E3%82%92%E8%A6%8B%E7%9B%B4%E3%81%99\"\u003e5. メモリ周りを見直す\u003c/a\u003e\n\u003cul\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%A2%BA%E4%BF%9D%E3%81%95%E3%82%8C%E3%81%9F%E3%83%A1%E3%83%A2%E3%83%AA%E3%82%92%E8%AA%8D%E8%AD%98%E3%81%97%E6%B8%9B%E3%82%89%E3%81%99%E3%81%93%E3%81%A8%E3%82%92%E5%BF%83%E6%8E%9B%E3%81%91%E3%82%8B\"\u003e確保されたメモリを認識し、減らすことを心掛ける\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%97%E3%83%BC%E3%83%AB%E3%82%AD%E3%83%A3%E3%83%83%E3%82%B7%E3%83%A5%E3%82%92%E5%A4%9A%E7%94%A8%E3%81%99%E3%82%8B\"\u003eプール・キャッシュを多用する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%A2%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89%E3%82%92%E5%BF%98%E3%82%8C%E3%81%AA%E3%81%84\"\u003eアンロードを忘れない\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\n\n\u003cli\u003e\n\u003ca href=\"#6-%E6%8F%8F%E7%94%BB%E5%91%A8%E3%82%8A%E3%82%92%E8%A6%8B%E7%9B%B4%E3%81%99\"\u003e6. 描画周りを見直す\u003c/a\u003e\n\u003cul\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%8F%8F%E7%94%BB%E3%81%AB%E9%96%A2%E3%81%99%E3%82%8B%E7%94%A8%E8%AA%9E%E3%82%92%E7%90%86%E8%A7%A3%E3%81%99%E3%82%8B\"\u003e描画に関する用語を理解する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%AA%E3%82%AF%E3%83%AB%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E3%82%AB%E3%83%AA%E3%83%B3%E3%82%B0%E3%82%92%E6%9C%89%E5%8A%B9%E6%B4%BB%E7%94%A8%E3%81%99%E3%82%8B\"\u003eオクルージョンカリングを有効活用する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%9D%E3%82%B9%E3%83%88%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E3%82%92%E3%81%AA%E3%82%8B%E3%81%B9%E3%81%8F%E4%BD%BF%E3%82%8F%E3%81%AA%E3%81%84\"\u003eポストプロセスをなるべく使わない\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%A2%E3%83%87%E3%83%AB%E3%81%ABlod%E3%82%92%E9%81%A9%E7%94%A8%E3%81%97%E7%84%A1%E9%A7%84%E3%81%AA%E9%A0%82%E7%82%B9%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80%E5%87%A6%E7%90%86%E3%82%92%E7%9C%81%E3%81%8F\"\u003eモデルにLODを適用し無駄な頂点シェーダ処理を省く\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\n\n\u003cli\u003e\n\u003ca href=\"#7-%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80%E3%83%9E%E3%83%86%E3%83%AA%E3%82%A2%E3%83%AB%E5%91%A8%E3%82%8A%E3%82%92%E8%A6%8B%E7%9B%B4%E3%81%99\"\u003e7. シェーダ・マテリアル周りを見直す\u003c/a\u003e\n\u003cul\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%AA%E3%82%8B%E3%81%B9%E3%81%8F%E3%83%9E%E3%83%86%E3%83%AA%E3%82%A2%E3%83%AB%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80%E3%82%92%E7%B5%B1%E4%B8%80%E3%81%99%E3%82%8B\"\u003eなるべくマテリアル(シェーダ)を統一する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%A4%E3%83%B3%E3%82%B9%E3%82%BF%E3%83%B3%E3%82%B7%E3%83%B3%E3%82%B0%E3%82%92%E4%BD%BF%E3%81%86\"\u003eインスタンシングを使う\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E8%87%AA%E4%BD%9C%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80%E3%81%AE%E7%84%A1%E9%A7%84%E3%82%92%E5%8F%96%E3%82%8A%E9%99%A4%E3%81%8F\"\u003e自作シェーダの無駄を取り除く\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%AA%E3%82%8B%E3%81%B9%E3%81%8F%E3%83%A2%E3%83%90%E3%82%A4%E3%83%AB%E3%81%AB%E6%9C%80%E9%81%A9%E5%8C%96%E3%81%95%E3%82%8C%E3%81%9F%E3%83%93%E3%83%AB%E3%83%88%E3%82%A4%E3%83%B3%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80%E3%82%92%E4%BD%BF%E3%81%86\"\u003eなるべくモバイルに最適化されたビルトインシェーダを使う\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\n\n\u003cli\u003e\n\u003ca href=\"#8-%E3%83%A9%E3%82%A4%E3%83%88%E3%82%B7%E3%83%A3%E3%83%89%E3%82%A6%E5%91%A8%E3%82%8A%E3%82%92%E8%A6%8B%E7%9B%B4%E3%81%99\"\u003e8. ライト・シャドウ周りを見直す\u003c/a\u003e\n\u003cul\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%84%A1%E9%A7%84%E3%81%AB%E3%83%A9%E3%82%A4%E3%83%88%E3%82%92%E5%A2%97%E3%82%84%E3%81%95%E3%81%AA%E3%81%84\"\u003e無駄にライトを増やさない\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B7%E3%83%A3%E3%83%89%E3%82%A6%E3%82%AD%E3%83%A3%E3%82%B9%E3%83%88%E3%83%AC%E3%82%B7%E3%83%BC%E3%83%96%E3%82%B7%E3%83%A3%E3%83%89%E3%82%A6%E3%81%AF%E6%9C%80%E5%B0%8F%E9%99%90%E3%81%AB\"\u003eシャドウキャスト、レシーブシャドウは最小限に\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\n\n\u003cli\u003e\n\u003ca href=\"#9-%E3%82%B3%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0%E3%82%92%E8%A6%8B%E7%9B%B4%E3%81%99\"\u003e9. コーディングを見直す\u003c/a\u003e\n\u003cul\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B7%E3%83%BC%E3%83%B3%E3%81%AE%E9%80%94%E4%B8%AD%E3%81%A7instantiatedestroy%E3%82%92%E4%BD%BF%E3%82%8F%E3%81%AA%E3%81%84\"\u003eシーンの途中でInstantiate、Destroyを使わない\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%AD%E3%83%A3%E3%83%83%E3%82%B7%E3%83%A5%E3%82%92%E5%A4%9A%E7%94%A8%E3%81%99%E3%82%8B\"\u003eキャッシュを多用する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E9%AB%98%E4%BE%A1%E3%81%AA%E9%96%A2%E6%95%B0%E8%A8%88%E7%AE%97%E3%82%92%E8%AA%8D%E8%AD%98%E3%81%99%E3%82%8B\"\u003e高価な関数・計算を認識する\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\n\n\n\n\u003cli\u003e\n\u003ca href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"\u003eまとめ\u003c/a\u003e\n\u003c/li\u003e\n\n","totalPv":37238,"uuid":"7339a6201b44a24fbdfe","banReason":null,"adventCalendarItem":{"day":16,"calendar":{"name":"【unityプロ技】","urlName":"unityforpro","year":2019,"organization":null}},"author":{"encryptedId":"YHHBiDQujVqF57HH8jg923rLJvpW--0hBHdrS/Z8GWohp6--QLRuqErgZb+YY/qj/MdHJQ==","originalId":113595,"description":"ゲームエンジニア。C#er。バックエンドも触る。ゲーム、ゲームエンジン、仮想通貨等を自作していました。フロントエンドから物理ベースシェーダまで幅広く対応可能。理解しやすく正しい記事を記述することを心がけます。","facebookUrl":null,"githubUrl":"https://github.com/yoship1639","isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"Yoshihiro Ito","profileImageUrl":"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/113595/profile-images/1594732889","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F113595%2Fprofile-images%2F1594732889?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=a965ad82da9feffcce9cef12a92425a3","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F113595%2Fprofile-images%2F1594732889?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=716c2b13f79841ad7658dcce03a19ac2","urlName":"yoship1639","websiteUrl":"https://twitter.com/yoship1639","twitterUrl":"https://twitter.com/yoship1639","twitterUrlName":"yoship1639","revealedOrganizations":{"edges":[{"node":{"encryptedId":"2up9yV9OcZPRRrsAQ4yvdg9N2W+apX+Kpnc=--tzQxPZLr7dS588JT--pQzOjV+ZOzdqlOEl71SudA==","isBetaReleaseEnabled":false,"isFollowableByViewer":false,"isFollowedByViewer":false,"name":"Unityゲーム開発者ギルド","logoUrl":"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/f7eb993765ddcdb2c5e6890556c43ea3de8fbfb7/original.jpg?1570215690","urlName":"unity-game-dev-guild","description":"趣味・仕事問わずUnityでゲームを作っている開発者のみで構成されるオンラインコミュニティです。Unityでゲームを開発・運用するにあたって必要なあらゆる知見を共有することを目的とします。","url":"https://unity-game-dev-guild.github.io/"}}]}},"tags":[{"name":"C#","urlName":"csharp"},{"name":"Unity3D","urlName":"unity3d"},{"name":"Unity","urlName":"unity"},{"name":"最適化","urlName":"%e6%9c%80%e9%81%a9%e5%8c%96"}],"followingLikers":{"edges":[]},"comments":{"totalCount":1}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

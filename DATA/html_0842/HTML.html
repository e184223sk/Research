<!DOCTYPE html><html><head><meta charset="utf-8" /><title>パフォーマンス向上で知っておくべきコンピューターサイエンスの基礎知識とその実践 - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/higty/items/306eebe988af39ba775d" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="FhKlbbWHBJ0b8tYcI1kEyYNB7JLebrzrE3AS9fhWeoFIx9H9SczYAIBsd8lD4ZJPOCOx9x2Q62FbJU41E4qyBg==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta content="@higlabo" name="twitter:creator" /><meta property="og:type" content="article"><meta property="og:title" content="パフォーマンス向上で知っておくべきコンピューターサイエンスの基礎知識とその実践 - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND00NE9SNDRPVjQ0S3A0NE84NDRPZTQ0T3o0NEs1NVpDUjVMaUs0NEduNTUtbDQ0R2o0NEdtNDRHSzQ0R1A0NEc1NDRHTjQ0S3o0NE96NDRPVTQ0T2w0NE84NDRLXzQ0Tzg0NEsxNDRLazQ0S280NE96NDRLNTQ0R3U1Wi02NTZTTzU1LWw2SzJZNDRHbzQ0R2Q0NEd1NWE2ZjZMZTEmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT01NCZ0eHQtY2xpcD1lbGxpcHNpcyZ0eHQtYWxpZ249Y2VudGVyJTJDbWlkZGxlJnM9YjJmOTliNDVjNTVjYTkyMmJjMTJkOTVlNzI4YWU2NGE&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RR2hwWjNSNSZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTQ1JnR4dC1hbGlnbj1yaWdodCUyQ2JvdHRvbSZzPWQxYzc2NGU3NGNjZjE3N2NiOTdhY2E4YTY3NDlhNmMy&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=798dff8db423dcfade1bc5b717033fcf"><meta property="og:description" content="

はじめに

こちらの記事をQiitaにも共有してコミュニティに貢献したいと思います。
https://academy.tinybetter.com/Article/37407ec1-cd3a-50c8-2fa1-39f6ed3da..."><meta content="https://qiita.com/higty/items/306eebe988af39ba775d" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="JavaScript,C#,.NET,初心者,新人プログラマ応援" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 1nzh4zz 38fzdi helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-1nzh4zz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:16px 32px;background-color:#FBE69E;color:rgba(0,0,0,0.87);line-height:1.5;font-weight:600;}@media (max-width:770px){.css-1nzh4zz{padding:16px;}}.css-38fzdi{color:#CA832A;margin-right:4px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-d6f162dd-c893-468f-9325-3e4018cb12f1"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Fhigty%2Fitems%2F306eebe988af39ba775d">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Fhigty%2Fitems%2F306eebe988af39ba775d">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-d6f162dd-c893-468f-9325-3e4018cb12f1">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/javascript","name":"JavaScript"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2020-08-29T15:47:33.000+09:00","dateModified":"2020-08-29T15:47:33.000+09:00","headline":"パフォーマンス向上で知っておくべきコンピューターサイエンスの基礎知識とその実践","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND00NE9SNDRPVjQ0S3A0NE84NDRPZTQ0T3o0NEs1NVpDUjVMaUs0NEduNTUtbDQ0R2o0NEdtNDRHSzQ0R1A0NEc1NDRHTjQ0S3o0NE96NDRPVTQ0T2w0NE84NDRLXzQ0Tzg0NEsxNDRLazQ0S280NE96NDRLNTQ0R3U1Wi02NTZTTzU1LWw2SzJZNDRHbzQ0R2Q0NEd1NWE2ZjZMZTEmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT01NCZ0eHQtY2xpcD1lbGxpcHNpcyZ0eHQtYWxpZ249Y2VudGVyJTJDbWlkZGxlJnM9YjJmOTliNDVjNTVjYTkyMmJjMTJkOTVlNzI4YWU2NGE\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RR2hwWjNSNSZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTQ1JnR4dC1hbGlnbj1yaWdodCUyQ2JvdHRvbSZzPWQxYzc2NGU3NGNjZjE3N2NiOTdhY2E4YTY3NDlhNmMy\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=798dff8db423dcfade1bc5b717033fcf","mainEntityOfPage":"https://qiita.com/higty/items/306eebe988af39ba775d","author":{"@type":"Person","address":"Tokyo","email":null,"identifier":"higty","name":"higty","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F96483%2Fprofile-images%2F1548390071?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=cfd641f4961ac44fd5ef70299a20a2b9","url":"https://qiita.com/higty","description":"","memberOf":[]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://increments.connpass.com/event/211948/">【9/9(木)開催】Qiitaの過去と未来についてお話しします！Qiita エンジニアフェスタ 2021 Online Meetup</a><a target="_blank" id="header_text_message_2" href="https://increments.connpass.com/event/211948/">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"higty","type":"items","id":"306eebe988af39ba775d"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"【9/9(木)開催】Qiitaの過去と未来についてお話しします！Qiita エンジニアフェスタ 2021 Online Meetup","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"higty","type":"items","id":"306eebe988af39ba775d"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":2,"pos_id":"header_text_message_1","message":"【9/9(木)開催】Qiitaの過去と未来についてお話しします！Qiita エンジニアフェスタ 2021 Online Meetup","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"higty","type":"items","id":"306eebe988af39ba775d"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":2,"pos_id":"header_text_message_2","message":"【9/9(木)開催】Qiitaの過去と未来についてお話しします！Qiita エンジニアフェスタ 2021 Online Meetup","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/higty/items/306eebe988af39ba775d","location":"/higty/items/306eebe988af39ba775d","scheme":"https","host":"qiita.com","port":null,"pathname":"/higty/items/306eebe988af39ba775d","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"iIzOThHRICXddlIyykNxXJysdiPtS+FxVEtY3fZZVTnWWbre7Zr8uEbo8+eq++faJ84rRi61tvscHgQdHYWdvg==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-d043fa4b-207f-445b-9402-74b0f49417d0"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/higty/items/306eebe988af39ba775d/likers" class="css-1iupg5d">9</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">14</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/306eebe988af39ba775d/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/higty/items/306eebe988af39ba775d/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/higty/items/306eebe988af39ba775d/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/higty/items/306eebe988af39ba775d/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/higty/items/306eebe988af39ba775d.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-1nzh4zz"><span class="fa fa-fw fa-warning css-38fzdi"></span><p>More than 1 year has passed since last update.</p></div><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/higty"><img class="css-100alwu eyfquo10" src="https://qiita-image-store.s3.amazonaws.com/0/96483/profile-images/1548390071" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/higty" class="css-10ougpm">@<!-- -->higty</a><div class="css-1ay9vb9"><time dateTime="2020-08-29T06:47:33Z" class="css-m19uds">posted at 2020-08-29</time></div></div></div></div></div><h1 class="css-cgzq40">パフォーマンス向上で知っておくべきコンピューターサイエンスの基礎知識とその実践</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/javascript" class="css-4czcte">JavaScript</a><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/.net" class="css-4czcte">.NET</a><a href="/tags/%e5%88%9d%e5%bf%83%e8%80%85" class="css-4czcte">初心者</a><a href="/tags/%e6%96%b0%e4%ba%ba%e3%83%97%e3%83%ad%e3%82%b0%e3%83%a9%e3%83%9e%e5%bf%9c%e6%8f%b4" class="css-4czcte">新人プログラマ応援</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div>
<h1>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h1>

<p>こちらの記事をQiitaにも共有してコミュニティに貢献したいと思います。<br>
<a href="https://academy.tinybetter.com/Article/37407ec1-cd3a-50c8-2fa1-39f6ed3dae74/View" class="autolink" rel="nofollow noopener" target="_blank">https://academy.tinybetter.com/Article/37407ec1-cd3a-50c8-2fa1-39f6ed3dae74/View</a></p>

<p>ネット上には様々な記事が溢れていますが情報が断片化していてプログラムを始めた初心者には全体像を掴むのが難しいです。コンピューターサイエンスの基本的な理解とパフォーマンスTIPSをまとめた記事があまり見当たらないのでまとめてみました。</p>

<h1>
<span id="全てを計測する" class="fragment"></span><a href="#%E5%85%A8%E3%81%A6%E3%82%92%E8%A8%88%E6%B8%AC%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>全てを計測する</h1>

<p>パフォーマンスチューニングの最も大事な原則は計測することです。<br>
計測用のツールをまとめておきます。</p>

<p>■BenchmarkDotNet<br>
<a href="https://benchmarkdotnet.org/articles/overview.html" class="autolink" rel="nofollow noopener" target="_blank">https://benchmarkdotnet.org/articles/overview.html</a><br>
C#コードの計測をするツールです。Nugetから利用できます。Stopwatchクラスではなくこちらを使いましょう。StopwatchではGCなどの影響を正しく計測できません。</p>

<p>■Visual Studio プロファイリング ツール<br>
<a href="https://docs.microsoft.com/ja-jp/visualstudio/profiling/?view=vs-2019" class="autolink" rel="nofollow noopener" target="_blank">https://docs.microsoft.com/ja-jp/visualstudio/profiling/?view=vs-2019</a><br>
Visual Studioのプロファイリングツールを使用するとCPU、メモリ、スレッド、GC、LOHなどの状態を確認できます。呼び出しツリーを見ればどのメソッドのどのコードがCritical Pathなのかすぐに見つけることができます。</p>

<p>■Fiddler<br>
<a href="https://www.telerik.com/fiddler" class="autolink" rel="nofollow noopener" target="_blank">https://www.telerik.com/fiddler</a><br>
ネットワークの内容をキャプチャしてくれるツールです。<br>
<a href="https://zappysys.com/blog/how-to-use-fiddler-to-analyze-http-web-requests/" class="autolink" rel="nofollow noopener" target="_blank">https://zappysys.com/blog/how-to-use-fiddler-to-analyze-http-web-requests/</a></p>

<p>■ブラウザの開発者ツール<br>
Fiddlerをインストールしなくてもブラウザの開発者ツールでネットワークの内容をキャプチャすることもできます。Fiddlerの方が高機能な印象ですが簡単に調べるだけならブラウザの開発者ツールでも良いでしょう。</p>

<p>■Wireshark<br>
<a href="https://www.wireshark.org/download.html" class="autolink" rel="nofollow noopener" target="_blank">https://www.wireshark.org/download.html</a><br>
TCP/IP通信のキャプチャができるソフトです。<br>
<a href="https://knowledge.sakura.ad.jp/6286/" class="autolink" rel="nofollow noopener" target="_blank">https://knowledge.sakura.ad.jp/6286/</a><br>
<a href="https://hldc.co.jp/blog/2020/04/15/3988/" class="autolink" rel="nofollow noopener" target="_blank">https://hldc.co.jp/blog/2020/04/15/3988/</a></p>

<p>アプリケーション開発ではあまりお世話にならないかもしれませんが通信を深く見たい時がいつか来るかもしれません。覚えておきましょう。</p>

<p>■WinDbg<br>
<a href="https://docs.microsoft.com/ja-jp/windows-hardware/drivers/debugger/debugger-download-tools" class="autolink" rel="nofollow noopener" target="_blank">https://docs.microsoft.com/ja-jp/windows-hardware/drivers/debugger/debugger-download-tools</a><br>
Windowsのダンプファイルを取得して解析することができます。スタックトレースを取得してどのメソッドが原因なのか解析できます。<br>
<a href="https://docs.microsoft.com/ja-jp/windows-hardware/drivers/debugger/debugging-using-windbg-preview" class="autolink" rel="nofollow noopener" target="_blank">https://docs.microsoft.com/ja-jp/windows-hardware/drivers/debugger/debugging-using-windbg-preview</a><br>
<a href="https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/debugging-using-windbg" class="autolink" rel="nofollow noopener" target="_blank">https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/debugging-using-windbg</a><br>
<a href="https://blog.engineer-memo.com/2012/06/24/%E3%82%AF%E3%83%A9%E3%83%83%E3%82%B7%E3%83%A5%E3%83%80%E3%83%B3%E3%83%97%E8%A7%A3%E6%9E%90%E3%81%AE%E3%81%AF%E3%81%98%E3%82%81%E3%81%AE%E4%B8%80%E6%AD%A9/" rel="nofollow noopener" target="_blank">クラッシュダンプ解析のはじめの一歩</a></p>

<p>この記事の内容はだいたい合ってると思いますが嘘があるかもしれません。C#が進化して昔と変わってしまったりなどがあるのでネットの情報を鵜呑みにするのではなく、しっかりと自分で計測して確かめることが大事です。</p>

<h1>
<span id="コンピューターとネットワークを理解する" class="fragment"></span><a href="#%E3%82%B3%E3%83%B3%E3%83%94%E3%83%A5%E3%83%BC%E3%82%BF%E3%83%BC%E3%81%A8%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E3%82%92%E7%90%86%E8%A7%A3%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>コンピューターとネットワークを理解する</h1>

<p>パフォーマンスへの影響を理解するためにはコンピューターとネットワークの原理の理解が欠かせません。コンピューターはCPU、メモリ、ハードディスクから構成されます。CPUは計算処理、メモリとハードディスクは記憶装置です。メモリはさらにいくつかの種類に細分化されます。</p>

<p>CPUの計算処理の向上により、メモリへの読み書きがついていけなくなりました。その結果、キャッシュメモリーという機構が用意されるようになりました。<br>
<a href="https://ascii.jp/elem/000/000/563/563800/" class="autolink" rel="nofollow noopener" target="_blank">https://ascii.jp/elem/000/000/563/563800/</a><br>
キャッシュメモリー（1次）が一番早く、キャッシュメモリー（2次）→キャッシュメモリー（3次）→スタックメモリ→ヒープメモリ→SSD→ハードディスクの順で遅くなります。容量はハードディスクが一番大きいです。また価格はだんだん安くなります。</p>

<p>さてネットワーク通信にて、とある文字列を送信するには文字データをByteに変換し、DNSで名前解決してターゲットのPCを特定し、TCP/IPでthree-way handshakeでやり取りをしてからSliding Windowで徐々に送信量を増やしていくという処理になります。<br>
<a href="https://www.infraexpert.com/study/tcpip11.html" class="autolink" rel="nofollow noopener" target="_blank">https://www.infraexpert.com/study/tcpip11.html</a><br>
<a href="https://ascii.jp/elem/000/000/619/619702/" class="autolink" rel="nofollow noopener" target="_blank">https://ascii.jp/elem/000/000/619/619702/</a></p>

<p>上記の感じで処理がされるのでネットワーク通信は非常に時間がかかる処理になります。通信は最終的には電圧のON/OFFの信号へ変換され、ケーブルへの外部からの電波などの干渉で電圧信号が欠損したりするのでそれをTCP/IPが検出して再度送りなおしたりなどが発生するので遅くなります。UDPだと少し早いですがいずれにしてもネットワーク通信はプログラミングの中では一番遅い処理になります。</p>

<h1>
<span id="優先順位を理解する" class="fragment"></span><a href="#%E5%84%AA%E5%85%88%E9%A0%86%E4%BD%8D%E3%82%92%E7%90%86%E8%A7%A3%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>優先順位を理解する</h1>

<p>さてコンピューターとネットワークへの理解が深まったところで優先順位と基本的な取り組み方について学びます。ホットコードパス、ネットワーク呼び出し、ファイルIO、ヒープメモリ、スレッド、非同期などについて解説していきます。実践部分は今回はC#と.NETを例に解説していきますが、Python,Javaなどでもネットワーク通信、ヒープメモリ、ガベージコレクションの基本的な考え方は同じです。</p>

<h2>
<span id="ホットコードパス" class="fragment"></span><a href="#%E3%83%9B%E3%83%83%E3%83%88%E3%82%B3%E3%83%BC%E3%83%89%E3%83%91%E3%82%B9"><i class="fa fa-link"></i></a>ホットコードパス</h2>

<p>まず最初に理解しておく必要があるのはホットコードパスの概念です。for文などの繰り返し処理の内部は何度も実行されます。例えば以下のような画面を考えます。<br>
<a href="https://camo.qiitausercontent.com/5d774af853685afeb334700d9a4d2580193a496a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39363438332f64653636316461312d393732632d653035362d363535302d3938383634316537303761612e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F96483%2Fde661da1-972c-e056-6550-988641e707aa.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=4308322eec9e57879045f2cd808072f9" alt="tasklist.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/96483/de661da1-972c-e056-6550-988641e707aa.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F96483%2Fde661da1-972c-e056-6550-988641e707aa.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=a8a312360f4991b316c75c94e3844bc3 1x" loading="lazy"></a></p>

<p>こういった画面を作るには下記の順でfor文などで繰り返し処理を書くことになるでしょう。<br>
複数のユーザー→複数の日付→複数のタスク<br>
概念的にはこんな感じになります。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">private</span> <span class="k">void</span> <span class="nf">ShowCalendar</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">List</span><span class="p">&lt;</span><span class="n">UserRecord</span><span class="p">&gt;</span> <span class="n">userList</span> <span class="p">=</span> <span class="nf">GetUserList</span><span class="p">();</span> <span class="c1">//ネットワーク通信その1</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">user</span> <span class="k">in</span> <span class="n">userList</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">startDate</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">DateTime</span><span class="p">(</span><span class="m">2020</span><span class="p">,</span> <span class="m">9</span><span class="p">,</span> <span class="m">12</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">var</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="m">21</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">date</span> <span class="p">=</span> <span class="n">startDate</span><span class="p">.</span><span class="nf">AddDays</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
            <span class="kt">var</span> <span class="n">taskList</span> <span class="p">=</span> <span class="nf">GetTaskList</span><span class="p">(</span><span class="n">date</span><span class="p">);</span> <span class="c1">//ネットワーク通信その2</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">task</span> <span class="k">in</span> <span class="n">taskList</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="nf">CreateTaskTableCell</span><span class="p">(</span><span class="n">task</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="k">private</span> <span class="k">void</span> <span class="nf">CreateTaskTableCell</span><span class="p">(</span><span class="n">TaskRecord</span> <span class="n">record</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//HOT PATH!!!!!!</span>

    <span class="c1">// Get color of Task</span>
    <span class="kt">var</span> <span class="n">color</span> <span class="p">=</span> <span class="nf">GetColorFromDatabase</span><span class="p">();</span> <span class="c1">//ネットワーク通信その3</span>
<span class="p">}</span>
</code></pre></div></div>

<p>とこんな感じだとしましょう。ネットワーク通信のコードが3つあります。</p>

<p>CreateTaskTableCellメソッドの内部のコードはホットコードパスになります。このメソッドは非常に多くの回数呼ばれます。例えばユーザーが100人、日数が21日、タスクが1日あたり平均5個ある場合、10500回呼ばれることになります。その中でDBから色データを取得するなどというコード（ネットワーク通信その3）を書いた場合、DBアクセスが10ミリ秒だとすると10ミリ秒×10500＝105秒はかかることになります。ページが表示されるまで2分弱かかることになるでしょう。ネットワーク通信その2は2100回なのでネットワーク通信その3よりはましですがこれも改善の必要があります。<br>
ネットワーク通信その1は1回しか呼ばれていないのでそのままでも良いでしょう。</p>

<p>このように実行される回数が多い部分のコードをホットコードパスと言い、このコードを優先的に改善していく必要があります。<br>
この動画<br>
<a href="https://www.youtube.com/watch?v=4yALYEINbyI" class="autolink" rel="nofollow noopener" target="_blank">https://www.youtube.com/watch?v=4yALYEINbyI</a><br>
の12:10では<br>
20%のコードが80%のリソースを消費している。<br>
4.0%のコードが64%のリソースを消費している。<br>
0.8%のコードが51%のリソースを消費している。<br>
と言っています。ホットコードパスがいかにリソースを消費しているのかがわかると思います。</p>

<h2>
<span id="影響の大きいところから改善する" class="fragment"></span><a href="#%E5%BD%B1%E9%9F%BF%E3%81%AE%E5%A4%A7%E3%81%8D%E3%81%84%E3%81%A8%E3%81%93%E3%82%8D%E3%81%8B%E3%82%89%E6%94%B9%E5%96%84%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>影響の大きいところから改善する</h2>

<p>注意するべきプログラムコードは多くの場合において以下の順番になります。<br>
・ネットワーク通信<br>
・ハードディスク操作<br>
・ヒープメモリ<br>
上記の順場とは別でCPU、スレッド、async、例外などについても理解し、パフォーマンスの良いコードを書くように注意する必要があります。</p>

<h2>
<span id="ネットワーク通信のコードを知る" class="fragment"></span><a href="#%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E9%80%9A%E4%BF%A1%E3%81%AE%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E7%9F%A5%E3%82%8B"><i class="fa fa-link"></i></a>ネットワーク通信のコードを知る</h2>

<p>ネットワーク通信は遅いのでなるべく回数を減らしましょう。C#でネットワーク通信が発生しているメソッドを知ることが大事です。以下にネットワーク通信をしているクラスを列挙します。</p>

<p>SqlConnection、SqlCommand</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="kt">var</span> <span class="n">cn</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SqlConnection</span><span class="p">();</span>
<span class="kt">var</span> <span class="n">cm</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SqlCommand</span><span class="p">(</span><span class="s">"insert into Table1....."</span><span class="p">);</span>
<span class="n">cm</span><span class="p">.</span><span class="n">Connection</span> <span class="p">=</span> <span class="n">cn</span><span class="p">;</span>
<span class="n">cn</span><span class="p">.</span><span class="nf">Open</span><span class="p">();</span> <span class="c1">//ネットワーク通信が発生しているかも？調べてみてね。</span>
<span class="n">cm</span><span class="p">.</span><span class="nf">ExecuteNonQuery</span><span class="p">();</span> <span class="c1">//ネットワーク通信が発生！</span>
</code></pre></div></div>

<p>HttpClient</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="kt">var</span> <span class="n">cl</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HttpClient</span><span class="p">();</span>
<span class="kt">var</span> <span class="n">res</span> <span class="p">=</span> <span class="k">await</span> <span class="n">cl</span><span class="p">.</span><span class="nf">GetAsync</span><span class="p">(</span><span class="s">"https://www.hignull.com"</span><span class="p">);</span> <span class="c1">//ネットワーク通信が発生！</span>
</code></pre></div></div>

<p>Google Calendar</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="kt">var</span> <span class="n">credential</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ServiceAccountCredential</span><span class="p">(</span>
<span class="k">new</span> <span class="n">ServiceAccountCredential</span><span class="p">.</span><span class="nf">Initializer</span><span class="p">(</span><span class="n">serviceAccountEmail</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">Scopes</span> <span class="p">=</span> <span class="k">new</span><span class="p">[]</span> <span class="p">{</span> <span class="n">CalendarService</span><span class="p">.</span><span class="n">Scope</span><span class="p">.</span><span class="n">Calendar</span> <span class="p">}</span>
<span class="p">});</span>
<span class="kt">var</span> <span class="n">sv</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">CalendarService</span><span class="p">(</span><span class="k">new</span> <span class="n">BaseClientService</span><span class="p">.</span><span class="nf">Initializer</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">HttpClientInitializer</span> <span class="p">=</span> <span class="n">credential</span><span class="p">,</span>
    <span class="n">ApplicationName</span> <span class="p">=</span> <span class="s">"MyApp1"</span><span class="p">,</span>
<span class="p">});</span>
<span class="kt">var</span> <span class="n">req</span> <span class="p">=</span> <span class="k">new</span> <span class="n">EventsResouce</span><span class="p">.</span><span class="nf">ListRequest</span><span class="p">(</span><span class="n">sv</span><span class="p">,</span> <span class="s">"calendarID"</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">eventList</span> <span class="p">=</span> <span class="n">req</span><span class="p">.</span><span class="nf">Execute</span><span class="p">();</span> <span class="c1">//ネットワーク通信が発生！</span>
</code></pre></div></div>

<p>Azure Blob Storage</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="n">CloudStorageAccount</span> <span class="n">account</span> <span class="p">=</span> <span class="n">CloudStorageAccount</span><span class="p">.</span><span class="nf">Parse</span><span class="p">(</span><span class="s">"My connection string"</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">cl</span> <span class="p">=</span> <span class="n">account</span><span class="p">.</span><span class="nf">CreateCloudBlobClient</span><span class="p">();</span>
<span class="kt">var</span> <span class="n">container</span> <span class="p">=</span> <span class="n">cl</span><span class="p">.</span><span class="nf">GetContainerReference</span><span class="p">(</span><span class="s">"My Container name"</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">list</span> <span class="p">=</span> <span class="n">container</span><span class="p">.</span><span class="nf">ListBlobs</span><span class="p">();</span> <span class="c1">//ネットワーク通信が発生！</span>
</code></pre></div></div>

<p>だいたい感覚は掴めてきましたでしょうか？DBサーバーや外部のWEBサーバー、Saas（Google、Stripe、Office365、Blob）のAPIなどの呼び出しでデータを取得するときにはネットワーク通信が発生しています。自分のPCでプログラムを走らせているとイメージが掴みやすいですよね。GoogleカレンダーであればGoogleのデータセンターのコンピューターに保存されているデータを取得するので、ネットワーク通信が発生することになります。</p>

<p>さらに言うとこのデータはおそらくハードディスク（もしくはSSD）に保存されているでしょう。非常に時間がかかるネットワーク通信をした後に、これまた時間のかかるハードディスクからデータを読み取り、その値をまたネットワーク通信で返却する、という流れになるのでこれらのメソッドの実行は非常に遅いです。</p>

<h2>
<span id="ファイル操作のコードを知る" class="fragment"></span><a href="#%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E6%93%8D%E4%BD%9C%E3%81%AE%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E7%9F%A5%E3%82%8B"><i class="fa fa-link"></i></a>ファイル操作のコードを知る</h2>

<p>ネットワークの次はファイル操作のコードについてです。ファイル操作をするいくつかのクラスを知っておきましょう。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="kt">var</span> <span class="n">text</span> <span class="p">=</span> <span class="n">System</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">File</span><span class="p">.</span><span class="nf">ReadAllText</span><span class="p">(</span><span class="s">"C:\\Doc\\MyMemo.txt"</span><span class="p">);</span>
</code></pre></div></div>

<p>FileStreamクラスを利用する場合もハードディスクへの操作になります。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="n">FileStream</span> <span class="n">fs</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">FileStream</span><span class="p">(</span><span class="s">"C:\\Doc\\MyMemo1.txt"</span><span class="p">,</span> <span class="n">FileMode</span><span class="p">.</span><span class="n">Create</span><span class="p">);</span>
<span class="n">StreamWriter</span> <span class="n">sw</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StreamWriter</span><span class="p">(</span><span class="n">fs</span><span class="p">);</span>
<span class="n">sw</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"WIFI Number 1234-5678-4563"</span><span class="p">);</span>
<span class="n">sw</span><span class="p">.</span><span class="nf">Close</span><span class="p">();</span>
<span class="n">fs</span><span class="p">.</span><span class="nf">Close</span><span class="p">();</span>
</code></pre></div></div>

<h2>
<span id="ヒープメモリについて理解する" class="fragment"></span><a href="#%E3%83%92%E3%83%BC%E3%83%97%E3%83%A1%E3%83%A2%E3%83%AA%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E7%90%86%E8%A7%A3%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>ヒープメモリについて理解する</h2>

<p>ヒープメモリを効率的に使うために必要なTipsについての目次です。<br>
・不要なnewを避ける<br>
・ボクシング<br>
・String is immutable<br>
・StringBuilder<br>
・String.Intern<br>
・Listを正しく初期化する<br>
・ラムダ式のキャプチャを意識する<br>
・ArrayPoolを使用する<br>
・Taskの代わりにValueTaskを使用する<br>
・SpanとStackAllocを活用する</p>

<h3>
<span id="不要なnewを避ける" class="fragment"></span><a href="#%E4%B8%8D%E8%A6%81%E3%81%AAnew%E3%82%92%E9%81%BF%E3%81%91%E3%82%8B"><i class="fa fa-link"></i></a>不要なnewを避ける</h3>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">private</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">List</span><span class="p">&lt;</span><span class="n">UserRecord</span><span class="p">&gt;</span> <span class="n">userList</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">UserRecord</span><span class="p">&gt;();</span>
    <span class="n">userList</span> <span class="p">=</span> <span class="nf">GetUserList</span><span class="p">();</span>
<span class="p">}</span>
<span class="k">private</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">UserRecord</span><span class="p">&gt;</span> <span class="nf">GetUserList</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">List</span><span class="p">&lt;</span><span class="n">UserRecord</span><span class="p">&gt;</span> <span class="n">userList</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">UserRecord</span><span class="p">&gt;();</span>
    <span class="c1">// get user list...</span>
    <span class="k">return</span> <span class="n">userList</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>不要なnewはヒープメモリを浪費します。避けましょう。</p>

<p>文字の比較で両方を小文字にするなども避けましょう。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="kt">var</span> <span class="n">s1</span> <span class="p">=</span> <span class="s">"a"</span><span class="p">;</span>
<span class="kt">var</span> <span class="n">s2</span> <span class="p">=</span> <span class="s">"A"</span><span class="p">;</span>
<span class="kt">var</span> <span class="n">isSameString</span> <span class="p">=</span> <span class="n">s1</span><span class="p">.</span><span class="nf">ToLower</span><span class="p">()</span> <span class="p">==</span> <span class="n">s2</span><span class="p">.</span><span class="nf">ToLower</span><span class="p">();</span> <span class="c1">//メモリが浪費される</span>
</code></pre></div></div>

<p>代わりにStriing.Compareを使用します。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="kt">var</span> <span class="n">s1</span> <span class="p">=</span> <span class="s">"a"</span><span class="p">;</span>
<span class="kt">var</span> <span class="n">s2</span> <span class="p">=</span> <span class="s">"A"</span><span class="p">;</span>
<span class="kt">var</span> <span class="n">isSameString</span> <span class="p">=</span> <span class="n">String</span><span class="p">.</span><span class="nf">Compare</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">StringComparison</span><span class="p">.</span><span class="n">CurrentCultureIgnoreCase</span><span class="p">);</span>
</code></pre></div></div>

<h3>
<span id="ボクシング" class="fragment"></span><a href="#%E3%83%9C%E3%82%AF%E3%82%B7%E3%83%B3%E3%82%B0"><i class="fa fa-link"></i></a>ボクシング</h3>

<p>値型をObject型などにアサインするとボクシングが発生します。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="kt">int</span> <span class="n">x</span> <span class="p">=</span> <span class="m">10</span><span class="p">;</span>
<span class="kt">object</span> <span class="n">o</span> <span class="p">=</span> <span class="n">x</span><span class="p">;</span> <span class="c1">//ボクシング発生！</span>
</code></pre></div></div>

<p>ボクシングが発生するとメモリの割り当てが発生します。<br>
<a href="https://camo.qiitausercontent.com/30cc6defb38203fc6e47e3ddca8cd04c97f8e7cc/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39363438332f39663163653030312d323730372d323539372d333138622d3161306131343430313339322e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F96483%2F9f1ce001-2707-2597-318b-1a0a14401392.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=3d3fbfb17147d8b234338a3fd2af7102" alt="Boxing.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/96483/9f1ce001-2707-2597-318b-1a0a14401392.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F96483%2F9f1ce001-2707-2597-318b-1a0a14401392.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=c0d0058da8d7a9f720fab9af396a9d7f 1x" loading="lazy"></a></p>

<p>ヒープメモリの割り当ては時間がかかる処理です。（ネットワーク通信＞ハードディスク操作＞ヒープメモリ割り当て）<br>
<a href="https://ufcpp.net/study/computer/MemoryManagement.html" class="autolink" rel="nofollow noopener" target="_blank">https://ufcpp.net/study/computer/MemoryManagement.html</a><br>
不要なボクシングは避けましょう。</p>

<p>値型をインターフェースへキャストするとボクシングを発生させます。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">struct</span> <span class="nc">MyStruct</span> <span class="p">:</span> <span class="n">IComparer</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="nf">Compare</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">.</span><span class="nf">CompareTo</span><span class="p">(</span><span class="n">y</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="k">private</span> <span class="nf">Main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">s</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MyStruct</span><span class="p">();</span>
    <span class="n">IComparer</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">comparer</span> <span class="p">=</span> <span class="n">s</span><span class="p">;</span> <span class="c1">//ボクシング発生！</span>
    <span class="n">s</span><span class="p">.</span><span class="nf">Compare</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">1</span><span class="p">);</span> 
<span class="p">}</span>
</code></pre></div></div>

<p>避けられるのならば避けましょう。</p>

<h3>
<span id="stringについて理解する" class="fragment"></span><a href="#string%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E7%90%86%E8%A7%A3%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>Stringについて理解する</h3>

<p>まずあまり書かれていない重要な事としてStringはクラスですが不変であるということです。<br>
<a href="https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/builtin-types/reference-types" class="autolink" rel="nofollow noopener" target="_blank">https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/builtin-types/reference-types</a></p>

<p>これはどういうことかというと例えば以下のようなコードがあるとして</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="kt">string</span> <span class="n">s</span> <span class="p">=</span> <span class="s">"Hello"</span><span class="p">;</span>
<span class="n">s</span> <span class="p">=</span> <span class="s">"Hello World!"</span><span class="p">;</span>
</code></pre></div></div>

<p>このコードを書いたときのメモリの動作として下図のようなイメージを持つかもしれませんが<br>
<a href="https://camo.qiitausercontent.com/ab4fc7b87a91df04827af078ae7cd7043c85ed03/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39363438332f33643164363065302d613930312d333736302d333666662d3733376130303138616361332e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F96483%2F3d1d60e0-a901-3760-36ff-737a0018aca3.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=2d74394fe073c536ed8e17e029b1d5b6" alt="String1.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/96483/3d1d60e0-a901-3760-36ff-737a0018aca3.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F96483%2F3d1d60e0-a901-3760-36ff-737a0018aca3.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=680c04c1b64b284676b01d556c2fe002 1x" loading="lazy"></a></p>

<p>実際には以下のようにヒープメモリに新しい領域を確保します。<br>
<a href="https://camo.qiitausercontent.com/f202585cfe0294a7db9ef942a5ef2e25dd7b3e2f/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39363438332f66303739353763392d643538322d306638322d373831312d3063353630633466363762352e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F96483%2Ff07957c9-d582-0f82-7811-0c560c4f67b5.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=857533ec31b9c7d1d996196c5b68eb0c" alt="String2.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/96483/f07957c9-d582-0f82-7811-0c560c4f67b5.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F96483%2Ff07957c9-d582-0f82-7811-0c560c4f67b5.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=f1f986f38ae4f7109170837a720ad697 1x" loading="lazy"></a></p>

<p>これがStringは不変と言われる理由です。Stringの変更をある程度の回数行う場合はStringBuilderを使用しましょう。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="n">StringBuilder</span> <span class="n">sb</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringBuilder</span><span class="p">();</span>
<span class="n">sb</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="s">"Hello"</span><span class="p">);</span>
<span class="n">sb</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="s">"World!"</span><span class="p">);</span>
</code></pre></div></div>

<p>この例では最初からHello World!という値をセットすればいい話ですが、実際にはテキストボックスの入力値からクエリを組み立てるとか、ユーザーへのメッセージを組み立てるとか、そういう場合にStringBuilderを使用することになるでしょう。</p>

<p>Stringで文字の連結や変更を何度も行うとその回数だけヒープメモリの確保と以前使用した値（この例だとHello）が使われないメモリとなり、ガベージコレクションの回数が増加します。</p>

<h3>
<span id="stringinternを使用する" class="fragment"></span><a href="#stringintern%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>String.Internを使用する</h3>

<p>アプリケーションの中で何度も使用する文字列はInternメソッドでインターン化しておくとメモリの消費を抑制しパフォーマンスの改善が期待できます。例えば追加ボタンの「追加」という文字などはインターン化するのに良い対象となるでしょう。</p>

<h3>
<span id="listを正しく初期化する" class="fragment"></span><a href="#list%E3%82%92%E6%AD%A3%E3%81%97%E3%81%8F%E5%88%9D%E6%9C%9F%E5%8C%96%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>Listを正しく初期化する</h3>

<p>List系のクラスのコンストラクタにはcapacityを受け取るオーバーロードがあります。このオーバーロードを使用すると内部で用意する配列のサイズを指定できます。例えばタスク一覧ページがあり、1ページあたり50件のタスクを表示するのであれば50を最初から指定してあげることで配列の再生成を防ぐことができます。結果としてメモリの消費の抑制と処理時間の短縮が期待できます。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="n">List</span><span class="p">&lt;</span><span class="n">TaskRecord</span><span class="p">&gt;</span> <span class="n">taskList</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">TaskRecord</span><span class="p">&gt;(</span><span class="m">50</span><span class="p">);</span>
</code></pre></div></div>

<p>Listのソースコードです。</p>

<p><qiita-embed-ogp src="https://referencesource.microsoft.com/#mscorlib/system/collections/generic/list.cs"></qiita-embed-ogp></p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code>    <span class="k">public</span> <span class="k">class</span> <span class="nc">List</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="p">:</span> <span class="n">IList</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;,</span> <span class="n">System</span><span class="p">.</span><span class="n">Collections</span><span class="p">.</span><span class="n">IList</span><span class="p">,</span> <span class="n">IReadOnlyList</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span>
    <span class="p">{</span>
        <span class="k">private</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">_defaultCapacity</span> <span class="p">=</span> <span class="m">4</span><span class="p">;</span>

        <span class="k">static</span> <span class="k">readonly</span> <span class="n">T</span><span class="p">[]</span>  <span class="n">_emptyArray</span> <span class="p">=</span> <span class="k">new</span> <span class="n">T</span><span class="p">[</span><span class="m">0</span><span class="p">];</span>        
        <span class="k">public</span> <span class="nf">List</span><span class="p">()</span> <span class="p">{</span>
            <span class="n">_items</span> <span class="p">=</span> <span class="n">_emptyArray</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">public</span> <span class="nf">List</span><span class="p">(</span><span class="kt">int</span> <span class="n">capacity</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">capacity</span> <span class="p">&lt;</span> <span class="m">0</span><span class="p">)</span> <span class="n">ThrowHelper</span><span class="p">.</span><span class="nf">ThrowArgumentOutOfRangeException</span><span class="p">(</span><span class="n">ExceptionArgument</span><span class="p">.</span><span class="n">capacity</span><span class="p">,</span> <span class="n">ExceptionResource</span><span class="p">.</span><span class="n">ArgumentOutOfRange_NeedNonNegNum</span><span class="p">);</span>
            <span class="n">Contract</span><span class="p">.</span><span class="nf">EndContractBlock</span><span class="p">();</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">capacity</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>
                <span class="n">_items</span> <span class="p">=</span> <span class="n">_emptyArray</span><span class="p">;</span>
            <span class="k">else</span>
                <span class="n">_items</span> <span class="p">=</span> <span class="k">new</span> <span class="n">T</span><span class="p">[</span><span class="n">capacity</span><span class="p">];</span>
        <span class="p">}</span>        

        <span class="c1">// 省略.............................</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Add</span><span class="p">(</span><span class="n">T</span> <span class="n">item</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">_size</span> <span class="p">==</span> <span class="n">_items</span><span class="p">.</span><span class="n">Length</span><span class="p">)</span> <span class="nf">EnsureCapacity</span><span class="p">(</span><span class="n">_size</span> <span class="p">+</span> <span class="m">1</span><span class="p">);</span>
            <span class="n">_items</span><span class="p">[</span><span class="n">_size</span><span class="p">++]</span> <span class="p">=</span> <span class="n">item</span><span class="p">;</span>
            <span class="n">_version</span><span class="p">++;</span>
        <span class="p">}</span>                
        <span class="k">private</span> <span class="k">void</span> <span class="nf">EnsureCapacity</span><span class="p">(</span><span class="kt">int</span> <span class="n">min</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">_items</span><span class="p">.</span><span class="n">Length</span> <span class="p">&lt;</span> <span class="n">min</span><span class="p">)</span> <span class="p">{</span>
                <span class="kt">int</span> <span class="n">newCapacity</span> <span class="p">=</span> <span class="n">_items</span><span class="p">.</span><span class="n">Length</span> <span class="p">==</span> <span class="m">0</span><span class="p">?</span> <span class="n">_defaultCapacity</span> <span class="p">:</span> <span class="n">_items</span><span class="p">.</span><span class="n">Length</span> <span class="p">*</span> <span class="m">2</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">((</span><span class="kt">uint</span><span class="p">)</span><span class="n">newCapacity</span> <span class="p">&gt;</span> <span class="n">Array</span><span class="p">.</span><span class="n">MaxArrayLength</span><span class="p">)</span> <span class="n">newCapacity</span> <span class="p">=</span> <span class="n">Array</span><span class="p">.</span><span class="n">MaxArrayLength</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">newCapacity</span> <span class="p">&lt;</span> <span class="n">min</span><span class="p">)</span> <span class="n">newCapacity</span> <span class="p">=</span> <span class="n">min</span><span class="p">;</span>
                <span class="n">Capacity</span> <span class="p">=</span> <span class="n">newCapacity</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>        
</code></pre></div></div>

<p>アイテムを追加して内部の配列の長さを超える場合、EnsureCapacityメソッドで配列の作り直しを行っています。サイズが分かっている場合は最初から指定して無駄なメモリ使用を避けましょう。</p>

<h3>
<span id="ラムダ式のキャプチャを意識する" class="fragment"></span><a href="#%E3%83%A9%E3%83%A0%E3%83%80%E5%BC%8F%E3%81%AE%E3%82%AD%E3%83%A3%E3%83%97%E3%83%81%E3%83%A3%E3%82%92%E6%84%8F%E8%AD%98%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>ラムダ式のキャプチャを意識する</h3>

<p>ラムダ式で外部変数をキャプチャした場合、暗黙的にクラスが定義されそのインスタンスが生成されます。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="n">Action</span> <span class="nf">GetWriteLineAction</span><span class="p">(</span><span class="kt">int</span> <span class="n">number</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">number</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>これは以下のようにコンパイルされます。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">__GeneratedClass</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">number</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">GeneratedMethod</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">number</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="k">public</span> <span class="n">Action</span> <span class="nf">GetWriteLineAction</span><span class="p">(</span><span class="kt">int</span> <span class="n">number</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">c</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">__GeneratedClass</span><span class="p">();</span>
    <span class="n">c</span><span class="p">.</span><span class="n">number</span> <span class="p">=</span> <span class="n">number</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">c</span><span class="p">.</span><span class="n">GeneratedMethod</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>外部変数をキャプチャするとインスタンスが生成されヒープメモリを消費します。特にホットコードパスでのラムダ式の使用では注意が必要です。最新のC#ではラムダ式にstaticキーワードをつけて外部変数のキャプチャを禁止することができるので外部変数の意図しないキャプチャを防ぎたいのならば積極的に利用していきましょう。</p>

<h3>
<span id="ラムダにstaticメソッドを渡さないようにする" class="fragment"></span><a href="#%E3%83%A9%E3%83%A0%E3%83%80%E3%81%ABstatic%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%82%92%E6%B8%A1%E3%81%95%E3%81%AA%E3%81%84%E3%82%88%E3%81%86%E3%81%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>ラムダにstaticメソッドを渡さないようにする</h3>

<p>staticメソッドのデリゲートが遅くなります。以下にその理由が詳しく書いてあります↓<br>
<a href="https://ufcpp.net/study/csharp/functional/miscdelegateinternal/#static-method" class="autolink" rel="nofollow noopener" target="_blank">https://ufcpp.net/study/csharp/functional/miscdelegateinternal/#static-method</a><br>
その他、staticメソッドのデリゲートが遅くなるとかいろいろなテスト結果です。<br>
<a href="https://gist.github.com/ufcpp/b2e64d8e0165746effbd98b8aa955f7e" class="autolink" rel="nofollow noopener" target="_blank">https://gist.github.com/ufcpp/b2e64d8e0165746effbd98b8aa955f7e</a></p>

<p>以下のようなコードを考えてみましょう。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">textList</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">String</span><span class="p">&gt;();</span>
    <span class="n">textList</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"   "</span><span class="p">);</span> <span class="c1">//Empty</span>
    <span class="n">textList</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Higty"</span><span class="p">);</span>
    <span class="c1">//....いくつか追加</span>
    <span class="n">textList</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="n">IsNullOrWhiteSpace</span><span class="p">);</span> <span class="c1">//静的メソッド</span>
    <span class="n">textList</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">String</span><span class="p">.</span><span class="nf">IsNullOrWhiteSpace</span><span class="p">(</span> <span class="n">x</span> <span class="p">)</span> <span class="p">);</span> <span class="c1">//ラムダで囲む</span>
<span class="p">}</span>
</code></pre></div></div>

<p>静的メソッドをそのまま引数として渡す書き方の場合、実際には以下のようにコンパイルされます。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="n">textList</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="k">new</span> <span class="n">Func</span><span class="p">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">Boolean</span><span class="p">&gt;(</span><span class="kt">string</span><span class="p">.</span><span class="n">IsNullOrWhiteSpace</span><span class="p">));</span>
</code></pre></div></div>

<p>毎回Funcクラスのインスタンスが作成されてメモリを浪費します。さらにデリゲート呼び出しがインスタンスメソッドの方に最適化されているのが原因で呼び出し自体も非常に遅いです。</p>

<p>ラムダで囲んでおくと<br>
<a href="https://ufcpp.net/study/csharp/sp2_anonymousmethod.html#static" class="autolink" rel="nofollow noopener" target="_blank">https://ufcpp.net/study/csharp/sp2_anonymousmethod.html#static</a></p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">class</span> <span class="nc">__GeneratedClass</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="n">Func</span><span class="p">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">Boolean</span><span class="p">&gt;</span> <span class="n">_ActionCache</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
    <span class="k">internal</span> <span class="n">Boolean</span> <span class="nf">__GeneratedMethod</span><span class="p">(</span><span class="n">String</span> <span class="n">text</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">String</span><span class="p">.</span><span class="nf">IsNullOrWhiteSpace</span><span class="p">(</span><span class="n">text</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">__GeneratedClass</span><span class="p">.</span><span class="n">_ActionCache</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">__GeneratedClass</span><span class="p">.</span><span class="n">_ActionCache</span> <span class="p">=</span> <span class="n">__GeneratedClass</span><span class="p">.</span><span class="n">__GeneratedMethod</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">textList</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">__GeneratedClass</span><span class="p">.</span><span class="n">_ActionCache</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>みたいな感じに展開され、無駄なインスタンスの生成がゼロになります。メモリの無駄遣いを抑制し、ガベージコレクションの回数を減らすことができます。またインスタンスメソッドの呼び出しになっているので呼び出しが遅くなることもありません。</p>

<h3>
<span id="arraypoolを使用する" class="fragment"></span><a href="#arraypool%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>ArrayPoolを使用する</h3>

<p>例えばファイルのダウンロード処理や、WEBサイトでアップロードされたファイルを処理する場合、Byte[]でデータをやり取りします。バッファでByte[]を使用することもあると思います。ArrayPoolを使用することでByte[]のヒープメモリへのアロケーションを避け、既に用意されているByte[]を使用できます。<br>
<a href="http://ikorin2.hatenablog.jp/entry/2020/07/25/113904" class="autolink" rel="nofollow noopener" target="_blank">http://ikorin2.hatenablog.jp/entry/2020/07/25/113904</a><br>
ヒープメモリへのアロケーションを避けることにより、ガベージコレクションの回数が減ることが期待できます。</p>

<h3>
<span id="taskの代わりにvaluetaskを使用する" class="fragment"></span><a href="#task%E3%81%AE%E4%BB%A3%E3%82%8F%E3%82%8A%E3%81%ABvaluetask%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>Taskの代わりにValueTaskを使用する</h3>

<p><a href="https://www.buildinsider.net/column/iwanaga-nobuyuki/009" class="autolink" rel="nofollow noopener" target="_blank">https://www.buildinsider.net/column/iwanaga-nobuyuki/009</a><br>
非同期メソッドが何階層にも渡って呼び出されている場合にはパフォーマンスの向上が見込めます。</p>

<h3>
<span id="spanとstakallocを活用する" class="fragment"></span><a href="#span%E3%81%A8stakalloc%E3%82%92%E6%B4%BB%E7%94%A8%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>SpanとStakallocを活用する</h3>

<p>Stringや配列にたいしてSpanやStackallocを活用するとパフォーマンスの向上とメモリ使用量の低減が可能です。<br>
<a href="https://ufcpp.net/blog/2018/12/spanify/" class="autolink" rel="nofollow noopener" target="_blank">https://ufcpp.net/blog/2018/12/spanify/</a></p>

<h2>
<span id="gcガベージコレクションについて理解する" class="fragment"></span><a href="#gc%E3%82%AC%E3%83%99%E3%83%BC%E3%82%B8%E3%82%B3%E3%83%AC%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E7%90%86%E8%A7%A3%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>GC（ガベージコレクション）について理解する</h2>

<p>C#では.NET Framework（.NET Core）がメモリを管理してくれるガベージコレクションという仕組みがあります。<br>
<a href="https://docs.microsoft.com/ja-jp/dotnet/standard/garbage-collection/fundamentals" class="autolink" rel="nofollow noopener" target="_blank">https://docs.microsoft.com/ja-jp/dotnet/standard/garbage-collection/fundamentals</a><br>
簡単に言うと、ヒープメモリを3世代に分けて管理し、どこからも参照されなくなったヒープメモリをクリアして空いたスペースを詰めてメモリを整理してくれる仕組みです。<br>
<a href="https://ufcpp.net/study/csharp/rm_gc.html" class="autolink" rel="nofollow noopener" target="_blank">https://ufcpp.net/study/csharp/rm_gc.html</a><br>
<a href="https://ufcpp.net/study/computer/MemoryManagement.html?sec=garbage-collection#garbage-collection" class="autolink" rel="nofollow noopener" target="_blank">https://ufcpp.net/study/computer/MemoryManagement.html?sec=garbage-collection#garbage-collection</a></p>

<p>ヒープメモリを消費していくとどこかのタイミングでガベージコレクションの処理が実行されます。この処理は重い処理になります。なるべくガベージコレクションが発生する回数が少なくなるようにしましょう。特にGen2のコレクション処理は非常に重くなります。ヒープメモリを無駄遣いしない、Byte[]などの配列データを再利用するなどの方法を活用してGCの発生回数を減らしましょう。</p>

<p>ガベージコレクションの実行時間が長くならないためのTipsです。<br>
<a href="https://docs.microsoft.com/en-us/previous-versions/dotnet/articles/ms973837(v=msdn.10)" class="autolink" rel="nofollow noopener" target="_blank">https://docs.microsoft.com/en-us/previous-versions/dotnet/articles/ms973837(v=msdn.10)</a></p>

<p>まとめると<br>
・多くのアロケーションがあると実行時間が長くなります。<br>
・巨大なオブジェクト（new Byte[10000]とか）があると実行時間が長くなります。<br>
・オブジェクトが複雑にお互いを参照しているようなクラスがあると参照されていない事の検証処理に時間がかかります。<br>
・ルートオブジェクトが多いと参照されていない事の検証処理に時間がかかります。<br>
・ファイナライザがあるクラスの作成は注意して実装する。</p>

<h3>
<span id="ファイナライザとは" class="fragment"></span><a href="#%E3%83%95%E3%82%A1%E3%82%A4%E3%83%8A%E3%83%A9%E3%82%A4%E3%82%B6%E3%81%A8%E3%81%AF"><i class="fa fa-link"></i></a>ファイナライザとは？</h3>

<p><a href="https://docs.microsoft.com/ja-jp/dotnet/csharp/programming-guide/classes-and-structs/destructors" class="autolink" rel="nofollow noopener" target="_blank">https://docs.microsoft.com/ja-jp/dotnet/csharp/programming-guide/classes-and-structs/destructors</a><br>
ファイナライザがあると自動的に世代が1世代昇格されます。これはつまりGen0での回収がされないことを意味します。<br>
ファイナライザがあると300倍ほど遅くなります。↓<br>
<a href="https://michaelscodingspot.com/avoid-gc-pressure/" class="autolink" rel="nofollow noopener" target="_blank">https://michaelscodingspot.com/avoid-gc-pressure/</a><br>
またファイナライザの実装に問題があると以下のような問題が発生します。<br>
<a href="https://troushoo.blog.fc2.com/blog-entry-56.html" class="autolink" rel="nofollow noopener" target="_blank">https://troushoo.blog.fc2.com/blog-entry-56.html</a><br>
注意しましょう。</p>

<h2>
<span id="よくあるメモリリークのパターンについて知る" class="fragment"></span><a href="#%E3%82%88%E3%81%8F%E3%81%82%E3%82%8B%E3%83%A1%E3%83%A2%E3%83%AA%E3%83%AA%E3%83%BC%E3%82%AF%E3%81%AE%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E7%9F%A5%E3%82%8B"><i class="fa fa-link"></i></a>よくあるメモリリークのパターンについて知る</h2>

<p><a href="https://michaelscodingspot.com/ways-to-cause-memory-leaks-in-dotnet/" class="autolink" rel="nofollow noopener" target="_blank">https://michaelscodingspot.com/ways-to-cause-memory-leaks-in-dotnet/</a><br>
<a href="https://michaelscodingspot.com/find-fix-and-avoid-memory-leaks-in-c-net-8-best-practices/" class="autolink" rel="nofollow noopener" target="_blank">https://michaelscodingspot.com/find-fix-and-avoid-memory-leaks-in-c-net-8-best-practices/</a></p>

<p>イベントハンドラー<br>
匿名メソッド、ラムダ式でのキャプチャ<br>
Staticフィールドはガベージコレクションのルートになる<br>
WPFのBindingについて<br>
キャッシュするデータ量が多いとメモリが不足してOutOfMemoryExceptionが発生する<br>
Week Referenceについて<br>
終了しないThread（Timersも）のStackに積まれた変数はガベージコレクションのルートになる</p>

<p>メモリがリークするとそのメモリは解放されず使用可能なメモリ領域が減少しガベージコレクションが頻発することになります。ガベージコレクションは重い処理なのでアプリケーション全体のパフォーマンスが低下します。</p>

<h2>
<span id="例外について" class="fragment"></span><a href="#%E4%BE%8B%E5%A4%96%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>例外について</h2>

<p>例外の発生は重い処理です。不要な例外の発生は避けましょう。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">private</span> <span class="n">Int32</span><span class="p">?</span> <span class="nf">GetNumber</span><span class="p">(</span><span class="n">String</span> <span class="n">text</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">try</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">x</span> <span class="p">=</span> <span class="n">Int32</span><span class="p">.</span><span class="nf">Parse</span><span class="p">(</span><span class="n">text</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Parseメソッドの代わりにTryParseメソッドがあります。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">private</span> <span class="n">Int32</span><span class="p">?</span> <span class="nf">GetNumber</span><span class="p">(</span><span class="n">String</span> <span class="n">text</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">Int32</span><span class="p">.</span><span class="nf">TryParse</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="k">out</span> <span class="kt">var</span> <span class="n">x</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h2>
<span id="使用方法に注意するべきクラスライブラリ" class="fragment"></span><a href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95%E3%81%AB%E6%B3%A8%E6%84%8F%E3%81%99%E3%82%8B%E3%81%B9%E3%81%8D%E3%82%AF%E3%83%A9%E3%82%B9%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA"><i class="fa fa-link"></i></a>使用方法に注意するべきクラスライブラリ</h2>

<p>まずはデータアクセスのクラスです。</p>

<h3>
<span id="datasetよりもdatareaderを使用する" class="fragment"></span><a href="#dataset%E3%82%88%E3%82%8A%E3%82%82datareader%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>DataSetよりもDataReaderを使用する</h3>

<p>DataSetやDataTableはいろいろな機能があって遅いです。単にデータを読み取るだけならばDataReaderを使用するようにしましょう。</p>

<h3>
<span id="table-valued-parameterかsqlbulkcopyを使用して複数行を処理する" class="fragment"></span><a href="#table-valued-parameter%E3%81%8Bsqlbulkcopy%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6%E8%A4%87%E6%95%B0%E8%A1%8C%E3%82%92%E5%87%A6%E7%90%86%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>Table-Valued ParameterかSqlBulkCopyを使用して複数行を処理する</h3>

<p>複数行を一括で処理する場合はTVP(Table-Valued Parameter)かSqlBulkCopyを使用しましょう。<br>
<a href="https://www.sentryone.com/blog/sqlbulkcopy-vs-table-valued-parameters-bulk-loading-data-into-sql-server" class="autolink" rel="nofollow noopener" target="_blank">https://www.sentryone.com/blog/sqlbulkcopy-vs-table-valued-parameters-bulk-loading-data-into-sql-server</a><br>
1000以下のレコードであればTVPの方が高速です。これはBulk Insertは初期化処理に多少時間がかかるためです。<br>
<a href="https://docs.microsoft.com/en-us/sql/relational-databases/tables/use-table-valued-parameters-database-engine?view=sql-server-ver15#BulkInsert" class="autolink" rel="nofollow noopener" target="_blank">https://docs.microsoft.com/en-us/sql/relational-databases/tables/use-table-valued-parameters-database-engine?view=sql-server-ver15#BulkInsert</a><br>
1000以上のレコードの挿入の場合、SqlBulkCopyを使用してデータを挿入しましょう。</p>

<p>TVPのストアドをC#から呼び出すのは結構面倒くさいです。DbSharpを使用するとC#の呼び出しコードを簡単に自動生成できます。<br>
<a href="https://qiita.com/higty/items/3c7000c06c83321e2319" id="reference-4b01668e45596c116f68">DbSharp（ストアドを実行するC#のソースコード自動生成ツール）の紹介</a><br>
活用しましょう。</p>

<h3>
<span id="dictionaryのキーに注意する" class="fragment"></span><a href="#dictionary%E3%81%AE%E3%82%AD%E3%83%BC%E3%81%AB%E6%B3%A8%E6%84%8F%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>Dictionaryのキーに注意する</h3>

<p>Dictionaryのキーの比較にはGetHashCodeが使用されます。キーにStringやEnumを使用するとキーの比較は低速です。<br>
<a href="http://proprogrammer.hatenadiary.jp/entry/2014/08/17/015345" class="autolink" rel="nofollow noopener" target="_blank">http://proprogrammer.hatenadiary.jp/entry/2014/08/17/015345</a><br>
Enumをキーに使用する場合に高速化する手法です↓<br>
<a href="https://stackoverflow.com/questions/26280788/dictionary-enum-key-performance/26281533" class="autolink" rel="nofollow noopener" target="_blank">https://stackoverflow.com/questions/26280788/dictionary-enum-key-performance/26281533</a><br>
可能であればInt32などをキーとして使用しましょう。</p>

<h3>
<span id="asyncawaitを使用する" class="fragment"></span><a href="#asyncawait%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>async、awaitを使用する</h3>

<p>Wait()メソッドやResultプロパティは使用しないようにしましょう。処理が完了するまでの間、スレッドをブロックしてしまいます。asyncを使用すれば待ち時間の間スレッドを解放します。その解放されたスレッドは他の処理の実行に使用されます。<br>
WEBサイトなどでは並列にリクエストが飛んできて、DBからのデータの取得などで待ちが発生します。全て非同期にすることでスレッドがただ何もしないで待つという事がなくなり、常にどれかのリクエストの処理を実行している形になるので全体のスループットが向上します。</p>

<h3>
<span id="streamを使用する" class="fragment"></span><a href="#stream%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>Streamを使用する</h3>

<p>Streamを使用することでデータを順次読み込み・書き込みすることができます。使える場合は使っていきましょう。</p>

<h3>
<span id="httpclientをusingしない" class="fragment"></span><a href="#httpclient%E3%82%92using%E3%81%97%E3%81%AA%E3%81%84"><i class="fa fa-link"></i></a>HttpClientをusingしない</h3>

<p>公式ドキュメントによるとHttpClientは特殊な使用方法を要求されます。<br>
<a href="https://docs.microsoft.com/ja-jp/dotnet/api/system.net.http.httpclient?view=netcore-3.1" class="autolink" rel="nofollow noopener" target="_blank">https://docs.microsoft.com/ja-jp/dotnet/api/system.net.http.httpclient?view=netcore-3.1</a><br>
適切な使用方法の参考記事です↓<br>
<a href="https://qiita.com/superriver/items/91781bca04a76aec7dc0" class="autolink" id="reference-9cb30bc7642faee8937d">https://qiita.com/superriver/items/91781bca04a76aec7dc0</a></p>

<p>HttpClientFactoryを利用するとDIやリトライなどが楽に設定できます。<br>
<a href="https://docs.microsoft.com/en-US/dotnet/architecture/microservices/implement-resilient-applications/use-httpclientfactory-to-implement-resilient-http-requests" class="autolink" rel="nofollow noopener" target="_blank">https://docs.microsoft.com/en-US/dotnet/architecture/microservices/implement-resilient-applications/use-httpclientfactory-to-implement-resilient-http-requests</a></p>

<h3>
<span id="socketを利用した時のメモリの断片化とout-of-memoryを防止する" class="fragment"></span><a href="#socket%E3%82%92%E5%88%A9%E7%94%A8%E3%81%97%E3%81%9F%E6%99%82%E3%81%AE%E3%83%A1%E3%83%A2%E3%83%AA%E3%81%AE%E6%96%AD%E7%89%87%E5%8C%96%E3%81%A8out-of-memory%E3%82%92%E9%98%B2%E6%AD%A2%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>Socketを利用した時のメモリの断片化とOut Of Memoryを防止する</h3>

<p>Socketでのデータの送受信ではByte[]を利用します。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">private</span> <span class="n">voi</span> <span class="nf">Send</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">buffer</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Byte</span><span class="p">[</span><span class="m">1024</span><span class="p">];</span>
    <span class="n">socket</span><span class="p">.</span><span class="nf">BeginSend</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="p">...);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>BeginSendに渡したByte[]はI/O Completion PortでOSからI/O完了時にデータが書き込まれます。OSがこのアドレスに間違いなく書き込めることを保証する必要があり、このbufferはガベージコレクションの処理時に勝手にアドレスが動かないようPINされます。<br>
<a href="http://ahuwanya.net/blog/post/Buffer-Pooling-for-NET-Socket-Operations" class="autolink" rel="nofollow noopener" target="_blank">http://ahuwanya.net/blog/post/Buffer-Pooling-for-NET-Socket-Operations</a></p>

<p>問題は例えば1024のサイズのバッファーを使用してデータを送ると1MBのデータを送るにはSendCallbackが1000回実行され、Byte[]のインスタンスが1000個生成され、その全てがPINされることになります。PINされたオブジェクトはガベージコレクションで移動されないのでメモリが断片化します。その結果、Out Of Memoryが発生します。</p>

<h2>
<span id="リフレクションexpressionツリーdynamicasyncスレッド" class="fragment"></span><a href="#%E3%83%AA%E3%83%95%E3%83%AC%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3expression%E3%83%84%E3%83%AA%E3%83%BCdynamicasync%E3%82%B9%E3%83%AC%E3%83%83%E3%83%89"><i class="fa fa-link"></i></a>リフレクション、Expressionツリー、dynamic、async、スレッド</h2>

<p>その他、様々な高速化のTipsを紹介します。</p>

<h3>
<span id="リフレクションをキャッシュする" class="fragment"></span><a href="#%E3%83%AA%E3%83%95%E3%83%AC%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%92%E3%82%AD%E3%83%A3%E3%83%83%E3%82%B7%E3%83%A5%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>リフレクションをキャッシュする</h3>

<p>リフレクションは非常に遅い処理になります。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="n">List</span><span class="p">&lt;</span><span class="n">UserRecord</span><span class="p">&gt;</span> <span class="n">userList</span> <span class="p">=</span> <span class="nf">GetUserList</span><span class="p">();</span>
<span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">user</span> <span class="k">in</span> <span class="n">userList</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">PropertyInfo</span> <span class="n">namePropertyInfo</span> <span class="p">=</span> <span class="nf">Typeof</span><span class="p">(</span><span class="n">UserRecord</span><span class="p">).</span><span class="nf">GetProperty</span><span class="p">(</span><span class="s">"Name"</span><span class="p">);</span> <span class="c1">//非常に遅い！</span>
    <span class="n">String</span> <span class="n">userName</span> <span class="p">=</span> <span class="p">(</span><span class="n">String</span><span class="p">)</span><span class="n">namePropertyInfo</span><span class="p">.</span><span class="nf">GetValue</span><span class="p">(</span><span class="n">u</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>実行回数を減らして低速化を回避しましょう。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="n">PropertyInfo</span> <span class="n">namePropertyInfo</span> <span class="p">=</span> <span class="nf">Typeof</span><span class="p">(</span><span class="n">UserRecord</span><span class="p">).</span><span class="nf">GetProperty</span><span class="p">(</span><span class="s">"Name"</span><span class="p">);</span>

<span class="n">List</span><span class="p">&lt;</span><span class="n">UserRecord</span><span class="p">&gt;</span> <span class="n">userList</span> <span class="p">=</span> <span class="nf">GetUserList</span><span class="p">();</span>
<span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">user</span> <span class="k">in</span> <span class="n">userList</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">String</span> <span class="n">userName</span> <span class="p">=</span> <span class="p">(</span><span class="n">String</span><span class="p">)</span><span class="n">namePropertyInfo</span><span class="p">.</span><span class="nf">GetValue</span><span class="p">(</span><span class="n">u</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>GetProperty,GetMethodなどは低速です。キャッシュを使用して低速化を回避しましょう。<br>
<a href="https://yamaokuno-usausa.hatenablog.com/entry/20090821/1250813986" class="autolink" rel="nofollow noopener" target="_blank">https://yamaokuno-usausa.hatenablog.com/entry/20090821/1250813986</a></p>

<h3>
<span id="dynamicをうまいこと活用する" class="fragment"></span><a href="#dynamic%E3%82%92%E3%81%86%E3%81%BE%E3%81%84%E3%81%93%E3%81%A8%E6%B4%BB%E7%94%A8%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>dynamicをうまいこと活用する</h3>

<p>dynamicを利用するとキャッシュをある程度コンパイラがいい感じにやってくれます↓<br>
<a href="https://ufcpp.net/study/csharp/misc_dynamic.html" class="autolink" rel="nofollow noopener" target="_blank">https://ufcpp.net/study/csharp/misc_dynamic.html</a></p>

<h3>
<span id="generic-type-cachingを使用する" class="fragment"></span><a href="#generic-type-caching%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>Generic Type Cachingを使用する</h3>

<p>Generic Type Cachingを使用するとコンパイル時にマップが完了しているため高速です。静的にTypeが確定できる場合は利用していきましょう。<br>
<a href="http://csharpvbcomparer.blogspot.com/2014/03/tips-generic-type-caching.html" class="autolink" rel="nofollow noopener" target="_blank">http://csharpvbcomparer.blogspot.com/2014/03/tips-generic-type-caching.html</a></p>

<h3>
<span id="expressionツリーのコンパイルをキャッシュする" class="fragment"></span><a href="#expression%E3%83%84%E3%83%AA%E3%83%BC%E3%81%AE%E3%82%B3%E3%83%B3%E3%83%91%E3%82%A4%E3%83%AB%E3%82%92%E3%82%AD%E3%83%A3%E3%83%83%E3%82%B7%E3%83%A5%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>Expressionツリーのコンパイルをキャッシュする</h3>

<p>Expressionのコンパイルは重い処理です。コンパイル済みのデリゲートをキャッシュするようにしましょう。</p>

<h3>
<span id="regexクラスをコンパイル済みにする" class="fragment"></span><a href="#regex%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%92%E3%82%B3%E3%83%B3%E3%83%91%E3%82%A4%E3%83%AB%E6%B8%88%E3%81%BF%E3%81%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>Regexクラスをコンパイル済みにする</h3>

<p>以下のコードでRegexクラスをコンパイル済みにします。<br>
var rg= new Regex("[a-zA-Z0-9-]*", RegexOptions.Compiled);<br>
コンパイル済みにすることでパフォーマンスの向上が期待できます。</p>

<h3>
<span id="enumのtostringを高速化する" class="fragment"></span><a href="#enum%E3%81%AEtostring%E3%82%92%E9%AB%98%E9%80%9F%E5%8C%96%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>EnumのToStringを高速化する</h3>

<p>EnumのToStringは内部でリフレクションを使用しています。<br>
<a href="https://referencesource.microsoft.com/#mscorlib/system/type.cs,d5cd3cb0c6c2b6c1" class="autolink" rel="nofollow noopener" target="_blank">https://referencesource.microsoft.com/#mscorlib/system/type.cs,d5cd3cb0c6c2b6c1</a></p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">override</span> <span class="n">String</span> <span class="nf">ToString</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">Enum</span><span class="p">.</span><span class="nf">InternalFormat</span><span class="p">((</span><span class="n">RuntimeType</span><span class="p">)</span><span class="nf">GetType</span><span class="p">(),</span> <span class="nf">GetValue</span><span class="p">());</span>
<span class="p">}</span>
<span class="c1">//************************省略***************************</span>
<span class="k">private</span> <span class="k">void</span> <span class="nf">GetEnumData</span><span class="p">(</span><span class="k">out</span> <span class="kt">string</span><span class="p">[]</span> <span class="n">enumNames</span><span class="p">,</span> <span class="k">out</span> <span class="n">Array</span> <span class="n">enumValues</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">Contract</span><span class="p">.</span><span class="nf">Ensures</span><span class="p">(</span><span class="n">Contract</span><span class="p">.</span><span class="n">ValueAtReturn</span><span class="p">&lt;</span><span class="n">String</span><span class="p">[</span><span class="k">]&gt;</span><span class="p">(</span><span class="k">out</span> <span class="n">enumNames</span><span class="p">)</span> <span class="p">!=</span> <span class="k">null</span><span class="p">);</span>
    <span class="n">Contract</span><span class="p">.</span><span class="nf">Ensures</span><span class="p">(</span><span class="n">Contract</span><span class="p">.</span><span class="n">ValueAtReturn</span><span class="p">&lt;</span><span class="n">Array</span><span class="p">&gt;(</span><span class="k">out</span> <span class="n">enumValues</span><span class="p">)</span> <span class="p">!=</span> <span class="k">null</span><span class="p">);</span>

    <span class="n">FieldInfo</span><span class="p">[]</span> <span class="n">flds</span> <span class="p">=</span> <span class="nf">GetFields</span><span class="p">(</span><span class="n">BindingFlags</span><span class="p">.</span><span class="n">Public</span> <span class="p">|</span> <span class="n">BindingFlags</span><span class="p">.</span><span class="n">NonPublic</span> <span class="p">|</span> <span class="n">BindingFlags</span><span class="p">.</span><span class="n">Static</span><span class="p">);</span>

    <span class="kt">object</span><span class="p">[]</span> <span class="n">values</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">object</span><span class="p">[</span><span class="n">flds</span><span class="p">.</span><span class="n">Length</span><span class="p">];</span>
    <span class="kt">string</span><span class="p">[]</span> <span class="n">names</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">string</span><span class="p">[</span><span class="n">flds</span><span class="p">.</span><span class="n">Length</span><span class="p">];</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">flds</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
    <span class="p">{</span>
        <span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">=</span> <span class="n">flds</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Name</span><span class="p">;</span>
        <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">=</span> <span class="n">flds</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="nf">GetRawConstantValue</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="c1">// Insertion Sort these values in ascending order.</span>
    <span class="c1">// We use this O(n^2) algorithm, but it turns out that most of the time the elements are already in sorted order and</span>
    <span class="c1">// the common case performance will be faster than quick sorting this.</span>
    <span class="n">IComparer</span> <span class="n">comparer</span> <span class="p">=</span> <span class="n">Comparer</span><span class="p">.</span><span class="n">Default</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">values</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
    <span class="p">{</span>
        <span class="kt">int</span> <span class="n">j</span> <span class="p">=</span> <span class="n">i</span><span class="p">;</span>
        <span class="kt">string</span> <span class="n">tempStr</span> <span class="p">=</span> <span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="kt">object</span> <span class="n">val</span> <span class="p">=</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="kt">bool</span> <span class="n">exchanged</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>

        <span class="c1">// Since the elements are sorted we only need to do one comparision, we keep the check for j inside the loop.</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">comparer</span><span class="p">.</span><span class="nf">Compare</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">j</span> <span class="p">-</span> <span class="m">1</span><span class="p">],</span> <span class="n">val</span><span class="p">)</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">names</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="p">=</span> <span class="n">names</span><span class="p">[</span><span class="n">j</span> <span class="p">-</span> <span class="m">1</span><span class="p">];</span>
            <span class="n">values</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="p">=</span> <span class="n">values</span><span class="p">[</span><span class="n">j</span> <span class="p">-</span> <span class="m">1</span><span class="p">];</span>
            <span class="n">j</span><span class="p">--;</span>
            <span class="n">exchanged</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">j</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>
                <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">exchanged</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">names</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="p">=</span> <span class="n">tempStr</span><span class="p">;</span>
            <span class="n">values</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="p">=</span> <span class="n">val</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">enumNames</span> <span class="p">=</span> <span class="n">names</span><span class="p">;</span>
    <span class="n">enumValues</span> <span class="p">=</span> <span class="n">values</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>リフレクションを使用しているため非常に遅いです。<br>
高速化する方法は以下になります↓<br>
<a href="https://qiita.com/higty/items/513296536d3b26fbd033" class="autolink" id="reference-33224046a0350306be14">https://qiita.com/higty/items/513296536d3b26fbd033</a></p>

<h3>
<span id="ループを展開する" class="fragment"></span><a href="#%E3%83%AB%E3%83%BC%E3%83%97%E3%82%92%E5%B1%95%E9%96%8B%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>ループを展開する</h3>

<p>ループを展開すると高速化が可能です。例えば配列の全ての値を1増やす場合を考えてみます。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="kt">var</span> <span class="n">numberList</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Int32</span><span class="p">[</span><span class="m">40000</span><span class="p">];</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">var</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">numberList</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
<span class="p">{</span>
    <span class="n">numberList</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>ループを展開し、4つの要素を一気に処理するように変更します。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="kt">var</span> <span class="n">numberList</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Int32</span><span class="p">[</span><span class="m">40000</span><span class="p">];</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">var</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="m">10000</span><span class="p">;</span> <span class="n">i</span> <span class="p">=</span> <span class="n">i</span> <span class="p">+</span> <span class="m">4</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">numberList</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span>
    <span class="n">numberList</span><span class="p">[</span><span class="n">i</span> <span class="p">+</span> <span class="m">1</span><span class="p">]</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span>
    <span class="n">numberList</span><span class="p">[</span><span class="n">i</span> <span class="p">+</span> <span class="m">2</span><span class="p">]</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span>
    <span class="n">numberList</span><span class="p">[</span><span class="n">i</span> <span class="p">+</span> <span class="m">3</span><span class="p">]</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>ループ処理では毎回処理を繰り返すかの条件を検証する式（i &lt; numberList.Length）とインクリメント（i++）の処理が実行されます。<br>
展開することで40000回の上記の処理が10000回になり、30000回の条件の評価とインクリメントの処理がなくなることになります。配列の要素数が4の倍数でない場合は多少の調整が必要ですが、このようにループの展開を使用すると処理を高速化できます。4ではなく10とかもっと増やせばもっと高速化できます。</p>

<h3>
<span id="foreachの代わりにforを使用する" class="fragment"></span><a href="#foreach%E3%81%AE%E4%BB%A3%E3%82%8F%E3%82%8A%E3%81%ABfor%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>foreachの代わりにforを使用する</h3>

<p>foreachはCurrentプロパティへのアクセス、MoveNextメソッドの呼び出しが毎回あるためforよりもわずかに低速です。通常の多くの部分では無視できるくらいの差しかありませんが、非常にシビアなパフォーマンスの向上が求められる場合にはforの使用を検討してみましょう。特に配列とforの組み合わせだとコンパイラが相当な最適化をしてくれます。</p>

<h3>
<span id="linq風の書き方を避けてforeachを使用する" class="fragment"></span><a href="#linq%E9%A2%A8%E3%81%AE%E6%9B%B8%E3%81%8D%E6%96%B9%E3%82%92%E9%81%BF%E3%81%91%E3%81%A6foreach%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>LINQ風の書き方を避けてforeachを使用する</h3>

<p>LINQ風のメソッドチェーンを繋げる呼び出しはメソッド呼び出しの分などで少し遅いorだいぶ遅くなることがあります。<br>
このページのコメントのやり取り参照↓<br>
<a href="https://michaelscodingspot.com/performance-problems-in-csharp-dotnet/" class="autolink" rel="nofollow noopener" target="_blank">https://michaelscodingspot.com/performance-problems-in-csharp-dotnet/</a></p>

<p>LINQ風の書き方</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="kt">var</span> <span class="n">numbers</span> <span class="p">=</span> <span class="nf">GetNumbers</span><span class="p">();</span>
<span class="kt">int</span> <span class="n">total</span> <span class="p">=</span> <span class="n">numbers</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">n</span> <span class="p">=&gt;</span> <span class="n">n</span> <span class="p">%</span> <span class="m">2</span> <span class="p">==</span> <span class="m">0</span><span class="p">).</span><span class="nf">Sum</span><span class="p">(</span><span class="n">n</span> <span class="p">=&gt;</span> <span class="n">n</span> <span class="p">*</span> <span class="m">2</span><span class="p">);</span>
<span class="k">return</span> <span class="n">total</span><span class="p">;</span>
</code></pre></div></div>

<p>LINQ風の書き方でもオプティマイザが最大限最適化してくれはしますが、通常のforeachの方が早いことがほとんどです。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="kt">var</span> <span class="n">numbers</span> <span class="p">=</span> <span class="nf">GetNumbers</span><span class="p">();</span>
<span class="kt">int</span> <span class="n">total</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
<span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">number</span> <span class="k">in</span> <span class="n">numbers</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">number</span> <span class="p">%</span> <span class="m">2</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">total</span> <span class="p">+=</span> <span class="n">number</span> <span class="p">*</span> <span class="m">2</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="k">return</span> <span class="n">total</span><span class="p">;</span>
</code></pre></div></div>

<h3>
<span id="arrayのコピーについて" class="fragment"></span><a href="#array%E3%81%AE%E3%82%B3%E3%83%94%E3%83%BC%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>Arrayのコピーについて</h3>

<p>ソース↓<br>
<a href="https://stackoverflow.com/questions/5099604/any-faster-way-of-copying-arrays-in-c" class="autolink" rel="nofollow noopener" target="_blank">https://stackoverflow.com/questions/5099604/any-faster-way-of-copying-arrays-in-c</a><br>
<a href="https://marcelltoth.net/article/41/fastest-way-to-copy-a-net-array" class="autolink" rel="nofollow noopener" target="_blank">https://marcelltoth.net/article/41/fastest-way-to-copy-a-net-array</a><br>
<a href="https://www.youtube.com/watch?time_continue=4&amp;v=-H5oEgOdO6U&amp;t=1689" class="autolink" rel="nofollow noopener" target="_blank">https://www.youtube.com/watch?time_continue=4&amp;v=-H5oEgOdO6U&amp;t=1689</a><br>
この動画によるとArray.CopyToが最速っぽいです。理由はOSのAPIを直接呼出しているからと言ってます。</p>

<h3>
<span id="ドキュメントに無いarrayの秘密" class="fragment"></span><a href="#%E3%83%89%E3%82%AD%E3%83%A5%E3%83%A1%E3%83%B3%E3%83%88%E3%81%AB%E7%84%A1%E3%81%84array%E3%81%AE%E7%A7%98%E5%AF%86"><i class="fa fa-link"></i></a>ドキュメントに無いArrayの秘密</h3>

<p><qiita-embed-ogp src="https://www.codeproject.com/Articles/3467/Arrays-UNDOCUMENTED"></qiita-embed-ogp></p>

<p>Arrayのループは以下が最速</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="kt">int</span> <span class="n">hash</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">=</span><span class="m">0</span><span class="p">;</span> <span class="n">i</span><span class="p">&lt;</span> <span class="n">a</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
<span class="p">{</span>
    <span class="n">hash</span> <span class="p">+=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="p">}</span>
</code></pre></div></div>

<p>ローカル変数にLengthを保存すると遅くなる</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="kt">int</span> <span class="n">hash</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">length</span> <span class="p">=</span> <span class="n">a</span><span class="p">.</span><span class="n">length</span><span class="p">;</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">=</span><span class="m">0</span><span class="p">;</span> <span class="n">i</span><span class="p">&lt;</span> <span class="n">length</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
<span class="p">{</span>
    <span class="n">hash</span> <span class="p">+=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="p">}</span>
</code></pre></div></div>

<p>下のコードの場合は他スレッドからの変更とかを考慮するとlength変数が変更されていないことを保証するのが難しい（コンパイルに時間がかかる）です。その結果、Arrayの境界値チェックが働くので遅くなってしまいます。最初の例だとa.Lengthは配列の長さ以内という事が確定しているので境界値チェックを省略し、配列の各要素への処理を最適化した中間コードが生成されるので速くなります。</p>

<h3>
<span id="プロパティの代わりにフィールドを使用する" class="fragment"></span><a href="#%E3%83%97%E3%83%AD%E3%83%91%E3%83%86%E3%82%A3%E3%81%AE%E4%BB%A3%E3%82%8F%E3%82%8A%E3%81%AB%E3%83%95%E3%82%A3%E3%83%BC%E3%83%AB%E3%83%89%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>プロパティの代わりにフィールドを使用する</h3>

<p>プロパティは実際にはメソッドです。プロパティアクセスの際にはメソッド呼び出しが挟まることになります。パフォーマンスがシビアに求められる環境ではメソッド呼び出しのコストさえも容認できないときがあります。そのようなときはプロパティではなくフィールドにしてしまうことも検討しましょう。</p>

<h3>
<span id="ループのindexに注意する" class="fragment"></span><a href="#%E3%83%AB%E3%83%BC%E3%83%97%E3%81%AEindex%E3%81%AB%E6%B3%A8%E6%84%8F%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>ループのindexに注意する</h3>

<p>2重ループのインデックスの順序を間違うとCPUのメモリ局所性をうまく活用できず処理が遅くなることがあります。<br>
<a href="https://raygun.com/blog/c-sharp-performance-tips-tricks/" class="autolink" rel="nofollow noopener" target="_blank">https://raygun.com/blog/c-sharp-performance-tips-tricks/</a></p>

<p>メモリ局所性をうまく活用できるコード</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">_map</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
<span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">n</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">n</span> <span class="p">&lt;</span> <span class="n">_map</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">n</span><span class="p">++)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">_map</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">n</span><span class="p">]</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">result</span><span class="p">++;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>うまく活用できないコード</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">_map</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
<span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">n</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">n</span> <span class="p">&lt;</span> <span class="n">_map</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">n</span><span class="p">++)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">_map</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">result</span><span class="p">++;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>上のコードの方が8倍ほど高速です。上記のコードの方が使用するデータがメモリー上で近い位置に配置されて一気に読み込めます。</p>

<h3>
<span id="uiを常に反応するようにする" class="fragment"></span><a href="#ui%E3%82%92%E5%B8%B8%E3%81%AB%E5%8F%8D%E5%BF%9C%E3%81%99%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>UIを常に反応するようにする</h3>

<p>UIが反応がないとユーザーはストレスを感じます。長時間かかる処理などはバックグラウンドスレッドで実行し、UIスレッドは常に反応するようにしましょう。Threadクラスを使用するかasync、awaitパターンを使用しましょう。</p>

<h3>
<span id="キャッシュ機能を実装する" class="fragment"></span><a href="#%E3%82%AD%E3%83%A3%E3%83%83%E3%82%B7%E3%83%A5%E6%A9%9F%E8%83%BD%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>キャッシュ機能を実装する</h3>

<p>DBのデータやネットワーク通信で取得したデータ、ファイル操作で取得したデータなどをメモリ上やRedis上に置いておいてアクセスを高速化します。キャッシュに適しているのは以下の特性を持つデータです。<br>
・データ量が小さい<br>
・頻繁に参照される<br>
・あまり変更されない<br>
メモリ上の保持するためあまり大きなデータをキャッシュしてしまうとメモリが枯渇します。あまり参照されないものをキャッシュすると貴重なメモリ領域を無駄に浪費することになります。キャッシュ元のデータが更新された場合、キャッシュを更新する必要があります。頻繁に更新されるデータをキャッシュすると更新処理でCPUとメモリを使用するのでこのようなデータはキャッシュに適していません。</p>

<p>以上を踏まえると例えば以下のようなデータがキャッシュの対象として適切です。</p>

<p>・アプリケーションのテキスト（追加ボタンの”追加”という文字などは不変）<br>
・組織マスタ（1年に1回しか変更されない）<br>
・先月の売上データの表のHTML（先月の売上データは不変）<br>
などが挙げられます。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">CacheData</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">String</span><span class="p">&gt;</span> <span class="n">TextList</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">String</span><span class="p">&gt;();</span>
<span class="p">}</span>
</code></pre></div></div>

<p>基本的にはstaticフィールド（もしくはプロパティ）で実装することになるでしょう。元のデータが更新されたときにはこのデータを更新します。WEBアプリケーションの場合は複数のスレッドからのアクセスがあるため、lockなどで競合の管理が必要です。</p>

<p>またクラウドでWEBアプリをスケールアウトしている場合はRedisのPublish、Subscribeを使用して複数のWEBアプリに通知を送ることで全てのWEBアプリのキャッシュを更新することが可能です。</p>

<p>この記事ではC#を例にしてキャッシュを紹介していますが、キャッシュの仕組み自体は応用が利きます。CDN、DNS、ブラウザの画像ファイルなど様々なところでキャッシュの仕組みが使われています。</p>

<h3>
<span id="デバッグビルドは遅くリリースビルドは速い" class="fragment"></span><a href="#%E3%83%87%E3%83%90%E3%83%83%E3%82%B0%E3%83%93%E3%83%AB%E3%83%89%E3%81%AF%E9%81%85%E3%81%8F%E3%83%AA%E3%83%AA%E3%83%BC%E3%82%B9%E3%83%93%E3%83%AB%E3%83%89%E3%81%AF%E9%80%9F%E3%81%84"><i class="fa fa-link"></i></a>デバッグビルドは遅くリリースビルドは速い</h3>

<p>忘れずにリリースビルドにしましょう。</p>

<h1>
<span id="おまけ" class="fragment"></span><a href="#%E3%81%8A%E3%81%BE%E3%81%91"><i class="fa fa-link"></i></a>おまけ</h1>

<p>ハイパフォーマンスなアプリケーションの作成方法に興味がある方向けにいくつか記事を書いてみました。<br>
<a href="https://qiita.com/higty/items/598716cb160b61b1ddb0" id="reference-a600dad7dbf47eacc240">タスク管理を作ってみた　～初級からレベルアップするためのツールとサービスたち～</a><br>
<a href="https://qiita.com/higty/items/b021c1d379d94b55de47" id="reference-c58fc49558513bac11ab">WEBアプリケーションのパフォーマンスをUPするために知っておくべき技術と知識</a><br>
<a href="https://qiita.com/higty/items/30267dd386d7cd6e5a93" id="reference-10a32c94976ebee2db04">C#で世界最速のMapperライブラリを作ってみた（AutoMapperなどよりも3倍-10倍ほど高速）</a><br>
<a href="https://qiita.com/higty/items/788cae32a8726d8baa82" id="reference-b0d1bc8be5d5c9c1daa8">プログラマのための機能のUIデザイン</a><br>
<a href="https://qiita.com/higty/items/f1f981719b1a59b9e020" id="reference-6a7815d67496db088ae0">世界で通用するエンジニアになるための高度な技術記事（英語）</a></p>

<h1>
<span id="付録" class="fragment"></span><a href="#%E4%BB%98%E9%8C%B2"><i class="fa fa-link"></i></a>付録</h1>

<p>※その他の引用した記事<br>
<a href="https://michaelscodingspot.com/performance-problems-in-csharp-dotnet/" class="autolink" rel="nofollow noopener" target="_blank">https://michaelscodingspot.com/performance-problems-in-csharp-dotnet/</a><br>
<a href="https://devblogs.microsoft.com/dotnet/system-io-pipelines-high-performance-io-in-net/" class="autolink" rel="nofollow noopener" target="_blank">https://devblogs.microsoft.com/dotnet/system-io-pipelines-high-performance-io-in-net/</a><br>
<a href="https://raygun.com/blog/c-sharp-performance-tips-tricks/" class="autolink" rel="nofollow noopener" target="_blank">https://raygun.com/blog/c-sharp-performance-tips-tricks/</a><br>
<a href="https://www.c-sharpcorner.com/UploadFile/dacca2/5-tips-to-improve-performance-of-C-Sharp-code/" class="autolink" rel="nofollow noopener" target="_blank">https://www.c-sharpcorner.com/UploadFile/dacca2/5-tips-to-improve-performance-of-C-Sharp-code/</a><br>
<a href="https://michaelscodingspot.com/avoid-gc-pressure/" class="autolink" rel="nofollow noopener" target="_blank">https://michaelscodingspot.com/avoid-gc-pressure/</a><br>
<a href="https://michaelscodingspot.com/challenging-the-c-stringbuilder/" class="autolink" rel="nofollow noopener" target="_blank">https://michaelscodingspot.com/challenging-the-c-stringbuilder/</a></p>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Fhigty%2Fitems%2F306eebe988af39ba775d&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Fhigty%2Fitems%2F306eebe988af39ba775d&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/higty/items/306eebe988af39ba775d/likers" class="css-1iupg5d">9</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">14</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/306eebe988af39ba775d/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/higty/items/306eebe988af39ba775d/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/higty/items/306eebe988af39ba775d/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/higty/items/306eebe988af39ba775d/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/higty/items/306eebe988af39ba775d.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-d043fa4b-207f-445b-9402-74b0f49417d0">{"authorAnalyticsTrackingId":null,"organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-471fb54a-6baf-4186-ad50-7b96b46959a2"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-471fb54a-6baf-4186-ad50-7b96b46959a2">{}</script>
      
<div id="LoginModal-react-component-2f9a66f6-de79-4b08-a6e4-79200a288db0"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-2f9a66f6-de79-4b08-a6e4-79200a288db0">{}</script>
      
<div id="StockModal-react-component-d5895671-1999-40c5-afeb-44a24ee3816a"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-d5895671-1999-40c5-afeb-44a24ee3816a">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;NKvh7UWaOfaqjm7YNsatZgZx/rGDBJgTCTef2eOetOJqfpV9udHlazEQzw1WfjvgvROj1ED6z5lBYsMZCEJ8ZQ==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\n\u003ch1\u003e\n\u003cspan id=\"はじめに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eはじめに\u003c/h1\u003e\n\n\u003cp\u003eこちらの記事をQiitaにも共有してコミュニティに貢献したいと思います。\u003cbr\u003e\n\u003ca href=\"https://academy.tinybetter.com/Article/37407ec1-cd3a-50c8-2fa1-39f6ed3dae74/View\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://academy.tinybetter.com/Article/37407ec1-cd3a-50c8-2fa1-39f6ed3dae74/View\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eネット上には様々な記事が溢れていますが情報が断片化していてプログラムを始めた初心者には全体像を掴むのが難しいです。コンピューターサイエンスの基本的な理解とパフォーマンスTIPSをまとめた記事があまり見当たらないのでまとめてみました。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"全てを計測する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%85%A8%E3%81%A6%E3%82%92%E8%A8%88%E6%B8%AC%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e全てを計測する\u003c/h1\u003e\n\n\u003cp\u003eパフォーマンスチューニングの最も大事な原則は計測することです。\u003cbr\u003e\n計測用のツールをまとめておきます。\u003c/p\u003e\n\n\u003cp\u003e■BenchmarkDotNet\u003cbr\u003e\n\u003ca href=\"https://benchmarkdotnet.org/articles/overview.html\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://benchmarkdotnet.org/articles/overview.html\u003c/a\u003e\u003cbr\u003e\nC#コードの計測をするツールです。Nugetから利用できます。Stopwatchクラスではなくこちらを使いましょう。StopwatchではGCなどの影響を正しく計測できません。\u003c/p\u003e\n\n\u003cp\u003e■Visual Studio プロファイリング ツール\u003cbr\u003e\n\u003ca href=\"https://docs.microsoft.com/ja-jp/visualstudio/profiling/?view=vs-2019\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://docs.microsoft.com/ja-jp/visualstudio/profiling/?view=vs-2019\u003c/a\u003e\u003cbr\u003e\nVisual Studioのプロファイリングツールを使用するとCPU、メモリ、スレッド、GC、LOHなどの状態を確認できます。呼び出しツリーを見ればどのメソッドのどのコードがCritical Pathなのかすぐに見つけることができます。\u003c/p\u003e\n\n\u003cp\u003e■Fiddler\u003cbr\u003e\n\u003ca href=\"https://www.telerik.com/fiddler\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://www.telerik.com/fiddler\u003c/a\u003e\u003cbr\u003e\nネットワークの内容をキャプチャしてくれるツールです。\u003cbr\u003e\n\u003ca href=\"https://zappysys.com/blog/how-to-use-fiddler-to-analyze-http-web-requests/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://zappysys.com/blog/how-to-use-fiddler-to-analyze-http-web-requests/\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e■ブラウザの開発者ツール\u003cbr\u003e\nFiddlerをインストールしなくてもブラウザの開発者ツールでネットワークの内容をキャプチャすることもできます。Fiddlerの方が高機能な印象ですが簡単に調べるだけならブラウザの開発者ツールでも良いでしょう。\u003c/p\u003e\n\n\u003cp\u003e■Wireshark\u003cbr\u003e\n\u003ca href=\"https://www.wireshark.org/download.html\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://www.wireshark.org/download.html\u003c/a\u003e\u003cbr\u003e\nTCP/IP通信のキャプチャができるソフトです。\u003cbr\u003e\n\u003ca href=\"https://knowledge.sakura.ad.jp/6286/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://knowledge.sakura.ad.jp/6286/\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://hldc.co.jp/blog/2020/04/15/3988/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://hldc.co.jp/blog/2020/04/15/3988/\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eアプリケーション開発ではあまりお世話にならないかもしれませんが通信を深く見たい時がいつか来るかもしれません。覚えておきましょう。\u003c/p\u003e\n\n\u003cp\u003e■WinDbg\u003cbr\u003e\n\u003ca href=\"https://docs.microsoft.com/ja-jp/windows-hardware/drivers/debugger/debugger-download-tools\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://docs.microsoft.com/ja-jp/windows-hardware/drivers/debugger/debugger-download-tools\u003c/a\u003e\u003cbr\u003e\nWindowsのダンプファイルを取得して解析することができます。スタックトレースを取得してどのメソッドが原因なのか解析できます。\u003cbr\u003e\n\u003ca href=\"https://docs.microsoft.com/ja-jp/windows-hardware/drivers/debugger/debugging-using-windbg-preview\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://docs.microsoft.com/ja-jp/windows-hardware/drivers/debugger/debugging-using-windbg-preview\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/debugging-using-windbg\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/debugging-using-windbg\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://blog.engineer-memo.com/2012/06/24/%E3%82%AF%E3%83%A9%E3%83%83%E3%82%B7%E3%83%A5%E3%83%80%E3%83%B3%E3%83%97%E8%A7%A3%E6%9E%90%E3%81%AE%E3%81%AF%E3%81%98%E3%82%81%E3%81%AE%E4%B8%80%E6%AD%A9/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eクラッシュダンプ解析のはじめの一歩\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eこの記事の内容はだいたい合ってると思いますが嘘があるかもしれません。C#が進化して昔と変わってしまったりなどがあるのでネットの情報を鵜呑みにするのではなく、しっかりと自分で計測して確かめることが大事です。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"コンピューターとネットワークを理解する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B3%E3%83%B3%E3%83%94%E3%83%A5%E3%83%BC%E3%82%BF%E3%83%BC%E3%81%A8%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E3%82%92%E7%90%86%E8%A7%A3%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eコンピューターとネットワークを理解する\u003c/h1\u003e\n\n\u003cp\u003eパフォーマンスへの影響を理解するためにはコンピューターとネットワークの原理の理解が欠かせません。コンピューターはCPU、メモリ、ハードディスクから構成されます。CPUは計算処理、メモリとハードディスクは記憶装置です。メモリはさらにいくつかの種類に細分化されます。\u003c/p\u003e\n\n\u003cp\u003eCPUの計算処理の向上により、メモリへの読み書きがついていけなくなりました。その結果、キャッシュメモリーという機構が用意されるようになりました。\u003cbr\u003e\n\u003ca href=\"https://ascii.jp/elem/000/000/563/563800/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://ascii.jp/elem/000/000/563/563800/\u003c/a\u003e\u003cbr\u003e\nキャッシュメモリー（1次）が一番早く、キャッシュメモリー（2次）→キャッシュメモリー（3次）→スタックメモリ→ヒープメモリ→SSD→ハードディスクの順で遅くなります。容量はハードディスクが一番大きいです。また価格はだんだん安くなります。\u003c/p\u003e\n\n\u003cp\u003eさてネットワーク通信にて、とある文字列を送信するには文字データをByteに変換し、DNSで名前解決してターゲットのPCを特定し、TCP/IPでthree-way handshakeでやり取りをしてからSliding Windowで徐々に送信量を増やしていくという処理になります。\u003cbr\u003e\n\u003ca href=\"https://www.infraexpert.com/study/tcpip11.html\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://www.infraexpert.com/study/tcpip11.html\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://ascii.jp/elem/000/000/619/619702/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://ascii.jp/elem/000/000/619/619702/\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e上記の感じで処理がされるのでネットワーク通信は非常に時間がかかる処理になります。通信は最終的には電圧のON/OFFの信号へ変換され、ケーブルへの外部からの電波などの干渉で電圧信号が欠損したりするのでそれをTCP/IPが検出して再度送りなおしたりなどが発生するので遅くなります。UDPだと少し早いですがいずれにしてもネットワーク通信はプログラミングの中では一番遅い処理になります。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"優先順位を理解する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%84%AA%E5%85%88%E9%A0%86%E4%BD%8D%E3%82%92%E7%90%86%E8%A7%A3%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e優先順位を理解する\u003c/h1\u003e\n\n\u003cp\u003eさてコンピューターとネットワークへの理解が深まったところで優先順位と基本的な取り組み方について学びます。ホットコードパス、ネットワーク呼び出し、ファイルIO、ヒープメモリ、スレッド、非同期などについて解説していきます。実践部分は今回はC#と.NETを例に解説していきますが、Python,Javaなどでもネットワーク通信、ヒープメモリ、ガベージコレクションの基本的な考え方は同じです。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ホットコードパス\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%9B%E3%83%83%E3%83%88%E3%82%B3%E3%83%BC%E3%83%89%E3%83%91%E3%82%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eホットコードパス\u003c/h2\u003e\n\n\u003cp\u003eまず最初に理解しておく必要があるのはホットコードパスの概念です。for文などの繰り返し処理の内部は何度も実行されます。例えば以下のような画面を考えます。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/5d774af853685afeb334700d9a4d2580193a496a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39363438332f64653636316461312d393732632d653035362d363535302d3938383634316537303761612e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F96483%2Fde661da1-972c-e056-6550-988641e707aa.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=4308322eec9e57879045f2cd808072f9\" alt=\"tasklist.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/96483/de661da1-972c-e056-6550-988641e707aa.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F96483%2Fde661da1-972c-e056-6550-988641e707aa.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=a8a312360f4991b316c75c94e3844bc3 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eこういった画面を作るには下記の順でfor文などで繰り返し処理を書くことになるでしょう。\u003cbr\u003e\n複数のユーザー→複数の日付→複数のタスク\u003cbr\u003e\n概念的にはこんな感じになります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eShowCalendar\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eUserRecord\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003euserList\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetUserList\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e \u003cspan class=\"c1\"\u003e//ネットワーク通信その1\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003euser\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003euserList\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003estartDate\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eDateTime\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e2020\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e9\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e12\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"m\"\u003e21\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003edate\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estartDate\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAddDays\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003etaskList\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetTaskList\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edate\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e//ネットワーク通信その2\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003etask\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003etaskList\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"nf\"\u003eCreateTaskTableCell\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etask\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eCreateTaskTableCell\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eTaskRecord\u003c/span\u003e \u003cspan class=\"n\"\u003erecord\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//HOT PATH!!!!!!\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// Get color of Task\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ecolor\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetColorFromDatabase\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e \u003cspan class=\"c1\"\u003e//ネットワーク通信その3\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eとこんな感じだとしましょう。ネットワーク通信のコードが3つあります。\u003c/p\u003e\n\n\u003cp\u003eCreateTaskTableCellメソッドの内部のコードはホットコードパスになります。このメソッドは非常に多くの回数呼ばれます。例えばユーザーが100人、日数が21日、タスクが1日あたり平均5個ある場合、10500回呼ばれることになります。その中でDBから色データを取得するなどというコード（ネットワーク通信その3）を書いた場合、DBアクセスが10ミリ秒だとすると10ミリ秒×10500＝105秒はかかることになります。ページが表示されるまで2分弱かかることになるでしょう。ネットワーク通信その2は2100回なのでネットワーク通信その3よりはましですがこれも改善の必要があります。\u003cbr\u003e\nネットワーク通信その1は1回しか呼ばれていないのでそのままでも良いでしょう。\u003c/p\u003e\n\n\u003cp\u003eこのように実行される回数が多い部分のコードをホットコードパスと言い、このコードを優先的に改善していく必要があります。\u003cbr\u003e\nこの動画\u003cbr\u003e\n\u003ca href=\"https://www.youtube.com/watch?v=4yALYEINbyI\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://www.youtube.com/watch?v=4yALYEINbyI\u003c/a\u003e\u003cbr\u003e\nの12:10では\u003cbr\u003e\n20%のコードが80%のリソースを消費している。\u003cbr\u003e\n4.0%のコードが64%のリソースを消費している。\u003cbr\u003e\n0.8%のコードが51%のリソースを消費している。\u003cbr\u003e\nと言っています。ホットコードパスがいかにリソースを消費しているのかがわかると思います。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"影響の大きいところから改善する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%BD%B1%E9%9F%BF%E3%81%AE%E5%A4%A7%E3%81%8D%E3%81%84%E3%81%A8%E3%81%93%E3%82%8D%E3%81%8B%E3%82%89%E6%94%B9%E5%96%84%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e影響の大きいところから改善する\u003c/h2\u003e\n\n\u003cp\u003e注意するべきプログラムコードは多くの場合において以下の順番になります。\u003cbr\u003e\n・ネットワーク通信\u003cbr\u003e\n・ハードディスク操作\u003cbr\u003e\n・ヒープメモリ\u003cbr\u003e\n上記の順場とは別でCPU、スレッド、async、例外などについても理解し、パフォーマンスの良いコードを書くように注意する必要があります。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ネットワーク通信のコードを知る\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E9%80%9A%E4%BF%A1%E3%81%AE%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E7%9F%A5%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eネットワーク通信のコードを知る\u003c/h2\u003e\n\n\u003cp\u003eネットワーク通信は遅いのでなるべく回数を減らしましょう。C#でネットワーク通信が発生しているメソッドを知ることが大事です。以下にネットワーク通信をしているクラスを列挙します。\u003c/p\u003e\n\n\u003cp\u003eSqlConnection、SqlCommand\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ecn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eSqlConnection\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ecm\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eSqlCommand\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"insert into Table1.....\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003ecm\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eConnection\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003ecn\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eOpen\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e \u003cspan class=\"c1\"\u003e//ネットワーク通信が発生しているかも？調べてみてね。\u003c/span\u003e\n\u003cspan class=\"n\"\u003ecm\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eExecuteNonQuery\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e \u003cspan class=\"c1\"\u003e//ネットワーク通信が発生！\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eHttpClient\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ecl\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eHttpClient\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eres\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003ecl\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"https://www.hignull.com\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e//ネットワーク通信が発生！\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eGoogle Calendar\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ecredential\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eServiceAccountCredential\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eServiceAccountCredential\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eInitializer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eserviceAccountEmail\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eScopes\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003eCalendarService\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eScope\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCalendar\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003esv\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eCalendarService\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eBaseClientService\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eInitializer\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eHttpClientInitializer\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecredential\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eApplicationName\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"MyApp1\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ereq\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eEventsResouce\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eListRequest\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esv\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"calendarID\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eeventList\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ereq\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eExecute\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e \u003cspan class=\"c1\"\u003e//ネットワーク通信が発生！\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eAzure Blob Storage\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eCloudStorageAccount\u003c/span\u003e \u003cspan class=\"n\"\u003eaccount\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eCloudStorageAccount\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eParse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"My connection string\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ecl\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eaccount\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateCloudBlobClient\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003econtainer\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecl\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetContainerReference\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"My Container name\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003elist\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003econtainer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eListBlobs\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e \u003cspan class=\"c1\"\u003e//ネットワーク通信が発生！\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eだいたい感覚は掴めてきましたでしょうか？DBサーバーや外部のWEBサーバー、Saas（Google、Stripe、Office365、Blob）のAPIなどの呼び出しでデータを取得するときにはネットワーク通信が発生しています。自分のPCでプログラムを走らせているとイメージが掴みやすいですよね。GoogleカレンダーであればGoogleのデータセンターのコンピューターに保存されているデータを取得するので、ネットワーク通信が発生することになります。\u003c/p\u003e\n\n\u003cp\u003eさらに言うとこのデータはおそらくハードディスク（もしくはSSD）に保存されているでしょう。非常に時間がかかるネットワーク通信をした後に、これまた時間のかかるハードディスクからデータを読み取り、その値をまたネットワーク通信で返却する、という流れになるのでこれらのメソッドの実行は非常に遅いです。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ファイル操作のコードを知る\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E6%93%8D%E4%BD%9C%E3%81%AE%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E7%9F%A5%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eファイル操作のコードを知る\u003c/h2\u003e\n\n\u003cp\u003eネットワークの次はファイル操作のコードについてです。ファイル操作をするいくつかのクラスを知っておきましょう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003etext\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIO\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFile\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReadAllText\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"C:\\\\Doc\\\\MyMemo.txt\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eFileStreamクラスを利用する場合もハードディスクへの操作になります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eFileStream\u003c/span\u003e \u003cspan class=\"n\"\u003efs\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eFileStream\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"C:\\\\Doc\\\\MyMemo1.txt\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eFileMode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCreate\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003eStreamWriter\u003c/span\u003e \u003cspan class=\"n\"\u003esw\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eStreamWriter\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efs\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003esw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"WIFI Number 1234-5678-4563\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003esw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eClose\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"n\"\u003efs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eClose\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ヒープメモリについて理解する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%92%E3%83%BC%E3%83%97%E3%83%A1%E3%83%A2%E3%83%AA%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E7%90%86%E8%A7%A3%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eヒープメモリについて理解する\u003c/h2\u003e\n\n\u003cp\u003eヒープメモリを効率的に使うために必要なTipsについての目次です。\u003cbr\u003e\n・不要なnewを避ける\u003cbr\u003e\n・ボクシング\u003cbr\u003e\n・String is immutable\u003cbr\u003e\n・StringBuilder\u003cbr\u003e\n・String.Intern\u003cbr\u003e\n・Listを正しく初期化する\u003cbr\u003e\n・ラムダ式のキャプチャを意識する\u003cbr\u003e\n・ArrayPoolを使用する\u003cbr\u003e\n・Taskの代わりにValueTaskを使用する\u003cbr\u003e\n・SpanとStackAllocを活用する\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"不要なnewを避ける\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%B8%8D%E8%A6%81%E3%81%AAnew%E3%82%92%E9%81%BF%E3%81%91%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e不要なnewを避ける\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eMain\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eUserRecord\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003euserList\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eUserRecord\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n    \u003cspan class=\"n\"\u003euserList\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetUserList\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eUserRecord\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetUserList\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eUserRecord\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003euserList\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eUserRecord\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// get user list...\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003euserList\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e不要なnewはヒープメモリを浪費します。避けましょう。\u003c/p\u003e\n\n\u003cp\u003e文字の比較で両方を小文字にするなども避けましょう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003es1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"a\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003es2\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"A\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eisSameString\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003es1\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToLower\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003es2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToLower\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e \u003cspan class=\"c1\"\u003e//メモリが浪費される\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e代わりにStriing.Compareを使用します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003es1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"a\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003es2\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"A\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eisSameString\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCompare\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003es1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003es2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eStringComparison\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCurrentCultureIgnoreCase\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"ボクシング\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%9C%E3%82%AF%E3%82%B7%E3%83%B3%E3%82%B0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eボクシング\u003c/h3\u003e\n\n\u003cp\u003e値型をObject型などにアサインするとボクシングが発生します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"kt\"\u003eobject\u003c/span\u003e \u003cspan class=\"n\"\u003eo\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e//ボクシング発生！\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eボクシングが発生するとメモリの割り当てが発生します。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/30cc6defb38203fc6e47e3ddca8cd04c97f8e7cc/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39363438332f39663163653030312d323730372d323539372d333138622d3161306131343430313339322e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F96483%2F9f1ce001-2707-2597-318b-1a0a14401392.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=3d3fbfb17147d8b234338a3fd2af7102\" alt=\"Boxing.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/96483/9f1ce001-2707-2597-318b-1a0a14401392.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F96483%2F9f1ce001-2707-2597-318b-1a0a14401392.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=c0d0058da8d7a9f720fab9af396a9d7f 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eヒープメモリの割り当ては時間がかかる処理です。（ネットワーク通信＞ハードディスク操作＞ヒープメモリ割り当て）\u003cbr\u003e\n\u003ca href=\"https://ufcpp.net/study/computer/MemoryManagement.html\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://ufcpp.net/study/computer/MemoryManagement.html\u003c/a\u003e\u003cbr\u003e\n不要なボクシングは避けましょう。\u003c/p\u003e\n\n\u003cp\u003e値型をインターフェースへキャストするとボクシングを発生させます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"nc\"\u003eMyStruct\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIComparer\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"nf\"\u003eCompare\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ey\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCompareTo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"nf\"\u003eMain\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003es\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMyStruct\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eIComparer\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ecomparer\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e//ボクシング発生！\u003c/span\u003e\n    \u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCompare\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e避けられるのならば避けましょう。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"stringについて理解する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#string%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E7%90%86%E8%A7%A3%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eStringについて理解する\u003c/h3\u003e\n\n\u003cp\u003eまずあまり書かれていない重要な事としてStringはクラスですが不変であるということです。\u003cbr\u003e\n\u003ca href=\"https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/builtin-types/reference-types\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://docs.microsoft.com/en-us/dotnet/csharp/language-reference/builtin-types/reference-types\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eこれはどういうことかというと例えば以下のようなコードがあるとして\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003es\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Hello\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003es\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Hello World!\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこのコードを書いたときのメモリの動作として下図のようなイメージを持つかもしれませんが\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/ab4fc7b87a91df04827af078ae7cd7043c85ed03/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39363438332f33643164363065302d613930312d333736302d333666662d3733376130303138616361332e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F96483%2F3d1d60e0-a901-3760-36ff-737a0018aca3.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=2d74394fe073c536ed8e17e029b1d5b6\" alt=\"String1.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/96483/3d1d60e0-a901-3760-36ff-737a0018aca3.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F96483%2F3d1d60e0-a901-3760-36ff-737a0018aca3.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=680c04c1b64b284676b01d556c2fe002 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e実際には以下のようにヒープメモリに新しい領域を確保します。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/f202585cfe0294a7db9ef942a5ef2e25dd7b3e2f/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39363438332f66303739353763392d643538322d306638322d373831312d3063353630633466363762352e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F96483%2Ff07957c9-d582-0f82-7811-0c560c4f67b5.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=857533ec31b9c7d1d996196c5b68eb0c\" alt=\"String2.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/96483/f07957c9-d582-0f82-7811-0c560c4f67b5.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F96483%2Ff07957c9-d582-0f82-7811-0c560c4f67b5.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=f1f986f38ae4f7109170837a720ad697 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eこれがStringは不変と言われる理由です。Stringの変更をある程度の回数行う場合はStringBuilderを使用しましょう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eStringBuilder\u003c/span\u003e \u003cspan class=\"n\"\u003esb\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eStringBuilder\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"n\"\u003esb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAppend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Hello\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003esb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAppend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"World!\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこの例では最初からHello World!という値をセットすればいい話ですが、実際にはテキストボックスの入力値からクエリを組み立てるとか、ユーザーへのメッセージを組み立てるとか、そういう場合にStringBuilderを使用することになるでしょう。\u003c/p\u003e\n\n\u003cp\u003eStringで文字の連結や変更を何度も行うとその回数だけヒープメモリの確保と以前使用した値（この例だとHello）が使われないメモリとなり、ガベージコレクションの回数が増加します。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"stringinternを使用する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#stringintern%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eString.Internを使用する\u003c/h3\u003e\n\n\u003cp\u003eアプリケーションの中で何度も使用する文字列はInternメソッドでインターン化しておくとメモリの消費を抑制しパフォーマンスの改善が期待できます。例えば追加ボタンの「追加」という文字などはインターン化するのに良い対象となるでしょう。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"listを正しく初期化する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#list%E3%82%92%E6%AD%A3%E3%81%97%E3%81%8F%E5%88%9D%E6%9C%9F%E5%8C%96%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eListを正しく初期化する\u003c/h3\u003e\n\n\u003cp\u003eList系のクラスのコンストラクタにはcapacityを受け取るオーバーロードがあります。このオーバーロードを使用すると内部で用意する配列のサイズを指定できます。例えばタスク一覧ページがあり、1ページあたり50件のタスクを表示するのであれば50を最初から指定してあげることで配列の再生成を防ぐことができます。結果としてメモリの消費の抑制と処理時間の短縮が期待できます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eTaskRecord\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003etaskList\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eTaskRecord\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"m\"\u003e50\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eListのソースコードです。\u003c/p\u003e\n\n\u003cp\u003e\u003cqiita-embed-ogp src=\"https://referencesource.microsoft.com/#mscorlib/system/collections/generic/list.cs\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;,\u003c/span\u003e \u003cspan class=\"n\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCollections\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIList\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIReadOnlyList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003e_defaultCapacity\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e  \u003cspan class=\"n\"\u003e_emptyArray\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e        \n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003e_items\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003e_emptyArray\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ecapacity\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecapacity\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003eThrowHelper\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eThrowArgumentOutOfRangeException\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eExceptionArgument\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecapacity\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eExceptionResource\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eArgumentOutOfRange_NeedNonNegNum\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eContract\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEndContractBlock\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecapacity\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"n\"\u003e_items\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003e_emptyArray\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n                \u003cspan class=\"n\"\u003e_items\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ecapacity\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e        \n\n        \u003cspan class=\"c1\"\u003e// 省略.............................\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e \u003cspan class=\"n\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e_size\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003e_items\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"nf\"\u003eEnsureCapacity\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e_size\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003e_items\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003e_size\u003c/span\u003e\u003cspan class=\"p\"\u003e++]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003e_version\u003c/span\u003e\u003cspan class=\"p\"\u003e++;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e                \n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eEnsureCapacity\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003emin\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e_items\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003emin\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003enewCapacity\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003e_items\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003e_defaultCapacity\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003e_items\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"kt\"\u003euint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003enewCapacity\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eArray\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMaxArrayLength\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003enewCapacity\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eArray\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMaxArrayLength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enewCapacity\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003emin\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003enewCapacity\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emin\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eCapacity\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enewCapacity\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e        \n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eアイテムを追加して内部の配列の長さを超える場合、EnsureCapacityメソッドで配列の作り直しを行っています。サイズが分かっている場合は最初から指定して無駄なメモリ使用を避けましょう。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"ラムダ式のキャプチャを意識する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%A9%E3%83%A0%E3%83%80%E5%BC%8F%E3%81%AE%E3%82%AD%E3%83%A3%E3%83%97%E3%83%81%E3%83%A3%E3%82%92%E6%84%8F%E8%AD%98%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eラムダ式のキャプチャを意識する\u003c/h3\u003e\n\n\u003cp\u003eラムダ式で外部変数をキャプチャした場合、暗黙的にクラスが定義されそのインスタンスが生成されます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eAction\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetWriteLineAction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003enumber\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enumber\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれは以下のようにコンパイルされます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003e__GeneratedClass\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003enumber\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eGeneratedMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enumber\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eAction\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetWriteLineAction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003enumber\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ec\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003e__GeneratedClass\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ec\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enumber\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enumber\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003ec\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGeneratedMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e外部変数をキャプチャするとインスタンスが生成されヒープメモリを消費します。特にホットコードパスでのラムダ式の使用では注意が必要です。最新のC#ではラムダ式にstaticキーワードをつけて外部変数のキャプチャを禁止することができるので外部変数の意図しないキャプチャを防ぎたいのならば積極的に利用していきましょう。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"ラムダにstaticメソッドを渡さないようにする\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%A9%E3%83%A0%E3%83%80%E3%81%ABstatic%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%82%92%E6%B8%A1%E3%81%95%E3%81%AA%E3%81%84%E3%82%88%E3%81%86%E3%81%AB%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eラムダにstaticメソッドを渡さないようにする\u003c/h3\u003e\n\n\u003cp\u003estaticメソッドのデリゲートが遅くなります。以下にその理由が詳しく書いてあります↓\u003cbr\u003e\n\u003ca href=\"https://ufcpp.net/study/csharp/functional/miscdelegateinternal/#static-method\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://ufcpp.net/study/csharp/functional/miscdelegateinternal/#static-method\u003c/a\u003e\u003cbr\u003e\nその他、staticメソッドのデリゲートが遅くなるとかいろいろなテスト結果です。\u003cbr\u003e\n\u003ca href=\"https://gist.github.com/ufcpp/b2e64d8e0165746effbd98b8aa955f7e\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://gist.github.com/ufcpp/b2e64d8e0165746effbd98b8aa955f7e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e以下のようなコードを考えてみましょう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eMain\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003etextList\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n    \u003cspan class=\"n\"\u003etextList\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"   \"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e//Empty\u003c/span\u003e\n    \u003cspan class=\"n\"\u003etextList\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Higty\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//....いくつか追加\u003c/span\u003e\n    \u003cspan class=\"n\"\u003etextList\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWhere\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIsNullOrWhiteSpace\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e//静的メソッド\u003c/span\u003e\n    \u003cspan class=\"n\"\u003etextList\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWhere\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eIsNullOrWhiteSpace\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e//ラムダで囲む\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e静的メソッドをそのまま引数として渡す書き方の場合、実際には以下のようにコンパイルされます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003etextList\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWhere\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eFunc\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eBoolean\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIsNullOrWhiteSpace\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e毎回Funcクラスのインスタンスが作成されてメモリを浪費します。さらにデリゲート呼び出しがインスタンスメソッドの方に最適化されているのが原因で呼び出し自体も非常に遅いです。\u003c/p\u003e\n\n\u003cp\u003eラムダで囲んでおくと\u003cbr\u003e\n\u003ca href=\"https://ufcpp.net/study/csharp/sp2_anonymousmethod.html#static\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://ufcpp.net/study/csharp/sp2_anonymousmethod.html#static\u003c/a\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003e__GeneratedClass\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eFunc\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eBoolean\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003e_ActionCache\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003einternal\u003c/span\u003e \u003cspan class=\"n\"\u003eBoolean\u003c/span\u003e \u003cspan class=\"nf\"\u003e__GeneratedMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eString\u003c/span\u003e \u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eIsNullOrWhiteSpace\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eMain\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e__GeneratedClass\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003e_ActionCache\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003e__GeneratedClass\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003e_ActionCache\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003e__GeneratedClass\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003e__GeneratedMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"n\"\u003etextList\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWhere\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e__GeneratedClass\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003e_ActionCache\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eみたいな感じに展開され、無駄なインスタンスの生成がゼロになります。メモリの無駄遣いを抑制し、ガベージコレクションの回数を減らすことができます。またインスタンスメソッドの呼び出しになっているので呼び出しが遅くなることもありません。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"arraypoolを使用する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#arraypool%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eArrayPoolを使用する\u003c/h3\u003e\n\n\u003cp\u003e例えばファイルのダウンロード処理や、WEBサイトでアップロードされたファイルを処理する場合、Byte[]でデータをやり取りします。バッファでByte[]を使用することもあると思います。ArrayPoolを使用することでByte[]のヒープメモリへのアロケーションを避け、既に用意されているByte[]を使用できます。\u003cbr\u003e\n\u003ca href=\"http://ikorin2.hatenablog.jp/entry/2020/07/25/113904\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://ikorin2.hatenablog.jp/entry/2020/07/25/113904\u003c/a\u003e\u003cbr\u003e\nヒープメモリへのアロケーションを避けることにより、ガベージコレクションの回数が減ることが期待できます。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"taskの代わりにvaluetaskを使用する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#task%E3%81%AE%E4%BB%A3%E3%82%8F%E3%82%8A%E3%81%ABvaluetask%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eTaskの代わりにValueTaskを使用する\u003c/h3\u003e\n\n\u003cp\u003e\u003ca href=\"https://www.buildinsider.net/column/iwanaga-nobuyuki/009\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://www.buildinsider.net/column/iwanaga-nobuyuki/009\u003c/a\u003e\u003cbr\u003e\n非同期メソッドが何階層にも渡って呼び出されている場合にはパフォーマンスの向上が見込めます。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"spanとstakallocを活用する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#span%E3%81%A8stakalloc%E3%82%92%E6%B4%BB%E7%94%A8%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eSpanとStakallocを活用する\u003c/h3\u003e\n\n\u003cp\u003eStringや配列にたいしてSpanやStackallocを活用するとパフォーマンスの向上とメモリ使用量の低減が可能です。\u003cbr\u003e\n\u003ca href=\"https://ufcpp.net/blog/2018/12/spanify/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://ufcpp.net/blog/2018/12/spanify/\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"gcガベージコレクションについて理解する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#gc%E3%82%AC%E3%83%99%E3%83%BC%E3%82%B8%E3%82%B3%E3%83%AC%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E7%90%86%E8%A7%A3%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eGC（ガベージコレクション）について理解する\u003c/h2\u003e\n\n\u003cp\u003eC#では.NET Framework（.NET Core）がメモリを管理してくれるガベージコレクションという仕組みがあります。\u003cbr\u003e\n\u003ca href=\"https://docs.microsoft.com/ja-jp/dotnet/standard/garbage-collection/fundamentals\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://docs.microsoft.com/ja-jp/dotnet/standard/garbage-collection/fundamentals\u003c/a\u003e\u003cbr\u003e\n簡単に言うと、ヒープメモリを3世代に分けて管理し、どこからも参照されなくなったヒープメモリをクリアして空いたスペースを詰めてメモリを整理してくれる仕組みです。\u003cbr\u003e\n\u003ca href=\"https://ufcpp.net/study/csharp/rm_gc.html\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://ufcpp.net/study/csharp/rm_gc.html\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://ufcpp.net/study/computer/MemoryManagement.html?sec=garbage-collection#garbage-collection\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://ufcpp.net/study/computer/MemoryManagement.html?sec=garbage-collection#garbage-collection\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eヒープメモリを消費していくとどこかのタイミングでガベージコレクションの処理が実行されます。この処理は重い処理になります。なるべくガベージコレクションが発生する回数が少なくなるようにしましょう。特にGen2のコレクション処理は非常に重くなります。ヒープメモリを無駄遣いしない、Byte[]などの配列データを再利用するなどの方法を活用してGCの発生回数を減らしましょう。\u003c/p\u003e\n\n\u003cp\u003eガベージコレクションの実行時間が長くならないためのTipsです。\u003cbr\u003e\n\u003ca href=\"https://docs.microsoft.com/en-us/previous-versions/dotnet/articles/ms973837(v=msdn.10)\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://docs.microsoft.com/en-us/previous-versions/dotnet/articles/ms973837(v=msdn.10)\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eまとめると\u003cbr\u003e\n・多くのアロケーションがあると実行時間が長くなります。\u003cbr\u003e\n・巨大なオブジェクト（new Byte[10000]とか）があると実行時間が長くなります。\u003cbr\u003e\n・オブジェクトが複雑にお互いを参照しているようなクラスがあると参照されていない事の検証処理に時間がかかります。\u003cbr\u003e\n・ルートオブジェクトが多いと参照されていない事の検証処理に時間がかかります。\u003cbr\u003e\n・ファイナライザがあるクラスの作成は注意して実装する。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"ファイナライザとは\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%95%E3%82%A1%E3%82%A4%E3%83%8A%E3%83%A9%E3%82%A4%E3%82%B6%E3%81%A8%E3%81%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eファイナライザとは？\u003c/h3\u003e\n\n\u003cp\u003e\u003ca href=\"https://docs.microsoft.com/ja-jp/dotnet/csharp/programming-guide/classes-and-structs/destructors\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://docs.microsoft.com/ja-jp/dotnet/csharp/programming-guide/classes-and-structs/destructors\u003c/a\u003e\u003cbr\u003e\nファイナライザがあると自動的に世代が1世代昇格されます。これはつまりGen0での回収がされないことを意味します。\u003cbr\u003e\nファイナライザがあると300倍ほど遅くなります。↓\u003cbr\u003e\n\u003ca href=\"https://michaelscodingspot.com/avoid-gc-pressure/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://michaelscodingspot.com/avoid-gc-pressure/\u003c/a\u003e\u003cbr\u003e\nまたファイナライザの実装に問題があると以下のような問題が発生します。\u003cbr\u003e\n\u003ca href=\"https://troushoo.blog.fc2.com/blog-entry-56.html\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://troushoo.blog.fc2.com/blog-entry-56.html\u003c/a\u003e\u003cbr\u003e\n注意しましょう。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"よくあるメモリリークのパターンについて知る\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%88%E3%81%8F%E3%81%82%E3%82%8B%E3%83%A1%E3%83%A2%E3%83%AA%E3%83%AA%E3%83%BC%E3%82%AF%E3%81%AE%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E7%9F%A5%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eよくあるメモリリークのパターンについて知る\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\"https://michaelscodingspot.com/ways-to-cause-memory-leaks-in-dotnet/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://michaelscodingspot.com/ways-to-cause-memory-leaks-in-dotnet/\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://michaelscodingspot.com/find-fix-and-avoid-memory-leaks-in-c-net-8-best-practices/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://michaelscodingspot.com/find-fix-and-avoid-memory-leaks-in-c-net-8-best-practices/\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eイベントハンドラー\u003cbr\u003e\n匿名メソッド、ラムダ式でのキャプチャ\u003cbr\u003e\nStaticフィールドはガベージコレクションのルートになる\u003cbr\u003e\nWPFのBindingについて\u003cbr\u003e\nキャッシュするデータ量が多いとメモリが不足してOutOfMemoryExceptionが発生する\u003cbr\u003e\nWeek Referenceについて\u003cbr\u003e\n終了しないThread（Timersも）のStackに積まれた変数はガベージコレクションのルートになる\u003c/p\u003e\n\n\u003cp\u003eメモリがリークするとそのメモリは解放されず使用可能なメモリ領域が減少しガベージコレクションが頻発することになります。ガベージコレクションは重い処理なのでアプリケーション全体のパフォーマンスが低下します。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"例外について\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BE%8B%E5%A4%96%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e例外について\u003c/h2\u003e\n\n\u003cp\u003e例外の発生は重い処理です。不要な例外の発生は避けましょう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eInt32\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetNumber\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eString\u003c/span\u003e \u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003etry\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eInt32\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eParse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ecatch\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eException\u003c/span\u003e \u003cspan class=\"n\"\u003eex\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eParseメソッドの代わりにTryParseメソッドがあります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eInt32\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetNumber\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eString\u003c/span\u003e \u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eInt32\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eTryParse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"使用方法に注意するべきクラスライブラリ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95%E3%81%AB%E6%B3%A8%E6%84%8F%E3%81%99%E3%82%8B%E3%81%B9%E3%81%8D%E3%82%AF%E3%83%A9%E3%82%B9%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e使用方法に注意するべきクラスライブラリ\u003c/h2\u003e\n\n\u003cp\u003eまずはデータアクセスのクラスです。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"datasetよりもdatareaderを使用する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#dataset%E3%82%88%E3%82%8A%E3%82%82datareader%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eDataSetよりもDataReaderを使用する\u003c/h3\u003e\n\n\u003cp\u003eDataSetやDataTableはいろいろな機能があって遅いです。単にデータを読み取るだけならばDataReaderを使用するようにしましょう。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"table-valued-parameterかsqlbulkcopyを使用して複数行を処理する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#table-valued-parameter%E3%81%8Bsqlbulkcopy%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6%E8%A4%87%E6%95%B0%E8%A1%8C%E3%82%92%E5%87%A6%E7%90%86%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eTable-Valued ParameterかSqlBulkCopyを使用して複数行を処理する\u003c/h3\u003e\n\n\u003cp\u003e複数行を一括で処理する場合はTVP(Table-Valued Parameter)かSqlBulkCopyを使用しましょう。\u003cbr\u003e\n\u003ca href=\"https://www.sentryone.com/blog/sqlbulkcopy-vs-table-valued-parameters-bulk-loading-data-into-sql-server\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://www.sentryone.com/blog/sqlbulkcopy-vs-table-valued-parameters-bulk-loading-data-into-sql-server\u003c/a\u003e\u003cbr\u003e\n1000以下のレコードであればTVPの方が高速です。これはBulk Insertは初期化処理に多少時間がかかるためです。\u003cbr\u003e\n\u003ca href=\"https://docs.microsoft.com/en-us/sql/relational-databases/tables/use-table-valued-parameters-database-engine?view=sql-server-ver15#BulkInsert\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://docs.microsoft.com/en-us/sql/relational-databases/tables/use-table-valued-parameters-database-engine?view=sql-server-ver15#BulkInsert\u003c/a\u003e\u003cbr\u003e\n1000以上のレコードの挿入の場合、SqlBulkCopyを使用してデータを挿入しましょう。\u003c/p\u003e\n\n\u003cp\u003eTVPのストアドをC#から呼び出すのは結構面倒くさいです。DbSharpを使用するとC#の呼び出しコードを簡単に自動生成できます。\u003cbr\u003e\n\u003ca href=\"https://qiita.com/higty/items/3c7000c06c83321e2319\" id=\"reference-4b01668e45596c116f68\"\u003eDbSharp（ストアドを実行するC#のソースコード自動生成ツール）の紹介\u003c/a\u003e\u003cbr\u003e\n活用しましょう。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"dictionaryのキーに注意する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#dictionary%E3%81%AE%E3%82%AD%E3%83%BC%E3%81%AB%E6%B3%A8%E6%84%8F%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eDictionaryのキーに注意する\u003c/h3\u003e\n\n\u003cp\u003eDictionaryのキーの比較にはGetHashCodeが使用されます。キーにStringやEnumを使用するとキーの比較は低速です。\u003cbr\u003e\n\u003ca href=\"http://proprogrammer.hatenadiary.jp/entry/2014/08/17/015345\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://proprogrammer.hatenadiary.jp/entry/2014/08/17/015345\u003c/a\u003e\u003cbr\u003e\nEnumをキーに使用する場合に高速化する手法です↓\u003cbr\u003e\n\u003ca href=\"https://stackoverflow.com/questions/26280788/dictionary-enum-key-performance/26281533\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://stackoverflow.com/questions/26280788/dictionary-enum-key-performance/26281533\u003c/a\u003e\u003cbr\u003e\n可能であればInt32などをキーとして使用しましょう。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"asyncawaitを使用する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#asyncawait%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003easync、awaitを使用する\u003c/h3\u003e\n\n\u003cp\u003eWait()メソッドやResultプロパティは使用しないようにしましょう。処理が完了するまでの間、スレッドをブロックしてしまいます。asyncを使用すれば待ち時間の間スレッドを解放します。その解放されたスレッドは他の処理の実行に使用されます。\u003cbr\u003e\nWEBサイトなどでは並列にリクエストが飛んできて、DBからのデータの取得などで待ちが発生します。全て非同期にすることでスレッドがただ何もしないで待つという事がなくなり、常にどれかのリクエストの処理を実行している形になるので全体のスループットが向上します。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"streamを使用する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#stream%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eStreamを使用する\u003c/h3\u003e\n\n\u003cp\u003eStreamを使用することでデータを順次読み込み・書き込みすることができます。使える場合は使っていきましょう。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"httpclientをusingしない\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#httpclient%E3%82%92using%E3%81%97%E3%81%AA%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eHttpClientをusingしない\u003c/h3\u003e\n\n\u003cp\u003e公式ドキュメントによるとHttpClientは特殊な使用方法を要求されます。\u003cbr\u003e\n\u003ca href=\"https://docs.microsoft.com/ja-jp/dotnet/api/system.net.http.httpclient?view=netcore-3.1\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://docs.microsoft.com/ja-jp/dotnet/api/system.net.http.httpclient?view=netcore-3.1\u003c/a\u003e\u003cbr\u003e\n適切な使用方法の参考記事です↓\u003cbr\u003e\n\u003ca href=\"https://qiita.com/superriver/items/91781bca04a76aec7dc0\" class=\"autolink\" id=\"reference-9cb30bc7642faee8937d\"\u003ehttps://qiita.com/superriver/items/91781bca04a76aec7dc0\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eHttpClientFactoryを利用するとDIやリトライなどが楽に設定できます。\u003cbr\u003e\n\u003ca href=\"https://docs.microsoft.com/en-US/dotnet/architecture/microservices/implement-resilient-applications/use-httpclientfactory-to-implement-resilient-http-requests\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://docs.microsoft.com/en-US/dotnet/architecture/microservices/implement-resilient-applications/use-httpclientfactory-to-implement-resilient-http-requests\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"socketを利用した時のメモリの断片化とout-of-memoryを防止する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#socket%E3%82%92%E5%88%A9%E7%94%A8%E3%81%97%E3%81%9F%E6%99%82%E3%81%AE%E3%83%A1%E3%83%A2%E3%83%AA%E3%81%AE%E6%96%AD%E7%89%87%E5%8C%96%E3%81%A8out-of-memory%E3%82%92%E9%98%B2%E6%AD%A2%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eSocketを利用した時のメモリの断片化とOut Of Memoryを防止する\u003c/h3\u003e\n\n\u003cp\u003eSocketでのデータの送受信ではByte[]を利用します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003evoi\u003c/span\u003e \u003cspan class=\"nf\"\u003eSend\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eByte\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1024\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"n\"\u003esocket\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eBeginSend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e...);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eBeginSendに渡したByte[]はI/O Completion PortでOSからI/O完了時にデータが書き込まれます。OSがこのアドレスに間違いなく書き込めることを保証する必要があり、このbufferはガベージコレクションの処理時に勝手にアドレスが動かないようPINされます。\u003cbr\u003e\n\u003ca href=\"http://ahuwanya.net/blog/post/Buffer-Pooling-for-NET-Socket-Operations\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://ahuwanya.net/blog/post/Buffer-Pooling-for-NET-Socket-Operations\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e問題は例えば1024のサイズのバッファーを使用してデータを送ると1MBのデータを送るにはSendCallbackが1000回実行され、Byte[]のインスタンスが1000個生成され、その全てがPINされることになります。PINされたオブジェクトはガベージコレクションで移動されないのでメモリが断片化します。その結果、Out Of Memoryが発生します。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"リフレクションexpressionツリーdynamicasyncスレッド\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%AA%E3%83%95%E3%83%AC%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3expression%E3%83%84%E3%83%AA%E3%83%BCdynamicasync%E3%82%B9%E3%83%AC%E3%83%83%E3%83%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eリフレクション、Expressionツリー、dynamic、async、スレッド\u003c/h2\u003e\n\n\u003cp\u003eその他、様々な高速化のTipsを紹介します。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"リフレクションをキャッシュする\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%AA%E3%83%95%E3%83%AC%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%92%E3%82%AD%E3%83%A3%E3%83%83%E3%82%B7%E3%83%A5%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eリフレクションをキャッシュする\u003c/h3\u003e\n\n\u003cp\u003eリフレクションは非常に遅い処理になります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eUserRecord\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003euserList\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetUserList\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003euser\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003euserList\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ePropertyInfo\u003c/span\u003e \u003cspan class=\"n\"\u003enamePropertyInfo\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eTypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eUserRecord\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetProperty\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Name\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e//非常に遅い！\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eString\u003c/span\u003e \u003cspan class=\"n\"\u003euserName\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003enamePropertyInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetValue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eu\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e実行回数を減らして低速化を回避しましょう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003ePropertyInfo\u003c/span\u003e \u003cspan class=\"n\"\u003enamePropertyInfo\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eTypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eUserRecord\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetProperty\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Name\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eUserRecord\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003euserList\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetUserList\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003euser\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003euserList\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eString\u003c/span\u003e \u003cspan class=\"n\"\u003euserName\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003enamePropertyInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetValue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eu\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eGetProperty,GetMethodなどは低速です。キャッシュを使用して低速化を回避しましょう。\u003cbr\u003e\n\u003ca href=\"https://yamaokuno-usausa.hatenablog.com/entry/20090821/1250813986\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://yamaokuno-usausa.hatenablog.com/entry/20090821/1250813986\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"dynamicをうまいこと活用する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#dynamic%E3%82%92%E3%81%86%E3%81%BE%E3%81%84%E3%81%93%E3%81%A8%E6%B4%BB%E7%94%A8%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003edynamicをうまいこと活用する\u003c/h3\u003e\n\n\u003cp\u003edynamicを利用するとキャッシュをある程度コンパイラがいい感じにやってくれます↓\u003cbr\u003e\n\u003ca href=\"https://ufcpp.net/study/csharp/misc_dynamic.html\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://ufcpp.net/study/csharp/misc_dynamic.html\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"generic-type-cachingを使用する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#generic-type-caching%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eGeneric Type Cachingを使用する\u003c/h3\u003e\n\n\u003cp\u003eGeneric Type Cachingを使用するとコンパイル時にマップが完了しているため高速です。静的にTypeが確定できる場合は利用していきましょう。\u003cbr\u003e\n\u003ca href=\"http://csharpvbcomparer.blogspot.com/2014/03/tips-generic-type-caching.html\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://csharpvbcomparer.blogspot.com/2014/03/tips-generic-type-caching.html\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"expressionツリーのコンパイルをキャッシュする\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#expression%E3%83%84%E3%83%AA%E3%83%BC%E3%81%AE%E3%82%B3%E3%83%B3%E3%83%91%E3%82%A4%E3%83%AB%E3%82%92%E3%82%AD%E3%83%A3%E3%83%83%E3%82%B7%E3%83%A5%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eExpressionツリーのコンパイルをキャッシュする\u003c/h3\u003e\n\n\u003cp\u003eExpressionのコンパイルは重い処理です。コンパイル済みのデリゲートをキャッシュするようにしましょう。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"regexクラスをコンパイル済みにする\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#regex%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%92%E3%82%B3%E3%83%B3%E3%83%91%E3%82%A4%E3%83%AB%E6%B8%88%E3%81%BF%E3%81%AB%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eRegexクラスをコンパイル済みにする\u003c/h3\u003e\n\n\u003cp\u003e以下のコードでRegexクラスをコンパイル済みにします。\u003cbr\u003e\nvar rg= new Regex(\"[a-zA-Z0-9-]*\", RegexOptions.Compiled);\u003cbr\u003e\nコンパイル済みにすることでパフォーマンスの向上が期待できます。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"enumのtostringを高速化する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#enum%E3%81%AEtostring%E3%82%92%E9%AB%98%E9%80%9F%E5%8C%96%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eEnumのToStringを高速化する\u003c/h3\u003e\n\n\u003cp\u003eEnumのToStringは内部でリフレクションを使用しています。\u003cbr\u003e\n\u003ca href=\"https://referencesource.microsoft.com/#mscorlib/system/type.cs,d5cd3cb0c6c2b6c1\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://referencesource.microsoft.com/#mscorlib/system/type.cs,d5cd3cb0c6c2b6c1\u003c/a\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eoverride\u003c/span\u003e \u003cspan class=\"n\"\u003eString\u003c/span\u003e \u003cspan class=\"nf\"\u003eToString\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eEnum\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eInternalFormat\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003eRuntimeType\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetType\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetValue\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//************************省略***************************\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetEnumData\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003eenumNames\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003eArray\u003c/span\u003e \u003cspan class=\"n\"\u003eenumValues\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eContract\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEnsures\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eContract\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValueAtReturn\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"k\"\u003e]\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003eenumNames\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eContract\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEnsures\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eContract\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValueAtReturn\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eArray\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003eenumValues\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003eFieldInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003eflds\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetFields\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eBindingFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePublic\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003eBindingFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNonPublic\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003eBindingFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eStatic\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"kt\"\u003eobject\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003evalues\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003eobject\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eflds\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003enames\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eflds\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003eflds\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003enames\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eflds\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003evalues\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eflds\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetRawConstantValue\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// Insertion Sort these values in ascending order.\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// We use this O(n^2) algorithm, but it turns out that most of the time the elements are already in sorted order and\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// the common case performance will be faster than quick sorting this.\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eIComparer\u003c/span\u003e \u003cspan class=\"n\"\u003ecomparer\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eComparer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDefault\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003evalues\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ej\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003etempStr\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enames\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003eobject\u003c/span\u003e \u003cspan class=\"n\"\u003eval\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003evalues\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eexchanged\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// Since the elements are sorted we only need to do one comparision, we keep the check for j inside the loop.\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ewhile\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecomparer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCompare\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003evalues\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ej\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003eval\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003enames\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ej\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enames\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ej\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n            \u003cspan class=\"n\"\u003evalues\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ej\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003evalues\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ej\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ej\u003c/span\u003e\u003cspan class=\"p\"\u003e--;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eexchanged\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ej\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eexchanged\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003enames\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ej\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etempStr\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003evalues\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ej\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eval\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003eenumNames\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enames\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eenumValues\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003evalues\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eリフレクションを使用しているため非常に遅いです。\u003cbr\u003e\n高速化する方法は以下になります↓\u003cbr\u003e\n\u003ca href=\"https://qiita.com/higty/items/513296536d3b26fbd033\" class=\"autolink\" id=\"reference-33224046a0350306be14\"\u003ehttps://qiita.com/higty/items/513296536d3b26fbd033\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"ループを展開する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%AB%E3%83%BC%E3%83%97%E3%82%92%E5%B1%95%E9%96%8B%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eループを展開する\u003c/h3\u003e\n\n\u003cp\u003eループを展開すると高速化が可能です。例えば配列の全ての値を1増やす場合を考えてみます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003enumberList\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eInt32\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e40000\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003enumberList\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003enumberList\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eループを展開し、4つの要素を一気に処理するように変更します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003enumberList\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eInt32\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e40000\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"m\"\u003e10000\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"m\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003enumberList\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003enumberList\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003enumberList\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003enumberList\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"m\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eループ処理では毎回処理を繰り返すかの条件を検証する式（i \u0026lt; numberList.Length）とインクリメント（i++）の処理が実行されます。\u003cbr\u003e\n展開することで40000回の上記の処理が10000回になり、30000回の条件の評価とインクリメントの処理がなくなることになります。配列の要素数が4の倍数でない場合は多少の調整が必要ですが、このようにループの展開を使用すると処理を高速化できます。4ではなく10とかもっと増やせばもっと高速化できます。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"foreachの代わりにforを使用する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#foreach%E3%81%AE%E4%BB%A3%E3%82%8F%E3%82%8A%E3%81%ABfor%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eforeachの代わりにforを使用する\u003c/h3\u003e\n\n\u003cp\u003eforeachはCurrentプロパティへのアクセス、MoveNextメソッドの呼び出しが毎回あるためforよりもわずかに低速です。通常の多くの部分では無視できるくらいの差しかありませんが、非常にシビアなパフォーマンスの向上が求められる場合にはforの使用を検討してみましょう。特に配列とforの組み合わせだとコンパイラが相当な最適化をしてくれます。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"linq風の書き方を避けてforeachを使用する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#linq%E9%A2%A8%E3%81%AE%E6%9B%B8%E3%81%8D%E6%96%B9%E3%82%92%E9%81%BF%E3%81%91%E3%81%A6foreach%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eLINQ風の書き方を避けてforeachを使用する\u003c/h3\u003e\n\n\u003cp\u003eLINQ風のメソッドチェーンを繋げる呼び出しはメソッド呼び出しの分などで少し遅いorだいぶ遅くなることがあります。\u003cbr\u003e\nこのページのコメントのやり取り参照↓\u003cbr\u003e\n\u003ca href=\"https://michaelscodingspot.com/performance-problems-in-csharp-dotnet/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://michaelscodingspot.com/performance-problems-in-csharp-dotnet/\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eLINQ風の書き方\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003enumbers\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetNumbers\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003etotal\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enumbers\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWhere\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eSum\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003etotal\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eLINQ風の書き方でもオプティマイザが最大限最適化してくれはしますが、通常のforeachの方が早いことがほとんどです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003enumbers\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetNumbers\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003etotal\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003enumber\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003enumbers\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enumber\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003etotal\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"n\"\u003enumber\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003etotal\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"arrayのコピーについて\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#array%E3%81%AE%E3%82%B3%E3%83%94%E3%83%BC%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eArrayのコピーについて\u003c/h3\u003e\n\n\u003cp\u003eソース↓\u003cbr\u003e\n\u003ca href=\"https://stackoverflow.com/questions/5099604/any-faster-way-of-copying-arrays-in-c\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://stackoverflow.com/questions/5099604/any-faster-way-of-copying-arrays-in-c\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://marcelltoth.net/article/41/fastest-way-to-copy-a-net-array\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://marcelltoth.net/article/41/fastest-way-to-copy-a-net-array\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://www.youtube.com/watch?time_continue=4\u0026amp;v=-H5oEgOdO6U\u0026amp;t=1689\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://www.youtube.com/watch?time_continue=4\u0026amp;v=-H5oEgOdO6U\u0026amp;t=1689\u003c/a\u003e\u003cbr\u003e\nこの動画によるとArray.CopyToが最速っぽいです。理由はOSのAPIを直接呼出しているからと言ってます。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"ドキュメントに無いarrayの秘密\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%89%E3%82%AD%E3%83%A5%E3%83%A1%E3%83%B3%E3%83%88%E3%81%AB%E7%84%A1%E3%81%84array%E3%81%AE%E7%A7%98%E5%AF%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eドキュメントに無いArrayの秘密\u003c/h3\u003e\n\n\u003cp\u003e\u003cqiita-embed-ogp src=\"https://www.codeproject.com/Articles/3467/Arrays-UNDOCUMENTED\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\n\u003cp\u003eArrayのループは以下が最速\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ehash\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ehash\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eローカル変数にLengthを保存すると遅くなる\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ehash\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003elength\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003elength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ehash\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e下のコードの場合は他スレッドからの変更とかを考慮するとlength変数が変更されていないことを保証するのが難しい（コンパイルに時間がかかる）です。その結果、Arrayの境界値チェックが働くので遅くなってしまいます。最初の例だとa.Lengthは配列の長さ以内という事が確定しているので境界値チェックを省略し、配列の各要素への処理を最適化した中間コードが生成されるので速くなります。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"プロパティの代わりにフィールドを使用する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%97%E3%83%AD%E3%83%91%E3%83%86%E3%82%A3%E3%81%AE%E4%BB%A3%E3%82%8F%E3%82%8A%E3%81%AB%E3%83%95%E3%82%A3%E3%83%BC%E3%83%AB%E3%83%89%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eプロパティの代わりにフィールドを使用する\u003c/h3\u003e\n\n\u003cp\u003eプロパティは実際にはメソッドです。プロパティアクセスの際にはメソッド呼び出しが挟まることになります。パフォーマンスがシビアに求められる環境ではメソッド呼び出しのコストさえも容認できないときがあります。そのようなときはプロパティではなくフィールドにしてしまうことも検討しましょう。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"ループのindexに注意する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%AB%E3%83%BC%E3%83%97%E3%81%AEindex%E3%81%AB%E6%B3%A8%E6%84%8F%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eループのindexに注意する\u003c/h3\u003e\n\n\u003cp\u003e2重ループのインデックスの順序を間違うとCPUのメモリ局所性をうまく活用できず処理が遅くなることがあります。\u003cbr\u003e\n\u003ca href=\"https://raygun.com/blog/c-sharp-performance-tips-tricks/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://raygun.com/blog/c-sharp-performance-tips-tricks/\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eメモリ局所性をうまく活用できるコード\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003e_map\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003e_map\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e_map\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e][\u003c/span\u003e\u003cspan class=\"n\"\u003en\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eresult\u003c/span\u003e\u003cspan class=\"p\"\u003e++;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eうまく活用できないコード\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003e_map\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003e_map\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e_map\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003en\u003c/span\u003e\u003cspan class=\"p\"\u003e][\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eresult\u003c/span\u003e\u003cspan class=\"p\"\u003e++;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e上のコードの方が8倍ほど高速です。上記のコードの方が使用するデータがメモリー上で近い位置に配置されて一気に読み込めます。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"uiを常に反応するようにする\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#ui%E3%82%92%E5%B8%B8%E3%81%AB%E5%8F%8D%E5%BF%9C%E3%81%99%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eUIを常に反応するようにする\u003c/h3\u003e\n\n\u003cp\u003eUIが反応がないとユーザーはストレスを感じます。長時間かかる処理などはバックグラウンドスレッドで実行し、UIスレッドは常に反応するようにしましょう。Threadクラスを使用するかasync、awaitパターンを使用しましょう。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"キャッシュ機能を実装する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%AD%E3%83%A3%E3%83%83%E3%82%B7%E3%83%A5%E6%A9%9F%E8%83%BD%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eキャッシュ機能を実装する\u003c/h3\u003e\n\n\u003cp\u003eDBのデータやネットワーク通信で取得したデータ、ファイル操作で取得したデータなどをメモリ上やRedis上に置いておいてアクセスを高速化します。キャッシュに適しているのは以下の特性を持つデータです。\u003cbr\u003e\n・データ量が小さい\u003cbr\u003e\n・頻繁に参照される\u003cbr\u003e\n・あまり変更されない\u003cbr\u003e\nメモリ上の保持するためあまり大きなデータをキャッシュしてしまうとメモリが枯渇します。あまり参照されないものをキャッシュすると貴重なメモリ領域を無駄に浪費することになります。キャッシュ元のデータが更新された場合、キャッシュを更新する必要があります。頻繁に更新されるデータをキャッシュすると更新処理でCPUとメモリを使用するのでこのようなデータはキャッシュに適していません。\u003c/p\u003e\n\n\u003cp\u003e以上を踏まえると例えば以下のようなデータがキャッシュの対象として適切です。\u003c/p\u003e\n\n\u003cp\u003e・アプリケーションのテキスト（追加ボタンの”追加”という文字などは不変）\u003cbr\u003e\n・組織マスタ（1年に1回しか変更されない）\u003cbr\u003e\n・先月の売上データの表のHTML（先月の売上データは不変）\u003cbr\u003e\nなどが挙げられます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eCacheData\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eDictionary\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eTextList\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eDictionary\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e基本的にはstaticフィールド（もしくはプロパティ）で実装することになるでしょう。元のデータが更新されたときにはこのデータを更新します。WEBアプリケーションの場合は複数のスレッドからのアクセスがあるため、lockなどで競合の管理が必要です。\u003c/p\u003e\n\n\u003cp\u003eまたクラウドでWEBアプリをスケールアウトしている場合はRedisのPublish、Subscribeを使用して複数のWEBアプリに通知を送ることで全てのWEBアプリのキャッシュを更新することが可能です。\u003c/p\u003e\n\n\u003cp\u003eこの記事ではC#を例にしてキャッシュを紹介していますが、キャッシュの仕組み自体は応用が利きます。CDN、DNS、ブラウザの画像ファイルなど様々なところでキャッシュの仕組みが使われています。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"デバッグビルドは遅くリリースビルドは速い\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%87%E3%83%90%E3%83%83%E3%82%B0%E3%83%93%E3%83%AB%E3%83%89%E3%81%AF%E9%81%85%E3%81%8F%E3%83%AA%E3%83%AA%E3%83%BC%E3%82%B9%E3%83%93%E3%83%AB%E3%83%89%E3%81%AF%E9%80%9F%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eデバッグビルドは遅くリリースビルドは速い\u003c/h3\u003e\n\n\u003cp\u003e忘れずにリリースビルドにしましょう。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"おまけ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%8A%E3%81%BE%E3%81%91\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eおまけ\u003c/h1\u003e\n\n\u003cp\u003eハイパフォーマンスなアプリケーションの作成方法に興味がある方向けにいくつか記事を書いてみました。\u003cbr\u003e\n\u003ca href=\"https://qiita.com/higty/items/598716cb160b61b1ddb0\" id=\"reference-a600dad7dbf47eacc240\"\u003eタスク管理を作ってみた　～初級からレベルアップするためのツールとサービスたち～\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://qiita.com/higty/items/b021c1d379d94b55de47\" id=\"reference-c58fc49558513bac11ab\"\u003eWEBアプリケーションのパフォーマンスをUPするために知っておくべき技術と知識\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://qiita.com/higty/items/30267dd386d7cd6e5a93\" id=\"reference-10a32c94976ebee2db04\"\u003eC#で世界最速のMapperライブラリを作ってみた（AutoMapperなどよりも3倍-10倍ほど高速）\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://qiita.com/higty/items/788cae32a8726d8baa82\" id=\"reference-b0d1bc8be5d5c9c1daa8\"\u003eプログラマのための機能のUIデザイン\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://qiita.com/higty/items/f1f981719b1a59b9e020\" id=\"reference-6a7815d67496db088ae0\"\u003e世界で通用するエンジニアになるための高度な技術記事（英語）\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"付録\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BB%98%E9%8C%B2\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e付録\u003c/h1\u003e\n\n\u003cp\u003e※その他の引用した記事\u003cbr\u003e\n\u003ca href=\"https://michaelscodingspot.com/performance-problems-in-csharp-dotnet/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://michaelscodingspot.com/performance-problems-in-csharp-dotnet/\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://devblogs.microsoft.com/dotnet/system-io-pipelines-high-performance-io-in-net/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://devblogs.microsoft.com/dotnet/system-io-pipelines-high-performance-io-in-net/\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://raygun.com/blog/c-sharp-performance-tips-tricks/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://raygun.com/blog/c-sharp-performance-tips-tricks/\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://www.c-sharpcorner.com/UploadFile/dacca2/5-tips-to-improve-performance-of-C-Sharp-code/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://www.c-sharpcorner.com/UploadFile/dacca2/5-tips-to-improve-performance-of-C-Sharp-code/\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://michaelscodingspot.com/avoid-gc-pressure/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://michaelscodingspot.com/avoid-gc-pressure/\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://michaelscodingspot.com/challenging-the-c-stringbuilder/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://michaelscodingspot.com/challenging-the-c-stringbuilder/\u003c/a\u003e\u003c/p\u003e\n","createdAt":"2020-08-29T06:47:33Z","elapsedYearsFromLastModifiedAt":1,"encryptedId":"+eCSsli5sbLdstDohGGaxKcpbsSAMVvqMQ==--6yze0TuxzrXZMibM--RdKtj9gP/slZUJb+9ndXew==","isBanned":false,"isDeprecated":true,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":false,"lastModifiedAt":"2020-08-29T06:47:33Z","likesCount":9,"linkUrl":"https://qiita.com/higty/items/306eebe988af39ba775d","organization":null,"originalId":1290554,"stockedCount":14,"title":"パフォーマンス向上で知っておくべきコンピューターサイエンスの基礎知識とその実践","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003eはじめに\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%85%A8%E3%81%A6%E3%82%92%E8%A8%88%E6%B8%AC%E3%81%99%E3%82%8B\"\u003e全てを計測する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B3%E3%83%B3%E3%83%94%E3%83%A5%E3%83%BC%E3%82%BF%E3%83%BC%E3%81%A8%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E3%82%92%E7%90%86%E8%A7%A3%E3%81%99%E3%82%8B\"\u003eコンピューターとネットワークを理解する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%84%AA%E5%85%88%E9%A0%86%E4%BD%8D%E3%82%92%E7%90%86%E8%A7%A3%E3%81%99%E3%82%8B\"\u003e優先順位を理解する\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%9B%E3%83%83%E3%83%88%E3%82%B3%E3%83%BC%E3%83%89%E3%83%91%E3%82%B9\"\u003eホットコードパス\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%BD%B1%E9%9F%BF%E3%81%AE%E5%A4%A7%E3%81%8D%E3%81%84%E3%81%A8%E3%81%93%E3%82%8D%E3%81%8B%E3%82%89%E6%94%B9%E5%96%84%E3%81%99%E3%82%8B\"\u003e影響の大きいところから改善する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E9%80%9A%E4%BF%A1%E3%81%AE%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E7%9F%A5%E3%82%8B\"\u003eネットワーク通信のコードを知る\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E6%93%8D%E4%BD%9C%E3%81%AE%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E7%9F%A5%E3%82%8B\"\u003eファイル操作のコードを知る\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%92%E3%83%BC%E3%83%97%E3%83%A1%E3%83%A2%E3%83%AA%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E7%90%86%E8%A7%A3%E3%81%99%E3%82%8B\"\u003eヒープメモリについて理解する\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%B8%8D%E8%A6%81%E3%81%AAnew%E3%82%92%E9%81%BF%E3%81%91%E3%82%8B\"\u003e不要なnewを避ける\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%9C%E3%82%AF%E3%82%B7%E3%83%B3%E3%82%B0\"\u003eボクシング\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#string%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E7%90%86%E8%A7%A3%E3%81%99%E3%82%8B\"\u003eStringについて理解する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#stringintern%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B\"\u003eString.Internを使用する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#list%E3%82%92%E6%AD%A3%E3%81%97%E3%81%8F%E5%88%9D%E6%9C%9F%E5%8C%96%E3%81%99%E3%82%8B\"\u003eListを正しく初期化する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%A9%E3%83%A0%E3%83%80%E5%BC%8F%E3%81%AE%E3%82%AD%E3%83%A3%E3%83%97%E3%83%81%E3%83%A3%E3%82%92%E6%84%8F%E8%AD%98%E3%81%99%E3%82%8B\"\u003eラムダ式のキャプチャを意識する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%A9%E3%83%A0%E3%83%80%E3%81%ABstatic%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%82%92%E6%B8%A1%E3%81%95%E3%81%AA%E3%81%84%E3%82%88%E3%81%86%E3%81%AB%E3%81%99%E3%82%8B\"\u003eラムダにstaticメソッドを渡さないようにする\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#arraypool%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B\"\u003eArrayPoolを使用する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#task%E3%81%AE%E4%BB%A3%E3%82%8F%E3%82%8A%E3%81%ABvaluetask%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B\"\u003eTaskの代わりにValueTaskを使用する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#span%E3%81%A8stakalloc%E3%82%92%E6%B4%BB%E7%94%A8%E3%81%99%E3%82%8B\"\u003eSpanとStakallocを活用する\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#gc%E3%82%AC%E3%83%99%E3%83%BC%E3%82%B8%E3%82%B3%E3%83%AC%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E7%90%86%E8%A7%A3%E3%81%99%E3%82%8B\"\u003eGC（ガベージコレクション）について理解する\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%95%E3%82%A1%E3%82%A4%E3%83%8A%E3%83%A9%E3%82%A4%E3%82%B6%E3%81%A8%E3%81%AF\"\u003eファイナライザとは？\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%88%E3%81%8F%E3%81%82%E3%82%8B%E3%83%A1%E3%83%A2%E3%83%AA%E3%83%AA%E3%83%BC%E3%82%AF%E3%81%AE%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E7%9F%A5%E3%82%8B\"\u003eよくあるメモリリークのパターンについて知る\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%BE%8B%E5%A4%96%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\"\u003e例外について\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95%E3%81%AB%E6%B3%A8%E6%84%8F%E3%81%99%E3%82%8B%E3%81%B9%E3%81%8D%E3%82%AF%E3%83%A9%E3%82%B9%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA\"\u003e使用方法に注意するべきクラスライブラリ\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#dataset%E3%82%88%E3%82%8A%E3%82%82datareader%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B\"\u003eDataSetよりもDataReaderを使用する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#table-valued-parameter%E3%81%8Bsqlbulkcopy%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6%E8%A4%87%E6%95%B0%E8%A1%8C%E3%82%92%E5%87%A6%E7%90%86%E3%81%99%E3%82%8B\"\u003eTable-Valued ParameterかSqlBulkCopyを使用して複数行を処理する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#dictionary%E3%81%AE%E3%82%AD%E3%83%BC%E3%81%AB%E6%B3%A8%E6%84%8F%E3%81%99%E3%82%8B\"\u003eDictionaryのキーに注意する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#asyncawait%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B\"\u003easync、awaitを使用する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#stream%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B\"\u003eStreamを使用する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#httpclient%E3%82%92using%E3%81%97%E3%81%AA%E3%81%84\"\u003eHttpClientをusingしない\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#socket%E3%82%92%E5%88%A9%E7%94%A8%E3%81%97%E3%81%9F%E6%99%82%E3%81%AE%E3%83%A1%E3%83%A2%E3%83%AA%E3%81%AE%E6%96%AD%E7%89%87%E5%8C%96%E3%81%A8out-of-memory%E3%82%92%E9%98%B2%E6%AD%A2%E3%81%99%E3%82%8B\"\u003eSocketを利用した時のメモリの断片化とOut Of Memoryを防止する\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%AA%E3%83%95%E3%83%AC%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3expression%E3%83%84%E3%83%AA%E3%83%BCdynamicasync%E3%82%B9%E3%83%AC%E3%83%83%E3%83%89\"\u003eリフレクション、Expressionツリー、dynamic、async、スレッド\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%AA%E3%83%95%E3%83%AC%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%92%E3%82%AD%E3%83%A3%E3%83%83%E3%82%B7%E3%83%A5%E3%81%99%E3%82%8B\"\u003eリフレクションをキャッシュする\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#dynamic%E3%82%92%E3%81%86%E3%81%BE%E3%81%84%E3%81%93%E3%81%A8%E6%B4%BB%E7%94%A8%E3%81%99%E3%82%8B\"\u003edynamicをうまいこと活用する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#generic-type-caching%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B\"\u003eGeneric Type Cachingを使用する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#expression%E3%83%84%E3%83%AA%E3%83%BC%E3%81%AE%E3%82%B3%E3%83%B3%E3%83%91%E3%82%A4%E3%83%AB%E3%82%92%E3%82%AD%E3%83%A3%E3%83%83%E3%82%B7%E3%83%A5%E3%81%99%E3%82%8B\"\u003eExpressionツリーのコンパイルをキャッシュする\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#regex%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%92%E3%82%B3%E3%83%B3%E3%83%91%E3%82%A4%E3%83%AB%E6%B8%88%E3%81%BF%E3%81%AB%E3%81%99%E3%82%8B\"\u003eRegexクラスをコンパイル済みにする\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#enum%E3%81%AEtostring%E3%82%92%E9%AB%98%E9%80%9F%E5%8C%96%E3%81%99%E3%82%8B\"\u003eEnumのToStringを高速化する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%AB%E3%83%BC%E3%83%97%E3%82%92%E5%B1%95%E9%96%8B%E3%81%99%E3%82%8B\"\u003eループを展開する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#foreach%E3%81%AE%E4%BB%A3%E3%82%8F%E3%82%8A%E3%81%ABfor%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B\"\u003eforeachの代わりにforを使用する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#linq%E9%A2%A8%E3%81%AE%E6%9B%B8%E3%81%8D%E6%96%B9%E3%82%92%E9%81%BF%E3%81%91%E3%81%A6foreach%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B\"\u003eLINQ風の書き方を避けてforeachを使用する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#array%E3%81%AE%E3%82%B3%E3%83%94%E3%83%BC%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\"\u003eArrayのコピーについて\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%89%E3%82%AD%E3%83%A5%E3%83%A1%E3%83%B3%E3%83%88%E3%81%AB%E7%84%A1%E3%81%84array%E3%81%AE%E7%A7%98%E5%AF%86\"\u003eドキュメントに無いArrayの秘密\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%97%E3%83%AD%E3%83%91%E3%83%86%E3%82%A3%E3%81%AE%E4%BB%A3%E3%82%8F%E3%82%8A%E3%81%AB%E3%83%95%E3%82%A3%E3%83%BC%E3%83%AB%E3%83%89%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B\"\u003eプロパティの代わりにフィールドを使用する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%AB%E3%83%BC%E3%83%97%E3%81%AEindex%E3%81%AB%E6%B3%A8%E6%84%8F%E3%81%99%E3%82%8B\"\u003eループのindexに注意する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#ui%E3%82%92%E5%B8%B8%E3%81%AB%E5%8F%8D%E5%BF%9C%E3%81%99%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%99%E3%82%8B\"\u003eUIを常に反応するようにする\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%AD%E3%83%A3%E3%83%83%E3%82%B7%E3%83%A5%E6%A9%9F%E8%83%BD%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B\"\u003eキャッシュ機能を実装する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%87%E3%83%90%E3%83%83%E3%82%B0%E3%83%93%E3%83%AB%E3%83%89%E3%81%AF%E9%81%85%E3%81%8F%E3%83%AA%E3%83%AA%E3%83%BC%E3%82%B9%E3%83%93%E3%83%AB%E3%83%89%E3%81%AF%E9%80%9F%E3%81%84\"\u003eデバッグビルドは遅くリリースビルドは速い\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%8A%E3%81%BE%E3%81%91\"\u003eおまけ\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%BB%98%E9%8C%B2\"\u003e付録\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":1526,"uuid":"306eebe988af39ba775d","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"HNipv+p8+p8gApvSzpPvdaz5fO8=--Y2O0Tsr8MepWolBk--KPTtqF0VyiZ//pQJZqmzsQ==","originalId":96483,"description":"","facebookUrl":null,"githubUrl":"https://github.com/higty","isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"","profileImageUrl":"https://qiita-image-store.s3.amazonaws.com/0/96483/profile-images/1548390071","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F96483%2Fprofile-images%2F1548390071?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=58527db5fda57c7507543a2a423105f4","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F96483%2Fprofile-images%2F1548390071?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=cfd641f4961ac44fd5ef70299a20a2b9","urlName":"higty","websiteUrl":"https://github.com/higty","twitterUrl":"https://twitter.com/higlabo","twitterUrlName":"higlabo","revealedOrganizations":{"edges":[]}},"tags":[{"name":"JavaScript","urlName":"javascript"},{"name":"C#","urlName":"csharp"},{"name":".NET","urlName":".net"},{"name":"初心者","urlName":"%e5%88%9d%e5%bf%83%e8%80%85"},{"name":"新人プログラマ応援","urlName":"%e6%96%b0%e4%ba%ba%e3%83%97%e3%83%ad%e3%82%b0%e3%83%a9%e3%83%9e%e5%bf%9c%e6%8f%b4"}],"followingLikers":{"edges":[]},"comments":{"totalCount":0}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

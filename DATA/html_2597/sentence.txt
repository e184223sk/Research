More than 1 year has passed since last update.メッシュを張ってカメラでそのメッシュを見たときに、カメラの視線とメッシュとの交点の座標を数学的に計算し表示させるプログラムをUnityで作ります。さっきの続きメッシュとカメラの視線が交わるときだけ、交点を表す紫の球体を出現させるようにしました点の内外判定を使って実装しました💪#Unity pic.twitter.com/oa2YpnLkVyこちらのページで、上の動画のように実際にカメラを動かして体験できます。まずメッシュをスクリプトを使って張ります。メッシュの張り方はこちらのサイトを参考にさせていただきました。本記事では、メッシュの頂点に球体を配置し、Unityのシーンからメッシュの頂点の位置を自由に動かせるという方針で実装していくので、参考にさせていただいたスクリプトに多少新たなコードを追加しています。まず空のゲームオブジェクトに"Mesh_front"という名前を付け(後で"Mesh_back"も作ります)、MeshRenderer、MeshFilter、白いマテリアル、さらに次のスクリプトをアタッチします。メッシュの頂点を表す球をsphere、球の頂点の座標をpointとしてあります。ここまでやると、下の図になります。

次に、Mesh_frontに球を渡します。とりあえず三角形のメッシュを作っていくので、球を3つ用意します。3つの球の名前をPoint0, Point1, Point2とし、Scaleを(0.1, 0.1, 0.1)としてあります。Mesh_frontのMakeMesh.csにあるSpheresのSizeを"3"に設定し、Point0, 1, 2を順番に入れます。ここまでやると、下の図になります。

さて、このままだとメッシュは片面にしか張られないので、もう片方の面にも張ります。やり方は簡単です。Mesh_frontを複製し、複製後のものを"Mesh_back"という名前にします。SphereのSizeを"3"にし、球をPoint2, 1, 0の順番に入れます。先ほどとは入れる順番が逆です。
次に、Main Cameraにアタッチするスクリプトについて説明します。各メソッドの説明をしていきます。このメソッドの実装はこちらのサイトの1：外積と法線ベクトルを用いる方法を参考にさせていただきました。という変形のもとに実装しました。法線ベクトルの値は、すでにStartメソッドの中で計算済みです。このメソッドの実装はこちらのサイトを参考にさせていただきました。ここで、カメラの座標を表すベクトルをカメラの視線の方向ベクトルをとします。このときパラメータtを用いて(91)式のように書くとするととなります。このx, y, zの値をとる座標がカメラの視線と平面との交点になっていればよいので、平面の方程式をとしたときよって左辺が0でなければとなります。あとはこのtの値をx, y, zに代入すればOKです。このメソッドはVector3.Crossメソッドを用いて、vec1, vec2, vec3の3点を通る平面の法線ベクトルを求めています。このメソッドはこちらのサイトから、ほぼ完全に引用させていただきました。交点がメッシュの内側にあるのか外側にあるのかを判定します。メインカメラのInspectorは下の図のようになっています。TPS Cameraというスクリプトは、カメラの位置や回転をXboxコントローラーで制御するためのスクリプトです。本記事では説明を割愛します。また、Find Coordinate Of Intersectionに入っているIntersectionとCoordinateというオブジェクトは後ほど作ります。
次に、カメラとメッシュとの交点を作ります。本記事では交点が視覚的に分かりやすいように、交点の位置に球を配置することにします。球は紫色にし、IntersectionController.csというスクリプトをつけます。IntersectionController.csの中では、球の位置を交点の位置に合わせ続けるように実装してあります。Main cameraにFindCoordinateController.csをアタッチしてあるので、Unityでcameraの欄にはMain Cameraを入れておきます。

次に、画面上に交点の座標を表示するためのテキストを作ります。

上の図のようにテキストを配置し、CoordinateというテキストをMain CameraにアタッチしたFindCoordinateController.csに入れておきます。最後に、メッシュが空中に浮いていると頂点の前後関係などが視覚的に分かりづらいと思ったので、x,x,z軸をオブジェクトとして作ることにしました。円柱を細く長く引き伸ばし、軸ごとの色を付けて置いておきます。
以上です。長い記事を読んでくださりありがとうございました！



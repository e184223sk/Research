More than 3 years have passed since last update.次: その2伺かみたいなのをMMDモデルで。何か起動させたり実行させたりしたい。
「MMDDM」は表示させるのみ、既に公開されている「MMD版伺か」は開発中途であり、DXライブラリを使用しているため、PMXモデルの表示に難がある。
→ PMDを扱えるライブラリは「MMDX」などがあるが、PMXに対応しているものはほとんどない。(MMFlexは凍結中?)
→ なら自分でつくればいいじゃないC# + SlimDX(DirectX11) (+ WPF)
PMDモデルはえと式チルノを使用DirectXでモデルを表示するために、まずはモデルファイルの読み込みを行います。
MMDのモデルデータには、PMDとPMXの2つがありますが、しばらくはPMDを使って開発していきます。
PMXは、PMDモデルの表示がある程度でき次第、とりかかる予定です。PMDの中身はこちらで公開されているので、これを参照しながら読み込んでいきます。
ソースはGitHubで公開しています。後日、VMDやPMXの読み込みも追加する予定です。PMDファイルはバイナリデータ(not テキストデータ)なので、FileStreamでファイルを開き、BinaryReaderで読み込んでいきます。このとき、エンコーディングにはShift-JISを指定します。ヘッダはPMDファイルであることを表すマジック(3byte)、バージョン(4byte)、モデル名(20byte)、コメント(256byte)で構成されています。
マジック・モデル名・コメントは文字列、バージョンは実数なので、ReadBytes(int 文字数)とReadSingle()を使用します。
エンコーディングがShift-JISなため、ReadCharsを使用すると、ヘッダの次の頂点の領域まで余分に読んでしまうので注意が必要です。
また、PMDファイルの文字列は、文字の終わりに0x00, パディングとして0xFDで埋められているので、文字の終端までを返す関数を用意します。(例外処理等はしてないです)
こんな調子でこの後の頂点リストやインデックスリストなどを読み込んでいきます。
PMDファイルにはテクスチャファイル名の指定の方法にバリエーションがあったり、物理演算に必要な剛体やジョイント関係のデータが格納されている/いないなどあるようですが、一番最新のものを基準に読み込みをしています。最後にPMDEditorと読み込んだものを確かめて、問題がなければ終了です。PMDの読み込みができたので、次回からはSlimDXを使用して、モデルの表示の準備をする予定です。



More than 3 years have passed since last update.uGUI で UI を実装していると、「なんでこのイベントとれないの?」と言いたくなることがたくさんあると思います。現在作っているアプリで、ボタンの長押しも使いそうな感じだったので対応させてみました。
そのついでに、OnPointerUp OnPointerDown でボタンのイベントを取る際に起こるつらい仕様をなるべくオーバーラップしました。なお、こちらのページではソースコードをすべて書くのも可読性悪いのかなーと思いましたので、ソースコード一式は github の公開リポジトリにて参照してください。PC上と実機(iPhone)で動作確認はしていますが、ひょっとしたらバグはまだ何かしら残っているかもしれませんのでそこは自己責任で・・・Clione/UI (MIT License)
https://github.com/MasaKoha/Clione/tree/develop/Assets/Clione/UI今回実装したボタンで取れるイベントは以下の内容です。uGUI のボタンの範囲を決まった時間長押しすると、長押しのイベントが取れるようにしました。
StartLongTap と EndLongTap は 1 フレームだけ呼ばれ、LongTapは毎フレーム呼ばれます。uGUI の Button.onClick は、ボタンが押されたときだけにしか呼ばれません。
本実装では、押したとき、離したときのイベントが取れるようになっているので、それぞれ別々の動作をさせることが可能です。(コード上だけで DOTween などを使用してアニメーションを書くことが容易)
Decide が呼ばれるのは、ClickUp と ほぼ 同じタイミングで呼ばれます(理由は後述)ClickUp と Decide を別々にしました。
別々にした理由は、CilckDown 時にボタンを押したままボタン外でClickUpするパターンもあります。
このときに Decide までするのはボタンの挙動としてどうなの?と思うところもありましたので別々にしています。Button.OnPointerDown と Button.OnPointerUp をそのまま使うと、同フレームに2つのイベントが呼ばれます。
この2つのイベントに対してアニメーションを記述すると、どちらのアニメーションが実行されるのかわかりません。例のような意図しないバグが発生する(した)ので、このボタンでは、各イベント同フレームで起こったとしても、必ず1フレーム遅延させてイベントを発行しています。
以下の画像は、ボタンを1F以内に押して離したときの挙動です。(数字はそのイベントが起こったときの Time.frameCount )
Button.onClick と同様に、AddLister すればイベントを取ることができます。



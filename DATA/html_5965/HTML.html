<!DOCTYPE html><html><head><meta charset="utf-8" /><title>【C#】Path.Combine（正確にはPath.IsPathRooted）で非直感的な動作にハマったのでまとめ。 - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/sugaryo/items/fc8d7553e59d671ac10c" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="gaqS60pt+NWK3pXPk4I+U//EbzhDLKh3RwtMmSR1POXHqvCsiIB/E0UeQ3ZBcJXbj47KCzZ3ZMgJkjqQGH00LQ==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta content="@sugaryo1224" name="twitter:creator" /><meta property="og:type" content="article"><meta property="og:title" content="【C#】Path.Combine（正確にはPath.IsPathRooted）で非直感的な動作にハマったのでまとめ。 - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND00NENRUXlQamdKRlFZWFJvTGtOdmJXSnBibVh2dklqbXJhUG5vcnJqZ2F2amdhOVFZWFJvTGtselVHRjBhRkp2YjNSbFpPLThpZU9CcC1tZG51ZWJ0T2FFbi1lYWhPT0JxdVdMbGVTOW5PT0JxLU9Eai1PRG51T0JvLU9Cbi1PQnJ1T0JwLU9CdnVPQnFPT0NnZU9BZ2cmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT01NCZ0eHQtY2xpcD1lbGxpcHNpcyZ0eHQtYWxpZ249Y2VudGVyJTJDbWlkZGxlJnM9NDNkOGEzZWIxMjE3NmFiYWRlYTEwYTc1NDc4MjQ4NWM&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RSE4xWjJGeWVXOCZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTQ1JnR4dC1hbGlnbj1yaWdodCUyQ2JvdHRvbSZzPTJjMWE4ZjM3ZTY2MzlhZjZjZWIxYjkyMjc0ZDIwZWYx&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=89d6db5807f6765fb5566ee71ff70d45"><meta property="og:description" content="久々に趣味コーディングでC#使ってたら、予想外の所でハマったので、ハマった所や調べた事、その他諸々を纏めてみます。


■やりたかった事と、ハマった所


やりたかったこと


パスを相対パスか絶対パスか判定
パスを連結



使った..."><meta content="https://qiita.com/sugaryo/items/fc8d7553e59d671ac10c" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#,path" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 1nzh4zz 38fzdi helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-1nzh4zz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:16px 32px;background-color:#FBE69E;color:rgba(0,0,0,0.87);line-height:1.5;font-weight:600;}@media (max-width:770px){.css-1nzh4zz{padding:16px;}}.css-38fzdi{color:#CA832A;margin-right:4px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-d938b89f-e055-4abd-9542-0e8c642d23a4"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Fsugaryo%2Fitems%2Ffc8d7553e59d671ac10c">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Fsugaryo%2Fitems%2Ffc8d7553e59d671ac10c">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-d938b89f-e055-4abd-9542-0e8c642d23a4">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2017-10-21T14:24:31.000+09:00","dateModified":"2017-10-21T15:02:01.000+09:00","headline":"【C#】Path.Combine（正確にはPath.IsPathRooted）で非直感的な動作にハマったのでまとめ。","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND00NENRUXlQamdKRlFZWFJvTGtOdmJXSnBibVh2dklqbXJhUG5vcnJqZ2F2amdhOVFZWFJvTGtselVHRjBhRkp2YjNSbFpPLThpZU9CcC1tZG51ZWJ0T2FFbi1lYWhPT0JxdVdMbGVTOW5PT0JxLU9Eai1PRG51T0JvLU9Cbi1PQnJ1T0JwLU9CdnVPQnFPT0NnZU9BZ2cmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT01NCZ0eHQtY2xpcD1lbGxpcHNpcyZ0eHQtYWxpZ249Y2VudGVyJTJDbWlkZGxlJnM9NDNkOGEzZWIxMjE3NmFiYWRlYTEwYTc1NDc4MjQ4NWM\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RSE4xWjJGeWVXOCZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTQ1JnR4dC1hbGlnbj1yaWdodCUyQ2JvdHRvbSZzPTJjMWE4ZjM3ZTY2MzlhZjZjZWIxYjkyMjc0ZDIwZWYx\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=89d6db5807f6765fb5566ee71ff70d45","mainEntityOfPage":"https://qiita.com/sugaryo/items/fc8d7553e59d671ac10c","author":{"@type":"Person","address":"","email":null,"identifier":"sugaryo","name":"sugaryo","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F170347%2Fprofile-images%2F1502688507?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=a596fd39cc77f63d5ba3004bff0087e3","url":"https://qiita.com/sugaryo","description":"缶コーヒーを原料にしてプログラムを吐き出すお仕事をしています。","memberOf":[]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://zine.qiita.com/interview/202106-uzabase-3/">社員の行動の基盤となるユーザベースのミッション・バリュー</a><a target="_blank" id="header_text_message_2" href="https://zine.qiita.com/interview/202106-uzabase-3/">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"sugaryo","type":"items","id":"fc8d7553e59d671ac10c"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"社員の行動の基盤となるユーザベースのミッション・バリュー","url":"https://zine.qiita.com/interview/202106-uzabase-3/","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"sugaryo","type":"items","id":"fc8d7553e59d671ac10c"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_1","message":"社員の行動の基盤となるユーザベースのミッション・バリュー","url":"https://zine.qiita.com/interview/202106-uzabase-3/","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"sugaryo","type":"items","id":"fc8d7553e59d671ac10c"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_2","message":"社員の行動の基盤となるユーザベースのミッション・バリュー","url":"https://zine.qiita.com/interview/202106-uzabase-3/","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/sugaryo/items/fc8d7553e59d671ac10c","location":"/sugaryo/items/fc8d7553e59d671ac10c","scheme":"https","host":"qiita.com","port":null,"pathname":"/sugaryo/items/fc8d7553e59d671ac10c","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"YyzDxILNHjxA2r6Veip2E+WnaV2TYYufxYaBZKhge0IlLKGDQCCZ+o8aaCyo2N2ble3MbuY6RyCLH/dtlGhzig==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-0f210387-deba-4874-93b5-1d5d4ce88498"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/sugaryo/items/fc8d7553e59d671ac10c/likers" class="css-1iupg5d">11</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">11</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/fc8d7553e59d671ac10c/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/sugaryo/items/fc8d7553e59d671ac10c/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/sugaryo/items/fc8d7553e59d671ac10c/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/sugaryo/items/fc8d7553e59d671ac10c/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/sugaryo/items/fc8d7553e59d671ac10c.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-1nzh4zz"><span class="fa fa-fw fa-warning css-38fzdi"></span><p>More than 3 years have passed since last update.</p></div><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/sugaryo"><img class="css-100alwu eyfquo10" src="https://qiita-image-store.s3.amazonaws.com/0/170347/profile-images/1502688507" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/sugaryo" class="css-10ougpm">@<!-- -->sugaryo</a><div class="css-1ay9vb9"><span><meta content="2017-10-21T05:24:31Z"/><time dateTime="2017-10-21T06:02:01Z" class="css-m19uds">updated at 2017-10-21</time></span></div></div></div></div></div><h1 class="css-cgzq40">【C#】Path.Combine（正確にはPath.IsPathRooted）で非直感的な動作にハマったのでまとめ。</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/path" class="css-4czcte">path</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div><p>久々に趣味コーディングでC#使ってたら、予想外の所でハマったので、ハマった所や調べた事、その他諸々を纏めてみます。</p>

<h1>
<span id="やりたかった事とハマった所" class="fragment"></span><a href="#%E3%82%84%E3%82%8A%E3%81%9F%E3%81%8B%E3%81%A3%E3%81%9F%E4%BA%8B%E3%81%A8%E3%83%8F%E3%83%9E%E3%81%A3%E3%81%9F%E6%89%80"><i class="fa fa-link"></i></a>■やりたかった事と、ハマった所</h1>

<h2>
<span id="やりたかったこと" class="fragment"></span><a href="#%E3%82%84%E3%82%8A%E3%81%9F%E3%81%8B%E3%81%A3%E3%81%9F%E3%81%93%E3%81%A8"><i class="fa fa-link"></i></a>やりたかったこと</h2>

<ul>
<li>パスを相対パスか絶対パスか判定</li>
<li>パスを連結</li>
</ul>

<h2>
<span id="使ったもの" class="fragment"></span><a href="#%E4%BD%BF%E3%81%A3%E3%81%9F%E3%82%82%E3%81%AE"><i class="fa fa-link"></i></a>使ったもの</h2>

<ul>
<li>Path.IsPathRooted</li>
<li>Path.Combine</li>
</ul>

<p>まぁ普通。</p>

<p>初歩的すぎて今更こんな所で躓くとは夢にも思ってなかったが、実際これを使って実装したら思いっきりバグってしまい、色々と調べる事に。。。</p>

<h2>
<span id="ツールの概要とハマったこと" class="fragment"></span><a href="#%E3%83%84%E3%83%BC%E3%83%AB%E3%81%AE%E6%A6%82%E8%A6%81%E3%81%A8%E3%83%8F%E3%83%9E%E3%81%A3%E3%81%9F%E3%81%93%E3%81%A8"><i class="fa fa-link"></i></a>ツールの概要とハマったこと</h2>

<p>大量にある画像ファイルをバッチ的に編集処理するツールを作ろうとしてて、編集した画像ファイルの保存先をオプション指定出来るようにしてたんだけど、その辺のパス関連処理で思いっきりバグりました。</p>

<p>具体的には、編集した画像ファイルの保存先として、以下の３つの機能を設けていました。</p>

<ul>
<li>指定なし　　：元のファイルのある所と同じところに出力</li>
<li>絶対パス指定：指定されたパスに出力</li>
<li>相対パス指定：元のファイルの有る所のサブフォルダに出力</li>
</ul>

<p>で、これを一つの「出力先パラメータ」設定でこの挙動を切り替えようとしていた訳です。</p>

<p>擬似コードで示すと、以下のようなロジックです。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">擬似コード</span></div>
<div class="highlight"><pre class="with-code"><code>
<span class="n">parameter</span> <span class="n">path</span><span class="p">;</span> <span class="c1">// 出力先パラメータ</span>
<span class="n">parameter</span> <span class="n">file</span><span class="p">;</span> <span class="c1">// 編集元ファイル</span>

<span class="k">if</span> <span class="p">(</span> <span class="n">path</span> <span class="k">is</span> <span class="err">ブランク</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// １：元ファイルと同じ所に出力。</span>
    <span class="k">return</span> <span class="n">file</span><span class="p">.</span><span class="n">Directory</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="n">path</span> <span class="k">is</span> <span class="err">絶対パス</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// ２：指定されたパスに出力。</span>
    <span class="k">return</span> <span class="n">path</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="n">path</span> <span class="k">is</span> <span class="err">相対パス</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// ３：元ファイルのあるフォルダから見た相対パスのサブフォルダに出力。</span>
    <span class="k">return</span> <span class="n">file</span><span class="p">.</span><span class="n">Directory</span> <span class="p">+</span> <span class="n">path</span><span class="p">;</span>
<span class="p">}</span>

</code></pre></div>
</div>

<p>で、この「絶対パスか否か」の判定に <strong>Path.IsPathRooted</strong> を、<br>
「パスの連結」の処理に <strong>Path.Combine</strong> を、それぞれ使用した訳です。</p>

<p>誰だってそーする、俺だってそーする。</p>

<p>が、結果として<strong>「相対パス」のつもりで与えていたパラメータに対して、思った通りに動作してくれませんでした。</strong></p>

<h1>
<span id="問題の非直感的な動作に関して" class="fragment"></span><a href="#%E5%95%8F%E9%A1%8C%E3%81%AE%E9%9D%9E%E7%9B%B4%E6%84%9F%E7%9A%84%E3%81%AA%E5%8B%95%E4%BD%9C%E3%81%AB%E9%96%A2%E3%81%97%E3%81%A6"><i class="fa fa-link"></i></a>■問題の非直感的な動作に関して</h1>

<p>ツールのコードでは問題が解り難くなるので、シンプルな検証コードを書いてきました。</p>

<h2>
<span id="pathispathrootedの非直感的な動作" class="fragment"></span><a href="#pathispathrooted%E3%81%AE%E9%9D%9E%E7%9B%B4%E6%84%9F%E7%9A%84%E3%81%AA%E5%8B%95%E4%BD%9C"><i class="fa fa-link"></i></a>Path.IsPathRootedの非直感的な動作</h2>

<p>幾つかのパス文字列のパターンで検証。</p>

<p>コメントに書いているのは実行結果ではなく <strong>「期待する挙動」</strong> です。<br>
★マークが付いているのは <strong>「実行結果が期待と異なるケース」</strong> です。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="c1">// IsPathRooted でチェックするパス文字列</span>
<span class="kt">string</span><span class="p">[]</span> <span class="n">paths</span> <span class="p">=</span> 
<span class="p">{</span>
    <span class="s">@"C"</span><span class="p">,</span>          <span class="c1">// 相対パス</span>
    <span class="s">@"C:"</span><span class="p">,</span>         <span class="c1">// 絶対パス</span>
    <span class="s">@"C:\"</span><span class="p">,</span>        <span class="c1">// 絶対パス</span>
    <span class="s">@"C:\hoge"</span><span class="p">,</span>    <span class="c1">// 絶対パス</span>

    <span class="s">@"moge"</span><span class="p">,</span>       <span class="c1">// 相対パス</span>
    <span class="s">@"\moge"</span><span class="p">,</span>      <span class="c1">// 相対パス　★</span>
    <span class="s">@"/moge"</span><span class="p">,</span>      <span class="c1">// 相対パス　★</span>

    <span class="s">@"\\unc\piyo"</span><span class="p">,</span> <span class="c1">// 絶対パス</span>
    <span class="s">@"//unc/piyo"</span><span class="p">,</span> <span class="c1">// 絶対パス</span>

    <span class="s">@"http://"</span><span class="p">,</span>    <span class="c1">// おまけ（一応、絶対パスかなぁ・・・）</span>
<span class="p">};</span>



<span class="c1">// それぞれのパス文字列に関して、ルートパスか否か判定。</span>
<span class="kt">int</span> <span class="n">maxlen</span> <span class="p">=</span> <span class="n">paths</span><span class="p">.</span><span class="nf">Select</span><span class="p">(</span> <span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Length</span> <span class="p">).</span><span class="nf">Max</span><span class="p">();</span> <span class="c1">//出力整形のため。</span>
<span class="k">foreach</span> <span class="p">(</span> <span class="kt">string</span> <span class="n">path</span> <span class="k">in</span> <span class="n">paths</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="kt">bool</span> <span class="n">isroot</span> <span class="p">=</span> <span class="n">Path</span><span class="p">.</span><span class="nf">IsPathRooted</span><span class="p">(</span> <span class="n">path</span> <span class="p">);</span>

    <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span> <span class="s">$"</span><span class="p">{</span><span class="n">path</span><span class="p">.</span><span class="nf">PadRight</span><span class="p">(</span><span class="n">maxlen</span><span class="p">)}</span><span class="s"> -&gt; </span><span class="p">{</span><span class="n">isroot</span><span class="p">}</span><span class="s">"</span> <span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>このコードの実行結果がこちら。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>C          -&gt; False
C:         -&gt; True
C:\        -&gt; True
C:\hoge    -&gt; True
moge       -&gt; False
\moge      -&gt; True　・・・★
/moge      -&gt; True　・・・★
\\unc\piyo -&gt; True
//unc/piyo -&gt; True
http://    -&gt; False
</code></pre></div></div>

<p>上記の通り、★マークを付けた <code>\moge</code> と <code>/moge</code> のケースで、こちらの期待とは裏腹に <code>true</code> が返って来ています。</p>

<h2>
<span id="pathcombineの非直感的な動作" class="fragment"></span><a href="#pathcombine%E3%81%AE%E9%9D%9E%E7%9B%B4%E6%84%9F%E7%9A%84%E3%81%AA%E5%8B%95%E4%BD%9C"><i class="fa fa-link"></i></a>Path.Combineの非直感的な動作</h2>

<p>そして、上記 <strong>IsPathRooted</strong> と同様に <strong>Combine</strong> の方でも非直感的な動作結果となります。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code>
<span class="c1">// Combine で連結するパス文字列</span>
<span class="kt">var</span> <span class="n">paths</span> <span class="p">=</span> <span class="k">new</span><span class="p">[]</span> <span class="p">{</span>
    <span class="k">new</span> <span class="p">{</span> <span class="n">path1</span> <span class="p">=</span> <span class="s">@"C:"</span><span class="p">,</span>  <span class="n">path2</span> <span class="p">=</span> <span class="s">@"Directory\Folder"</span> <span class="p">},</span>
    <span class="k">new</span> <span class="p">{</span> <span class="n">path1</span> <span class="p">=</span> <span class="s">@"C:\"</span><span class="p">,</span> <span class="n">path2</span> <span class="p">=</span> <span class="s">@"Directory\Folder"</span> <span class="p">},</span>
    <span class="k">new</span> <span class="p">{</span> <span class="n">path1</span> <span class="p">=</span> <span class="s">@"C:\"</span><span class="p">,</span> <span class="n">path2</span> <span class="p">=</span> <span class="s">@"\Directory\Folder"</span> <span class="p">},</span>

    <span class="k">new</span> <span class="p">{</span> <span class="n">path1</span> <span class="p">=</span> <span class="s">@"C:\Directory"</span><span class="p">,</span>  <span class="n">path2</span> <span class="p">=</span> <span class="s">@"Folder"</span> <span class="p">},</span>
    <span class="k">new</span> <span class="p">{</span> <span class="n">path1</span> <span class="p">=</span> <span class="s">@"C:\Directory\"</span><span class="p">,</span> <span class="n">path2</span> <span class="p">=</span> <span class="s">@"Folder"</span> <span class="p">},</span>
    <span class="k">new</span> <span class="p">{</span> <span class="n">path1</span> <span class="p">=</span> <span class="s">@"C:\Directory\"</span><span class="p">,</span> <span class="n">path2</span> <span class="p">=</span> <span class="s">@"\Folder"</span> <span class="p">},</span>


    <span class="k">new</span> <span class="p">{</span> <span class="n">path1</span> <span class="p">=</span> <span class="s">@"C:\"</span><span class="p">,</span>           <span class="n">path2</span> <span class="p">=</span> <span class="s">@"Directory\Folder\"</span> <span class="p">},</span>
    <span class="k">new</span> <span class="p">{</span> <span class="n">path1</span> <span class="p">=</span> <span class="s">@"C:\Directory\"</span><span class="p">,</span> <span class="n">path2</span> <span class="p">=</span> <span class="s">@"Folder\"</span> <span class="p">},</span>
<span class="p">};</span>



<span class="c1">// それぞれのパス文字列に関して、連結結果を確認。</span>
<span class="c1">// ※気持ち的には、全てのケースで同じパスになっていて欲しい。</span>
<span class="kt">int</span> <span class="n">maxlen1</span> <span class="p">=</span> <span class="n">paths</span><span class="p">.</span><span class="nf">Select</span><span class="p">(</span> <span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">path1</span><span class="p">.</span><span class="n">Length</span> <span class="p">).</span><span class="nf">Max</span><span class="p">();</span> <span class="c1">// 出力整形のため。</span>
<span class="kt">int</span> <span class="n">maxlen2</span> <span class="p">=</span> <span class="n">paths</span><span class="p">.</span><span class="nf">Select</span><span class="p">(</span> <span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">path2</span><span class="p">.</span><span class="n">Length</span> <span class="p">).</span><span class="nf">Max</span><span class="p">();</span> <span class="c1">// 出力整形のため。</span>
<span class="k">foreach</span> <span class="p">(</span> <span class="kt">var</span> <span class="n">p</span> <span class="k">in</span> <span class="n">paths</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="kt">string</span> <span class="n">combine</span> <span class="p">=</span> <span class="n">Path</span><span class="p">.</span><span class="nf">Combine</span><span class="p">(</span> <span class="n">p</span><span class="p">.</span><span class="n">path1</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">path2</span> <span class="p">);</span>

    <span class="kt">string</span> <span class="n">p1</span> <span class="p">=</span> <span class="n">p</span><span class="p">.</span><span class="n">path1</span><span class="p">.</span><span class="nf">PadRight</span><span class="p">(</span><span class="n">maxlen1</span><span class="p">);</span>
    <span class="kt">string</span> <span class="n">p2</span> <span class="p">=</span> <span class="n">p</span><span class="p">.</span><span class="n">path2</span><span class="p">.</span><span class="nf">PadRight</span><span class="p">(</span><span class="n">maxlen2</span><span class="p">);</span>

    <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span> <span class="s">$"</span><span class="p">{</span><span class="n">p1</span><span class="p">}</span><span class="s"> + </span><span class="p">{</span><span class="n">p2</span><span class="p">}</span><span class="s"> =&gt; </span><span class="p">{</span><span class="n">combine</span><span class="p">}</span><span class="s">"</span> <span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>ソース内コメントに書いてある通り、このテストケースの全てに於いて、ユーザの期待としては <code>C:\Directory\Folder</code> という同じ結果になって欲しいというのが <strong>直感的な期待</strong> となります。</p>

<p>が、実行結果は以下のようになります。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>C:            + Directory\Folder  =&gt; C:Directory\Folder
C:\           + Directory\Folder  =&gt; C:\Directory\Folder
C:\           + \Directory\Folder =&gt; \Directory\Folder    ★

C:\Directory  + Folder            =&gt; C:\Directory\Folder
C:\Directory\ + Folder            =&gt; C:\Directory\Folder
C:\Directory\ + \Folder           =&gt; \Folder              ★

C:\           + Directory\Folder\ =&gt; C:\Directory\Folder\
C:\Directory\ + Folder\           =&gt; C:\Directory\Folder\

</code></pre></div></div>

<p>末尾の <code>\</code> の有り無しはまぁ置いといて。</p>

<p>★マークを付けた２ケースに於いて、<strong>期待とは異なる残念な結果</strong> になっています。<br>
<em>（一応明記しとくと、バグッてる訳じゃなく、仕様通りの挙動だそうです）</em></p>

<h1>
<span id="pathのmsdnリファレンス" class="fragment"></span><a href="#path%E3%81%AEmsdn%E3%83%AA%E3%83%95%E3%82%A1%E3%83%AC%E3%83%B3%E3%82%B9"><i class="fa fa-link"></i></a>■PathのMSDNリファレンス</h1>

<p>では、MSDNのリファレンスを確認してみましょう。</p>

<h2>
<span id="pathispathrooted" class="fragment"></span><a href="#pathispathrooted"><i class="fa fa-link"></i></a>Path.IsPathRooted</h2>

<p><qiita-embed-ogp src="https://msdn.microsoft.com/ja-jp/library/system.io.path.ispathrooted(v=vs.110).aspx"></qiita-embed-ogp></p>

<p><strong>メソッド概要：</strong></p>

<blockquote>
<p>指定したパス文字列にルートが含まれているかどうかを示す値を取得します。</p>
</blockquote>

<p><strong>戻り値：</strong></p>

<blockquote>
<p>path にルートが含まれている場合は true。それ以外の場合は false。</p>
</blockquote>

<p>そうです。<br>
「パスにルートが含まれているか否かを判定する」と書いてありますが、<br>
「絶対パスか相対パスかを判定する」とは書かれていないのです。</p>

<p><em>※ここで言う「ルート」ってのが具体的に何の事を意味しているのか、と言うのが重要になりますね。正直、定義が良く解りませんが。</em></p>

<p>「パスが絶対パスか相対パスか調べたい」と言う要件でぐぐると、割りとすぐに「IsPathRootedメソッドを使え」と言う情報がヒットしますが、 <strong>このメソッドは絶対パスか相対パスかを判定するためのものではない</strong> と言うのが落とし穴になっている訳です。</p>

<h2>
<span id="pathcombine" class="fragment"></span><a href="#pathcombine"><i class="fa fa-link"></i></a>Path.Combine</h2>

<p><qiita-embed-ogp src="https://msdn.microsoft.com/ja-jp/library/fyy7a5kt(v=vs.110).aspx"></qiita-embed-ogp></p>

<p><strong>メソッド概要：</strong></p>

<blockquote>
<p>2 つの文字列を 1 つのパスに結合します。</p>
</blockquote>

<p><strong>戻り値：</strong></p>

<blockquote>
<p>結合されたパス。<br>
指定したパスの 1 つが長さ 0 の文字列の場合、このメソッドは別のパスを返します。 path2 に絶対パスが含まれる場合、このメソッドは path2 を返します。</p>
</blockquote>

<p>重要なのが、戻り値の説明に書かれた二文目の内容です。</p>

<p>「絶対パスが含まれる場合」とあります。</p>

<p>何となく動作結果から予想付いてましたが、ここでは <strong>IsPathRooted</strong> で判定している<em>（若しくはそれと同等の判定処理がある）</em>事が伺えますね。</p>

<p><em>※せっかくIsPathRootedメソッドの説明では「絶対パスか否か」と言う名言を避けていたのに、それを使っているCombineメソッドの方で「絶対パスが」と言っちゃってるのは、何と言うかちょっとアレですねって言う話。これではどちらかの説明、或いは実装が誤っていると言わざるを得ない。</em></p>

<h3>
<span id="余談" class="fragment"></span><a href="#%E4%BD%99%E8%AB%87"><i class="fa fa-link"></i></a>余談</h3>

<p>Combineの備考欄に何やら重要っぽい事が書かれてるみたいなんですが、どうも機械翻訳がいまいちイケてないみたいなので、あとで英語の原文を読んでみようかと思います。</p>

<h1>
<span id="pathクラス実装のコードリーディング" class="fragment"></span><a href="#path%E3%82%AF%E3%83%A9%E3%82%B9%E5%AE%9F%E8%A3%85%E3%81%AE%E3%82%B3%E3%83%BC%E3%83%89%E3%83%AA%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0"><i class="fa fa-link"></i></a>■Pathクラス実装のコードリーディング</h1>

<p>予想だけで記事を書いてもしょうがないので、実際に実装コードを読んでみましょう。</p>

<h2>
<span id="pathispathrooted-1" class="fragment"></span><a href="#pathispathrooted-1"><i class="fa fa-link"></i></a>Path.IsPathRooted</h2>

<p>まず、問題の <strong>IsPathRooted</strong> 先生。</p>

<p><qiita-embed-ogp src="http://referencesource.microsoft.com/#mscorlib/system/io/path.cs,807960f08fca497d"></qiita-embed-ogp></p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">Path.IsPathRooted</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">if</span> <span class="p">((</span><span class="n">length</span> <span class="p">&gt;=</span> <span class="m">1</span> <span class="p">&amp;&amp;</span> <span class="p">(</span><span class="n">path</span><span class="p">[</span><span class="m">0</span><span class="p">]</span> <span class="p">==</span> <span class="n">DirectorySeparatorChar</span> <span class="p">||</span> <span class="n">path</span><span class="p">[</span><span class="m">0</span><span class="p">]</span> <span class="p">==</span> <span class="n">AltDirectorySeparatorChar</span><span class="p">))</span> <span class="p">||</span> <span class="p">(</span><span class="n">length</span> <span class="p">&gt;=</span> <span class="m">2</span> <span class="p">&amp;&amp;</span> <span class="n">path</span><span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="p">==</span> <span class="n">VolumeSeparatorChar</span><span class="p">))</span>
                    <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
</code></pre></div>
</div>

<p>という判定処理がありますね。</p>

<p>ショートコーディング風でちょっと解り難いので、読み易く同等な処理として書き換えてみます。</p>

<p>まずは単純にコード整形。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">Path.IsPathRooted（整形後）</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="n">length</span> <span class="p">&gt;=</span> <span class="m">1</span> <span class="p">&amp;&amp;</span> <span class="p">(</span> <span class="n">path</span><span class="p">[</span><span class="m">0</span><span class="p">]</span> <span class="p">==</span> <span class="n">DirectorySeparatorChar</span>        <span class="c1">// '\'</span>
                    <span class="p">||</span> <span class="n">path</span><span class="p">[</span><span class="m">0</span><span class="p">]</span> <span class="p">==</span> <span class="n">AltDirectorySeparatorChar</span> <span class="p">)</span> <span class="p">)</span> <span class="c1">// '/'</span>

  <span class="p">||</span> <span class="p">(</span><span class="n">length</span> <span class="p">&gt;=</span> <span class="m">2</span> <span class="p">&amp;&amp;</span> <span class="n">path</span><span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="p">==</span> <span class="n">VolumeSeparatorChar</span><span class="p">)</span> <span class="p">)</span>          <span class="c1">// ':'</span>

                    <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
</code></pre></div>
</div>

<p>if文の中身がぐちゃぐちゃして気に食わないので、等価なコードに書き換え。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">Path.IsPathRooted（リファクタリング）</span></div>
<div class="highlight"><pre class="with-code"><code>
<span class="k">if</span> <span class="p">(</span> <span class="n">length</span> <span class="p">&gt;=</span> <span class="m">1</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// 先頭の文字が '\' 若しくは '/' の場合、絶対パスと判定。</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">path</span><span class="p">[</span><span class="m">0</span><span class="p">]</span> <span class="p">==</span> <span class="n">DirectorySeparatorChar</span>
      <span class="p">||</span> <span class="n">path</span><span class="p">[</span><span class="m">0</span><span class="p">]</span> <span class="p">==</span> <span class="n">AltDirectorySeparatorChar</span> <span class="p">)</span> <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span> <span class="n">length</span> <span class="p">&gt;=</span> <span class="m">2</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// 二文字目が ':' の場合、絶対パスと判定。</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">length</span> <span class="p">&gt;=</span> <span class="m">2</span> <span class="p">&amp;&amp;</span> <span class="n">path</span><span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="p">==</span> <span class="n">VolumeSeparatorChar</span> <span class="p">)</span> <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// 上記２パターン以外は全て相対パスと判定。</span>
<span class="k">return</span> <span class="k">false</span><span class="p">;</span>

</code></pre></div>
</div>

<p>実装コード内の <code>length</code> に関しては、単に <strong>IndexOutOfRangeException</strong> に対するガードとしての機能しか無いので、ぶっちゃけ贅肉ですね。</p>

<p>例えば拡張メソッドを使って以下のように書き換えちゃえばコードがスッキリします。（個人的な趣味）</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">拡張メソッド</span></div>
<div class="highlight"><pre class="with-code"><code>        <span class="k">public</span> <span class="k">static</span> <span class="kt">char</span> <span class="nf">at</span><span class="p">(</span> <span class="k">this</span> <span class="kt">string</span> <span class="n">s</span><span class="p">,</span> <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="kt">char</span> <span class="n">alter</span> <span class="p">=</span> <span class="sc">'\0'</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">int</span> <span class="n">tail</span> <span class="p">=</span> <span class="n">s</span><span class="p">.</span><span class="n">Length</span> <span class="p">-</span> <span class="m">1</span><span class="p">;</span>

            <span class="k">return</span> <span class="n">i</span> <span class="p">&gt;</span> <span class="n">tail</span> <span class="p">?</span> <span class="n">alter</span> <span class="p">:</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="p">}</span>

</code></pre></div>
</div>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">拡張メソッドatを用いて書き換えたコード</span></div>
<div class="highlight"><pre class="with-code"><code>            <span class="c1">// 先頭の文字が '\' 若しくは '/' の場合、絶対パスと判定。</span>
            <span class="kt">char</span> <span class="n">c1</span> <span class="p">=</span> <span class="n">path</span><span class="p">.</span><span class="nf">at</span><span class="p">(</span><span class="m">0</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span> <span class="n">c1</span> <span class="p">==</span> <span class="n">DirectorySeparatorChar</span>
              <span class="p">||</span> <span class="n">c1</span> <span class="p">==</span> <span class="n">AltDirectorySeparatorChar</span> <span class="p">)</span> <span class="k">return</span> <span class="k">true</span><span class="p">;</span>

            <span class="c1">// 二文字目が ':' の場合、絶対パスと判定。</span>
            <span class="kt">char</span> <span class="n">c2</span> <span class="p">=</span> <span class="n">path</span><span class="p">.</span><span class="nf">at</span><span class="p">(</span><span class="m">1</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span> <span class="n">c2</span> <span class="p">==</span> <span class="n">VolumeSeparatorChar</span> <span class="p">)</span> <span class="k">return</span> <span class="k">true</span><span class="p">;</span>

            <span class="c1">// 上記２パターン以外は全て相対パスと判定。</span>
            <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
</code></pre></div>
</div>

<p><em>※拡張メソッドが有りなら普通に FirstOrDefault 使えばいいじゃーん、って言う話もある。</em></p>

<h2>
<span id="pathcombine-1" class="fragment"></span><a href="#pathcombine-1"><i class="fa fa-link"></i></a>Path.Combine</h2>

<p>次に、内部的に <strong>IsPathRooted</strong> を呼び出していると予想される <strong>Combine</strong> 先生。</p>

<p><qiita-embed-ogp src="http://referencesource.microsoft.com/#mscorlib/system/io/path.cs,2d7263f86a526264"></qiita-embed-ogp></p>

<p>が、呼び出しているコア処理の <strong>CombineNoChecks</strong> さん。</p>

<p><qiita-embed-ogp src="http://referencesource.microsoft.com/#mscorlib/system/io/path.cs,16ed6da326ce4745"></qiita-embed-ogp></p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">Path.CombineNoChecks</span></div>
<div class="highlight"><pre class="with-code"><code>            <span class="k">if</span> <span class="p">(</span><span class="nf">IsPathRooted</span><span class="p">(</span><span class="n">path2</span><span class="p">))</span>
                <span class="k">return</span> <span class="n">path2</span><span class="p">;</span>
</code></pre></div>
</div>

<p>ハイ、予想通りいましたね。</p>

<p>MSDNに記載されていた「path2 に絶対パスが含まれる場合、このメソッドは path2 を返します」は、このコードを和訳したようなものです。</p>

<p>よりストレートに言えば <strong>IsPathRooted</strong> が <code>true</code> になる場合、このメソッドは <code>path2</code> を返します、だ。</p>

<p>繰り返しますが、 <strong>IsPathRooted</strong> の説明では「絶対パスか否か」を判定するとは言っておらず、「パスにルートを含むか否か」という表現でした。<br>
しかし、これを利用しており、それ以外の条件が付与されていない実装である <strong>Combine</strong> の説明では「絶対パスが含まれる場合」と言っているので、間接的に <strong>IsPathRooted</strong> は絶対パスか否かを判定する（目的で使用される）と言っている訳です。</p>

<p>うーん、、、これって一体・・・。^^;</p>

<h1>
<span id="所感" class="fragment"></span><a href="#%E6%89%80%E6%84%9F"><i class="fa fa-link"></i></a>■所感</h1>

<p>バグか否かという議論は一旦棚上げにしておくとしても、この <strong>IsPathRooted</strong> の挙動は <strong>非直感的</strong> であり <strong>一般的な用途に対して不都合がある</strong> 実装だと思います。</p>

<p>そして、これがIsPathRootedだけの話であれば良かった。<br>
「絶対パスか否かを判定する」目的のユーティリティを普通に自作して Path.IsPathRooted の使用を開発規約で非推奨にしちまえば話は簡単。<br>
しかし、Combineが内部でIsPathRootedを使用しているので、芋蔓でそっちも書き換えたくなると言うのが厄介な所。</p>

<p>しかもCombineの方は実装が深い上に可変パラメータに対応する為に結構コテコテ書かれているので、代替するメソッドを用意するのも面倒くさい、というね。</p>

<p>ぶっちゃけた話、IsPathRootedが業務開発で出て来る事なんて稀なんで、割りとどうだって良いかなって感じですが、Combineに関しては出て来ない方がむしろ珍しいまである頻出メソッドです。<br>
こっちの方が問題としては結構厄介ですよね。</p>

<p>冒頭でチラッと言いましたけど<strong>「C#でパス結合するならPath.Combineを使うのが常識だ」</strong>というのは良く言われる事だと思います。<br>
数多くの入門サイトでも、この方法が強く推奨されていたり、この実装が一般的だからこれに合わせなさいと書かれていたりする事が殆どです。<br>
あまりにも常識として定着し過ぎており、それを疑ったり検証する事すら稀なレベルなので、お恥ずかしながら自分も今日に至るまでこの問題に気付きませんでした。</p>

<h1>
<span id="まとめ" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>■まとめ</h1>

<p>自分達の実装しようとしている「目的」に対して、Combine・IsPathRootedの「仕様」がマッチしているかどうか、「手段」として妥当かどうかをきちんと確認しましょう。</p>

<p>そして、悲しいかなそれが手段として妥当でないという結論に至った場合、プロジェクト内の共通実装としてユーティリティを用意して、それを使うように周知徹底しましょう。</p>

<p><em>※代替となる実装手段は幾つかヒットしますが、既存のライブラリ実装の組み合わせではどれも微妙なクセがあるので、素直に文字列操作として自作するのが良さそうです、、、。</em></p>

<h1>
<span id="参考文献" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE"><i class="fa fa-link"></i></a>■参考文献</h1>

<p><qiita-embed-ogp src="http://oita.oika.me/2013/02/23/dotnet_path/"></qiita-embed-ogp></p>

<h1>
<span id="ちょっと追記" class="fragment"></span><a href="#%E3%81%A1%E3%82%87%E3%81%A3%E3%81%A8%E8%BF%BD%E8%A8%98"><i class="fa fa-link"></i></a>■ちょっと追記。</h1>

<h2>
<span id="javaだとどうなるか" class="fragment"></span><a href="#java%E3%81%A0%E3%81%A8%E3%81%A9%E3%81%86%E3%81%AA%E3%82%8B%E3%81%8B"><i class="fa fa-link"></i></a>Javaだとどうなるか？</h2>

<p>気になったので、JShellを起動してJavaだとどうなるか試してみた。</p>

<p>相当機能としてはPaths#getだと思うのでこいつを使ってみる。</p>

<p><a href="https://camo.qiitausercontent.com/3462148894f2d36b6a6878e4f5a69eed5adf3737/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3137303334372f62386339643930642d616335622d636337622d323731372d3762663930356236336531642e6a706567" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F170347%2Fb8c9d90d-ac5b-cc7b-2717-7bf905b63e1d.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=c149f1acbb3ef6cd529547dab750d63b" alt="WS000156.JPG" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/170347/b8c9d90d-ac5b-cc7b-2717-7bf905b63e1d.jpeg" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F170347%2Fb8c9d90d-ac5b-cc7b-2717-7bf905b63e1d.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=74fedd163d7fdb0d9725db8182de0ef0 1x" loading="lazy"></a></p>

<p>期待通りにパスが連結されました。</p>

<p>求めている挙動はこういう挙動なので、この目的ではPath.Combineは使えないですね。</p>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Fsugaryo%2Fitems%2Ffc8d7553e59d671ac10c&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Fsugaryo%2Fitems%2Ffc8d7553e59d671ac10c&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/sugaryo/items/fc8d7553e59d671ac10c/likers" class="css-1iupg5d">11</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">11</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/fc8d7553e59d671ac10c/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/sugaryo/items/fc8d7553e59d671ac10c/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/sugaryo/items/fc8d7553e59d671ac10c/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/sugaryo/items/fc8d7553e59d671ac10c/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/sugaryo/items/fc8d7553e59d671ac10c.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-0f210387-deba-4874-93b5-1d5d4ce88498">{"authorAnalyticsTrackingId":null,"organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-be9a727e-e85e-49b2-a893-d69caf3ad836"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-be9a727e-e85e-49b2-a893-d69caf3ad836">{}</script>
      
<div id="LoginModal-react-component-a3ca8ddd-a969-4c0c-b5d0-8c5c23166f2f"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-a3ca8ddd-a969-4c0c-b5d0-8c5c23166f2f">{}</script>
      
<div id="StockModal-react-component-64eab2ab-4a31-4847-89da-067b0aad50a1"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-64eab2ab-4a31-4847-89da-067b0aad50a1">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;fu0yGviAC3G4wfw2qhHt80oL4S+9CJelpOjYu0L149I47VBdOm2Mt3cBKo9440Z7OkFEHMhTWxrqca6yfv3rGg==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\u003cp\u003e久々に趣味コーディングでC#使ってたら、予想外の所でハマったので、ハマった所や調べた事、その他諸々を纏めてみます。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"やりたかった事とハマった所\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%84%E3%82%8A%E3%81%9F%E3%81%8B%E3%81%A3%E3%81%9F%E4%BA%8B%E3%81%A8%E3%83%8F%E3%83%9E%E3%81%A3%E3%81%9F%E6%89%80\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e■やりたかった事と、ハマった所\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"やりたかったこと\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%84%E3%82%8A%E3%81%9F%E3%81%8B%E3%81%A3%E3%81%9F%E3%81%93%E3%81%A8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eやりたかったこと\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003eパスを相対パスか絶対パスか判定\u003c/li\u003e\n\u003cli\u003eパスを連結\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"使ったもの\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BD%BF%E3%81%A3%E3%81%9F%E3%82%82%E3%81%AE\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e使ったもの\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003ePath.IsPathRooted\u003c/li\u003e\n\u003cli\u003ePath.Combine\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eまぁ普通。\u003c/p\u003e\n\n\u003cp\u003e初歩的すぎて今更こんな所で躓くとは夢にも思ってなかったが、実際これを使って実装したら思いっきりバグってしまい、色々と調べる事に。。。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ツールの概要とハマったこと\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%84%E3%83%BC%E3%83%AB%E3%81%AE%E6%A6%82%E8%A6%81%E3%81%A8%E3%83%8F%E3%83%9E%E3%81%A3%E3%81%9F%E3%81%93%E3%81%A8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eツールの概要とハマったこと\u003c/h2\u003e\n\n\u003cp\u003e大量にある画像ファイルをバッチ的に編集処理するツールを作ろうとしてて、編集した画像ファイルの保存先をオプション指定出来るようにしてたんだけど、その辺のパス関連処理で思いっきりバグりました。\u003c/p\u003e\n\n\u003cp\u003e具体的には、編集した画像ファイルの保存先として、以下の３つの機能を設けていました。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e指定なし　　：元のファイルのある所と同じところに出力\u003c/li\u003e\n\u003cli\u003e絶対パス指定：指定されたパスに出力\u003c/li\u003e\n\u003cli\u003e相対パス指定：元のファイルの有る所のサブフォルダに出力\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eで、これを一つの「出力先パラメータ」設定でこの挙動を切り替えようとしていた訳です。\u003c/p\u003e\n\n\u003cp\u003e擬似コードで示すと、以下のようなロジックです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e擬似コード\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\n\u003cspan class=\"n\"\u003eparameter\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 出力先パラメータ\u003c/span\u003e\n\u003cspan class=\"n\"\u003eparameter\u003c/span\u003e \u003cspan class=\"n\"\u003efile\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 編集元ファイル\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e \u003cspan class=\"k\"\u003eis\u003c/span\u003e \u003cspan class=\"err\"\u003eブランク\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// １：元ファイルと同じ所に出力。\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003efile\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDirectory\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e \u003cspan class=\"k\"\u003eis\u003c/span\u003e \u003cspan class=\"err\"\u003e絶対パス\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// ２：指定されたパスに出力。\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e \u003cspan class=\"k\"\u003eis\u003c/span\u003e \u003cspan class=\"err\"\u003e相対パス\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// ３：元ファイルのあるフォルダから見た相対パスのサブフォルダに出力。\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003efile\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDirectory\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eで、この「絶対パスか否か」の判定に \u003cstrong\u003ePath.IsPathRooted\u003c/strong\u003e を、\u003cbr\u003e\n「パスの連結」の処理に \u003cstrong\u003ePath.Combine\u003c/strong\u003e を、それぞれ使用した訳です。\u003c/p\u003e\n\n\u003cp\u003e誰だってそーする、俺だってそーする。\u003c/p\u003e\n\n\u003cp\u003eが、結果として\u003cstrong\u003e「相対パス」のつもりで与えていたパラメータに対して、思った通りに動作してくれませんでした。\u003c/strong\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"問題の非直感的な動作に関して\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%95%8F%E9%A1%8C%E3%81%AE%E9%9D%9E%E7%9B%B4%E6%84%9F%E7%9A%84%E3%81%AA%E5%8B%95%E4%BD%9C%E3%81%AB%E9%96%A2%E3%81%97%E3%81%A6\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e■問題の非直感的な動作に関して\u003c/h1\u003e\n\n\u003cp\u003eツールのコードでは問題が解り難くなるので、シンプルな検証コードを書いてきました。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"pathispathrootedの非直感的な動作\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#pathispathrooted%E3%81%AE%E9%9D%9E%E7%9B%B4%E6%84%9F%E7%9A%84%E3%81%AA%E5%8B%95%E4%BD%9C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ePath.IsPathRootedの非直感的な動作\u003c/h2\u003e\n\n\u003cp\u003e幾つかのパス文字列のパターンで検証。\u003c/p\u003e\n\n\u003cp\u003eコメントに書いているのは実行結果ではなく \u003cstrong\u003e「期待する挙動」\u003c/strong\u003e です。\u003cbr\u003e\n★マークが付いているのは \u003cstrong\u003e「実行結果が期待と異なるケース」\u003c/strong\u003e です。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// IsPathRooted でチェックするパス文字列\u003c/span\u003e\n\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003epaths\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e@\"C\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e          \u003cspan class=\"c1\"\u003e// 相対パス\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e@\"C:\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e         \u003cspan class=\"c1\"\u003e// 絶対パス\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e@\"C:\\\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e        \u003cspan class=\"c1\"\u003e// 絶対パス\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e@\"C:\\hoge\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e    \u003cspan class=\"c1\"\u003e// 絶対パス\u003c/span\u003e\n\n    \u003cspan class=\"s\"\u003e@\"moge\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e       \u003cspan class=\"c1\"\u003e// 相対パス\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e@\"\\moge\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e      \u003cspan class=\"c1\"\u003e// 相対パス　★\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e@\"/moge\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e      \u003cspan class=\"c1\"\u003e// 相対パス　★\u003c/span\u003e\n\n    \u003cspan class=\"s\"\u003e@\"\\\\unc\\piyo\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 絶対パス\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e@\"//unc/piyo\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 絶対パス\u003c/span\u003e\n\n    \u003cspan class=\"s\"\u003e@\"http://\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e    \u003cspan class=\"c1\"\u003e// おまけ（一応、絶対パスかなぁ・・・）\u003c/span\u003e\n\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\n\n\n\u003cspan class=\"c1\"\u003e// それぞれのパス文字列に関して、ルートパスか否か判定。\u003c/span\u003e\n\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003emaxlen\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003epaths\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSelect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e \u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eMax\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e \u003cspan class=\"c1\"\u003e//出力整形のため。\u003c/span\u003e\n\u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003epaths\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eisroot\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ePath\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eIsPathRooted\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"s\"\u003e$\"\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ePadRight\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emaxlen\u003c/span\u003e\u003cspan class=\"p\"\u003e)}\u003c/span\u003e\u003cspan class=\"s\"\u003e -\u0026gt; \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eisroot\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこのコードの実行結果がこちら。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003eC          -\u0026gt; False\nC:         -\u0026gt; True\nC:\\        -\u0026gt; True\nC:\\hoge    -\u0026gt; True\nmoge       -\u0026gt; False\n\\moge      -\u0026gt; True　・・・★\n/moge      -\u0026gt; True　・・・★\n\\\\unc\\piyo -\u0026gt; True\n//unc/piyo -\u0026gt; True\nhttp://    -\u0026gt; False\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e上記の通り、★マークを付けた \u003ccode\u003e\\moge\u003c/code\u003e と \u003ccode\u003e/moge\u003c/code\u003e のケースで、こちらの期待とは裏腹に \u003ccode\u003etrue\u003c/code\u003e が返って来ています。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"pathcombineの非直感的な動作\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#pathcombine%E3%81%AE%E9%9D%9E%E7%9B%B4%E6%84%9F%E7%9A%84%E3%81%AA%E5%8B%95%E4%BD%9C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ePath.Combineの非直感的な動作\u003c/h2\u003e\n\n\u003cp\u003eそして、上記 \u003cstrong\u003eIsPathRooted\u003c/strong\u003e と同様に \u003cstrong\u003eCombine\u003c/strong\u003e の方でも非直感的な動作結果となります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\n\u003cspan class=\"c1\"\u003e// Combine で連結するパス文字列\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003epaths\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003epath1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e@\"C:\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e  \u003cspan class=\"n\"\u003epath2\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e@\"Directory\\Folder\"\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n    \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003epath1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e@\"C:\\\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003epath2\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e@\"Directory\\Folder\"\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n    \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003epath1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e@\"C:\\\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003epath2\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e@\"\\Directory\\Folder\"\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003epath1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e@\"C:\\Directory\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e  \u003cspan class=\"n\"\u003epath2\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e@\"Folder\"\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n    \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003epath1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e@\"C:\\Directory\\\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003epath2\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e@\"Folder\"\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n    \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003epath1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e@\"C:\\Directory\\\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003epath2\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e@\"\\Folder\"\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n\n\n    \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003epath1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e@\"C:\\\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e           \u003cspan class=\"n\"\u003epath2\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e@\"Directory\\Folder\\\"\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n    \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003epath1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e@\"C:\\Directory\\\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003epath2\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e@\"Folder\\\"\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\n\n\n\u003cspan class=\"c1\"\u003e// それぞれのパス文字列に関して、連結結果を確認。\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// ※気持ち的には、全てのケースで同じパスになっていて欲しい。\u003c/span\u003e\n\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003emaxlen1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003epaths\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSelect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epath1\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e \u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eMax\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 出力整形のため。\u003c/span\u003e\n\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003emaxlen2\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003epaths\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSelect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epath2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e \u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eMax\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 出力整形のため。\u003c/span\u003e\n\u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ep\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003epaths\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ecombine\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ePath\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCombine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epath1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epath2\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ep1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epath1\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ePadRight\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emaxlen1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ep2\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epath2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ePadRight\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emaxlen2\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"s\"\u003e$\"\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003ep1\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e + \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003ep2\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e =\u0026gt; \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003ecombine\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eソース内コメントに書いてある通り、このテストケースの全てに於いて、ユーザの期待としては \u003ccode\u003eC:\\Directory\\Folder\u003c/code\u003e という同じ結果になって欲しいというのが \u003cstrong\u003e直感的な期待\u003c/strong\u003e となります。\u003c/p\u003e\n\n\u003cp\u003eが、実行結果は以下のようになります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003eC:            + Directory\\Folder  =\u0026gt; C:Directory\\Folder\nC:\\           + Directory\\Folder  =\u0026gt; C:\\Directory\\Folder\nC:\\           + \\Directory\\Folder =\u0026gt; \\Directory\\Folder    ★\n\nC:\\Directory  + Folder            =\u0026gt; C:\\Directory\\Folder\nC:\\Directory\\ + Folder            =\u0026gt; C:\\Directory\\Folder\nC:\\Directory\\ + \\Folder           =\u0026gt; \\Folder              ★\n\nC:\\           + Directory\\Folder\\ =\u0026gt; C:\\Directory\\Folder\\\nC:\\Directory\\ + Folder\\           =\u0026gt; C:\\Directory\\Folder\\\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e末尾の \u003ccode\u003e\\\u003c/code\u003e の有り無しはまぁ置いといて。\u003c/p\u003e\n\n\u003cp\u003e★マークを付けた２ケースに於いて、\u003cstrong\u003e期待とは異なる残念な結果\u003c/strong\u003e になっています。\u003cbr\u003e\n\u003cem\u003e（一応明記しとくと、バグッてる訳じゃなく、仕様通りの挙動だそうです）\u003c/em\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"pathのmsdnリファレンス\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#path%E3%81%AEmsdn%E3%83%AA%E3%83%95%E3%82%A1%E3%83%AC%E3%83%B3%E3%82%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e■PathのMSDNリファレンス\u003c/h1\u003e\n\n\u003cp\u003eでは、MSDNのリファレンスを確認してみましょう。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"pathispathrooted\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#pathispathrooted\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ePath.IsPathRooted\u003c/h2\u003e\n\n\u003cp\u003e\u003cqiita-embed-ogp src=\"https://msdn.microsoft.com/ja-jp/library/system.io.path.ispathrooted(v=vs.110).aspx\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eメソッド概要：\u003c/strong\u003e\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e指定したパス文字列にルートが含まれているかどうかを示す値を取得します。\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e\u003cstrong\u003e戻り値：\u003c/strong\u003e\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003epath にルートが含まれている場合は true。それ以外の場合は false。\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eそうです。\u003cbr\u003e\n「パスにルートが含まれているか否かを判定する」と書いてありますが、\u003cbr\u003e\n「絶対パスか相対パスかを判定する」とは書かれていないのです。\u003c/p\u003e\n\n\u003cp\u003e\u003cem\u003e※ここで言う「ルート」ってのが具体的に何の事を意味しているのか、と言うのが重要になりますね。正直、定義が良く解りませんが。\u003c/em\u003e\u003c/p\u003e\n\n\u003cp\u003e「パスが絶対パスか相対パスか調べたい」と言う要件でぐぐると、割りとすぐに「IsPathRootedメソッドを使え」と言う情報がヒットしますが、 \u003cstrong\u003eこのメソッドは絶対パスか相対パスかを判定するためのものではない\u003c/strong\u003e と言うのが落とし穴になっている訳です。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"pathcombine\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#pathcombine\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ePath.Combine\u003c/h2\u003e\n\n\u003cp\u003e\u003cqiita-embed-ogp src=\"https://msdn.microsoft.com/ja-jp/library/fyy7a5kt(v=vs.110).aspx\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eメソッド概要：\u003c/strong\u003e\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e2 つの文字列を 1 つのパスに結合します。\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e\u003cstrong\u003e戻り値：\u003c/strong\u003e\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e結合されたパス。\u003cbr\u003e\n指定したパスの 1 つが長さ 0 の文字列の場合、このメソッドは別のパスを返します。 path2 に絶対パスが含まれる場合、このメソッドは path2 を返します。\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e重要なのが、戻り値の説明に書かれた二文目の内容です。\u003c/p\u003e\n\n\u003cp\u003e「絶対パスが含まれる場合」とあります。\u003c/p\u003e\n\n\u003cp\u003e何となく動作結果から予想付いてましたが、ここでは \u003cstrong\u003eIsPathRooted\u003c/strong\u003e で判定している\u003cem\u003e（若しくはそれと同等の判定処理がある）\u003c/em\u003e事が伺えますね。\u003c/p\u003e\n\n\u003cp\u003e\u003cem\u003e※せっかくIsPathRootedメソッドの説明では「絶対パスか否か」と言う名言を避けていたのに、それを使っているCombineメソッドの方で「絶対パスが」と言っちゃってるのは、何と言うかちょっとアレですねって言う話。これではどちらかの説明、或いは実装が誤っていると言わざるを得ない。\u003c/em\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"余談\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BD%99%E8%AB%87\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e余談\u003c/h3\u003e\n\n\u003cp\u003eCombineの備考欄に何やら重要っぽい事が書かれてるみたいなんですが、どうも機械翻訳がいまいちイケてないみたいなので、あとで英語の原文を読んでみようかと思います。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"pathクラス実装のコードリーディング\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#path%E3%82%AF%E3%83%A9%E3%82%B9%E5%AE%9F%E8%A3%85%E3%81%AE%E3%82%B3%E3%83%BC%E3%83%89%E3%83%AA%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e■Pathクラス実装のコードリーディング\u003c/h1\u003e\n\n\u003cp\u003e予想だけで記事を書いてもしょうがないので、実際に実装コードを読んでみましょう。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"pathispathrooted-1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#pathispathrooted-1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ePath.IsPathRooted\u003c/h2\u003e\n\n\u003cp\u003eまず、問題の \u003cstrong\u003eIsPathRooted\u003c/strong\u003e 先生。\u003c/p\u003e\n\n\u003cp\u003e\u003cqiita-embed-ogp src=\"http://referencesource.microsoft.com/#mscorlib/system/io/path.cs,807960f08fca497d\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ePath.IsPathRooted\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003elength\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eDirectorySeparatorChar\u003c/span\u003e \u003cspan class=\"p\"\u003e||\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eAltDirectorySeparatorChar\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e||\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elength\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;=\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eVolumeSeparatorChar\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eという判定処理がありますね。\u003c/p\u003e\n\n\u003cp\u003eショートコーディング風でちょっと解り難いので、読み易く同等な処理として書き換えてみます。\u003c/p\u003e\n\n\u003cp\u003eまずは単純にコード整形。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ePath.IsPathRooted（整形後）\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elength\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eDirectorySeparatorChar\u003c/span\u003e        \u003cspan class=\"c1\"\u003e// '\\'\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e||\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eAltDirectorySeparatorChar\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// '/'\u003c/span\u003e\n\n  \u003cspan class=\"p\"\u003e||\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elength\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;=\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eVolumeSeparatorChar\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e          \u003cspan class=\"c1\"\u003e// ':'\u003c/span\u003e\n\n                    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eif文の中身がぐちゃぐちゃして気に食わないので、等価なコードに書き換え。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ePath.IsPathRooted（リファクタリング）\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\n\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003elength\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// 先頭の文字が '\\' 若しくは '/' の場合、絶対パスと判定。\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eDirectorySeparatorChar\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e||\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eAltDirectorySeparatorChar\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003elength\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;=\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// 二文字目が ':' の場合、絶対パスと判定。\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003elength\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;=\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eVolumeSeparatorChar\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// 上記２パターン以外は全て相対パスと判定。\u003c/span\u003e\n\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e実装コード内の \u003ccode\u003elength\u003c/code\u003e に関しては、単に \u003cstrong\u003eIndexOutOfRangeException\u003c/strong\u003e に対するガードとしての機能しか無いので、ぶっちゃけ贅肉ですね。\u003c/p\u003e\n\n\u003cp\u003e例えば拡張メソッドを使って以下のように書き換えちゃえばコードがスッキリします。（個人的な趣味）\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e拡張メソッド\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"nf\"\u003eat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"n\"\u003ealter\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"sc\"\u003e'\\0'\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003etail\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003etail\u003c/span\u003e \u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003ealter\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e拡張メソッドatを用いて書き換えたコード\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e            \u003cspan class=\"c1\"\u003e// 先頭の文字が '\\' 若しくは '/' の場合、絶対パスと判定。\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"n\"\u003ec1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003ec1\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eDirectorySeparatorChar\u003c/span\u003e\n              \u003cspan class=\"p\"\u003e||\u003c/span\u003e \u003cspan class=\"n\"\u003ec1\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eAltDirectorySeparatorChar\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// 二文字目が ':' の場合、絶対パスと判定。\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"n\"\u003ec2\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003ec2\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eVolumeSeparatorChar\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// 上記２パターン以外は全て相対パスと判定。\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003cem\u003e※拡張メソッドが有りなら普通に FirstOrDefault 使えばいいじゃーん、って言う話もある。\u003c/em\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"pathcombine-1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#pathcombine-1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ePath.Combine\u003c/h2\u003e\n\n\u003cp\u003e次に、内部的に \u003cstrong\u003eIsPathRooted\u003c/strong\u003e を呼び出していると予想される \u003cstrong\u003eCombine\u003c/strong\u003e 先生。\u003c/p\u003e\n\n\u003cp\u003e\u003cqiita-embed-ogp src=\"http://referencesource.microsoft.com/#mscorlib/system/io/path.cs,2d7263f86a526264\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\n\u003cp\u003eが、呼び出しているコア処理の \u003cstrong\u003eCombineNoChecks\u003c/strong\u003e さん。\u003c/p\u003e\n\n\u003cp\u003e\u003cqiita-embed-ogp src=\"http://referencesource.microsoft.com/#mscorlib/system/io/path.cs,16ed6da326ce4745\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ePath.CombineNoChecks\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nf\"\u003eIsPathRooted\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epath2\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003epath2\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eハイ、予想通りいましたね。\u003c/p\u003e\n\n\u003cp\u003eMSDNに記載されていた「path2 に絶対パスが含まれる場合、このメソッドは path2 を返します」は、このコードを和訳したようなものです。\u003c/p\u003e\n\n\u003cp\u003eよりストレートに言えば \u003cstrong\u003eIsPathRooted\u003c/strong\u003e が \u003ccode\u003etrue\u003c/code\u003e になる場合、このメソッドは \u003ccode\u003epath2\u003c/code\u003e を返します、だ。\u003c/p\u003e\n\n\u003cp\u003e繰り返しますが、 \u003cstrong\u003eIsPathRooted\u003c/strong\u003e の説明では「絶対パスか否か」を判定するとは言っておらず、「パスにルートを含むか否か」という表現でした。\u003cbr\u003e\nしかし、これを利用しており、それ以外の条件が付与されていない実装である \u003cstrong\u003eCombine\u003c/strong\u003e の説明では「絶対パスが含まれる場合」と言っているので、間接的に \u003cstrong\u003eIsPathRooted\u003c/strong\u003e は絶対パスか否かを判定する（目的で使用される）と言っている訳です。\u003c/p\u003e\n\n\u003cp\u003eうーん、、、これって一体・・・。^^;\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"所感\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%89%80%E6%84%9F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e■所感\u003c/h1\u003e\n\n\u003cp\u003eバグか否かという議論は一旦棚上げにしておくとしても、この \u003cstrong\u003eIsPathRooted\u003c/strong\u003e の挙動は \u003cstrong\u003e非直感的\u003c/strong\u003e であり \u003cstrong\u003e一般的な用途に対して不都合がある\u003c/strong\u003e 実装だと思います。\u003c/p\u003e\n\n\u003cp\u003eそして、これがIsPathRootedだけの話であれば良かった。\u003cbr\u003e\n「絶対パスか否かを判定する」目的のユーティリティを普通に自作して Path.IsPathRooted の使用を開発規約で非推奨にしちまえば話は簡単。\u003cbr\u003e\nしかし、Combineが内部でIsPathRootedを使用しているので、芋蔓でそっちも書き換えたくなると言うのが厄介な所。\u003c/p\u003e\n\n\u003cp\u003eしかもCombineの方は実装が深い上に可変パラメータに対応する為に結構コテコテ書かれているので、代替するメソッドを用意するのも面倒くさい、というね。\u003c/p\u003e\n\n\u003cp\u003eぶっちゃけた話、IsPathRootedが業務開発で出て来る事なんて稀なんで、割りとどうだって良いかなって感じですが、Combineに関しては出て来ない方がむしろ珍しいまである頻出メソッドです。\u003cbr\u003e\nこっちの方が問題としては結構厄介ですよね。\u003c/p\u003e\n\n\u003cp\u003e冒頭でチラッと言いましたけど\u003cstrong\u003e「C#でパス結合するならPath.Combineを使うのが常識だ」\u003c/strong\u003eというのは良く言われる事だと思います。\u003cbr\u003e\n数多くの入門サイトでも、この方法が強く推奨されていたり、この実装が一般的だからこれに合わせなさいと書かれていたりする事が殆どです。\u003cbr\u003e\nあまりにも常識として定着し過ぎており、それを疑ったり検証する事すら稀なレベルなので、お恥ずかしながら自分も今日に至るまでこの問題に気付きませんでした。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"まとめ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e■まとめ\u003c/h1\u003e\n\n\u003cp\u003e自分達の実装しようとしている「目的」に対して、Combine・IsPathRootedの「仕様」がマッチしているかどうか、「手段」として妥当かどうかをきちんと確認しましょう。\u003c/p\u003e\n\n\u003cp\u003eそして、悲しいかなそれが手段として妥当でないという結論に至った場合、プロジェクト内の共通実装としてユーティリティを用意して、それを使うように周知徹底しましょう。\u003c/p\u003e\n\n\u003cp\u003e\u003cem\u003e※代替となる実装手段は幾つかヒットしますが、既存のライブラリ実装の組み合わせではどれも微妙なクセがあるので、素直に文字列操作として自作するのが良さそうです、、、。\u003c/em\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"参考文献\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e■参考文献\u003c/h1\u003e\n\n\u003cp\u003e\u003cqiita-embed-ogp src=\"http://oita.oika.me/2013/02/23/dotnet_path/\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"ちょっと追記\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%A1%E3%82%87%E3%81%A3%E3%81%A8%E8%BF%BD%E8%A8%98\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e■ちょっと追記。\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"javaだとどうなるか\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#java%E3%81%A0%E3%81%A8%E3%81%A9%E3%81%86%E3%81%AA%E3%82%8B%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eJavaだとどうなるか？\u003c/h2\u003e\n\n\u003cp\u003e気になったので、JShellを起動してJavaだとどうなるか試してみた。\u003c/p\u003e\n\n\u003cp\u003e相当機能としてはPaths#getだと思うのでこいつを使ってみる。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/3462148894f2d36b6a6878e4f5a69eed5adf3737/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3137303334372f62386339643930642d616335622d636337622d323731372d3762663930356236336531642e6a706567\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F170347%2Fb8c9d90d-ac5b-cc7b-2717-7bf905b63e1d.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=c149f1acbb3ef6cd529547dab750d63b\" alt=\"WS000156.JPG\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/170347/b8c9d90d-ac5b-cc7b-2717-7bf905b63e1d.jpeg\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F170347%2Fb8c9d90d-ac5b-cc7b-2717-7bf905b63e1d.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=74fedd163d7fdb0d9725db8182de0ef0 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e期待通りにパスが連結されました。\u003c/p\u003e\n\n\u003cp\u003e求めている挙動はこういう挙動なので、この目的ではPath.Combineは使えないですね。\u003c/p\u003e\n","createdAt":"2017-10-21T05:24:31Z","elapsedYearsFromLastModifiedAt":3,"encryptedId":"I+dSdvSlCQQecAnpIXvgPkEFyIraCkYk--9gAOGkE9q38SBMrK--sRDDKuenH9EuJZD39qm01w==","isBanned":false,"isDeprecated":true,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2017-10-21T06:02:01Z","likesCount":11,"linkUrl":"https://qiita.com/sugaryo/items/fc8d7553e59d671ac10c","organization":null,"originalId":533863,"stockedCount":11,"title":"【C#】Path.Combine（正確にはPath.IsPathRooted）で非直感的な動作にハマったのでまとめ。","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%84%E3%82%8A%E3%81%9F%E3%81%8B%E3%81%A3%E3%81%9F%E4%BA%8B%E3%81%A8%E3%83%8F%E3%83%9E%E3%81%A3%E3%81%9F%E6%89%80\"\u003e■やりたかった事と、ハマった所\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%84%E3%82%8A%E3%81%9F%E3%81%8B%E3%81%A3%E3%81%9F%E3%81%93%E3%81%A8\"\u003eやりたかったこと\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%BD%BF%E3%81%A3%E3%81%9F%E3%82%82%E3%81%AE\"\u003e使ったもの\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%84%E3%83%BC%E3%83%AB%E3%81%AE%E6%A6%82%E8%A6%81%E3%81%A8%E3%83%8F%E3%83%9E%E3%81%A3%E3%81%9F%E3%81%93%E3%81%A8\"\u003eツールの概要とハマったこと\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%95%8F%E9%A1%8C%E3%81%AE%E9%9D%9E%E7%9B%B4%E6%84%9F%E7%9A%84%E3%81%AA%E5%8B%95%E4%BD%9C%E3%81%AB%E9%96%A2%E3%81%97%E3%81%A6\"\u003e■問題の非直感的な動作に関して\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#pathispathrooted%E3%81%AE%E9%9D%9E%E7%9B%B4%E6%84%9F%E7%9A%84%E3%81%AA%E5%8B%95%E4%BD%9C\"\u003ePath.IsPathRootedの非直感的な動作\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#pathcombine%E3%81%AE%E9%9D%9E%E7%9B%B4%E6%84%9F%E7%9A%84%E3%81%AA%E5%8B%95%E4%BD%9C\"\u003ePath.Combineの非直感的な動作\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#path%E3%81%AEmsdn%E3%83%AA%E3%83%95%E3%82%A1%E3%83%AC%E3%83%B3%E3%82%B9\"\u003e■PathのMSDNリファレンス\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#pathispathrooted\"\u003ePath.IsPathRooted\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#pathcombine\"\u003ePath.Combine\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%BD%99%E8%AB%87\"\u003e余談\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#path%E3%82%AF%E3%83%A9%E3%82%B9%E5%AE%9F%E8%A3%85%E3%81%AE%E3%82%B3%E3%83%BC%E3%83%89%E3%83%AA%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0\"\u003e■Pathクラス実装のコードリーディング\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#pathispathrooted-1\"\u003ePath.IsPathRooted\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#pathcombine-1\"\u003ePath.Combine\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%89%80%E6%84%9F\"\u003e■所感\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"\u003e■まとめ\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE\"\u003e■参考文献\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%A1%E3%82%87%E3%81%A3%E3%81%A8%E8%BF%BD%E8%A8%98\"\u003e■ちょっと追記。\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#java%E3%81%A0%E3%81%A8%E3%81%A9%E3%81%86%E3%81%AA%E3%82%8B%E3%81%8B\"\u003eJavaだとどうなるか？\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":12751,"uuid":"fc8d7553e59d671ac10c","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"qqjphRIB5Ud25hlDqX7w2qZp8nlL--vAPIXHSAxSEWYyGK--1d/4OrvLhcGYNjUJtpBmyA==","originalId":170347,"description":"缶コーヒーを原料にしてプログラムを吐き出すお仕事をしています。","facebookUrl":null,"githubUrl":"https://github.com/sugaryo","isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"すがりょー。 １２２４","profileImageUrl":"https://qiita-image-store.s3.amazonaws.com/0/170347/profile-images/1502688507","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F170347%2Fprofile-images%2F1502688507?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=3e745a1b6ecbcd1782e8106adab43d90","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F170347%2Fprofile-images%2F1502688507?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=a596fd39cc77f63d5ba3004bff0087e3","urlName":"sugaryo","websiteUrl":"","twitterUrl":"https://twitter.com/sugaryo1224","twitterUrlName":"sugaryo1224","revealedOrganizations":{"edges":[]}},"tags":[{"name":"C#","urlName":"csharp"},{"name":"path","urlName":"path"}],"followingLikers":{"edges":[]},"comments":{"totalCount":7}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

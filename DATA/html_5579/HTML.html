<!DOCTYPE html><html><head><meta charset="utf-8" /><title>LINE の Bot 開発 C# 超入門（後編） メッセージの内容と文脈を意識した会話を実現する - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/kenakamu/items/ac4922a2061f4f8f02d9" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="gE+8sr7ulxbmudBPm1TqNOvaPxaMgVOBHrPQipd9GLuerrXhzlYl5bxDU5tDc0VjRRpWTwNnxz44Y/1ZSLxltA==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta content="@kenakamu108" name="twitter:creator" /><meta property="og:type" content="article"><meta property="og:title" content="LINE の Bot 開発 C# 超入門（後編） メッセージの内容と文脈を意識した会話を実現する - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1URWxPUlNEamdhNGdRbTkwSU9tV2ktZVp1aUJESXlEb3RvWGxoYVhwbG9EdnZJamx2b3pudDZqdnZJa2c0NE9oNDRPRDQ0Szc0NE84NDRLNDQ0R3U1WWFGNWE2NTQ0R281cGFINklTSTQ0S1M1b1NQNksyWTQ0R1g0NEdmNUx5YTZLbXg0NEtTNWE2ZjU0LS00NEdaNDRLTCZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTU0JnR4dC1jbGlwPWVsbGlwc2lzJnR4dC1hbGlnbj1jZW50ZXIlMkNtaWRkbGUmcz0yYmFhNmU5YzIyYzBhZmE0MmMyNGU4ZDk5ZGExOGI0ZA&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RR3RsYm1GcllXMTEmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT00NSZ0eHQtYWxpZ249cmlnaHQlMkNib3R0b20mcz01OGYxNmIxNjQwMGM4NzkwNWFlMWZlNWE3MTFiYjdmMA&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=70eac1b6c456298f9422f3138b2f1b2e"><meta property="og:description" content="LINE の Bot 開発 C# 超入門（後編） メッセージの内容と文脈を意識した会話を実現する

前編に続いて Bot を開発していきます。今回は自然言語解析を用いたメッセージの理解と、文脈に応じて対話をおこなうところまでをカバーし..."><meta content="https://qiita.com/kenakamu/items/ac4922a2061f4f8f02d9" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#,Line,bot,linebot,LINEmessagingAPI" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 1nzh4zz 38fzdi helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds ne2zqn k008qs 1lbjcyg cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-1nzh4zz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:16px 32px;background-color:#FBE69E;color:rgba(0,0,0,0.87);line-height:1.5;font-weight:600;}@media (max-width:770px){.css-1nzh4zz{padding:16px;}}.css-38fzdi{color:#CA832A;margin-right:4px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}@media (max-width:770px){.css-ne2zqn{margin-top:4px;}}.css-k008qs{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}.css-1lbjcyg{box-shadow:0 0 0 1px rgba(0,0,0,0.12) inset;color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:180%;padding:0px 4px;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-25d4313f-1653-4887-bf29-0e74ddd08be3"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Fkenakamu%2Fitems%2Fac4922a2061f4f8f02d9">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Fkenakamu%2Fitems%2Fac4922a2061f4f8f02d9">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-25d4313f-1653-4887-bf29-0e74ddd08be3">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2018-01-21T03:09:59.000+09:00","dateModified":"2018-02-23T11:09:08.000+09:00","headline":"LINE の Bot 開発 C# 超入門（後編） メッセージの内容と文脈を意識した会話を実現する","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1URWxPUlNEamdhNGdRbTkwSU9tV2ktZVp1aUJESXlEb3RvWGxoYVhwbG9EdnZJamx2b3pudDZqdnZJa2c0NE9oNDRPRDQ0Szc0NE84NDRLNDQ0R3U1WWFGNWE2NTQ0R281cGFINklTSTQ0S1M1b1NQNksyWTQ0R1g0NEdmNUx5YTZLbXg0NEtTNWE2ZjU0LS00NEdaNDRLTCZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTU0JnR4dC1jbGlwPWVsbGlwc2lzJnR4dC1hbGlnbj1jZW50ZXIlMkNtaWRkbGUmcz0yYmFhNmU5YzIyYzBhZmE0MmMyNGU4ZDk5ZGExOGI0ZA\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RR3RsYm1GcllXMTEmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT00NSZ0eHQtYWxpZ249cmlnaHQlMkNib3R0b20mcz01OGYxNmIxNjQwMGM4NzkwNWFlMWZlNWE3MTFiYjdmMA\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=70eac1b6c456298f9422f3138b2f1b2e","mainEntityOfPage":"https://qiita.com/kenakamu/items/ac4922a2061f4f8f02d9","author":{"@type":"Person","address":"","email":null,"identifier":"kenakamu","name":"kenakamu","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Favatars2.githubusercontent.com%2Fu%2F9940668%3Fv%3D4?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=ba853bb83e6142e6ea6854e823ed9241","url":"https://qiita.com/kenakamu","description":"","memberOf":[{"@type":"Organization","address":"東京都港区港南 2-16-3 品川グランドセントラルタワー","legalName":"Microsoft","image":"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/ea6419590e16b14d294eb89ade7dde2c63263c36/original.jpg?1583721865","logo":"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/bae6d3a0828c019ff259cdb47a8988c98636389f/original.jpg?1583721865","identifier":"microsoft","description":"マイクロソフトのメンバーがMicrosoft Azureをはじめとする最新技術情報をお届けします。Twitterアカウント（@msdevjp）やYouTubeチャンネル「クラウドデベロッパーちゃんねる」も運用中です。"}]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://zine.qiita.com/interview/202107-line-growth-technology/?utm_source=qiita&amp;utm_medium=header-banner">運用ではなくサービス運営の課題解決。LINE Growth Technologyに聞くGrowth開発</a><a target="_blank" id="header_text_message_2" href="https://zine.qiita.com/interview/202107-line-growth-technology/?utm_source=qiita&amp;utm_medium=header-banner">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"kenakamu","type":"items","id":"ac4922a2061f4f8f02d9"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"運用ではなくサービス運営の課題解決。LINE Growth Technologyに聞くGrowth開発","url":"https://zine.qiita.com/interview/202107-line-growth-technology/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"kenakamu","type":"items","id":"ac4922a2061f4f8f02d9"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":0,"pos_id":"header_text_message_1","message":"運用ではなくサービス運営の課題解決。LINE Growth Technologyに聞くGrowth開発","url":"https://zine.qiita.com/interview/202107-line-growth-technology/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"kenakamu","type":"items","id":"ac4922a2061f4f8f02d9"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":0,"pos_id":"header_text_message_2","message":"運用ではなくサービス運営の課題解決。LINE Growth Technologyに聞くGrowth開発","url":"https://zine.qiita.com/interview/202107-line-growth-technology/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/kenakamu/items/ac4922a2061f4f8f02d9","location":"/kenakamu/items/ac4922a2061f4f8f02d9","scheme":"https","host":"qiita.com","port":null,"pathname":"/kenakamu/items/ac4922a2061f4f8f02d9","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"SuC1QGBsf+t5NTSOIgdGWYGKU01BSTVGzDO4H3RSbdZUAbwTENTNGCPPt1r6IOkOL0o6FM6vofnq45XMq5MQ2Q==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-3dd73f0b-2cdf-45c1-8ce6-d75b0cd14f6b"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/kenakamu/items/ac4922a2061f4f8f02d9/likers" class="css-1iupg5d">19</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">19</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/ac4922a2061f4f8f02d9/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/kenakamu/items/ac4922a2061f4f8f02d9/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/kenakamu/items/ac4922a2061f4f8f02d9/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/kenakamu/items/ac4922a2061f4f8f02d9/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/kenakamu/items/ac4922a2061f4f8f02d9.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-1nzh4zz"><span class="fa fa-fw fa-warning css-38fzdi"></span><p>More than 3 years have passed since last update.</p></div><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/kenakamu"><img class="css-100alwu eyfquo10" src="https://avatars2.githubusercontent.com/u/9940668?v=4" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/kenakamu" class="css-10ougpm">@<!-- -->kenakamu</a><a href="/organizations/microsoft" class="css-10ougpm">(<!-- -->Microsoft<!-- -->)</a><div class="css-1ay9vb9"><span><meta content="2018-01-20T18:09:59Z"/><time dateTime="2018-02-23T02:09:08Z" class="css-m19uds">updated at 2018-02-23</time></span></div></div></div><div class="css-ne2zqn"><div class="css-k008qs"><div class="css-1lbjcyg">Organization</div></div></div></div></div><h1 class="css-cgzq40">LINE の Bot 開発 C# 超入門（後編） メッセージの内容と文脈を意識した会話を実現する</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/line" class="css-4czcte">Line</a><a href="/tags/bot" class="css-4czcte">bot</a><a href="/tags/linebot" class="css-4czcte">linebot</a><a href="/tags/linemessagingapi" class="css-4czcte">LINEmessagingAPI</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div><p>LINE の Bot 開発 C# 超入門（後編） メッセージの内容と文脈を意識した会話を実現する</p>

<p><a href="https://qiita.com/kenakamu/items/e0b194a82e4141b30c95" id="reference-87106748ee193eaca874">前編</a>に続いて Bot を開発していきます。今回は自然言語解析を用いたメッセージの理解と、文脈に応じて対話をおこなうところまでをカバーします。</p>

<h1>
<span id="開発の流れ" class="fragment"></span><a href="#%E9%96%8B%E7%99%BA%E3%81%AE%E6%B5%81%E3%82%8C"><i class="fa fa-link"></i></a>開発の流れ</h1>

<ul>
<li>自然言語解析サービスの Language Understanding Intelligent Service (LUIS) を設定し、理解すべきメッセージを理解できるように学習させます。</li>
<li>Bot が受け取ったメッセージを LUIS と連携してユーザーの意図を判定できるようにします。</li>
<li>文脈に応じて対話するための機能を Bot に盛り込みます。</li>
</ul>

<h1>
<span id="手順" class="fragment"></span><a href="#%E6%89%8B%E9%A0%86"><i class="fa fa-link"></i></a>手順</h1>

<h2>
<span id="自然言語解析の設定" class="fragment"></span><a href="#%E8%87%AA%E7%84%B6%E8%A8%80%E8%AA%9E%E8%A7%A3%E6%9E%90%E3%81%AE%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>自然言語解析の設定</h2>

<p>LUIS はマイクロソフトの自然言語処理のサービスです。ユーザーが発話した文章が何を意図しているのかを特定するために利用します。また、その文章の中からパラメーターを抽出する機能も備えています。</p>

<p>1 下記 LUIS のサイトにアクセスしてマイクロソフトアカウントでログインします。<br>
<a href="https://www.luis.ai" rel="nofollow noopener" target="_blank">LUIS https://www.luis.ai</a><br>
<a href="https://camo.qiitausercontent.com/d46eb0e243655ceb333187690068dab6f4e04149/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3231343131362f36383834343832342d623233392d363366612d323666632d3434643233653033363362302e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2F68844824-b239-63fa-26fc-44d23e0363b0.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=ab64b7d0322d8a4188eb22d8253af6a0" alt="Screen Shot 2018-01-20 at 1.15.04 AM.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/214116/68844824-b239-63fa-26fc-44d23e0363b0.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2F68844824-b239-63fa-26fc-44d23e0363b0.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=01cd692c3b8f404fa820ed67db98ccef 1x" loading="lazy"></a></p>

<p>2 ログインしたら Create new app をクリックし、設定します。Culture は後から変えられないので注意。<br>
    - Name: 任意<br>
    - Culture: Japanese</p>

<p>3 まず Entity を登録します。Entity は文章の中から抜き出したい項目として扱います。左サイドバーから Entities を選択し、Create new entity をクリックします。<br><a href="https://camo.qiitausercontent.com/69f1fac78c3b409bed3a48708028f6da895213fc/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3231343131362f37636337646632322d363435302d396566372d356134372d3633313034343633343233622e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2F7cc7df22-6450-9ef7-5a47-63104463423b.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=27fe68aaf5c1dbac62f6a5f4350578d6" alt="Screen Shot 2018-01-20 at 1.29.45 AM.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/214116/7cc7df22-6450-9ef7-5a47-63104463423b.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2F7cc7df22-6450-9ef7-5a47-63104463423b.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=2c26add8d5e580a6346ca9b5d1ade479 1x" loading="lazy"></a></p>

<p>4 名前を menu、タイプを Simple で作成します。<br><a href="https://camo.qiitausercontent.com/e419e98f91a4bc3c73a0f72d41127fc036001ce3/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3231343131362f34326362316566332d646435622d616663662d306534352d3464623538646464616366352e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2F42cb1ef3-dd5b-afcf-0e45-4db58dddacf5.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=51770218b97783bb7bfd6b06d5bb1d80" alt="Screen Shot 2018-01-20 at 1.36.46 AM.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/214116/42cb1ef3-dd5b-afcf-0e45-4db58dddacf5.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2F42cb1ef3-dd5b-afcf-0e45-4db58dddacf5.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=bb533d397959011b414880d3c14271e5 1x" loading="lazy"></a></p>

<p>5 次に Intent を登録します。Intent は文章の意図です。左のサイドバーから Intents を選択し、Create new intent をクリックします。名前を order として作成します。</p>

<p>6 例文 (Utterance) として「松をお願いします。」と入力して Enter を押下します。追加された例文の「松」をクリックして「menu」を選択します。<br><a href="https://camo.qiitausercontent.com/e7ea9fb421e6d4e43b17761ace6e7bcb27298927/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3231343131362f30303130623064392d613234372d303662382d663537612d6564383662643233656463612e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2F0010b0d9-a247-06b8-f57a-ed86bd23edca.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=8d2ef756195a834432fad0884df3c2ab" alt="Screen Shot 2018-01-20 at 1.48.42 AM.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/214116/0010b0d9-a247-06b8-f57a-ed86bd23edca.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2F0010b0d9-a247-06b8-f57a-ed86bd23edca.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=d7a375cfa541b4821a520e3cd1785dfa 1x" loading="lazy"></a></p>

<p>7 松が menu と変更されます。<br><a href="https://camo.qiitausercontent.com/a14b036b0e13a6868a91a1fa29d31380c9c380fe/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3231343131362f62633963393030322d666139332d666662632d366136362d3134663765633030346533632e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2Fbc9c9002-fa93-ffbc-6a66-14f7ec004e3c.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=a01ef64906068d65cd896a86d009e5ac" alt="Screen Shot 2018-01-20 at 1.50.06 AM.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/214116/bc9c9002-fa93-ffbc-6a66-14f7ec004e3c.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2Fbc9c9002-fa93-ffbc-6a66-14f7ec004e3c.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=883d27a91cb7fb13e3a7f19f1e7a086a 1x" loading="lazy"></a></p>

<p>8 同じように例題を合計で 5 つ入れます。<br><a href="https://camo.qiitausercontent.com/33dda977079f295fe36f06923aa03beb8f22e6a8/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3231343131362f62363933383862372d366330372d663561362d363639302d6162393938373166336432632e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2Fb69388b7-6c07-f5a6-6690-ab99871f3d2c.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=09c1d261dd6971484052d8ff4a69c5c7" alt="Screen Shot 2018-01-20 at 1.54.03 AM.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/214116/b69388b7-6c07-f5a6-6690-ab99871f3d2c.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2Fb69388b7-6c07-f5a6-6690-ab99871f3d2c.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=8faf0f329380988d7b530e3eada144a0 1x" loading="lazy"></a></p>

<p>9 次に greeting という名前で Intent を追加します。</p>

<p>10 例文として 5 つ以上挨拶を登録します。<br><a href="https://camo.qiitausercontent.com/4b07b6b5eb46a9a69107a2958f437b4513c4bbd5/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3231343131362f33346639646463352d356130622d626561312d616432652d6139313462336536656134642e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2F34f9ddc5-5a0b-bea1-ad2e-a914b3e6ea4d.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=aa1552b706af78120877839952a75bb8" alt="Screen Shot 2018-01-20 at 5.42.30 AM.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/214116/34f9ddc5-5a0b-bea1-ad2e-a914b3e6ea4d.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2F34f9ddc5-5a0b-bea1-ad2e-a914b3e6ea4d.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=a354eee00cb7a642ce9ed1b660a06234 1x" loading="lazy"></a></p>

<p>11 最後に Train ボタンをクリックして学習させます。<br><a href="https://camo.qiitausercontent.com/eda61a861a4cd629405f0fe83a1e0acd78b2e218/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3231343131362f32656538656231662d616162342d333134362d356532362d3533653430343838346562332e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2F2ee8eb1f-aab4-3146-5e26-53e404884eb3.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=17a7652eab1d507d7168872e03da47cc" alt="Screen Shot 2018-01-20 at 1.57.08 AM.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/214116/2ee8eb1f-aab4-3146-5e26-53e404884eb3.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2F2ee8eb1f-aab4-3146-5e26-53e404884eb3.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=338f4f9eaad352d2974ce1784bdd0ae6 1x" loading="lazy"></a></p>

<p>これで LUIS の学習は完了です。以下の手順で呼び出すためのキーとアドレスを取得します。</p>

<h2>
<span id="luis-の公開とキーの取得" class="fragment"></span><a href="#luis-%E3%81%AE%E5%85%AC%E9%96%8B%E3%81%A8%E3%82%AD%E3%83%BC%E3%81%AE%E5%8F%96%E5%BE%97"><i class="fa fa-link"></i></a>LUIS の公開とキーの取得</h2>

<p>1 上部メニューより PUBLISH を選択します。<br><a href="https://camo.qiitausercontent.com/e0859b4975ee19a26553fb83479bcf302d5b45b6/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3231343131362f65333865313161332d666537352d366331652d393062382d6335643830646237316132652e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2Fe38e11a3-fe75-6c1e-90b8-c5d80db71a2e.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=e4fb6ebf06bfde54cdbcfb4513da1261" alt="Screen Shot 2018-01-20 at 5.02.40 AM.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/214116/e38e11a3-fe75-6c1e-90b8-c5d80db71a2e.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2Fe38e11a3-fe75-6c1e-90b8-c5d80db71a2e.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=75b8775f5c560ab9a03fd9c5ca2f702c 1x" loading="lazy"></a></p>

<p>2 Publish to production slot をクリックして公開します。<a href="https://camo.qiitausercontent.com/4601573bdd1c3dc1e4fd4cb35afbadef9c40442f/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3231343131362f33326539326438392d363563392d393634322d313436392d3632393736363334653932652e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2F32e92d89-65c9-9642-1469-62976634e92e.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=5283fe5c9606ae9255b097e841ba50f1" alt="Screen Shot 2018-01-20 at 5.16.46 AM.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/214116/32e92d89-65c9-9642-1469-62976634e92e.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2F32e92d89-65c9-9642-1469-62976634e92e.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=773d196d00e2628969ccde3f4447036c 1x" loading="lazy"></a></p>

<p>3 画面下部に出るキーをコピーしておきます。</p>

<p>4 上部メニューより SETTINGS を選択して、画面に表示される Application ID をコピーしておきます。</p>

<h1>
<span id="bot-に自然言語解析の追加" class="fragment"></span><a href="#bot-%E3%81%AB%E8%87%AA%E7%84%B6%E8%A8%80%E8%AA%9E%E8%A7%A3%E6%9E%90%E3%81%AE%E8%BF%BD%E5%8A%A0"><i class="fa fa-link"></i></a>Bot に自然言語解析の追加</h1>

<p>ユーザーがテキストを送って来た時に解析をできるようにコードを追加します。</p>

<p>1 Visual Studio Code でビューメニューより統合ターミナルを開きます。</p>

<p>2 以下コマンドで LUIS 用のパッケージをインストールします。</p>

<div class="code-frame" data-lang="console"><div class="highlight"><pre class="with-code"><code><span class="go">dotnet add package microsoft.cognitive.luis
dotnet restore
</span></code></pre></div></div>

<p>3 LineBotApp.cs コードの上部に以下 using ステートメントを追加します。</p>

<div class="code-frame" data-lang="c#"><div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">Microsoft.Cognitive.LUIS</span><span class="p">;</span>
</code></pre></div></div>

<p>4 コンストラクターより前に LuisClient プロパティを追加します。Application ID、キーを自分のものと差し替えます。</p>

<div class="code-frame" data-lang="c#"><div class="highlight"><pre class="with-code"><code><span class="k">private</span> <span class="n">LuisClient</span> <span class="n">luisClient</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">LuisClient</span><span class="p">(</span>
            <span class="n">appId</span><span class="p">:</span> <span class="s">"12819323-19e6-4103-aaa0-352d14fc2cfa"</span><span class="p">,</span> 
            <span class="n">appKey</span><span class="p">:</span> <span class="s">"4501df87a8944328b3bd07ed8adb6508"</span><span class="p">);</span>
</code></pre></div></div>

<p>5 HandleTextAsync メソッドを以下のコードに変更します。</p>

<div class="code-frame" data-lang="c#"><div class="highlight"><pre class="with-code"><code><span class="k">private</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">HandleTextAsync</span><span class="p">(</span><span class="kt">string</span> <span class="n">replyToken</span><span class="p">,</span> <span class="kt">string</span> <span class="n">userMessage</span><span class="p">,</span> <span class="kt">string</span> <span class="n">userId</span><span class="p">)</span>
<span class="p">{</span>  
    <span class="kt">var</span> <span class="n">replyMessage</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">TextMessage</span><span class="p">(</span><span class="s">$"You said: </span><span class="p">{</span><span class="n">userMessage</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
    <span class="c1">// LUIS で文章を解析</span>
    <span class="kt">var</span> <span class="n">luisResult</span> <span class="p">=</span> <span class="k">await</span> <span class="n">luisClient</span><span class="p">.</span><span class="nf">Predict</span><span class="p">(</span><span class="n">userMessage</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">luisResult</span><span class="p">.</span><span class="n">TopScoringIntent</span><span class="p">.</span><span class="n">Name</span> <span class="p">==</span> <span class="s">"greeting"</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">replyMessage</span><span class="p">.</span><span class="n">Text</span> <span class="p">=</span> <span class="s">"どうもどうも"</span><span class="p">;</span> 
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">luisResult</span><span class="p">.</span><span class="n">TopScoringIntent</span><span class="p">.</span><span class="n">Name</span> <span class="p">==</span> <span class="s">"order"</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// メニューエンティティがある場合</span>
        <span class="k">if</span><span class="p">(</span><span class="n">luisResult</span><span class="p">.</span><span class="n">Entities</span><span class="p">.</span><span class="nf">ContainsKey</span><span class="p">(</span><span class="s">"menu"</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">replyMessage</span><span class="p">.</span><span class="n">Text</span> <span class="p">=</span> <span class="s">$"毎度！</span><span class="p">{</span><span class="n">luisResult</span><span class="p">.</span><span class="n">Entities</span><span class="p">[</span><span class="s">"menu"</span><span class="p">].</span><span class="nf">First</span><span class="p">().</span><span class="n">Value</span><span class="p">}</span><span class="s"> ですね！"</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="n">replyMessage</span><span class="p">.</span><span class="n">Text</span> <span class="p">=</span> <span class="s">"毎度！注文ですね。何にしましょう？"</span><span class="p">;</span> 
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">await</span> <span class="n">messagingClient</span><span class="p">.</span><span class="nf">ReplyMessageAsync</span><span class="p">(</span><span class="n">replyToken</span><span class="p">,</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">ISendMessage</span><span class="p">&gt;</span> <span class="p">{</span> <span class="n">replyMessage</span> <span class="p">});</span>
<span class="p">}</span>
</code></pre></div></div>

<p>6 luisResult を取得した後にブレークポイントを置いて、F5 を押下してデバッグを開始します。<br><a href="https://camo.qiitausercontent.com/96be8db7755dc735fe03c27e45da42b37ff77450/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3231343131362f33653961633065632d393730632d623964352d623034652d3136653734373561653132622e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2F3e9ac0ec-970c-b9d5-b04e-16e7475ae12b.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=360c8ed4be0a6eeeeb5ca38eaf406582" alt="Screen Shot 2018-01-20 at 6.38.49 AM.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/214116/3e9ac0ec-970c-b9d5-b04e-16e7475ae12b.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2F3e9ac0ec-970c-b9d5-b04e-16e7475ae12b.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=83b3d8809ca38c1efab98e1a56cda0b8 1x" loading="lazy"></a></p>

<p>7 シミュレーターから「どうも」など、挨拶と認識されるはずのテキストを送ります。ブレークポイントがヒットしたら、ウォッチ式などで luisResult の中身を確認し、greeting が意図として認識されていることを確認します。<br><a href="https://camo.qiitausercontent.com/9a831a081ce4e4768823911e0aaee30f5f10358c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3231343131362f36343034343738322d366631612d646462662d376139612d3963663938646461326339312e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2F64044782-6f1a-ddbf-7a9a-9cf98dda2c91.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=b14b1e6dc8886a508d532b028a23744e" alt="Screen Shot 2018-01-20 at 6.41.10 AM.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/214116/64044782-6f1a-ddbf-7a9a-9cf98dda2c91.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2F64044782-6f1a-ddbf-7a9a-9cf98dda2c91.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=2766a33ac32aca8d7f3e092401b91d76 1x" loading="lazy"></a></p>

<p>8 同様に「松をお願い」と送って、order と、認識されるかと、menu エンティティが取得できているか確認します。<br><a href="https://camo.qiitausercontent.com/6db4f4e9c11adc6a18d06ab861038f889323261c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3231343131362f63343232663130642d396365632d353433612d363435662d3132623663343434333839622e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2Fc422f10d-9cec-543a-645f-12b6c444389b.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=b3b439269b1252155af5da18a304c62a" alt="Screen Shot 2018-01-20 at 6.43.39 AM.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/214116/c422f10d-9cec-543a-645f-12b6c444389b.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2Fc422f10d-9cec-543a-645f-12b6c444389b.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=3a744f2b7bff352b1a048bcd128ecc45 1x" loading="lazy"></a></p>

<h1>
<span id="自然言語解析とフローの改善" class="fragment"></span><a href="#%E8%87%AA%E7%84%B6%E8%A8%80%E8%AA%9E%E8%A7%A3%E6%9E%90%E3%81%A8%E3%83%95%E3%83%AD%E3%83%BC%E3%81%AE%E6%94%B9%E5%96%84"><i class="fa fa-link"></i></a>自然言語解析とフローの改善</h1>

<p>一見うまく行っているように見えますが、「注文をおねがい」と送るとどうなるでしょう。この場合「注文」が menu と認識されます。これは LUIS で文章の位置関係などからエンティティを推測しているためです。メニューのように決まった者の場合、LIST を使う方が良いです。</p>

<p>1 LUIS の画面より BUILD を選択し、Entities をクリックします。</p>

<p>2 既存の menu エンティティを選択し Delete Entity をクリックして削除します。</p>

<p>3 Create new entity をクリックして、List タイプで menu を作り直します。<br><a href="https://camo.qiitausercontent.com/1eda8df79093b8584f501c083138acca12675611/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3231343131362f62633338646632372d323438362d346638352d346432392d6364366535386336353062642e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2Fbc38df27-2486-4f85-4d29-cd6e58c650bd.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=1891bbbeeb84e36d4002aac13953217d" alt="Screen Shot 2018-01-20 at 7.28.38 AM.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/214116/bc38df27-2486-4f85-4d29-cd6e58c650bd.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2Fbc38df27-2486-4f85-4d29-cd6e58c650bd.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=d2d648557c108ec98f22d9b52b5ff2cb 1x" loading="lazy"></a></p>

<p>4 Values に「松」「竹」「梅」をそれぞれ追加します。類義語を追加することもできます。<br><a href="https://camo.qiitausercontent.com/b135f06da11e211a0bd1daa34013e7c29fdc4e77/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3231343131362f63343766333962652d373464652d633736642d346639372d3465383036373331356231632e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2Fc47f39be-74de-c76d-4f97-4e8067315b1c.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=22461e515ae2a6096ad27600afba7a0a" alt="Screen Shot 2018-01-20 at 7.31.33 AM.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/214116/c47f39be-74de-c76d-4f97-4e8067315b1c.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2Fc47f39be-74de-c76d-4f97-4e8067315b1c.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=f9f0f90b8927722ccd2bf87d8de4c44d 1x" loading="lazy"></a></p>

<p>5 Train ボタンをクリックして学習させます。Simple Entity と異なり、List は例文に対して指定する必要はありません。学習が終わったら、PUBLISH メニューより再度パブリッシュします。</p>

<p>6 注文の意図はあるがメニューがない場合の対応をコードに追加します。</p>

<div class="code-frame" data-lang="c#"><div class="highlight"><pre class="with-code"><code><span class="k">private</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">HandleTextAsync</span><span class="p">(</span><span class="kt">string</span> <span class="n">replyToken</span><span class="p">,</span> <span class="kt">string</span> <span class="n">userMessage</span><span class="p">,</span> <span class="kt">string</span> <span class="n">userId</span><span class="p">)</span>
<span class="p">{</span>  
    <span class="n">ISendMessage</span> <span class="n">replyMessage</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">TextMessage</span><span class="p">(</span><span class="s">""</span><span class="p">);</span>
    <span class="c1">// LUIS で文章を解析</span>
    <span class="kt">var</span> <span class="n">luisResult</span> <span class="p">=</span> <span class="k">await</span> <span class="n">luisClient</span><span class="p">.</span><span class="nf">Predict</span><span class="p">(</span><span class="n">userMessage</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">luisResult</span><span class="p">.</span><span class="n">TopScoringIntent</span><span class="p">.</span><span class="n">Name</span> <span class="p">==</span> <span class="s">"greeting"</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">replyMessage</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">TextMessage</span><span class="p">(</span><span class="s">"どうもどうも"</span><span class="p">);</span> 
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">luisResult</span><span class="p">.</span><span class="n">TopScoringIntent</span><span class="p">.</span><span class="n">Name</span> <span class="p">==</span> <span class="s">"order"</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// メニューエンティティがある場合</span>
        <span class="k">if</span><span class="p">(</span><span class="n">luisResult</span><span class="p">.</span><span class="n">Entities</span><span class="p">.</span><span class="nf">ContainsKey</span><span class="p">(</span><span class="s">"menu"</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">replyMessage</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">TextMessage</span><span class="p">(</span><span class="s">$"毎度！</span><span class="p">{</span><span class="n">luisResult</span><span class="p">.</span><span class="n">Entities</span><span class="p">[</span><span class="s">"menu"</span><span class="p">].</span><span class="nf">First</span><span class="p">().</span><span class="n">Value</span><span class="p">}</span><span class="s"> ですね！"</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="c1">// 注文だがメニューがわからない場合はメニューをボタンで提示</span>
            <span class="n">replyMessage</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">TemplateMessage</span><span class="p">(</span><span class="s">"menu"</span><span class="p">,</span> <span class="k">new</span> <span class="nf">ButtonsTemplate</span><span class="p">(</span>
                <span class="n">title</span><span class="p">:</span> <span class="s">"注文"</span><span class="p">,</span>
                <span class="n">text</span><span class="p">:</span> <span class="s">"毎度！注文ですね。何にしましょう？"</span><span class="p">,</span>
                <span class="n">actions</span><span class="p">:</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">ITemplateAction</span><span class="p">&gt;(){</span>
                    <span class="k">new</span> <span class="nf">MessageTemplateAction</span><span class="p">(</span><span class="s">"松"</span><span class="p">,</span><span class="s">"松"</span><span class="p">),</span>
                    <span class="k">new</span> <span class="nf">MessageTemplateAction</span><span class="p">(</span><span class="s">"竹"</span><span class="p">,</span><span class="s">"竹"</span><span class="p">),</span>
                    <span class="k">new</span> <span class="nf">MessageTemplateAction</span><span class="p">(</span><span class="s">"梅"</span><span class="p">,</span><span class="s">"梅"</span><span class="p">),</span>
                    <span class="p">}));</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">await</span> <span class="n">messagingClient</span><span class="p">.</span><span class="nf">ReplyMessageAsync</span><span class="p">(</span><span class="n">replyToken</span><span class="p">,</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">ISendMessage</span><span class="p">&gt;</span> <span class="p">{</span> <span class="n">replyMessage</span> <span class="p">});</span>
<span class="p">}</span>
</code></pre></div></div>

<p>7 再度デバッグを実行して、シミュレーターから「注文をおねがい」と送ります。ボタンテンプレートが返ってくることを確認します。<br><a href="https://camo.qiitausercontent.com/5a64b7ac830f4ced63fe8843860709858ef776ae/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3231343131362f61313935626265352d333339382d386265312d373639622d3161356437336435653662632e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2Fa195bbe5-3398-8be1-769b-1a5d73d5e6bc.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=7f96edafc97533838762333300de0e6d" alt="Screen Shot 2018-01-20 at 7.55.33 AM.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/214116/a195bbe5-3398-8be1-769b-1a5d73d5e6bc.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2Fa195bbe5-3398-8be1-769b-1a5d73d5e6bc.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=b0d7322840ac7c3f1c57c08434789326 1x" loading="lazy"></a></p>

<p>8 これで注文を受ける箇所はうまくいきそうです。次に出前先の住所を確認します。ここで重要な点はすでに聞いた注文を忘れないように保存しておくことです。テンプレートは EventSourceState というデータ構造をストレージに格納できるようになっているのでこれを拡張します。まず注文と出前先を格納するクラスを追加します。Models フォルダに Order.cs を追加します。</p>

<div class="code-frame" data-lang="c#">
<div class="code-lang"><span class="bold">Order.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">Microsoft.WindowsAzure.Storage.Table</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">sushibot.Models</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">Order</span> <span class="p">:</span> <span class="n">EventSourceState</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Menu</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Location_Address</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Location_Title</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="k">public</span> <span class="nf">Order</span><span class="p">()</span> 
        <span class="p">{</span>
            <span class="n">SourceType</span> <span class="p">=</span> <span class="s">"order"</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>9 テーブルストレージが Order を使うように Controllers¥LineBotControllers.cs の Post メソッドを変更します。</p>

<div class="code-frame" data-lang="c#">
<div class="code-lang"><span class="bold">Controllers¥LineBotController.cs-Postメソッド</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">IActionResult</span><span class="p">&gt;</span> <span class="nf">Post</span><span class="p">([</span><span class="n">FromBody</span><span class="p">]</span><span class="n">JToken</span> <span class="n">req</span><span class="p">)</span>
<span class="p">{</span> 
    <span class="kt">var</span> <span class="n">events</span> <span class="p">=</span> <span class="n">WebhookEventParser</span><span class="p">.</span><span class="nf">Parse</span><span class="p">(</span><span class="n">req</span><span class="p">.</span><span class="nf">ToString</span><span class="p">());</span>
    <span class="kt">var</span> <span class="n">connectionString</span> <span class="p">=</span> <span class="n">appsettings</span><span class="p">.</span><span class="n">LineSettings</span><span class="p">.</span><span class="n">StorageConnectionString</span><span class="p">;</span>
    <span class="kt">var</span> <span class="n">blobStorage</span> <span class="p">=</span> <span class="k">await</span> <span class="n">BlobStorage</span><span class="p">.</span><span class="nf">CreateAsync</span><span class="p">(</span><span class="n">connectionString</span><span class="p">,</span> <span class="s">"linebotcontainer"</span><span class="p">);</span>
    <span class="kt">var</span> <span class="n">orderState</span> <span class="p">=</span> <span class="k">await</span> <span class="n">TableStorage</span><span class="p">&lt;</span><span class="n">Order</span><span class="p">&gt;.</span><span class="nf">CreateAsync</span><span class="p">(</span><span class="n">connectionString</span><span class="p">,</span> <span class="s">"eventsourcestate"</span><span class="p">);</span>
    <span class="kt">var</span> <span class="n">app</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">LineBotApp</span><span class="p">(</span><span class="n">lineMessagingClient</span><span class="p">,</span> <span class="n">orderState</span><span class="p">,</span> <span class="n">blobStorage</span><span class="p">);</span>
    <span class="k">await</span> <span class="n">app</span><span class="p">.</span><span class="nf">RunAsync</span><span class="p">(</span><span class="n">events</span><span class="p">);</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">OkResult</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>10 LineBotApp.cs を以下のコードに差し替えます。主な変更は以下の通りです。<br>
- Order を使うようにプロパティとコンストラクターの変更<br>
- 位置情報をハンドルするように OnMessageAsync での処理と HandleLocationAsync の追加。<br>
- HandleTextAsync メソッド内で Order の保存や、位置情報の確認ロジックの追加。<br>
尚、位置情報の確認は地図を利用してもらうように<a href="https://developers.line.me/ja/docs/messaging-api/using-line-url-scheme/#opening-the-location-screen" rel="nofollow noopener" target="_blank">URL スキーム</a>を利用しています。<br>
* LuisClient に渡す AppId と AppKey はそれぞれ自身のものに変更してください。</p>

<div class="code-frame" data-lang="c#">
<div class="code-lang"><span class="bold">LineBotApp.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">Line.Messaging</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Line.Messaging.Webhooks</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.IO</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Linq</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Threading.Tasks</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">sushibot.CloudStorage</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">sushibot.Models</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Microsoft.Cognitive.LUIS</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">sushibot</span>
<span class="p">{</span>
    <span class="k">internal</span> <span class="k">class</span> <span class="nc">LineBotApp</span> <span class="p">:</span> <span class="n">WebhookApplication</span>
    <span class="p">{</span>
        <span class="k">private</span> <span class="n">LineMessagingClient</span> <span class="n">messagingClient</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">private</span> <span class="n">TableStorage</span><span class="p">&lt;</span><span class="n">Order</span><span class="p">&gt;</span> <span class="n">orderState</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">private</span> <span class="n">BlobStorage</span> <span class="n">blobStorage</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">private</span> <span class="n">LuisClient</span> <span class="n">luisClient</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">LuisClient</span><span class="p">(</span>
            <span class="n">appId</span><span class="p">:</span> <span class="s">"12819323-19e6-4103-aaa0-352d14fc2cfa"</span><span class="p">,</span>
            <span class="n">appKey</span><span class="p">:</span> <span class="s">"4501df87a8944328b3bd07ed8adb6508"</span><span class="p">);</span>

        <span class="k">public</span> <span class="nf">LineBotApp</span><span class="p">(</span><span class="n">LineMessagingClient</span> <span class="n">lineMessagingClient</span><span class="p">,</span> <span class="n">TableStorage</span><span class="p">&lt;</span><span class="n">Order</span><span class="p">&gt;</span> <span class="n">tableStorage</span><span class="p">,</span> <span class="n">BlobStorage</span> <span class="n">blobStorage</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="n">messagingClient</span> <span class="p">=</span> <span class="n">lineMessagingClient</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="n">orderState</span> <span class="p">=</span> <span class="n">tableStorage</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="n">blobStorage</span> <span class="p">=</span> <span class="n">blobStorage</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">protected</span> <span class="k">override</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">OnMessageAsync</span><span class="p">(</span><span class="n">MessageEvent</span> <span class="n">ev</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">switch</span> <span class="p">(</span><span class="n">ev</span><span class="p">.</span><span class="n">Message</span><span class="p">.</span><span class="n">Type</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">case</span> <span class="n">EventMessageType</span><span class="p">.</span><span class="n">Text</span><span class="p">:</span>
                    <span class="k">await</span> <span class="nf">HandleTextAsync</span><span class="p">(</span><span class="n">ev</span><span class="p">.</span><span class="n">ReplyToken</span><span class="p">,</span> <span class="p">((</span><span class="n">TextEventMessage</span><span class="p">)</span><span class="n">ev</span><span class="p">.</span><span class="n">Message</span><span class="p">).</span><span class="n">Text</span><span class="p">,</span> <span class="n">ev</span><span class="p">.</span><span class="n">Source</span><span class="p">.</span><span class="n">UserId</span><span class="p">);</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="k">case</span> <span class="n">EventMessageType</span><span class="p">.</span><span class="n">Location</span><span class="p">:</span>
                    <span class="kt">var</span> <span class="n">location</span> <span class="p">=</span> <span class="p">((</span><span class="n">LocationEventMessage</span><span class="p">)</span><span class="n">ev</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
                    <span class="k">await</span> <span class="nf">HandleLocationAsync</span><span class="p">(</span><span class="n">ev</span><span class="p">.</span><span class="n">ReplyToken</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">ev</span><span class="p">.</span><span class="n">Source</span><span class="p">.</span><span class="n">Id</span><span class="p">);</span>
                    <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">HandleLocationAsync</span><span class="p">(</span><span class="kt">string</span> <span class="n">replyToken</span><span class="p">,</span> <span class="n">LocationEventMessage</span> <span class="n">location</span><span class="p">,</span> <span class="kt">string</span> <span class="n">userId</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// Order ステートを取得</span>
            <span class="kt">var</span> <span class="n">order</span> <span class="p">=</span> <span class="k">await</span> <span class="n">orderState</span><span class="p">.</span><span class="nf">FindAsync</span><span class="p">(</span><span class="s">"order"</span><span class="p">,</span> <span class="n">userId</span><span class="p">);</span>
            <span class="c1">// 住所を設定後保存</span>
            <span class="n">order</span><span class="p">.</span><span class="n">Location_Address</span> <span class="p">=</span> <span class="n">location</span><span class="p">.</span><span class="n">Address</span><span class="p">;</span>
            <span class="n">order</span><span class="p">.</span><span class="n">Location_Title</span> <span class="p">=</span> <span class="n">location</span><span class="p">.</span><span class="n">Title</span><span class="p">;</span>
            <span class="k">await</span> <span class="n">orderState</span><span class="p">.</span><span class="nf">UpdateAsync</span><span class="p">(</span><span class="n">order</span><span class="p">);</span>
            <span class="k">await</span> <span class="n">messagingClient</span><span class="p">.</span><span class="nf">ReplyMessageAsync</span><span class="p">(</span><span class="n">replyToken</span><span class="p">,</span> <span class="k">new</span><span class="p">[]</span> <span class="p">{</span>
                        <span class="k">new</span> <span class="nf">TextMessage</span><span class="p">(</span><span class="s">$"あいよ！</span><span class="p">{</span><span class="n">order</span><span class="p">.</span><span class="n">Menu</span><span class="p">}</span><span class="s">を</span><span class="p">{</span><span class="n">order</span><span class="p">.</span><span class="n">Location_Title</span><span class="p">}</span><span class="s">にだね！"</span><span class="p">)</span>
                    <span class="p">});</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">HandleTextAsync</span><span class="p">(</span><span class="kt">string</span> <span class="n">replyToken</span><span class="p">,</span> <span class="kt">string</span> <span class="n">userMessage</span><span class="p">,</span> <span class="kt">string</span> <span class="n">userId</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">ISendMessage</span> <span class="n">replyMessage</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">TextMessage</span><span class="p">(</span><span class="s">""</span><span class="p">);</span>

            <span class="c1">// LUIS で文章を解析</span>
            <span class="kt">var</span> <span class="n">luisResult</span> <span class="p">=</span> <span class="k">await</span> <span class="n">luisClient</span><span class="p">.</span><span class="nf">Predict</span><span class="p">(</span><span class="n">userMessage</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">luisResult</span><span class="p">.</span><span class="n">TopScoringIntent</span><span class="p">.</span><span class="n">Name</span> <span class="p">==</span> <span class="s">"greeting"</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">replyMessage</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">TextMessage</span><span class="p">(</span><span class="s">"どうもどうも"</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">luisResult</span><span class="p">.</span><span class="n">TopScoringIntent</span><span class="p">.</span><span class="n">Name</span> <span class="p">==</span> <span class="s">"order"</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="c1">// メニューエンティティがある場合</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">luisResult</span><span class="p">.</span><span class="n">Entities</span><span class="p">.</span><span class="nf">ContainsKey</span><span class="p">(</span><span class="s">"menu"</span><span class="p">))</span>
                <span class="p">{</span>
                    <span class="c1">// メニューを取得して、Order を Azure テーブルに保存</span>
                    <span class="kt">var</span> <span class="n">menu</span> <span class="p">=</span> <span class="n">luisResult</span><span class="p">.</span><span class="n">Entities</span><span class="p">[</span><span class="s">"menu"</span><span class="p">].</span><span class="nf">First</span><span class="p">().</span><span class="n">Value</span><span class="p">;</span>
                    <span class="kt">var</span> <span class="n">order</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Order</span><span class="p">(){</span> <span class="n">Menu</span> <span class="p">=</span> <span class="n">menu</span><span class="p">,</span> <span class="n">SourceId</span> <span class="p">=</span> <span class="n">userId</span> <span class="p">};</span>
                    <span class="k">await</span> <span class="n">orderState</span><span class="p">.</span><span class="nf">UpdateAsync</span><span class="p">(</span><span class="n">order</span><span class="p">);</span>
                    <span class="c1">// 住所の確認に地図を起動するスキームを送信</span>
                    <span class="n">replyMessage</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">TemplateMessage</span><span class="p">(</span><span class="s">"location"</span><span class="p">,</span> <span class="k">new</span> <span class="nf">ButtonsTemplate</span><span class="p">(</span>
                        <span class="n">title</span><span class="p">:</span> <span class="s">"住所の送信"</span><span class="p">,</span>
                        <span class="n">text</span><span class="p">:</span> <span class="s">$"毎度！</span><span class="p">{</span><span class="n">menu</span><span class="p">}</span><span class="s">ですね。どちらにお送りしましょう？"</span><span class="p">,</span>
                        <span class="n">actions</span><span class="p">:</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">ITemplateAction</span><span class="p">&gt;(){</span>
                            <span class="k">new</span> <span class="nf">UriTemplateAction</span><span class="p">(</span><span class="s">"住所を送る"</span><span class="p">,</span><span class="s">"line://nv/location"</span><span class="p">)</span>
                            <span class="p">}));</span>
                <span class="p">}</span>
                <span class="k">else</span>
                <span class="p">{</span>
                    <span class="c1">// 注文だがメニューがわからない場合はメニューをボタンで提示</span>
                    <span class="n">replyMessage</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">TemplateMessage</span><span class="p">(</span><span class="s">"menu"</span><span class="p">,</span> <span class="k">new</span> <span class="nf">ButtonsTemplate</span><span class="p">(</span>
                        <span class="n">title</span><span class="p">:</span> <span class="s">"注文"</span><span class="p">,</span>
                        <span class="n">text</span><span class="p">:</span> <span class="s">"毎度！注文ですね。何にしましょう？"</span><span class="p">,</span>
                        <span class="n">actions</span><span class="p">:</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">ITemplateAction</span><span class="p">&gt;(){</span>
                            <span class="k">new</span> <span class="nf">MessageTemplateAction</span><span class="p">(</span><span class="s">"松"</span><span class="p">,</span><span class="s">"松"</span><span class="p">),</span>
                            <span class="k">new</span> <span class="nf">MessageTemplateAction</span><span class="p">(</span><span class="s">"竹"</span><span class="p">,</span><span class="s">"竹"</span><span class="p">),</span>
                            <span class="k">new</span> <span class="nf">MessageTemplateAction</span><span class="p">(</span><span class="s">"梅"</span><span class="p">,</span><span class="s">"梅"</span><span class="p">),</span>
                            <span class="p">}));</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="k">await</span> <span class="n">messagingClient</span><span class="p">.</span><span class="nf">ReplyMessageAsync</span><span class="p">(</span><span class="n">replyToken</span><span class="p">,</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">ISendMessage</span><span class="p">&gt;</span> <span class="p">{</span> <span class="n">replyMessage</span> <span class="p">});</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<h1>
<span id="クラウドへのデプロイとテスト" class="fragment"></span><a href="#%E3%82%AF%E3%83%A9%E3%82%A6%E3%83%89%E3%81%B8%E3%81%AE%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E3%81%A8%E3%83%86%E3%82%B9%E3%83%88"><i class="fa fa-link"></i></a>クラウドへのデプロイとテスト</h1>

<p>最後に最新のコードをデプロイしてテストしてみましょう。</p>

<p>1 以下のコマンドで変更をコミットして、デプロイをします。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>git add .
git commit -m update
git push
</code></pre></div></div>

<p>2 プッシュが完了したらモバイル端末で LINE を起動します。まず挨拶と出前依頼を送ってみます。<br><a href="https://camo.qiitausercontent.com/3bc220657e3e04a531895761ea28619a05a191cd/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3231343131362f61613332306531362d363166622d303065622d346462612d3263643563653335353861322e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2Faa320e16-61fb-00eb-4dba-2cd5ce3558a2.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=3910ee61500d9b9814471472084a6a52" alt="Screen Shot 2018-01-20 at 9.58.30 AM.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/214116/aa320e16-61fb-00eb-4dba-2cd5ce3558a2.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2Faa320e16-61fb-00eb-4dba-2cd5ce3558a2.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=efb6a4a60cea65d8e84eba430932185c 1x" loading="lazy"></a></p>

<p>3 メニューを選ぶと住所を聞かれます。<br><a href="https://camo.qiitausercontent.com/806d596991368dbf1876e2993fca9be71a8b87b8/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3231343131362f39653637646163642d396562612d613730642d643132332d3330386438653239313532332e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2F9e67dacd-9eba-a70d-d123-308d8e291523.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=d83b4851c7fc5f64d9d2e16e34d527a2" alt="Screen Shot 2018-01-20 at 10.00.08 AM.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/214116/9e67dacd-9eba-a70d-d123-308d8e291523.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2F9e67dacd-9eba-a70d-d123-308d8e291523.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=8ce1fab19a5d02f918ba77fbd99c75e1 1x" loading="lazy"></a></p>

<p>4 住所を送るボタンをクリックすると地図が開きます。任意の住所を送ります。<br><a href="https://camo.qiitausercontent.com/37ea284034e21beda68bf6c823ed427b65ce9e8f/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3231343131362f37623664643038612d666134642d663361642d386463382d6538613761636133616361342e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2F7b6dd08a-fa4d-f3ad-8dc8-e8a7aca3aca4.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=61a1d5b1b4e5a53a32cb36e09b51b4ec" alt="Screen Shot 2018-01-20 at 10.01.41 AM.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/214116/7b6dd08a-fa4d-f3ad-8dc8-e8a7aca3aca4.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2F7b6dd08a-fa4d-f3ad-8dc8-e8a7aca3aca4.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=8ec15cf5f9b5c20ade5d81710cfa10d0 1x" loading="lazy"></a></p>

<p>5 注文と住所が正しく認識されることを確認します。<br><a href="https://camo.qiitausercontent.com/317e868a58ebd9850ace9673783410e63af1ab91/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3231343131362f65666633626466302d373331312d316163662d626439372d6166396534363235373962302e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2Feff3bdf0-7311-1acf-bd97-af9e462579b0.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=2f729183007d50deae1aa40ca395ead0" alt="Screen Shot 2018-01-20 at 10.02.18 AM.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/214116/eff3bdf0-7311-1acf-bd97-af9e462579b0.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2Feff3bdf0-7311-1acf-bd97-af9e462579b0.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=4b8d41f299bbe7be361a032a123a7bee 1x" loading="lazy"></a></p>

<h1>
<span id="まとめ" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>まとめ</h1>

<p>今回は Bot が自然言語からユーザーが求めていることを理解し、文脈も加味しながら対話できるまでを実装しました。</p>

<p>この後はいろいろなメッセージに対して適切に反応できるように理解力とスキルを広げていく、精度をあげていくということが求められると思います。Bot 開発はまだまだ確立した開発手法というものは存在せず、開発者の腕にかかっている分野で、そこがまた魅力的なところですね。</p>

<h1>
<span id="付録" class="fragment"></span><a href="#%E4%BB%98%E9%8C%B2"><i class="fa fa-link"></i></a>付録</h1>

<p>LINEのBot開発にあたり有用なライブラリ・ツールをご紹介しておきます。</p>

<ul>
<li><a href="https://developers.line.me/ja/docs/messaging-api/line-bot-sdk/" rel="nofollow noopener" target="_blank">Messaging API - 公式SDK</a></li>
<li><a href="https://github.com/pierre3/LineMessagingApi" rel="nofollow noopener" target="_blank">Messaging API - Community SDK - C#</a></li>
<li><a href="https://www.npmjs.com/package/line-simulator" rel="nofollow noopener" target="_blank">LINE Simulator for BOT developer</a></li>
<li><a href="https://www.npmjs.com/package/line-richmenus-manager" rel="nofollow noopener" target="_blank">LINE Rich Menus Manager</a></li>
<li><a href="https://www.npmjs.com/package/generator-line-bot" rel="nofollow noopener" target="_blank">LINE Bot Template</a></li>
<li><a href="https://github.com/nkjm/bot-express" rel="nofollow noopener" target="_blank">bot-express</a></li>
</ul>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Fkenakamu%2Fitems%2Fac4922a2061f4f8f02d9&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Fkenakamu%2Fitems%2Fac4922a2061f4f8f02d9&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/kenakamu/items/ac4922a2061f4f8f02d9/likers" class="css-1iupg5d">19</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">19</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/ac4922a2061f4f8f02d9/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/kenakamu/items/ac4922a2061f4f8f02d9/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/kenakamu/items/ac4922a2061f4f8f02d9/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/kenakamu/items/ac4922a2061f4f8f02d9/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/kenakamu/items/ac4922a2061f4f8f02d9.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-3dd73f0b-2cdf-45c1-8ce6-d75b0cd14f6b">{"authorAnalyticsTrackingId":null,"organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-147ab591-4ef3-436c-a917-3103e2afb122"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-147ab591-4ef3-436c-a917-3103e2afb122">{}</script>
      
<div id="LoginModal-react-component-42edb6e3-0cb6-4ff3-b2b5-b867f7078922"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-42edb6e3-0cb6-4ff3-b2b5-b867f7078922">{}</script>
      
<div id="StockModal-react-component-0a6ba1be-567c-4a86-b852-1935ce872d7f"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-0a6ba1be-567c-4a86-b852-1935ce872d7f">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;91qMj1gUFYtnJvqw5+2D5duxTzwjy0X6MV+r9RsOwq/pu4XcKKyneD3ceWQ/yiyydXEmZawt0UUXj4YmxM+/oA==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\u003cp\u003eLINE の Bot 開発 C# 超入門（後編） メッセージの内容と文脈を意識した会話を実現する\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita.com/kenakamu/items/e0b194a82e4141b30c95\" id=\"reference-87106748ee193eaca874\"\u003e前編\u003c/a\u003eに続いて Bot を開発していきます。今回は自然言語解析を用いたメッセージの理解と、文脈に応じて対話をおこなうところまでをカバーします。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"開発の流れ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%96%8B%E7%99%BA%E3%81%AE%E6%B5%81%E3%82%8C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e開発の流れ\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003e自然言語解析サービスの Language Understanding Intelligent Service (LUIS) を設定し、理解すべきメッセージを理解できるように学習させます。\u003c/li\u003e\n\u003cli\u003eBot が受け取ったメッセージを LUIS と連携してユーザーの意図を判定できるようにします。\u003c/li\u003e\n\u003cli\u003e文脈に応じて対話するための機能を Bot に盛り込みます。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"手順\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%89%8B%E9%A0%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e手順\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"自然言語解析の設定\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%87%AA%E7%84%B6%E8%A8%80%E8%AA%9E%E8%A7%A3%E6%9E%90%E3%81%AE%E8%A8%AD%E5%AE%9A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e自然言語解析の設定\u003c/h2\u003e\n\n\u003cp\u003eLUIS はマイクロソフトの自然言語処理のサービスです。ユーザーが発話した文章が何を意図しているのかを特定するために利用します。また、その文章の中からパラメーターを抽出する機能も備えています。\u003c/p\u003e\n\n\u003cp\u003e1 下記 LUIS のサイトにアクセスしてマイクロソフトアカウントでログインします。\u003cbr\u003e\n\u003ca href=\"https://www.luis.ai\" rel=\"nofollow noopener\" target=\"_blank\"\u003eLUIS https://www.luis.ai\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/d46eb0e243655ceb333187690068dab6f4e04149/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3231343131362f36383834343832342d623233392d363366612d323666632d3434643233653033363362302e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2F68844824-b239-63fa-26fc-44d23e0363b0.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=ab64b7d0322d8a4188eb22d8253af6a0\" alt=\"Screen Shot 2018-01-20 at 1.15.04 AM.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/214116/68844824-b239-63fa-26fc-44d23e0363b0.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2F68844824-b239-63fa-26fc-44d23e0363b0.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=01cd692c3b8f404fa820ed67db98ccef 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e2 ログインしたら Create new app をクリックし、設定します。Culture は後から変えられないので注意。\u003cbr\u003e\n    - Name: 任意\u003cbr\u003e\n    - Culture: Japanese\u003c/p\u003e\n\n\u003cp\u003e3 まず Entity を登録します。Entity は文章の中から抜き出したい項目として扱います。左サイドバーから Entities を選択し、Create new entity をクリックします。\u003cbr\u003e\u003ca href=\"https://camo.qiitausercontent.com/69f1fac78c3b409bed3a48708028f6da895213fc/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3231343131362f37636337646632322d363435302d396566372d356134372d3633313034343633343233622e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2F7cc7df22-6450-9ef7-5a47-63104463423b.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=27fe68aaf5c1dbac62f6a5f4350578d6\" alt=\"Screen Shot 2018-01-20 at 1.29.45 AM.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/214116/7cc7df22-6450-9ef7-5a47-63104463423b.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2F7cc7df22-6450-9ef7-5a47-63104463423b.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=2c26add8d5e580a6346ca9b5d1ade479 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e4 名前を menu、タイプを Simple で作成します。\u003cbr\u003e\u003ca href=\"https://camo.qiitausercontent.com/e419e98f91a4bc3c73a0f72d41127fc036001ce3/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3231343131362f34326362316566332d646435622d616663662d306534352d3464623538646464616366352e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2F42cb1ef3-dd5b-afcf-0e45-4db58dddacf5.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=51770218b97783bb7bfd6b06d5bb1d80\" alt=\"Screen Shot 2018-01-20 at 1.36.46 AM.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/214116/42cb1ef3-dd5b-afcf-0e45-4db58dddacf5.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2F42cb1ef3-dd5b-afcf-0e45-4db58dddacf5.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=bb533d397959011b414880d3c14271e5 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e5 次に Intent を登録します。Intent は文章の意図です。左のサイドバーから Intents を選択し、Create new intent をクリックします。名前を order として作成します。\u003c/p\u003e\n\n\u003cp\u003e6 例文 (Utterance) として「松をお願いします。」と入力して Enter を押下します。追加された例文の「松」をクリックして「menu」を選択します。\u003cbr\u003e\u003ca href=\"https://camo.qiitausercontent.com/e7ea9fb421e6d4e43b17761ace6e7bcb27298927/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3231343131362f30303130623064392d613234372d303662382d663537612d6564383662643233656463612e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2F0010b0d9-a247-06b8-f57a-ed86bd23edca.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=8d2ef756195a834432fad0884df3c2ab\" alt=\"Screen Shot 2018-01-20 at 1.48.42 AM.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/214116/0010b0d9-a247-06b8-f57a-ed86bd23edca.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2F0010b0d9-a247-06b8-f57a-ed86bd23edca.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=d7a375cfa541b4821a520e3cd1785dfa 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e7 松が menu と変更されます。\u003cbr\u003e\u003ca href=\"https://camo.qiitausercontent.com/a14b036b0e13a6868a91a1fa29d31380c9c380fe/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3231343131362f62633963393030322d666139332d666662632d366136362d3134663765633030346533632e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2Fbc9c9002-fa93-ffbc-6a66-14f7ec004e3c.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=a01ef64906068d65cd896a86d009e5ac\" alt=\"Screen Shot 2018-01-20 at 1.50.06 AM.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/214116/bc9c9002-fa93-ffbc-6a66-14f7ec004e3c.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2Fbc9c9002-fa93-ffbc-6a66-14f7ec004e3c.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=883d27a91cb7fb13e3a7f19f1e7a086a 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e8 同じように例題を合計で 5 つ入れます。\u003cbr\u003e\u003ca href=\"https://camo.qiitausercontent.com/33dda977079f295fe36f06923aa03beb8f22e6a8/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3231343131362f62363933383862372d366330372d663561362d363639302d6162393938373166336432632e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2Fb69388b7-6c07-f5a6-6690-ab99871f3d2c.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=09c1d261dd6971484052d8ff4a69c5c7\" alt=\"Screen Shot 2018-01-20 at 1.54.03 AM.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/214116/b69388b7-6c07-f5a6-6690-ab99871f3d2c.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2Fb69388b7-6c07-f5a6-6690-ab99871f3d2c.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=8faf0f329380988d7b530e3eada144a0 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e9 次に greeting という名前で Intent を追加します。\u003c/p\u003e\n\n\u003cp\u003e10 例文として 5 つ以上挨拶を登録します。\u003cbr\u003e\u003ca href=\"https://camo.qiitausercontent.com/4b07b6b5eb46a9a69107a2958f437b4513c4bbd5/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3231343131362f33346639646463352d356130622d626561312d616432652d6139313462336536656134642e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2F34f9ddc5-5a0b-bea1-ad2e-a914b3e6ea4d.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=aa1552b706af78120877839952a75bb8\" alt=\"Screen Shot 2018-01-20 at 5.42.30 AM.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/214116/34f9ddc5-5a0b-bea1-ad2e-a914b3e6ea4d.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2F34f9ddc5-5a0b-bea1-ad2e-a914b3e6ea4d.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=a354eee00cb7a642ce9ed1b660a06234 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e11 最後に Train ボタンをクリックして学習させます。\u003cbr\u003e\u003ca href=\"https://camo.qiitausercontent.com/eda61a861a4cd629405f0fe83a1e0acd78b2e218/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3231343131362f32656538656231662d616162342d333134362d356532362d3533653430343838346562332e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2F2ee8eb1f-aab4-3146-5e26-53e404884eb3.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=17a7652eab1d507d7168872e03da47cc\" alt=\"Screen Shot 2018-01-20 at 1.57.08 AM.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/214116/2ee8eb1f-aab4-3146-5e26-53e404884eb3.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2F2ee8eb1f-aab4-3146-5e26-53e404884eb3.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=338f4f9eaad352d2974ce1784bdd0ae6 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eこれで LUIS の学習は完了です。以下の手順で呼び出すためのキーとアドレスを取得します。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"luis-の公開とキーの取得\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#luis-%E3%81%AE%E5%85%AC%E9%96%8B%E3%81%A8%E3%82%AD%E3%83%BC%E3%81%AE%E5%8F%96%E5%BE%97\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eLUIS の公開とキーの取得\u003c/h2\u003e\n\n\u003cp\u003e1 上部メニューより PUBLISH を選択します。\u003cbr\u003e\u003ca href=\"https://camo.qiitausercontent.com/e0859b4975ee19a26553fb83479bcf302d5b45b6/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3231343131362f65333865313161332d666537352d366331652d393062382d6335643830646237316132652e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2Fe38e11a3-fe75-6c1e-90b8-c5d80db71a2e.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=e4fb6ebf06bfde54cdbcfb4513da1261\" alt=\"Screen Shot 2018-01-20 at 5.02.40 AM.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/214116/e38e11a3-fe75-6c1e-90b8-c5d80db71a2e.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2Fe38e11a3-fe75-6c1e-90b8-c5d80db71a2e.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=75b8775f5c560ab9a03fd9c5ca2f702c 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e2 Publish to production slot をクリックして公開します。\u003ca href=\"https://camo.qiitausercontent.com/4601573bdd1c3dc1e4fd4cb35afbadef9c40442f/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3231343131362f33326539326438392d363563392d393634322d313436392d3632393736363334653932652e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2F32e92d89-65c9-9642-1469-62976634e92e.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=5283fe5c9606ae9255b097e841ba50f1\" alt=\"Screen Shot 2018-01-20 at 5.16.46 AM.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/214116/32e92d89-65c9-9642-1469-62976634e92e.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2F32e92d89-65c9-9642-1469-62976634e92e.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=773d196d00e2628969ccde3f4447036c 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e3 画面下部に出るキーをコピーしておきます。\u003c/p\u003e\n\n\u003cp\u003e4 上部メニューより SETTINGS を選択して、画面に表示される Application ID をコピーしておきます。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"bot-に自然言語解析の追加\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#bot-%E3%81%AB%E8%87%AA%E7%84%B6%E8%A8%80%E8%AA%9E%E8%A7%A3%E6%9E%90%E3%81%AE%E8%BF%BD%E5%8A%A0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eBot に自然言語解析の追加\u003c/h1\u003e\n\n\u003cp\u003eユーザーがテキストを送って来た時に解析をできるようにコードを追加します。\u003c/p\u003e\n\n\u003cp\u003e1 Visual Studio Code でビューメニューより統合ターミナルを開きます。\u003c/p\u003e\n\n\u003cp\u003e2 以下コマンドで LUIS 用のパッケージをインストールします。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"console\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"go\"\u003edotnet add package microsoft.cognitive.luis\ndotnet restore\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e3 LineBotApp.cs コードの上部に以下 using ステートメントを追加します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eMicrosoft.Cognitive.LUIS\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e4 コンストラクターより前に LuisClient プロパティを追加します。Application ID、キーを自分のものと差し替えます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eLuisClient\u003c/span\u003e \u003cspan class=\"n\"\u003eluisClient\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eLuisClient\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eappId\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e\"12819323-19e6-4103-aaa0-352d14fc2cfa\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \n            \u003cspan class=\"n\"\u003eappKey\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e\"4501df87a8944328b3bd07ed8adb6508\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e5 HandleTextAsync メソッドを以下のコードに変更します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e \u003cspan class=\"nf\"\u003eHandleTextAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ereplyToken\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003euserMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003euserId\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e  \n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ereplyMessage\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eTextMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"You said: \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003euserMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// LUIS で文章を解析\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eluisResult\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eluisClient\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ePredict\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003euserMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eluisResult\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTopScoringIntent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e\"greeting\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ereplyMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eText\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"どうもどうも\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eluisResult\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTopScoringIntent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e\"order\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// メニューエンティティがある場合\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eluisResult\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEntities\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eContainsKey\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"menu\"\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ereplyMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eText\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e$\"毎度！\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eluisResult\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEntities\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"menu\"\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nf\"\u003eFirst\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e ですね！\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ereplyMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eText\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"毎度！注文ですね。何にしましょう？\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003emessagingClient\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReplyMessageAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereplyToken\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eISendMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003ereplyMessage\u003c/span\u003e \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e6 luisResult を取得した後にブレークポイントを置いて、F5 を押下してデバッグを開始します。\u003cbr\u003e\u003ca href=\"https://camo.qiitausercontent.com/96be8db7755dc735fe03c27e45da42b37ff77450/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3231343131362f33653961633065632d393730632d623964352d623034652d3136653734373561653132622e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2F3e9ac0ec-970c-b9d5-b04e-16e7475ae12b.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=360c8ed4be0a6eeeeb5ca38eaf406582\" alt=\"Screen Shot 2018-01-20 at 6.38.49 AM.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/214116/3e9ac0ec-970c-b9d5-b04e-16e7475ae12b.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2F3e9ac0ec-970c-b9d5-b04e-16e7475ae12b.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=83b3d8809ca38c1efab98e1a56cda0b8 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e7 シミュレーターから「どうも」など、挨拶と認識されるはずのテキストを送ります。ブレークポイントがヒットしたら、ウォッチ式などで luisResult の中身を確認し、greeting が意図として認識されていることを確認します。\u003cbr\u003e\u003ca href=\"https://camo.qiitausercontent.com/9a831a081ce4e4768823911e0aaee30f5f10358c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3231343131362f36343034343738322d366631612d646462662d376139612d3963663938646461326339312e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2F64044782-6f1a-ddbf-7a9a-9cf98dda2c91.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=b14b1e6dc8886a508d532b028a23744e\" alt=\"Screen Shot 2018-01-20 at 6.41.10 AM.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/214116/64044782-6f1a-ddbf-7a9a-9cf98dda2c91.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2F64044782-6f1a-ddbf-7a9a-9cf98dda2c91.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=2766a33ac32aca8d7f3e092401b91d76 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e8 同様に「松をお願い」と送って、order と、認識されるかと、menu エンティティが取得できているか確認します。\u003cbr\u003e\u003ca href=\"https://camo.qiitausercontent.com/6db4f4e9c11adc6a18d06ab861038f889323261c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3231343131362f63343232663130642d396365632d353433612d363435662d3132623663343434333839622e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2Fc422f10d-9cec-543a-645f-12b6c444389b.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=b3b439269b1252155af5da18a304c62a\" alt=\"Screen Shot 2018-01-20 at 6.43.39 AM.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/214116/c422f10d-9cec-543a-645f-12b6c444389b.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2Fc422f10d-9cec-543a-645f-12b6c444389b.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=3a744f2b7bff352b1a048bcd128ecc45 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"自然言語解析とフローの改善\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%87%AA%E7%84%B6%E8%A8%80%E8%AA%9E%E8%A7%A3%E6%9E%90%E3%81%A8%E3%83%95%E3%83%AD%E3%83%BC%E3%81%AE%E6%94%B9%E5%96%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e自然言語解析とフローの改善\u003c/h1\u003e\n\n\u003cp\u003e一見うまく行っているように見えますが、「注文をおねがい」と送るとどうなるでしょう。この場合「注文」が menu と認識されます。これは LUIS で文章の位置関係などからエンティティを推測しているためです。メニューのように決まった者の場合、LIST を使う方が良いです。\u003c/p\u003e\n\n\u003cp\u003e1 LUIS の画面より BUILD を選択し、Entities をクリックします。\u003c/p\u003e\n\n\u003cp\u003e2 既存の menu エンティティを選択し Delete Entity をクリックして削除します。\u003c/p\u003e\n\n\u003cp\u003e3 Create new entity をクリックして、List タイプで menu を作り直します。\u003cbr\u003e\u003ca href=\"https://camo.qiitausercontent.com/1eda8df79093b8584f501c083138acca12675611/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3231343131362f62633338646632372d323438362d346638352d346432392d6364366535386336353062642e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2Fbc38df27-2486-4f85-4d29-cd6e58c650bd.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=1891bbbeeb84e36d4002aac13953217d\" alt=\"Screen Shot 2018-01-20 at 7.28.38 AM.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/214116/bc38df27-2486-4f85-4d29-cd6e58c650bd.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2Fbc38df27-2486-4f85-4d29-cd6e58c650bd.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=d2d648557c108ec98f22d9b52b5ff2cb 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e4 Values に「松」「竹」「梅」をそれぞれ追加します。類義語を追加することもできます。\u003cbr\u003e\u003ca href=\"https://camo.qiitausercontent.com/b135f06da11e211a0bd1daa34013e7c29fdc4e77/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3231343131362f63343766333962652d373464652d633736642d346639372d3465383036373331356231632e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2Fc47f39be-74de-c76d-4f97-4e8067315b1c.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=22461e515ae2a6096ad27600afba7a0a\" alt=\"Screen Shot 2018-01-20 at 7.31.33 AM.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/214116/c47f39be-74de-c76d-4f97-4e8067315b1c.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2Fc47f39be-74de-c76d-4f97-4e8067315b1c.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=f9f0f90b8927722ccd2bf87d8de4c44d 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e5 Train ボタンをクリックして学習させます。Simple Entity と異なり、List は例文に対して指定する必要はありません。学習が終わったら、PUBLISH メニューより再度パブリッシュします。\u003c/p\u003e\n\n\u003cp\u003e6 注文の意図はあるがメニューがない場合の対応をコードに追加します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e \u003cspan class=\"nf\"\u003eHandleTextAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ereplyToken\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003euserMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003euserId\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e  \n    \u003cspan class=\"n\"\u003eISendMessage\u003c/span\u003e \u003cspan class=\"n\"\u003ereplyMessage\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eTextMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// LUIS で文章を解析\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eluisResult\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eluisClient\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ePredict\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003euserMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eluisResult\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTopScoringIntent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e\"greeting\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ereplyMessage\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eTextMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"どうもどうも\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eluisResult\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTopScoringIntent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e\"order\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// メニューエンティティがある場合\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eluisResult\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEntities\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eContainsKey\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"menu\"\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ereplyMessage\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eTextMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"毎度！\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eluisResult\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEntities\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"menu\"\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nf\"\u003eFirst\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e ですね！\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// 注文だがメニューがわからない場合はメニューをボタンで提示\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ereplyMessage\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eTemplateMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"menu\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eButtonsTemplate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n                \u003cspan class=\"n\"\u003etitle\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e\"注文\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e\"毎度！注文ですね。何にしましょう？\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eactions\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eITemplateAction\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(){\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMessageTemplateAction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"松\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003e\"松\"\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMessageTemplateAction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"竹\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003e\"竹\"\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMessageTemplateAction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"梅\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003e\"梅\"\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e}));\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003emessagingClient\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReplyMessageAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereplyToken\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eISendMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003ereplyMessage\u003c/span\u003e \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e7 再度デバッグを実行して、シミュレーターから「注文をおねがい」と送ります。ボタンテンプレートが返ってくることを確認します。\u003cbr\u003e\u003ca href=\"https://camo.qiitausercontent.com/5a64b7ac830f4ced63fe8843860709858ef776ae/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3231343131362f61313935626265352d333339382d386265312d373639622d3161356437336435653662632e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2Fa195bbe5-3398-8be1-769b-1a5d73d5e6bc.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=7f96edafc97533838762333300de0e6d\" alt=\"Screen Shot 2018-01-20 at 7.55.33 AM.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/214116/a195bbe5-3398-8be1-769b-1a5d73d5e6bc.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2Fa195bbe5-3398-8be1-769b-1a5d73d5e6bc.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=b0d7322840ac7c3f1c57c08434789326 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e8 これで注文を受ける箇所はうまくいきそうです。次に出前先の住所を確認します。ここで重要な点はすでに聞いた注文を忘れないように保存しておくことです。テンプレートは EventSourceState というデータ構造をストレージに格納できるようになっているのでこれを拡張します。まず注文と出前先を格納するクラスを追加します。Models フォルダに Order.cs を追加します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eOrder.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eMicrosoft.WindowsAzure.Storage.Table\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003esushibot.Models\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eOrder\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eEventSourceState\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eMenu\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eLocation_Address\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eLocation_Title\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eOrder\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eSourceType\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"order\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e9 テーブルストレージが Order を使うように Controllers¥LineBotControllers.cs の Post メソッドを変更します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eControllers¥LineBotController.cs-Postメソッド\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eIActionResult\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003ePost\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e\u003cspan class=\"n\"\u003eFromBody\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"n\"\u003eJToken\u003c/span\u003e \u003cspan class=\"n\"\u003ereq\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e \n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eevents\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eWebhookEventParser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eParse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereq\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToString\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003econnectionString\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eappsettings\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLineSettings\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eStorageConnectionString\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eblobStorage\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eBlobStorage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003econnectionString\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"linebotcontainer\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eorderState\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eTableStorage\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eOrder\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003econnectionString\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"eventsourcestate\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eapp\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eLineBotApp\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elineMessagingClient\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eorderState\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eblobStorage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eapp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRunAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eevents\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eOkResult\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e10 LineBotApp.cs を以下のコードに差し替えます。主な変更は以下の通りです。\u003cbr\u003e\n- Order を使うようにプロパティとコンストラクターの変更\u003cbr\u003e\n- 位置情報をハンドルするように OnMessageAsync での処理と HandleLocationAsync の追加。\u003cbr\u003e\n- HandleTextAsync メソッド内で Order の保存や、位置情報の確認ロジックの追加。\u003cbr\u003e\n尚、位置情報の確認は地図を利用してもらうように\u003ca href=\"https://developers.line.me/ja/docs/messaging-api/using-line-url-scheme/#opening-the-location-screen\" rel=\"nofollow noopener\" target=\"_blank\"\u003eURL スキーム\u003c/a\u003eを利用しています。\u003cbr\u003e\n* LuisClient に渡す AppId と AppKey はそれぞれ自身のものに変更してください。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eLineBotApp.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eLine.Messaging\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eLine.Messaging.Webhooks\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Collections.Generic\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.IO\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Linq\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Threading.Tasks\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003esushibot.CloudStorage\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003esushibot.Models\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eMicrosoft.Cognitive.LUIS\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003esushibot\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003einternal\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eLineBotApp\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eWebhookApplication\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eLineMessagingClient\u003c/span\u003e \u003cspan class=\"n\"\u003emessagingClient\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eTableStorage\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eOrder\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eorderState\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eBlobStorage\u003c/span\u003e \u003cspan class=\"n\"\u003eblobStorage\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eLuisClient\u003c/span\u003e \u003cspan class=\"n\"\u003eluisClient\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eLuisClient\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eappId\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e\"12819323-19e6-4103-aaa0-352d14fc2cfa\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eappKey\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e\"4501df87a8944328b3bd07ed8adb6508\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eLineBotApp\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLineMessagingClient\u003c/span\u003e \u003cspan class=\"n\"\u003elineMessagingClient\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eTableStorage\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eOrder\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003etableStorage\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eBlobStorage\u003c/span\u003e \u003cspan class=\"n\"\u003eblobStorage\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emessagingClient\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003elineMessagingClient\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eorderState\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etableStorage\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eblobStorage\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eblobStorage\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eprotected\u003c/span\u003e \u003cspan class=\"k\"\u003eoverride\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnMessageAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eMessageEvent\u003c/span\u003e \u003cspan class=\"n\"\u003eev\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eswitch\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eev\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eType\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"n\"\u003eEventMessageType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eText\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"nf\"\u003eHandleTextAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eev\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eReplyToken\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003eTextEventMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eev\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003eText\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eev\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSource\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUserId\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"n\"\u003eEventMessageType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLocation\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003elocation\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003eLocationEventMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eev\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"nf\"\u003eHandleLocationAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eev\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eReplyToken\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003elocation\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eev\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSource\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eId\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e \u003cspan class=\"nf\"\u003eHandleLocationAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ereplyToken\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eLocationEventMessage\u003c/span\u003e \u003cspan class=\"n\"\u003elocation\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003euserId\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// Order ステートを取得\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eorder\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eorderState\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFindAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"order\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003euserId\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// 住所を設定後保存\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eorder\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLocation_Address\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003elocation\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAddress\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eorder\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLocation_Title\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003elocation\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTitle\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eorderState\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eUpdateAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eorder\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003emessagingClient\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReplyMessageAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereplyToken\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                        \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eTextMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"あいよ！\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eorder\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMenu\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003eを\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eorder\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLocation_Title\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003eにだね！\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e \u003cspan class=\"nf\"\u003eHandleTextAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ereplyToken\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003euserMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003euserId\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eISendMessage\u003c/span\u003e \u003cspan class=\"n\"\u003ereplyMessage\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eTextMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// LUIS で文章を解析\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eluisResult\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eluisClient\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ePredict\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003euserMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eluisResult\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTopScoringIntent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e\"greeting\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003ereplyMessage\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eTextMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"どうもどうも\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eluisResult\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTopScoringIntent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e\"order\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// メニューエンティティがある場合\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eluisResult\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEntities\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eContainsKey\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"menu\"\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"c1\"\u003e// メニューを取得して、Order を Azure テーブルに保存\u003c/span\u003e\n                    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003emenu\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eluisResult\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEntities\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"menu\"\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nf\"\u003eFirst\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eorder\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eOrder\u003c/span\u003e\u003cspan class=\"p\"\u003e(){\u003c/span\u003e \u003cspan class=\"n\"\u003eMenu\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emenu\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eSourceId\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003euserId\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eorderState\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eUpdateAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eorder\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                    \u003cspan class=\"c1\"\u003e// 住所の確認に地図を起動するスキームを送信\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003ereplyMessage\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eTemplateMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"location\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eButtonsTemplate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003etitle\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e\"住所の送信\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e$\"毎度！\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003emenu\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003eですね。どちらにお送りしましょう？\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003eactions\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eITemplateAction\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(){\u003c/span\u003e\n                            \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eUriTemplateAction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"住所を送る\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003e\"line://nv/location\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                            \u003cspan class=\"p\"\u003e}));\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"c1\"\u003e// 注文だがメニューがわからない場合はメニューをボタンで提示\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003ereplyMessage\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eTemplateMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"menu\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eButtonsTemplate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003etitle\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e\"注文\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e\"毎度！注文ですね。何にしましょう？\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003eactions\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eITemplateAction\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(){\u003c/span\u003e\n                            \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMessageTemplateAction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"松\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003e\"松\"\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n                            \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMessageTemplateAction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"竹\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003e\"竹\"\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n                            \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMessageTemplateAction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"梅\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003e\"梅\"\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n                            \u003cspan class=\"p\"\u003e}));\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n            \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003emessagingClient\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReplyMessageAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereplyToken\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eISendMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003ereplyMessage\u003c/span\u003e \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"クラウドへのデプロイとテスト\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%AF%E3%83%A9%E3%82%A6%E3%83%89%E3%81%B8%E3%81%AE%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E3%81%A8%E3%83%86%E3%82%B9%E3%83%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eクラウドへのデプロイとテスト\u003c/h1\u003e\n\n\u003cp\u003e最後に最新のコードをデプロイしてテストしてみましょう。\u003c/p\u003e\n\n\u003cp\u003e1 以下のコマンドで変更をコミットして、デプロイをします。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003egit add .\ngit commit -m update\ngit push\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e2 プッシュが完了したらモバイル端末で LINE を起動します。まず挨拶と出前依頼を送ってみます。\u003cbr\u003e\u003ca href=\"https://camo.qiitausercontent.com/3bc220657e3e04a531895761ea28619a05a191cd/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3231343131362f61613332306531362d363166622d303065622d346462612d3263643563653335353861322e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2Faa320e16-61fb-00eb-4dba-2cd5ce3558a2.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=3910ee61500d9b9814471472084a6a52\" alt=\"Screen Shot 2018-01-20 at 9.58.30 AM.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/214116/aa320e16-61fb-00eb-4dba-2cd5ce3558a2.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2Faa320e16-61fb-00eb-4dba-2cd5ce3558a2.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=efb6a4a60cea65d8e84eba430932185c 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e3 メニューを選ぶと住所を聞かれます。\u003cbr\u003e\u003ca href=\"https://camo.qiitausercontent.com/806d596991368dbf1876e2993fca9be71a8b87b8/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3231343131362f39653637646163642d396562612d613730642d643132332d3330386438653239313532332e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2F9e67dacd-9eba-a70d-d123-308d8e291523.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=d83b4851c7fc5f64d9d2e16e34d527a2\" alt=\"Screen Shot 2018-01-20 at 10.00.08 AM.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/214116/9e67dacd-9eba-a70d-d123-308d8e291523.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2F9e67dacd-9eba-a70d-d123-308d8e291523.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=8ce1fab19a5d02f918ba77fbd99c75e1 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e4 住所を送るボタンをクリックすると地図が開きます。任意の住所を送ります。\u003cbr\u003e\u003ca href=\"https://camo.qiitausercontent.com/37ea284034e21beda68bf6c823ed427b65ce9e8f/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3231343131362f37623664643038612d666134642d663361642d386463382d6538613761636133616361342e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2F7b6dd08a-fa4d-f3ad-8dc8-e8a7aca3aca4.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=61a1d5b1b4e5a53a32cb36e09b51b4ec\" alt=\"Screen Shot 2018-01-20 at 10.01.41 AM.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/214116/7b6dd08a-fa4d-f3ad-8dc8-e8a7aca3aca4.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2F7b6dd08a-fa4d-f3ad-8dc8-e8a7aca3aca4.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=8ec15cf5f9b5c20ade5d81710cfa10d0 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e5 注文と住所が正しく認識されることを確認します。\u003cbr\u003e\u003ca href=\"https://camo.qiitausercontent.com/317e868a58ebd9850ace9673783410e63af1ab91/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3231343131362f65666633626466302d373331312d316163662d626439372d6166396534363235373962302e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2Feff3bdf0-7311-1acf-bd97-af9e462579b0.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=2f729183007d50deae1aa40ca395ead0\" alt=\"Screen Shot 2018-01-20 at 10.02.18 AM.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/214116/eff3bdf0-7311-1acf-bd97-af9e462579b0.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F214116%2Feff3bdf0-7311-1acf-bd97-af9e462579b0.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=4b8d41f299bbe7be361a032a123a7bee 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"まとめ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eまとめ\u003c/h1\u003e\n\n\u003cp\u003e今回は Bot が自然言語からユーザーが求めていることを理解し、文脈も加味しながら対話できるまでを実装しました。\u003c/p\u003e\n\n\u003cp\u003eこの後はいろいろなメッセージに対して適切に反応できるように理解力とスキルを広げていく、精度をあげていくということが求められると思います。Bot 開発はまだまだ確立した開発手法というものは存在せず、開発者の腕にかかっている分野で、そこがまた魅力的なところですね。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"付録\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BB%98%E9%8C%B2\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e付録\u003c/h1\u003e\n\n\u003cp\u003eLINEのBot開発にあたり有用なライブラリ・ツールをご紹介しておきます。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://developers.line.me/ja/docs/messaging-api/line-bot-sdk/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eMessaging API - 公式SDK\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/pierre3/LineMessagingApi\" rel=\"nofollow noopener\" target=\"_blank\"\u003eMessaging API - Community SDK - C#\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://www.npmjs.com/package/line-simulator\" rel=\"nofollow noopener\" target=\"_blank\"\u003eLINE Simulator for BOT developer\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://www.npmjs.com/package/line-richmenus-manager\" rel=\"nofollow noopener\" target=\"_blank\"\u003eLINE Rich Menus Manager\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://www.npmjs.com/package/generator-line-bot\" rel=\"nofollow noopener\" target=\"_blank\"\u003eLINE Bot Template\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/nkjm/bot-express\" rel=\"nofollow noopener\" target=\"_blank\"\u003ebot-express\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n","createdAt":"2018-01-20T18:09:59Z","elapsedYearsFromLastModifiedAt":3,"encryptedId":"8J2gvGZlCMWov9sigRwB9AyuvFTT+yAE--16VFS2zFBOOaVYmx--KAcLoo1DFYMF40raC7fh0A==","isBanned":false,"isDeprecated":true,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2018-02-23T02:09:08Z","likesCount":19,"linkUrl":"https://qiita.com/kenakamu/items/ac4922a2061f4f8f02d9","organization":{"description":"マイクロソフトのメンバーがMicrosoft Azureをはじめとする最新技術情報をお届けします。Twitterアカウント（@msdevjp）やYouTubeチャンネル「クラウドデベロッパーちゃんねる」も運用中です。","encryptedId":"1zfQ5OzvR8Nt3L1pRI5aop4XnlVbYe5+xRX0--pNzWNDSzTHLmLT9a--m7HG4zObg8ah/0SbFae4lA==","isBetaReleaseEnabled":true,"isFollowableByViewer":true,"isFollowedByViewer":false,"logoUrl":"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/bae6d3a0828c019ff259cdb47a8988c98636389f/original.jpg?1583721865","name":"Microsoft","url":"https://azure.microsoft.com/ja-jp/developer/","urlName":"microsoft"},"originalId":601774,"stockedCount":19,"title":"LINE の Bot 開発 C# 超入門（後編） メッセージの内容と文脈を意識した会話を実現する","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E9%96%8B%E7%99%BA%E3%81%AE%E6%B5%81%E3%82%8C\"\u003e開発の流れ\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%89%8B%E9%A0%86\"\u003e手順\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E8%87%AA%E7%84%B6%E8%A8%80%E8%AA%9E%E8%A7%A3%E6%9E%90%E3%81%AE%E8%A8%AD%E5%AE%9A\"\u003e自然言語解析の設定\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#luis-%E3%81%AE%E5%85%AC%E9%96%8B%E3%81%A8%E3%82%AD%E3%83%BC%E3%81%AE%E5%8F%96%E5%BE%97\"\u003eLUIS の公開とキーの取得\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#bot-%E3%81%AB%E8%87%AA%E7%84%B6%E8%A8%80%E8%AA%9E%E8%A7%A3%E6%9E%90%E3%81%AE%E8%BF%BD%E5%8A%A0\"\u003eBot に自然言語解析の追加\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E8%87%AA%E7%84%B6%E8%A8%80%E8%AA%9E%E8%A7%A3%E6%9E%90%E3%81%A8%E3%83%95%E3%83%AD%E3%83%BC%E3%81%AE%E6%94%B9%E5%96%84\"\u003e自然言語解析とフローの改善\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%AF%E3%83%A9%E3%82%A6%E3%83%89%E3%81%B8%E3%81%AE%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E3%81%A8%E3%83%86%E3%82%B9%E3%83%88\"\u003eクラウドへのデプロイとテスト\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"\u003eまとめ\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%BB%98%E9%8C%B2\"\u003e付録\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":3909,"uuid":"ac4922a2061f4f8f02d9","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"Mdl87Aye3inhTaOAI/0StFM0YuWc--uod98LdrHUOLjxeD--njeW/3m7VspsA9bB0ZOG6g==","originalId":214116,"description":"","facebookUrl":"https://facebook.com/kenichiro.nakamura.5249","githubUrl":"https://github.com/kenakamu","isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":"https://www.linkedin.com/in/kenakamu108","name":"","profileImageUrl":"https://avatars2.githubusercontent.com/u/9940668?v=4","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Favatars2.githubusercontent.com%2Fu%2F9940668%3Fv%3D4?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=e3f74068d6caf1adeace5f24c9eba966","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Favatars2.githubusercontent.com%2Fu%2F9940668%3Fv%3D4?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=ba853bb83e6142e6ea6854e823ed9241","urlName":"kenakamu","websiteUrl":"http://github.com/kenakamu","twitterUrl":"https://twitter.com/kenakamu108","twitterUrlName":"kenakamu108","revealedOrganizations":{"edges":[{"node":{"encryptedId":"EdFH2lNZfNFOSs5O90CvZ+7GqBnY3uaA63+u--2IIr/WlFxJ1NKyv0--AhOJ+moZnCA1iO5xxd5hkw==","isBetaReleaseEnabled":true,"isFollowableByViewer":true,"isFollowedByViewer":false,"name":"Microsoft","logoUrl":"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/bae6d3a0828c019ff259cdb47a8988c98636389f/original.jpg?1583721865","urlName":"microsoft","description":"マイクロソフトのメンバーがMicrosoft Azureをはじめとする最新技術情報をお届けします。Twitterアカウント（@msdevjp）やYouTubeチャンネル「クラウドデベロッパーちゃんねる」も運用中です。","url":"https://azure.microsoft.com/ja-jp/developer/"}}]}},"tags":[{"name":"C#","urlName":"csharp"},{"name":"Line","urlName":"line"},{"name":"bot","urlName":"bot"},{"name":"linebot","urlName":"linebot"},{"name":"LINEmessagingAPI","urlName":"linemessagingapi"}],"followingLikers":{"edges":[]},"comments":{"totalCount":0}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

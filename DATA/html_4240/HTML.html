<!DOCTYPE html><html><head><meta charset="utf-8" /><title>Visual Studio 2019 Preview 1 が公開されたので null 許容参照型を試してみた - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/chocolamint/items/e3fed4b8fa2d4767683e" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="TeDVLK91F8RgHwKpR3tcY215e9BYWftUCZV2U5TMxLOnveIi5kvcuHOguRBDm9dY7+Dh7K+JAY3QxrEglpRJhA==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta content="@chocolamint" name="twitter:creator" /><meta property="og:type" content="article"><meta property="og:title" content="Visual Studio 2019 Preview 1 が公開されたので null 許容参照型を試してみた - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1WbWx6ZFdGc0lGTjBkV1JwYnlBeU1ERTVJRkJ5WlhacFpYY2dNU0RqZ1l6bGhhenBsb3ZqZ1pYamdvempnWl9qZ2E3amdhY2diblZzYkNEb3FMSGxycm5sajRMbmhhZmxub3ZqZ3BMb3FhYmpnWmZqZ2FiamdiX2pnWjgmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT01NCZ0eHQtY2xpcD1lbGxpcHNpcyZ0eHQtYWxpZ249Y2VudGVyJTJDbWlkZGxlJnM9NDY4MTUwOGJlMGM4ZGQxZjQ3NmYxYTI0YjViZjdkNDk&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RR05vYjJOdmJHRnRhVzUwJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NDUmdHh0LWFsaWduPXJpZ2h0JTJDYm90dG9tJnM9ZmMzYjA5NDM2MGE4ZWRhYzZlYjcxOTRiY2QxMjQ4NTE&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=071cdabc25750789c6eb94bcab3bf6d6"><meta property="og:description" content="旬をすぎてしまった感がありますが Visual Studio 2019 Preview 1 が公開されたようなので null 許容参照型（Nullable reference types）を手元のプロジェクトで試してみました。

「気..."><meta content="https://qiita.com/chocolamint/items/e3fed4b8fa2d4767683e" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#,.NET" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 1nzh4zz 38fzdi helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-1nzh4zz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:16px 32px;background-color:#FBE69E;color:rgba(0,0,0,0.87);line-height:1.5;font-weight:600;}@media (max-width:770px){.css-1nzh4zz{padding:16px;}}.css-38fzdi{color:#CA832A;margin-right:4px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-c691bf2c-f378-46c0-9f0d-e270c9fe3ff6"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Fchocolamint%2Fitems%2Fe3fed4b8fa2d4767683e">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Fchocolamint%2Fitems%2Fe3fed4b8fa2d4767683e">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-c691bf2c-f378-46c0-9f0d-e270c9fe3ff6">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2018-12-10T13:14:35.000+09:00","dateModified":"2018-12-10T13:18:18.000+09:00","headline":"Visual Studio 2019 Preview 1 が公開されたので null 許容参照型を試してみた","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1WbWx6ZFdGc0lGTjBkV1JwYnlBeU1ERTVJRkJ5WlhacFpYY2dNU0RqZ1l6bGhhenBsb3ZqZ1pYamdvempnWl9qZ2E3amdhY2diblZzYkNEb3FMSGxycm5sajRMbmhhZmxub3ZqZ3BMb3FhYmpnWmZqZ2FiamdiX2pnWjgmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT01NCZ0eHQtY2xpcD1lbGxpcHNpcyZ0eHQtYWxpZ249Y2VudGVyJTJDbWlkZGxlJnM9NDY4MTUwOGJlMGM4ZGQxZjQ3NmYxYTI0YjViZjdkNDk\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RR05vYjJOdmJHRnRhVzUwJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NDUmdHh0LWFsaWduPXJpZ2h0JTJDYm90dG9tJnM9ZmMzYjA5NDM2MGE4ZWRhYzZlYjcxOTRiY2QxMjQ4NTE\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=071cdabc25750789c6eb94bcab3bf6d6","mainEntityOfPage":"https://qiita.com/chocolamint/items/e3fed4b8fa2d4767683e","author":{"@type":"Person","address":"","email":null,"identifier":"chocolamint","name":"chocolamint","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F11978%2Fprofile-images%2F1473682231?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=3d43baa24ec727bbcfd8eefae78b21bf","url":"https://qiita.com/chocolamint","description":"GitHub の使い方がわからない情弱です。\r\n主に C# とか JavaScript とか TypeScript とか。\r\n\r\n","memberOf":[]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://zine.qiita.com/interview/202105-uzabase-2/?utm_source=qiita&amp;utm_medium=header-banner">急成長する「NewsPicks」ブランドの開発思想を探る</a><a target="_blank" id="header_text_message_2" href="https://zine.qiita.com/interview/202105-uzabase-2/?utm_source=qiita&amp;utm_medium=header-banner">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"chocolamint","type":"items","id":"e3fed4b8fa2d4767683e"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"急成長する「NewsPicks」ブランドの開発思想を探る","url":"https://zine.qiita.com/interview/202105-uzabase-2/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"chocolamint","type":"items","id":"e3fed4b8fa2d4767683e"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_1","message":"急成長する「NewsPicks」ブランドの開発思想を探る","url":"https://zine.qiita.com/interview/202105-uzabase-2/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"chocolamint","type":"items","id":"e3fed4b8fa2d4767683e"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_2","message":"急成長する「NewsPicks」ブランドの開発思想を探る","url":"https://zine.qiita.com/interview/202105-uzabase-2/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/chocolamint/items/e3fed4b8fa2d4767683e","location":"/chocolamint/items/e3fed4b8fa2d4767683e","scheme":"https","host":"qiita.com","port":null,"pathname":"/chocolamint/items/e3fed4b8fa2d4767683e","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"ChTM8CMg1deVuD+EChvhG6jaDk4EIT4doysfy6ZrXhHgSfv+ah4eq4YHhD0O+2ogKkOUcvPxxMR6eNi4pDPTJg==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-344ebe12-d85c-47e3-a726-2ebffb22ac11"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/chocolamint/items/e3fed4b8fa2d4767683e/likers" class="css-1iupg5d">5</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">2</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/e3fed4b8fa2d4767683e/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/chocolamint/items/e3fed4b8fa2d4767683e/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/chocolamint/items/e3fed4b8fa2d4767683e/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/chocolamint/items/e3fed4b8fa2d4767683e/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/chocolamint/items/e3fed4b8fa2d4767683e.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-1nzh4zz"><span class="fa fa-fw fa-warning css-38fzdi"></span><p>More than 1 year has passed since last update.</p></div><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/chocolamint"><img class="css-100alwu eyfquo10" src="https://qiita-image-store.s3.amazonaws.com/0/11978/profile-images/1473682231" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/chocolamint" class="css-10ougpm">@<!-- -->chocolamint</a><div class="css-1ay9vb9"><span><meta content="2018-12-10T04:14:35Z"/><time dateTime="2018-12-10T04:18:18Z" class="css-m19uds">updated at 2018-12-10</time></span></div></div></div></div></div><h1 class="css-cgzq40">Visual Studio 2019 Preview 1 が公開されたので null 許容参照型を試してみた</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/.net" class="css-4czcte">.NET</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div><p>旬をすぎてしまった感がありますが<a href="https://forest.watch.impress.co.jp/docs/news/1156690.html" rel="nofollow noopener" target="_blank"> Visual Studio 2019 Preview 1 が公開された</a>ようなので<a href="https://github.com/dotnet/csharplang/blob/master/proposals/nullable-reference-types.md" rel="nofollow noopener" target="_blank"> null 許容参照型（Nullable reference types）</a>を手元のプロジェクトで試してみました。</p>

<p>「気になってるけど自分で試すのは面倒くさい」「自分以外の人がどう感じたか知りたい」「手元に程よい規模のソースがないから試しづらい」みたいな人は読んでみてください。</p>

<p><a href="https://visualstudio.microsoft.com/ja/vs/preview/" rel="nofollow noopener" target="_blank">Visual Studio 2019 Preview 1 はこちらからダウンロード</a>できます（たぶん時期が過ぎたらこのリンクは機能しなくなります）。</p>

<h1>
<span id="バグが見つかった" class="fragment"></span><a href="#%E3%83%90%E3%82%B0%E3%81%8C%E8%A6%8B%E3%81%A4%E3%81%8B%E3%81%A3%E3%81%9F"><i class="fa fa-link"></i></a>バグが見つかった</h1>

<p><code>null</code> の可能性があるにも関わらず考慮していなかった箇所がさっそく見つかりました。<br>
元々「この機能（Nullable reference types）、ぶっちゃけ微妙では…」と感じていたところがあった自分としては、「お、役に立つのでは」と印象が変わりました。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">修正前</span></div>
<div class="highlight"><pre><code><span class="n">events</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">TargetYear</span> <span class="p">==</span> <span class="k">null</span> <span class="p">||</span> <span class="n">x</span><span class="p">.</span><span class="n">Date</span><span class="p">.</span><span class="n">Year</span> <span class="p">==</span> <span class="n">TargetYear</span><span class="p">)</span>
      <span class="c1">// x.Place が null だとここでヌルリ</span>
      <span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="p">!</span><span class="n">x</span><span class="p">.</span><span class="n">Place</span><span class="p">.</span><span class="n">Name</span><span class="p">.</span><span class="nf">StartsWith</span><span class="p">(</span><span class="s">"!_"</span><span class="p">))</span>
</code></pre></div>
</div>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">修正後</span></div>
<div class="highlight"><pre><code><span class="n">events</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">TargetYear</span> <span class="p">==</span> <span class="k">null</span> <span class="p">||</span> <span class="n">x</span><span class="p">.</span><span class="n">Date</span><span class="p">.</span><span class="n">Year</span> <span class="p">==</span> <span class="n">TargetYear</span><span class="p">)</span>
      <span class="c1">// x.Place が null のものは除外してよかったので条件を追加した</span>
      <span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Place</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">&amp;&amp;</span> <span class="p">!</span><span class="n">x</span><span class="p">.</span><span class="n">Place</span><span class="p">.</span><span class="n">Name</span><span class="p">.</span><span class="nf">StartsWith</span><span class="p">(</span><span class="s">"!_"</span><span class="p">))</span>
</code></pre></div>
</div>

<h1>
<span id="cs8618-non-nullable-field-is-uninitialized-がツラくなってきた" class="fragment"></span><a href="#cs8618-non-nullable-field-is-uninitialized-%E3%81%8C%E3%83%84%E3%83%A9%E3%81%8F%E3%81%AA%E3%81%A3%E3%81%A6%E3%81%8D%E3%81%9F"><i class="fa fa-link"></i></a>CS8618 Non-nullable field is uninitialized. がツラくなってきた</h1>

<p>Kotlin なんかでも似たようなまどろっこしさがありますが、当然のことながら Non-nullable なフィールド・プロパティはコンストラクタやイニシャライザで初期化されなければいけません。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre><code><span class="k">public</span> <span class="k">class</span> <span class="nc">Hoge</span>
             <span class="p">~~~~</span> <span class="n">Non</span><span class="p">-</span><span class="n">nullable</span> <span class="n">property</span> <span class="err">'</span><span class="n">Fuga</span><span class="err">'</span> <span class="k">is</span> <span class="n">uninitalized</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Fuga</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>それはわかる、わかるのですが、POCO なプロパティの多いクラスですべてのプロパティをコンストラクタの引数として受け取るのは正直ツラく、また、API の戻り値としてデシリアライズによってインスタンス化されるクラスなんかの場合は「常に null はこないプロパティだけどコンストラクタは別に定義したくないんだよなぁ」となりモニョります。</p>

<p>定義側ではなく利用側に初期化の責務を負わせて、オブジェクト初期化子を使いたい（デシリアライズの場合はまぁ諦める。元々すべてを網羅することは諦めている機能だと思っているので）みたいな要望。</p>

<p>匿名型のように「不変（immutable）だけどコンストラクタパラメーターではなくオブジェクト初期化子で初期化したい」というのは以前から思ってはいたことで、調べてみたら<a href="https://github.com/dotnet/csharplang/issues/322" rel="nofollow noopener" target="_blank"> Implement property initializers for immutable types #322 </a>で既に提案されているようですね。</p>

<p>私が今回遭遇したケースにおいては <a href="https://github.com/dotnet/csharplang/issues/39" rel="nofollow noopener" target="_blank">Records</a> を使うのが正しいアプローチのような気がします。C# よくわからないですが。</p>

<p>結局、 <code>#pragma warning disable CS8618 // Non-nullable field is uninitialized.</code> をつけて回ることで一旦回避しました。</p>

<h1>
<span id="caller-info-属性は考慮されない" class="fragment"></span><a href="#caller-info-%E5%B1%9E%E6%80%A7%E3%81%AF%E8%80%83%E6%85%AE%E3%81%95%E3%82%8C%E3%81%AA%E3%81%84"><i class="fa fa-link"></i></a>Caller Info 属性は考慮されない</h1>

<p>元々 <code>= null</code> と書かないといけないのが微妙だなぁとは思っていましたが、当然のことながら？ Caller Info 属性は考慮されませんでした。<br>
この辺は遭遇してみて初めて「あぁなるほど、こういうケースもあるのか」と思いましたね。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre><code><span class="k">public</span> <span class="k">void</span> <span class="nf">Hoge</span><span class="p">(</span>
    <span class="p">[</span><span class="n">CallerFilePath</span><span class="p">]</span> <span class="kt">string</span> <span class="n">filePath</span> <span class="p">=</span> <span class="k">null</span><span class="p">,</span>
                                       <span class="p">~~~~</span> <span class="n">Cannot</span> <span class="n">convert</span> <span class="k">null</span> <span class="n">literal</span> <span class="n">to</span> <span class="n">non</span><span class="p">-</span><span class="n">nullable</span> <span class="n">reference</span> <span class="n">or</span> <span class="n">unconstrained</span> <span class="n">type</span> <span class="n">parameter</span><span class="p">.</span>
    <span class="p">[</span><span class="n">CallerMemberName</span><span class="p">]</span> <span class="kt">string</span> <span class="n">member</span> <span class="p">=</span> <span class="k">null</span>
                                       <span class="p">~~~~</span> <span class="n">Cannot</span> <span class="n">convert</span> <span class="k">null</span> <span class="n">literal</span> <span class="n">to</span> <span class="n">non</span><span class="p">-</span><span class="n">nullable</span> <span class="n">reference</span> <span class="n">or</span> <span class="n">unconstrained</span> <span class="n">type</span> <span class="n">parameter</span><span class="p">.</span>
<span class="p">)</span>
</code></pre></div></div>

<p>仕方ないので <code>!</code> をつけます。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre><code><span class="k">public</span> <span class="k">void</span> <span class="nf">Hoge</span><span class="p">(</span>
    <span class="p">[</span><span class="n">CallerFilePath</span><span class="p">]</span> <span class="kt">string</span> <span class="n">filePath</span> <span class="p">=</span> <span class="k">null</span><span class="p">!,</span>
    <span class="p">[</span><span class="n">CallerMemberName</span><span class="p">]</span> <span class="kt">string</span> <span class="n">member</span> <span class="p">=</span> <span class="k">null</span><span class="p">!</span>
<span class="p">)</span>
</code></pre></div></div>

<h1>
<span id="匿名型のプロパティが強制的に-null-許容にされる" class="fragment"></span><a href="#%E5%8C%BF%E5%90%8D%E5%9E%8B%E3%81%AE%E3%83%97%E3%83%AD%E3%83%91%E3%83%86%E3%82%A3%E3%81%8C%E5%BC%B7%E5%88%B6%E7%9A%84%E3%81%AB-null-%E8%A8%B1%E5%AE%B9%E3%81%AB%E3%81%95%E3%82%8C%E3%82%8B"><i class="fa fa-link"></i></a>匿名型のプロパティが強制的に null 許容にされる</h1>

<p><a href="https://github.com/dotnet/roslyn/issues/25348" rel="nofollow noopener" target="_blank">Anonymous type display mismatch for nullable vs non-nullable #25348 </a> として報告が挙がっていました。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre><code><span class="kt">var</span> <span class="n">hoge</span> <span class="p">=</span> <span class="k">new</span> <span class="p">{</span> <span class="n">Foo</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Foo</span><span class="p">()</span> <span class="p">};</span>
<span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">hoge</span><span class="p">.</span><span class="n">Foo</span><span class="p">.</span><span class="n">Bar</span><span class="p">);</span> <span class="c1">// この場合はツールチップ上 Foo? になるだけで警告は出ない模様</span>
</code></pre></div></div>

<p>私が遭遇したのは↓のケースで、<code>Select</code> で匿名型を作ると問答無用で nullable なプロパティにされる様子？</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre><code><span class="kt">var</span> <span class="n">xs</span> <span class="p">=</span> <span class="n">Enumerable</span><span class="p">.</span><span class="nf">Range</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">1</span><span class="p">).</span><span class="nf">Select</span><span class="p">(</span><span class="n">_</span> <span class="p">=&gt;</span> <span class="k">new</span>
<span class="p">{</span>
    <span class="n">Foo</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Foo</span><span class="p">()</span>
<span class="p">});</span>

<span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">x</span> <span class="k">in</span> <span class="n">xs</span><span class="p">)</span>
    <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">Foo</span><span class="p">.</span><span class="n">Bar</span><span class="p">);</span>
                      <span class="p">~~~~~</span> <span class="n">Possible</span> <span class="n">dereference</span> <span class="n">of</span> <span class="n">a</span> <span class="k">null</span> <span class="n">reference</span><span class="p">.</span>
</code></pre></div></div>

<p>今回はほとんどのケースにおいてタプルでよかったためタプルに修正して回避しました。<br>
<a href="https://twitter.com/chocolamint/status/303417039073210369" rel="nofollow noopener" target="_blank">タプルかわいいよタプル</a>。</p>

<h1>
<span id="object-型の-null-フロー解析がおかしい" class="fragment"></span><a href="#object-%E5%9E%8B%E3%81%AE-null-%E3%83%95%E3%83%AD%E3%83%BC%E8%A7%A3%E6%9E%90%E3%81%8C%E3%81%8A%E3%81%8B%E3%81%97%E3%81%84"><i class="fa fa-link"></i></a>object 型の null フロー解析がおかしい？</h1>

<p>これはよくわかりませんでした。<code>if (value == null) return "";</code> で弾いてるつもりなのに警告が出ます。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre><code><span class="k">public</span> <span class="kt">string</span> <span class="nf">Hoge</span><span class="p">(</span><span class="kt">object</span> <span class="k">value</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">value</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span> <span class="k">return</span> <span class="s">""</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">value</span> <span class="k">is</span> <span class="kt">bool</span> <span class="n">b</span><span class="p">)</span> <span class="k">return</span> <span class="n">b</span> <span class="p">?</span> <span class="s">"true"</span> <span class="p">:</span> <span class="s">"false"</span><span class="p">;</span>

    <span class="k">return</span> <span class="k">value</span><span class="p">.</span><span class="nf">ToString</span><span class="p">();</span>
           <span class="p">~~~~~</span> <span class="n">Possible</span> <span class="n">dereference</span> <span class="n">of</span> <span class="n">a</span> <span class="k">null</span> <span class="n">reference</span><span class="p">.</span>
<span class="p">}</span>
</code></pre></div></div>

<p>引数を <code>object?</code> にしても同じ模様。とりあえず <code>value!</code> にしました……</p>

<h1>
<span id="ジェネリック型の変性的なやつが微妙な挙動" class="fragment"></span><a href="#%E3%82%B8%E3%82%A7%E3%83%8D%E3%83%AA%E3%83%83%E3%82%AF%E5%9E%8B%E3%81%AE%E5%A4%89%E6%80%A7%E7%9A%84%E3%81%AA%E3%82%84%E3%81%A4%E3%81%8C%E5%BE%AE%E5%A6%99%E3%81%AA%E6%8C%99%E5%8B%95"><i class="fa fa-link"></i></a>ジェネリック型の変性的なやつが微妙な挙動</h1>

<p><code>Task&lt;Foo?&gt;</code> に対して <code>Task.FromResult</code> を使うときになんとも微妙な挙動をします。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">まぁわかる</span></div>
<div class="highlight"><pre><code><span class="k">public</span> <span class="n">Task</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">?&gt;</span> <span class="nf">GetBodyAsync</span><span class="p">()</span>
    <span class="p">=&gt;</span> <span class="n">Task</span><span class="p">.</span><span class="nf">FromResult</span><span class="p">(</span><span class="s">""</span><span class="p">);</span>
       <span class="p">~~~~~~~~~~~~~~~~~~~</span> <span class="n">Nullability</span> <span class="n">of</span> <span class="n">reference</span> <span class="n">types</span> <span class="k">in</span> <span class="k">value</span> <span class="n">of</span> <span class="n">type</span> <span class="err">'</span><span class="n">Task</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span><span class="err">'</span> <span class="n">doesn</span><span class="err">'</span><span class="n">t</span> <span class="n">match</span> <span class="n">target</span> <span class="n">type</span> <span class="err">'</span><span class="n">Task</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">?&gt;</span><span class="err">'</span><span class="p">.</span>
</code></pre></div>
</div>

<p>型が合わないと警告が出るので、型引数の明示が必要なのですが、実際に書くと「不要」としてグレーアウトされます。<br>
また、フロー解析がそこまで賢くないためかキャストでは警告が消えません。<br>
プレビュー版だからでしょうか。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre><code><span class="k">public</span> <span class="n">Task</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">?&gt;</span> <span class="nf">GetBodyAsync</span><span class="p">()</span>
    <span class="p">=&gt;</span> <span class="n">Task</span><span class="p">.</span><span class="n">FromResult</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">?&gt;(</span><span class="s">""</span><span class="p">);</span> <span class="c1">// こうする。&lt;string?&gt; が冗長だとして薄くなるけどｼｮｰｶﾞﾅｲ</span>

<span class="k">public</span> <span class="n">Task</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">?&gt;</span> <span class="nf">GetBodyAsync</span><span class="p">()</span>
    <span class="p">=&gt;</span> <span class="n">Task</span><span class="p">.</span><span class="nf">FromResult</span><span class="p">((</span><span class="kt">string</span><span class="p">?)</span><span class="s">""</span><span class="p">);</span> <span class="c1">// これだと Task&lt;string?&gt; とみなしてくれない</span>
       <span class="p">~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span> <span class="n">Nullability</span> <span class="n">of</span> <span class="n">reference</span> <span class="n">types</span> <span class="k">in</span> <span class="k">value</span> <span class="n">of</span> <span class="n">type</span> <span class="err">'</span><span class="n">Task</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span><span class="err">'</span> <span class="n">doesn</span><span class="err">'</span><span class="n">t</span> <span class="n">match</span> <span class="n">target</span> <span class="n">type</span> <span class="err">'</span><span class="n">Task</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">?&gt;</span><span class="err">'</span><span class="p">.</span>
</code></pre></div></div>

<h1>
<span id="メソッドを通しての-null-チェックに弱い" class="fragment"></span><a href="#%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%82%92%E9%80%9A%E3%81%97%E3%81%A6%E3%81%AE-null-%E3%83%81%E3%82%A7%E3%83%83%E3%82%AF%E3%81%AB%E5%BC%B1%E3%81%84"><i class="fa fa-link"></i></a>メソッドを通しての null チェックに弱い</h1>

<p><code>Where</code> で <code>null</code> を除外してもフロー解析が働きません。<br>
<code>Where</code> だけ特別扱いできないので、仕方ないといえば仕方ないですが結構ツラいです。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre><code><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Foo</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
<span class="p">.</span><span class="nf">Select</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Foo</span><span class="p">.</span><span class="n">Bar</span><span class="p">)</span>
             <span class="p">~~~~~</span> <span class="n">Possible</span> <span class="n">dereference</span> <span class="n">of</span> <span class="n">a</span> <span class="k">null</span> <span class="n">reference</span><span class="p">.</span>
</code></pre></div></div>

<p>同じ理由により、UT なんかで <code>null</code> じゃないことをアサーションしたあとでもフロー解析は働きません。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre><code><span class="n">Assert</span><span class="p">.</span><span class="nf">NotNull</span><span class="p">(</span><span class="n">foo</span><span class="p">);</span>
<span class="n">Assert</span><span class="p">.</span><span class="nf">Equal</span><span class="p">(</span><span class="s">""</span><span class="p">,</span> <span class="n">foo</span><span class="p">.</span><span class="n">Bar</span><span class="p">);</span>
                 <span class="p">~~~</span> <span class="n">Possible</span> <span class="n">dereference</span> <span class="n">of</span> <span class="n">a</span> <span class="k">null</span> <span class="n">reference</span><span class="p">.</span>
</code></pre></div></div>

<p><a href="https://kotlinlang.org/docs/reference/whatsnew13.html#contracts" rel="nofollow noopener" target="_blank">Kotlin 1.3 では Contracts によって解決を図っている</a>ので C# も頑張ってほしいですね。</p>

<h1>
<span id="おまけ-taskcompletionsource-のために-first-class-void-が欲しくなる" class="fragment"></span><a href="#%E3%81%8A%E3%81%BE%E3%81%91-taskcompletionsource-%E3%81%AE%E3%81%9F%E3%82%81%E3%81%AB-first-class-void-%E3%81%8C%E6%AC%B2%E3%81%97%E3%81%8F%E3%81%AA%E3%82%8B"><i class="fa fa-link"></i></a>(おまけ) TaskCompletionSource のために first-class Void が欲しくなる</h1>

<p>もはや Non-null reference type あんまり関係ないですが、<code>TaskCompletionSource.SetResult(null)</code> していたところが警告になったので<a href="https://github.com/dotnet/csharplang/issues/1603" rel="nofollow noopener" target="_blank"> System.Void as a first-class type #1603 </a>が早く欲しくなりました。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">TaskCompletionSource&lt;object&gt;というよりTaskCompletionSource&lt;void&gt;を使いたい</span></div>
<div class="highlight"><pre><code><span class="k">public</span> <span class="n">Task</span> <span class="nf">HogeAsync</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">taskCompletionSource</span> <span class="p">=</span> <span class="k">new</span> <span class="n">TaskCompletionSource</span><span class="p">&lt;</span><span class="kt">object</span><span class="p">&gt;();</span>
    <span class="n">_foo</span><span class="p">.</span><span class="n">Completed</span> <span class="p">=&gt;</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span> <span class="p">=&gt;</span>
    <span class="p">{</span>
        <span class="n">taskCompletionSource</span><span class="p">.</span><span class="nf">SetResult</span><span class="p">(</span><span class="k">null</span><span class="p">);</span>
                                       <span class="p">~~~~</span> <span class="n">Cannot</span> <span class="n">convert</span> <span class="k">null</span> <span class="n">literal</span> <span class="n">to</span> <span class="n">non</span><span class="p">-</span><span class="n">nullable</span> <span class="n">reference</span> <span class="n">or</span> <span class="n">unconstrained</span> <span class="n">type</span> <span class="n">parameter</span><span class="p">.</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="n">taskCompletionSource</span><span class="p">.</span><span class="n">Task</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</div>

<h1>
<span id="総評" class="fragment"></span><a href="#%E7%B7%8F%E8%A9%95"><i class="fa fa-link"></i></a>総評</h1>

<p>月並みですが次のような点は「あった方がいいな」と感じました。</p>

<ul>
<li>
<code>null</code> になり得る変数に対しての考慮漏れが実際に発見できた</li>
<li>
<code>null</code> になり得るのかどうかを考えさせられる効果を感じた

<ul>
<li>これは必ず値がくるな、これは <code>null</code> にもなるな、という判断をしながら修正しました</li>
</ul>
</li>
<li>その判断結果をコード上に表現できることが有用だと感じた（シグネチャとして表現される）</li>
</ul>

<p>事前に思ってたより問題にならなそうだと思った点は以下でした。</p>

<ul>
<li>「警告」だと結局無視されそう（大量の警告が放置されている秘伝のプロジェクトとか現場には多い印象）

<ul>
<li>IDE 上で波線が引かれるので、ある程度はそこで気づけそうです</li>
<li>あとはまぁ CI 環境で工夫するとか色々やりようはありますかね</li>
</ul>
</li>
</ul>

<p>一方で、実際にやってみてツラかったのは以下の点でした</p>

<ul>
<li>プロパティの初期化をコンストラクタで迫られるけど、コンストラクタで初期化するのはツラいこともある

<ul>
<li>一応、コンストラクタを自動生成する機能が VS 側に搭載されたようなので、手間はある程度軽減されます</li>
</ul>
</li>
<li>メソッドを通すと解析が効かないのが結構しんどい

<ul>
<li>特に LINQ</li>
</ul>
</li>
<li>「歴史的な理由」「どのように実装されている機能か」を知らないと色々ハマりそう

<ul>
<li>構造体との違い含め、かなり後付けな実装なのである程度の C# 理解力（というか型に対する理解力）が無いと法則性を理解するのが難しそう</li>
<li>「フレームワーク上で別の型として存在しているわけではない」というのが今までの C# からすると異質な感じが否めない</li>
<li>伝わるかわかりませんが、TypeScript の型システムを使いこなそうとするのに似た思考力の求められを感じました</li>
</ul>
</li>
</ul>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Fchocolamint%2Fitems%2Fe3fed4b8fa2d4767683e&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Fchocolamint%2Fitems%2Fe3fed4b8fa2d4767683e&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/chocolamint/items/e3fed4b8fa2d4767683e/likers" class="css-1iupg5d">5</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">2</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/e3fed4b8fa2d4767683e/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/chocolamint/items/e3fed4b8fa2d4767683e/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/chocolamint/items/e3fed4b8fa2d4767683e/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/chocolamint/items/e3fed4b8fa2d4767683e/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/chocolamint/items/e3fed4b8fa2d4767683e.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-344ebe12-d85c-47e3-a726-2ebffb22ac11">{"authorAnalyticsTrackingId":"UA-48550453-1","organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-4a15089b-6b07-4dfc-bf22-436265c75876"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-4a15089b-6b07-4dfc-bf22-436265c75876">{}</script>
      
<div id="LoginModal-react-component-9a405216-a4ab-4c45-8295-ace5e1297a12"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-9a405216-a4ab-4c45-8295-ace5e1297a12">{}</script>
      
<div id="StockModal-react-component-18a18c6a-2aa9-4819-a6d9-76303d044c06"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-18a18c6a-2aa9-4819-a6d9-76303d044c06">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;+emfkrMXpy0z7/c3RunhcHCGh8VNJqwI8vBg3Xp5Q2ETtKic+ilsUSBQTI5CCWpL8h8d+br2VtEro6eueCHOVg==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\u003cp\u003e旬をすぎてしまった感がありますが\u003ca href=\"https://forest.watch.impress.co.jp/docs/news/1156690.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003e Visual Studio 2019 Preview 1 が公開された\u003c/a\u003eようなので\u003ca href=\"https://github.com/dotnet/csharplang/blob/master/proposals/nullable-reference-types.md\" rel=\"nofollow noopener\" target=\"_blank\"\u003e null 許容参照型（Nullable reference types）\u003c/a\u003eを手元のプロジェクトで試してみました。\u003c/p\u003e\n\n\u003cp\u003e「気になってるけど自分で試すのは面倒くさい」「自分以外の人がどう感じたか知りたい」「手元に程よい規模のソースがないから試しづらい」みたいな人は読んでみてください。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://visualstudio.microsoft.com/ja/vs/preview/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eVisual Studio 2019 Preview 1 はこちらからダウンロード\u003c/a\u003eできます（たぶん時期が過ぎたらこのリンクは機能しなくなります）。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"バグが見つかった\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%90%E3%82%B0%E3%81%8C%E8%A6%8B%E3%81%A4%E3%81%8B%E3%81%A3%E3%81%9F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eバグが見つかった\u003c/h1\u003e\n\n\u003cp\u003e\u003ccode\u003enull\u003c/code\u003e の可能性があるにも関わらず考慮していなかった箇所がさっそく見つかりました。\u003cbr\u003e\n元々「この機能（Nullable reference types）、ぶっちゃけ微妙では…」と感じていたところがあった自分としては、「お、役に立つのでは」と印象が変わりました。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e修正前\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eevents\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWhere\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eTargetYear\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e||\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDate\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eYear\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eTargetYear\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"c1\"\u003e// x.Place が null だとここでヌルリ\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWhere\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e!\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePlace\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eStartsWith\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"!_\"\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e修正後\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eevents\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWhere\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eTargetYear\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e||\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDate\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eYear\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eTargetYear\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"c1\"\u003e// x.Place が null のものは除外してよかったので条件を追加した\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWhere\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePlace\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"p\"\u003e!\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePlace\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eStartsWith\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"!_\"\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"cs8618-non-nullable-field-is-uninitialized-がツラくなってきた\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#cs8618-non-nullable-field-is-uninitialized-%E3%81%8C%E3%83%84%E3%83%A9%E3%81%8F%E3%81%AA%E3%81%A3%E3%81%A6%E3%81%8D%E3%81%9F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eCS8618 Non-nullable field is uninitialized. がツラくなってきた\u003c/h1\u003e\n\n\u003cp\u003eKotlin なんかでも似たようなまどろっこしさがありますが、当然のことながら Non-nullable なフィールド・プロパティはコンストラクタやイニシャライザで初期化されなければいけません。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eHoge\u003c/span\u003e\n             \u003cspan class=\"p\"\u003e~~~~\u003c/span\u003e \u003cspan class=\"n\"\u003eNon\u003c/span\u003e\u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003enullable\u003c/span\u003e \u003cspan class=\"n\"\u003eproperty\u003c/span\u003e \u003cspan class=\"err\"\u003e'\u003c/span\u003e\u003cspan class=\"n\"\u003eFuga\u003c/span\u003e\u003cspan class=\"err\"\u003e'\u003c/span\u003e \u003cspan class=\"k\"\u003eis\u003c/span\u003e \u003cspan class=\"n\"\u003euninitalized\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eFuga\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eそれはわかる、わかるのですが、POCO なプロパティの多いクラスですべてのプロパティをコンストラクタの引数として受け取るのは正直ツラく、また、API の戻り値としてデシリアライズによってインスタンス化されるクラスなんかの場合は「常に null はこないプロパティだけどコンストラクタは別に定義したくないんだよなぁ」となりモニョります。\u003c/p\u003e\n\n\u003cp\u003e定義側ではなく利用側に初期化の責務を負わせて、オブジェクト初期化子を使いたい（デシリアライズの場合はまぁ諦める。元々すべてを網羅することは諦めている機能だと思っているので）みたいな要望。\u003c/p\u003e\n\n\u003cp\u003e匿名型のように「不変（immutable）だけどコンストラクタパラメーターではなくオブジェクト初期化子で初期化したい」というのは以前から思ってはいたことで、調べてみたら\u003ca href=\"https://github.com/dotnet/csharplang/issues/322\" rel=\"nofollow noopener\" target=\"_blank\"\u003e Implement property initializers for immutable types #322 \u003c/a\u003eで既に提案されているようですね。\u003c/p\u003e\n\n\u003cp\u003e私が今回遭遇したケースにおいては \u003ca href=\"https://github.com/dotnet/csharplang/issues/39\" rel=\"nofollow noopener\" target=\"_blank\"\u003eRecords\u003c/a\u003e を使うのが正しいアプローチのような気がします。C# よくわからないですが。\u003c/p\u003e\n\n\u003cp\u003e結局、 \u003ccode\u003e#pragma warning disable CS8618 // Non-nullable field is uninitialized.\u003c/code\u003e をつけて回ることで一旦回避しました。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"caller-info-属性は考慮されない\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#caller-info-%E5%B1%9E%E6%80%A7%E3%81%AF%E8%80%83%E6%85%AE%E3%81%95%E3%82%8C%E3%81%AA%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eCaller Info 属性は考慮されない\u003c/h1\u003e\n\n\u003cp\u003e元々 \u003ccode\u003e= null\u003c/code\u003e と書かないといけないのが微妙だなぁとは思っていましたが、当然のことながら？ Caller Info 属性は考慮されませんでした。\u003cbr\u003e\nこの辺は遭遇してみて初めて「あぁなるほど、こういうケースもあるのか」と思いましたね。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eHoge\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eCallerFilePath\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003efilePath\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                                       \u003cspan class=\"p\"\u003e~~~~\u003c/span\u003e \u003cspan class=\"n\"\u003eCannot\u003c/span\u003e \u003cspan class=\"n\"\u003econvert\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"n\"\u003eliteral\u003c/span\u003e \u003cspan class=\"n\"\u003eto\u003c/span\u003e \u003cspan class=\"n\"\u003enon\u003c/span\u003e\u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003enullable\u003c/span\u003e \u003cspan class=\"n\"\u003ereference\u003c/span\u003e \u003cspan class=\"n\"\u003eor\u003c/span\u003e \u003cspan class=\"n\"\u003eunconstrained\u003c/span\u003e \u003cspan class=\"n\"\u003etype\u003c/span\u003e \u003cspan class=\"n\"\u003eparameter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eCallerMemberName\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003emember\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\n                                       \u003cspan class=\"p\"\u003e~~~~\u003c/span\u003e \u003cspan class=\"n\"\u003eCannot\u003c/span\u003e \u003cspan class=\"n\"\u003econvert\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"n\"\u003eliteral\u003c/span\u003e \u003cspan class=\"n\"\u003eto\u003c/span\u003e \u003cspan class=\"n\"\u003enon\u003c/span\u003e\u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003enullable\u003c/span\u003e \u003cspan class=\"n\"\u003ereference\u003c/span\u003e \u003cspan class=\"n\"\u003eor\u003c/span\u003e \u003cspan class=\"n\"\u003eunconstrained\u003c/span\u003e \u003cspan class=\"n\"\u003etype\u003c/span\u003e \u003cspan class=\"n\"\u003eparameter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\n\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e仕方ないので \u003ccode\u003e!\u003c/code\u003e をつけます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eHoge\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eCallerFilePath\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003efilePath\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e!,\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eCallerMemberName\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003emember\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e!\u003c/span\u003e\n\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"匿名型のプロパティが強制的に-null-許容にされる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8C%BF%E5%90%8D%E5%9E%8B%E3%81%AE%E3%83%97%E3%83%AD%E3%83%91%E3%83%86%E3%82%A3%E3%81%8C%E5%BC%B7%E5%88%B6%E7%9A%84%E3%81%AB-null-%E8%A8%B1%E5%AE%B9%E3%81%AB%E3%81%95%E3%82%8C%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e匿名型のプロパティが強制的に null 許容にされる\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"https://github.com/dotnet/roslyn/issues/25348\" rel=\"nofollow noopener\" target=\"_blank\"\u003eAnonymous type display mismatch for nullable vs non-nullable #25348 \u003c/a\u003e として報告が挙がっていました。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ehoge\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003eFoo\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eFoo\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ehoge\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFoo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBar\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e// この場合はツールチップ上 Foo? になるだけで警告は出ない模様\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e私が遭遇したのは↓のケースで、\u003ccode\u003eSelect\u003c/code\u003e で匿名型を作ると問答無用で nullable なプロパティにされる様子？\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003exs\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eSelect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e_\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eFoo\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eFoo\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003exs\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFoo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBar\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                      \u003cspan class=\"p\"\u003e~~~~~\u003c/span\u003e \u003cspan class=\"n\"\u003ePossible\u003c/span\u003e \u003cspan class=\"n\"\u003edereference\u003c/span\u003e \u003cspan class=\"n\"\u003eof\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"n\"\u003ereference\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e今回はほとんどのケースにおいてタプルでよかったためタプルに修正して回避しました。\u003cbr\u003e\n\u003ca href=\"https://twitter.com/chocolamint/status/303417039073210369\" rel=\"nofollow noopener\" target=\"_blank\"\u003eタプルかわいいよタプル\u003c/a\u003e。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"object-型の-null-フロー解析がおかしい\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#object-%E5%9E%8B%E3%81%AE-null-%E3%83%95%E3%83%AD%E3%83%BC%E8%A7%A3%E6%9E%90%E3%81%8C%E3%81%8A%E3%81%8B%E3%81%97%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eobject 型の null フロー解析がおかしい？\u003c/h1\u003e\n\n\u003cp\u003eこれはよくわかりませんでした。\u003ccode\u003eif (value == null) return \"\";\u003c/code\u003e で弾いてるつもりなのに警告が出ます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"nf\"\u003eHoge\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eobject\u003c/span\u003e \u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003evalue\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"s\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003evalue\u003c/span\u003e \u003cspan class=\"k\"\u003eis\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e \u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"s\"\u003e\"true\"\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e\"false\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToString\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n           \u003cspan class=\"p\"\u003e~~~~~\u003c/span\u003e \u003cspan class=\"n\"\u003ePossible\u003c/span\u003e \u003cspan class=\"n\"\u003edereference\u003c/span\u003e \u003cspan class=\"n\"\u003eof\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"n\"\u003ereference\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e引数を \u003ccode\u003eobject?\u003c/code\u003e にしても同じ模様。とりあえず \u003ccode\u003evalue!\u003c/code\u003e にしました……\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"ジェネリック型の変性的なやつが微妙な挙動\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B8%E3%82%A7%E3%83%8D%E3%83%AA%E3%83%83%E3%82%AF%E5%9E%8B%E3%81%AE%E5%A4%89%E6%80%A7%E7%9A%84%E3%81%AA%E3%82%84%E3%81%A4%E3%81%8C%E5%BE%AE%E5%A6%99%E3%81%AA%E6%8C%99%E5%8B%95\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eジェネリック型の変性的なやつが微妙な挙動\u003c/h1\u003e\n\n\u003cp\u003e\u003ccode\u003eTask\u0026lt;Foo?\u0026gt;\u003c/code\u003e に対して \u003ccode\u003eTask.FromResult\u003c/code\u003e を使うときになんとも微妙な挙動をします。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eまぁわかる\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetBodyAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFromResult\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n       \u003cspan class=\"p\"\u003e~~~~~~~~~~~~~~~~~~~\u003c/span\u003e \u003cspan class=\"n\"\u003eNullability\u003c/span\u003e \u003cspan class=\"n\"\u003eof\u003c/span\u003e \u003cspan class=\"n\"\u003ereference\u003c/span\u003e \u003cspan class=\"n\"\u003etypes\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"k\"\u003evalue\u003c/span\u003e \u003cspan class=\"n\"\u003eof\u003c/span\u003e \u003cspan class=\"n\"\u003etype\u003c/span\u003e \u003cspan class=\"err\"\u003e'\u003c/span\u003e\u003cspan class=\"n\"\u003eTask\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"err\"\u003e'\u003c/span\u003e \u003cspan class=\"n\"\u003edoesn\u003c/span\u003e\u003cspan class=\"err\"\u003e'\u003c/span\u003e\u003cspan class=\"n\"\u003et\u003c/span\u003e \u003cspan class=\"n\"\u003ematch\u003c/span\u003e \u003cspan class=\"n\"\u003etarget\u003c/span\u003e \u003cspan class=\"n\"\u003etype\u003c/span\u003e \u003cspan class=\"err\"\u003e'\u003c/span\u003e\u003cspan class=\"n\"\u003eTask\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u0026gt;\u003c/span\u003e\u003cspan class=\"err\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e型が合わないと警告が出るので、型引数の明示が必要なのですが、実際に書くと「不要」としてグレーアウトされます。\u003cbr\u003e\nまた、フロー解析がそこまで賢くないためかキャストでは警告が消えません。\u003cbr\u003e\nプレビュー版だからでしょうか。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetBodyAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFromResult\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u0026gt;(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e// こうする。\u0026lt;string?\u0026gt; が冗長だとして薄くなるけどｼｮｰｶﾞﾅｲ\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetBodyAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFromResult\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e?)\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e// これだと Task\u0026lt;string?\u0026gt; とみなしてくれない\u003c/span\u003e\n       \u003cspan class=\"p\"\u003e~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u003c/span\u003e \u003cspan class=\"n\"\u003eNullability\u003c/span\u003e \u003cspan class=\"n\"\u003eof\u003c/span\u003e \u003cspan class=\"n\"\u003ereference\u003c/span\u003e \u003cspan class=\"n\"\u003etypes\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"k\"\u003evalue\u003c/span\u003e \u003cspan class=\"n\"\u003eof\u003c/span\u003e \u003cspan class=\"n\"\u003etype\u003c/span\u003e \u003cspan class=\"err\"\u003e'\u003c/span\u003e\u003cspan class=\"n\"\u003eTask\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"err\"\u003e'\u003c/span\u003e \u003cspan class=\"n\"\u003edoesn\u003c/span\u003e\u003cspan class=\"err\"\u003e'\u003c/span\u003e\u003cspan class=\"n\"\u003et\u003c/span\u003e \u003cspan class=\"n\"\u003ematch\u003c/span\u003e \u003cspan class=\"n\"\u003etarget\u003c/span\u003e \u003cspan class=\"n\"\u003etype\u003c/span\u003e \u003cspan class=\"err\"\u003e'\u003c/span\u003e\u003cspan class=\"n\"\u003eTask\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u0026gt;\u003c/span\u003e\u003cspan class=\"err\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"メソッドを通しての-null-チェックに弱い\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%82%92%E9%80%9A%E3%81%97%E3%81%A6%E3%81%AE-null-%E3%83%81%E3%82%A7%E3%83%83%E3%82%AF%E3%81%AB%E5%BC%B1%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eメソッドを通しての null チェックに弱い\u003c/h1\u003e\n\n\u003cp\u003e\u003ccode\u003eWhere\u003c/code\u003e で \u003ccode\u003enull\u003c/code\u003e を除外してもフロー解析が働きません。\u003cbr\u003e\n\u003ccode\u003eWhere\u003c/code\u003e だけ特別扱いできないので、仕方ないといえば仕方ないですが結構ツラいです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWhere\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFoo\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSelect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFoo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBar\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n             \u003cspan class=\"p\"\u003e~~~~~\u003c/span\u003e \u003cspan class=\"n\"\u003ePossible\u003c/span\u003e \u003cspan class=\"n\"\u003edereference\u003c/span\u003e \u003cspan class=\"n\"\u003eof\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"n\"\u003ereference\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e同じ理由により、UT なんかで \u003ccode\u003enull\u003c/code\u003e じゃないことをアサーションしたあとでもフロー解析は働きません。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eAssert\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eNotNull\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efoo\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003eAssert\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEqual\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003efoo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBar\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                 \u003cspan class=\"p\"\u003e~~~\u003c/span\u003e \u003cspan class=\"n\"\u003ePossible\u003c/span\u003e \u003cspan class=\"n\"\u003edereference\u003c/span\u003e \u003cspan class=\"n\"\u003eof\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"n\"\u003ereference\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ca href=\"https://kotlinlang.org/docs/reference/whatsnew13.html#contracts\" rel=\"nofollow noopener\" target=\"_blank\"\u003eKotlin 1.3 では Contracts によって解決を図っている\u003c/a\u003eので C# も頑張ってほしいですね。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"おまけ-taskcompletionsource-のために-first-class-void-が欲しくなる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%8A%E3%81%BE%E3%81%91-taskcompletionsource-%E3%81%AE%E3%81%9F%E3%82%81%E3%81%AB-first-class-void-%E3%81%8C%E6%AC%B2%E3%81%97%E3%81%8F%E3%81%AA%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e(おまけ) TaskCompletionSource のために first-class Void が欲しくなる\u003c/h1\u003e\n\n\u003cp\u003eもはや Non-null reference type あんまり関係ないですが、\u003ccode\u003eTaskCompletionSource.SetResult(null)\u003c/code\u003e していたところが警告になったので\u003ca href=\"https://github.com/dotnet/csharplang/issues/1603\" rel=\"nofollow noopener\" target=\"_blank\"\u003e System.Void as a first-class type #1603 \u003c/a\u003eが早く欲しくなりました。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eTaskCompletionSource\u0026lt;object\u0026gt;というよりTaskCompletionSource\u0026lt;void\u0026gt;を使いたい\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e \u003cspan class=\"nf\"\u003eHogeAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003etaskCompletionSource\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eTaskCompletionSource\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eobject\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n    \u003cspan class=\"n\"\u003e_foo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCompleted\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003etaskCompletionSource\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSetResult\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                                       \u003cspan class=\"p\"\u003e~~~~\u003c/span\u003e \u003cspan class=\"n\"\u003eCannot\u003c/span\u003e \u003cspan class=\"n\"\u003econvert\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"n\"\u003eliteral\u003c/span\u003e \u003cspan class=\"n\"\u003eto\u003c/span\u003e \u003cspan class=\"n\"\u003enon\u003c/span\u003e\u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003enullable\u003c/span\u003e \u003cspan class=\"n\"\u003ereference\u003c/span\u003e \u003cspan class=\"n\"\u003eor\u003c/span\u003e \u003cspan class=\"n\"\u003eunconstrained\u003c/span\u003e \u003cspan class=\"n\"\u003etype\u003c/span\u003e \u003cspan class=\"n\"\u003eparameter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003etaskCompletionSource\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTask\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"総評\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%B7%8F%E8%A9%95\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e総評\u003c/h1\u003e\n\n\u003cp\u003e月並みですが次のような点は「あった方がいいな」と感じました。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003enull\u003c/code\u003e になり得る変数に対しての考慮漏れが実際に発見できた\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003enull\u003c/code\u003e になり得るのかどうかを考えさせられる効果を感じた\n\n\u003cul\u003e\n\u003cli\u003eこれは必ず値がくるな、これは \u003ccode\u003enull\u003c/code\u003e にもなるな、という判断をしながら修正しました\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eその判断結果をコード上に表現できることが有用だと感じた（シグネチャとして表現される）\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e事前に思ってたより問題にならなそうだと思った点は以下でした。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e「警告」だと結局無視されそう（大量の警告が放置されている秘伝のプロジェクトとか現場には多い印象）\n\n\u003cul\u003e\n\u003cli\u003eIDE 上で波線が引かれるので、ある程度はそこで気づけそうです\u003c/li\u003e\n\u003cli\u003eあとはまぁ CI 環境で工夫するとか色々やりようはありますかね\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e一方で、実際にやってみてツラかったのは以下の点でした\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eプロパティの初期化をコンストラクタで迫られるけど、コンストラクタで初期化するのはツラいこともある\n\n\u003cul\u003e\n\u003cli\u003e一応、コンストラクタを自動生成する機能が VS 側に搭載されたようなので、手間はある程度軽減されます\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eメソッドを通すと解析が効かないのが結構しんどい\n\n\u003cul\u003e\n\u003cli\u003e特に LINQ\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e「歴史的な理由」「どのように実装されている機能か」を知らないと色々ハマりそう\n\n\u003cul\u003e\n\u003cli\u003e構造体との違い含め、かなり後付けな実装なのである程度の C# 理解力（というか型に対する理解力）が無いと法則性を理解するのが難しそう\u003c/li\u003e\n\u003cli\u003e「フレームワーク上で別の型として存在しているわけではない」というのが今までの C# からすると異質な感じが否めない\u003c/li\u003e\n\u003cli\u003e伝わるかわかりませんが、TypeScript の型システムを使いこなそうとするのに似た思考力の求められを感じました\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","createdAt":"2018-12-10T04:14:35Z","elapsedYearsFromLastModifiedAt":2,"encryptedId":"AhVFUiy4iGHX5w3ujz17L9ESKDnEn6Hk--UD02eNy6dwX4SHIE--UwUnuudskOTHUJjRfIqTVw==","isBanned":false,"isDeprecated":true,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2018-12-10T04:18:18Z","likesCount":5,"linkUrl":"https://qiita.com/chocolamint/items/e3fed4b8fa2d4767683e","organization":null,"originalId":737307,"stockedCount":2,"title":"Visual Studio 2019 Preview 1 が公開されたので null 許容参照型を試してみた","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%90%E3%82%B0%E3%81%8C%E8%A6%8B%E3%81%A4%E3%81%8B%E3%81%A3%E3%81%9F\"\u003eバグが見つかった\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#cs8618-non-nullable-field-is-uninitialized-%E3%81%8C%E3%83%84%E3%83%A9%E3%81%8F%E3%81%AA%E3%81%A3%E3%81%A6%E3%81%8D%E3%81%9F\"\u003eCS8618 Non-nullable field is uninitialized. がツラくなってきた\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#caller-info-%E5%B1%9E%E6%80%A7%E3%81%AF%E8%80%83%E6%85%AE%E3%81%95%E3%82%8C%E3%81%AA%E3%81%84\"\u003eCaller Info 属性は考慮されない\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%8C%BF%E5%90%8D%E5%9E%8B%E3%81%AE%E3%83%97%E3%83%AD%E3%83%91%E3%83%86%E3%82%A3%E3%81%8C%E5%BC%B7%E5%88%B6%E7%9A%84%E3%81%AB-null-%E8%A8%B1%E5%AE%B9%E3%81%AB%E3%81%95%E3%82%8C%E3%82%8B\"\u003e匿名型のプロパティが強制的に null 許容にされる\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#object-%E5%9E%8B%E3%81%AE-null-%E3%83%95%E3%83%AD%E3%83%BC%E8%A7%A3%E6%9E%90%E3%81%8C%E3%81%8A%E3%81%8B%E3%81%97%E3%81%84\"\u003eobject 型の null フロー解析がおかしい？\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B8%E3%82%A7%E3%83%8D%E3%83%AA%E3%83%83%E3%82%AF%E5%9E%8B%E3%81%AE%E5%A4%89%E6%80%A7%E7%9A%84%E3%81%AA%E3%82%84%E3%81%A4%E3%81%8C%E5%BE%AE%E5%A6%99%E3%81%AA%E6%8C%99%E5%8B%95\"\u003eジェネリック型の変性的なやつが微妙な挙動\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%82%92%E9%80%9A%E3%81%97%E3%81%A6%E3%81%AE-null-%E3%83%81%E3%82%A7%E3%83%83%E3%82%AF%E3%81%AB%E5%BC%B1%E3%81%84\"\u003eメソッドを通しての null チェックに弱い\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%8A%E3%81%BE%E3%81%91-taskcompletionsource-%E3%81%AE%E3%81%9F%E3%82%81%E3%81%AB-first-class-void-%E3%81%8C%E6%AC%B2%E3%81%97%E3%81%8F%E3%81%AA%E3%82%8B\"\u003e(おまけ) TaskCompletionSource のために first-class Void が欲しくなる\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%B7%8F%E8%A9%95\"\u003e総評\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":1786,"uuid":"e3fed4b8fa2d4767683e","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"MFPxYbYQTj1B9gIs7x/oXm5MinE=--WCrmTTLmBirhVZWG--AFZ6/AlqEj1KKtUDQ30ecw==","originalId":11978,"description":"GitHub の使い方がわからない情弱です。\r\n主に C# とか JavaScript とか TypeScript とか。\r\n\r\n","facebookUrl":null,"githubUrl":"https://github.com/chocolamint","isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"","profileImageUrl":"https://qiita-image-store.s3.amazonaws.com/0/11978/profile-images/1473682231","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F11978%2Fprofile-images%2F1473682231?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=5bd9ec2c5ac76a217290aab69f9f5426","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F11978%2Fprofile-images%2F1473682231?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=3d43baa24ec727bbcfd8eefae78b21bf","urlName":"chocolamint","websiteUrl":"","twitterUrl":"https://twitter.com/chocolamint","twitterUrlName":"chocolamint","revealedOrganizations":{"edges":[]}},"tags":[{"name":"C#","urlName":"csharp"},{"name":".NET","urlName":".net"}],"followingLikers":{"edges":[]},"comments":{"totalCount":0}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

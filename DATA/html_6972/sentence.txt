More than 3 years have passed since last update.前: その3
次: その5頂点インデックスを元にモデルの描画
カリング
カメラの設定今回のソース: 頂点インデックス・カリング,  カメラ詳しいことはこちらに。頂点インデックスとは、三角形を構成する頂点に対応する頂点の番号のリストのことです。
MmdFileLoaderを使用した場合は、MmdFileLoader.Pmd.PmdLoader.Indexに格納されています。
このリストに対応する頂点をバッファに送ることで、正しく描画できるはずです。バッファに送る頂点のリストはpmdLoader.Index.SelectMany(x =&gt; x.Indicies).Select(x =&gt; pmdLoader.Vertex[x].Position).ToArray()で、
頂点の数はpmdLoader.Index.Length * 3で取得できます。DirectX11の初期設定では、MMDモデルを表示しようとすると、モデルの裏もしくは表が描画されません。
描画を設定するラスタライザステートで設定するため、下のコードを追加します。CullModeには「表面の描画を省略する」「裏面の描画を省略する」「描画の省略をしない」の3つから選択可能。
FillModeにWireframeを指定すると、ワイヤフレーム表示になります。結果は下図のようになります。
詳しいことはこちらにモデルの表示ができましたが、いちいち1/20に縮小したものを用意するのは面倒です。
そこでカメラを用意します。
Direct3D11においては、「カメラ機能」なるものは用意されていない(はず)です。
エフェクトファイルで座標変換を行うことで「カメラ」を実現しています。下のコードで、(0, 10, -10)から(0, 10, 0)に視線を向けさせ、全体をy軸を中心に回転させています。
flameCountは描画するごとにインクリメントさせています。
また、エフェクトファイルの頂点シェーダも変更しました。くるくるまわってます。
次回は、拡散色(Diffuse)とテクスチャでモデルに色をつける予定です。



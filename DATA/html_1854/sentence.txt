More than 1 year has passed since last update.仮想モードにしたListViewでも、SelectedIndicesプロパティ(ListView.SelectedIndexCollectionクラス)で非常に時間がかかるケースがあります。
(この記事では面倒なのでどれくらい時間がかかるかは述べません)以下のように、ループでSelectedIndices.Add/Removeでしていくと非常に時間がかかってしまいます。ListBoxの全項目を高速に選択すると同様に、P/Invokeで全選択するようにします。こんなのを定義して、こう使います。SelectedIndicesに対して列挙すると、内部では1件目から全部舐めてリストを作ることになるので、非常に遅くなります。
(foreachで回さなくても、CopyToメソッドなども含む)
大きなインデックスでインデックスアクセスしても同様にその位置まで1件進めるのに時間がかかります。そのため、VirtualItemsSelectionRangeChangedとItemSelectionChangedイベントで選択行を保持しておき、選択行が必要なときはそれを参照するようにします。他の方法として、などもあります。



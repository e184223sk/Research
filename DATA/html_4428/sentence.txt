More than 1 year has passed since last update.これは、Visual Basic Advent Calendar 2018の8日目の記事となります。同僚から「HARファイルをCSVに変換して欲しい」旨の依頼メールが届いた。
HARファイルってなんやねんってところから調べてた。HAR(HTTP アーカイブ)は、複数の HTTP セッション ツールでキャプチャ済みデータをエクスポートする場合に使用されるファイル形式で、中身はテキスト形式のJSONオブジェクトです。Windows 7のIEのデベロッパーツールでネットワークのキャプチャを取得した場合、保存した際にはCSVとXMLの2つの形式が選択できました。しかし、Windows 10のIEではHAR形式のみとなりました。
他のブラウザと同様になるように統一されたんでしょうね。「har csv」で検索して見つけたのが下記サイトになります。
サイトのリクエスト情報をエクセルで見れるようにする
Windowsだからなのかエラーが出たのでやめました。次にHow to import HAR file to excel - stackoverflowの中で紹介されていた「har2csv」
 HTTP Archive (har) to CSV converter (har2csv)これはJavaで作成されていて、130MByteあるHARファイルで変換しようとしたが、メモリエラーが発生、それではと2件くらいのデータにしてみたが、フォーマット形式が一致しないのかエラーになって変換できなかった。2013年と5年前のツールなので対応していないのかも知れない。Convert JSON to CSV
オンラインツール、HARファイルの中身はJSONなので試しに2件くらいのデータにやってみたらCSV出力できたので悪くはない。しかし、130MByteとデータが大きかったのでやめました。ツール探しは諦めて、JSONのCSV変換くらいならとC#で自作することにしました。
JsonからC#のクラスモデルを作成してくれる「json2csharp」というサイトがあったので、HARファイルの1件データを抽出してクラスモデルを作成。Windows 7のIEでCSV出力の項目があればいいので、とりあえずこれでCSV変換が出来たのですが、今後のことを考えて、HARファイルの正式なクラスのようなのがあるはずだと調べたところ、「HarSharp」を見つけました。
https://github.com/giacomelli/HarSharpNuGetで「HarSharp」を検索して、ライブラリを導入しました。※プロトコルは"HTTP"固定、イニシエーターが何か不明なので空文字にしました。2018/12/08 VB.NET版を追記Windows 10のIEでもデベロッパーツールのところはWindows 7とは違っているんですね。
今回はHARファイルって存在を知れたことと、JsonからC#のクラスモデルを作成してくれるサイトを知れたのが良かったかな。



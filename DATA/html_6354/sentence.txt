More than 3 years have passed since last update.現代、Eメールはもはや業務にかかせないインフラの1つとなりました。Eメールはビジネスの場において必須のツールですが、そんなメール配信も今や SaaS の時代です。
メール配信サービスの1つに SendGrid があります。SendGrid を利用すれば、顧客や見込み客に一斉にメール送信を行うことができます。ですが、SendGrid はあくまでメール配信サービスであり、顧客の管理自体は別のシステムで行うことになります。そのため、顧客を管理しているシステムから SendGrid へデータを同期できると便利です。ここでは、Salesforce で管理している取引先の情報をSendGrid に同期するサンプルアプリケーションを開発してみます。
CDataドライバーを利用すれば、こういったデータ同期を行うアプリケーションの作成を行うことができます。このアプリケーションの概要は次の通りです。それでは、このサンプルアプリケーションの開発手順を見ていきます。このサンプルアプリケーションのソースコードはこちらからどうぞ。※ソースコードについて補足
このソースコードでは接続情報をアプリケーションの設定に格納しています。
動作させる際は、アプリケーション設定のConnectionStringSalesforceにSalesforce用の接続文字列を、ConnectionStringSendGridにSendGrid用の接続文字列を設定してください。
それぞれの接続文字列は以下のようになります。
Salesforce → Password=&lt;パスワード&gt;;Security Token=&lt;セキュリティトークン&gt;;User=&lt;ユーザ名&gt;
SendGrid → Password=&lt;パスワード&gt;; Username=&lt;ユーザ名&gt;まずは CData Software をインストールします。今回必要になるのは、次の2つです。Visual Studio を起動し、新しいWindowsフォームアプリケーションのプロジェクトを作成します。インストールした CData Software の2製品には、いくつかのADO.NETアセンブリが含まれています。
今回必要になるのは次の2つのDLLですので、これらをプロジェクトの参照設定で追加します。Salesforce および SendGrid へのデータ接続を作成します。
以下のオンラインマニュアルを参考にして、2つのデータ接続を作成します。
Salesforce用
SendGrid用メインのフォームを追加します。
このフォームには、次のコンポーネントを追加します。追加したデータグリッドビューに、データソースの設定を行います。
左側のデータグリッドビューで「DataGridView タスク」→「データソースの選択」→「プロジェクト データソースの追加」を選択します。「データソースの種類の選択」では「データベース」を選択して「次へ」ボタンをクリックします。次の画面では「データセット」を選択して「次へ」ボタンをクリックします。データ接続の選択では、データ接続を作成で作成したSalesforceのデータ接続を選択して「次へ」ボタンをクリックします。次の画面で接続文字列をアプリケーションに保存するかどうか選択できますが、ここでは任意に選択し、「次へ」ボタンをクリックします。最後にデータベースオブジェクトの選択を行います。
今回はSalesforceの「取引先責任者」を対象とするので、Contactのチェックボックスにチェックを入れます。
データセット名は SalesforceDataSet として、「完了」ボタンをクリックします。同じようにして、SendGrid側もデータソースの設定を行います。
SendGrid側は、Recipientsをデータベースオブジェクトとして選択します。これで、データグリッドビューへのデータの読み込みまでが行えるようになりました。ここまで、全くコーディングは必要ありません。
メインフォームには、データ読み込みのためのコードが自動生成されています。フォームデザイナで「インポート」ボタンをダブルクリックして、クリック時の処理を実装します。リロードのボタンの処理も実装しておきましょう。
リロードボタンの処理はたったこれだけです。実装は以上です。アプリケーションを起動すると、データグリッドビューにデータが読み込まれます。移行したい行を選択して「インポート」ボタンをクリックすると、選択したデータが SendGrid に登録されます。
ただ、SendGridにデータが反映されるまで少し時間がかかるようです。少し待ってからリロードボタンでデータをリロードし、データが登録されたことを確認します。



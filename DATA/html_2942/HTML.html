<!DOCTYPE html><html><head><meta charset="utf-8" /><title>[C#/WinRT]Bluetooth v4(BLE)機器と通信する（C#で実装メモ） - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/tera1707/items/5505ed22b5ddf93795f4" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="f/JGw53huvEGj8sYsBqVRogCR66fl/ELDEIT2r14B5jFhsqh0s+lshtg07fkpXQXwrEY4nZp6aTwapvORmL4uA==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta property="og:type" content="article"><meta property="og:title" content="[C#/WinRT]Bluetooth v4(BLE)機器と通信する（C#で実装メモ） - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1XME1qTDFkcGJsSlVYVUpzZFdWMGIyOTBhQ0IyTkNoQ1RFVXA1cW1mNVptbzQ0R282WUNhNUwtaDQ0R1o0NEtMNzd5SVF5UGpnYWZscnBfb280WGpnNkhqZzZMdnZJayZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTU0JnR4dC1jbGlwPWVsbGlwc2lzJnR4dC1hbGlnbj1jZW50ZXIlMkNtaWRkbGUmcz00MGVjYmU1ZjI3NjE3YTczZDU2ZGM2ZmM0YTYzOWYyNA&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RSFJsY21FeE56QTMmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT00NSZ0eHQtYWxpZ249cmlnaHQlMkNib3R0b20mcz01OTFjMWUwZjM2MjIxODZiYTQzMTViMmZjOTU0MDFiYg&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=19917dc6408d215a22173dc123b537f7"><meta property="og:description" content="

BLE関連記事


[C#/WinRT]Bluetooth v4(BLE)機器と通信する（BLE基礎メモ）
[C#/WinRT]Bluetooth v4(BLE)機器と通信する（C#で実装メモ）
[C#/WinRT] WPFでBl..."><meta content="https://qiita.com/tera1707/items/5505ed22b5ddf93795f4" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#,WinRT,bluetooth,BLE" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 1nzh4zz 38fzdi helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-1nzh4zz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:16px 32px;background-color:#FBE69E;color:rgba(0,0,0,0.87);line-height:1.5;font-weight:600;}@media (max-width:770px){.css-1nzh4zz{padding:16px;}}.css-38fzdi{color:#CA832A;margin-right:4px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-099893ea-f88b-4654-9d6a-3816b73e8761"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Ftera1707%2Fitems%2F5505ed22b5ddf93795f4">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Ftera1707%2Fitems%2F5505ed22b5ddf93795f4">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-099893ea-f88b-4654-9d6a-3816b73e8761">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2019-08-16T09:07:57.000+09:00","dateModified":"2019-12-04T21:52:00.000+09:00","headline":"[C#/WinRT]Bluetooth v4(BLE)機器と通信する（C#で実装メモ）","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1XME1qTDFkcGJsSlVYVUpzZFdWMGIyOTBhQ0IyTkNoQ1RFVXA1cW1mNVptbzQ0R282WUNhNUwtaDQ0R1o0NEtMNzd5SVF5UGpnYWZscnBfb280WGpnNkhqZzZMdnZJayZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTU0JnR4dC1jbGlwPWVsbGlwc2lzJnR4dC1hbGlnbj1jZW50ZXIlMkNtaWRkbGUmcz00MGVjYmU1ZjI3NjE3YTczZDU2ZGM2ZmM0YTYzOWYyNA\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RSFJsY21FeE56QTMmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT00NSZ0eHQtYWxpZ249cmlnaHQlMkNib3R0b20mcz01OTFjMWUwZjM2MjIxODZiYTQzMTViMmZjOTU0MDFiYg\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=19917dc6408d215a22173dc123b537f7","mainEntityOfPage":"https://qiita.com/tera1707/items/5505ed22b5ddf93795f4","author":{"@type":"Person","address":"大阪","email":"tera1707@gmail.com","identifier":"tera1707","name":"tera1707","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Favatars0.githubusercontent.com%2Fu%2F19180456%3Fv%3D4?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=1ddd4d18cb0c4d9ee77ed7cff93f4ae1","url":"https://qiita.com/tera1707","description":"","memberOf":[]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://increments.connpass.com/event/211948/">「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催</a><a target="_blank" id="header_text_message_2" href="https://increments.connpass.com/event/211948/">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"tera1707","type":"items","id":"5505ed22b5ddf93795f4"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"tera1707","type":"items","id":"5505ed22b5ddf93795f4"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":0,"pos_id":"header_text_message_1","message":"「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"tera1707","type":"items","id":"5505ed22b5ddf93795f4"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":0,"pos_id":"header_text_message_2","message":"「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/tera1707/items/5505ed22b5ddf93795f4","location":"/tera1707/items/5505ed22b5ddf93795f4","scheme":"https","host":"qiita.com","port":null,"pathname":"/tera1707/items/5505ed22b5ddf93795f4","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"dqqvky6ReuDL8OB87HPyZKiel62f2rTxkLZKxWzZJtvM3iPxYb9lo9Yf+NO4zBM14i3I4XYkrF5snsLRl8PZ+w==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-1c59ae1e-311b-4a3d-89f5-713073b92a0f"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/tera1707/items/5505ed22b5ddf93795f4/likers" class="css-1iupg5d">15</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">20</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/5505ed22b5ddf93795f4/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/tera1707/items/5505ed22b5ddf93795f4/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/tera1707/items/5505ed22b5ddf93795f4/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/tera1707/items/5505ed22b5ddf93795f4/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/tera1707/items/5505ed22b5ddf93795f4.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-1nzh4zz"><span class="fa fa-fw fa-warning css-38fzdi"></span><p>More than 1 year has passed since last update.</p></div><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/tera1707"><img class="css-100alwu eyfquo10" src="https://avatars0.githubusercontent.com/u/19180456?v=4" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/tera1707" class="css-10ougpm">@<!-- -->tera1707</a><div class="css-1ay9vb9"><span><meta content="2019-08-16T00:07:57Z"/><time dateTime="2019-12-04T12:52:00Z" class="css-m19uds">updated at 2019-12-04</time></span></div></div></div></div></div><h1 class="css-cgzq40">[C#/WinRT]Bluetooth v4(BLE)機器と通信する（C#で実装メモ）</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/winrt" class="css-4czcte">WinRT</a><a href="/tags/bluetooth" class="css-4czcte">bluetooth</a><a href="/tags/ble" class="css-4czcte">BLE</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div>
<h1>
<span id="ble関連記事" class="fragment"></span><a href="#ble%E9%96%A2%E9%80%A3%E8%A8%98%E4%BA%8B"><i class="fa fa-link"></i></a>BLE関連記事</h1>

<ul>
<li><a href="https://qiita.com/tera1707/items/e04d86a68a9f96e02fe9" id="reference-c4e57cb99e374aba7d81">[C#/WinRT]Bluetooth v4(BLE)機器と通信する（BLE基礎メモ）</a></li>
<li><a href="https://qiita.com/tera1707/items/5505ed22b5ddf93795f4">[C#/WinRT]Bluetooth v4(BLE)機器と通信する（C#で実装メモ）</a></li>
<li><a href="https://qiita.com/tera1707/items/1c066934774e0dd74cac" id="reference-90b654534f495976b62a">[C#/WinRT] WPFでBluetooth v4(BLE)機器とペアリングする</a></li>
</ul>

<h1>
<span id="やりたいこと" class="fragment"></span><a href="#%E3%82%84%E3%82%8A%E3%81%9F%E3%81%84%E3%81%93%E3%81%A8"><i class="fa fa-link"></i></a>やりたいこと</h1>

<p><a href="https://qiita.com/tera1707/items/e04d86a68a9f96e02fe9">前回</a>の記事で、何となくBluetooth v4で環境センサから値をとるためには、ここからとればよいというのが分かったので、それをWindowsで(WinRTで)実装するにはどう書けばよいかを調べていく。</p>

<h1>
<span id="前提" class="fragment"></span><a href="#%E5%89%8D%E6%8F%90"><i class="fa fa-link"></i></a>前提</h1>

<p>今回は、下記のものを使って実験をする。</p>

<table>
<thead>
<tr>
<th style="text-align: left">使うもの</th>
<th style="text-align: left">内容</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left">環境</td>
<td style="text-align: left">WPF .net Framework 4.7.2</td>
</tr>
<tr>
<td style="text-align: left">Nuget</td>
<td style="text-align: left">Microsoft.Windows.SDK.Contracts　→　UWPのAPI(WinRTのAPI)を使うため</td>
</tr>
<tr>
<td style="text-align: left">使用機器</td>
<td style="text-align: left">OMRON 環境センサ 2JCIE-BL01</td>
</tr>
</tbody>
</table>

<ul>
<li>使うクラス(UWP(WinRT)API)

<ul>
<li>Windows.Devices.Bluetooth;</li>
<li>Windows.Devices.Bluetooth.Advertisement;</li>
<li>Windows.Devices.Bluetooth.GenericAttributeProfile;</li>
<li>Windows.Devices.Enumeration;</li>
</ul>
</li>
</ul>

<p>基本的に、下記のサンプルをもとにしている。<br>
<a href="https://github.com/microsoft/Windows-universal-samples/tree/master/Samples/BluetoothLE/cs" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/microsoft/Windows-universal-samples/tree/master/Samples/BluetoothLE/cs</a><br>
これをベースに、今回やろうとしていることに最低限必要な処理だけ抜き出したのが今回やったこと。</p>

<h1>
<span id="作成するもの" class="fragment"></span><a href="#%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B%E3%82%82%E3%81%AE"><i class="fa fa-link"></i></a>作成するもの</h1>

<p>BLE環境センサから温度をとってきてアプリで使うということをしたいので、温度を採ってこれるライブラリ(dll)を作る。<br>
まずは勉強のためにあまりエラー処理を入れずに、正常系だけで最低限必要な処理だけつくるイメージにする。機能としては、下記のようなイメージ。</p>

<ol>
<li>ペアリング済みの環境センサと接続する</li>
<li>温度データ変化時に受け取る機能</li>
<li>温度データを好きなときに取得する機能</li>
<li>測定間隔を設定する機能</li>
</ol>

<h2>
<span id="通信の流れ概要" class="fragment"></span><a href="#%E9%80%9A%E4%BF%A1%E3%81%AE%E6%B5%81%E3%82%8C%E6%A6%82%E8%A6%81"><i class="fa fa-link"></i></a>通信の流れ概要</h2>

<p>前回の記事で、調べた限りの知識でとても乱暴に「どうやって通信するか」「温度を取得するか」を言うと、</p>

<ul>
<li>各開発環境が用意している(今回だとWindowsのWinRTの)APIを使って、</li>
<li>セントラル(WindowsPC)から、サービスのUUIDとキャラクタリスティックのUUIDを指定して接続し、</li>
<li>ペリフェラル(センサ)にRead要求し、</li>
<li>ペリフェラルからセントラルに帰ってきた情報を見て、温度を知る</li>
</ul>

<p>ということをする。<br>
測定間隔を設定する機能については、Read要求が「Write要求」になるイメージ。</p>

<h1>
<span id="通信の流れ" class="fragment"></span><a href="#%E9%80%9A%E4%BF%A1%E3%81%AE%E6%B5%81%E3%82%8C"><i class="fa fa-link"></i></a>通信の流れ</h1>

<p>ペアリングは事前に手でやっておく前提で、下記のような流れになる。</p>

<h3>
<span id="事前準備" class="fragment"></span><a href="#%E4%BA%8B%E5%89%8D%E6%BA%96%E5%82%99"><i class="fa fa-link"></i></a>事前準備</h3>

<ul>
<li>Windowsの設定で、OMRONの環境センサ(EnvSensor-BL01またはEnv)をペアリングする。</li>
</ul>

<h3>
<span id="プログラムに実装する処理" class="fragment"></span><a href="#%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0%E3%81%AB%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B%E5%87%A6%E7%90%86"><i class="fa fa-link"></i></a>プログラムに実装する処理</h3>

<ul>
<li>共通処理

<ul>
<li>環境センサを探す</li>
<li>見つかった環境センサのデバイス情報を保存</li>
<li>デバイス情報からBluetoothLEDeviceを取得</li>
</ul>
</li>
<li>温度データ変化時に受け取る機能/好きなときに取得する機能関連

<ul>
<li>BluetoothLEDeviceから温度取得に使いたいサービスを取得</li>
<li>サービスから温度取得に使いたいキャラクタリスティックを取得</li>
<li>キャラクタリスティックのディスクリプタを設定(Notify)</li>
<li>キャラクタリスティック変化時のハンドラを登録<strong>→データ変化時に受け取る機能</strong>
</li>
<li>温度取得に使いたいキャラクタリスティックに読み込み要求実施<strong>→好きなときに取得する機能</strong>
</li>
</ul>
</li>
<li>測定間隔を設定する機能関連

<ul>
<li>BluetoothLEDeviceから測定間隔設定に使いたいサービスを取得</li>
<li>サービスから測定間隔設定に使いたいキャラクタリスティックを取得</li>
<li>測定間隔設定に使いたいキャラクタリスティックに書き込み要求実施</li>
</ul>
</li>
</ul>

<h1>
<span id="共通処理-の実装" class="fragment"></span><a href="#%E5%85%B1%E9%80%9A%E5%87%A6%E7%90%86-%E3%81%AE%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>共通処理 の実装</h1>

<p>値の読み込み、変化通知(Notify)、書き込みのすべてで共通して行う処理。</p>

<h2>
<span id="環境センサを探す" class="fragment"></span><a href="#%E7%92%B0%E5%A2%83%E3%82%BB%E3%83%B3%E3%82%B5%E3%82%92%E6%8E%A2%E3%81%99"><i class="fa fa-link"></i></a>環境センサを探す</h2>

<p>環境センサはWindowsの設定でペアリングされている前提。<br>
下記のようにselectorを書いてウォッチャーを作成してスタートすると、デバイス情報更新時のハンドラとして登録されたメソッドにて、ペアリングされていて指定のUUIDを持つ機器のみ検索されてくる。</p>

<div class="code-frame" data-lang="cs"><div class="highlight"><pre class="with-code"><code><span class="c1">// ペアリングした環境センサを検索対象にする</span>
<span class="c1">// Guid SeosorServiceUuid = new Guid("0C4C3000-7700-46F4-AA96-D5E974E32A54");</span>
<span class="kt">string</span> <span class="n">selector</span> <span class="p">=</span> <span class="s">"("</span> <span class="p">+</span> <span class="n">GattDeviceService</span><span class="p">.</span><span class="nf">GetDeviceSelectorFromUuid</span><span class="p">(</span><span class="n">SeosorServiceUuid</span><span class="p">)</span> <span class="p">+</span> <span class="s">")"</span><span class="p">;</span>

<span class="c1">// ウォッチャー(機器を監視、検索するやつ)を作成</span>
<span class="c1">// private DeviceWatcher DeviceWatcher { get; set; }</span>
<span class="n">DeviceWatcher</span> <span class="p">=</span> <span class="n">DeviceInformation</span><span class="p">.</span><span class="nf">CreateWatcher</span><span class="p">(</span><span class="n">selector</span><span class="p">);</span>

<span class="c1">// デバイス情報更新時のハンドラを登録</span>
<span class="n">DeviceWatcher</span><span class="p">.</span><span class="n">Added</span> <span class="p">+=</span> <span class="n">Watcher_DeviceAdded</span><span class="p">;</span>

<span class="c1">// ウォッチャーをスタート(検索開始)</span>
<span class="n">DeviceWatcher</span><span class="p">.</span><span class="nf">Start</span><span class="p">();</span>
</code></pre></div></div>

<p>※ちなみに、selectorを下記のように書くと、ペアリングしていないBLE機器もまとめて検索されてくるっぽい。そこから、下の流れてデバイス情報を保存することもできるので、「ペアリングせずに対象機器を探してデータをとる」こともできる。(試したら実際できた)<br>
ただ複数のセンサがある場合など、検索してどれを使うかを選ぶとかしないといけなくなりそうなため、やめた。<strong>ペアリングは手動でやってもらうこととしたい。</strong></p>

<div class="code-frame" data-lang="cs"><div class="highlight"><pre class="with-code"><code><span class="c1">// BLEプロトコルを持つ機器全部</span>
<span class="kt">string</span> <span class="n">selector</span> <span class="p">=</span> <span class="s">"("</span> <span class="p">+</span> <span class="s">"System.Devices.Aep.ProtocolId:=\"{bb7bb05e-5972-42b5-94fc-76eaa7084d49}\""</span> <span class="p">+</span> <span class="s">")"</span><span class="p">;</span>
<span class="n">DeviceWatcher</span> <span class="p">=</span> <span class="n">DeviceInformation</span><span class="p">.</span><span class="nf">CreateWatcher</span><span class="p">(</span><span class="n">selector</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="n">DeviceInformationKind</span><span class="p">.</span><span class="n">AssociationEndpoint</span><span class="p">);</span>
</code></pre></div></div>

<h2>
<span id="見つかった環境センサのデバイス情報を保存" class="fragment"></span><a href="#%E8%A6%8B%E3%81%A4%E3%81%8B%E3%81%A3%E3%81%9F%E7%92%B0%E5%A2%83%E3%82%BB%E3%83%B3%E3%82%B5%E3%81%AE%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E6%83%85%E5%A0%B1%E3%82%92%E4%BF%9D%E5%AD%98"><i class="fa fa-link"></i></a>見つかった環境センサのデバイス情報を保存</h2>

<p>ウォッチャーが検索してくれた機器が、引数に載ってやってくるので、お目当ての機器かどうかを名前で判定して、当たっていたら保存する。</p>

<div class="code-frame" data-lang="cs"><div class="highlight"><pre class="with-code"><code><span class="k">private</span> <span class="k">async</span> <span class="k">void</span> <span class="nf">Watcher_DeviceAdded</span><span class="p">(</span><span class="n">DeviceWatcher</span> <span class="n">sender</span><span class="p">,</span> <span class="n">DeviceInformation</span> <span class="n">deviceInfo</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">deviceInfo</span><span class="p">.</span><span class="n">Name</span> <span class="p">==</span> <span class="s">"EnvSensor-BL01"</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// デバイス情報を保存</span>
        <span class="n">DeviceInformation</span> <span class="p">=</span> <span class="n">deviceInfo</span><span class="p">;</span>

        <span class="c1">// デバイス情報更新時のハンドラを解除しウォッチャーをストップ</span>
        <span class="n">DeviceWatcher</span><span class="p">.</span><span class="n">Added</span> <span class="p">-=</span> <span class="n">Watcher_DeviceAdded</span><span class="p">;</span>
        <span class="n">DeviceWatcher</span><span class="p">.</span><span class="nf">Stop</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>※MSのサンプルだと<code>DeviceWatcher.Added</code>以外に、<code>Updated</code>、<code>Removed</code>、<code>EnumerationCompleted</code>、<code>Stopped</code>のハンドラも登録している。が、試したときにはAdded以外は使ってなかったので、今回は簡単のためにAddedだけにした。</p>

<h2>
<span id="デバイス情報からbluetoothledeviceを取得" class="fragment"></span><a href="#%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E6%83%85%E5%A0%B1%E3%81%8B%E3%82%89bluetoothledevice%E3%82%92%E5%8F%96%E5%BE%97"><i class="fa fa-link"></i></a>デバイス情報からBluetoothLEDeviceを取得</h2>

<p>ウォッチャーで保存したデバイス情報に載っているIDをもとに、<code>BluetoothLEDevice</code>を取得する。</p>

<div class="code-frame" data-lang="cs"><div class="highlight"><pre class="with-code"><code><span class="c1">// デバイスを、ペアリングしている対象の機器のIDからとってくる</span>
<span class="c1">// private BluetoothLEDevice Device { get; set; }</span>
<span class="n">Device</span> <span class="p">=</span> <span class="k">await</span> <span class="n">BluetoothLEDevice</span><span class="p">.</span><span class="nf">FromIdAsync</span><span class="p">(</span><span class="n">DeviceInformation</span><span class="p">.</span><span class="n">Id</span><span class="p">);</span>
</code></pre></div></div>

<p>※APIの名前に「Connect」とつかないのでよくわからないが、<code>BluetoothLEDevice</code>を取得した時点でいわゆる「Connect」状態っぽい。（Device.ConnectionStatusが「Conected」になっている）</p>

<h1>
<span id="温度データ変化時に受け取る機能好きなときに取得する機能-の実装" class="fragment"></span><a href="#%E6%B8%A9%E5%BA%A6%E3%83%87%E3%83%BC%E3%82%BF%E5%A4%89%E5%8C%96%E6%99%82%E3%81%AB%E5%8F%97%E3%81%91%E5%8F%96%E3%82%8B%E6%A9%9F%E8%83%BD%E5%A5%BD%E3%81%8D%E3%81%AA%E3%81%A8%E3%81%8D%E3%81%AB%E5%8F%96%E5%BE%97%E3%81%99%E3%82%8B%E6%A9%9F%E8%83%BD-%E3%81%AE%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>温度データ変化時に受け取る機能/好きなときに取得する機能 の実装</h1>

<p>デバイス情報取得までは、データの取得、変化検出、設定に共通する処理。<br>
これ以降は、取得したい値、設定したい値ごとに、対応するサービスやキャラクタリスティックを、UUIDを使って指定する。</p>

<h2>
<span id="bluetoothledeviceから温度取得に使いたいサービスを取得" class="fragment"></span><a href="#bluetoothledevice%E3%81%8B%E3%82%89%E6%B8%A9%E5%BA%A6%E5%8F%96%E5%BE%97%E3%81%AB%E4%BD%BF%E3%81%84%E3%81%9F%E3%81%84%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%82%92%E5%8F%96%E5%BE%97"><i class="fa fa-link"></i></a>BluetoothLEDeviceから温度取得に使いたいサービスを取得</h2>

<p>UUIDを指定して、温度の取得に必要なサービスを取得する。<br>
今回の場合は、UUID=0x3000のサービスを取得する。<br>
<a href="https://camo.qiitausercontent.com/ac094eb7ae7ded75111655dc7007a864434e9fb9/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335323630312f65643132633635662d643662652d386439362d653266662d3932326639646134613230372e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2Fed12c65f-d6be-8d96-e2ff-922f9da4a207.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=99304c4c2ebd1f13dbccdfcf30969f70" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/352601/ed12c65f-d6be-8d96-e2ff-922f9da4a207.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2Fed12c65f-d6be-8d96-e2ff-922f9da4a207.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=78474dd8b2daca97558bcfc69b4781f3 1x" loading="lazy"></a></p>

<div class="code-frame" data-lang="cs"><div class="highlight"><pre class="with-code"><code><span class="c1">// その機器のサービスをとる</span>
<span class="c1">// Guid SeosorServiceUuid = new Guid("0C4C3000-7700-46F4-AA96-D5E974E32A54");</span>
<span class="kt">var</span> <span class="n">services</span> <span class="p">=</span> <span class="k">await</span> <span class="n">Device</span><span class="p">.</span><span class="nf">GetGattServicesForUuidAsync</span><span class="p">(</span><span class="n">SeosorServiceUuid</span><span class="p">);</span>
</code></pre></div></div>

<p>※ベースのUUIDは<code>0C4CXXXX-7700-46F4-AA96-D5E974E32A54</code>なので、XXXXのところを3000に置き換える。<br>
　以降、キャラクタリスティックのUUIDも同じようにする。</p>

<h2>
<span id="サービスから温度取得に使いたいキャラクタリスティックを取得" class="fragment"></span><a href="#%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%81%8B%E3%82%89%E6%B8%A9%E5%BA%A6%E5%8F%96%E5%BE%97%E3%81%AB%E4%BD%BF%E3%81%84%E3%81%9F%E3%81%84%E3%82%AD%E3%83%A3%E3%83%A9%E3%82%AF%E3%82%BF%E3%83%AA%E3%82%B9%E3%83%86%E3%82%A3%E3%83%83%E3%82%AF%E3%82%92%E5%8F%96%E5%BE%97"><i class="fa fa-link"></i></a>サービスから温度取得に使いたいキャラクタリスティックを取得</h2>

<p>サービスから、UUIDを指定してキャラクタリスティックを取得する。<br>
今回の場合は、UUID=0x3001のキャラクタリスティックを取得する。<br>
<a href="https://camo.qiitausercontent.com/62e764601523b9112ca421b43613a89559bbf52a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335323630312f66316239656563332d306339312d373038332d376430382d3263336332316465393235352e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2Ff1b9eec3-0c91-7083-7d08-2c3c21de9255.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=04e0f0e165bbff2eca8b5b1452c88947" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/352601/f1b9eec3-0c91-7083-7d08-2c3c21de9255.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2Ff1b9eec3-0c91-7083-7d08-2c3c21de9255.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=426e06245bd5da07d5ffb6b4d56ffc8c 1x" loading="lazy"></a></p>

<div class="code-frame" data-lang="cs"><div class="highlight"><pre class="with-code"><code><span class="c1">// サービスから、目的のキャラクタリスティックのコレクションをとる</span>
<span class="kt">var</span> <span class="n">characteristics</span> <span class="p">=</span> <span class="k">await</span> <span class="n">services</span><span class="p">.</span><span class="n">Services</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="nf">GetCharacteristicsForUuidAsync</span><span class="p">(</span><span class="n">LatestDataCharacteristicUuid</span><span class="p">);</span>
<span class="c1">// キャラクタリスティックを保存する</span>
<span class="c1">// private GattCharacteristic LatestDataCharacteristic { get; set; }</span>
<span class="n">LatestDataCharacteristic</span> <span class="p">=</span> <span class="n">characteristics</span><span class="p">.</span><span class="n">Characteristics</span><span class="p">[</span><span class="m">0</span><span class="p">];</span>
</code></pre></div></div>

<p>サービスもキャラクタリスティックも、取得の際はリストとして取得されてくるが、UUIDを指定しているので、取得されてくるのは1つだけのはず。なので、ここでは[0]を使っている。</p>

<h2>
<span id="キャラクタリスティックのディスクリプタを設定notify" class="fragment"></span><a href="#%E3%82%AD%E3%83%A3%E3%83%A9%E3%82%AF%E3%82%BF%E3%83%AA%E3%82%B9%E3%83%86%E3%82%A3%E3%83%83%E3%82%AF%E3%81%AE%E3%83%87%E3%82%A3%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%82%BF%E3%82%92%E8%A8%AD%E5%AE%9Anotify"><i class="fa fa-link"></i></a>キャラクタリスティックのディスクリプタを設定(Notify)</h2>

<p>初期状態(接続したての状態)では、ディスクリプタの値が「None」になっていて、値が変化しても検出しない(後で登録するハンドラを通らない)ので、「Notify」にしてやる。</p>

<div class="code-frame" data-lang="cs"><div class="highlight"><pre class="with-code"><code><span class="c1">// 温度のためのキャラクタリスティックを、変化検出(Notify)できるようにする</span>
<span class="kt">var</span> <span class="n">status</span> <span class="p">=</span> <span class="k">await</span> <span class="n">LatestDataCharacteristic</span><span class="p">.</span><span class="nf">WriteClientCharacteristicConfigurationDescriptorAsync</span><span class="p">(</span><span class="n">GattClientCharacteristicConfigurationDescriptorValue</span><span class="p">.</span><span class="n">Notify</span><span class="p">);</span>
</code></pre></div></div>

<h2>
<span id="キャラクタリスティック変化時のハンドラを登録" class="fragment"></span><a href="#%E3%82%AD%E3%83%A3%E3%83%A9%E3%82%AF%E3%82%BF%E3%83%AA%E3%82%B9%E3%83%86%E3%82%A3%E3%83%83%E3%82%AF%E5%A4%89%E5%8C%96%E6%99%82%E3%81%AE%E3%83%8F%E3%83%B3%E3%83%89%E3%83%A9%E3%82%92%E7%99%BB%E9%8C%B2"><i class="fa fa-link"></i></a>キャラクタリスティック変化時のハンドラを登録</h2>

<p>変化検出したときに行うハンドラを登録する。<br>
試したところ、この環境センサでは、後で設定する「計測間隔」の間隔でこのハンドラを通るっぽい。</p>

<div class="code-frame" data-lang="cs"><div class="highlight"><pre class="with-code"><code><span class="c1">// キャラクタリスティックの変化検出時のハンドラを登録</span>
<span class="n">LatestDataCharacteristic</span><span class="p">.</span><span class="n">ValueChanged</span> <span class="p">+=</span> <span class="p">((</span><span class="n">s</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="c1">// 値を読み込み</span>
    <span class="kt">var</span> <span class="n">reader</span> <span class="p">=</span> <span class="n">DataReader</span><span class="p">.</span><span class="nf">FromBuffer</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">CharacteristicValue</span><span class="p">);</span>
    <span class="kt">byte</span><span class="p">[]</span> <span class="n">input</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="p">[</span><span class="n">reader</span><span class="p">.</span><span class="n">UnconsumedBufferLength</span><span class="p">];</span>
    <span class="n">reader</span><span class="p">.</span><span class="nf">ReadBytes</span><span class="p">(</span><span class="n">input</span><span class="p">);</span>

    <span class="c1">// 読みこんだデータを整形</span>
    <span class="kt">double</span> <span class="n">t</span> <span class="p">=</span> <span class="p">(</span><span class="kt">double</span><span class="p">)(</span><span class="n">input</span><span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="p">+</span> <span class="m">0x0100</span> <span class="p">*</span> <span class="n">input</span><span class="p">[</span><span class="m">2</span><span class="p">])</span> <span class="p">/</span> <span class="m">100</span><span class="p">;</span>    <span class="c1">// 温度</span>
    <span class="kt">double</span> <span class="n">h</span> <span class="p">=</span> <span class="p">(</span><span class="kt">double</span><span class="p">)(</span><span class="n">input</span><span class="p">[</span><span class="m">3</span><span class="p">]</span> <span class="p">+</span> <span class="m">0x0100</span> <span class="p">*</span> <span class="n">input</span><span class="p">[</span><span class="m">4</span><span class="p">])</span> <span class="p">/</span> <span class="m">100</span><span class="p">;</span>    <span class="c1">// 湿度</span>
    <span class="kt">double</span> <span class="n">i</span> <span class="p">=</span> <span class="p">(</span><span class="kt">double</span><span class="p">)(</span><span class="n">input</span><span class="p">[</span><span class="m">5</span><span class="p">]</span> <span class="p">+</span> <span class="m">0x0100</span> <span class="p">*</span> <span class="n">input</span><span class="p">[</span><span class="m">6</span><span class="p">]);</span>          <span class="c1">// 照度</span>
    <span class="kt">double</span> <span class="n">n</span> <span class="p">=</span> <span class="p">(</span><span class="kt">double</span><span class="p">)(</span><span class="n">input</span><span class="p">[</span><span class="m">11</span><span class="p">]</span> <span class="p">+</span> <span class="m">0x0100</span> <span class="p">*</span> <span class="n">input</span><span class="p">[</span><span class="m">12</span><span class="p">])</span> <span class="p">/</span> <span class="m">100</span><span class="p">;</span>  <span class="c1">// 騒音</span>
    <span class="n">Debug</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"温度："</span> <span class="p">+</span> <span class="n">t</span> <span class="p">+</span> <span class="s">" 湿度："</span> <span class="p">+</span> <span class="n">h</span> <span class="p">+</span> <span class="s">" 照度："</span> <span class="p">+</span> <span class="n">i</span> <span class="p">+</span> <span class="s">" 騒音："</span> <span class="p">+</span> <span class="n">n</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div></div>

<p>データの整形は、環境センサのキャラクタリスティックの仕様に則って行う。</p>

<p><a href="https://camo.qiitausercontent.com/fe8a19df18e9c763bfc27dfae8be5e35b3b4b528/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335323630312f65323039396161382d316264662d303035342d383737302d6164356263303965326562322e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2Fe2099aa8-1bdf-0054-8770-ad5bc09e2eb2.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=e10bccc881e034cc18aab4f948596de4" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/352601/e2099aa8-1bdf-0054-8770-ad5bc09e2eb2.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2Fe2099aa8-1bdf-0054-8770-ad5bc09e2eb2.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=15ef9ce00c5868342432dee5f9a234b0 1x" loading="lazy"></a></p>

<h2>
<span id="温度取得に使いたいキャラクタリスティックに読み込み要求実施" class="fragment"></span><a href="#%E6%B8%A9%E5%BA%A6%E5%8F%96%E5%BE%97%E3%81%AB%E4%BD%BF%E3%81%84%E3%81%9F%E3%81%84%E3%82%AD%E3%83%A3%E3%83%A9%E3%82%AF%E3%82%BF%E3%83%AA%E3%82%B9%E3%83%86%E3%82%A3%E3%83%83%E3%82%AF%E3%81%AB%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%81%BF%E8%A6%81%E6%B1%82%E5%AE%9F%E6%96%BD"><i class="fa fa-link"></i></a>温度取得に使いたいキャラクタリスティックに読み込み要求実施</h2>

<p>変化検出時ではなく、好きなときに値をとるために、下記の処理を書く。(両方やっても、どちらか片方だけでもOK)</p>

<div class="code-frame" data-lang="cs"><div class="highlight"><pre class="with-code"><code><span class="c1">// プロパティを取得して、読み込みがサポートされてるか判定</span>
<span class="n">GattCharacteristicProperties</span> <span class="n">properties</span> <span class="p">=</span> <span class="n">LatestDataCharacteristic</span><span class="p">.</span><span class="n">CharacteristicProperties</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="n">properties</span><span class="p">.</span><span class="nf">HasFlag</span><span class="p">(</span><span class="n">GattCharacteristicProperties</span><span class="p">.</span><span class="n">Read</span><span class="p">))</span>
<span class="p">{</span>
    <span class="c1">// 値を読み込み</span>
    <span class="n">GattReadResult</span> <span class="n">r</span> <span class="p">=</span> <span class="k">await</span> <span class="n">LatestDataCharacteristic</span><span class="p">.</span><span class="nf">ReadValueAsync</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">Status</span> <span class="p">==</span> <span class="n">GattCommunicationStatus</span><span class="p">.</span><span class="n">Success</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// 成功したら、読み込んだデータを整形する</span>
        <span class="kt">var</span> <span class="n">reader</span> <span class="p">=</span> <span class="n">DataReader</span><span class="p">.</span><span class="nf">FromBuffer</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">Value</span><span class="p">);</span>
        <span class="kt">byte</span><span class="p">[]</span> <span class="n">input</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="p">[</span><span class="n">reader</span><span class="p">.</span><span class="n">UnconsumedBufferLength</span><span class="p">];</span>
        <span class="n">reader</span><span class="p">.</span><span class="nf">ReadBytes</span><span class="p">(</span><span class="n">input</span><span class="p">);</span>

        <span class="c1">// 整形は変化検出時と同じなので割愛</span>
        <span class="c1">// ・・・・</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>※HasFlagでReadできるかどうか確認するのは、仕様書で確実にReadできることを確認ずみであれば、チェックしなくていい気がする。<br>
(MSのサンプルでは、いろいろな機器のサービスやキャラクタリスティックを汎用的に読み書きできるようにしていたのでHasFlagでチェックしてるが、決め打ちのサービス/キャラクタリスティックであればいらないと思う)</p>

<h1>
<span id="測定間隔を設定する機能-の実装" class="fragment"></span><a href="#%E6%B8%AC%E5%AE%9A%E9%96%93%E9%9A%94%E3%82%92%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B%E6%A9%9F%E8%83%BD-%E3%81%AE%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>測定間隔を設定する機能 の実装</h1>

<p>今回使う温度センサは、デフォルトで5分間隔で温度やその他センサ値を計測し、最新のデータとしてキャラクタリスティックに反映させる。つまり、変化検出時のハンドラとして登録したメソッドが、5分に一回呼ばれることになる。<br>
今回は、もうすこし早く値が更新されてほしいので、測定間隔を短く設定できるようにする。</p>

<h2>
<span id="bluetoothledeviceから測定間隔設定に使いたいサービスを取得" class="fragment"></span><a href="#bluetoothledevice%E3%81%8B%E3%82%89%E6%B8%AC%E5%AE%9A%E9%96%93%E9%9A%94%E8%A8%AD%E5%AE%9A%E3%81%AB%E4%BD%BF%E3%81%84%E3%81%9F%E3%81%84%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%82%92%E5%8F%96%E5%BE%97"><i class="fa fa-link"></i></a>BluetoothLEDeviceから測定間隔設定に使いたいサービスを取得</h2>

<p>→<strong>「サービスから温度取得に使いたいキャラクタリスティックを取得」</strong>と同じやり方で、UUIDだけ変えて行う。測定間隔設定用のサービスのUUIDは<code>0x3010</code>。</p>

<h2>
<span id="サービスから測定間隔設定に使いたいキャラクタリスティックを取得" class="fragment"></span><a href="#%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%81%8B%E3%82%89%E6%B8%AC%E5%AE%9A%E9%96%93%E9%9A%94%E8%A8%AD%E5%AE%9A%E3%81%AB%E4%BD%BF%E3%81%84%E3%81%9F%E3%81%84%E3%82%AD%E3%83%A3%E3%83%A9%E3%82%AF%E3%82%BF%E3%83%AA%E3%82%B9%E3%83%86%E3%82%A3%E3%83%83%E3%82%AF%E3%82%92%E5%8F%96%E5%BE%97"><i class="fa fa-link"></i></a>サービスから測定間隔設定に使いたいキャラクタリスティックを取得</h2>

<p>→<strong>「サービスから温度取得に使いたいキャラクタリスティックを取得」</strong>と同じやり方で、UUIDだけ変えて行う。測定間隔設定用のキャラクタリスティックのUUIDは<code>0x3011</code>。</p>

<h2>
<span id="測定間隔設定に使いたいキャラクタリスティックに書き込み要求実施" class="fragment"></span><a href="#%E6%B8%AC%E5%AE%9A%E9%96%93%E9%9A%94%E8%A8%AD%E5%AE%9A%E3%81%AB%E4%BD%BF%E3%81%84%E3%81%9F%E3%81%84%E3%82%AD%E3%83%A3%E3%83%A9%E3%82%AF%E3%82%BF%E3%83%AA%E3%82%B9%E3%83%86%E3%82%A3%E3%83%83%E3%82%AF%E3%81%AB%E6%9B%B8%E3%81%8D%E8%BE%BC%E3%81%BF%E8%A6%81%E6%B1%82%E5%AE%9F%E6%96%BD"><i class="fa fa-link"></i></a>測定間隔設定に使いたいキャラクタリスティックに書き込み要求実施</h2>

<p>設定のためのキャラクタリスティックは、下記のような使用になっている。<br>
今回は、5秒に設定することにする。<br>
<a href="https://camo.qiitausercontent.com/5a4d4c5014364414440cefd4fac5eb50f1a6f8ec/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335323630312f38363730396262332d623936662d323036352d383664362d3462613737646438396531372e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2F86709bb3-b96f-2065-86d6-4ba77dd89e17.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=c7d889c1b30d423b5965cb02c98617ea" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/352601/86709bb3-b96f-2065-86d6-4ba77dd89e17.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2F86709bb3-b96f-2065-86d6-4ba77dd89e17.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=369a4fc997101065f5e3c67749f1d383 1x" loading="lazy"></a></p>

<p>設定に必要なキャラクタリスティックを取得したうえで、下記を行う。</p>

<div class="code-frame" data-lang="cs"><div class="highlight"><pre class="with-code"><code><span class="n">GattCharacteristicProperties</span> <span class="n">properties</span> <span class="p">=</span> <span class="n">characteristic</span><span class="p">.</span><span class="n">CharacteristicProperties</span><span class="p">;</span>

                    <span class="c1">// 書き込みがサポートされてるか判定</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">properties</span><span class="p">.</span><span class="nf">HasFlag</span><span class="p">(</span><span class="n">GattCharacteristicProperties</span><span class="p">.</span><span class="n">Write</span><span class="p">))</span>
                    <span class="p">{</span>
                        <span class="kt">var</span> <span class="n">writer</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">DataWriter</span><span class="p">();</span>
                        <span class="n">writer</span><span class="p">.</span><span class="n">ByteOrder</span> <span class="p">=</span> <span class="n">ByteOrder</span><span class="p">.</span><span class="n">LittleEndian</span><span class="p">;</span>
                        <span class="n">writer</span><span class="p">.</span><span class="nf">WriteInt16</span><span class="p">(</span><span class="m">5</span><span class="p">);</span><span class="c1">// 設定値を作成(ここでは5秒)</span>
                        <span class="n">GattCommunicationStatus</span> <span class="n">r</span> <span class="p">=</span> <span class="k">await</span> <span class="n">characteristic</span><span class="p">.</span><span class="nf">WriteValueAsync</span><span class="p">(</span><span class="n">writer</span><span class="p">.</span><span class="nf">DetachBuffer</span><span class="p">());</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">r</span> <span class="p">==</span> <span class="n">GattCommunicationStatus</span><span class="p">.</span><span class="n">Success</span><span class="p">)</span>
                        <span class="p">{</span>
                            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"設定成功"</span><span class="p">);</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
</code></pre></div></div>

<p>※今回の測定間隔は2バイトのデータのため、<code>writer.WriteInt16(5);</code>としている。<br>
もし設定が1バイトのデータだった場合は、<code>writer.WriteByte(5);</code>にする必要がある。</p>

<h1>
<span id="以上" class="fragment"></span><a href="#%E4%BB%A5%E4%B8%8A"><i class="fa fa-link"></i></a>以上</h1>

<p>ここまでで、一応温度やその他のセンサの値をとるということはできた。<br>
ここまでを調べたうえで分かったことや不明点を、以下にメモとして残す。</p>

<h1>
<span id="以下メモ書き" class="fragment"></span><a href="#%E4%BB%A5%E4%B8%8B%E3%83%A1%E3%83%A2%E6%9B%B8%E3%81%8D"><i class="fa fa-link"></i></a>以下、メモ書き。</h1>

<h2>
<span id="不明点メモ" class="fragment"></span><a href="#%E4%B8%8D%E6%98%8E%E7%82%B9%E3%83%A1%E3%83%A2"><i class="fa fa-link"></i></a>不明点メモ</h2>

<ul>
<li>「Connect」の反対の「Disconnect」のやり方が不明。たぶん、キャラクタリスティック、サービス、デバイスのインスタンスをdisposeしてイベントハンドラを-=したらよいと思われるが、本当にそれでよいのか未確認。</li>
<li>Watcher_DeviceAdded以外(UpdatedとかRemovedとか)は、どういうときに呼ばれるのか不明。(遠くまでセンサもっていって通信が切れててもRemovedに来なかったし、再接続してもAddとかUpdated通らずに、普通にハンドラ通ってデータ取り出したので)</li>
<li>selectorの書き方と効果が不明。サービスのUUIDをselectorで指定すると、なぜペアリングしたものだけになるのか？がわかってない(サービスのUUIDを渡しているGetDeviceSelectorFromUuidが返すAQSが、そういう文字列になっているのかも？=GetDeviceSelectorFromUuidの仕様かも？)(selectorに書いてるGUIDが何か、は<a href="https://docs.microsoft.com/ja-jp/windows/uwp/devices-sensors/aep-service-class-ids" rel="nofollow noopener" target="_blank"><strong>ここ</strong></a>に書いてるっぽい)</li>
</ul>

<h2>
<span id="ペアリング関連メモ" class="fragment"></span><a href="#%E3%83%9A%E3%82%A2%E3%83%AA%E3%83%B3%E3%82%B0%E9%96%A2%E9%80%A3%E3%83%A1%E3%83%A2"><i class="fa fa-link"></i></a>ペアリング関連メモ</h2>

<ul>
<li>
<p>ペアリングなしでデータとりたい場合の流れ</p>

<ul>
<li>デバイスを探す(watcherでセレクタをprotocolId=BLE全部(bb7bb05e-5972-42b5-94fc-76eaa7084d49にする))</li>
<li>指定の名前のデバイス(EnvSensor-BL01)がAddされてきたら、そのデバイス情報を保存</li>
<li>BluetoothLEDeviceを取得</li>
<li>使いたいサービスを取得</li>
<li>使いたいキャラクタリスティックを取得</li>
<li>キャラクタリスティックのディスクリプタを設定(Notify)</li>
<li>キャラクタリスティック変化時のハンドラを登録</li>
</ul>
</li>
<li>
<p>ペアリングもアプリ内でやりたい場合の流れ</p>

<ul>
<li>デバイスを探す(watcherでセレクタをprotocolId=BLE全部(bb7bb05e-5972-42b5-94fc-76eaa7084d49にする))</li>
<li>指定の名前のデバイス(EnvSensor-BL01)がAddされてきたら、そのデバイス情報を保存</li>
<li>デバイス情報を使ってペアリングする</li>
<li>BluetoothLEDeviceを取得</li>
<li>使いたいサービスを取得</li>
<li>使いたいキャラクタリスティックを取得</li>
<li>キャラクタリスティックのディスクリプタを設定(Notify)</li>
<li>キャラクタリスティック変化時のハンドラを登録</li>
</ul>
</li>
</ul>

<h2>
<span id="おすすめ仕様メモ" class="fragment"></span><a href="#%E3%81%8A%E3%81%99%E3%81%99%E3%82%81%E4%BB%95%E6%A7%98%E3%83%A1%E3%83%A2"><i class="fa fa-link"></i></a>おすすめ仕様メモ</h2>

<p>できれば、BLEで何かつくるときは、<br>
「アプリを使う前に温度センサをペアリングしておいて、その機器とだけ通信する」仕様にしたい。<br>
でないと、近所に同じセンサが複数あった時に、アプリ上でその機器をListにして、どれを使うか選択してもらわないといけないようなややこしい仕様になりそう。<br>
(何でもアプリでやらず、Windowsの機能でやれるところ(使う機器の選択=ペアリング)はやってしまいたい)</p>

<h2>
<span id="selectorについてメモ" class="fragment"></span><a href="#selector%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E3%83%A1%E3%83%A2"><i class="fa fa-link"></i></a>selectorについてメモ</h2>

<p>・CreateWatcherで使う「selector」は、何をあらわしている？？<br>
→<a href="https://docs.microsoft.com/ja-jp/windows/uwp/devices-sensors/aep-service-class-ids%E3%81%AB%E6%9B%B8%E3%81%84%E3%81%A6%E3%82%8B%E3%80%82" class="autolink" rel="nofollow noopener" target="_blank">https://docs.microsoft.com/ja-jp/windows/uwp/devices-sensors/aep-service-class-idsに書いてる。</a><br>
このIDで、何を相手にするかを絞ってやることで、電池の寿命が延びたりする。<br>
プロトコルIDを指定してCreateWatcherすることで、そのプロトコルを持つ機器をwatchできる。<br>
下記に、セレクタの例がある。この例のようにセレクタを書けば、ウォッチするデバイスを絞れそう。<br>
<a href="https://docs.microsoft.com/en-gb/windows/uwp/devices-sensors/build-a-device-selector#aqs-string-examples" class="autolink" rel="nofollow noopener" target="_blank">https://docs.microsoft.com/en-gb/windows/uwp/devices-sensors/build-a-device-selector#aqs-string-examples</a><br>
<a href="https://docs.microsoft.com/ja-jp/windows/uwp/devices-sensors/enumerate-devices-over-a-network" class="autolink" rel="nofollow noopener" target="_blank">https://docs.microsoft.com/ja-jp/windows/uwp/devices-sensors/enumerate-devices-over-a-network</a></p>

<h1>
<span id="windows-iot-coreラズパイ3について" class="fragment"></span><a href="#windows-iot-core%E3%83%A9%E3%82%BA%E3%83%91%E3%82%A43%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>Windows Iot Core(ラズパイ3)について</h1>

<p>WPFで実験用に作ったものを、ほぼ同じコードでUWPにして、PCのWindows10上で動かすと、うまく動作した。<br>
ただ、ラズパイ3のWindows IOT core上で動かすと、うまく動かなかった。<br>
具体的には、デバイス、サービス、キャラクタリスティックを取得するまではうまく動くが、Notifyをセットするところでほぼ毎回失敗し「Unreachable」になる。(「ほぼ」というのは、何度もやっていると、たまーにNotifyのsetが成功して、成功後は値をうまく取れ続ける、ということ。原因はわからなかった)<br>
<strong>Win Iot coreまたはラズパイ3ではいまのところそんなもん</strong>として、今回はあきらめた。</p>

<h1>
<span id="コード一式" class="fragment"></span><a href="#%E3%82%B3%E3%83%BC%E3%83%89%E4%B8%80%E5%BC%8F"><i class="fa fa-link"></i></a>コード一式</h1>

<p><qiita-embed-ogp src="https://github.com/tera1707/BleSample"></qiita-embed-ogp></p>

<h1>
<span id="参考" class="fragment"></span><a href="#%E5%8F%82%E8%80%83"><i class="fa fa-link"></i></a>参考</h1>

<p>■GATT公式<br>
公式ページトップ<br>
<a href="https://www.bluetooth.com/" class="autolink" rel="nofollow noopener" target="_blank">https://www.bluetooth.com/</a></p>

<p>公式プロファイルとサービス一覧<br>
<a href="https://www.bluetooth.com/specifications/gatt/" class="autolink" rel="nofollow noopener" target="_blank">https://www.bluetooth.com/specifications/gatt/</a></p>

<p>公式サービスとUUID一覧<br>
<a href="https://www.bluetooth.com/specifications/gatt/services/" class="autolink" rel="nofollow noopener" target="_blank">https://www.bluetooth.com/specifications/gatt/services/</a></p>

<p>公式キャラクタリスティックとUUID一覧<br>
<a href="https://www.bluetooth.com/specifications/gatt/characteristics/" class="autolink" rel="nofollow noopener" target="_blank">https://www.bluetooth.com/specifications/gatt/characteristics/</a></p>

<p>公式UUID<br>
<a href="https://www.bluetooth.com/specifications/assigned-numbers/" class="autolink" rel="nofollow noopener" target="_blank">https://www.bluetooth.com/specifications/assigned-numbers/</a></p>

<p>■実験につかうオムロンBL01の仕様<br>
BAG型<br>
<a href="https://www.omron.co.jp/ecb/product-detail?partId=73062" class="autolink" rel="nofollow noopener" target="_blank">https://www.omron.co.jp/ecb/product-detail?partId=73062</a><br>
<a href="https://omronfs.omron.com/ja_JP/ecb/products/pdf/CDSC-015.pdf" class="autolink" rel="nofollow noopener" target="_blank">https://omronfs.omron.com/ja_JP/ecb/products/pdf/CDSC-015.pdf</a></p>

<p>USB型<br>
<a href="https://www.omron.co.jp/ecb/product-detail?partId=73063" class="autolink" rel="nofollow noopener" target="_blank">https://www.omron.co.jp/ecb/product-detail?partId=73063</a></p>

<p>■MSページ<br>
CreateWatcherで使うProtocolIdの一覧<br>
<a href="https://docs.microsoft.com/ja-jp/windows/uwp/devices-sensors/aep-service-class-ids" class="autolink" rel="nofollow noopener" target="_blank">https://docs.microsoft.com/ja-jp/windows/uwp/devices-sensors/aep-service-class-ids</a></p>

<p>AQS(ウォッチャーのselector)の書き方<br>
<a href="https://docs.microsoft.com/ja-jp/windows/uwp/devices-sensors/enumerate-devices-over-a-network" class="autolink" rel="nofollow noopener" target="_blank">https://docs.microsoft.com/ja-jp/windows/uwp/devices-sensors/enumerate-devices-over-a-network</a></p>

<p>■MSサンプル<br>
サービス/キャラクタリスティック接続と取得/設定<br>
<a href="https://github.com/microsoft/Windows-universal-samples/tree/master/Samples/BluetoothLE/cs" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/microsoft/Windows-universal-samples/tree/master/Samples/BluetoothLE/cs</a></p>

<p>デバイス検索とペアリング<br>
<a href="https://github.com/microsoft/Windows-universal-samples/tree/master/Samples/DeviceEnumerationAndPairing/cs" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/microsoft/Windows-universal-samples/tree/master/Samples/DeviceEnumerationAndPairing/cs</a></p>

<p>■非公式解説ページ<br>
以下のページを見れば、だいたいBLEがどういう構造なのかわかる。<br>
下記のページで勉強させていただきました。ありがとうございます。<br>
どのページも、むちゃくちゃわかりやすいです。</p>

<p>BLEの説明<br>
<a href="http://jellyware.jp/kurage/bluejelly/ble_guide.html" class="autolink" rel="nofollow noopener" target="_blank">http://jellyware.jp/kurage/bluejelly/ble_guide.html</a></p>

<p>UUIDとは？<br>
<a href="http://jellyware.jp/kurage/bluejelly/uuid.html" class="autolink" rel="nofollow noopener" target="_blank">http://jellyware.jp/kurage/bluejelly/uuid.html</a></p>

<p>BLE v4とは<br>
<a href="https://micro.rohm.com/jp/techweb_iot/knowledge/iot02/s-iot02/01-s-iot02/39" class="autolink" rel="nofollow noopener" target="_blank">https://micro.rohm.com/jp/techweb_iot/knowledge/iot02/s-iot02/01-s-iot02/39</a></p>

<p>Gattの構造<br>
<a href="https://micro.rohm.com/jp/techweb_iot/knowledge/iot02/s-iot02/04-s-iot02/3792" class="autolink" rel="nofollow noopener" target="_blank">https://micro.rohm.com/jp/techweb_iot/knowledge/iot02/s-iot02/04-s-iot02/3792</a></p>

<p>NotifyとIndicateの違い<br>
<a href="http://yegang.hatenablog.com/entry/2014/08/09/195246" class="autolink" rel="nofollow noopener" target="_blank">http://yegang.hatenablog.com/entry/2014/08/09/195246</a></p>

<p>BLEの通信の手順(というか流れ)<br>
<a href="http://www.microtechnica.tv/support/manual/clickble_man.pdf" class="autolink" rel="nofollow noopener" target="_blank">http://www.microtechnica.tv/support/manual/clickble_man.pdf</a></p>

<p>アドバタイズパケットについて<br>
<a href="https://qiita.com/gebo/items/2e51bebd3d26a3025d9f" class="autolink" id="reference-80dab16fe4f86101b11a">https://qiita.com/gebo/items/2e51bebd3d26a3025d9f</a></p>

<p>アドバタイズパケットでデータをとる<br>
<a href="https://qiita.com/komde/items/7209b36159da69ae79d2" class="autolink" id="reference-8f5951a888a4b865b6a5">https://qiita.com/komde/items/7209b36159da69ae79d2</a></p>

<p>.net4.7.0のときのAPIは、ペアリングしたBLE機器でないとServiceをとってこれないっぽい<br>
<a href="https://codeday.me/jp/qa/20190629/1132145.html" class="autolink" rel="nofollow noopener" target="_blank">https://codeday.me/jp/qa/20190629/1132145.html</a></p>

<p>MSブログの実装の説明<br>
<a href="https://blogs.msdn.microsoft.com/shozoa/2016/02/28/windows-10-bluetooth/" class="autolink" rel="nofollow noopener" target="_blank">https://blogs.msdn.microsoft.com/shozoa/2016/02/28/windows-10-bluetooth/</a></p>

<p>Windowsのバージョンによって、ペアリングがいるとかいらないとか(15030以降は要らないとか)<br>
<a href="https://docs.microsoft.com/ja-jp/windows/uwp/devices-sensors/bluetooth-dev-faq" class="autolink" rel="nofollow noopener" target="_blank">https://docs.microsoft.com/ja-jp/windows/uwp/devices-sensors/bluetooth-dev-faq</a></p>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Ftera1707%2Fitems%2F5505ed22b5ddf93795f4&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Ftera1707%2Fitems%2F5505ed22b5ddf93795f4&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/tera1707/items/5505ed22b5ddf93795f4/likers" class="css-1iupg5d">15</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">20</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/5505ed22b5ddf93795f4/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/tera1707/items/5505ed22b5ddf93795f4/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/tera1707/items/5505ed22b5ddf93795f4/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/tera1707/items/5505ed22b5ddf93795f4/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/tera1707/items/5505ed22b5ddf93795f4.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-1c59ae1e-311b-4a3d-89f5-713073b92a0f">{"authorAnalyticsTrackingId":"UA-140152640-1","organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-678e3c5a-1559-48e1-9fdd-90c4e97bfa94"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-678e3c5a-1559-48e1-9fdd-90c4e97bfa94">{}</script>
      
<div id="LoginModal-react-component-e2e2f57a-62c8-4e95-ad55-fa5be6d6a71c"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-e2e2f57a-62c8-4e95-ad55-fa5be6d6a71c">{}</script>
      
<div id="StockModal-react-component-b67f5b8d-fe0f-442a-a3ca-7d4949ac968a"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-b67f5b8d-fe0f-442a-a3ca-7d4949ac968a">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;Vbr19Lx4SCIFpkSt4gd4++hpDeWnmHZ7P0NKMgM2ff/vznmW81ZXYRhJXAK2uJmqotpSqU5mbtTDa8Im+CyC3w==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\n\u003ch1\u003e\n\u003cspan id=\"ble関連記事\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#ble%E9%96%A2%E9%80%A3%E8%A8%98%E4%BA%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eBLE関連記事\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://qiita.com/tera1707/items/e04d86a68a9f96e02fe9\" id=\"reference-c4e57cb99e374aba7d81\"\u003e[C#/WinRT]Bluetooth v4(BLE)機器と通信する（BLE基礎メモ）\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://qiita.com/tera1707/items/5505ed22b5ddf93795f4\"\u003e[C#/WinRT]Bluetooth v4(BLE)機器と通信する（C#で実装メモ）\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://qiita.com/tera1707/items/1c066934774e0dd74cac\" id=\"reference-90b654534f495976b62a\"\u003e[C#/WinRT] WPFでBluetooth v4(BLE)機器とペアリングする\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"やりたいこと\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%84%E3%82%8A%E3%81%9F%E3%81%84%E3%81%93%E3%81%A8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eやりたいこと\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita.com/tera1707/items/e04d86a68a9f96e02fe9\"\u003e前回\u003c/a\u003eの記事で、何となくBluetooth v4で環境センサから値をとるためには、ここからとればよいというのが分かったので、それをWindowsで(WinRTで)実装するにはどう書けばよいかを調べていく。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"前提\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%89%8D%E6%8F%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e前提\u003c/h1\u003e\n\n\u003cp\u003e今回は、下記のものを使って実験をする。\u003c/p\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align: left\"\u003e使うもの\u003c/th\u003e\n\u003cth style=\"text-align: left\"\u003e内容\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e環境\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eWPF .net Framework 4.7.2\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003eNuget\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eMicrosoft.Windows.SDK.Contracts　→　UWPのAPI(WinRTのAPI)を使うため\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e使用機器\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eOMRON 環境センサ 2JCIE-BL01\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003cul\u003e\n\u003cli\u003e使うクラス(UWP(WinRT)API)\n\n\u003cul\u003e\n\u003cli\u003eWindows.Devices.Bluetooth;\u003c/li\u003e\n\u003cli\u003eWindows.Devices.Bluetooth.Advertisement;\u003c/li\u003e\n\u003cli\u003eWindows.Devices.Bluetooth.GenericAttributeProfile;\u003c/li\u003e\n\u003cli\u003eWindows.Devices.Enumeration;\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e基本的に、下記のサンプルをもとにしている。\u003cbr\u003e\n\u003ca href=\"https://github.com/microsoft/Windows-universal-samples/tree/master/Samples/BluetoothLE/cs\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/microsoft/Windows-universal-samples/tree/master/Samples/BluetoothLE/cs\u003c/a\u003e\u003cbr\u003e\nこれをベースに、今回やろうとしていることに最低限必要な処理だけ抜き出したのが今回やったこと。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"作成するもの\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B%E3%82%82%E3%81%AE\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e作成するもの\u003c/h1\u003e\n\n\u003cp\u003eBLE環境センサから温度をとってきてアプリで使うということをしたいので、温度を採ってこれるライブラリ(dll)を作る。\u003cbr\u003e\nまずは勉強のためにあまりエラー処理を入れずに、正常系だけで最低限必要な処理だけつくるイメージにする。機能としては、下記のようなイメージ。\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eペアリング済みの環境センサと接続する\u003c/li\u003e\n\u003cli\u003e温度データ変化時に受け取る機能\u003c/li\u003e\n\u003cli\u003e温度データを好きなときに取得する機能\u003c/li\u003e\n\u003cli\u003e測定間隔を設定する機能\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"通信の流れ概要\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%80%9A%E4%BF%A1%E3%81%AE%E6%B5%81%E3%82%8C%E6%A6%82%E8%A6%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e通信の流れ概要\u003c/h2\u003e\n\n\u003cp\u003e前回の記事で、調べた限りの知識でとても乱暴に「どうやって通信するか」「温度を取得するか」を言うと、\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e各開発環境が用意している(今回だとWindowsのWinRTの)APIを使って、\u003c/li\u003e\n\u003cli\u003eセントラル(WindowsPC)から、サービスのUUIDとキャラクタリスティックのUUIDを指定して接続し、\u003c/li\u003e\n\u003cli\u003eペリフェラル(センサ)にRead要求し、\u003c/li\u003e\n\u003cli\u003eペリフェラルからセントラルに帰ってきた情報を見て、温度を知る\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eということをする。\u003cbr\u003e\n測定間隔を設定する機能については、Read要求が「Write要求」になるイメージ。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"通信の流れ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%80%9A%E4%BF%A1%E3%81%AE%E6%B5%81%E3%82%8C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e通信の流れ\u003c/h1\u003e\n\n\u003cp\u003eペアリングは事前に手でやっておく前提で、下記のような流れになる。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"事前準備\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BA%8B%E5%89%8D%E6%BA%96%E5%82%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e事前準備\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003eWindowsの設定で、OMRONの環境センサ(EnvSensor-BL01またはEnv)をペアリングする。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"プログラムに実装する処理\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0%E3%81%AB%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B%E5%87%A6%E7%90%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eプログラムに実装する処理\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003e共通処理\n\n\u003cul\u003e\n\u003cli\u003e環境センサを探す\u003c/li\u003e\n\u003cli\u003e見つかった環境センサのデバイス情報を保存\u003c/li\u003e\n\u003cli\u003eデバイス情報からBluetoothLEDeviceを取得\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e温度データ変化時に受け取る機能/好きなときに取得する機能関連\n\n\u003cul\u003e\n\u003cli\u003eBluetoothLEDeviceから温度取得に使いたいサービスを取得\u003c/li\u003e\n\u003cli\u003eサービスから温度取得に使いたいキャラクタリスティックを取得\u003c/li\u003e\n\u003cli\u003eキャラクタリスティックのディスクリプタを設定(Notify)\u003c/li\u003e\n\u003cli\u003eキャラクタリスティック変化時のハンドラを登録\u003cstrong\u003e→データ変化時に受け取る機能\u003c/strong\u003e\n\u003c/li\u003e\n\u003cli\u003e温度取得に使いたいキャラクタリスティックに読み込み要求実施\u003cstrong\u003e→好きなときに取得する機能\u003c/strong\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e測定間隔を設定する機能関連\n\n\u003cul\u003e\n\u003cli\u003eBluetoothLEDeviceから測定間隔設定に使いたいサービスを取得\u003c/li\u003e\n\u003cli\u003eサービスから測定間隔設定に使いたいキャラクタリスティックを取得\u003c/li\u003e\n\u003cli\u003e測定間隔設定に使いたいキャラクタリスティックに書き込み要求実施\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"共通処理-の実装\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%85%B1%E9%80%9A%E5%87%A6%E7%90%86-%E3%81%AE%E5%AE%9F%E8%A3%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e共通処理 の実装\u003c/h1\u003e\n\n\u003cp\u003e値の読み込み、変化通知(Notify)、書き込みのすべてで共通して行う処理。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"環境センサを探す\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%92%B0%E5%A2%83%E3%82%BB%E3%83%B3%E3%82%B5%E3%82%92%E6%8E%A2%E3%81%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e環境センサを探す\u003c/h2\u003e\n\n\u003cp\u003e環境センサはWindowsの設定でペアリングされている前提。\u003cbr\u003e\n下記のようにselectorを書いてウォッチャーを作成してスタートすると、デバイス情報更新時のハンドラとして登録されたメソッドにて、ペアリングされていて指定のUUIDを持つ機器のみ検索されてくる。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// ペアリングした環境センサを検索対象にする\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// Guid SeosorServiceUuid = new Guid(\"0C4C3000-7700-46F4-AA96-D5E974E32A54\");\u003c/span\u003e\n\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eselector\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"(\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eGattDeviceService\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetDeviceSelectorFromUuid\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eSeosorServiceUuid\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\")\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// ウォッチャー(機器を監視、検索するやつ)を作成\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// private DeviceWatcher DeviceWatcher { get; set; }\u003c/span\u003e\n\u003cspan class=\"n\"\u003eDeviceWatcher\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eDeviceInformation\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateWatcher\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eselector\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// デバイス情報更新時のハンドラを登録\u003c/span\u003e\n\u003cspan class=\"n\"\u003eDeviceWatcher\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAdded\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"n\"\u003eWatcher_DeviceAdded\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// ウォッチャーをスタート(検索開始)\u003c/span\u003e\n\u003cspan class=\"n\"\u003eDeviceWatcher\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eStart\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e※ちなみに、selectorを下記のように書くと、ペアリングしていないBLE機器もまとめて検索されてくるっぽい。そこから、下の流れてデバイス情報を保存することもできるので、「ペアリングせずに対象機器を探してデータをとる」こともできる。(試したら実際できた)\u003cbr\u003e\nただ複数のセンサがある場合など、検索してどれを使うかを選ぶとかしないといけなくなりそうなため、やめた。\u003cstrong\u003eペアリングは手動でやってもらうこととしたい。\u003c/strong\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// BLEプロトコルを持つ機器全部\u003c/span\u003e\n\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eselector\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"(\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\"System.Devices.Aep.ProtocolId:=\\\"{bb7bb05e-5972-42b5-94fc-76eaa7084d49}\\\"\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\")\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003eDeviceWatcher\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eDeviceInformation\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateWatcher\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eselector\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eDeviceInformationKind\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAssociationEndpoint\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"見つかった環境センサのデバイス情報を保存\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A6%8B%E3%81%A4%E3%81%8B%E3%81%A3%E3%81%9F%E7%92%B0%E5%A2%83%E3%82%BB%E3%83%B3%E3%82%B5%E3%81%AE%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E6%83%85%E5%A0%B1%E3%82%92%E4%BF%9D%E5%AD%98\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e見つかった環境センサのデバイス情報を保存\u003c/h2\u003e\n\n\u003cp\u003eウォッチャーが検索してくれた機器が、引数に載ってやってくるので、お目当ての機器かどうかを名前で判定して、当たっていたら保存する。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eWatcher_DeviceAdded\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDeviceWatcher\u003c/span\u003e \u003cspan class=\"n\"\u003esender\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eDeviceInformation\u003c/span\u003e \u003cspan class=\"n\"\u003edeviceInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edeviceInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e\"EnvSensor-BL01\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// デバイス情報を保存\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eDeviceInformation\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edeviceInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// デバイス情報更新時のハンドラを解除しウォッチャーをストップ\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eDeviceWatcher\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAdded\u003c/span\u003e \u003cspan class=\"p\"\u003e-=\u003c/span\u003e \u003cspan class=\"n\"\u003eWatcher_DeviceAdded\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eDeviceWatcher\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eStop\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e※MSのサンプルだと\u003ccode\u003eDeviceWatcher.Added\u003c/code\u003e以外に、\u003ccode\u003eUpdated\u003c/code\u003e、\u003ccode\u003eRemoved\u003c/code\u003e、\u003ccode\u003eEnumerationCompleted\u003c/code\u003e、\u003ccode\u003eStopped\u003c/code\u003eのハンドラも登録している。が、試したときにはAdded以外は使ってなかったので、今回は簡単のためにAddedだけにした。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"デバイス情報からbluetoothledeviceを取得\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E6%83%85%E5%A0%B1%E3%81%8B%E3%82%89bluetoothledevice%E3%82%92%E5%8F%96%E5%BE%97\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eデバイス情報からBluetoothLEDeviceを取得\u003c/h2\u003e\n\n\u003cp\u003eウォッチャーで保存したデバイス情報に載っているIDをもとに、\u003ccode\u003eBluetoothLEDevice\u003c/code\u003eを取得する。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// デバイスを、ペアリングしている対象の機器のIDからとってくる\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// private BluetoothLEDevice Device { get; set; }\u003c/span\u003e\n\u003cspan class=\"n\"\u003eDevice\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eBluetoothLEDevice\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFromIdAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDeviceInformation\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eId\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e※APIの名前に「Connect」とつかないのでよくわからないが、\u003ccode\u003eBluetoothLEDevice\u003c/code\u003eを取得した時点でいわゆる「Connect」状態っぽい。（Device.ConnectionStatusが「Conected」になっている）\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"温度データ変化時に受け取る機能好きなときに取得する機能-の実装\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%B8%A9%E5%BA%A6%E3%83%87%E3%83%BC%E3%82%BF%E5%A4%89%E5%8C%96%E6%99%82%E3%81%AB%E5%8F%97%E3%81%91%E5%8F%96%E3%82%8B%E6%A9%9F%E8%83%BD%E5%A5%BD%E3%81%8D%E3%81%AA%E3%81%A8%E3%81%8D%E3%81%AB%E5%8F%96%E5%BE%97%E3%81%99%E3%82%8B%E6%A9%9F%E8%83%BD-%E3%81%AE%E5%AE%9F%E8%A3%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e温度データ変化時に受け取る機能/好きなときに取得する機能 の実装\u003c/h1\u003e\n\n\u003cp\u003eデバイス情報取得までは、データの取得、変化検出、設定に共通する処理。\u003cbr\u003e\nこれ以降は、取得したい値、設定したい値ごとに、対応するサービスやキャラクタリスティックを、UUIDを使って指定する。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"bluetoothledeviceから温度取得に使いたいサービスを取得\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#bluetoothledevice%E3%81%8B%E3%82%89%E6%B8%A9%E5%BA%A6%E5%8F%96%E5%BE%97%E3%81%AB%E4%BD%BF%E3%81%84%E3%81%9F%E3%81%84%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%82%92%E5%8F%96%E5%BE%97\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eBluetoothLEDeviceから温度取得に使いたいサービスを取得\u003c/h2\u003e\n\n\u003cp\u003eUUIDを指定して、温度の取得に必要なサービスを取得する。\u003cbr\u003e\n今回の場合は、UUID=0x3000のサービスを取得する。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/ac094eb7ae7ded75111655dc7007a864434e9fb9/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335323630312f65643132633635662d643662652d386439362d653266662d3932326639646134613230372e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2Fed12c65f-d6be-8d96-e2ff-922f9da4a207.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=99304c4c2ebd1f13dbccdfcf30969f70\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/352601/ed12c65f-d6be-8d96-e2ff-922f9da4a207.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2Fed12c65f-d6be-8d96-e2ff-922f9da4a207.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=78474dd8b2daca97558bcfc69b4781f3 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// その機器のサービスをとる\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// Guid SeosorServiceUuid = new Guid(\"0C4C3000-7700-46F4-AA96-D5E974E32A54\");\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eservices\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eDevice\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetGattServicesForUuidAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eSeosorServiceUuid\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e※ベースのUUIDは\u003ccode\u003e0C4CXXXX-7700-46F4-AA96-D5E974E32A54\u003c/code\u003eなので、XXXXのところを3000に置き換える。\u003cbr\u003e\n　以降、キャラクタリスティックのUUIDも同じようにする。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"サービスから温度取得に使いたいキャラクタリスティックを取得\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%81%8B%E3%82%89%E6%B8%A9%E5%BA%A6%E5%8F%96%E5%BE%97%E3%81%AB%E4%BD%BF%E3%81%84%E3%81%9F%E3%81%84%E3%82%AD%E3%83%A3%E3%83%A9%E3%82%AF%E3%82%BF%E3%83%AA%E3%82%B9%E3%83%86%E3%82%A3%E3%83%83%E3%82%AF%E3%82%92%E5%8F%96%E5%BE%97\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eサービスから温度取得に使いたいキャラクタリスティックを取得\u003c/h2\u003e\n\n\u003cp\u003eサービスから、UUIDを指定してキャラクタリスティックを取得する。\u003cbr\u003e\n今回の場合は、UUID=0x3001のキャラクタリスティックを取得する。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/62e764601523b9112ca421b43613a89559bbf52a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335323630312f66316239656563332d306339312d373038332d376430382d3263336332316465393235352e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2Ff1b9eec3-0c91-7083-7d08-2c3c21de9255.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=04e0f0e165bbff2eca8b5b1452c88947\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/352601/f1b9eec3-0c91-7083-7d08-2c3c21de9255.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2Ff1b9eec3-0c91-7083-7d08-2c3c21de9255.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=426e06245bd5da07d5ffb6b4d56ffc8c 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// サービスから、目的のキャラクタリスティックのコレクションをとる\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003echaracteristics\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eservices\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eServices\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetCharacteristicsForUuidAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLatestDataCharacteristicUuid\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// キャラクタリスティックを保存する\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// private GattCharacteristic LatestDataCharacteristic { get; set; }\u003c/span\u003e\n\u003cspan class=\"n\"\u003eLatestDataCharacteristic\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003echaracteristics\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCharacteristics\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eサービスもキャラクタリスティックも、取得の際はリストとして取得されてくるが、UUIDを指定しているので、取得されてくるのは1つだけのはず。なので、ここでは[0]を使っている。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"キャラクタリスティックのディスクリプタを設定notify\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%AD%E3%83%A3%E3%83%A9%E3%82%AF%E3%82%BF%E3%83%AA%E3%82%B9%E3%83%86%E3%82%A3%E3%83%83%E3%82%AF%E3%81%AE%E3%83%87%E3%82%A3%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%82%BF%E3%82%92%E8%A8%AD%E5%AE%9Anotify\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eキャラクタリスティックのディスクリプタを設定(Notify)\u003c/h2\u003e\n\n\u003cp\u003e初期状態(接続したての状態)では、ディスクリプタの値が「None」になっていて、値が変化しても検出しない(後で登録するハンドラを通らない)ので、「Notify」にしてやる。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// 温度のためのキャラクタリスティックを、変化検出(Notify)できるようにする\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003estatus\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eLatestDataCharacteristic\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteClientCharacteristicConfigurationDescriptorAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eGattClientCharacteristicConfigurationDescriptorValue\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNotify\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"キャラクタリスティック変化時のハンドラを登録\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%AD%E3%83%A3%E3%83%A9%E3%82%AF%E3%82%BF%E3%83%AA%E3%82%B9%E3%83%86%E3%82%A3%E3%83%83%E3%82%AF%E5%A4%89%E5%8C%96%E6%99%82%E3%81%AE%E3%83%8F%E3%83%B3%E3%83%89%E3%83%A9%E3%82%92%E7%99%BB%E9%8C%B2\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eキャラクタリスティック変化時のハンドラを登録\u003c/h2\u003e\n\n\u003cp\u003e変化検出したときに行うハンドラを登録する。\u003cbr\u003e\n試したところ、この環境センサでは、後で設定する「計測間隔」の間隔でこのハンドラを通るっぽい。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// キャラクタリスティックの変化検出時のハンドラを登録\u003c/span\u003e\n\u003cspan class=\"n\"\u003eLatestDataCharacteristic\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValueChanged\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// 値を読み込み\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eDataReader\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFromBuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCharacteristicValue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003einput\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUnconsumedBufferLength\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReadBytes\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003einput\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// 読みこんだデータを整形\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003edouble\u003c/span\u003e \u003cspan class=\"n\"\u003et\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003edouble\u003c/span\u003e\u003cspan class=\"p\"\u003e)(\u003c/span\u003e\u003cspan class=\"n\"\u003einput\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"m\"\u003e0x0100\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003einput\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e \u003cspan class=\"p\"\u003e/\u003c/span\u003e \u003cspan class=\"m\"\u003e100\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e    \u003cspan class=\"c1\"\u003e// 温度\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003edouble\u003c/span\u003e \u003cspan class=\"n\"\u003eh\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003edouble\u003c/span\u003e\u003cspan class=\"p\"\u003e)(\u003c/span\u003e\u003cspan class=\"n\"\u003einput\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"m\"\u003e0x0100\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003einput\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e \u003cspan class=\"p\"\u003e/\u003c/span\u003e \u003cspan class=\"m\"\u003e100\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e    \u003cspan class=\"c1\"\u003e// 湿度\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003edouble\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003edouble\u003c/span\u003e\u003cspan class=\"p\"\u003e)(\u003c/span\u003e\u003cspan class=\"n\"\u003einput\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e5\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"m\"\u003e0x0100\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003einput\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e6\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e          \u003cspan class=\"c1\"\u003e// 照度\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003edouble\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003edouble\u003c/span\u003e\u003cspan class=\"p\"\u003e)(\u003c/span\u003e\u003cspan class=\"n\"\u003einput\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e11\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"m\"\u003e0x0100\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003einput\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e12\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e \u003cspan class=\"p\"\u003e/\u003c/span\u003e \u003cspan class=\"m\"\u003e100\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e  \u003cspan class=\"c1\"\u003e// 騒音\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"温度：\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003et\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\" 湿度：\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eh\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\" 照度：\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\" 騒音：\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eデータの整形は、環境センサのキャラクタリスティックの仕様に則って行う。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/fe8a19df18e9c763bfc27dfae8be5e35b3b4b528/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335323630312f65323039396161382d316264662d303035342d383737302d6164356263303965326562322e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2Fe2099aa8-1bdf-0054-8770-ad5bc09e2eb2.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=e10bccc881e034cc18aab4f948596de4\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/352601/e2099aa8-1bdf-0054-8770-ad5bc09e2eb2.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2Fe2099aa8-1bdf-0054-8770-ad5bc09e2eb2.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=15ef9ce00c5868342432dee5f9a234b0 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"温度取得に使いたいキャラクタリスティックに読み込み要求実施\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%B8%A9%E5%BA%A6%E5%8F%96%E5%BE%97%E3%81%AB%E4%BD%BF%E3%81%84%E3%81%9F%E3%81%84%E3%82%AD%E3%83%A3%E3%83%A9%E3%82%AF%E3%82%BF%E3%83%AA%E3%82%B9%E3%83%86%E3%82%A3%E3%83%83%E3%82%AF%E3%81%AB%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%81%BF%E8%A6%81%E6%B1%82%E5%AE%9F%E6%96%BD\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e温度取得に使いたいキャラクタリスティックに読み込み要求実施\u003c/h2\u003e\n\n\u003cp\u003e変化検出時ではなく、好きなときに値をとるために、下記の処理を書く。(両方やっても、どちらか片方だけでもOK)\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// プロパティを取得して、読み込みがサポートされてるか判定\u003c/span\u003e\n\u003cspan class=\"n\"\u003eGattCharacteristicProperties\u003c/span\u003e \u003cspan class=\"n\"\u003eproperties\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eLatestDataCharacteristic\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCharacteristicProperties\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eproperties\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eHasFlag\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eGattCharacteristicProperties\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRead\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// 値を読み込み\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eGattReadResult\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eLatestDataCharacteristic\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReadValueAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eStatus\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eGattCommunicationStatus\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSuccess\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 成功したら、読み込んだデータを整形する\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eDataReader\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFromBuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003einput\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUnconsumedBufferLength\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReadBytes\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003einput\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// 整形は変化検出時と同じなので割愛\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// ・・・・\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e※HasFlagでReadできるかどうか確認するのは、仕様書で確実にReadできることを確認ずみであれば、チェックしなくていい気がする。\u003cbr\u003e\n(MSのサンプルでは、いろいろな機器のサービスやキャラクタリスティックを汎用的に読み書きできるようにしていたのでHasFlagでチェックしてるが、決め打ちのサービス/キャラクタリスティックであればいらないと思う)\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"測定間隔を設定する機能-の実装\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%B8%AC%E5%AE%9A%E9%96%93%E9%9A%94%E3%82%92%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B%E6%A9%9F%E8%83%BD-%E3%81%AE%E5%AE%9F%E8%A3%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e測定間隔を設定する機能 の実装\u003c/h1\u003e\n\n\u003cp\u003e今回使う温度センサは、デフォルトで5分間隔で温度やその他センサ値を計測し、最新のデータとしてキャラクタリスティックに反映させる。つまり、変化検出時のハンドラとして登録したメソッドが、5分に一回呼ばれることになる。\u003cbr\u003e\n今回は、もうすこし早く値が更新されてほしいので、測定間隔を短く設定できるようにする。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"bluetoothledeviceから測定間隔設定に使いたいサービスを取得\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#bluetoothledevice%E3%81%8B%E3%82%89%E6%B8%AC%E5%AE%9A%E9%96%93%E9%9A%94%E8%A8%AD%E5%AE%9A%E3%81%AB%E4%BD%BF%E3%81%84%E3%81%9F%E3%81%84%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%82%92%E5%8F%96%E5%BE%97\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eBluetoothLEDeviceから測定間隔設定に使いたいサービスを取得\u003c/h2\u003e\n\n\u003cp\u003e→\u003cstrong\u003e「サービスから温度取得に使いたいキャラクタリスティックを取得」\u003c/strong\u003eと同じやり方で、UUIDだけ変えて行う。測定間隔設定用のサービスのUUIDは\u003ccode\u003e0x3010\u003c/code\u003e。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"サービスから測定間隔設定に使いたいキャラクタリスティックを取得\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%81%8B%E3%82%89%E6%B8%AC%E5%AE%9A%E9%96%93%E9%9A%94%E8%A8%AD%E5%AE%9A%E3%81%AB%E4%BD%BF%E3%81%84%E3%81%9F%E3%81%84%E3%82%AD%E3%83%A3%E3%83%A9%E3%82%AF%E3%82%BF%E3%83%AA%E3%82%B9%E3%83%86%E3%82%A3%E3%83%83%E3%82%AF%E3%82%92%E5%8F%96%E5%BE%97\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eサービスから測定間隔設定に使いたいキャラクタリスティックを取得\u003c/h2\u003e\n\n\u003cp\u003e→\u003cstrong\u003e「サービスから温度取得に使いたいキャラクタリスティックを取得」\u003c/strong\u003eと同じやり方で、UUIDだけ変えて行う。測定間隔設定用のキャラクタリスティックのUUIDは\u003ccode\u003e0x3011\u003c/code\u003e。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"測定間隔設定に使いたいキャラクタリスティックに書き込み要求実施\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%B8%AC%E5%AE%9A%E9%96%93%E9%9A%94%E8%A8%AD%E5%AE%9A%E3%81%AB%E4%BD%BF%E3%81%84%E3%81%9F%E3%81%84%E3%82%AD%E3%83%A3%E3%83%A9%E3%82%AF%E3%82%BF%E3%83%AA%E3%82%B9%E3%83%86%E3%82%A3%E3%83%83%E3%82%AF%E3%81%AB%E6%9B%B8%E3%81%8D%E8%BE%BC%E3%81%BF%E8%A6%81%E6%B1%82%E5%AE%9F%E6%96%BD\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e測定間隔設定に使いたいキャラクタリスティックに書き込み要求実施\u003c/h2\u003e\n\n\u003cp\u003e設定のためのキャラクタリスティックは、下記のような使用になっている。\u003cbr\u003e\n今回は、5秒に設定することにする。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/5a4d4c5014364414440cefd4fac5eb50f1a6f8ec/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335323630312f38363730396262332d623936662d323036352d383664362d3462613737646438396531372e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2F86709bb3-b96f-2065-86d6-4ba77dd89e17.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=c7d889c1b30d423b5965cb02c98617ea\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/352601/86709bb3-b96f-2065-86d6-4ba77dd89e17.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352601%2F86709bb3-b96f-2065-86d6-4ba77dd89e17.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=369a4fc997101065f5e3c67749f1d383 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e設定に必要なキャラクタリスティックを取得したうえで、下記を行う。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eGattCharacteristicProperties\u003c/span\u003e \u003cspan class=\"n\"\u003eproperties\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003echaracteristic\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCharacteristicProperties\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n                    \u003cspan class=\"c1\"\u003e// 書き込みがサポートされてるか判定\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eproperties\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eHasFlag\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eGattCharacteristicProperties\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ewriter\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eDataWriter\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003ewriter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eByteOrder\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eByteOrder\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLittleEndian\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003ewriter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteInt16\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e5\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\u003cspan class=\"c1\"\u003e// 設定値を作成(ここでは5秒)\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003eGattCommunicationStatus\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003echaracteristic\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteValueAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ewriter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDetachBuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n                        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003er\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eGattCommunicationStatus\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSuccess\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                            \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"設定成功\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e※今回の測定間隔は2バイトのデータのため、\u003ccode\u003ewriter.WriteInt16(5);\u003c/code\u003eとしている。\u003cbr\u003e\nもし設定が1バイトのデータだった場合は、\u003ccode\u003ewriter.WriteByte(5);\u003c/code\u003eにする必要がある。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"以上\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BB%A5%E4%B8%8A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e以上\u003c/h1\u003e\n\n\u003cp\u003eここまでで、一応温度やその他のセンサの値をとるということはできた。\u003cbr\u003e\nここまでを調べたうえで分かったことや不明点を、以下にメモとして残す。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"以下メモ書き\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BB%A5%E4%B8%8B%E3%83%A1%E3%83%A2%E6%9B%B8%E3%81%8D\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e以下、メモ書き。\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"不明点メモ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%B8%8D%E6%98%8E%E7%82%B9%E3%83%A1%E3%83%A2\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e不明点メモ\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003e「Connect」の反対の「Disconnect」のやり方が不明。たぶん、キャラクタリスティック、サービス、デバイスのインスタンスをdisposeしてイベントハンドラを-=したらよいと思われるが、本当にそれでよいのか未確認。\u003c/li\u003e\n\u003cli\u003eWatcher_DeviceAdded以外(UpdatedとかRemovedとか)は、どういうときに呼ばれるのか不明。(遠くまでセンサもっていって通信が切れててもRemovedに来なかったし、再接続してもAddとかUpdated通らずに、普通にハンドラ通ってデータ取り出したので)\u003c/li\u003e\n\u003cli\u003eselectorの書き方と効果が不明。サービスのUUIDをselectorで指定すると、なぜペアリングしたものだけになるのか？がわかってない(サービスのUUIDを渡しているGetDeviceSelectorFromUuidが返すAQSが、そういう文字列になっているのかも？=GetDeviceSelectorFromUuidの仕様かも？)(selectorに書いてるGUIDが何か、は\u003ca href=\"https://docs.microsoft.com/ja-jp/windows/uwp/devices-sensors/aep-service-class-ids\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003cstrong\u003eここ\u003c/strong\u003e\u003c/a\u003eに書いてるっぽい)\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ペアリング関連メモ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%9A%E3%82%A2%E3%83%AA%E3%83%B3%E3%82%B0%E9%96%A2%E9%80%A3%E3%83%A1%E3%83%A2\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eペアリング関連メモ\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eペアリングなしでデータとりたい場合の流れ\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eデバイスを探す(watcherでセレクタをprotocolId=BLE全部(bb7bb05e-5972-42b5-94fc-76eaa7084d49にする))\u003c/li\u003e\n\u003cli\u003e指定の名前のデバイス(EnvSensor-BL01)がAddされてきたら、そのデバイス情報を保存\u003c/li\u003e\n\u003cli\u003eBluetoothLEDeviceを取得\u003c/li\u003e\n\u003cli\u003e使いたいサービスを取得\u003c/li\u003e\n\u003cli\u003e使いたいキャラクタリスティックを取得\u003c/li\u003e\n\u003cli\u003eキャラクタリスティックのディスクリプタを設定(Notify)\u003c/li\u003e\n\u003cli\u003eキャラクタリスティック変化時のハンドラを登録\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eペアリングもアプリ内でやりたい場合の流れ\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eデバイスを探す(watcherでセレクタをprotocolId=BLE全部(bb7bb05e-5972-42b5-94fc-76eaa7084d49にする))\u003c/li\u003e\n\u003cli\u003e指定の名前のデバイス(EnvSensor-BL01)がAddされてきたら、そのデバイス情報を保存\u003c/li\u003e\n\u003cli\u003eデバイス情報を使ってペアリングする\u003c/li\u003e\n\u003cli\u003eBluetoothLEDeviceを取得\u003c/li\u003e\n\u003cli\u003e使いたいサービスを取得\u003c/li\u003e\n\u003cli\u003e使いたいキャラクタリスティックを取得\u003c/li\u003e\n\u003cli\u003eキャラクタリスティックのディスクリプタを設定(Notify)\u003c/li\u003e\n\u003cli\u003eキャラクタリスティック変化時のハンドラを登録\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"おすすめ仕様メモ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%8A%E3%81%99%E3%81%99%E3%82%81%E4%BB%95%E6%A7%98%E3%83%A1%E3%83%A2\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eおすすめ仕様メモ\u003c/h2\u003e\n\n\u003cp\u003eできれば、BLEで何かつくるときは、\u003cbr\u003e\n「アプリを使う前に温度センサをペアリングしておいて、その機器とだけ通信する」仕様にしたい。\u003cbr\u003e\nでないと、近所に同じセンサが複数あった時に、アプリ上でその機器をListにして、どれを使うか選択してもらわないといけないようなややこしい仕様になりそう。\u003cbr\u003e\n(何でもアプリでやらず、Windowsの機能でやれるところ(使う機器の選択=ペアリング)はやってしまいたい)\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"selectorについてメモ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#selector%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E3%83%A1%E3%83%A2\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eselectorについてメモ\u003c/h2\u003e\n\n\u003cp\u003e・CreateWatcherで使う「selector」は、何をあらわしている？？\u003cbr\u003e\n→\u003ca href=\"https://docs.microsoft.com/ja-jp/windows/uwp/devices-sensors/aep-service-class-ids%E3%81%AB%E6%9B%B8%E3%81%84%E3%81%A6%E3%82%8B%E3%80%82\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://docs.microsoft.com/ja-jp/windows/uwp/devices-sensors/aep-service-class-idsに書いてる。\u003c/a\u003e\u003cbr\u003e\nこのIDで、何を相手にするかを絞ってやることで、電池の寿命が延びたりする。\u003cbr\u003e\nプロトコルIDを指定してCreateWatcherすることで、そのプロトコルを持つ機器をwatchできる。\u003cbr\u003e\n下記に、セレクタの例がある。この例のようにセレクタを書けば、ウォッチするデバイスを絞れそう。\u003cbr\u003e\n\u003ca href=\"https://docs.microsoft.com/en-gb/windows/uwp/devices-sensors/build-a-device-selector#aqs-string-examples\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://docs.microsoft.com/en-gb/windows/uwp/devices-sensors/build-a-device-selector#aqs-string-examples\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://docs.microsoft.com/ja-jp/windows/uwp/devices-sensors/enumerate-devices-over-a-network\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://docs.microsoft.com/ja-jp/windows/uwp/devices-sensors/enumerate-devices-over-a-network\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"windows-iot-coreラズパイ3について\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#windows-iot-core%E3%83%A9%E3%82%BA%E3%83%91%E3%82%A43%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eWindows Iot Core(ラズパイ3)について\u003c/h1\u003e\n\n\u003cp\u003eWPFで実験用に作ったものを、ほぼ同じコードでUWPにして、PCのWindows10上で動かすと、うまく動作した。\u003cbr\u003e\nただ、ラズパイ3のWindows IOT core上で動かすと、うまく動かなかった。\u003cbr\u003e\n具体的には、デバイス、サービス、キャラクタリスティックを取得するまではうまく動くが、Notifyをセットするところでほぼ毎回失敗し「Unreachable」になる。(「ほぼ」というのは、何度もやっていると、たまーにNotifyのsetが成功して、成功後は値をうまく取れ続ける、ということ。原因はわからなかった)\u003cbr\u003e\n\u003cstrong\u003eWin Iot coreまたはラズパイ3ではいまのところそんなもん\u003c/strong\u003eとして、今回はあきらめた。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"コード一式\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B3%E3%83%BC%E3%83%89%E4%B8%80%E5%BC%8F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eコード一式\u003c/h1\u003e\n\n\u003cp\u003e\u003cqiita-embed-ogp src=\"https://github.com/tera1707/BleSample\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"参考\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8F%82%E8%80%83\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e参考\u003c/h1\u003e\n\n\u003cp\u003e■GATT公式\u003cbr\u003e\n公式ページトップ\u003cbr\u003e\n\u003ca href=\"https://www.bluetooth.com/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://www.bluetooth.com/\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e公式プロファイルとサービス一覧\u003cbr\u003e\n\u003ca href=\"https://www.bluetooth.com/specifications/gatt/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://www.bluetooth.com/specifications/gatt/\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e公式サービスとUUID一覧\u003cbr\u003e\n\u003ca href=\"https://www.bluetooth.com/specifications/gatt/services/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://www.bluetooth.com/specifications/gatt/services/\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e公式キャラクタリスティックとUUID一覧\u003cbr\u003e\n\u003ca href=\"https://www.bluetooth.com/specifications/gatt/characteristics/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://www.bluetooth.com/specifications/gatt/characteristics/\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e公式UUID\u003cbr\u003e\n\u003ca href=\"https://www.bluetooth.com/specifications/assigned-numbers/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://www.bluetooth.com/specifications/assigned-numbers/\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e■実験につかうオムロンBL01の仕様\u003cbr\u003e\nBAG型\u003cbr\u003e\n\u003ca href=\"https://www.omron.co.jp/ecb/product-detail?partId=73062\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://www.omron.co.jp/ecb/product-detail?partId=73062\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://omronfs.omron.com/ja_JP/ecb/products/pdf/CDSC-015.pdf\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://omronfs.omron.com/ja_JP/ecb/products/pdf/CDSC-015.pdf\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eUSB型\u003cbr\u003e\n\u003ca href=\"https://www.omron.co.jp/ecb/product-detail?partId=73063\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://www.omron.co.jp/ecb/product-detail?partId=73063\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e■MSページ\u003cbr\u003e\nCreateWatcherで使うProtocolIdの一覧\u003cbr\u003e\n\u003ca href=\"https://docs.microsoft.com/ja-jp/windows/uwp/devices-sensors/aep-service-class-ids\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://docs.microsoft.com/ja-jp/windows/uwp/devices-sensors/aep-service-class-ids\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eAQS(ウォッチャーのselector)の書き方\u003cbr\u003e\n\u003ca href=\"https://docs.microsoft.com/ja-jp/windows/uwp/devices-sensors/enumerate-devices-over-a-network\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://docs.microsoft.com/ja-jp/windows/uwp/devices-sensors/enumerate-devices-over-a-network\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e■MSサンプル\u003cbr\u003e\nサービス/キャラクタリスティック接続と取得/設定\u003cbr\u003e\n\u003ca href=\"https://github.com/microsoft/Windows-universal-samples/tree/master/Samples/BluetoothLE/cs\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/microsoft/Windows-universal-samples/tree/master/Samples/BluetoothLE/cs\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eデバイス検索とペアリング\u003cbr\u003e\n\u003ca href=\"https://github.com/microsoft/Windows-universal-samples/tree/master/Samples/DeviceEnumerationAndPairing/cs\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/microsoft/Windows-universal-samples/tree/master/Samples/DeviceEnumerationAndPairing/cs\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e■非公式解説ページ\u003cbr\u003e\n以下のページを見れば、だいたいBLEがどういう構造なのかわかる。\u003cbr\u003e\n下記のページで勉強させていただきました。ありがとうございます。\u003cbr\u003e\nどのページも、むちゃくちゃわかりやすいです。\u003c/p\u003e\n\n\u003cp\u003eBLEの説明\u003cbr\u003e\n\u003ca href=\"http://jellyware.jp/kurage/bluejelly/ble_guide.html\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://jellyware.jp/kurage/bluejelly/ble_guide.html\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eUUIDとは？\u003cbr\u003e\n\u003ca href=\"http://jellyware.jp/kurage/bluejelly/uuid.html\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://jellyware.jp/kurage/bluejelly/uuid.html\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eBLE v4とは\u003cbr\u003e\n\u003ca href=\"https://micro.rohm.com/jp/techweb_iot/knowledge/iot02/s-iot02/01-s-iot02/39\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://micro.rohm.com/jp/techweb_iot/knowledge/iot02/s-iot02/01-s-iot02/39\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eGattの構造\u003cbr\u003e\n\u003ca href=\"https://micro.rohm.com/jp/techweb_iot/knowledge/iot02/s-iot02/04-s-iot02/3792\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://micro.rohm.com/jp/techweb_iot/knowledge/iot02/s-iot02/04-s-iot02/3792\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eNotifyとIndicateの違い\u003cbr\u003e\n\u003ca href=\"http://yegang.hatenablog.com/entry/2014/08/09/195246\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://yegang.hatenablog.com/entry/2014/08/09/195246\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eBLEの通信の手順(というか流れ)\u003cbr\u003e\n\u003ca href=\"http://www.microtechnica.tv/support/manual/clickble_man.pdf\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://www.microtechnica.tv/support/manual/clickble_man.pdf\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eアドバタイズパケットについて\u003cbr\u003e\n\u003ca href=\"https://qiita.com/gebo/items/2e51bebd3d26a3025d9f\" class=\"autolink\" id=\"reference-80dab16fe4f86101b11a\"\u003ehttps://qiita.com/gebo/items/2e51bebd3d26a3025d9f\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eアドバタイズパケットでデータをとる\u003cbr\u003e\n\u003ca href=\"https://qiita.com/komde/items/7209b36159da69ae79d2\" class=\"autolink\" id=\"reference-8f5951a888a4b865b6a5\"\u003ehttps://qiita.com/komde/items/7209b36159da69ae79d2\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e.net4.7.0のときのAPIは、ペアリングしたBLE機器でないとServiceをとってこれないっぽい\u003cbr\u003e\n\u003ca href=\"https://codeday.me/jp/qa/20190629/1132145.html\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://codeday.me/jp/qa/20190629/1132145.html\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eMSブログの実装の説明\u003cbr\u003e\n\u003ca href=\"https://blogs.msdn.microsoft.com/shozoa/2016/02/28/windows-10-bluetooth/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://blogs.msdn.microsoft.com/shozoa/2016/02/28/windows-10-bluetooth/\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eWindowsのバージョンによって、ペアリングがいるとかいらないとか(15030以降は要らないとか)\u003cbr\u003e\n\u003ca href=\"https://docs.microsoft.com/ja-jp/windows/uwp/devices-sensors/bluetooth-dev-faq\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://docs.microsoft.com/ja-jp/windows/uwp/devices-sensors/bluetooth-dev-faq\u003c/a\u003e\u003c/p\u003e\n","createdAt":"2019-08-16T00:07:57Z","elapsedYearsFromLastModifiedAt":1,"encryptedId":"pHO0G+1CesktB4afn1YLB1LbRo0wOu/GAg==--Vg9LaGsNN/WKQj7c--CSbMuLelw6CVMURhbuv1zA==","isBanned":false,"isDeprecated":true,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2019-12-04T12:52:00Z","likesCount":15,"linkUrl":"https://qiita.com/tera1707/items/5505ed22b5ddf93795f4","organization":null,"originalId":1000130,"stockedCount":20,"title":"[C#/WinRT]Bluetooth v4(BLE)機器と通信する（C#で実装メモ）","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#ble%E9%96%A2%E9%80%A3%E8%A8%98%E4%BA%8B\"\u003eBLE関連記事\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%84%E3%82%8A%E3%81%9F%E3%81%84%E3%81%93%E3%81%A8\"\u003eやりたいこと\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%89%8D%E6%8F%90\"\u003e前提\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B%E3%82%82%E3%81%AE\"\u003e作成するもの\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E9%80%9A%E4%BF%A1%E3%81%AE%E6%B5%81%E3%82%8C%E6%A6%82%E8%A6%81\"\u003e通信の流れ概要\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E9%80%9A%E4%BF%A1%E3%81%AE%E6%B5%81%E3%82%8C\"\u003e通信の流れ\u003c/a\u003e\n\u003cul\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%BA%8B%E5%89%8D%E6%BA%96%E5%82%99\"\u003e事前準備\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0%E3%81%AB%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B%E5%87%A6%E7%90%86\"\u003eプログラムに実装する処理\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cli\u003e\n\u003ca href=\"#%E5%85%B1%E9%80%9A%E5%87%A6%E7%90%86-%E3%81%AE%E5%AE%9F%E8%A3%85\"\u003e共通処理 の実装\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%92%B0%E5%A2%83%E3%82%BB%E3%83%B3%E3%82%B5%E3%82%92%E6%8E%A2%E3%81%99\"\u003e環境センサを探す\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E8%A6%8B%E3%81%A4%E3%81%8B%E3%81%A3%E3%81%9F%E7%92%B0%E5%A2%83%E3%82%BB%E3%83%B3%E3%82%B5%E3%81%AE%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E6%83%85%E5%A0%B1%E3%82%92%E4%BF%9D%E5%AD%98\"\u003e見つかった環境センサのデバイス情報を保存\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E6%83%85%E5%A0%B1%E3%81%8B%E3%82%89bluetoothledevice%E3%82%92%E5%8F%96%E5%BE%97\"\u003eデバイス情報からBluetoothLEDeviceを取得\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%B8%A9%E5%BA%A6%E3%83%87%E3%83%BC%E3%82%BF%E5%A4%89%E5%8C%96%E6%99%82%E3%81%AB%E5%8F%97%E3%81%91%E5%8F%96%E3%82%8B%E6%A9%9F%E8%83%BD%E5%A5%BD%E3%81%8D%E3%81%AA%E3%81%A8%E3%81%8D%E3%81%AB%E5%8F%96%E5%BE%97%E3%81%99%E3%82%8B%E6%A9%9F%E8%83%BD-%E3%81%AE%E5%AE%9F%E8%A3%85\"\u003e温度データ変化時に受け取る機能/好きなときに取得する機能 の実装\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#bluetoothledevice%E3%81%8B%E3%82%89%E6%B8%A9%E5%BA%A6%E5%8F%96%E5%BE%97%E3%81%AB%E4%BD%BF%E3%81%84%E3%81%9F%E3%81%84%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%82%92%E5%8F%96%E5%BE%97\"\u003eBluetoothLEDeviceから温度取得に使いたいサービスを取得\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%81%8B%E3%82%89%E6%B8%A9%E5%BA%A6%E5%8F%96%E5%BE%97%E3%81%AB%E4%BD%BF%E3%81%84%E3%81%9F%E3%81%84%E3%82%AD%E3%83%A3%E3%83%A9%E3%82%AF%E3%82%BF%E3%83%AA%E3%82%B9%E3%83%86%E3%82%A3%E3%83%83%E3%82%AF%E3%82%92%E5%8F%96%E5%BE%97\"\u003eサービスから温度取得に使いたいキャラクタリスティックを取得\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%AD%E3%83%A3%E3%83%A9%E3%82%AF%E3%82%BF%E3%83%AA%E3%82%B9%E3%83%86%E3%82%A3%E3%83%83%E3%82%AF%E3%81%AE%E3%83%87%E3%82%A3%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%82%BF%E3%82%92%E8%A8%AD%E5%AE%9Anotify\"\u003eキャラクタリスティックのディスクリプタを設定(Notify)\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%AD%E3%83%A3%E3%83%A9%E3%82%AF%E3%82%BF%E3%83%AA%E3%82%B9%E3%83%86%E3%82%A3%E3%83%83%E3%82%AF%E5%A4%89%E5%8C%96%E6%99%82%E3%81%AE%E3%83%8F%E3%83%B3%E3%83%89%E3%83%A9%E3%82%92%E7%99%BB%E9%8C%B2\"\u003eキャラクタリスティック変化時のハンドラを登録\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%B8%A9%E5%BA%A6%E5%8F%96%E5%BE%97%E3%81%AB%E4%BD%BF%E3%81%84%E3%81%9F%E3%81%84%E3%82%AD%E3%83%A3%E3%83%A9%E3%82%AF%E3%82%BF%E3%83%AA%E3%82%B9%E3%83%86%E3%82%A3%E3%83%83%E3%82%AF%E3%81%AB%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%81%BF%E8%A6%81%E6%B1%82%E5%AE%9F%E6%96%BD\"\u003e温度取得に使いたいキャラクタリスティックに読み込み要求実施\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%B8%AC%E5%AE%9A%E9%96%93%E9%9A%94%E3%82%92%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B%E6%A9%9F%E8%83%BD-%E3%81%AE%E5%AE%9F%E8%A3%85\"\u003e測定間隔を設定する機能 の実装\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#bluetoothledevice%E3%81%8B%E3%82%89%E6%B8%AC%E5%AE%9A%E9%96%93%E9%9A%94%E8%A8%AD%E5%AE%9A%E3%81%AB%E4%BD%BF%E3%81%84%E3%81%9F%E3%81%84%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%82%92%E5%8F%96%E5%BE%97\"\u003eBluetoothLEDeviceから測定間隔設定に使いたいサービスを取得\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%81%8B%E3%82%89%E6%B8%AC%E5%AE%9A%E9%96%93%E9%9A%94%E8%A8%AD%E5%AE%9A%E3%81%AB%E4%BD%BF%E3%81%84%E3%81%9F%E3%81%84%E3%82%AD%E3%83%A3%E3%83%A9%E3%82%AF%E3%82%BF%E3%83%AA%E3%82%B9%E3%83%86%E3%82%A3%E3%83%83%E3%82%AF%E3%82%92%E5%8F%96%E5%BE%97\"\u003eサービスから測定間隔設定に使いたいキャラクタリスティックを取得\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%B8%AC%E5%AE%9A%E9%96%93%E9%9A%94%E8%A8%AD%E5%AE%9A%E3%81%AB%E4%BD%BF%E3%81%84%E3%81%9F%E3%81%84%E3%82%AD%E3%83%A3%E3%83%A9%E3%82%AF%E3%82%BF%E3%83%AA%E3%82%B9%E3%83%86%E3%82%A3%E3%83%83%E3%82%AF%E3%81%AB%E6%9B%B8%E3%81%8D%E8%BE%BC%E3%81%BF%E8%A6%81%E6%B1%82%E5%AE%9F%E6%96%BD\"\u003e測定間隔設定に使いたいキャラクタリスティックに書き込み要求実施\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%BB%A5%E4%B8%8A\"\u003e以上\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%BB%A5%E4%B8%8B%E3%83%A1%E3%83%A2%E6%9B%B8%E3%81%8D\"\u003e以下、メモ書き。\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%B8%8D%E6%98%8E%E7%82%B9%E3%83%A1%E3%83%A2\"\u003e不明点メモ\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%9A%E3%82%A2%E3%83%AA%E3%83%B3%E3%82%B0%E9%96%A2%E9%80%A3%E3%83%A1%E3%83%A2\"\u003eペアリング関連メモ\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%8A%E3%81%99%E3%81%99%E3%82%81%E4%BB%95%E6%A7%98%E3%83%A1%E3%83%A2\"\u003eおすすめ仕様メモ\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#selector%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E3%83%A1%E3%83%A2\"\u003eselectorについてメモ\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#windows-iot-core%E3%83%A9%E3%82%BA%E3%83%91%E3%82%A43%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\"\u003eWindows Iot Core(ラズパイ3)について\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B3%E3%83%BC%E3%83%89%E4%B8%80%E5%BC%8F\"\u003eコード一式\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%8F%82%E8%80%83\"\u003e参考\u003c/a\u003e\n\u003c/li\u003e\n\n","totalPv":18971,"uuid":"5505ed22b5ddf93795f4","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"x+WmdorWwkqFHCB9mE8l1lfTMo/n--ITq2/SZsxmeW7AQN--fU3aj0BP5PuCZI9S6VTx3g==","originalId":352601,"description":"","facebookUrl":null,"githubUrl":"https://github.com/tera1707","isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"","profileImageUrl":"https://avatars0.githubusercontent.com/u/19180456?v=4","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Favatars0.githubusercontent.com%2Fu%2F19180456%3Fv%3D4?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=d374ef2a13106c43b12251ae9f724ca0","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Favatars0.githubusercontent.com%2Fu%2F19180456%3Fv%3D4?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=1ddd4d18cb0c4d9ee77ed7cff93f4ae1","urlName":"tera1707","websiteUrl":"","twitterUrl":null,"twitterUrlName":null,"revealedOrganizations":{"edges":[]}},"tags":[{"name":"C#","urlName":"csharp"},{"name":"WinRT","urlName":"winrt"},{"name":"bluetooth","urlName":"bluetooth"},{"name":"BLE","urlName":"ble"}],"followingLikers":{"edges":[]},"comments":{"totalCount":0}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

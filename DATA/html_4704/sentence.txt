More than 3 years have passed since last update.UnityでのBGM、SE再生ロジックを組んでいて、以下のような欲求を抱いたことはありませんか？まあようするに使いやすいAudioPlayerほしいよねみたいな気持ちです。僕は以上のような気持ちを常に抱いています。以上の要件を満たす実装とはすなわち、のようになりますね。ではこれらを実現していきましょう。まずAudioFileのEnumを定義しましょう。次に、このEnumからAudioClipを取得する拡張メソッドを生やします。冒頭で fileName のようなファイル名を保持する変数を作り、switch文を使って各caseで fileName にファイル名を代入します。
そして、その fileName を使い、最終的に AudioClipLoader を介して音声ファイルを取得させるような実装にします。最終的なコードは以下のようになります。続いて、AudioClipをResourcesからキャッシュさせつつ読み込むクラスを実装します。一度読み込んだファイルは、path名: AudioClipのようなDictionaryにキャッシュさせるような実装にします。
また、全ファイルをプリフェッチしておいたり、キャッシュを破棄するような関数もあると良いですね。コードは以下のようになります。最後に、AudioPlayerクラスを実装します。こちらのAudioPlayerは、複数のAudioSourceを所持します。
それぞれ、BGM再生用のもの、SE再生用のもの、となっています。
また、SE再生用のものは、SEの多重再生が行われることを予想して、一つだけではなく複数のAudioSourceを作成しておきます。また、再生関数の引数には先程作成したSoundFileを取るようにします。コードは以下のようになります。このような実装を行うことで、タイトルで掲げた効率的 &amp; 安全 &amp; 使いやすいAudioPlayerを実装することができました。
このようなファイル名などに補完が効くというのはすごく大きいです。AnimatorのParameterやScene名などstringで扱われるものについてはミスを無くすため、できるだけEnumやclassなどで管理することをおすすめします。
合わせて、Resourcesが絡むようなものは上記のような実装を同じく行うと良いのではないでしょうか。それでは良いUnityライフを。



<!DOCTYPE html><html><head><meta charset="utf-8" /><title>【Unity, C#】internalな型やメンバにアクセスするには、多分これが一番早いと思います - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/mob-sakai/items/f3bbc0c45abc31ea7ac0" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="HQ2P8wds0c3pNm6C18dyIa4LBsqbShLkfzPlKFe1YbyjGH8gwX+JvYrqJ3ygI3bX/tHBPA+keMuULsxCsTrf2Q==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta property="og:type" content="article"><meta property="og:title" content="【Unity, C#】internalな型やメンバにアクセスするには、多分これが一番早いと思います - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND00NENRVlc1cGRIa3NJRU1qNDRDUmFXNTBaWEp1WVd6amdhcmxub3ZqZ29Uamc2SGpnN1BqZzVEamdhdmpncUxqZ3Ffamdydmpncm5qZ1puamdvdmpnYXZqZ2FfamdJSGxwSnJsaUliamdaUGpnb3pqZ1l6a3VJRG5sYXJtbDZuamdZVGpnYWptZ0ozamdZVGpnYjdqZ1prJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NTQmdHh0LWNsaXA9ZWxsaXBzaXMmdHh0LWFsaWduPWNlbnRlciUyQ21pZGRsZSZzPWM0MjBjOGNhNTIyMjk4MGI1Y2FkZDE4MWViOGQyZGRi&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RRzF2WWkxellXdGhhUSZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTQ1JnR4dC1hbGlnbj1yaWdodCUyQ2JvdHRvbSZzPWVlZDdiMzJkOThlZWY4MzNlZWNiNDM4OWNjYWM2ODU5&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=9aac5e9007aff8170a29117253f1e27b"><meta property="og:description" content="この記事は【unityプロ技】 Advent Calendar 2019の13日目の記事です。
この記事におけるソースコードは、全てPublic Domainです。

※12/13 15:00 訂正あり
※12/26 続編でました

..."><meta content="https://qiita.com/mob-sakai/items/f3bbc0c45abc31ea7ac0" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#,Unity,internal" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 1nzh4zz 38fzdi helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-1nzh4zz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:16px 32px;background-color:#FBE69E;color:rgba(0,0,0,0.87);line-height:1.5;font-weight:600;}@media (max-width:770px){.css-1nzh4zz{padding:16px;}}.css-38fzdi{color:#CA832A;margin-right:4px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-f71a2bbf-1a89-4637-9166-9906f31552b7"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Fmob-sakai%2Fitems%2Ff3bbc0c45abc31ea7ac0">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Fmob-sakai%2Fitems%2Ff3bbc0c45abc31ea7ac0">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-f71a2bbf-1a89-4637-9166-9906f31552b7">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2019-12-13T02:31:27.000+09:00","dateModified":"2019-12-26T15:27:04.000+09:00","headline":"【Unity, C#】internalな型やメンバにアクセスするには、多分これが一番早いと思います","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND00NENRVlc1cGRIa3NJRU1qNDRDUmFXNTBaWEp1WVd6amdhcmxub3ZqZ29Uamc2SGpnN1BqZzVEamdhdmpncUxqZ3Ffamdydmpncm5qZ1puamdvdmpnYXZqZ2FfamdJSGxwSnJsaUliamdaUGpnb3pqZ1l6a3VJRG5sYXJtbDZuamdZVGpnYWptZ0ozamdZVGpnYjdqZ1prJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NTQmdHh0LWNsaXA9ZWxsaXBzaXMmdHh0LWFsaWduPWNlbnRlciUyQ21pZGRsZSZzPWM0MjBjOGNhNTIyMjk4MGI1Y2FkZDE4MWViOGQyZGRi\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RRzF2WWkxellXdGhhUSZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTQ1JnR4dC1hbGlnbj1yaWdodCUyQ2JvdHRvbSZzPWVlZDdiMzJkOThlZWY4MzNlZWNiNDM4OWNjYWM2ODU5\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=9aac5e9007aff8170a29117253f1e27b","mainEntityOfPage":"https://qiita.com/mob-sakai/items/f3bbc0c45abc31ea7ac0","author":{"@type":"Person","address":null,"email":null,"identifier":"mob-sakai","name":"mob-sakai","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Favatars.githubusercontent.com%2Fu%2F12690315%3Fv%3D3?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=157030055d562d2dae611d3a9828b0cf","url":"https://qiita.com/mob-sakai","description":null,"memberOf":[]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://increments.connpass.com/event/211948/">【9/9(木)開催】Qiitaの過去と未来についてお話しします！Qiita エンジニアフェスタ 2021 Online Meetup</a><a target="_blank" id="header_text_message_2" href="https://increments.connpass.com/event/211948/">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"mob-sakai","type":"items","id":"f3bbc0c45abc31ea7ac0"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"【9/9(木)開催】Qiitaの過去と未来についてお話しします！Qiita エンジニアフェスタ 2021 Online Meetup","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"mob-sakai","type":"items","id":"f3bbc0c45abc31ea7ac0"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":2,"pos_id":"header_text_message_1","message":"【9/9(木)開催】Qiitaの過去と未来についてお話しします！Qiita エンジニアフェスタ 2021 Online Meetup","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"mob-sakai","type":"items","id":"f3bbc0c45abc31ea7ac0"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":2,"pos_id":"header_text_message_2","message":"【9/9(木)開催】Qiitaの過去と未来についてお話しします！Qiita エンジニアフェスタ 2021 Online Meetup","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/mob-sakai/items/f3bbc0c45abc31ea7ac0","location":"/mob-sakai/items/f3bbc0c45abc31ea7ac0","scheme":"https","host":"qiita.com","port":null,"pathname":"/mob-sakai/items/f3bbc0c45abc31ea7ac0","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"BOXUqTXyr//BK9j3847DG3BMyVqWnN0PmU+qLZG44MC68CR68+H3j6L3kQmEasftIJYOrAJytyByUoNHdzdepQ==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-6f59339c-06b4-4144-8a9f-34cabe026681"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/mob-sakai/items/f3bbc0c45abc31ea7ac0/likers" class="css-1iupg5d">96</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">64</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/f3bbc0c45abc31ea7ac0/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/mob-sakai/items/f3bbc0c45abc31ea7ac0/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/mob-sakai/items/f3bbc0c45abc31ea7ac0/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/mob-sakai/items/f3bbc0c45abc31ea7ac0/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/mob-sakai/items/f3bbc0c45abc31ea7ac0.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-1nzh4zz"><span class="fa fa-fw fa-warning css-38fzdi"></span><p>More than 1 year has passed since last update.</p></div><div class="css-helsa7"><div class="css-8qb8m4"><div class="it-AdcalRibbon"><span><a href="/advent-calendar/2019/unityforpro" class="it-AdcalRibbon_title">【unityプロ技】<!-- --> Advent Calendar<!-- --> <!-- -->2019</a>Day 13</span></div><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/mob-sakai"><img class="css-100alwu eyfquo10" src="https://avatars.githubusercontent.com/u/12690315?v=3" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/mob-sakai" class="css-10ougpm">@<!-- -->mob-sakai</a><div class="css-1ay9vb9"><span><meta content="2019-12-12T17:31:27Z"/><time dateTime="2019-12-26T06:27:04Z" class="css-m19uds">updated at 2019-12-26</time></span></div></div></div></div></div><h1 class="css-cgzq40">【Unity, C#】internalな型やメンバにアクセスするには、多分これが一番早いと思います</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/unity" class="css-4czcte">Unity</a><a href="/tags/internal" class="css-4czcte">internal</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div><p>この記事は<a href="https://qiita.com/advent-calendar/2019/unityforpro">【unityプロ技】 Advent Calendar 2019</a>の13日目の記事です。<br>
この記事におけるソースコードは、全て<code>Public Domain</code>です。</p>

<p>※<a href="#1213-1500%E8%A8%82%E6%AD%A3">12/13 15:00 訂正あり</a><br>
※<a href="https://qiita.com/mob-sakai/items/a24780d68a6133be338f" id="reference-6efe72efe9548bedd1b4">12/26 続編でました</a></p>

<h2>
<span id="tldr" class="fragment"></span><a href="#tldr"><i class="fa fa-link"></i></a>TL;DR</h2>

<ul>
<li>C#には<code>IgnoresAccessChecksToAttribute</code>っていう隠された属性があるよ。ググってもほとんど情報出てこないよ。</li>
<li>この属性を使えば、<strong>任意の外部アセンブリのinternalの型やメンバに対して自由にアクセスできる</strong>よ。ヤバいよ。</li>
<li>
<code>InternalsVisibleToAttribute</code>や<code>AssemblyDefinitionFile</code>と組み合わせることで、<strong>インテリセンスやブレークポイントも効く</strong>よ。リフレクションより格段に便利だよ。</li>
</ul>

<h2>
<span id="おさらいinternalアクセス修飾子" class="fragment"></span><a href="#%E3%81%8A%E3%81%95%E3%82%89%E3%81%84internal%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E4%BF%AE%E9%A3%BE%E5%AD%90"><i class="fa fa-link"></i></a>おさらい：internalアクセス修飾子</h2>

<p>C#には<a href="https://docs.microsoft.com/ja-jp/dotnet/csharp/programming-guide/classes-and-structs/access-modifiers" rel="nofollow noopener" target="_blank">アクセス修飾子</a>と呼ばれる、型やメンバのアクセスを制限する仕組みがあります。<br>
例えばクラスAからクラスBのprivateメソッドを呼ぼうとすると、コンパイルの時点で怒られますし、VisualStudioやVisualStudio Code、Rider等といったIDEのインテリセンスには、候補すら出てきません。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>error CS0122: 'ApplicationTitleDescriptor' is inaccessible due to its protection level
error CS0117: 'EditorApplication' does not contain a definition for 'UpdateMainWindowTitle'
...
</code></pre></div></div>

<p>今回取り上げる<code>internal</code>アクセスレベルは<a href="https://docs.microsoft.com/ja-jp/dotnet/csharp/language-reference/keywords/internal" rel="nofollow noopener" target="_blank">同一アセンブリ（=同じdll）内からのみアクセスできる</a>アクセスレベルです。<br>
このアクセスレベルを持つ型やメンバは、異なるアセンブリ（=別のdll）からは<em>基本的には</em>アクセスできません。</p>

<h2>
<span id="internalな型やメンバにアクセスするモチベーション" class="fragment"></span><a href="#internal%E3%81%AA%E5%9E%8B%E3%82%84%E3%83%A1%E3%83%B3%E3%83%90%E3%81%AB%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%81%99%E3%82%8B%E3%83%A2%E3%83%81%E3%83%99%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3"><i class="fa fa-link"></i></a>internalな型やメンバにアクセスするモチベーション</h2>

<blockquote>
<p><em>internalな型やメンバにアクセスする必要があるの？<br>
公開されている(publicな)APIだけで十分では？<br>
苦労してinternalな型やメンバにアクセスして、何がうれしいの？</em></p>
</blockquote>

<p>internalな型やメンバは、<strong>ライブラリ製作者がライブラリ利用者に対して隠蔽したい項目であり、APIやドキュメントは一般的に非公開</strong>です。<br>
例えば、Unityに何らかのエディタ拡張を加えたい場合は、以下のような<a href="https://docs.unity3d.com/ScriptReference/index.html" rel="nofollow noopener" target="_blank">Unityが公開しているAPI(publicなAPI)</a>の利用が基本です。</p>

<ul>
<li>メニューの実行：<a href="https://docs.unity3d.com/ScriptReference/EditorApplication.ExecuteMenuItem.html" rel="nofollow noopener" target="_blank">EditorApplication.ExecuteMenuItem</a>
</li>
<li>アセットインポートの事前/事後処理：<a href="https://docs.unity3d.com/ScriptReference/AssetPostprocessor.html" rel="nofollow noopener" target="_blank">AssetPostprocessor</a>
</li>
<li>インスペクタや自前ウィンドウの実装：<a href="https://docs.unity3d.com/ScriptReference/EditorWindow.html" rel="nofollow noopener" target="_blank">EditorWindow</a>
</li>
<li>次のフレームでアクションを実行する：<a href="https://docs.unity3d.com/ScriptReference/EditorApplication-delayCall.html" rel="nofollow noopener" target="_blank">EditorApplication.delayCall</a>
</li>
<li>ツールバーにメニューを追加する：<a href="https://docs.unity3d.com/ScriptReference/MenuItem.html" rel="nofollow noopener" target="_blank">MenuItem</a>
</li>
<li>コンテキストメニューを追加する：<a href="https://docs.unity3d.com/ScriptReference/ContextMenu.html" rel="nofollow noopener" target="_blank">ContextMenu</a>
</li>
<li>コンパイル後にスクリプトを実行する：<a href="https://docs.unity3d.com/ScriptReference/Callbacks.DidReloadScripts.html" rel="nofollow noopener" target="_blank">Callbacks.DidReloadScripts</a>
</li>
<li>パッケージマネージャUIの拡張：<a href="https://docs.unity3d.com/ScriptReference/PackageManager.UI.IPackageManagerExtension.html" rel="nofollow noopener" target="_blank">PackageManager.UI.IPackageManagerExtension</a>
</li>
<li>etc.</li>
</ul>

<p>御存知の通り、公開されているAPIだけでも<em>「出来ないことなんて何も無いんじゃないの？」</em>と思えるほど大量の項目が見つかります。<br>
しかし、公開されていない（=非publicな）APIに目を向けると、<strong>さらに多くの事が実現可能なことに気づきます</strong>。</p>

<p>例えば、<a href="http://baba-s.hatenablog.com/entry/2019/11/26/170000" rel="nofollow noopener" target="_blank">【Unity】UIElements で Game ビューにテキストやボタンを追加するエディタ拡張のサンプル</a>(<a href="/baba_s" class="user-mention js-hovercard" title="baba_s" data-hovercard-target-type="user" data-hovercard-target-name="baba_s">@baba_s</a>様)では、リフレクションを利用して、<strong>Unityが公開していない</strong><a href="https://github.com/Unity-Technologies/UnityCsReference/blob/master/Editor/Mono/GameView/GameView.cs" rel="nofollow noopener" target="_blank">GameView</a>クラスへアクセスし、GameビューにオリジナルのGUIを追加しています。</p>

<div class="code-frame" data-lang="cs"><div class="highlight"><pre class="with-code"><code><span class="kt">var</span> <span class="n">assembly</span> <span class="p">=</span> <span class="k">typeof</span><span class="p">(</span> <span class="n">EditorWindow</span> <span class="p">).</span><span class="n">Assembly</span><span class="p">;</span>
<span class="kt">var</span> <span class="n">type</span>     <span class="p">=</span> <span class="n">assembly</span><span class="p">.</span><span class="nf">GetType</span><span class="p">(</span> <span class="s">"UnityEditor.GameView"</span> <span class="p">);</span>
<span class="kt">var</span> <span class="n">gameview</span> <span class="p">=</span> <span class="n">EditorWindow</span><span class="p">.</span><span class="nf">GetWindow</span><span class="p">(</span> <span class="n">type</span> <span class="p">);</span>
<span class="p">...</span>
</code></pre></div></div>

<p>このように、非publicなUnityの世界を知ることは、新しい気づきや便利な拡張機能のヒントになります。<br>
そして、あなたが発見した気づきや便利な拡張機能は、ほかの誰かのヒントになるかもしれません。</p>

<hr>

<p>ただし、大事なことなので二回言いますが、<strong>internalな型やメンバは、ライブラリ製作者がライブラリ利用者に対して隠蔽したい項目であり、APIやドキュメントは一般的に非公開</strong>です。<br>
ググって得られる情報は限定的ですし、無慈悲にもAPIは通告なく変更されます。<br>
IL化や難読化されていることは日常茶飯事で、誤って使えばフリーズする可能性すらあります。<br>
ライブラリのライセンスによっては、明確に逆コンパイルやリバースエンジニアリングが禁止されています。</p>

<p>ありがたいことに、<a href="https://github.com/Unity-Technologies/UnityCsReference" rel="nofollow noopener" target="_blank">Unityは公式でGitHubにソースコードを公開しています</a>。internal要素も探し放題です。太っ腹だね！</p>

<p>さあ、実現したいことをキーワードにソースコードを検索し、<em>それっぽい名前の</em> APIを見つけ、注意深くソースコードを読み、拡張機能の幅を<del>くれぐれも自己責任で</del>広げましょう！</p>

<h2>
<span id="開発環境" class="fragment"></span><a href="#%E9%96%8B%E7%99%BA%E7%92%B0%E5%A2%83"><i class="fa fa-link"></i></a>開発環境</h2>

<p>本記事では以下の環境でデモプロジェクトを開発しました。</p>

<ul>
<li>macOS Mojave 10.14.6</li>
<li>Unity 2019.2.15f1</li>
<li>VisualStudio For Mac 8.3.8</li>
<li>DotNet Core 3.0.100</li>
</ul>

<p>デモプロジェクトは以下のリポジトリで公開しています。<br>
<a href="https://github.com/mob-sakai/MainWindowTitleModifierForUnity" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/mob-sakai/MainWindowTitleModifierForUnity</a></p>

<h2>
<span id="今回のデモでやること" class="fragment"></span><a href="#%E4%BB%8A%E5%9B%9E%E3%81%AE%E3%83%87%E3%83%A2%E3%81%A7%E3%82%84%E3%82%8B%E3%81%93%E3%81%A8"><i class="fa fa-link"></i></a>今回のデモでやること</h2>

<p>今回は、<strong>Unityエディタのタイトルバーのテキストを変更</strong>してみたいと思います。 <br>
タイトルバーに現在のブランチ名やゲームサーバの接続先環境名(sand/stag/prod等)を表示できると素敵ですよね。<br>
<a href="https://camo.qiitausercontent.com/100534b3a967a3e97e52a8bb7693c189ce728fb4/68747470733a2f2f757365722d696d616765732e67697468756275736572636f6e74656e742e636f6d2f31323639303331352f37303631333032302d35306166316438302d316334622d313165612d393261612d3735626166646461336664652e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fuser-images.githubusercontent.com%2F12690315%2F70613020-50af1d80-1c4b-11ea-92aa-75bafdda3fde.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=19ee43f2489383775d61340c54e78d4d" alt="" data-canonical-src="https://user-images.githubusercontent.com/12690315/70613020-50af1d80-1c4b-11ea-92aa-75bafdda3fde.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fuser-images.githubusercontent.com%2F12690315%2F70613020-50af1d80-1c4b-11ea-92aa-75bafdda3fde.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=bdbae9d4d6755e1a695df5ea184455fb 1x" loading="lazy"></a></p>

<p><a href="https://github.com/Unity-Technologies/UnityCsReference/blob/master/Editor/Mono/EditorApplication.cs" rel="nofollow noopener" target="_blank">ソースコード</a>を見たところ、Unity2019.2から追加されたinternalな型とメンバを使えば簡単に実現できそうです。<br>
具体的には、<code>EditorApplication.updateMainWindowTitle</code>イベントに新しいコールバックを追加し、<code>EditorApplication.UpdateMainWindowTitle()</code>を呼び出せば、タイトルバーのテキストを変更できそうです：</p>

<div class="code-frame" data-lang="cs"><div class="highlight"><pre class="with-code"><code><span class="c1">// こんな感じで実装すれば実現できそう</span>
<span class="n">Action</span><span class="p">&lt;</span><span class="n">ApplicationTitleDescriptor</span><span class="p">&gt;</span> <span class="n">cb</span> <span class="p">=</span> <span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">title</span> <span class="p">=</span> <span class="s">"なにかしらのエモいタイトル"</span><span class="p">;</span>
<span class="n">EditorApplication</span><span class="p">.</span><span class="n">updateMainWindowTitle</span> <span class="p">+=</span> <span class="n">cb</span><span class="p">;</span>
<span class="n">EditorApplication</span><span class="p">.</span><span class="nf">UpdateMainWindowTitle</span><span class="p">();</span>
<span class="n">EditorApplication</span><span class="p">.</span><span class="n">updateMainWindowTitle</span> <span class="p">-=</span> <span class="n">cb</span><span class="p">;</span>
</code></pre></div></div>

<p><code>updateMainWindowTitle</code>、<code>UpdateMainWindowTitle</code>、<code>ApplicationTitleDescriptor</code>は全てinternalな型とメンバであり、このままでは当然コンパイルエラーになります。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>error CS0122: 'ApplicationTitleDescriptor' is inaccessible due to its protection level
error CS0117: 'EditorApplication' does not contain a definition for 'UpdateMainWindowTitle'
...
</code></pre></div></div>

<p>なんとかしてアクセスしてみましょう！</p>

<h2>
<span id="方法1reflection" class="fragment"></span><a href="#%E6%96%B9%E6%B3%951reflection"><i class="fa fa-link"></i></a>【方法1】Reflection</h2>

<p>publicでない型やメンバにアクセスするための方法として、まず思いつくのは<a href="https://docs.microsoft.com/ja-jp/dotnet/csharp/programming-guide/concepts/reflection" rel="nofollow noopener" target="_blank">Reflection(リフレクション)</a>です。<br>
リフレクションにより、<strong>文字列を使ってpublicでない型やメンバにも動的にアクセスできます</strong>。</p>

<p>リフレクションの利点は、internalな型やメンバだけでなく、<strong>privateな型やメンバにもアクセスできる</strong>ことです。<br>
また、有名であるが故に<strong>ググれば情報がたくさん</strong>あり、<strong>リフレクションだからこそできる事も多くあります</strong>。<br>
<a href="https://qiita.com/gushwell/items/91436bd1871586f6e663" id="reference-e9232e259b337d129f60">C#リフレクションTIPS 55連発</a>(<a href="/gushwell" class="user-mention js-hovercard" title="gushwell" data-hovercard-target-type="user" data-hovercard-target-name="gushwell">@gushwell</a>様)という一読すべき記事もあります。</p>

<h4>
<span id="リフレクションを使ってinternalアクセスしてみる" class="fragment"></span><a href="#%E3%83%AA%E3%83%95%E3%83%AC%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6internal%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>リフレクションを使ってinternalアクセスしてみる</h4>

<p>実際にやりたいことは4行で済む内容でしたが、リフレクションで表現するとどうなるでしょうか？</p>

<div class="code-frame" data-lang="cs"><div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Linq</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">UnityEditor</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Reflection</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">MainWindowTitleModifier</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">Solution1_Reflection</span>
    <span class="p">{</span>
        <span class="p">[</span><span class="nf">MenuItem</span><span class="p">(</span><span class="s">"MainWindowTitleModifier/Solution1_Reflection"</span><span class="p">,</span> <span class="n">priority</span> <span class="p">=</span> <span class="m">1</span><span class="p">)]</span>
        <span class="k">static</span> <span class="k">void</span> <span class="nf">Update</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="c1">// ApplicationTitleDescriptorのTypeを取得.</span>
            <span class="n">Type</span> <span class="n">tEditorApplication</span> <span class="p">=</span> <span class="k">typeof</span><span class="p">(</span><span class="n">EditorApplication</span><span class="p">);</span>
            <span class="n">Type</span> <span class="n">tApplicationTitleDescriptor</span> <span class="p">=</span> <span class="n">tEditorApplication</span><span class="p">.</span><span class="n">Assembly</span><span class="p">.</span><span class="nf">GetTypes</span><span class="p">()</span>
                <span class="p">.</span><span class="nf">First</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">FullName</span> <span class="p">==</span> <span class="s">"UnityEditor.ApplicationTitleDescriptor"</span><span class="p">);</span>

            <span class="c1">// 関係するイベントとメソッドのInfoを取得.</span>
            <span class="n">EventInfo</span> <span class="n">eiUpdateMainWindowTitle</span> <span class="p">=</span> <span class="n">tEditorApplication</span><span class="p">.</span><span class="nf">GetEvent</span><span class="p">(</span><span class="s">"updateMainWindowTitle"</span><span class="p">,</span> <span class="n">BindingFlags</span><span class="p">.</span><span class="n">Static</span> <span class="p">|</span> <span class="n">BindingFlags</span><span class="p">.</span><span class="n">NonPublic</span><span class="p">);</span>
            <span class="n">MethodInfo</span> <span class="n">miUpdateMainWindowTitle</span> <span class="p">=</span> <span class="n">tEditorApplication</span><span class="p">.</span><span class="nf">GetMethod</span><span class="p">(</span><span class="s">"UpdateMainWindowTitle"</span><span class="p">,</span> <span class="n">BindingFlags</span><span class="p">.</span><span class="n">Static</span> <span class="p">|</span> <span class="n">BindingFlags</span><span class="p">.</span><span class="n">NonPublic</span><span class="p">);</span>

            <span class="c1">// Action&lt;object&gt;をAction&lt;ApplicationTitleDescriptor&gt;に変換.</span>
            <span class="n">Type</span> <span class="n">delegateType</span> <span class="p">=</span> <span class="k">typeof</span><span class="p">(</span><span class="n">Action</span><span class="p">&lt;&gt;).</span><span class="nf">MakeGenericType</span><span class="p">(</span><span class="n">tApplicationTitleDescriptor</span><span class="p">);</span>
            <span class="n">MethodInfo</span> <span class="n">methodInfo</span> <span class="p">=</span> <span class="p">((</span><span class="n">Action</span><span class="p">&lt;</span><span class="kt">object</span><span class="p">&gt;)</span><span class="n">UpdateMainWindowTitle</span><span class="p">).</span><span class="n">Method</span><span class="p">;</span>
            <span class="n">Delegate</span> <span class="n">del</span> <span class="p">=</span> <span class="n">Delegate</span><span class="p">.</span><span class="nf">CreateDelegate</span><span class="p">(</span><span class="n">delegateType</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="n">methodInfo</span><span class="p">);</span>

            <span class="c1">// UpdateMainWindowTitleを呼び出す前後にイベントの追加/削除.</span>
            <span class="n">eiUpdateMainWindowTitle</span><span class="p">.</span><span class="nf">GetAddMethod</span><span class="p">(</span><span class="k">true</span><span class="p">).</span><span class="nf">Invoke</span><span class="p">(</span><span class="k">null</span><span class="p">,</span> <span class="k">new</span> <span class="kt">object</span><span class="p">[]</span> <span class="p">{</span> <span class="n">del</span> <span class="p">});</span>
            <span class="n">miUpdateMainWindowTitle</span><span class="p">.</span><span class="nf">Invoke</span><span class="p">(</span><span class="k">null</span><span class="p">,</span> <span class="k">new</span> <span class="kt">object</span><span class="p">[</span><span class="m">0</span><span class="p">]);</span>
            <span class="n">eiUpdateMainWindowTitle</span><span class="p">.</span><span class="nf">GetRemoveMethod</span><span class="p">(</span><span class="k">true</span><span class="p">).</span><span class="nf">Invoke</span><span class="p">(</span><span class="k">null</span><span class="p">,</span> <span class="k">new</span> <span class="kt">object</span><span class="p">[]</span> <span class="p">{</span> <span class="n">del</span> <span class="p">});</span>
        <span class="p">}</span>

        <span class="k">static</span> <span class="k">void</span> <span class="nf">UpdateMainWindowTitle</span><span class="p">(</span><span class="kt">object</span> <span class="n">desc</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// UnityEditor.ApplicationTitleDescriptor.title = "Solution1_Reflection"; と同様</span>
            <span class="k">typeof</span><span class="p">(</span><span class="n">EditorApplication</span><span class="p">).</span><span class="n">Assembly</span><span class="p">.</span><span class="nf">GetTypes</span><span class="p">()</span>
                <span class="p">.</span><span class="nf">First</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">FullName</span> <span class="p">==</span> <span class="s">"UnityEditor.ApplicationTitleDescriptor"</span><span class="p">)</span>
                <span class="p">.</span><span class="nf">GetField</span><span class="p">(</span><span class="s">"title"</span><span class="p">,</span> <span class="n">BindingFlags</span><span class="p">.</span><span class="n">Instance</span> <span class="p">|</span> <span class="n">BindingFlags</span><span class="p">.</span><span class="n">Public</span><span class="p">)</span>
                <span class="p">.</span><span class="nf">SetValue</span><span class="p">(</span><span class="n">desc</span><span class="p">,</span> <span class="s">"Solution1_Reflection"</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>うーん、つらみ。。。<br>
やりたいことは単純なはずなのに、どうしてこうなった！って感じですね。</p>

<p>ともあれ、<code>MainWindowTitleModifier &gt; Solution1_Reflection</code>を実行すればタイトルバーのテキストを変えられるようになりました。<br>
<a href="https://camo.qiitausercontent.com/da0ff1d4641dc1fc4eed873c4023894972236f1f/68747470733a2f2f757365722d696d616765732e67697468756275736572636f6e74656e742e636f6d2f31323639303331352f37303631353730312d33653833616530302d316335302d313165612d386139622d3636656230346162346363612e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fuser-images.githubusercontent.com%2F12690315%2F70615701-3e83ae00-1c50-11ea-8a9b-66eb04ab4cca.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=4e42b41b3ca585e6e9c59583c875a3a2" alt="" data-canonical-src="https://user-images.githubusercontent.com/12690315/70615701-3e83ae00-1c50-11ea-8a9b-66eb04ab4cca.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fuser-images.githubusercontent.com%2F12690315%2F70615701-3e83ae00-1c50-11ea-8a9b-66eb04ab4cca.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=474f9c594cda0032d5f2919e2e14221b 1x" loading="lazy"></a></p>

<h4>
<span id="リフレクションの欠点" class="fragment"></span><a href="#%E3%83%AA%E3%83%95%E3%83%AC%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E6%AC%A0%E7%82%B9"><i class="fa fa-link"></i></a>リフレクションの欠点</h4>

<p>リフレクションの欠点は<strong>生産性が低いことと、実行速度が遅いこと</strong>です。<br>
やりたいことに対してやるべき準備が多く、IDEによるインテリセンスも効かないため、生産性はお世辞にも良くありません。<br>
<a href="https://postd.cc/why-is-reflection-slow/" rel="nofollow noopener" target="_blank">なぜリフレクションは遅いのか</a>(POSTD様)によると、静的な呼び出しと比べて<strong>2〜3桁オーダーで実行速度が遅い</strong>ようです。</p>

<p>単純なメソッド呼び出しやsetter/getterについて、リフレクションを使う分には悩むことも少ないでしょう。<br>
ジェネリック、コンストラクタ、in/out/ref/paramsキーワード、関数のオーバーロード、非publicな型を含む<code>Action&lt;T&gt;</code>や<code>Func&lt;T&gt;</code>、event等、要素が複雑になると、だんだんと長く、ツラくなってきます。<del>めげずに頑張ってググりましょう。</del></p>

<h4>
<span id="おまけリフレクションを効率化して使う" class="fragment"></span><a href="#%E3%81%8A%E3%81%BE%E3%81%91%E3%83%AA%E3%83%95%E3%83%AC%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%92%E5%8A%B9%E7%8E%87%E5%8C%96%E3%81%97%E3%81%A6%E4%BD%BF%E3%81%86"><i class="fa fa-link"></i></a>おまけ：リフレクションを効率化して使う</h4>

<ul>
<li>
<strong><code>Type</code>や<code>MemberInfo</code>のインスタンスをDictionaryでキャッシュする</strong>

<ul>
<li>一度生成した<code>Type</code>や<code>MemberInfo</code>のインスタンスを使いまわすことで、オーバーヘッドを回避します</li>
</ul>
</li>
<li>
<strong>FindMethod、FindProperty等のメソッドをラップする</strong>

<ul>
<li>Public/NonPublic、Instance/Staticを指定しなくても適切な<code>MemberInfo</code>を返すようなメソッドを作り、可読性を改善します</li>
</ul>
</li>
<li>
<strong>アセンブリからではなく<code>string</code>から型を見つける</strong>

<ul>
<li>
<code>Type.GetType("UnityEditor.ApplicationTitleDescriptor, UnityEditor")</code>のように、<code>クラス名フルパス, アセンブリ名</code>という文字列でも型を取得できます</li>
<li>このときの文字列は<code>Type</code>インスタンスを使って、<code>type.AssemblyQualifiedName</code>で取得できます</li>
</ul>
</li>
<li>
<strong>デリゲート化、式木、IL Emit</strong>

<ul>
<li>
<a href="https://ufcpp.net/study/csharp/misc_dynamic.html" rel="nofollow noopener" target="_blank">[雑記] 動的コード生成のパフォーマンス</a>(++C++; // 未確認飛行 C様)を参照してください</li>
</ul>
</li>
</ul>

<h2>
<span id="方法2internalsvisibletoattribute" class="fragment"></span><a href="#%E6%96%B9%E6%B3%952internalsvisibletoattribute"><i class="fa fa-link"></i></a>【方法2】InternalsVisibleToAttribute</h2>

<p><code>InternalsVisibleToAttribute</code>は、<strong>特定のアセンブリに対して、自身のinternalアクセスを許可させる属性</strong>です。<br>
アセンブリに対する単体テストや、機能拡張に使うことが多く、そういったアセンブリは<a href="https://docs.microsoft.com/ja-jp/dotnet/standard/assembly/friend" rel="nofollow noopener" target="_blank">フレンドアセンブリ</a>と呼ばれます。<br>
この属性の強力なところは、<strong>internalな要素をそのまま記述でき、VisualStudioやVisualStudio Code、Rider等のIDEでインテリセンスやブレークポイントが有効になる</strong>ことです。<br>
テストコードを書くに当たり、IDEのサポートが得られるのはありがたいですね！<br>
<a href="https://camo.qiitausercontent.com/07f3f19273ef41e3d08c1bcc31b8a29b4729fb42/68747470733a2f2f757365722d696d616765732e67697468756275736572636f6e74656e742e636f6d2f31323639303331352f37303631363831392d61383034626330302d316335322d313165612d386561332d6532346639346636343637642e676966" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fuser-images.githubusercontent.com%2F12690315%2F70616819-a804bc00-1c52-11ea-8ea3-e24f94f6467d.gif?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=33665b6f79d8af5afee99ae48e00c73d" alt="" data-canonical-src="https://user-images.githubusercontent.com/12690315/70616819-a804bc00-1c52-11ea-8ea3-e24f94f6467d.gif" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fuser-images.githubusercontent.com%2F12690315%2F70616819-a804bc00-1c52-11ea-8ea3-e24f94f6467d.gif?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=a5079fcc17c841a554bd16c7b20a846e 1x" loading="lazy"></a></p>

<p>さて、<code>InternalsVisibleToAttribute</code>は、UnityEngine.dllやUnityEditor.dllといった<strong>Unity公式のライブラリにも存在します</strong>。<br>
例えばUnityEditor.dllの<a href="https://github.com/Unity-Technologies/UnityCsReference/blob/master/Editor/Mono/AssemblyInfo/AssemblyInfo.cs" rel="nofollow noopener" target="_blank">AssemblyInfo.cs</a>には次のように定義されています。</p>

<div class="code-frame" data-lang="cs"><div class="highlight"><pre class="with-code"><code><span class="p">[</span><span class="n">assembly</span><span class="p">:</span> <span class="nf">InternalsVisibleTo</span><span class="p">(</span><span class="s">"Unity.LiveNotes"</span><span class="p">)]</span>
<span class="p">[</span><span class="n">assembly</span><span class="p">:</span> <span class="nf">InternalsVisibleTo</span><span class="p">(</span><span class="s">"Unity.Burst"</span><span class="p">)]</span>
<span class="p">[</span><span class="n">assembly</span><span class="p">:</span> <span class="nf">InternalsVisibleTo</span><span class="p">(</span><span class="s">"Unity.Burst.Editor"</span><span class="p">)]</span>
<span class="p">[</span><span class="n">assembly</span><span class="p">:</span> <span class="nf">InternalsVisibleTo</span><span class="p">(</span><span class="s">"Unity.Cloud.Collaborate.Editor"</span><span class="p">)]</span>
<span class="p">[</span><span class="n">assembly</span><span class="p">:</span> <span class="nf">InternalsVisibleTo</span><span class="p">(</span><span class="s">"Unity.CollabProxy.Editor"</span><span class="p">)]</span>
<span class="p">[</span><span class="n">assembly</span><span class="p">:</span> <span class="nf">InternalsVisibleTo</span><span class="p">(</span><span class="s">"Unity.CollabProxy.EditorTests"</span><span class="p">)]</span>
<span class="p">[</span><span class="n">assembly</span><span class="p">:</span> <span class="nf">InternalsVisibleTo</span><span class="p">(</span><span class="s">"Unity.CollabProxy.UI"</span><span class="p">)]</span>
<span class="p">[</span><span class="n">assembly</span><span class="p">:</span> <span class="nf">InternalsVisibleTo</span><span class="p">(</span><span class="s">"Unity.CollabProxy.UI.Tests"</span><span class="p">)]</span>
<span class="p">[</span><span class="n">assembly</span><span class="p">:</span> <span class="nf">InternalsVisibleTo</span><span class="p">(</span><span class="s">"Unity.CollabProxy.Client"</span><span class="p">)]</span>
<span class="p">[</span><span class="n">assembly</span><span class="p">:</span> <span class="nf">InternalsVisibleTo</span><span class="p">(</span><span class="s">"Unity.CollabProxy.Client.Tests"</span><span class="p">)]</span>
<span class="p">[</span><span class="n">assembly</span><span class="p">:</span> <span class="nf">InternalsVisibleTo</span><span class="p">(</span><span class="s">"UnityEditor.Advertisements"</span><span class="p">)]</span>
<span class="p">[</span><span class="n">assembly</span><span class="p">:</span> <span class="nf">InternalsVisibleTo</span><span class="p">(</span><span class="s">"Unity.PackageManager"</span><span class="p">)]</span>
<span class="p">...</span>
<span class="c1">//(以下、たくさんのInternalsVisibleToが羅列されている)</span>
<span class="p">[</span><span class="n">assembly</span><span class="p">:</span> <span class="nf">InternalsVisibleTo</span><span class="p">(</span><span class="s">"Unity.InternalAPIEditorBridgeDev.001"</span><span class="p">)]</span>
<span class="p">[</span><span class="n">assembly</span><span class="p">:</span> <span class="nf">InternalsVisibleTo</span><span class="p">(</span><span class="s">"Unity.InternalAPIEditorBridgeDev.002"</span><span class="p">)]</span>
<span class="p">[</span><span class="n">assembly</span><span class="p">:</span> <span class="nf">InternalsVisibleTo</span><span class="p">(</span><span class="s">"Unity.InternalAPIEditorBridgeDev.003"</span><span class="p">)]</span>
<span class="p">...</span>
</code></pre></div></div>

<p>これらの名前を持つアセンブリは、UnityEditor.dllのフレンドアセンブリです。<br>
よって、<strong>上記の名前を持つアセンブリを生成できれば、UnityEditor.dllに対してinternalアクセスできます</strong>。<del>すっごーい！</del></p>

<p>Unityでアセンブリを生成するための仕組みといえば、<a href="https://docs.unity3d.com/Manual/ScriptCompilationAssemblyDefinitionFiles.html" rel="nofollow noopener" target="_blank">AssemblyDefinitionFile</a>です。<br>
<code>AssemblyDefinitionFile</code>については<a href="/toRisouP" class="user-mention js-hovercard" title="toRisouP" data-hovercard-target-type="user" data-hovercard-target-name="toRisouP">@toRisouP</a>様が<a href="https://qiita.com/toRisouP/items/d206af3029c7d80326ed" id="reference-c1b2543d5a7f67229c61">Unity Assembly Definition 完全に理解した</a>にて詳しく解説されております。(こちらも<a href="https://qiita.com/advent-calendar/2019/unityforpro">【unityプロ技】 Advent Calendar 2019</a>の記事です)</p>

<p>なお、<code>AssemblyDefinitionFile</code>によって生成されるアセンブリ名は、インスペクタ内の<code>Name</code>フィールドで設定します。<br>
<strong>アセット名ではない</strong>ことに注意しましょう。</p>

<h4>
<span id="internalsvisibletoを使ってinternalアクセスしてみる" class="fragment"></span><a href="#internalsvisibleto%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6internal%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a><code>InternalsVisibleTo</code>を使ってinternalアクセスしてみる</h4>

<p>適当な<code>AssemblyDefinitionFile</code>を作成し、インスペクタビューから<code>Name</code>を変更しましょう。<br>
ここでは、<code>Unity.InternalAPIEditorBridgeDev.001</code>という、実に<strong>それっぽい名前</strong>(おそらくUnityの中の人がテストするためのアセンブリ名)を指定します。<br>
<a href="https://camo.qiitausercontent.com/d44b27cd3e51f789db106e14a19c7b7bbbf66006/68747470733a2f2f757365722d696d616765732e67697468756275736572636f6e74656e742e636f6d2f31323639303331352f37303631373032352d30636330313638302d316335332d313165612d386538632d6137333432653961626435362e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fuser-images.githubusercontent.com%2F12690315%2F70617025-0cc01680-1c53-11ea-8e8c-a7342e9abd56.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=a2cc87fb0f35e98005c5a18510de1217" alt="" data-canonical-src="https://user-images.githubusercontent.com/12690315/70617025-0cc01680-1c53-11ea-8e8c-a7342e9abd56.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fuser-images.githubusercontent.com%2F12690315%2F70617025-0cc01680-1c53-11ea-8e8c-a7342e9abd56.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=783d8c3397b595ede79c41c975995e6a 1x" loading="lazy"></a></p>

<p>次に、<code>Unity.InternalAPIEditorBridgeDev.001.asmdef</code>があるディレクトリ以下に、次のようなスクリプト(<code>Solution2_InternalsVisibleToAttribute.cs</code>)を追加し、<code>Unity.InternalAPIEditorBridgeDev.001</code>アセンブリに組み込みましょう。<br>
<a href="https://camo.qiitausercontent.com/9bef7783c6b1ca60e140e1a5ed9b374152f375ce/68747470733a2f2f757365722d696d616765732e67697468756275736572636f6e74656e742e636f6d2f31323639303331352f37303631373536302d33393238363238302d316335342d313165612d383338372d3831313234623530323234382e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fuser-images.githubusercontent.com%2F12690315%2F70617560-39286280-1c54-11ea-8387-81124b502248.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=98ef830250bd114a94c24528ceb08caa" alt="" data-canonical-src="https://user-images.githubusercontent.com/12690315/70617560-39286280-1c54-11ea-8387-81124b502248.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fuser-images.githubusercontent.com%2F12690315%2F70617560-39286280-1c54-11ea-8387-81124b502248.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=5b122167333f7e90b5eb4008cc524ed4 1x" loading="lazy"></a></p>

<div class="code-frame" data-lang="cs"><div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">UnityEditor</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">MainWindowTitleModifier</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">Solution2_InternalsVisibleToAttribute</span>
    <span class="p">{</span>
        <span class="p">[</span><span class="nf">MenuItem</span><span class="p">(</span><span class="s">"MainWindowTitleModifier/Solution2_InternalsVisibleToAttribute"</span><span class="p">,</span> <span class="n">priority</span> <span class="p">=</span> <span class="m">2</span><span class="p">)]</span>
        <span class="k">static</span> <span class="k">void</span> <span class="nf">Update</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">Action</span><span class="p">&lt;</span><span class="n">ApplicationTitleDescriptor</span><span class="p">&gt;</span> <span class="n">cb</span> <span class="p">=</span> <span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">title</span> <span class="p">=</span> <span class="s">"Solution2_InternalsVisibleToAttribute"</span><span class="p">;</span>
            <span class="n">EditorApplication</span><span class="p">.</span><span class="n">updateMainWindowTitle</span> <span class="p">+=</span> <span class="n">cb</span><span class="p">;</span>
            <span class="n">EditorApplication</span><span class="p">.</span><span class="nf">UpdateMainWindowTitle</span><span class="p">();</span>
            <span class="n">EditorApplication</span><span class="p">.</span><span class="n">updateMainWindowTitle</span> <span class="p">-=</span> <span class="n">cb</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>リフレクションが完全に消え、<a href="#%E4%BB%8A%E5%9B%9E%E3%81%AE%E3%83%87%E3%83%A2%E3%81%A7%E3%82%84%E3%82%8B%E3%81%93%E3%81%A8">イメージしたようなスッキリしたコード</a>になりました！<br>
直接呼び出しになるので、実行速度も申し分ありませんし、IDEのサポート(インテリセンスやブレークポイント)によって格段に生産性が上がりました。<br>
<code>MainWindowTitleModifier &gt; Solution2_InternalsVisibleToAttribute</code>を実行すれば、同様にタイトルバーのテキストを変えられます。<br>
<a href="https://camo.qiitausercontent.com/95aac0d282ce70b88ee82f4cd9bc32029255efc5/68747470733a2f2f757365722d696d616765732e67697468756275736572636f6e74656e742e636f6d2f31323639303331352f37303631353730302d33653833616530302d316335302d313165612d396135652d3565666630656438643538392e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fuser-images.githubusercontent.com%2F12690315%2F70615700-3e83ae00-1c50-11ea-9a5e-5eff0ed8d589.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=b3f18a7640273740f60997d5c7c6ad10" alt="" data-canonical-src="https://user-images.githubusercontent.com/12690315/70615700-3e83ae00-1c50-11ea-9a5e-5eff0ed8d589.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fuser-images.githubusercontent.com%2F12690315%2F70615700-3e83ae00-1c50-11ea-9a5e-5eff0ed8d589.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=82095eec1ae721185e39cee18a1ff70c 1x" loading="lazy"></a></p>

<h4>
<span id="internalsvisibletoの欠点" class="fragment"></span><a href="#internalsvisibleto%E3%81%AE%E6%AC%A0%E7%82%B9"><i class="fa fa-link"></i></a><code>InternalsVisibleTo</code>の欠点</h4>

<p><code>AssemblyDefinitionFile</code>と<code>InternalsVisibleToAttribute</code>を使ったinternalアクセスは、非常に手軽な方法です。<br>
しかし、残念ながら、全てにおいて完璧とは言えません：</p>

<ul>
<li>
<strong>privateアクセスができない</strong>

<ul>
<li>必要な場合、リフレクションを使ってください</li>
</ul>
</li>
<li>
<strong>ライブラリ側に<code>InternalsVisibleToAttribute</code>が定義されている必要がある</strong>

<ul>
<li>
<strong>「ライブラリ側に」</strong>属性があることが条件です</li>
<li>例えばライブラリのアップデート等で、ライブラリ側から<code>InternalsVisibleToAttribute</code>が変更・削除されると、コンパイルエラーになります</li>
</ul>
</li>
<li>
<strong>ランタイムでは使用できない場面が多い</strong>

<ul>
<li>UnityEngine.dll等は、ビルド時に<code>InternalsVisibleToAttribute</code>が綺麗サッパリなくなります</li>
<li>これは、エディタ用とは異なるランタイム用アセンブリが使用されるためです</li>
</ul>
</li>
<li>
<strong>アセンブリ名が衝突するとエラー</strong>

<ul>
<li>パッケージを外部に公開する場合、誰かが同じフレンドアセンブリの名前を使い、アセンブリ名が衝突する可能性があります</li>
<li>これは潜在的な不具合と言えます</li>
</ul>
</li>
</ul>

<p>難儀な欠点が多いですが、逆に言えば、<strong>クローズドな環境でエディタ向けの機能を実装する</strong>のであれば、この方法だけでも十分に使えそうです。</p>

<h2>
<span id="方法3ignoresaccesscheckstoattribute" class="fragment"></span><a href="#%E6%96%B9%E6%B3%953ignoresaccesscheckstoattribute"><i class="fa fa-link"></i></a>【方法3】IgnoresAccessChecksToAttribute</h2>

<p><code>IgnoresAccessChecksToAttribute</code>は、ほとんど情報が出回っていない<em>（MSDNにも載ってない）</em>ミステリアスな属性です。<br>
私は<a href="https://www.strathweb.com/2018/10/no-internalvisibleto-no-problem-bypassing-c-visibility-rules-with-roslyn/" rel="nofollow noopener" target="_blank">No InternalsVisibleTo, no problem – bypassing C# visibility rules with Roslyn</a>で偶然知りました。<br>
要約すると：</p>

<ul>
<li>
<code>InternalsVisibleToAttribute</code>とは<strong>逆の方向に作用する</strong>。つまり、<strong>ライブラリ利用者側に設定することで、ライブラリに対するinternalアクセスを許可する</strong>
</li>
<li>フルネームは<code>System.Runtime.CompilerServices.IgnoresAccessChecksToAttribute</code>
</li>
<li>Base Class Libraryに載っていないが、ランタイム（CLR/CoreCLR）で作用する</li>
<li>
<strong><code>csc.exe</code>や<code>MsBuild</code>を使わずに自力で</strong>コンパイルする際に、<code>CSharpCompilationOptions.TopLevelBinderFlags</code>に対して特定のフラグを立てると有効になる</li>
</ul>

<p>つまり、<strong>どんなライブラリに対してもinternalアクセスができるようになる、夢のような属性</strong>ってことですね！<br>
さっそく、この属性を使ってみましょう。</p>

<h4>
<span id="ignoresaccesscheckstoattributeを使ってinternalアクセスしてみる" class="fragment"></span><a href="#ignoresaccesscheckstoattribute%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6internal%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a><code>IgnoresAccessChecksToAttribute</code>を使ってinternalアクセスしてみる</h4>

<p><a href="https://www.strathweb.com/2018/10/no-internalvisibleto-no-problem-bypassing-c-visibility-rules-with-roslyn/" rel="nofollow noopener" target="_blank">先述の記事</a>にある通り、<code>IgnoresAccessChecksToAttribute</code>を使うには<strong><code>csc.exe</code>や<code>MsBuild</code>を使わずに、自力でコンパイルする必要があります</strong>。<br>
自力でコンパイルする方法を紹介しますが、正直めんどくさいです。<br>
興味のない方は「<a href="#IgnoresAccessChecksTo%E3%81%AE%E6%BA%96%E5%82%99%E3%81%8C%E3%82%81%E3%82%93%E3%81%A9%E3%81%8F%E3%81%95%E3%81%84%E3%81%AE%E3%81%A7%E3%81%AA%E3%82%93%E3%81%A8%E3%81%8B%E3%81%99%E3%82%8B">IgnoresAccessChecksToの準備がめんどくさいのでなんとかする</a>」まで読み飛ばし推奨。</p>

<hr>

<p>まず、C#プロジェクトに以下のコードを追加します。<br>
こうすることで、<strong>「UnityEditorアセンブリに対するアクセスレベルのチェックを無視する」</strong>ようにコンパイラが解釈できます。</p>

<div class="code-frame" data-lang="cs"><div class="highlight"><pre class="with-code"><code><span class="p">[</span><span class="n">assembly</span><span class="p">:</span> <span class="n">System</span><span class="p">.</span><span class="n">Runtime</span><span class="p">.</span><span class="n">CompilerServices</span><span class="p">.</span><span class="nf">IgnoresAccessChecksTo</span><span class="p">(</span><span class="s">"UnityEditor"</span><span class="p">)]</span>
<span class="k">namespace</span> <span class="nn">System.Runtime.CompilerServices</span>
<span class="p">{</span>
    <span class="p">[</span><span class="nf">AttributeUsage</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="n">AttributeTargets</span><span class="p">.</span><span class="n">Assembly</span><span class="p">,</span> <span class="n">AllowMultiple</span> <span class="p">=</span> <span class="k">true</span><span class="p">)]</span>
    <span class="k">internal</span> <span class="k">class</span> <span class="nc">IgnoresAccessChecksToAttribute</span> <span class="p">:</span> <span class="n">System</span><span class="p">.</span><span class="n">Attribute</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="nf">IgnoresAccessChecksToAttribute</span><span class="p">(</span><span class="kt">string</span> <span class="n">assemblyName</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">AssemblyName</span> <span class="p">=</span> <span class="n">assemblyName</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="kt">string</span> <span class="n">AssemblyName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>次に、C#プロジェクトとは別に、<strong>「アクセスチェックを無視できる」</strong>コンパイラのプロジェクトを作ります。コードは以下の通りです。</p>

<div class="code-frame" data-lang="cs"><div class="highlight"><pre class="with-code"><code><span class="c1">// あらかじめMicrosoft.CodeAnalysis.CSharpをnugetでインストールしておく</span>
<span class="k">using</span> <span class="nn">Microsoft.CodeAnalysis</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Microsoft.CodeAnalysis.CSharp</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.IO</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Linq</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Reflection</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Text.RegularExpressions</span><span class="p">;</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">InternalAccessibleCompiler</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span> <span class="p">(</span><span class="kt">string</span> <span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">string</span> <span class="n">inputCsProjPath</span> <span class="p">=</span> <span class="n">args</span> <span class="p">[</span><span class="m">0</span><span class="p">];</span>
        <span class="kt">string</span> <span class="n">outputAsemblyPath</span> <span class="p">=</span> <span class="n">args</span> <span class="p">[</span><span class="m">1</span><span class="p">];</span>
        <span class="kt">string</span> <span class="n">outputAsemblyName</span> <span class="p">=</span> <span class="n">Path</span><span class="p">.</span><span class="nf">GetFileNameWithoutExtension</span> <span class="p">(</span><span class="n">outputAsemblyPath</span><span class="p">);</span>

        <span class="c1">// C#プロジェクトを読み込みます.</span>
        <span class="kt">string</span><span class="p">[]</span> <span class="n">csproj</span> <span class="p">=</span> <span class="n">File</span><span class="p">.</span><span class="nf">ReadAllLines</span><span class="p">(</span><span class="n">inputCsProjPath</span><span class="p">);</span>

        <span class="c1">// dllとしてコンパイルさせるオプションを生成します.</span>
        <span class="n">CSharpCompilationOptions</span> <span class="n">compilationOptions</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">CSharpCompilationOptions</span><span class="p">(</span><span class="n">OutputKind</span><span class="p">.</span><span class="n">DynamicallyLinkedLibrary</span><span class="p">)</span>
            <span class="p">.</span><span class="nf">WithMetadataImportOptions</span><span class="p">(</span><span class="n">MetadataImportOptions</span><span class="p">.</span><span class="n">All</span><span class="p">);</span>

        <span class="c1">// BindingFlags.IgnoreAccessibility(1 &lt;&lt; 22)を有効化します.</span>
        <span class="k">typeof</span><span class="p">(</span><span class="n">CSharpCompilationOptions</span><span class="p">)</span>
            <span class="p">.</span><span class="nf">GetProperty</span><span class="p">(</span><span class="s">"TopLevelBinderFlags"</span><span class="p">,</span> <span class="n">BindingFlags</span><span class="p">.</span><span class="n">Instance</span> <span class="p">|</span> <span class="n">BindingFlags</span><span class="p">.</span><span class="n">NonPublic</span><span class="p">)</span>
            <span class="p">.</span><span class="nf">SetValue</span><span class="p">(</span><span class="n">compilationOptions</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span><span class="m">1</span> <span class="p">&lt;&lt;</span> <span class="m">22</span><span class="p">);</span>

        <span class="c1">// プロジェクトからアセンブリ参照一覧を取得→IEnumerable&lt;PortableExecutableReference&gt;に変換します.</span>
        <span class="n">Regex</span> <span class="n">reg_dll</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Regex</span><span class="p">(</span><span class="s">"&lt;HintPath&gt;(.*)&lt;/HintPath&gt;"</span><span class="p">,</span> <span class="n">RegexOptions</span><span class="p">.</span><span class="n">Compiled</span><span class="p">);</span>
        <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">PortableExecutableReference</span><span class="p">&gt;</span> <span class="n">metadataReferences</span> <span class="p">=</span> <span class="n">csproj</span>
            <span class="p">.</span><span class="nf">Select</span><span class="p">(</span><span class="n">line</span> <span class="p">=&gt;</span> <span class="n">reg_dll</span><span class="p">.</span><span class="nf">Match</span><span class="p">(</span><span class="n">line</span><span class="p">))</span>
            <span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">match</span> <span class="p">=&gt;</span> <span class="n">match</span><span class="p">.</span><span class="n">Success</span><span class="p">)</span>
            <span class="p">.</span><span class="nf">Select</span><span class="p">(</span><span class="n">match</span> <span class="p">=&gt;</span> <span class="n">match</span><span class="p">.</span><span class="n">Groups</span><span class="p">[</span><span class="m">1</span><span class="p">].</span><span class="n">Value</span><span class="p">)</span>
            <span class="p">.</span><span class="nf">Select</span><span class="p">(</span><span class="n">path</span> <span class="p">=&gt;</span> <span class="n">MetadataReference</span><span class="p">.</span><span class="nf">CreateFromFile</span><span class="p">(</span><span class="n">path</span><span class="p">));</span>

        <span class="c1">// プロジェクトからシンボル一覧を取得→IEnumerable&lt;string&gt;に変換します.</span>
        <span class="n">Regex</span> <span class="n">reg_preprocessorSymbols</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Regex</span><span class="p">(</span><span class="s">"&lt;DefineConstants&gt;(.*)&lt;/DefineConstants&gt;"</span><span class="p">,</span> <span class="n">RegexOptions</span><span class="p">.</span><span class="n">Compiled</span><span class="p">);</span>
        <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">preprocessorSymbols</span> <span class="p">=</span> <span class="n">csproj</span>
            <span class="p">.</span><span class="nf">Select</span><span class="p">(</span><span class="n">line</span> <span class="p">=&gt;</span> <span class="n">reg_preprocessorSymbols</span><span class="p">.</span><span class="nf">Match</span><span class="p">(</span><span class="n">line</span><span class="p">))</span>
            <span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">match</span> <span class="p">=&gt;</span> <span class="n">match</span><span class="p">.</span><span class="n">Success</span><span class="p">)</span>
            <span class="p">.</span><span class="nf">SelectMany</span><span class="p">(</span><span class="n">match</span> <span class="p">=&gt;</span> <span class="n">match</span><span class="p">.</span><span class="n">Groups</span><span class="p">[</span><span class="m">1</span><span class="p">].</span><span class="n">Value</span><span class="p">.</span><span class="nf">Split</span><span class="p">(</span><span class="sc">';'</span><span class="p">));</span>

        <span class="c1">// プロジェクトからソースコード一覧を取得→テキストとして読み込み→IEnumerable&lt;SyntaxTree&gt;に変換します.</span>
        <span class="n">CSharpParseOptions</span> <span class="n">parserOption</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">CSharpParseOptions</span><span class="p">(</span><span class="n">LanguageVersion</span><span class="p">.</span><span class="n">Latest</span><span class="p">,</span>
                <span class="n">preprocessorSymbols</span><span class="p">:</span> <span class="n">preprocessorSymbols</span><span class="p">);</span>
        <span class="n">Regex</span> <span class="n">reg_cs</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Regex</span><span class="p">(</span><span class="s">"&lt;Compile Include=\"(.*\\.cs)\""</span><span class="p">,</span> <span class="n">RegexOptions</span><span class="p">.</span><span class="n">Compiled</span><span class="p">);</span>
        <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">SyntaxTree</span><span class="p">&gt;</span> <span class="n">syntaxTrees</span> <span class="p">=</span> <span class="n">csproj</span>
            <span class="p">.</span><span class="nf">Select</span><span class="p">(</span><span class="n">line</span> <span class="p">=&gt;</span> <span class="n">reg_cs</span><span class="p">.</span><span class="nf">Match</span><span class="p">(</span><span class="n">line</span><span class="p">))</span>
            <span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">match</span> <span class="p">=&gt;</span> <span class="n">match</span><span class="p">.</span><span class="n">Success</span><span class="p">)</span>
            <span class="p">.</span><span class="nf">Select</span><span class="p">(</span><span class="n">match</span> <span class="p">=&gt;</span> <span class="n">match</span><span class="p">.</span><span class="n">Groups</span><span class="p">[</span><span class="m">1</span><span class="p">].</span><span class="n">Value</span><span class="p">.</span><span class="nf">Replace</span><span class="p">(</span><span class="sc">'\\'</span><span class="p">,</span> <span class="n">Path</span><span class="p">.</span><span class="n">DirectorySeparatorChar</span><span class="p">))</span>
            <span class="p">.</span><span class="nf">Select</span><span class="p">(</span><span class="n">path</span> <span class="p">=&gt;</span> <span class="n">Path</span><span class="p">.</span><span class="nf">Combine</span><span class="p">(</span><span class="n">inputCsProjDir</span><span class="p">,</span> <span class="n">path</span><span class="p">))</span>
            <span class="p">.</span><span class="nf">Select</span><span class="p">(</span><span class="n">path</span> <span class="p">=&gt;</span> <span class="n">CSharpSyntaxTree</span><span class="p">.</span><span class="nf">ParseText</span><span class="p">(</span><span class="n">File</span><span class="p">.</span><span class="nf">ReadAllText</span><span class="p">(</span><span class="n">path</span><span class="p">),</span> <span class="n">parserOption</span><span class="p">,</span> <span class="n">path</span><span class="p">));</span>

        <span class="c1">// コンパイルを実行し、dllを生成します.</span>
        <span class="n">CSharpCompilation</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="n">outputAsemblyName</span><span class="p">,</span> <span class="n">syntaxTrees</span><span class="p">,</span> <span class="n">metadataReferences</span><span class="p">,</span> <span class="n">compilationOptions</span><span class="p">)</span>
            <span class="p">.</span><span class="nf">Emit</span><span class="p">(</span><span class="n">outputAsemblyPath</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>なお、このコードはコンパイル対象が<strong>Unityが生成したC#プロジェクトである</strong>ことを前提にしています。<br>
他のジェネレータで生成されたC#プロジェクトをコンパイルできないかもしれません。<br>
（きっと、おそらくMSBuildパッケージを使えばたぶん解決できます。）</p>

<p>dotnetを使って実行し、以下のようにC#プロジェクトファイルと出力パスを指定すると、<strong>internalアクセス可能なdll</strong>を生成できます。</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre class="with-code"><code>dotnet run <span class="nt">--</span> C#プロジェクトパス 出力dllパス
</code></pre></div></div>

<p>なお、このコンパイラはnuget toolとしても公開しています。（オプションが若干違います）<br>
<a href="https://camo.qiitausercontent.com/e2114efc3c56110a73f3f75698de2da9364049f1/68747470733a2f2f757365722d696d616765732e67697468756275736572636f6e74656e742e636f6d2f31323639303331352f37303733313430312d66396463336438302d316434392d313165612d383166642d6237343366383736306536322e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fuser-images.githubusercontent.com%2F12690315%2F70731401-f9dc3d80-1d49-11ea-81fd-b743f8760e62.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=3c865e52507faa4ca5938dd3dc363239" alt="" data-canonical-src="https://user-images.githubusercontent.com/12690315/70731401-f9dc3d80-1d49-11ea-81fd-b743f8760e62.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fuser-images.githubusercontent.com%2F12690315%2F70731401-f9dc3d80-1d49-11ea-81fd-b743f8760e62.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=1f45a1d01d556af0dadd5b66094aa1d1 1x" loading="lazy"></a><br>
<a href="https://www.nuget.org/packages/InternalAccessibleCompiler/" class="autolink" rel="nofollow noopener" target="_blank">https://www.nuget.org/packages/InternalAccessibleCompiler/</a></p>

<h4>
<span id="ignoresaccesscheckstoの準備がめんどくさいのでなんとかする" class="fragment"></span><a href="#ignoresaccesschecksto%E3%81%AE%E6%BA%96%E5%82%99%E3%81%8C%E3%82%81%E3%82%93%E3%81%A9%E3%81%8F%E3%81%95%E3%81%84%E3%81%AE%E3%81%A7%E3%81%AA%E3%82%93%E3%81%A8%E3%81%8B%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a><code>IgnoresAccessChecksTo</code>の準備がめんどくさいのでなんとかする</h4>

<p><code>IgnoresAccessChecksTo</code>をUnityで使うには準備がめんどくさいです。<br>
今回は、先述のコンパイラを同梱済みの<a href="https://github.com/mob-sakai/InternalAccessibleCompilerForUnity" rel="nofollow noopener" target="_blank">Unity向けに公開しているパッケージ</a>を使います。<br>
（デモプロジェクトには既にインストールされています。）</p>

<ol>
<li>このパッケージには<code>dotnet 2.1</code>以上が必要です

<ul>
<li>コマンドプロンプト(Windows)やターミナル(Mac)で、<code>dotnet --version</code>を実行したときに、<code>2.1.xxx</code>以上が表示されていればインストール不要です</li>
<li>
<a href="https://dotnet.microsoft.com/download" class="autolink" rel="nofollow noopener" target="_blank">https://dotnet.microsoft.com/download</a> からインストールしてください</li>
</ul>
</li>
<li>manifest.jsonの<code>dependencies</code>に<code>"com.coffee.internal-accessible-compiler": "https://github.com/mob-sakai/InternalAccessibleCompilerForUnity.git"</code>を追加し、パッケージをインストールします</li>
<li>プロジェクトビューで<code>MainWindowTitleModifier.asmdef</code>を選択し、コンテキストメニュー(右クリック)から<code>Internal Accessible Compiler &gt; Setting</code>をクリックします
<a href="https://camo.qiitausercontent.com/90f1f1ee9dacd98b51b2654b74938b701ea873d6/68747470733a2f2f757365722d696d616765732e67697468756275736572636f6e74656e742e636f6d2f31323639303331352f37303732383138322d34396238303630302d316434342d313165612d396566372d3966323730393730326238312e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fuser-images.githubusercontent.com%2F12690315%2F70728182-49b80600-1d44-11ea-9ef7-9f2709702b81.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=a0d82e46c60462bfef34b60965407ed2" alt="" data-canonical-src="https://user-images.githubusercontent.com/12690315/70728182-49b80600-1d44-11ea-9ef7-9f2709702b81.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fuser-images.githubusercontent.com%2F12690315%2F70728182-49b80600-1d44-11ea-9ef7-9f2709702b81.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=e5c7bec72625cde257d54c82e96ef7ec 1x" loading="lazy"></a>
</li>
<li>開いたウィンドウで、以下のように入力します

<ul>
<li>Assembly Names To Access: <code>UnityEditor</code>
</li>
<li>Output Dll Path: <code>Assets/Editor/Solution3.IgnoresAccessChecksToAttribute/MainWindowTitleModifier.dll</code><br>
<a href="https://camo.qiitausercontent.com/8122e33a0873be8286f0f9a78ba384711eddcba6/68747470733a2f2f757365722d696d616765732e67697468756275736572636f6e74656e742e636f6d2f31323639303331352f37303733323335312d61353339633230302d316434622d313165612d393231382d3939313636666262653930322e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fuser-images.githubusercontent.com%2F12690315%2F70732351-a539c200-1d4b-11ea-9218-99166fbbe902.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=974ad9b5204adba2f639b95aa3da903e" alt="" data-canonical-src="https://user-images.githubusercontent.com/12690315/70732351-a539c200-1d4b-11ea-9218-99166fbbe902.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fuser-images.githubusercontent.com%2F12690315%2F70732351-a539c200-1d4b-11ea-9218-99166fbbe902.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=9b41f1e1874d4ff962a826225da0ec93 1x" loading="lazy"></a>
</li>
</ul>
</li>
<li>
<code>Compile</code>をクリックし、dllにコンパイルします</li>
</ol>

<p><code>AssemblyDefinitionFile</code>やソースコードは、<a href="#%E6%96%B9%E6%B3%952internalsvisibletoattribute">【方法2】InternalsVisibleTo</a>とアセンブリ名やクラス名が被らないようにする以外、ほとんど同じです。<br>
コンパイルが完了すると、<code>MainWindowTitleModifier.dll</code>が生成されます。<br>
このままでは同じ名前を持つ<code>MenuItem</code>が衝突してしまうので、<code>MainWindowTitleModifier.asmdef</code>の<code>Define Constraints</code>に適当な文字列を入力して、インポートされないようにしておきましょう。<br>
<a href="https://camo.qiitausercontent.com/6d2edcc695b8de3edab53cf45c37db75c7063a16/68747470733a2f2f757365722d696d616765732e67697468756275736572636f6e74656e742e636f6d2f31323639303331352f37303631343339352d64323037616638302d316334642d313165612d386330612d3037656564666634396661652e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fuser-images.githubusercontent.com%2F12690315%2F70614395-d207af80-1c4d-11ea-8c0a-07eedff49fae.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=cd40d30947019ec1a98679069ccfcac3" alt="" data-canonical-src="https://user-images.githubusercontent.com/12690315/70614395-d207af80-1c4d-11ea-8c0a-07eedff49fae.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fuser-images.githubusercontent.com%2F12690315%2F70614395-d207af80-1c4d-11ea-8c0a-07eedff49fae.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=b2759a10dab44789f1222d8420ba01a0 1x" loading="lazy"></a></p>

<p><code>MainWindowTitleModifier.dll</code>のインポート後、<code>MainWindowTitleModifier &gt; Solution3_IgnoresAccessChecksToAttribute</code>を実行すれば、タイトルバーのテキストを変えられます。<br>
<a href="https://camo.qiitausercontent.com/d558ce19e7ab2f64b003d1a4960626b240ef2390/68747470733a2f2f757365722d696d616765732e67697468756275736572636f6e74656e742e636f6d2f31323639303331352f37303631353639392d33646562313738302d316335302d313165612d393361312d3264313136666262626161382e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fuser-images.githubusercontent.com%2F12690315%2F70615699-3deb1780-1c50-11ea-93a1-2d116fbbbaa8.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=d695b23c79986cf77eea44b7add1691c" alt="" data-canonical-src="https://user-images.githubusercontent.com/12690315/70615699-3deb1780-1c50-11ea-93a1-2d116fbbbaa8.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fuser-images.githubusercontent.com%2F12690315%2F70615699-3deb1780-1c50-11ea-93a1-2d116fbbbaa8.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=f5155b19fb9b5460b0b1871eedc9a04d 1x" loading="lazy"></a></p>

<h4>
<span id="ignoresaccesscheckstoの欠点" class="fragment"></span><a href="#ignoresaccesschecksto%E3%81%AE%E6%AC%A0%E7%82%B9"><i class="fa fa-link"></i></a><code>IgnoresAccessChecksTo</code>の欠点</h4>

<p><strong>どんなアセンブリに対してもinternalアクセスができる</strong>ため、この方法は非常に強力です。<br>
<a href="#internalsvisibleto%E3%81%AE%E6%AC%A0%E7%82%B9">【方法2】InternalsVisibleToの欠点</a>も少し克服していますが、それでも完璧ではありません：</p>

<ul>
<li>
<strong>privateアクセスができない</strong>

<ul>
<li>必要な場合、やはりリフレクションを使ってください</li>
</ul>
</li>
<li>
<strong>使うためにはコンパイルする必要がある</strong>

<ul>
<li>コンパイルという手間が発生します</li>
<li>自動化するなり、運用でカバーしましょう</li>
</ul>
</li>
<li>
<strong>コード内で<code>UNITY_2019</code>等のシンボルを使う場合、各バージョンのdll生成が必要</strong>

<ul>
<li>コード内のシンボルは上記コンパイルの際に解決されます</li>
<li>そのため、UnityのバージョンアップでAPIが変更されると、<strong>APIのバージョン毎にdllを複数生成する</strong>必要があります</li>
<li>生成したdllのインポート設定の<code>Define Constraints</code>から、特定のバージョンのdllのみをインポートするようにしましょう</li>
<li>自動化するなり、運用でカバーしましょう</li>
</ul>
</li>
</ul>

<h2>
<span id="これまで紹介したinternal要素へのアクセス方法まとめ" class="fragment"></span><a href="#%E3%81%93%E3%82%8C%E3%81%BE%E3%81%A7%E7%B4%B9%E4%BB%8B%E3%81%97%E3%81%9Finternal%E8%A6%81%E7%B4%A0%E3%81%B8%E3%81%AE%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E6%96%B9%E6%B3%95%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>これまで紹介したinternal要素へのアクセス方法まとめ</h2>

<p>今回は外部アセンブリからinternalアクセスする方法を3つ紹介しました。</p>

<table>
<thead>
<tr>
<th>方法</th>
<th>利点</th>
<th>欠点</th>
<th>private<br>アクセス</th>
<th>生産性</th>
<th>実行速度</th>
<th>ランタイム</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="#%E6%96%B9%E6%B3%951reflection">【方法1】<br>Reflection</a></td>
<td>
<img alt=":thumbsup:" class="emoji" height="20" src="https://cdn.qiita.com/emoji/twemoji/unicode/1f44d.png" title=":thumbsup:" width="20" loading="lazy">情報がたくさんある<br><img alt=":thumbsup:" class="emoji" height="20" src="https://cdn.qiita.com/emoji/twemoji/unicode/1f44d.png" title=":thumbsup:" width="20" loading="lazy">privateアクセス可</td>
<td>
<img alt=":thumbsdown:" class="emoji" height="20" src="https://cdn.qiita.com/emoji/twemoji/unicode/1f44e.png" title=":thumbsdown:" width="20" loading="lazy">コードの可読性・保守性が低い<br><img alt=":thumbsdown:" class="emoji" height="20" src="https://cdn.qiita.com/emoji/twemoji/unicode/1f44e.png" title=":thumbsdown:" width="20" loading="lazy">低速な実行速度<br><img alt=":thumbsdown:" class="emoji" height="20" src="https://cdn.qiita.com/emoji/twemoji/unicode/1f44e.png" title=":thumbsdown:" width="20" loading="lazy">インテリセンスが無効</td>
<td><img alt=":white_check_mark:" class="emoji" height="20" src="https://cdn.qiita.com/emoji/twemoji/unicode/2705.png" title=":white_check_mark:" width="20" loading="lazy"></td>
<td><img alt=":ng:" class="emoji" height="20" src="https://cdn.qiita.com/emoji/twemoji/unicode/1f196.png" title=":ng:" width="20" loading="lazy"></td>
<td><img alt=":ng:" class="emoji" height="20" src="https://cdn.qiita.com/emoji/twemoji/unicode/1f196.png" title=":ng:" width="20" loading="lazy"></td>
<td><img alt=":white_check_mark:" class="emoji" height="20" src="https://cdn.qiita.com/emoji/twemoji/unicode/2705.png" title=":white_check_mark:" width="20" loading="lazy"></td>
</tr>
<tr>
<td><a href="#%E6%96%B9%E6%B3%952internalsvisibletoattribute">【方法2】<br>InternalsVisibleTo</a></td>
<td>
<img alt=":thumbsup:" class="emoji" height="20" src="https://cdn.qiita.com/emoji/twemoji/unicode/1f44d.png" title=":thumbsup:" width="20" loading="lazy">手軽<br><img alt=":thumbsup:" class="emoji" height="20" src="https://cdn.qiita.com/emoji/twemoji/unicode/1f44d.png" title=":thumbsup:" width="20" loading="lazy">インテリセンスが有効<br><img alt=":thumbsup:" class="emoji" height="20" src="https://cdn.qiita.com/emoji/twemoji/unicode/1f44d.png" title=":thumbsup:" width="20" loading="lazy">高速な実行速度</td>
<td>
<img alt=":thumbsdown:" class="emoji" height="20" src="https://cdn.qiita.com/emoji/twemoji/unicode/1f44e.png" title=":thumbsdown:" width="20" loading="lazy">privateアクセス不可<br><img alt=":thumbsdown:" class="emoji" height="20" src="https://cdn.qiita.com/emoji/twemoji/unicode/1f44e.png" title=":thumbsdown:" width="20" loading="lazy">アセンブリ名が被るとエラー<br><img alt=":thumbsdown:" class="emoji" height="20" src="https://cdn.qiita.com/emoji/twemoji/unicode/1f44e.png" title=":thumbsdown:" width="20" loading="lazy">ライブラリ側に属性が必要</td>
<td><img alt=":ng:" class="emoji" height="20" src="https://cdn.qiita.com/emoji/twemoji/unicode/1f196.png" title=":ng:" width="20" loading="lazy"></td>
<td><img alt=":white_check_mark:" class="emoji" height="20" src="https://cdn.qiita.com/emoji/twemoji/unicode/2705.png" title=":white_check_mark:" width="20" loading="lazy"></td>
<td><img alt=":white_check_mark:" class="emoji" height="20" src="https://cdn.qiita.com/emoji/twemoji/unicode/2705.png" title=":white_check_mark:" width="20" loading="lazy"></td>
<td><img alt=":ng:" class="emoji" height="20" src="https://cdn.qiita.com/emoji/twemoji/unicode/1f196.png" title=":ng:" width="20" loading="lazy"></td>
</tr>
<tr>
<td><a href="#%E6%96%B9%E6%B3%953ignoresaccesscheckstoattribute">【方法3】<br>IgnoresAccessChecksTo</a></td>
<td>
<img alt=":thumbsup:" class="emoji" height="20" src="https://cdn.qiita.com/emoji/twemoji/unicode/1f44d.png" title=":thumbsup:" width="20" loading="lazy">privateアクセス可<br><img alt=":thumbsup:" class="emoji" height="20" src="https://cdn.qiita.com/emoji/twemoji/unicode/1f44d.png" title=":thumbsup:" width="20" loading="lazy">どんなライブラリに対しても有効<br><img alt=":thumbsup:" class="emoji" height="20" src="https://cdn.qiita.com/emoji/twemoji/unicode/1f44d.png" title=":thumbsup:" width="20" loading="lazy">インテリセンスが有効<br><img alt=":thumbsup:" class="emoji" height="20" src="https://cdn.qiita.com/emoji/twemoji/unicode/1f44d.png" title=":thumbsup:" width="20" loading="lazy">高速な実行速度</td>
<td>
<img alt=":thumbsdown:" class="emoji" height="20" src="https://cdn.qiita.com/emoji/twemoji/unicode/1f44e.png" title=":thumbsdown:" width="20" loading="lazy">自力コンパイルが必要<br><img alt=":thumbsdown:" class="emoji" height="20" src="https://cdn.qiita.com/emoji/twemoji/unicode/1f44e.png" title=":thumbsdown:" width="20" loading="lazy">シンボルの取り扱いに注意が必要</td>
<td><img alt=":white_check_mark:" class="emoji" height="20" src="https://cdn.qiita.com/emoji/twemoji/unicode/2705.png" title=":white_check_mark:" width="20" loading="lazy"></td>
<td><img alt=":white_check_mark:" class="emoji" height="20" src="https://cdn.qiita.com/emoji/twemoji/unicode/2705.png" title=":white_check_mark:" width="20" loading="lazy"></td>
<td><img alt=":white_check_mark:" class="emoji" height="20" src="https://cdn.qiita.com/emoji/twemoji/unicode/2705.png" title=":white_check_mark:" width="20" loading="lazy"></td>
<td><img alt=":white_check_mark:" class="emoji" height="20" src="https://cdn.qiita.com/emoji/twemoji/unicode/2705.png" title=":white_check_mark:" width="20" loading="lazy"></td>
</tr>
</tbody>
</table>

<p>以下は、パッケージマネージャのUIを拡張するパッケージ、<a href="https://github.com/mob-sakai/UpmGitExtension" rel="nofollow noopener" target="_blank">UpmGitExtension</a>を実装した際のワークフローです。<br>
（実際にはdll生成の工程を自動化したり、<code>AssemblyDefinitionFile</code>の参照関係を整理したり、dllを生成するために使ったディレクトリをパッケージからパージしてます。）</p>

<ul>
<li>一旦、手軽な方法である<a href="#%E6%96%B9%E6%B3%952internalsvisibletoattribute">【方法2】InternalsVisibleTo</a>で実装する

<ul>
<li>後でパージしやすいように、パッケージディレクトリに専用のディレクトリを作っておく</li>
</ul>
</li>
<li>
<strong>パッケージを公開する前</strong>に<a href="#%E6%96%B9%E6%B3%953ignoresaccesscheckstoattribute">【方法3】IgnoresAccessChecksTo</a>でdllを生成する

<ul>
<li>nugetに公開している<a href="https://www.nuget.org/packages/InternalAccessibleCompiler/" rel="nofollow noopener" target="_blank">InternalAccessibleCompiler</a>とシェルスクリプトで一括処理</li>
</ul>
</li>
<li>パッケージから「dllを生成するために使ったディレクトリ」をパージし、公開

<ul>
<li>
<code>.npmignore</code>にディレクトリを記載しておき、<code>npm pack</code>してパージする</li>
<li>packしたものはnpmレジストリにそのまま公開できる</li>
<li>packしたものを展開し、upmブランチにプッシュする</li>
</ul>
</li>
<li>どうしてもprivateアクセスが必要な場面は<a href="#%E6%96%B9%E6%B3%951reflection">【方法1】Reflection</a>を使う

<ul>
<li>
<a href="https://github.com/mob-sakai/UpmGitExtension/blob/preview/Packages/com.coffee.upm-git-extension/Editor/InternalBridge/Expose.cs" rel="nofollow noopener" target="_blank">Expose</a>クラスのような、リフレクション機能をラップするクラスを作っておくと楽</li>
<li>
<code>Expose.FromType(typeof(EditorApplication)).Call("UpdateMainWindowTitle");</code>のように呼び出せる</li>
</ul>
</li>
</ul>

<h2>
<span id="雑記" class="fragment"></span><a href="#%E9%9B%91%E8%A8%98"><i class="fa fa-link"></i></a>雑記</h2>

<p>UpmGitExtensionの実装において、internal要素へのアクセスは必須事項でした。<br>
UnityやPackageManagerUIのAPIが日々アプデされる状況において、リフレクションのみで対応を続けるのは苦しいものでした。<br>
<em>製作者が見ても意味のわからないコード、名前か引数が変わりエラーを吐き続けるAPI、直ったと思いきや別ベクトルから迫りくるデグレ...</em><br>
UnityやPackageManagerUIがマイナーアップデートする度にAPIは変更され、どこからか不具合が起き、改修を迫られ、心が折れかけました。<del>2019.3なんて中身ほとんど別モンやんけ！</del></p>

<p>そんな中、今回紹介した方法を使うことで、手軽にinternalにアクセスできるようになり、テストやソースコードの使いまわし（UnityEditor内部のMiniJsonを使ったり）が容易になり、生産性やコードの見通しが格段に改善され、お肌の調子も良くなりました。<br>
もし、<strong>あなたの近くでC#のリフレクションに苦しんでいるエンジニアを見かけましたら、そっと本記事のリンクをDMしてあげてください</strong>。</p>

<h2>
<span id="終わりに" class="fragment"></span><a href="#%E7%B5%82%E3%82%8F%E3%82%8A%E3%81%AB"><i class="fa fa-link"></i></a>終わりに</h2>

<p>最後に、本当に大事なことなので三回言いますが、<strong>internalな型やメンバは、ライブラリ製作者がライブラリ利用者に対して隠蔽したい項目であり、APIやドキュメントは一般的に非公開です</strong>。<br>
ライブラリ製作者は、決して意地悪でinternalを使っているのではありません。<br>
不用意にその型やメンバを扱うと、<strong>とんでもない結果になるかもしれない</strong>からinternalで隠蔽しているのかもしれません。<br>
internalな型やメンバは、<strong>「そうあるべき正当な理由があってinternalになっている」</strong>ということを理解した上、<del>くれぐれも自己責任で</del>活用してください。</p>

<p>皆様、よいUnityライフを！</p>

<h2>
<span id="1213-1500訂正" class="fragment"></span><a href="#1213-1500%E8%A8%82%E6%AD%A3"><i class="fa fa-link"></i></a>12/13 15:00訂正</h2>

<p></p><blockquote class="twitter-tweet">
<p>まぁ私もこないだまで知らなくて教えてもらったのですがが。vs-mefとかで投下されてて効果大らすぃ。 <a href="https://t.co/w6AzJoxK4y" rel="nofollow noopener" target="_blank"></a><a href="https://t.co/w6AzJoxK4y" class="autolink" rel="nofollow noopener" target="_blank">https://t.co/w6AzJoxK4y</a></p>— neuecc (@neuecc) <a href="https://twitter.com/neuecc/status/1205293945057468418?ref_src=twsrc%5Etfw" rel="nofollow noopener" target="_blank">December 13, 2019</a>
</blockquote> <script async src="https://platform.twitter.com/widgets.js"></script>

<p>Twitterで<a href="/neuecc" class="user-mention js-hovercard" title="neuecc" data-hovercard-target-type="user" data-hovercard-target-name="neuecc">@neuecc</a>様からリプライをいただいたのですが、リンク先の<strong>「*AllowPrivate」</strong>というワードが引っかかりました。<br>
<a href="https://github.com/microsoft/vs-streamjsonrpc/blob/master/src/StreamJsonRpc/SkipClrVisibilityChecks.cs" rel="nofollow noopener" target="_blank">参照しているソースコード</a>を読む限り、<code>IgnoresAccessChecksTo</code>以上のことはしていない様子...<br>
これらの事実から導き出される答えは...<br>
<strong><code>IgnoresAccessChecksTo</code>はprivateアクセスもできるということです！</strong><br>
よく見たら<a href="https://www.strathweb.com/2018/10/no-internalvisibleto-no-problem-bypassing-c-visibility-rules-with-roslyn/" rel="nofollow noopener" target="_blank">元記事</a>でもprivateアクセスしてた...</p>

<p>軽くテストしてみたところ、確かにIDE上ではprivateアクセスがエラーとして表示されましたが、InternalAccessCompilerではエラーなくコンパイルできていました。<br>
もちろん動作も問題ありませんでした。</p>

<p>具体的なワークフローの更新については別記事でまとめますので、もう少々お待ちくださいm(_ _)m。</p>

<p>※<a href="https://qiita.com/mob-sakai/items/a24780d68a6133be338f">12/26 続編でました</a></p>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Fmob-sakai%2Fitems%2Ff3bbc0c45abc31ea7ac0&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Fmob-sakai%2Fitems%2Ff3bbc0c45abc31ea7ac0&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/mob-sakai/items/f3bbc0c45abc31ea7ac0/likers" class="css-1iupg5d">96</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">64</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/f3bbc0c45abc31ea7ac0/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/mob-sakai/items/f3bbc0c45abc31ea7ac0/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/mob-sakai/items/f3bbc0c45abc31ea7ac0/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/mob-sakai/items/f3bbc0c45abc31ea7ac0/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/mob-sakai/items/f3bbc0c45abc31ea7ac0.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-6f59339c-06b4-4144-8a9f-34cabe026681">{"authorAnalyticsTrackingId":null,"organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-9b74e9d9-ab2a-419d-a327-a1b9b74702d9"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-9b74e9d9-ab2a-419d-a327-a1b9b74702d9">{}</script>
      
<div id="LoginModal-react-component-c28a6a47-6cbf-4782-bc6d-5701d7400cbe"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-c28a6a47-6cbf-4782-bc6d-5701d7400cbe">{}</script>
      
<div id="StockModal-react-component-14bc2e92-ae01-413b-ad62-f264d836defd"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-14bc2e92-ae01-413b-ad62-f264d836defd">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;OK4vXN4Ulo4lqPr/8o2udk+X3zL5uDnIuDCzCRHSBXWGu9+PGAfO/kZ0swGFaaqAH00YxG1WU+dTLZpj9127EA==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\u003cp\u003eこの記事は\u003ca href=\"https://qiita.com/advent-calendar/2019/unityforpro\"\u003e【unityプロ技】 Advent Calendar 2019\u003c/a\u003eの13日目の記事です。\u003cbr\u003e\nこの記事におけるソースコードは、全て\u003ccode\u003ePublic Domain\u003c/code\u003eです。\u003c/p\u003e\n\n\u003cp\u003e※\u003ca href=\"#1213-1500%E8%A8%82%E6%AD%A3\"\u003e12/13 15:00 訂正あり\u003c/a\u003e\u003cbr\u003e\n※\u003ca href=\"https://qiita.com/mob-sakai/items/a24780d68a6133be338f\" id=\"reference-6efe72efe9548bedd1b4\"\u003e12/26 続編でました\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"tldr\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#tldr\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eTL;DR\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003eC#には\u003ccode\u003eIgnoresAccessChecksToAttribute\u003c/code\u003eっていう隠された属性があるよ。ググってもほとんど情報出てこないよ。\u003c/li\u003e\n\u003cli\u003eこの属性を使えば、\u003cstrong\u003e任意の外部アセンブリのinternalの型やメンバに対して自由にアクセスできる\u003c/strong\u003eよ。ヤバいよ。\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eInternalsVisibleToAttribute\u003c/code\u003eや\u003ccode\u003eAssemblyDefinitionFile\u003c/code\u003eと組み合わせることで、\u003cstrong\u003eインテリセンスやブレークポイントも効く\u003c/strong\u003eよ。リフレクションより格段に便利だよ。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"おさらいinternalアクセス修飾子\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%8A%E3%81%95%E3%82%89%E3%81%84internal%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E4%BF%AE%E9%A3%BE%E5%AD%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eおさらい：internalアクセス修飾子\u003c/h2\u003e\n\n\u003cp\u003eC#には\u003ca href=\"https://docs.microsoft.com/ja-jp/dotnet/csharp/programming-guide/classes-and-structs/access-modifiers\" rel=\"nofollow noopener\" target=\"_blank\"\u003eアクセス修飾子\u003c/a\u003eと呼ばれる、型やメンバのアクセスを制限する仕組みがあります。\u003cbr\u003e\n例えばクラスAからクラスBのprivateメソッドを呼ぼうとすると、コンパイルの時点で怒られますし、VisualStudioやVisualStudio Code、Rider等といったIDEのインテリセンスには、候補すら出てきません。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003eerror CS0122: 'ApplicationTitleDescriptor' is inaccessible due to its protection level\nerror CS0117: 'EditorApplication' does not contain a definition for 'UpdateMainWindowTitle'\n...\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e今回取り上げる\u003ccode\u003einternal\u003c/code\u003eアクセスレベルは\u003ca href=\"https://docs.microsoft.com/ja-jp/dotnet/csharp/language-reference/keywords/internal\" rel=\"nofollow noopener\" target=\"_blank\"\u003e同一アセンブリ（=同じdll）内からのみアクセスできる\u003c/a\u003eアクセスレベルです。\u003cbr\u003e\nこのアクセスレベルを持つ型やメンバは、異なるアセンブリ（=別のdll）からは\u003cem\u003e基本的には\u003c/em\u003eアクセスできません。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"internalな型やメンバにアクセスするモチベーション\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#internal%E3%81%AA%E5%9E%8B%E3%82%84%E3%83%A1%E3%83%B3%E3%83%90%E3%81%AB%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%81%99%E3%82%8B%E3%83%A2%E3%83%81%E3%83%99%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003einternalな型やメンバにアクセスするモチベーション\u003c/h2\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003cem\u003einternalな型やメンバにアクセスする必要があるの？\u003cbr\u003e\n公開されている(publicな)APIだけで十分では？\u003cbr\u003e\n苦労してinternalな型やメンバにアクセスして、何がうれしいの？\u003c/em\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003einternalな型やメンバは、\u003cstrong\u003eライブラリ製作者がライブラリ利用者に対して隠蔽したい項目であり、APIやドキュメントは一般的に非公開\u003c/strong\u003eです。\u003cbr\u003e\n例えば、Unityに何らかのエディタ拡張を加えたい場合は、以下のような\u003ca href=\"https://docs.unity3d.com/ScriptReference/index.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eUnityが公開しているAPI(publicなAPI)\u003c/a\u003eの利用が基本です。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eメニューの実行：\u003ca href=\"https://docs.unity3d.com/ScriptReference/EditorApplication.ExecuteMenuItem.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eEditorApplication.ExecuteMenuItem\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003eアセットインポートの事前/事後処理：\u003ca href=\"https://docs.unity3d.com/ScriptReference/AssetPostprocessor.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eAssetPostprocessor\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003eインスペクタや自前ウィンドウの実装：\u003ca href=\"https://docs.unity3d.com/ScriptReference/EditorWindow.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eEditorWindow\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e次のフレームでアクションを実行する：\u003ca href=\"https://docs.unity3d.com/ScriptReference/EditorApplication-delayCall.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eEditorApplication.delayCall\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003eツールバーにメニューを追加する：\u003ca href=\"https://docs.unity3d.com/ScriptReference/MenuItem.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eMenuItem\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003eコンテキストメニューを追加する：\u003ca href=\"https://docs.unity3d.com/ScriptReference/ContextMenu.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eContextMenu\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003eコンパイル後にスクリプトを実行する：\u003ca href=\"https://docs.unity3d.com/ScriptReference/Callbacks.DidReloadScripts.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eCallbacks.DidReloadScripts\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003eパッケージマネージャUIの拡張：\u003ca href=\"https://docs.unity3d.com/ScriptReference/PackageManager.UI.IPackageManagerExtension.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003ePackageManager.UI.IPackageManagerExtension\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003eetc.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e御存知の通り、公開されているAPIだけでも\u003cem\u003e「出来ないことなんて何も無いんじゃないの？」\u003c/em\u003eと思えるほど大量の項目が見つかります。\u003cbr\u003e\nしかし、公開されていない（=非publicな）APIに目を向けると、\u003cstrong\u003eさらに多くの事が実現可能なことに気づきます\u003c/strong\u003e。\u003c/p\u003e\n\n\u003cp\u003e例えば、\u003ca href=\"http://baba-s.hatenablog.com/entry/2019/11/26/170000\" rel=\"nofollow noopener\" target=\"_blank\"\u003e【Unity】UIElements で Game ビューにテキストやボタンを追加するエディタ拡張のサンプル\u003c/a\u003e(\u003ca href=\"/baba_s\" class=\"user-mention js-hovercard\" title=\"baba_s\" data-hovercard-target-type=\"user\" data-hovercard-target-name=\"baba_s\"\u003e@baba_s\u003c/a\u003e様)では、リフレクションを利用して、\u003cstrong\u003eUnityが公開していない\u003c/strong\u003e\u003ca href=\"https://github.com/Unity-Technologies/UnityCsReference/blob/master/Editor/Mono/GameView/GameView.cs\" rel=\"nofollow noopener\" target=\"_blank\"\u003eGameView\u003c/a\u003eクラスへアクセスし、GameビューにオリジナルのGUIを追加しています。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eassembly\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003eEditorWindow\u003c/span\u003e \u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003eAssembly\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003etype\u003c/span\u003e     \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eassembly\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetType\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"s\"\u003e\"UnityEditor.GameView\"\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003egameview\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eEditorWindow\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetWindow\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003etype\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e...\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこのように、非publicなUnityの世界を知ることは、新しい気づきや便利な拡張機能のヒントになります。\u003cbr\u003e\nそして、あなたが発見した気づきや便利な拡張機能は、ほかの誰かのヒントになるかもしれません。\u003c/p\u003e\n\n\u003chr\u003e\n\n\u003cp\u003eただし、大事なことなので二回言いますが、\u003cstrong\u003einternalな型やメンバは、ライブラリ製作者がライブラリ利用者に対して隠蔽したい項目であり、APIやドキュメントは一般的に非公開\u003c/strong\u003eです。\u003cbr\u003e\nググって得られる情報は限定的ですし、無慈悲にもAPIは通告なく変更されます。\u003cbr\u003e\nIL化や難読化されていることは日常茶飯事で、誤って使えばフリーズする可能性すらあります。\u003cbr\u003e\nライブラリのライセンスによっては、明確に逆コンパイルやリバースエンジニアリングが禁止されています。\u003c/p\u003e\n\n\u003cp\u003eありがたいことに、\u003ca href=\"https://github.com/Unity-Technologies/UnityCsReference\" rel=\"nofollow noopener\" target=\"_blank\"\u003eUnityは公式でGitHubにソースコードを公開しています\u003c/a\u003e。internal要素も探し放題です。太っ腹だね！\u003c/p\u003e\n\n\u003cp\u003eさあ、実現したいことをキーワードにソースコードを検索し、\u003cem\u003eそれっぽい名前の\u003c/em\u003e APIを見つけ、注意深くソースコードを読み、拡張機能の幅を\u003cdel\u003eくれぐれも自己責任で\u003c/del\u003e広げましょう！\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"開発環境\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%96%8B%E7%99%BA%E7%92%B0%E5%A2%83\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e開発環境\u003c/h2\u003e\n\n\u003cp\u003e本記事では以下の環境でデモプロジェクトを開発しました。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003emacOS Mojave 10.14.6\u003c/li\u003e\n\u003cli\u003eUnity 2019.2.15f1\u003c/li\u003e\n\u003cli\u003eVisualStudio For Mac 8.3.8\u003c/li\u003e\n\u003cli\u003eDotNet Core 3.0.100\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eデモプロジェクトは以下のリポジトリで公開しています。\u003cbr\u003e\n\u003ca href=\"https://github.com/mob-sakai/MainWindowTitleModifierForUnity\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/mob-sakai/MainWindowTitleModifierForUnity\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"今回のデモでやること\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BB%8A%E5%9B%9E%E3%81%AE%E3%83%87%E3%83%A2%E3%81%A7%E3%82%84%E3%82%8B%E3%81%93%E3%81%A8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e今回のデモでやること\u003c/h2\u003e\n\n\u003cp\u003e今回は、\u003cstrong\u003eUnityエディタのタイトルバーのテキストを変更\u003c/strong\u003eしてみたいと思います。 \u003cbr\u003e\nタイトルバーに現在のブランチ名やゲームサーバの接続先環境名(sand/stag/prod等)を表示できると素敵ですよね。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/100534b3a967a3e97e52a8bb7693c189ce728fb4/68747470733a2f2f757365722d696d616765732e67697468756275736572636f6e74656e742e636f6d2f31323639303331352f37303631333032302d35306166316438302d316334622d313165612d393261612d3735626166646461336664652e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fuser-images.githubusercontent.com%2F12690315%2F70613020-50af1d80-1c4b-11ea-92aa-75bafdda3fde.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=19ee43f2489383775d61340c54e78d4d\" alt=\"\" data-canonical-src=\"https://user-images.githubusercontent.com/12690315/70613020-50af1d80-1c4b-11ea-92aa-75bafdda3fde.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fuser-images.githubusercontent.com%2F12690315%2F70613020-50af1d80-1c4b-11ea-92aa-75bafdda3fde.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=bdbae9d4d6755e1a695df5ea184455fb 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://github.com/Unity-Technologies/UnityCsReference/blob/master/Editor/Mono/EditorApplication.cs\" rel=\"nofollow noopener\" target=\"_blank\"\u003eソースコード\u003c/a\u003eを見たところ、Unity2019.2から追加されたinternalな型とメンバを使えば簡単に実現できそうです。\u003cbr\u003e\n具体的には、\u003ccode\u003eEditorApplication.updateMainWindowTitle\u003c/code\u003eイベントに新しいコールバックを追加し、\u003ccode\u003eEditorApplication.UpdateMainWindowTitle()\u003c/code\u003eを呼び出せば、タイトルバーのテキストを変更できそうです：\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// こんな感じで実装すれば実現できそう\u003c/span\u003e\n\u003cspan class=\"n\"\u003eAction\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eApplicationTitleDescriptor\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ecb\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etitle\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"なにかしらのエモいタイトル\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003eEditorApplication\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eupdateMainWindowTitle\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"n\"\u003ecb\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003eEditorApplication\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eUpdateMainWindowTitle\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"n\"\u003eEditorApplication\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eupdateMainWindowTitle\u003c/span\u003e \u003cspan class=\"p\"\u003e-=\u003c/span\u003e \u003cspan class=\"n\"\u003ecb\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003eupdateMainWindowTitle\u003c/code\u003e、\u003ccode\u003eUpdateMainWindowTitle\u003c/code\u003e、\u003ccode\u003eApplicationTitleDescriptor\u003c/code\u003eは全てinternalな型とメンバであり、このままでは当然コンパイルエラーになります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003eerror CS0122: 'ApplicationTitleDescriptor' is inaccessible due to its protection level\nerror CS0117: 'EditorApplication' does not contain a definition for 'UpdateMainWindowTitle'\n...\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eなんとかしてアクセスしてみましょう！\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"方法1reflection\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%96%B9%E6%B3%951reflection\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e【方法1】Reflection\u003c/h2\u003e\n\n\u003cp\u003epublicでない型やメンバにアクセスするための方法として、まず思いつくのは\u003ca href=\"https://docs.microsoft.com/ja-jp/dotnet/csharp/programming-guide/concepts/reflection\" rel=\"nofollow noopener\" target=\"_blank\"\u003eReflection(リフレクション)\u003c/a\u003eです。\u003cbr\u003e\nリフレクションにより、\u003cstrong\u003e文字列を使ってpublicでない型やメンバにも動的にアクセスできます\u003c/strong\u003e。\u003c/p\u003e\n\n\u003cp\u003eリフレクションの利点は、internalな型やメンバだけでなく、\u003cstrong\u003eprivateな型やメンバにもアクセスできる\u003c/strong\u003eことです。\u003cbr\u003e\nまた、有名であるが故に\u003cstrong\u003eググれば情報がたくさん\u003c/strong\u003eあり、\u003cstrong\u003eリフレクションだからこそできる事も多くあります\u003c/strong\u003e。\u003cbr\u003e\n\u003ca href=\"https://qiita.com/gushwell/items/91436bd1871586f6e663\" id=\"reference-e9232e259b337d129f60\"\u003eC#リフレクションTIPS 55連発\u003c/a\u003e(\u003ca href=\"/gushwell\" class=\"user-mention js-hovercard\" title=\"gushwell\" data-hovercard-target-type=\"user\" data-hovercard-target-name=\"gushwell\"\u003e@gushwell\u003c/a\u003e様)という一読すべき記事もあります。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"リフレクションを使ってinternalアクセスしてみる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%AA%E3%83%95%E3%83%AC%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6internal%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eリフレクションを使ってinternalアクセスしてみる\u003c/h4\u003e\n\n\u003cp\u003e実際にやりたいことは4行で済む内容でしたが、リフレクションで表現するとどうなるでしょうか？\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Linq\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eUnityEditor\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Reflection\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eMainWindowTitleModifier\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eSolution1_Reflection\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eMenuItem\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"MainWindowTitleModifier/Solution1_Reflection\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003epriority\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eUpdate\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// ApplicationTitleDescriptorのTypeを取得.\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eType\u003c/span\u003e \u003cspan class=\"n\"\u003etEditorApplication\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eEditorApplication\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eType\u003c/span\u003e \u003cspan class=\"n\"\u003etApplicationTitleDescriptor\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etEditorApplication\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAssembly\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFirst\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFullName\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e\"UnityEditor.ApplicationTitleDescriptor\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// 関係するイベントとメソッドのInfoを取得.\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eEventInfo\u003c/span\u003e \u003cspan class=\"n\"\u003eeiUpdateMainWindowTitle\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etEditorApplication\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetEvent\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"updateMainWindowTitle\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eBindingFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eStatic\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003eBindingFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNonPublic\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eMethodInfo\u003c/span\u003e \u003cspan class=\"n\"\u003emiUpdateMainWindowTitle\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etEditorApplication\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"UpdateMainWindowTitle\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eBindingFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eStatic\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003eBindingFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNonPublic\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// Action\u0026lt;object\u0026gt;をAction\u0026lt;ApplicationTitleDescriptor\u0026gt;に変換.\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eType\u003c/span\u003e \u003cspan class=\"n\"\u003edelegateType\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eAction\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u0026gt;).\u003c/span\u003e\u003cspan class=\"nf\"\u003eMakeGenericType\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etApplicationTitleDescriptor\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eMethodInfo\u003c/span\u003e \u003cspan class=\"n\"\u003emethodInfo\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003eAction\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eobject\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;)\u003c/span\u003e\u003cspan class=\"n\"\u003eUpdateMainWindowTitle\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003eMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eDelegate\u003c/span\u003e \u003cspan class=\"n\"\u003edel\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eDelegate\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateDelegate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edelegateType\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emethodInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// UpdateMainWindowTitleを呼び出す前後にイベントの追加/削除.\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eeiUpdateMainWindowTitle\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetAddMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eInvoke\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003eobject\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003edel\u003c/span\u003e \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n            \u003cspan class=\"n\"\u003emiUpdateMainWindowTitle\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eInvoke\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003eobject\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eeiUpdateMainWindowTitle\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetRemoveMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eInvoke\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003eobject\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003edel\u003c/span\u003e \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eUpdateMainWindowTitle\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eobject\u003c/span\u003e \u003cspan class=\"n\"\u003edesc\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// UnityEditor.ApplicationTitleDescriptor.title = \"Solution1_Reflection\"; と同様\u003c/span\u003e\n            \u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eEditorApplication\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003eAssembly\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFirst\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFullName\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e\"UnityEditor.ApplicationTitleDescriptor\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetField\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"title\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eBindingFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eInstance\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003eBindingFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePublic\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSetValue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edesc\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Solution1_Reflection\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eうーん、つらみ。。。\u003cbr\u003e\nやりたいことは単純なはずなのに、どうしてこうなった！って感じですね。\u003c/p\u003e\n\n\u003cp\u003eともあれ、\u003ccode\u003eMainWindowTitleModifier \u0026gt; Solution1_Reflection\u003c/code\u003eを実行すればタイトルバーのテキストを変えられるようになりました。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/da0ff1d4641dc1fc4eed873c4023894972236f1f/68747470733a2f2f757365722d696d616765732e67697468756275736572636f6e74656e742e636f6d2f31323639303331352f37303631353730312d33653833616530302d316335302d313165612d386139622d3636656230346162346363612e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fuser-images.githubusercontent.com%2F12690315%2F70615701-3e83ae00-1c50-11ea-8a9b-66eb04ab4cca.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=4e42b41b3ca585e6e9c59583c875a3a2\" alt=\"\" data-canonical-src=\"https://user-images.githubusercontent.com/12690315/70615701-3e83ae00-1c50-11ea-8a9b-66eb04ab4cca.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fuser-images.githubusercontent.com%2F12690315%2F70615701-3e83ae00-1c50-11ea-8a9b-66eb04ab4cca.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=474f9c594cda0032d5f2919e2e14221b 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"リフレクションの欠点\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%AA%E3%83%95%E3%83%AC%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E6%AC%A0%E7%82%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eリフレクションの欠点\u003c/h4\u003e\n\n\u003cp\u003eリフレクションの欠点は\u003cstrong\u003e生産性が低いことと、実行速度が遅いこと\u003c/strong\u003eです。\u003cbr\u003e\nやりたいことに対してやるべき準備が多く、IDEによるインテリセンスも効かないため、生産性はお世辞にも良くありません。\u003cbr\u003e\n\u003ca href=\"https://postd.cc/why-is-reflection-slow/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eなぜリフレクションは遅いのか\u003c/a\u003e(POSTD様)によると、静的な呼び出しと比べて\u003cstrong\u003e2〜3桁オーダーで実行速度が遅い\u003c/strong\u003eようです。\u003c/p\u003e\n\n\u003cp\u003e単純なメソッド呼び出しやsetter/getterについて、リフレクションを使う分には悩むことも少ないでしょう。\u003cbr\u003e\nジェネリック、コンストラクタ、in/out/ref/paramsキーワード、関数のオーバーロード、非publicな型を含む\u003ccode\u003eAction\u0026lt;T\u0026gt;\u003c/code\u003eや\u003ccode\u003eFunc\u0026lt;T\u0026gt;\u003c/code\u003e、event等、要素が複雑になると、だんだんと長く、ツラくなってきます。\u003cdel\u003eめげずに頑張ってググりましょう。\u003c/del\u003e\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"おまけリフレクションを効率化して使う\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%8A%E3%81%BE%E3%81%91%E3%83%AA%E3%83%95%E3%83%AC%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%92%E5%8A%B9%E7%8E%87%E5%8C%96%E3%81%97%E3%81%A6%E4%BD%BF%E3%81%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eおまけ：リフレクションを効率化して使う\u003c/h4\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003cstrong\u003e\u003ccode\u003eType\u003c/code\u003eや\u003ccode\u003eMemberInfo\u003c/code\u003eのインスタンスをDictionaryでキャッシュする\u003c/strong\u003e\n\n\u003cul\u003e\n\u003cli\u003e一度生成した\u003ccode\u003eType\u003c/code\u003eや\u003ccode\u003eMemberInfo\u003c/code\u003eのインスタンスを使いまわすことで、オーバーヘッドを回避します\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cstrong\u003eFindMethod、FindProperty等のメソッドをラップする\u003c/strong\u003e\n\n\u003cul\u003e\n\u003cli\u003ePublic/NonPublic、Instance/Staticを指定しなくても適切な\u003ccode\u003eMemberInfo\u003c/code\u003eを返すようなメソッドを作り、可読性を改善します\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cstrong\u003eアセンブリからではなく\u003ccode\u003estring\u003c/code\u003eから型を見つける\u003c/strong\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003eType.GetType(\"UnityEditor.ApplicationTitleDescriptor, UnityEditor\")\u003c/code\u003eのように、\u003ccode\u003eクラス名フルパス, アセンブリ名\u003c/code\u003eという文字列でも型を取得できます\u003c/li\u003e\n\u003cli\u003eこのときの文字列は\u003ccode\u003eType\u003c/code\u003eインスタンスを使って、\u003ccode\u003etype.AssemblyQualifiedName\u003c/code\u003eで取得できます\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cstrong\u003eデリゲート化、式木、IL Emit\u003c/strong\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"https://ufcpp.net/study/csharp/misc_dynamic.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003e[雑記] 動的コード生成のパフォーマンス\u003c/a\u003e(++C++; // 未確認飛行 C様)を参照してください\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"方法2internalsvisibletoattribute\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%96%B9%E6%B3%952internalsvisibletoattribute\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e【方法2】InternalsVisibleToAttribute\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003eInternalsVisibleToAttribute\u003c/code\u003eは、\u003cstrong\u003e特定のアセンブリに対して、自身のinternalアクセスを許可させる属性\u003c/strong\u003eです。\u003cbr\u003e\nアセンブリに対する単体テストや、機能拡張に使うことが多く、そういったアセンブリは\u003ca href=\"https://docs.microsoft.com/ja-jp/dotnet/standard/assembly/friend\" rel=\"nofollow noopener\" target=\"_blank\"\u003eフレンドアセンブリ\u003c/a\u003eと呼ばれます。\u003cbr\u003e\nこの属性の強力なところは、\u003cstrong\u003einternalな要素をそのまま記述でき、VisualStudioやVisualStudio Code、Rider等のIDEでインテリセンスやブレークポイントが有効になる\u003c/strong\u003eことです。\u003cbr\u003e\nテストコードを書くに当たり、IDEのサポートが得られるのはありがたいですね！\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/07f3f19273ef41e3d08c1bcc31b8a29b4729fb42/68747470733a2f2f757365722d696d616765732e67697468756275736572636f6e74656e742e636f6d2f31323639303331352f37303631363831392d61383034626330302d316335322d313165612d386561332d6532346639346636343637642e676966\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fuser-images.githubusercontent.com%2F12690315%2F70616819-a804bc00-1c52-11ea-8ea3-e24f94f6467d.gif?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=33665b6f79d8af5afee99ae48e00c73d\" alt=\"\" data-canonical-src=\"https://user-images.githubusercontent.com/12690315/70616819-a804bc00-1c52-11ea-8ea3-e24f94f6467d.gif\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fuser-images.githubusercontent.com%2F12690315%2F70616819-a804bc00-1c52-11ea-8ea3-e24f94f6467d.gif?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=a5079fcc17c841a554bd16c7b20a846e 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eさて、\u003ccode\u003eInternalsVisibleToAttribute\u003c/code\u003eは、UnityEngine.dllやUnityEditor.dllといった\u003cstrong\u003eUnity公式のライブラリにも存在します\u003c/strong\u003e。\u003cbr\u003e\n例えばUnityEditor.dllの\u003ca href=\"https://github.com/Unity-Technologies/UnityCsReference/blob/master/Editor/Mono/AssemblyInfo/AssemblyInfo.cs\" rel=\"nofollow noopener\" target=\"_blank\"\u003eAssemblyInfo.cs\u003c/a\u003eには次のように定義されています。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eassembly\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nf\"\u003eInternalsVisibleTo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Unity.LiveNotes\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eassembly\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nf\"\u003eInternalsVisibleTo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Unity.Burst\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eassembly\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nf\"\u003eInternalsVisibleTo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Unity.Burst.Editor\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eassembly\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nf\"\u003eInternalsVisibleTo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Unity.Cloud.Collaborate.Editor\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eassembly\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nf\"\u003eInternalsVisibleTo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Unity.CollabProxy.Editor\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eassembly\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nf\"\u003eInternalsVisibleTo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Unity.CollabProxy.EditorTests\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eassembly\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nf\"\u003eInternalsVisibleTo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Unity.CollabProxy.UI\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eassembly\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nf\"\u003eInternalsVisibleTo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Unity.CollabProxy.UI.Tests\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eassembly\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nf\"\u003eInternalsVisibleTo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Unity.CollabProxy.Client\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eassembly\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nf\"\u003eInternalsVisibleTo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Unity.CollabProxy.Client.Tests\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eassembly\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nf\"\u003eInternalsVisibleTo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"UnityEditor.Advertisements\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eassembly\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nf\"\u003eInternalsVisibleTo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Unity.PackageManager\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n\u003cspan class=\"p\"\u003e...\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//(以下、たくさんのInternalsVisibleToが羅列されている)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eassembly\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nf\"\u003eInternalsVisibleTo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Unity.InternalAPIEditorBridgeDev.001\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eassembly\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nf\"\u003eInternalsVisibleTo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Unity.InternalAPIEditorBridgeDev.002\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eassembly\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nf\"\u003eInternalsVisibleTo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Unity.InternalAPIEditorBridgeDev.003\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n\u003cspan class=\"p\"\u003e...\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれらの名前を持つアセンブリは、UnityEditor.dllのフレンドアセンブリです。\u003cbr\u003e\nよって、\u003cstrong\u003e上記の名前を持つアセンブリを生成できれば、UnityEditor.dllに対してinternalアクセスできます\u003c/strong\u003e。\u003cdel\u003eすっごーい！\u003c/del\u003e\u003c/p\u003e\n\n\u003cp\u003eUnityでアセンブリを生成するための仕組みといえば、\u003ca href=\"https://docs.unity3d.com/Manual/ScriptCompilationAssemblyDefinitionFiles.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eAssemblyDefinitionFile\u003c/a\u003eです。\u003cbr\u003e\n\u003ccode\u003eAssemblyDefinitionFile\u003c/code\u003eについては\u003ca href=\"/toRisouP\" class=\"user-mention js-hovercard\" title=\"toRisouP\" data-hovercard-target-type=\"user\" data-hovercard-target-name=\"toRisouP\"\u003e@toRisouP\u003c/a\u003e様が\u003ca href=\"https://qiita.com/toRisouP/items/d206af3029c7d80326ed\" id=\"reference-c1b2543d5a7f67229c61\"\u003eUnity Assembly Definition 完全に理解した\u003c/a\u003eにて詳しく解説されております。(こちらも\u003ca href=\"https://qiita.com/advent-calendar/2019/unityforpro\"\u003e【unityプロ技】 Advent Calendar 2019\u003c/a\u003eの記事です)\u003c/p\u003e\n\n\u003cp\u003eなお、\u003ccode\u003eAssemblyDefinitionFile\u003c/code\u003eによって生成されるアセンブリ名は、インスペクタ内の\u003ccode\u003eName\u003c/code\u003eフィールドで設定します。\u003cbr\u003e\n\u003cstrong\u003eアセット名ではない\u003c/strong\u003eことに注意しましょう。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"internalsvisibletoを使ってinternalアクセスしてみる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#internalsvisibleto%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6internal%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003eInternalsVisibleTo\u003c/code\u003eを使ってinternalアクセスしてみる\u003c/h4\u003e\n\n\u003cp\u003e適当な\u003ccode\u003eAssemblyDefinitionFile\u003c/code\u003eを作成し、インスペクタビューから\u003ccode\u003eName\u003c/code\u003eを変更しましょう。\u003cbr\u003e\nここでは、\u003ccode\u003eUnity.InternalAPIEditorBridgeDev.001\u003c/code\u003eという、実に\u003cstrong\u003eそれっぽい名前\u003c/strong\u003e(おそらくUnityの中の人がテストするためのアセンブリ名)を指定します。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/d44b27cd3e51f789db106e14a19c7b7bbbf66006/68747470733a2f2f757365722d696d616765732e67697468756275736572636f6e74656e742e636f6d2f31323639303331352f37303631373032352d30636330313638302d316335332d313165612d386538632d6137333432653961626435362e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fuser-images.githubusercontent.com%2F12690315%2F70617025-0cc01680-1c53-11ea-8e8c-a7342e9abd56.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=a2cc87fb0f35e98005c5a18510de1217\" alt=\"\" data-canonical-src=\"https://user-images.githubusercontent.com/12690315/70617025-0cc01680-1c53-11ea-8e8c-a7342e9abd56.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fuser-images.githubusercontent.com%2F12690315%2F70617025-0cc01680-1c53-11ea-8e8c-a7342e9abd56.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=783d8c3397b595ede79c41c975995e6a 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e次に、\u003ccode\u003eUnity.InternalAPIEditorBridgeDev.001.asmdef\u003c/code\u003eがあるディレクトリ以下に、次のようなスクリプト(\u003ccode\u003eSolution2_InternalsVisibleToAttribute.cs\u003c/code\u003e)を追加し、\u003ccode\u003eUnity.InternalAPIEditorBridgeDev.001\u003c/code\u003eアセンブリに組み込みましょう。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/9bef7783c6b1ca60e140e1a5ed9b374152f375ce/68747470733a2f2f757365722d696d616765732e67697468756275736572636f6e74656e742e636f6d2f31323639303331352f37303631373536302d33393238363238302d316335342d313165612d383338372d3831313234623530323234382e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fuser-images.githubusercontent.com%2F12690315%2F70617560-39286280-1c54-11ea-8387-81124b502248.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=98ef830250bd114a94c24528ceb08caa\" alt=\"\" data-canonical-src=\"https://user-images.githubusercontent.com/12690315/70617560-39286280-1c54-11ea-8387-81124b502248.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fuser-images.githubusercontent.com%2F12690315%2F70617560-39286280-1c54-11ea-8387-81124b502248.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=5b122167333f7e90b5eb4008cc524ed4 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eUnityEditor\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eMainWindowTitleModifier\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eSolution2_InternalsVisibleToAttribute\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eMenuItem\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"MainWindowTitleModifier/Solution2_InternalsVisibleToAttribute\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003epriority\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eUpdate\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eAction\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eApplicationTitleDescriptor\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ecb\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etitle\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Solution2_InternalsVisibleToAttribute\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eEditorApplication\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eupdateMainWindowTitle\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"n\"\u003ecb\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eEditorApplication\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eUpdateMainWindowTitle\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eEditorApplication\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eupdateMainWindowTitle\u003c/span\u003e \u003cspan class=\"p\"\u003e-=\u003c/span\u003e \u003cspan class=\"n\"\u003ecb\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eリフレクションが完全に消え、\u003ca href=\"#%E4%BB%8A%E5%9B%9E%E3%81%AE%E3%83%87%E3%83%A2%E3%81%A7%E3%82%84%E3%82%8B%E3%81%93%E3%81%A8\"\u003eイメージしたようなスッキリしたコード\u003c/a\u003eになりました！\u003cbr\u003e\n直接呼び出しになるので、実行速度も申し分ありませんし、IDEのサポート(インテリセンスやブレークポイント)によって格段に生産性が上がりました。\u003cbr\u003e\n\u003ccode\u003eMainWindowTitleModifier \u0026gt; Solution2_InternalsVisibleToAttribute\u003c/code\u003eを実行すれば、同様にタイトルバーのテキストを変えられます。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/95aac0d282ce70b88ee82f4cd9bc32029255efc5/68747470733a2f2f757365722d696d616765732e67697468756275736572636f6e74656e742e636f6d2f31323639303331352f37303631353730302d33653833616530302d316335302d313165612d396135652d3565666630656438643538392e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fuser-images.githubusercontent.com%2F12690315%2F70615700-3e83ae00-1c50-11ea-9a5e-5eff0ed8d589.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=b3f18a7640273740f60997d5c7c6ad10\" alt=\"\" data-canonical-src=\"https://user-images.githubusercontent.com/12690315/70615700-3e83ae00-1c50-11ea-9a5e-5eff0ed8d589.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fuser-images.githubusercontent.com%2F12690315%2F70615700-3e83ae00-1c50-11ea-9a5e-5eff0ed8d589.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=82095eec1ae721185e39cee18a1ff70c 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"internalsvisibletoの欠点\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#internalsvisibleto%E3%81%AE%E6%AC%A0%E7%82%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003eInternalsVisibleTo\u003c/code\u003eの欠点\u003c/h4\u003e\n\n\u003cp\u003e\u003ccode\u003eAssemblyDefinitionFile\u003c/code\u003eと\u003ccode\u003eInternalsVisibleToAttribute\u003c/code\u003eを使ったinternalアクセスは、非常に手軽な方法です。\u003cbr\u003e\nしかし、残念ながら、全てにおいて完璧とは言えません：\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003cstrong\u003eprivateアクセスができない\u003c/strong\u003e\n\n\u003cul\u003e\n\u003cli\u003e必要な場合、リフレクションを使ってください\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cstrong\u003eライブラリ側に\u003ccode\u003eInternalsVisibleToAttribute\u003c/code\u003eが定義されている必要がある\u003c/strong\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003cstrong\u003e「ライブラリ側に」\u003c/strong\u003e属性があることが条件です\u003c/li\u003e\n\u003cli\u003e例えばライブラリのアップデート等で、ライブラリ側から\u003ccode\u003eInternalsVisibleToAttribute\u003c/code\u003eが変更・削除されると、コンパイルエラーになります\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cstrong\u003eランタイムでは使用できない場面が多い\u003c/strong\u003e\n\n\u003cul\u003e\n\u003cli\u003eUnityEngine.dll等は、ビルド時に\u003ccode\u003eInternalsVisibleToAttribute\u003c/code\u003eが綺麗サッパリなくなります\u003c/li\u003e\n\u003cli\u003eこれは、エディタ用とは異なるランタイム用アセンブリが使用されるためです\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cstrong\u003eアセンブリ名が衝突するとエラー\u003c/strong\u003e\n\n\u003cul\u003e\n\u003cli\u003eパッケージを外部に公開する場合、誰かが同じフレンドアセンブリの名前を使い、アセンブリ名が衝突する可能性があります\u003c/li\u003e\n\u003cli\u003eこれは潜在的な不具合と言えます\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e難儀な欠点が多いですが、逆に言えば、\u003cstrong\u003eクローズドな環境でエディタ向けの機能を実装する\u003c/strong\u003eのであれば、この方法だけでも十分に使えそうです。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"方法3ignoresaccesscheckstoattribute\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%96%B9%E6%B3%953ignoresaccesscheckstoattribute\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e【方法3】IgnoresAccessChecksToAttribute\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003eIgnoresAccessChecksToAttribute\u003c/code\u003eは、ほとんど情報が出回っていない\u003cem\u003e（MSDNにも載ってない）\u003c/em\u003eミステリアスな属性です。\u003cbr\u003e\n私は\u003ca href=\"https://www.strathweb.com/2018/10/no-internalvisibleto-no-problem-bypassing-c-visibility-rules-with-roslyn/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eNo InternalsVisibleTo, no problem – bypassing C# visibility rules with Roslyn\u003c/a\u003eで偶然知りました。\u003cbr\u003e\n要約すると：\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003eInternalsVisibleToAttribute\u003c/code\u003eとは\u003cstrong\u003e逆の方向に作用する\u003c/strong\u003e。つまり、\u003cstrong\u003eライブラリ利用者側に設定することで、ライブラリに対するinternalアクセスを許可する\u003c/strong\u003e\n\u003c/li\u003e\n\u003cli\u003eフルネームは\u003ccode\u003eSystem.Runtime.CompilerServices.IgnoresAccessChecksToAttribute\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003eBase Class Libraryに載っていないが、ランタイム（CLR/CoreCLR）で作用する\u003c/li\u003e\n\u003cli\u003e\n\u003cstrong\u003e\u003ccode\u003ecsc.exe\u003c/code\u003eや\u003ccode\u003eMsBuild\u003c/code\u003eを使わずに自力で\u003c/strong\u003eコンパイルする際に、\u003ccode\u003eCSharpCompilationOptions.TopLevelBinderFlags\u003c/code\u003eに対して特定のフラグを立てると有効になる\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eつまり、\u003cstrong\u003eどんなライブラリに対してもinternalアクセスができるようになる、夢のような属性\u003c/strong\u003eってことですね！\u003cbr\u003e\nさっそく、この属性を使ってみましょう。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"ignoresaccesscheckstoattributeを使ってinternalアクセスしてみる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#ignoresaccesscheckstoattribute%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6internal%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003eIgnoresAccessChecksToAttribute\u003c/code\u003eを使ってinternalアクセスしてみる\u003c/h4\u003e\n\n\u003cp\u003e\u003ca href=\"https://www.strathweb.com/2018/10/no-internalvisibleto-no-problem-bypassing-c-visibility-rules-with-roslyn/\" rel=\"nofollow noopener\" target=\"_blank\"\u003e先述の記事\u003c/a\u003eにある通り、\u003ccode\u003eIgnoresAccessChecksToAttribute\u003c/code\u003eを使うには\u003cstrong\u003e\u003ccode\u003ecsc.exe\u003c/code\u003eや\u003ccode\u003eMsBuild\u003c/code\u003eを使わずに、自力でコンパイルする必要があります\u003c/strong\u003e。\u003cbr\u003e\n自力でコンパイルする方法を紹介しますが、正直めんどくさいです。\u003cbr\u003e\n興味のない方は「\u003ca href=\"#IgnoresAccessChecksTo%E3%81%AE%E6%BA%96%E5%82%99%E3%81%8C%E3%82%81%E3%82%93%E3%81%A9%E3%81%8F%E3%81%95%E3%81%84%E3%81%AE%E3%81%A7%E3%81%AA%E3%82%93%E3%81%A8%E3%81%8B%E3%81%99%E3%82%8B\"\u003eIgnoresAccessChecksToの準備がめんどくさいのでなんとかする\u003c/a\u003e」まで読み飛ばし推奨。\u003c/p\u003e\n\n\u003chr\u003e\n\n\u003cp\u003eまず、C#プロジェクトに以下のコードを追加します。\u003cbr\u003e\nこうすることで、\u003cstrong\u003e「UnityEditorアセンブリに対するアクセスレベルのチェックを無視する」\u003c/strong\u003eようにコンパイラが解釈できます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eassembly\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRuntime\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCompilerServices\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eIgnoresAccessChecksTo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"UnityEditor\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Runtime.CompilerServices\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eAttributeUsage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAttributeTargets\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAssembly\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eAllowMultiple\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n    \u003cspan class=\"k\"\u003einternal\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eIgnoresAccessChecksToAttribute\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAttribute\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eIgnoresAccessChecksToAttribute\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eassemblyName\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eAssemblyName\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eassemblyName\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eAssemblyName\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e次に、C#プロジェクトとは別に、\u003cstrong\u003e「アクセスチェックを無視できる」\u003c/strong\u003eコンパイラのプロジェクトを作ります。コードは以下の通りです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cs\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// あらかじめMicrosoft.CodeAnalysis.CSharpをnugetでインストールしておく\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eMicrosoft.CodeAnalysis\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eMicrosoft.CodeAnalysis.CSharp\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.IO\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Linq\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Reflection\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Text.RegularExpressions\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eInternalAccessibleCompiler\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eMain\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003einputCsProjPath\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eargs\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eoutputAsemblyPath\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eargs\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eoutputAsemblyName\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ePath\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetFileNameWithoutExtension\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eoutputAsemblyPath\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// C#プロジェクトを読み込みます.\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003ecsproj\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eFile\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReadAllLines\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003einputCsProjPath\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// dllとしてコンパイルさせるオプションを生成します.\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCSharpCompilationOptions\u003c/span\u003e \u003cspan class=\"n\"\u003ecompilationOptions\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eCSharpCompilationOptions\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eOutputKind\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDynamicallyLinkedLibrary\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWithMetadataImportOptions\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eMetadataImportOptions\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAll\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// BindingFlags.IgnoreAccessibility(1 \u0026lt;\u0026lt; 22)を有効化します.\u003c/span\u003e\n        \u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eCSharpCompilationOptions\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetProperty\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"TopLevelBinderFlags\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eBindingFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eInstance\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003eBindingFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNonPublic\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSetValue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecompilationOptions\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003euint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"m\"\u003e22\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// プロジェクトからアセンブリ参照一覧を取得→IEnumerable\u0026lt;PortableExecutableReference\u0026gt;に変換します.\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eRegex\u003c/span\u003e \u003cspan class=\"n\"\u003ereg_dll\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eRegex\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u0026lt;HintPath\u0026gt;(.*)\u0026lt;/HintPath\u0026gt;\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eRegexOptions\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCompiled\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eIEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ePortableExecutableReference\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003emetadataReferences\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecsproj\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSelect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eline\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ereg_dll\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eMatch\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eline\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWhere\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ematch\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ematch\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSuccess\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSelect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ematch\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ematch\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGroups\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSelect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epath\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eMetadataReference\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateFromFile\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// プロジェクトからシンボル一覧を取得→IEnumerable\u0026lt;string\u0026gt;に変換します.\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eRegex\u003c/span\u003e \u003cspan class=\"n\"\u003ereg_preprocessorSymbols\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eRegex\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u0026lt;DefineConstants\u0026gt;(.*)\u0026lt;/DefineConstants\u0026gt;\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eRegexOptions\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCompiled\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eIEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003epreprocessorSymbols\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecsproj\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSelect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eline\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ereg_preprocessorSymbols\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eMatch\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eline\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWhere\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ematch\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ematch\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSuccess\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSelectMany\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ematch\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ematch\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGroups\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSplit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sc\"\u003e';'\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// プロジェクトからソースコード一覧を取得→テキストとして読み込み→IEnumerable\u0026lt;SyntaxTree\u0026gt;に変換します.\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCSharpParseOptions\u003c/span\u003e \u003cspan class=\"n\"\u003eparserOption\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eCSharpParseOptions\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLanguageVersion\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLatest\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"n\"\u003epreprocessorSymbols\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003epreprocessorSymbols\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eRegex\u003c/span\u003e \u003cspan class=\"n\"\u003ereg_cs\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eRegex\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u0026lt;Compile Include=\\\"(.*\\\\.cs)\\\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eRegexOptions\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCompiled\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eIEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eSyntaxTree\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003esyntaxTrees\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecsproj\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSelect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eline\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ereg_cs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eMatch\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eline\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWhere\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ematch\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ematch\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSuccess\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSelect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ematch\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ematch\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGroups\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReplace\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sc\"\u003e'\\\\'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ePath\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDirectorySeparatorChar\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSelect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epath\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ePath\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCombine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003einputCsProjDir\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSelect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epath\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eCSharpSyntaxTree\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eParseText\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eFile\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReadAllText\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003eparserOption\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// コンパイルを実行し、dllを生成します.\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCSharpCompilation\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eoutputAsemblyName\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003esyntaxTrees\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emetadataReferences\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecompilationOptions\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEmit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eoutputAsemblyPath\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eなお、このコードはコンパイル対象が\u003cstrong\u003eUnityが生成したC#プロジェクトである\u003c/strong\u003eことを前提にしています。\u003cbr\u003e\n他のジェネレータで生成されたC#プロジェクトをコンパイルできないかもしれません。\u003cbr\u003e\n（きっと、おそらくMSBuildパッケージを使えばたぶん解決できます。）\u003c/p\u003e\n\n\u003cp\u003edotnetを使って実行し、以下のようにC#プロジェクトファイルと出力パスを指定すると、\u003cstrong\u003einternalアクセス可能なdll\u003c/strong\u003eを生成できます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"bash\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003edotnet run \u003cspan class=\"nt\"\u003e--\u003c/span\u003e C#プロジェクトパス 出力dllパス\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eなお、このコンパイラはnuget toolとしても公開しています。（オプションが若干違います）\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/e2114efc3c56110a73f3f75698de2da9364049f1/68747470733a2f2f757365722d696d616765732e67697468756275736572636f6e74656e742e636f6d2f31323639303331352f37303733313430312d66396463336438302d316434392d313165612d383166642d6237343366383736306536322e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fuser-images.githubusercontent.com%2F12690315%2F70731401-f9dc3d80-1d49-11ea-81fd-b743f8760e62.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=3c865e52507faa4ca5938dd3dc363239\" alt=\"\" data-canonical-src=\"https://user-images.githubusercontent.com/12690315/70731401-f9dc3d80-1d49-11ea-81fd-b743f8760e62.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fuser-images.githubusercontent.com%2F12690315%2F70731401-f9dc3d80-1d49-11ea-81fd-b743f8760e62.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=1f45a1d01d556af0dadd5b66094aa1d1 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://www.nuget.org/packages/InternalAccessibleCompiler/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://www.nuget.org/packages/InternalAccessibleCompiler/\u003c/a\u003e\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"ignoresaccesscheckstoの準備がめんどくさいのでなんとかする\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#ignoresaccesschecksto%E3%81%AE%E6%BA%96%E5%82%99%E3%81%8C%E3%82%81%E3%82%93%E3%81%A9%E3%81%8F%E3%81%95%E3%81%84%E3%81%AE%E3%81%A7%E3%81%AA%E3%82%93%E3%81%A8%E3%81%8B%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003eIgnoresAccessChecksTo\u003c/code\u003eの準備がめんどくさいのでなんとかする\u003c/h4\u003e\n\n\u003cp\u003e\u003ccode\u003eIgnoresAccessChecksTo\u003c/code\u003eをUnityで使うには準備がめんどくさいです。\u003cbr\u003e\n今回は、先述のコンパイラを同梱済みの\u003ca href=\"https://github.com/mob-sakai/InternalAccessibleCompilerForUnity\" rel=\"nofollow noopener\" target=\"_blank\"\u003eUnity向けに公開しているパッケージ\u003c/a\u003eを使います。\u003cbr\u003e\n（デモプロジェクトには既にインストールされています。）\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eこのパッケージには\u003ccode\u003edotnet 2.1\u003c/code\u003e以上が必要です\n\n\u003cul\u003e\n\u003cli\u003eコマンドプロンプト(Windows)やターミナル(Mac)で、\u003ccode\u003edotnet --version\u003c/code\u003eを実行したときに、\u003ccode\u003e2.1.xxx\u003c/code\u003e以上が表示されていればインストール不要です\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://dotnet.microsoft.com/download\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://dotnet.microsoft.com/download\u003c/a\u003e からインストールしてください\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003emanifest.jsonの\u003ccode\u003edependencies\u003c/code\u003eに\u003ccode\u003e\"com.coffee.internal-accessible-compiler\": \"https://github.com/mob-sakai/InternalAccessibleCompilerForUnity.git\"\u003c/code\u003eを追加し、パッケージをインストールします\u003c/li\u003e\n\u003cli\u003eプロジェクトビューで\u003ccode\u003eMainWindowTitleModifier.asmdef\u003c/code\u003eを選択し、コンテキストメニュー(右クリック)から\u003ccode\u003eInternal Accessible Compiler \u0026gt; Setting\u003c/code\u003eをクリックします\n\u003ca href=\"https://camo.qiitausercontent.com/90f1f1ee9dacd98b51b2654b74938b701ea873d6/68747470733a2f2f757365722d696d616765732e67697468756275736572636f6e74656e742e636f6d2f31323639303331352f37303732383138322d34396238303630302d316434342d313165612d396566372d3966323730393730326238312e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fuser-images.githubusercontent.com%2F12690315%2F70728182-49b80600-1d44-11ea-9ef7-9f2709702b81.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=a0d82e46c60462bfef34b60965407ed2\" alt=\"\" data-canonical-src=\"https://user-images.githubusercontent.com/12690315/70728182-49b80600-1d44-11ea-9ef7-9f2709702b81.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fuser-images.githubusercontent.com%2F12690315%2F70728182-49b80600-1d44-11ea-9ef7-9f2709702b81.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=e5c7bec72625cde257d54c82e96ef7ec 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e開いたウィンドウで、以下のように入力します\n\n\u003cul\u003e\n\u003cli\u003eAssembly Names To Access: \u003ccode\u003eUnityEditor\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003eOutput Dll Path: \u003ccode\u003eAssets/Editor/Solution3.IgnoresAccessChecksToAttribute/MainWindowTitleModifier.dll\u003c/code\u003e\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/8122e33a0873be8286f0f9a78ba384711eddcba6/68747470733a2f2f757365722d696d616765732e67697468756275736572636f6e74656e742e636f6d2f31323639303331352f37303733323335312d61353339633230302d316434622d313165612d393231382d3939313636666262653930322e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fuser-images.githubusercontent.com%2F12690315%2F70732351-a539c200-1d4b-11ea-9218-99166fbbe902.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=974ad9b5204adba2f639b95aa3da903e\" alt=\"\" data-canonical-src=\"https://user-images.githubusercontent.com/12690315/70732351-a539c200-1d4b-11ea-9218-99166fbbe902.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fuser-images.githubusercontent.com%2F12690315%2F70732351-a539c200-1d4b-11ea-9218-99166fbbe902.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=9b41f1e1874d4ff962a826225da0ec93 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eCompile\u003c/code\u003eをクリックし、dllにコンパイルします\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003e\u003ccode\u003eAssemblyDefinitionFile\u003c/code\u003eやソースコードは、\u003ca href=\"#%E6%96%B9%E6%B3%952internalsvisibletoattribute\"\u003e【方法2】InternalsVisibleTo\u003c/a\u003eとアセンブリ名やクラス名が被らないようにする以外、ほとんど同じです。\u003cbr\u003e\nコンパイルが完了すると、\u003ccode\u003eMainWindowTitleModifier.dll\u003c/code\u003eが生成されます。\u003cbr\u003e\nこのままでは同じ名前を持つ\u003ccode\u003eMenuItem\u003c/code\u003eが衝突してしまうので、\u003ccode\u003eMainWindowTitleModifier.asmdef\u003c/code\u003eの\u003ccode\u003eDefine Constraints\u003c/code\u003eに適当な文字列を入力して、インポートされないようにしておきましょう。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/6d2edcc695b8de3edab53cf45c37db75c7063a16/68747470733a2f2f757365722d696d616765732e67697468756275736572636f6e74656e742e636f6d2f31323639303331352f37303631343339352d64323037616638302d316334642d313165612d386330612d3037656564666634396661652e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fuser-images.githubusercontent.com%2F12690315%2F70614395-d207af80-1c4d-11ea-8c0a-07eedff49fae.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=cd40d30947019ec1a98679069ccfcac3\" alt=\"\" data-canonical-src=\"https://user-images.githubusercontent.com/12690315/70614395-d207af80-1c4d-11ea-8c0a-07eedff49fae.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fuser-images.githubusercontent.com%2F12690315%2F70614395-d207af80-1c4d-11ea-8c0a-07eedff49fae.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=b2759a10dab44789f1222d8420ba01a0 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eMainWindowTitleModifier.dll\u003c/code\u003eのインポート後、\u003ccode\u003eMainWindowTitleModifier \u0026gt; Solution3_IgnoresAccessChecksToAttribute\u003c/code\u003eを実行すれば、タイトルバーのテキストを変えられます。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/d558ce19e7ab2f64b003d1a4960626b240ef2390/68747470733a2f2f757365722d696d616765732e67697468756275736572636f6e74656e742e636f6d2f31323639303331352f37303631353639392d33646562313738302d316335302d313165612d393361312d3264313136666262626161382e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fuser-images.githubusercontent.com%2F12690315%2F70615699-3deb1780-1c50-11ea-93a1-2d116fbbbaa8.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=d695b23c79986cf77eea44b7add1691c\" alt=\"\" data-canonical-src=\"https://user-images.githubusercontent.com/12690315/70615699-3deb1780-1c50-11ea-93a1-2d116fbbbaa8.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fuser-images.githubusercontent.com%2F12690315%2F70615699-3deb1780-1c50-11ea-93a1-2d116fbbbaa8.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=f5155b19fb9b5460b0b1871eedc9a04d 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"ignoresaccesscheckstoの欠点\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#ignoresaccesschecksto%E3%81%AE%E6%AC%A0%E7%82%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003eIgnoresAccessChecksTo\u003c/code\u003eの欠点\u003c/h4\u003e\n\n\u003cp\u003e\u003cstrong\u003eどんなアセンブリに対してもinternalアクセスができる\u003c/strong\u003eため、この方法は非常に強力です。\u003cbr\u003e\n\u003ca href=\"#internalsvisibleto%E3%81%AE%E6%AC%A0%E7%82%B9\"\u003e【方法2】InternalsVisibleToの欠点\u003c/a\u003eも少し克服していますが、それでも完璧ではありません：\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003cstrong\u003eprivateアクセスができない\u003c/strong\u003e\n\n\u003cul\u003e\n\u003cli\u003e必要な場合、やはりリフレクションを使ってください\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cstrong\u003e使うためにはコンパイルする必要がある\u003c/strong\u003e\n\n\u003cul\u003e\n\u003cli\u003eコンパイルという手間が発生します\u003c/li\u003e\n\u003cli\u003e自動化するなり、運用でカバーしましょう\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cstrong\u003eコード内で\u003ccode\u003eUNITY_2019\u003c/code\u003e等のシンボルを使う場合、各バージョンのdll生成が必要\u003c/strong\u003e\n\n\u003cul\u003e\n\u003cli\u003eコード内のシンボルは上記コンパイルの際に解決されます\u003c/li\u003e\n\u003cli\u003eそのため、UnityのバージョンアップでAPIが変更されると、\u003cstrong\u003eAPIのバージョン毎にdllを複数生成する\u003c/strong\u003e必要があります\u003c/li\u003e\n\u003cli\u003e生成したdllのインポート設定の\u003ccode\u003eDefine Constraints\u003c/code\u003eから、特定のバージョンのdllのみをインポートするようにしましょう\u003c/li\u003e\n\u003cli\u003e自動化するなり、運用でカバーしましょう\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"これまで紹介したinternal要素へのアクセス方法まとめ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%93%E3%82%8C%E3%81%BE%E3%81%A7%E7%B4%B9%E4%BB%8B%E3%81%97%E3%81%9Finternal%E8%A6%81%E7%B4%A0%E3%81%B8%E3%81%AE%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E6%96%B9%E6%B3%95%E3%81%BE%E3%81%A8%E3%82%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eこれまで紹介したinternal要素へのアクセス方法まとめ\u003c/h2\u003e\n\n\u003cp\u003e今回は外部アセンブリからinternalアクセスする方法を3つ紹介しました。\u003c/p\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e方法\u003c/th\u003e\n\u003cth\u003e利点\u003c/th\u003e\n\u003cth\u003e欠点\u003c/th\u003e\n\u003cth\u003eprivate\u003cbr\u003eアクセス\u003c/th\u003e\n\u003cth\u003e生産性\u003c/th\u003e\n\u003cth\u003e実行速度\u003c/th\u003e\n\u003cth\u003eランタイム\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ca href=\"#%E6%96%B9%E6%B3%951reflection\"\u003e【方法1】\u003cbr\u003eReflection\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e\n\u003cimg alt=\":thumbsup:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/1f44d.png\" title=\":thumbsup:\" width=\"20\" loading=\"lazy\"\u003e情報がたくさんある\u003cbr\u003e\u003cimg alt=\":thumbsup:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/1f44d.png\" title=\":thumbsup:\" width=\"20\" loading=\"lazy\"\u003eprivateアクセス可\u003c/td\u003e\n\u003ctd\u003e\n\u003cimg alt=\":thumbsdown:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/1f44e.png\" title=\":thumbsdown:\" width=\"20\" loading=\"lazy\"\u003eコードの可読性・保守性が低い\u003cbr\u003e\u003cimg alt=\":thumbsdown:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/1f44e.png\" title=\":thumbsdown:\" width=\"20\" loading=\"lazy\"\u003e低速な実行速度\u003cbr\u003e\u003cimg alt=\":thumbsdown:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/1f44e.png\" title=\":thumbsdown:\" width=\"20\" loading=\"lazy\"\u003eインテリセンスが無効\u003c/td\u003e\n\u003ctd\u003e\u003cimg alt=\":white_check_mark:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/2705.png\" title=\":white_check_mark:\" width=\"20\" loading=\"lazy\"\u003e\u003c/td\u003e\n\u003ctd\u003e\u003cimg alt=\":ng:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/1f196.png\" title=\":ng:\" width=\"20\" loading=\"lazy\"\u003e\u003c/td\u003e\n\u003ctd\u003e\u003cimg alt=\":ng:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/1f196.png\" title=\":ng:\" width=\"20\" loading=\"lazy\"\u003e\u003c/td\u003e\n\u003ctd\u003e\u003cimg alt=\":white_check_mark:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/2705.png\" title=\":white_check_mark:\" width=\"20\" loading=\"lazy\"\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ca href=\"#%E6%96%B9%E6%B3%952internalsvisibletoattribute\"\u003e【方法2】\u003cbr\u003eInternalsVisibleTo\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e\n\u003cimg alt=\":thumbsup:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/1f44d.png\" title=\":thumbsup:\" width=\"20\" loading=\"lazy\"\u003e手軽\u003cbr\u003e\u003cimg alt=\":thumbsup:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/1f44d.png\" title=\":thumbsup:\" width=\"20\" loading=\"lazy\"\u003eインテリセンスが有効\u003cbr\u003e\u003cimg alt=\":thumbsup:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/1f44d.png\" title=\":thumbsup:\" width=\"20\" loading=\"lazy\"\u003e高速な実行速度\u003c/td\u003e\n\u003ctd\u003e\n\u003cimg alt=\":thumbsdown:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/1f44e.png\" title=\":thumbsdown:\" width=\"20\" loading=\"lazy\"\u003eprivateアクセス不可\u003cbr\u003e\u003cimg alt=\":thumbsdown:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/1f44e.png\" title=\":thumbsdown:\" width=\"20\" loading=\"lazy\"\u003eアセンブリ名が被るとエラー\u003cbr\u003e\u003cimg alt=\":thumbsdown:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/1f44e.png\" title=\":thumbsdown:\" width=\"20\" loading=\"lazy\"\u003eライブラリ側に属性が必要\u003c/td\u003e\n\u003ctd\u003e\u003cimg alt=\":ng:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/1f196.png\" title=\":ng:\" width=\"20\" loading=\"lazy\"\u003e\u003c/td\u003e\n\u003ctd\u003e\u003cimg alt=\":white_check_mark:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/2705.png\" title=\":white_check_mark:\" width=\"20\" loading=\"lazy\"\u003e\u003c/td\u003e\n\u003ctd\u003e\u003cimg alt=\":white_check_mark:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/2705.png\" title=\":white_check_mark:\" width=\"20\" loading=\"lazy\"\u003e\u003c/td\u003e\n\u003ctd\u003e\u003cimg alt=\":ng:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/1f196.png\" title=\":ng:\" width=\"20\" loading=\"lazy\"\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ca href=\"#%E6%96%B9%E6%B3%953ignoresaccesscheckstoattribute\"\u003e【方法3】\u003cbr\u003eIgnoresAccessChecksTo\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e\n\u003cimg alt=\":thumbsup:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/1f44d.png\" title=\":thumbsup:\" width=\"20\" loading=\"lazy\"\u003eprivateアクセス可\u003cbr\u003e\u003cimg alt=\":thumbsup:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/1f44d.png\" title=\":thumbsup:\" width=\"20\" loading=\"lazy\"\u003eどんなライブラリに対しても有効\u003cbr\u003e\u003cimg alt=\":thumbsup:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/1f44d.png\" title=\":thumbsup:\" width=\"20\" loading=\"lazy\"\u003eインテリセンスが有効\u003cbr\u003e\u003cimg alt=\":thumbsup:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/1f44d.png\" title=\":thumbsup:\" width=\"20\" loading=\"lazy\"\u003e高速な実行速度\u003c/td\u003e\n\u003ctd\u003e\n\u003cimg alt=\":thumbsdown:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/1f44e.png\" title=\":thumbsdown:\" width=\"20\" loading=\"lazy\"\u003e自力コンパイルが必要\u003cbr\u003e\u003cimg alt=\":thumbsdown:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/1f44e.png\" title=\":thumbsdown:\" width=\"20\" loading=\"lazy\"\u003eシンボルの取り扱いに注意が必要\u003c/td\u003e\n\u003ctd\u003e\u003cimg alt=\":white_check_mark:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/2705.png\" title=\":white_check_mark:\" width=\"20\" loading=\"lazy\"\u003e\u003c/td\u003e\n\u003ctd\u003e\u003cimg alt=\":white_check_mark:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/2705.png\" title=\":white_check_mark:\" width=\"20\" loading=\"lazy\"\u003e\u003c/td\u003e\n\u003ctd\u003e\u003cimg alt=\":white_check_mark:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/2705.png\" title=\":white_check_mark:\" width=\"20\" loading=\"lazy\"\u003e\u003c/td\u003e\n\u003ctd\u003e\u003cimg alt=\":white_check_mark:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/2705.png\" title=\":white_check_mark:\" width=\"20\" loading=\"lazy\"\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003cp\u003e以下は、パッケージマネージャのUIを拡張するパッケージ、\u003ca href=\"https://github.com/mob-sakai/UpmGitExtension\" rel=\"nofollow noopener\" target=\"_blank\"\u003eUpmGitExtension\u003c/a\u003eを実装した際のワークフローです。\u003cbr\u003e\n（実際にはdll生成の工程を自動化したり、\u003ccode\u003eAssemblyDefinitionFile\u003c/code\u003eの参照関係を整理したり、dllを生成するために使ったディレクトリをパッケージからパージしてます。）\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e一旦、手軽な方法である\u003ca href=\"#%E6%96%B9%E6%B3%952internalsvisibletoattribute\"\u003e【方法2】InternalsVisibleTo\u003c/a\u003eで実装する\n\n\u003cul\u003e\n\u003cli\u003e後でパージしやすいように、パッケージディレクトリに専用のディレクトリを作っておく\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cstrong\u003eパッケージを公開する前\u003c/strong\u003eに\u003ca href=\"#%E6%96%B9%E6%B3%953ignoresaccesscheckstoattribute\"\u003e【方法3】IgnoresAccessChecksTo\u003c/a\u003eでdllを生成する\n\n\u003cul\u003e\n\u003cli\u003enugetに公開している\u003ca href=\"https://www.nuget.org/packages/InternalAccessibleCompiler/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eInternalAccessibleCompiler\u003c/a\u003eとシェルスクリプトで一括処理\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eパッケージから「dllを生成するために使ったディレクトリ」をパージし、公開\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003e.npmignore\u003c/code\u003eにディレクトリを記載しておき、\u003ccode\u003enpm pack\u003c/code\u003eしてパージする\u003c/li\u003e\n\u003cli\u003epackしたものはnpmレジストリにそのまま公開できる\u003c/li\u003e\n\u003cli\u003epackしたものを展開し、upmブランチにプッシュする\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eどうしてもprivateアクセスが必要な場面は\u003ca href=\"#%E6%96%B9%E6%B3%951reflection\"\u003e【方法1】Reflection\u003c/a\u003eを使う\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"https://github.com/mob-sakai/UpmGitExtension/blob/preview/Packages/com.coffee.upm-git-extension/Editor/InternalBridge/Expose.cs\" rel=\"nofollow noopener\" target=\"_blank\"\u003eExpose\u003c/a\u003eクラスのような、リフレクション機能をラップするクラスを作っておくと楽\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eExpose.FromType(typeof(EditorApplication)).Call(\"UpdateMainWindowTitle\");\u003c/code\u003eのように呼び出せる\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"雑記\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%9B%91%E8%A8%98\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e雑記\u003c/h2\u003e\n\n\u003cp\u003eUpmGitExtensionの実装において、internal要素へのアクセスは必須事項でした。\u003cbr\u003e\nUnityやPackageManagerUIのAPIが日々アプデされる状況において、リフレクションのみで対応を続けるのは苦しいものでした。\u003cbr\u003e\n\u003cem\u003e製作者が見ても意味のわからないコード、名前か引数が変わりエラーを吐き続けるAPI、直ったと思いきや別ベクトルから迫りくるデグレ...\u003c/em\u003e\u003cbr\u003e\nUnityやPackageManagerUIがマイナーアップデートする度にAPIは変更され、どこからか不具合が起き、改修を迫られ、心が折れかけました。\u003cdel\u003e2019.3なんて中身ほとんど別モンやんけ！\u003c/del\u003e\u003c/p\u003e\n\n\u003cp\u003eそんな中、今回紹介した方法を使うことで、手軽にinternalにアクセスできるようになり、テストやソースコードの使いまわし（UnityEditor内部のMiniJsonを使ったり）が容易になり、生産性やコードの見通しが格段に改善され、お肌の調子も良くなりました。\u003cbr\u003e\nもし、\u003cstrong\u003eあなたの近くでC#のリフレクションに苦しんでいるエンジニアを見かけましたら、そっと本記事のリンクをDMしてあげてください\u003c/strong\u003e。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"終わりに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%B5%82%E3%82%8F%E3%82%8A%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e終わりに\u003c/h2\u003e\n\n\u003cp\u003e最後に、本当に大事なことなので三回言いますが、\u003cstrong\u003einternalな型やメンバは、ライブラリ製作者がライブラリ利用者に対して隠蔽したい項目であり、APIやドキュメントは一般的に非公開です\u003c/strong\u003e。\u003cbr\u003e\nライブラリ製作者は、決して意地悪でinternalを使っているのではありません。\u003cbr\u003e\n不用意にその型やメンバを扱うと、\u003cstrong\u003eとんでもない結果になるかもしれない\u003c/strong\u003eからinternalで隠蔽しているのかもしれません。\u003cbr\u003e\ninternalな型やメンバは、\u003cstrong\u003e「そうあるべき正当な理由があってinternalになっている」\u003c/strong\u003eということを理解した上、\u003cdel\u003eくれぐれも自己責任で\u003c/del\u003e活用してください。\u003c/p\u003e\n\n\u003cp\u003e皆様、よいUnityライフを！\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"1213-1500訂正\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#1213-1500%E8%A8%82%E6%AD%A3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e12/13 15:00訂正\u003c/h2\u003e\n\n\u003cp\u003e\u003c/p\u003e\u003cblockquote class=\"twitter-tweet\"\u003e\n\u003cp\u003eまぁ私もこないだまで知らなくて教えてもらったのですがが。vs-mefとかで投下されてて効果大らすぃ。 \u003ca href=\"https://t.co/w6AzJoxK4y\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003c/a\u003e\u003ca href=\"https://t.co/w6AzJoxK4y\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://t.co/w6AzJoxK4y\u003c/a\u003e\u003c/p\u003e— neuecc (@neuecc) \u003ca href=\"https://twitter.com/neuecc/status/1205293945057468418?ref_src=twsrc%5Etfw\" rel=\"nofollow noopener\" target=\"_blank\"\u003eDecember 13, 2019\u003c/a\u003e\n\u003c/blockquote\u003e \u003cscript async src=\"https://platform.twitter.com/widgets.js\"\u003e\u003c/script\u003e\n\n\u003cp\u003eTwitterで\u003ca href=\"/neuecc\" class=\"user-mention js-hovercard\" title=\"neuecc\" data-hovercard-target-type=\"user\" data-hovercard-target-name=\"neuecc\"\u003e@neuecc\u003c/a\u003e様からリプライをいただいたのですが、リンク先の\u003cstrong\u003e「*AllowPrivate」\u003c/strong\u003eというワードが引っかかりました。\u003cbr\u003e\n\u003ca href=\"https://github.com/microsoft/vs-streamjsonrpc/blob/master/src/StreamJsonRpc/SkipClrVisibilityChecks.cs\" rel=\"nofollow noopener\" target=\"_blank\"\u003e参照しているソースコード\u003c/a\u003eを読む限り、\u003ccode\u003eIgnoresAccessChecksTo\u003c/code\u003e以上のことはしていない様子...\u003cbr\u003e\nこれらの事実から導き出される答えは...\u003cbr\u003e\n\u003cstrong\u003e\u003ccode\u003eIgnoresAccessChecksTo\u003c/code\u003eはprivateアクセスもできるということです！\u003c/strong\u003e\u003cbr\u003e\nよく見たら\u003ca href=\"https://www.strathweb.com/2018/10/no-internalvisibleto-no-problem-bypassing-c-visibility-rules-with-roslyn/\" rel=\"nofollow noopener\" target=\"_blank\"\u003e元記事\u003c/a\u003eでもprivateアクセスしてた...\u003c/p\u003e\n\n\u003cp\u003e軽くテストしてみたところ、確かにIDE上ではprivateアクセスがエラーとして表示されましたが、InternalAccessCompilerではエラーなくコンパイルできていました。\u003cbr\u003e\nもちろん動作も問題ありませんでした。\u003c/p\u003e\n\n\u003cp\u003e具体的なワークフローの更新については別記事でまとめますので、もう少々お待ちくださいm(_ _)m。\u003c/p\u003e\n\n\u003cp\u003e※\u003ca href=\"https://qiita.com/mob-sakai/items/a24780d68a6133be338f\"\u003e12/26 続編でました\u003c/a\u003e\u003c/p\u003e\n","createdAt":"2019-12-12T17:31:27Z","elapsedYearsFromLastModifiedAt":1,"encryptedId":"xkAXKJluQyrEPm1ACi8dDQrFl4YosEHLFA==--OenM4UbscFNWs1iN--q44n7SIA2R8hJOxwqBhiuw==","isBanned":false,"isDeprecated":true,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2019-12-26T06:27:04Z","likesCount":96,"linkUrl":"https://qiita.com/mob-sakai/items/f3bbc0c45abc31ea7ac0","organization":null,"originalId":1109605,"stockedCount":64,"title":"【Unity, C#】internalな型やメンバにアクセスするには、多分これが一番早いと思います","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#tldr\"\u003eTL;DR\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%8A%E3%81%95%E3%82%89%E3%81%84internal%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E4%BF%AE%E9%A3%BE%E5%AD%90\"\u003eおさらい：internalアクセス修飾子\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#internal%E3%81%AA%E5%9E%8B%E3%82%84%E3%83%A1%E3%83%B3%E3%83%90%E3%81%AB%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%81%99%E3%82%8B%E3%83%A2%E3%83%81%E3%83%99%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3\"\u003einternalな型やメンバにアクセスするモチベーション\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E9%96%8B%E7%99%BA%E7%92%B0%E5%A2%83\"\u003e開発環境\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%BB%8A%E5%9B%9E%E3%81%AE%E3%83%87%E3%83%A2%E3%81%A7%E3%82%84%E3%82%8B%E3%81%93%E3%81%A8\"\u003e今回のデモでやること\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%96%B9%E6%B3%951reflection\"\u003e【方法1】Reflection\u003c/a\u003e\n\u003cul\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%AA%E3%83%95%E3%83%AC%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6internal%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B\"\u003eリフレクションを使ってinternalアクセスしてみる\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%AA%E3%83%95%E3%83%AC%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E6%AC%A0%E7%82%B9\"\u003eリフレクションの欠点\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%8A%E3%81%BE%E3%81%91%E3%83%AA%E3%83%95%E3%83%AC%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%92%E5%8A%B9%E7%8E%87%E5%8C%96%E3%81%97%E3%81%A6%E4%BD%BF%E3%81%86\"\u003eおまけ：リフレクションを効率化して使う\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cli\u003e\n\u003ca href=\"#%E6%96%B9%E6%B3%952internalsvisibletoattribute\"\u003e【方法2】InternalsVisibleToAttribute\u003c/a\u003e\n\u003cul\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#internalsvisibleto%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6internal%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B\"\u003eInternalsVisibleToを使ってinternalアクセスしてみる\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#internalsvisibleto%E3%81%AE%E6%AC%A0%E7%82%B9\"\u003eInternalsVisibleToの欠点\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\n\n\u003cli\u003e\n\u003ca href=\"#%E6%96%B9%E6%B3%953ignoresaccesscheckstoattribute\"\u003e【方法3】IgnoresAccessChecksToAttribute\u003c/a\u003e\n\u003cul\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#ignoresaccesscheckstoattribute%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6internal%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B\"\u003eIgnoresAccessChecksToAttributeを使ってinternalアクセスしてみる\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#ignoresaccesschecksto%E3%81%AE%E6%BA%96%E5%82%99%E3%81%8C%E3%82%81%E3%82%93%E3%81%A9%E3%81%8F%E3%81%95%E3%81%84%E3%81%AE%E3%81%A7%E3%81%AA%E3%82%93%E3%81%A8%E3%81%8B%E3%81%99%E3%82%8B\"\u003eIgnoresAccessChecksToの準備がめんどくさいのでなんとかする\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#ignoresaccesschecksto%E3%81%AE%E6%AC%A0%E7%82%B9\"\u003eIgnoresAccessChecksToの欠点\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\n\n\u003cli\u003e\n\u003ca href=\"#%E3%81%93%E3%82%8C%E3%81%BE%E3%81%A7%E7%B4%B9%E4%BB%8B%E3%81%97%E3%81%9Finternal%E8%A6%81%E7%B4%A0%E3%81%B8%E3%81%AE%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E6%96%B9%E6%B3%95%E3%81%BE%E3%81%A8%E3%82%81\"\u003eこれまで紹介したinternal要素へのアクセス方法まとめ\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E9%9B%91%E8%A8%98\"\u003e雑記\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%B5%82%E3%82%8F%E3%82%8A%E3%81%AB\"\u003e終わりに\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#1213-1500%E8%A8%82%E6%AD%A3\"\u003e12/13 15:00訂正\u003c/a\u003e\n\u003c/li\u003e\n\n","totalPv":14071,"uuid":"f3bbc0c45abc31ea7ac0","banReason":null,"adventCalendarItem":{"day":13,"calendar":{"name":"【unityプロ技】","urlName":"unityforpro","year":2019,"organization":null}},"author":{"encryptedId":"PyK11/2A6Ytppp3sOi5XY/XtKPpj--akESQrKjHO1jqoh7--DM7p/3g2E3+FXbrREhA/Og==","originalId":158545,"description":"","facebookUrl":null,"githubUrl":"https://github.com/mob-sakai","isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":false,"linkedinUrl":null,"name":"","profileImageUrl":"https://avatars.githubusercontent.com/u/12690315?v=3","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Favatars.githubusercontent.com%2Fu%2F12690315%3Fv%3D3?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=6b0a822c24a85b538ea9a0a484eade39","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Favatars.githubusercontent.com%2Fu%2F12690315%3Fv%3D3?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=157030055d562d2dae611d3a9828b0cf","urlName":"mob-sakai","websiteUrl":null,"twitterUrl":null,"twitterUrlName":null,"revealedOrganizations":{"edges":[]}},"tags":[{"name":"C#","urlName":"csharp"},{"name":"Unity","urlName":"unity"},{"name":"internal","urlName":"internal"}],"followingLikers":{"edges":[]},"comments":{"totalCount":2}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

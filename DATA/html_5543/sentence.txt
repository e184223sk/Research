More than 3 years have passed since last update.ニコ生とYoutubeLiveで同時配信をしていて、ニコ生しかコメントを取得できていなかったため、YoutubeLiveからチャットを取得するプログラムを組みました。
一応下のコードで、YouTubeLiveからチャットが取得できます。
あと、その下の方で、何をしたのかちょっとずつ解説を書きます。
間違ってたらご指摘下さい。あと、こんなクソ汚いコード使われたくないので、ちゃんとしたの、だれかunitypackageで、だしてくりー。。。
一応プロジェクト置いておくね。
https://github.com/platoronical/youtubelivecommentReciever
※色々あって、プロジェクトが変わりました。山盛りですが、ひとつづつ。
何をやりたいかということはこの前のエントリーとかぶりますが、まぁ。
https://qiita.com/platoronical/items/ba99be66d0cfb85e6038今回はコルーチンの塊です。jsonのパースは、いろいろあってきれいな書き方が、VS2017から.NET4.6から出来るようです。上記のようなコードで取れるようです。きれいでいいなー。
今回はそれを知らなかったので、MiniJSONというプラグイン使ってパースしています。さっきのコードと同じことをしてます。
今回はこのような形で、展開していくことにしました。
色々つまづきポイントはあったんですが、最後の最後に整数値へのキャストで、躓いたので紹介します。もうね、キャストの仕方がありすぎて、どうしたものかと思った。おまけ程度だけど、紹介します。
多分一番意味分かんないのは、uriを作っているところで、もっとスマートに出来るでしょーって感じなんだけど、それは置いておいて。
pageTokenだと思います。
コメント差分が欲しかったため、どうしたものかと思って部屋の中で土下座していると、API側で教えてくれることがわかり。
nextPageTokenと言うものを取得して、
&amp;pageToken=GNvdg86Q_9gCIJi49NOQ_9gC
みたいなパラメーターを、URIにつけてやると、差分だけ取得できます。
で、このパラメーターはNULLでもオッケーなので、初回起動時は、
&amp;pageToken=＆key=xxxxx
みたいな感じで何もないと全件取得してくれます。上記のようなことをして、トークン取得してます。
URI作るときは、以下のように作っています。
各、変数は、まぁ、書いてるので…。コルーチンでやっています。上記のようにコルーチンをループさせてます。
正しいのかは知りません。prefabで、CanvasにTextを2つ貼り付けたものを用意します。
読み込めるフィールドを、用意して使います。ここ二日ほど付き合ってくれた様々な方、ありがとうございました…。
さて、これを本体側に組み込んでいくか…。よかったら、Youtubeチャンネル登録お願いします。
次回の放送はわかりませんが、チャットが取得できてるはず！
https://www.youtube.com/channel/UC8bcQkG7UiUlxb3wcqrs86Qきっと！



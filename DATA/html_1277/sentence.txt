More than 1 year has passed since last update.Azure の Public の Blob のリストを取得したいんだけど、Azure CLI や、Azure SDKなし、つまり認証なしでやりたいと思っていました。実際に調べてみると、出来るようです。ところが、人生は甘くないようで、戻り値が、XMLのようです。おお、、、めんどくさい香りしかしない、、、ところが、C#は意外にXMLに強いようで意外と簡単に行けました。その説明をしてみたいと思います。上記のAPIの戻り値は次のようなXMLです。やりたいことは、ここのUrlに記述されている値を取得したいなと思います。最初のAPIの説明の通りにリクエストを実施します。HttpClient すらも不要です。これは簡単ですね。今回は、Blob の下にある Url を取得したいです。階層会ってめんどくさそうやなと思いきや、Linqが使えるようです。LINQ to XML に記述があるのですが、listはXmlDocumentのオブジェクトなのですが、このクラスにはdecendentsメソッドはありません。これは、System.Xml.Linq.XNameパッケージの拡張メソッドです。このXMLドキュメントのdecendentsつまりルートから考えた時の子孫を検索して、IEnumerable&lt;XElement&gt;として返却してくれます。IEnumerableが帰るので、Linqし放題です。更新系のメソッドなども存在するので、ご興味がある人はXContainer Classをご覧ください。私は Element("Url")?.Valueで、Blobの子ElementであるUrlを参照しています。アトリビュート、つまり、XMLのアトリビュート、下記の例では AddressのType=Shippingを取得したい場合は、p.Attribute("Type") で取得することができます。今回は読込だけを知りたかったのでこの程度の調査で終了しますが、忘れないように記述しておきました。思ったよりずっと簡単でよかったです。



<!DOCTYPE html><html><head><meta charset="utf-8" /><title>gRPC 使って TOPPERS/箱庭 単体ロボットシミュレータにBluetooth デバイスを追加する(サーバー編) - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/kanetugu2018/items/ca29ac2e964efde290b4" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="RSMDZoATpnpFECFDYM+GRJquBPlbjQLJCjJePCZbhf05j/fLNDRyKPVFErEOshcSkXdy+DTgc54qpNpvlRQK3A==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta content="@kanetugu2020" name="twitter:creator" /><meta property="og:type" content="article"><meta property="og:title" content="gRPC 使って TOPPERS/箱庭 単体ロボットシミュレータにBluetooth デバイスを追加する(サーバー編) - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1aMUpRUXlEa3ZiX2pnYVBqZ2FZZ1ZFOVFVRVZTVXlfbnJySGx1cTBnNVkyWTVMMlQ0NE90NDRPYzQ0T0Q0NE9JNDRLMzQ0T2Y0NE9sNDRPczQ0Tzg0NEtfNDRHclFteDFaWFJ2YjNSb0lPT0RoLU9Ea09PQ3BPT0N1ZU9Da3VpX3ZlV0tvT09CbWVPQ2l5ampnclhqZzd6amc1RGpnN3pudDZncCZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTU0JnR4dC1jbGlwPWVsbGlwc2lzJnR4dC1hbGlnbj1jZW50ZXIlMkNtaWRkbGUmcz1kMGEyOTkyM2ZlYjQyZDZiOTViZDhiM2VmNTMzMzhiNw&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RR3RoYm1WMGRXZDFNakF4T0EmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT00NSZ0eHQtYWxpZ249cmlnaHQlMkNib3R0b20mcz0zZGYwM2Q2ODgyOWFkZTEyY2FlOGQwODJiYTYzZGEzMg&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=66b350b1dc82e5615398cf786d69f923"><meta property="og:description" content="

モチベーション

TOPPERS/箱庭 単体ロボットシミュレータに仮想的な Bluetooth デバイスを追加することにしました．そのための実装方法として，より汎用的な技術である gRPC を利用することにしましたので，サーバー側..."><meta content="https://qiita.com/kanetugu2018/items/ca29ac2e964efde290b4" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#,TOPPERS,astah,gRPC,箱庭" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-b5b627ed-6aaa-4bde-aaa9-bfb48b49cdc7"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Fkanetugu2018%2Fitems%2Fca29ac2e964efde290b4">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Fkanetugu2018%2Fitems%2Fca29ac2e964efde290b4">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-b5b627ed-6aaa-4bde-aaa9-bfb48b49cdc7">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2021-02-07T10:33:19.000+09:00","dateModified":"2021-03-29T14:24:24.000+09:00","headline":"gRPC 使って TOPPERS/箱庭 単体ロボットシミュレータにBluetooth デバイスを追加する(サーバー編)","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1aMUpRUXlEa3ZiX2pnYVBqZ2FZZ1ZFOVFVRVZTVXlfbnJySGx1cTBnNVkyWTVMMlQ0NE90NDRPYzQ0T0Q0NE9JNDRLMzQ0T2Y0NE9sNDRPczQ0Tzg0NEtfNDRHclFteDFaWFJ2YjNSb0lPT0RoLU9Ea09PQ3BPT0N1ZU9Da3VpX3ZlV0tvT09CbWVPQ2l5ampnclhqZzd6amc1RGpnN3pudDZncCZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTU0JnR4dC1jbGlwPWVsbGlwc2lzJnR4dC1hbGlnbj1jZW50ZXIlMkNtaWRkbGUmcz1kMGEyOTkyM2ZlYjQyZDZiOTViZDhiM2VmNTMzMzhiNw\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RR3RoYm1WMGRXZDFNakF4T0EmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT00NSZ0eHQtYWxpZ249cmlnaHQlMkNib3R0b20mcz0zZGYwM2Q2ODgyOWFkZTEyY2FlOGQwODJiYTYzZGEzMg\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=66b350b1dc82e5615398cf786d69f923","mainEntityOfPage":"https://qiita.com/kanetugu2018/items/ca29ac2e964efde290b4","author":{"@type":"Person","address":"Fukui, Japan","email":null,"identifier":"kanetugu2018","name":"kanetugu2018","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F244147%2Fprofile-images%2F1521194241?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=325138be382e01eec6bda93808426525","url":"https://qiita.com/kanetugu2018","description":"福井在住の組み込みエンジニアです。\r\n","memberOf":[{"@type":"Organization","address":"","legalName":"TOPPERSプロジェクト","image":"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/a345a81a7f60b0a65ea1bf0c7f82ce83868fa57c/original.jpg?1604470458","logo":"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/15f86c00df3e23fa7f3c62633af7a3506aed3298/original.jpg?1604470458","identifier":"toppers","description":"TOPPERSプロジェクトは、ITRON仕様の技術開発成果を出発点として、組込みシステム構築の基盤となる各種のソフトウェアを開発し、良質なオープンソースソフトウェアとして公開することで、組込みシステム技術と産業の振興を図ることを目的としたプロジェクトです。"}]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://increments.connpass.com/event/211948/">「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催</a><a target="_blank" id="header_text_message_2" href="https://increments.connpass.com/event/211948/">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"kanetugu2018","type":"items","id":"ca29ac2e964efde290b4"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"kanetugu2018","type":"items","id":"ca29ac2e964efde290b4"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":0,"pos_id":"header_text_message_1","message":"「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"kanetugu2018","type":"items","id":"ca29ac2e964efde290b4"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":0,"pos_id":"header_text_message_2","message":"「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/kanetugu2018/items/ca29ac2e964efde290b4","location":"/kanetugu2018/items/ca29ac2e964efde290b4","scheme":"https","host":"qiita.com","port":null,"pathname":"/kanetugu2018/items/ca29ac2e964efde290b4","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"X7mrUf0ZoG4fS57PbaQty6yPX7ZB1UNvzbSYMO3WqesjFV/8ST50PK8erT0D2bydp1Ypty64MjjtIhxjXpkmyg==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-37e72956-7863-4517-b1d3-11eeeecd013a"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/kanetugu2018/items/ca29ac2e964efde290b4/likers" class="css-1iupg5d">9</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">8</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/ca29ac2e964efde290b4/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/kanetugu2018/items/ca29ac2e964efde290b4/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/kanetugu2018/items/ca29ac2e964efde290b4/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/kanetugu2018/items/ca29ac2e964efde290b4/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/kanetugu2018/items/ca29ac2e964efde290b4.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/kanetugu2018"><img class="css-100alwu eyfquo10" src="https://qiita-image-store.s3.amazonaws.com/0/244147/profile-images/1521194241" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/kanetugu2018" class="css-10ougpm">@<!-- -->kanetugu2018</a><div class="css-1ay9vb9"><span><meta content="2021-02-07T01:33:19Z"/><time dateTime="2021-03-29T05:24:24Z" class="css-m19uds">updated at 2021-03-29</time></span></div></div></div></div></div><h1 class="css-cgzq40">gRPC 使って TOPPERS/箱庭 単体ロボットシミュレータにBluetooth デバイスを追加する(サーバー編)</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/toppers" class="css-4czcte">TOPPERS</a><a href="/tags/astah" class="css-4czcte">astah</a><a href="/tags/grpc" class="css-4czcte">gRPC</a><a href="/tags/%e7%ae%b1%e5%ba%ad" class="css-4czcte">箱庭</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div>
<h1>
<span id="モチベーション" class="fragment"></span><a href="#%E3%83%A2%E3%83%81%E3%83%99%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3"><i class="fa fa-link"></i></a>モチベーション</h1>

<p>TOPPERS/箱庭 単体ロボットシミュレータに仮想的な Bluetooth デバイスを追加することにしました．そのための実装方法として，より汎用的な技術である gRPC を利用することにしましたので，サーバー側の gRPC を利用したプログラムの作成方法について解説します．</p>

<p>なお，gRPC を利用しようと思った動機は，以下の２点です．</p>

<ul>
<li>様々な言語でサーバー側とクライアント側を開発できる</li>
<li>RPC 実装を作る必要がない(データ型定義するだけで自動生成されちゃう！）</li>
</ul>

<p>サーバー側のプログラムは，Bluetooth 用のシリアルI/Oライブラリで，EV3RTの Bluetooth APIとの連携を可能にします．ただし，本記事では，EV3RT側の解説は含まれておりません．<br>
※別途，gRPC クライアント側の解説記事を書く予定ですので，その際に併せて説明します～．</p>

<h1>
<span id="本記事を通して学べる-grpc-の知識は" class="fragment"></span><a href="#%E6%9C%AC%E8%A8%98%E4%BA%8B%E3%82%92%E9%80%9A%E3%81%97%E3%81%A6%E5%AD%A6%E3%81%B9%E3%82%8B-grpc-%E3%81%AE%E7%9F%A5%E8%AD%98%E3%81%AF"><i class="fa fa-link"></i></a>本記事を通して学べる gRPC の知識は？</h1>

<ul>
<li>gRPC 概要</li>
<li>gRPC のデータ定義方法</li>
<li>gRPC を使ったサーバー側の設計(RAWデータ管理)</li>
<li>gRPC の開発環境(C#)の作成方法</li>
<li>gRPC の実装例(C#)</li>
</ul>

<h1>
<span id="grpc-概要" class="fragment"></span><a href="#grpc-%E6%A6%82%E8%A6%81"><i class="fa fa-link"></i></a>gRPC 概要</h1>

<p>以下の記事がとても参考になります．</p>

<ul>
<li><a href="https://qiita.com/gold-kou/items/a1cc2be6045723e242eb" id="reference-b3ec3590ebb0166c412a">いまさらだけどgRPCに入門したので分かりやすくまとめてみた</a></li>
</ul>

<p>深く学びたい方は，本家サイトを参照ください．</p>

<ul>
<li><a href="https://www.grpc.io/" class="autolink" rel="nofollow noopener" target="_blank">https://www.grpc.io/</a></li>
</ul>

<h1>
<span id="grpc-のデータ定義方法" class="fragment"></span><a href="#grpc-%E3%81%AE%E3%83%87%E3%83%BC%E3%82%BF%E5%AE%9A%E7%BE%A9%E6%96%B9%E6%B3%95"><i class="fa fa-link"></i></a>gRPC のデータ定義方法</h1>

<p>まず，論より証拠，今回作成した gRPC の定義は以下になります．</p>

<div class="code-frame" data-lang="C#"><div class="highlight"><pre class="with-code"><code><span class="n">service</span> <span class="n">SerialService</span> <span class="p">{</span>
  <span class="n">rpc</span> <span class="nf">PutData</span> <span class="p">(</span><span class="n">SerialPutData</span><span class="p">)</span> <span class="nf">returns</span> <span class="p">(</span><span class="n">SerialPutResult</span><span class="p">)</span> <span class="p">{}</span>
  <span class="n">rpc</span> <span class="nf">GetData</span> <span class="p">(</span><span class="n">SerialGetData</span><span class="p">)</span> <span class="nf">returns</span> <span class="p">(</span><span class="n">SerialGetResult</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">}</span>
</code></pre></div></div>

<p><code>service</code> キーワードから gRPC の定義が始まります．今回のケースでは，RPCのサービス名が<code>SerialService</code>です．</p>

<p>そして，このサービスには，以下の２つのAPI(関数)があります(<code>rpc</code>キーワードで始まる部分です)．</p>

<ul>
<li>PutData</li>
<li>GetData</li>
</ul>

<p>それぞれの処理について簡単に説明します．</p>

<h2>
<span id="putdata" class="fragment"></span><a href="#putdata"><i class="fa fa-link"></i></a>PutData</h2>

<p>本APIは，引数に <code>SerialPutData</code> というデータ型をとり，結果を <code>SerialputResult</code>というデータ型で返します．クライアントがサーバーに Bluetooth 用のシリアルデータを送信する際に利用します．<br>
※クライアントは送信したいデータを  <code>SerialPutData</code> に詰めます．</p>

<h2>
<span id="getdata" class="fragment"></span><a href="#getdata"><i class="fa fa-link"></i></a>GetData</h2>

<p>本APIは，引数に <code>SerialGetData</code> というデータ型をとり，結果を <code>SerialGetResult</code>というデータ型で返します．クライアントがサーバーから Bluetooth 用のシリアルデータを受信する際に利用します．<br>
※クライアントは受信するデータを  <code>SerialGetResult</code> で受け取ります．</p>

<p>ここから，各データ型の定義方法について解説します．<br>
まず，gRPC で利用するデータ型は，<a href="https://ja.wikipedia.org/wiki/Protocol_Buffers" rel="nofollow noopener" target="_blank">プロトコルバッファー</a>で定義します．</p>

<p>今回作成したデータ型の定義は以下の通りです．</p>

<div class="code-frame" data-lang="c#"><div class="highlight"><pre class="with-code"><code><span class="n">message</span> <span class="n">SerialPutData</span> <span class="p">{</span>
  <span class="n">int32</span>  <span class="n">channel</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span>
  <span class="n">bytes</span> <span class="n">data</span> <span class="p">=</span> <span class="m">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">message</span> <span class="n">SerialPutResult</span> <span class="p">{</span>
  <span class="n">int32</span>  <span class="n">channel</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span>
  <span class="kt">string</span> <span class="n">ercd</span> <span class="p">=</span> <span class="m">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">message</span> <span class="n">SerialGetData</span> <span class="p">{</span>
  <span class="n">int32</span>  <span class="n">channel</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">message</span> <span class="n">SerialGetResult</span> <span class="p">{</span>
  <span class="n">int32</span>  <span class="n">channel</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span>
  <span class="kt">string</span> <span class="n">ercd</span> <span class="p">=</span> <span class="m">2</span><span class="p">;</span>
  <span class="n">bytes</span> <span class="n">data</span> <span class="p">=</span> <span class="m">3</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p><code>message</code> で始まるキーワード部分がプロトコルバッファー定義部分です．<br>
message の中のメンバは，データ型毎にそれぞれ自由に定義できます．</p>

<ul>
<li>
<code>channel</code> は，シリアルI/Oをマルチチャネルに対応するためのメンバです(今回は1チャネルのみしかやりませんが)．</li>
<li>
<code>ercd</code>には，サーバー側のエラーメッセージが格納されます．</li>
<li>
<code>data</code>には，バイナリデータが格納されます．Bluetoothのシリアルデータが対応します．</li>
</ul>

<p>たったこれだけの定義をするだけで，クライアント側とサーバー側の RPC 実装コードが様々な言語で生成されちゃうわけですから，実装方法の自由度が大きく広がりますし，実装コストも激減ですよね！！</p>

<h1>
<span id="grpc-を使ったサーバー側の設計rawデータ管理" class="fragment"></span><a href="#grpc-%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%9F%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E5%81%B4%E3%81%AE%E8%A8%AD%E8%A8%88raw%E3%83%87%E3%83%BC%E3%82%BF%E7%AE%A1%E7%90%86"><i class="fa fa-link"></i></a>gRPC を使ったサーバー側の設計(RAWデータ管理)</h1>

<p>サーバー側の Bluetooth I/O 設計内容(UML)をお示しします．</p>

<p>なお，本設計では，UMLツールとして，<a href="https://astah.change-vision.com/ja/product/astah-professional.html" rel="nofollow noopener" target="_blank">astah* professional</a>を利用しています．直感的な操作ができるところがとても良いです(ハマります)．設計検討中は常にモヤモヤしているので，ストレスなく思いを描けるツールの存在はとても大事です．さらに，設計中は様々な視点での検討が必要となるので，UML図だけでなく，DFDやロバストネス図なども使える点がさらに良いです．</p>

<h2>
<span id="クラス設計" class="fragment"></span><a href="#%E3%82%AF%E3%83%A9%E3%82%B9%E8%A8%AD%E8%A8%88"><i class="fa fa-link"></i></a>クラス設計</h2>

<p><a href="https://camo.qiitausercontent.com/6c403f5024fbe3cc0fdd555db81e4e17246d068f/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3234343134372f31393634653037642d656636642d316465352d613130352d6266623132386266636631382e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F244147%2F1964e07d-ef6d-1de5-a105-bfb128bfcf18.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=0cc4baddffb12d0b53c004de9a4fd10e" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/244147/1964e07d-ef6d-1de5-a105-bfb128bfcf18.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F244147%2F1964e07d-ef6d-1de5-a105-bfb128bfcf18.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=03c4d629bea7b5deafe230cbd4a79bb1 1x" loading="lazy"></a></p>

<h2>
<span id="シーケンス設計" class="fragment"></span><a href="#%E3%82%B7%E3%83%BC%E3%82%B1%E3%83%B3%E3%82%B9%E8%A8%AD%E8%A8%88"><i class="fa fa-link"></i></a>シーケンス設計</h2>

<h3>
<span id="起動シーケンス" class="fragment"></span><a href="#%E8%B5%B7%E5%8B%95%E3%82%B7%E3%83%BC%E3%82%B1%E3%83%B3%E3%82%B9"><i class="fa fa-link"></i></a>起動シーケンス</h3>

<p><a href="https://camo.qiitausercontent.com/23f83dfbe8cdc9f5f42d5bae18acb1916bd6f5f1/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3234343134372f63323964376338622d376436302d313461352d316337302d3335393135623833343664612e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F244147%2Fc29d7c8b-7d60-14a5-1c70-35915b8346da.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=1f4b950b98d6f714952437d7b281afa6" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/244147/c29d7c8b-7d60-14a5-1c70-35915b8346da.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F244147%2Fc29d7c8b-7d60-14a5-1c70-35915b8346da.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=28123aafde3efba1ec0192d340690fa5 1x" loading="lazy"></a></p>

<h3>
<span id="putdata-シーケンス" class="fragment"></span><a href="#putdata-%E3%82%B7%E3%83%BC%E3%82%B1%E3%83%B3%E3%82%B9"><i class="fa fa-link"></i></a>PutData シーケンス</h3>

<p><a href="https://camo.qiitausercontent.com/dad0cdb2baace76248a1cdb2045e6c386b79315d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3234343134372f61626337313062392d366464392d393930352d333165612d6664343662393862303364332e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F244147%2Fabc710b9-6dd9-9905-31ea-fd46b98b03d3.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=05d8dd0eb64119eecc14d4d08b1db0b2" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/244147/abc710b9-6dd9-9905-31ea-fd46b98b03d3.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F244147%2Fabc710b9-6dd9-9905-31ea-fd46b98b03d3.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=83288d281d203418a42447afecf59bb1 1x" loading="lazy"></a></p>

<h3>
<span id="getdata-シーケンス" class="fragment"></span><a href="#getdata-%E3%82%B7%E3%83%BC%E3%82%B1%E3%83%B3%E3%82%B9"><i class="fa fa-link"></i></a>GetData シーケンス</h3>

<p><a href="https://camo.qiitausercontent.com/e7670544c2b0d75f2fc3e71d0b575ad3b140b03a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3234343134372f33346465373034392d313663342d623139622d303735362d3231323836326563653433362e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F244147%2F34de7049-16c4-b19b-0756-212862ece436.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=f68b62ad65a8cc6d77527976f765bb34" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/244147/34de7049-16c4-b19b-0756-212862ece436.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F244147%2F34de7049-16c4-b19b-0756-212862ece436.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=b89fc073b9b38a914a01f70a6c197de4 1x" loading="lazy"></a></p>

<h1>
<span id="grpc-の開発環境cの作成方法" class="fragment"></span><a href="#grpc-%E3%81%AE%E9%96%8B%E7%99%BA%E7%92%B0%E5%A2%83c%E3%81%AE%E4%BD%9C%E6%88%90%E6%96%B9%E6%B3%95"><i class="fa fa-link"></i></a>gRPC の開発環境(C#)の作成方法</h1>

<p>さて，ここから実際にプログラミングの話になります．<br>
今回のBluetoothサーバー実装言語は，C#にしました．</p>

<p>理由は，以下の記事にあるロガー機能がC#で実装されており，将来的に，このロガーを実機とシミュレータとで切り替えできるようにしたいという野望があるためです．</p>

<ul>
<li><a href="https://qiita.com/koushiro/items/dffdd4375d3ce110cb41" id="reference-7fe785ad0e5d387452bd">WRO勢による EV3rt汎用Bluetoothロガーの開発</a></li>
</ul>

<p>C#での gRPC の開発環境ですが，こちらの記事が大変参考になります．</p>

<ul>
<li><a href="https://light11.hatenadiary.com/entry/2020/07/28/210411" rel="nofollow noopener" target="_blank">gRPCの概要をC#でサクッと理解する</a></li>
</ul>

<h1>
<span id="grpc-の実装例c" class="fragment"></span><a href="#grpc-%E3%81%AE%E5%AE%9F%E8%A3%85%E4%BE%8Bc"><i class="fa fa-link"></i></a>gRPC の実装例(C#)</h1>

<p>各クラスの実装は，以下で公開しております．</p>

<ul>
<li><a href="https://github.com/toppers/athrill-device/tree/main/device/ev3com/grpc/server/csharp" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/toppers/athrill-device/tree/main/device/ev3com/grpc/server/csharp</a></li>
</ul>

<p>program.cs がユーザプログラムになります．</p>

<div class="code-frame" data-lang="C#"><div class="highlight"><pre class="with-code"><code><span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">string</span> <span class="n">ipaddr</span> <span class="p">=</span> <span class="s">"172.25.0.1"</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">portno</span> <span class="p">=</span> <span class="m">50051</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">buffer_size</span> <span class="p">=</span> <span class="m">1024</span> <span class="p">*</span> <span class="m">1024</span><span class="p">;</span> <span class="cm">/* 1MB */</span>
    <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"ipaddr="</span> <span class="p">+</span> <span class="n">ipaddr</span> <span class="p">+</span> <span class="s">" portno="</span> <span class="p">+</span> <span class="n">portno</span><span class="p">.</span><span class="nf">ToString</span><span class="p">());</span>

    <span class="n">VirtualBluetoothSerial</span> <span class="n">serial</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">VirtualBluetoothSerial</span><span class="p">();</span>
    <span class="n">serial</span><span class="p">.</span><span class="nf">SetServerInfo</span><span class="p">(</span><span class="n">ipaddr</span><span class="p">,</span> <span class="n">portno</span><span class="p">,</span> <span class="n">buffer_size</span><span class="p">);</span>
    <span class="n">serial</span><span class="p">.</span><span class="nf">Open</span><span class="p">();</span>
    <span class="kt">string</span> <span class="n">data</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
    <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"START BT TEST&gt;&gt;&gt;&gt;"</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;=</span> <span class="m">10</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
    <span class="p">{</span>
        <span class="n">data</span> <span class="p">=</span> <span class="s">"Hello World[ "</span> <span class="p">+</span> <span class="n">i</span><span class="p">.</span><span class="nf">ToString</span><span class="p">()</span> <span class="p">+</span> <span class="s">" / 10 ]"</span><span class="p">;</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"SEND DATA:  "</span> <span class="p">+</span> <span class="n">data</span><span class="p">);</span>
        <span class="n">serial</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
        <span class="kt">string</span> <span class="n">rcv_data</span> <span class="p">=</span> <span class="n">serial</span><span class="p">.</span><span class="nf">ReadLine</span><span class="p">().</span><span class="nf">Trim</span><span class="p">();</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"RECV DATA:  "</span> <span class="p">+</span> <span class="n">rcv_data</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="nf">Equals</span><span class="p">(</span><span class="n">rcv_data</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"TEST PASSED [ "</span> <span class="p">+</span> <span class="n">i</span><span class="p">.</span><span class="nf">ToString</span><span class="p">()</span> <span class="p">+</span> <span class="s">" ]"</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"TEST FAILED [ "</span> <span class="p">+</span> <span class="n">i</span><span class="p">.</span><span class="nf">ToString</span><span class="p">()</span> <span class="p">+</span> <span class="s">" ]"</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"&lt;&lt;&lt;&lt;END BT TEST"</span><span class="p">);</span>
    <span class="n">serial</span><span class="p">.</span><span class="nf">Close</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<p>本プログラムは，シリアルデータをサーバー側からクライアントに送信して，そのデータをクライアントからそのまま送り返してもらって，送信データと受信データが一致しているかどうかをチェックしています(10回繰り返します)．</p>

<h1>
<span id="デモ" class="fragment"></span><a href="#%E3%83%87%E3%83%A2"><i class="fa fa-link"></i></a>デモ</h1>

<p>このプログラムの実行するとこんな感じで動きます．<br>
クライアント側は，EV3RTのBluetooth APIを使ってデータの送受信をするようにしています(別途こちらは解説します)．</p>

<p><a href="https://camo.qiitausercontent.com/ab18314152e7480daedfeed167eb199e37ba14fb/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3234343134372f39373762343335642d306230362d653665392d613866392d3863363862386133313937642e676966" target="_blank" rel="nofollow noopener"><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/244147/977b435d-0b06-e6e9-a8f9-8c68b8a3197d.gif" alt="demo.gif" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/244147/977b435d-0b06-e6e9-a8f9-8c68b8a3197d.gif" loading="lazy"></a></p>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Fkanetugu2018%2Fitems%2Fca29ac2e964efde290b4&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Fkanetugu2018%2Fitems%2Fca29ac2e964efde290b4&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/kanetugu2018/items/ca29ac2e964efde290b4/likers" class="css-1iupg5d">9</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">8</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/ca29ac2e964efde290b4/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/kanetugu2018/items/ca29ac2e964efde290b4/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/kanetugu2018/items/ca29ac2e964efde290b4/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/kanetugu2018/items/ca29ac2e964efde290b4/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/kanetugu2018/items/ca29ac2e964efde290b4.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-37e72956-7863-4517-b1d3-11eeeecd013a">{"authorAnalyticsTrackingId":"UA-116085359-1","organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-9a200670-4430-421e-9ce3-03329fda2c5f"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-9a200670-4430-421e-9ce3-03329fda2c5f">{}</script>
      
<div id="LoginModal-react-component-7674b0c2-caa3-4754-a341-a53f1f7331e5"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-7674b0c2-caa3-4754-a341-a53f1f7331e5">{}</script>
      
<div id="StockModal-react-component-7d4ae26e-897b-49d8-b3c8-cb784fdb72ed"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-7d4ae26e-897b-49d8-b3c8-cb784fdb72ed">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;dt5UgQ7rKPrIqLqLJ5fq4gXrlmTpbDnaPuwrfdHhArwKcqAsusz8qHj9iXlJ6nu0DjLgZYYBSI0eeq8uYq6NnQ==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\n\u003ch1\u003e\n\u003cspan id=\"モチベーション\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%A2%E3%83%81%E3%83%99%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eモチベーション\u003c/h1\u003e\n\n\u003cp\u003eTOPPERS/箱庭 単体ロボットシミュレータに仮想的な Bluetooth デバイスを追加することにしました．そのための実装方法として，より汎用的な技術である gRPC を利用することにしましたので，サーバー側の gRPC を利用したプログラムの作成方法について解説します．\u003c/p\u003e\n\n\u003cp\u003eなお，gRPC を利用しようと思った動機は，以下の２点です．\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e様々な言語でサーバー側とクライアント側を開発できる\u003c/li\u003e\n\u003cli\u003eRPC 実装を作る必要がない(データ型定義するだけで自動生成されちゃう！）\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eサーバー側のプログラムは，Bluetooth 用のシリアルI/Oライブラリで，EV3RTの Bluetooth APIとの連携を可能にします．ただし，本記事では，EV3RT側の解説は含まれておりません．\u003cbr\u003e\n※別途，gRPC クライアント側の解説記事を書く予定ですので，その際に併せて説明します～．\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"本記事を通して学べる-grpc-の知識は\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%9C%AC%E8%A8%98%E4%BA%8B%E3%82%92%E9%80%9A%E3%81%97%E3%81%A6%E5%AD%A6%E3%81%B9%E3%82%8B-grpc-%E3%81%AE%E7%9F%A5%E8%AD%98%E3%81%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e本記事を通して学べる gRPC の知識は？\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003egRPC 概要\u003c/li\u003e\n\u003cli\u003egRPC のデータ定義方法\u003c/li\u003e\n\u003cli\u003egRPC を使ったサーバー側の設計(RAWデータ管理)\u003c/li\u003e\n\u003cli\u003egRPC の開発環境(C#)の作成方法\u003c/li\u003e\n\u003cli\u003egRPC の実装例(C#)\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"grpc-概要\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#grpc-%E6%A6%82%E8%A6%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003egRPC 概要\u003c/h1\u003e\n\n\u003cp\u003e以下の記事がとても参考になります．\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://qiita.com/gold-kou/items/a1cc2be6045723e242eb\" id=\"reference-b3ec3590ebb0166c412a\"\u003eいまさらだけどgRPCに入門したので分かりやすくまとめてみた\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e深く学びたい方は，本家サイトを参照ください．\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://www.grpc.io/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://www.grpc.io/\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"grpc-のデータ定義方法\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#grpc-%E3%81%AE%E3%83%87%E3%83%BC%E3%82%BF%E5%AE%9A%E7%BE%A9%E6%96%B9%E6%B3%95\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003egRPC のデータ定義方法\u003c/h1\u003e\n\n\u003cp\u003eまず，論より証拠，今回作成した gRPC の定義は以下になります．\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eservice\u003c/span\u003e \u003cspan class=\"n\"\u003eSerialService\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"n\"\u003erpc\u003c/span\u003e \u003cspan class=\"nf\"\u003ePutData\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eSerialPutData\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"nf\"\u003ereturns\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eSerialPutResult\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{}\u003c/span\u003e\n  \u003cspan class=\"n\"\u003erpc\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetData\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eSerialGetData\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"nf\"\u003ereturns\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eSerialGetResult\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003eservice\u003c/code\u003e キーワードから gRPC の定義が始まります．今回のケースでは，RPCのサービス名が\u003ccode\u003eSerialService\u003c/code\u003eです．\u003c/p\u003e\n\n\u003cp\u003eそして，このサービスには，以下の２つのAPI(関数)があります(\u003ccode\u003erpc\u003c/code\u003eキーワードで始まる部分です)．\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003ePutData\u003c/li\u003e\n\u003cli\u003eGetData\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eそれぞれの処理について簡単に説明します．\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"putdata\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#putdata\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ePutData\u003c/h2\u003e\n\n\u003cp\u003e本APIは，引数に \u003ccode\u003eSerialPutData\u003c/code\u003e というデータ型をとり，結果を \u003ccode\u003eSerialputResult\u003c/code\u003eというデータ型で返します．クライアントがサーバーに Bluetooth 用のシリアルデータを送信する際に利用します．\u003cbr\u003e\n※クライアントは送信したいデータを  \u003ccode\u003eSerialPutData\u003c/code\u003e に詰めます．\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"getdata\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#getdata\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eGetData\u003c/h2\u003e\n\n\u003cp\u003e本APIは，引数に \u003ccode\u003eSerialGetData\u003c/code\u003e というデータ型をとり，結果を \u003ccode\u003eSerialGetResult\u003c/code\u003eというデータ型で返します．クライアントがサーバーから Bluetooth 用のシリアルデータを受信する際に利用します．\u003cbr\u003e\n※クライアントは受信するデータを  \u003ccode\u003eSerialGetResult\u003c/code\u003e で受け取ります．\u003c/p\u003e\n\n\u003cp\u003eここから，各データ型の定義方法について解説します．\u003cbr\u003e\nまず，gRPC で利用するデータ型は，\u003ca href=\"https://ja.wikipedia.org/wiki/Protocol_Buffers\" rel=\"nofollow noopener\" target=\"_blank\"\u003eプロトコルバッファー\u003c/a\u003eで定義します．\u003c/p\u003e\n\n\u003cp\u003e今回作成したデータ型の定義は以下の通りです．\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003emessage\u003c/span\u003e \u003cspan class=\"n\"\u003eSerialPutData\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"n\"\u003eint32\u003c/span\u003e  \u003cspan class=\"n\"\u003echannel\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"n\"\u003ebytes\u003c/span\u003e \u003cspan class=\"n\"\u003edata\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003emessage\u003c/span\u003e \u003cspan class=\"n\"\u003eSerialPutResult\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"n\"\u003eint32\u003c/span\u003e  \u003cspan class=\"n\"\u003echannel\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eercd\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003emessage\u003c/span\u003e \u003cspan class=\"n\"\u003eSerialGetData\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"n\"\u003eint32\u003c/span\u003e  \u003cspan class=\"n\"\u003echannel\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"n\"\u003emessage\u003c/span\u003e \u003cspan class=\"n\"\u003eSerialGetResult\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"n\"\u003eint32\u003c/span\u003e  \u003cspan class=\"n\"\u003echannel\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eercd\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"n\"\u003ebytes\u003c/span\u003e \u003cspan class=\"n\"\u003edata\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003emessage\u003c/code\u003e で始まるキーワード部分がプロトコルバッファー定義部分です．\u003cbr\u003e\nmessage の中のメンバは，データ型毎にそれぞれ自由に定義できます．\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003echannel\u003c/code\u003e は，シリアルI/Oをマルチチャネルに対応するためのメンバです(今回は1チャネルのみしかやりませんが)．\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eercd\u003c/code\u003eには，サーバー側のエラーメッセージが格納されます．\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003edata\u003c/code\u003eには，バイナリデータが格納されます．Bluetoothのシリアルデータが対応します．\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eたったこれだけの定義をするだけで，クライアント側とサーバー側の RPC 実装コードが様々な言語で生成されちゃうわけですから，実装方法の自由度が大きく広がりますし，実装コストも激減ですよね！！\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"grpc-を使ったサーバー側の設計rawデータ管理\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#grpc-%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%9F%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E5%81%B4%E3%81%AE%E8%A8%AD%E8%A8%88raw%E3%83%87%E3%83%BC%E3%82%BF%E7%AE%A1%E7%90%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003egRPC を使ったサーバー側の設計(RAWデータ管理)\u003c/h1\u003e\n\n\u003cp\u003eサーバー側の Bluetooth I/O 設計内容(UML)をお示しします．\u003c/p\u003e\n\n\u003cp\u003eなお，本設計では，UMLツールとして，\u003ca href=\"https://astah.change-vision.com/ja/product/astah-professional.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eastah* professional\u003c/a\u003eを利用しています．直感的な操作ができるところがとても良いです(ハマります)．設計検討中は常にモヤモヤしているので，ストレスなく思いを描けるツールの存在はとても大事です．さらに，設計中は様々な視点での検討が必要となるので，UML図だけでなく，DFDやロバストネス図なども使える点がさらに良いです．\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"クラス設計\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%AF%E3%83%A9%E3%82%B9%E8%A8%AD%E8%A8%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eクラス設計\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/6c403f5024fbe3cc0fdd555db81e4e17246d068f/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3234343134372f31393634653037642d656636642d316465352d613130352d6266623132386266636631382e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F244147%2F1964e07d-ef6d-1de5-a105-bfb128bfcf18.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=0cc4baddffb12d0b53c004de9a4fd10e\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/244147/1964e07d-ef6d-1de5-a105-bfb128bfcf18.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F244147%2F1964e07d-ef6d-1de5-a105-bfb128bfcf18.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=03c4d629bea7b5deafe230cbd4a79bb1 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"シーケンス設計\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B7%E3%83%BC%E3%82%B1%E3%83%B3%E3%82%B9%E8%A8%AD%E8%A8%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eシーケンス設計\u003c/h2\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"起動シーケンス\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%B5%B7%E5%8B%95%E3%82%B7%E3%83%BC%E3%82%B1%E3%83%B3%E3%82%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e起動シーケンス\u003c/h3\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/23f83dfbe8cdc9f5f42d5bae18acb1916bd6f5f1/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3234343134372f63323964376338622d376436302d313461352d316337302d3335393135623833343664612e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F244147%2Fc29d7c8b-7d60-14a5-1c70-35915b8346da.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=1f4b950b98d6f714952437d7b281afa6\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/244147/c29d7c8b-7d60-14a5-1c70-35915b8346da.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F244147%2Fc29d7c8b-7d60-14a5-1c70-35915b8346da.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=28123aafde3efba1ec0192d340690fa5 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"putdata-シーケンス\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#putdata-%E3%82%B7%E3%83%BC%E3%82%B1%E3%83%B3%E3%82%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ePutData シーケンス\u003c/h3\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/dad0cdb2baace76248a1cdb2045e6c386b79315d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3234343134372f61626337313062392d366464392d393930352d333165612d6664343662393862303364332e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F244147%2Fabc710b9-6dd9-9905-31ea-fd46b98b03d3.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=05d8dd0eb64119eecc14d4d08b1db0b2\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/244147/abc710b9-6dd9-9905-31ea-fd46b98b03d3.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F244147%2Fabc710b9-6dd9-9905-31ea-fd46b98b03d3.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=83288d281d203418a42447afecf59bb1 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"getdata-シーケンス\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#getdata-%E3%82%B7%E3%83%BC%E3%82%B1%E3%83%B3%E3%82%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eGetData シーケンス\u003c/h3\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/e7670544c2b0d75f2fc3e71d0b575ad3b140b03a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3234343134372f33346465373034392d313663342d623139622d303735362d3231323836326563653433362e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F244147%2F34de7049-16c4-b19b-0756-212862ece436.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=f68b62ad65a8cc6d77527976f765bb34\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/244147/34de7049-16c4-b19b-0756-212862ece436.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F244147%2F34de7049-16c4-b19b-0756-212862ece436.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=b89fc073b9b38a914a01f70a6c197de4 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"grpc-の開発環境cの作成方法\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#grpc-%E3%81%AE%E9%96%8B%E7%99%BA%E7%92%B0%E5%A2%83c%E3%81%AE%E4%BD%9C%E6%88%90%E6%96%B9%E6%B3%95\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003egRPC の開発環境(C#)の作成方法\u003c/h1\u003e\n\n\u003cp\u003eさて，ここから実際にプログラミングの話になります．\u003cbr\u003e\n今回のBluetoothサーバー実装言語は，C#にしました．\u003c/p\u003e\n\n\u003cp\u003e理由は，以下の記事にあるロガー機能がC#で実装されており，将来的に，このロガーを実機とシミュレータとで切り替えできるようにしたいという野望があるためです．\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://qiita.com/koushiro/items/dffdd4375d3ce110cb41\" id=\"reference-7fe785ad0e5d387452bd\"\u003eWRO勢による EV3rt汎用Bluetoothロガーの開発\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eC#での gRPC の開発環境ですが，こちらの記事が大変参考になります．\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://light11.hatenadiary.com/entry/2020/07/28/210411\" rel=\"nofollow noopener\" target=\"_blank\"\u003egRPCの概要をC#でサクッと理解する\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"grpc-の実装例c\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#grpc-%E3%81%AE%E5%AE%9F%E8%A3%85%E4%BE%8Bc\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003egRPC の実装例(C#)\u003c/h1\u003e\n\n\u003cp\u003e各クラスの実装は，以下で公開しております．\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/toppers/athrill-device/tree/main/device/ev3com/grpc/server/csharp\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/toppers/athrill-device/tree/main/device/ev3com/grpc/server/csharp\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eprogram.cs がユーザプログラムになります．\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eMain\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eipaddr\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"172.25.0.1\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eportno\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e50051\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ebuffer_size\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1024\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"m\"\u003e1024\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"cm\"\u003e/* 1MB */\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"ipaddr=\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eipaddr\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\" portno=\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eportno\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToString\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003eVirtualBluetoothSerial\u003c/span\u003e \u003cspan class=\"n\"\u003eserial\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eVirtualBluetoothSerial\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eserial\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSetServerInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eipaddr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eportno\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ebuffer_size\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eserial\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eOpen\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003edata\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"START BT TEST\u0026gt;\u0026gt;\u0026gt;\u0026gt;\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;=\u003c/span\u003e \u003cspan class=\"m\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003edata\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Hello World[ \"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToString\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\" / 10 ]\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"SEND DATA:  \"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eserial\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ercv_data\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eserial\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReadLine\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"nf\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"RECV DATA:  \"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003ercv_data\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEquals\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ercv_data\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"TEST PASSED [ \"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToString\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\" ]\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"TEST FAILED [ \"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToString\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\" ]\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u0026lt;\u0026lt;\u0026lt;\u0026lt;END BT TEST\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eserial\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eClose\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e本プログラムは，シリアルデータをサーバー側からクライアントに送信して，そのデータをクライアントからそのまま送り返してもらって，送信データと受信データが一致しているかどうかをチェックしています(10回繰り返します)．\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"デモ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%87%E3%83%A2\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eデモ\u003c/h1\u003e\n\n\u003cp\u003eこのプログラムの実行するとこんな感じで動きます．\u003cbr\u003e\nクライアント側は，EV3RTのBluetooth APIを使ってデータの送受信をするようにしています(別途こちらは解説します)．\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/ab18314152e7480daedfeed167eb199e37ba14fb/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3234343134372f39373762343335642d306230362d653665392d613866392d3863363862386133313937642e676966\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/244147/977b435d-0b06-e6e9-a8f9-8c68b8a3197d.gif\" alt=\"demo.gif\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/244147/977b435d-0b06-e6e9-a8f9-8c68b8a3197d.gif\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n","createdAt":"2021-02-07T01:33:19Z","elapsedYearsFromLastModifiedAt":0,"encryptedId":"BCvO/Tf2CwHG3DvYV+2pnlMsAnlxf7Qi/w==--0bWTIYrom1N2/j63--l6yQJajU4+1k1c5Dq9bEFA==","isBanned":false,"isDeprecated":false,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2021-03-29T05:24:24Z","likesCount":9,"linkUrl":"https://qiita.com/kanetugu2018/items/ca29ac2e964efde290b4","organization":null,"originalId":1388796,"stockedCount":8,"title":"gRPC 使って TOPPERS/箱庭 単体ロボットシミュレータにBluetooth デバイスを追加する(サーバー編)","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%A2%E3%83%81%E3%83%99%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3\"\u003eモチベーション\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%9C%AC%E8%A8%98%E4%BA%8B%E3%82%92%E9%80%9A%E3%81%97%E3%81%A6%E5%AD%A6%E3%81%B9%E3%82%8B-grpc-%E3%81%AE%E7%9F%A5%E8%AD%98%E3%81%AF\"\u003e本記事を通して学べる gRPC の知識は？\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#grpc-%E6%A6%82%E8%A6%81\"\u003egRPC 概要\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#grpc-%E3%81%AE%E3%83%87%E3%83%BC%E3%82%BF%E5%AE%9A%E7%BE%A9%E6%96%B9%E6%B3%95\"\u003egRPC のデータ定義方法\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#putdata\"\u003ePutData\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#getdata\"\u003eGetData\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#grpc-%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%9F%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E5%81%B4%E3%81%AE%E8%A8%AD%E8%A8%88raw%E3%83%87%E3%83%BC%E3%82%BF%E7%AE%A1%E7%90%86\"\u003egRPC を使ったサーバー側の設計(RAWデータ管理)\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%AF%E3%83%A9%E3%82%B9%E8%A8%AD%E8%A8%88\"\u003eクラス設計\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B7%E3%83%BC%E3%82%B1%E3%83%B3%E3%82%B9%E8%A8%AD%E8%A8%88\"\u003eシーケンス設計\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E8%B5%B7%E5%8B%95%E3%82%B7%E3%83%BC%E3%82%B1%E3%83%B3%E3%82%B9\"\u003e起動シーケンス\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#putdata-%E3%82%B7%E3%83%BC%E3%82%B1%E3%83%B3%E3%82%B9\"\u003ePutData シーケンス\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#getdata-%E3%82%B7%E3%83%BC%E3%82%B1%E3%83%B3%E3%82%B9\"\u003eGetData シーケンス\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#grpc-%E3%81%AE%E9%96%8B%E7%99%BA%E7%92%B0%E5%A2%83c%E3%81%AE%E4%BD%9C%E6%88%90%E6%96%B9%E6%B3%95\"\u003egRPC の開発環境(C#)の作成方法\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#grpc-%E3%81%AE%E5%AE%9F%E8%A3%85%E4%BE%8Bc\"\u003egRPC の実装例(C#)\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%87%E3%83%A2\"\u003eデモ\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":4241,"uuid":"ca29ac2e964efde290b4","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"NU3+vc+ldoi1Snl8DAanngvpNak5--5nk6H9GLq0FhFqSh--7bjxejNC94J8fC8H9sYe8A==","originalId":244147,"description":"福井在住の組み込みエンジニアです。\r\n","facebookUrl":null,"githubUrl":"https://github.com/tmori","isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"Mori Takashi","profileImageUrl":"https://qiita-image-store.s3.amazonaws.com/0/244147/profile-images/1521194241","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F244147%2Fprofile-images%2F1521194241?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=9eafab00ebc3e86d9176aba132a51ca9","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F244147%2Fprofile-images%2F1521194241?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=325138be382e01eec6bda93808426525","urlName":"kanetugu2018","websiteUrl":"https://github.com/tmori/athrill","twitterUrl":"https://twitter.com/kanetugu2020","twitterUrlName":"kanetugu2020","revealedOrganizations":{"edges":[{"node":{"encryptedId":"KlmR3Jp556Repi1aS9XoCjtSN+MjeL6fydB4--2lQ9QpmrJDqNR52C--PkXdmay25StiOe8bPIR+kw==","isBetaReleaseEnabled":false,"isFollowableByViewer":false,"isFollowedByViewer":false,"name":"TOPPERSプロジェクト","logoUrl":"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/15f86c00df3e23fa7f3c62633af7a3506aed3298/original.jpg?1604470458","urlName":"toppers","description":"TOPPERSプロジェクトは、ITRON仕様の技術開発成果を出発点として、組込みシステム構築の基盤となる各種のソフトウェアを開発し、良質なオープンソースソフトウェアとして公開することで、組込みシステム技術と産業の振興を図ることを目的としたプロジェクトです。","url":"https://www.toppers.jp/"}}]}},"tags":[{"name":"C#","urlName":"csharp"},{"name":"TOPPERS","urlName":"toppers"},{"name":"astah","urlName":"astah"},{"name":"gRPC","urlName":"grpc"},{"name":"箱庭","urlName":"%e7%ae%b1%e5%ba%ad"}],"followingLikers":{"edges":[]},"comments":{"totalCount":0}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

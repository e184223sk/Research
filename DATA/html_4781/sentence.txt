More than 3 years have passed since last update.筆者の恥ずかしい失敗談を晒すエントリです。
まずはこちらをご覧ください。このとき isInt と tmp がコンソールに出力する値はなんでしょう？そんなのは当たり前だ、という賢明な諸氏は特にこの記事から得るものはないのでそっとタブを閉じてやってください。で、そんなのは当たり前ではなかった筆者の恥晒し誤答はこちら。isInt が false になるのは期待どおりですが、問題が out 変数に指定していた tmp で、こちらは 10 が出力される、と思い込んでいました。数値に変換できない値を渡した場合であっても out に代入はされる んですね。なので tmp に予め 10 を格納しておいても全く意味がないということです。変換に失敗した場合は 0 を格納します。しっかり書かれてました。みなさん、公式ドキュメントはよく読みましょう(ブーメラン)ちょっと気になったので軽くソースを見てみることにしました。
この記事を参考にさせていただきました。
https://qiita.com/Marimoiro/items/e255eecc265cd5a45025int は言わずもがな System.Int32 のエイリアスです。
なので今回見たいのは System.Int32 クラスのドキュメントになります。さっそく見てみます。
https://docs.microsoft.com/ja-jp/dotnet/csharp/language-reference/language-specification/types#simple-types実際には Number.TryParseInt32 が実質的な処理を行っているようですね。というわけで次へ進みます。https://referencesource.microsoft.com/#mscorlib/system/number.cs,958cb8bc00d00a94
メソッドもそうなんですが、Numberクラス自体も internal であるため、基本はプログラマーが呼び出して使うようなクラスではなさそうですね。んで、問題の out 引数への代入はメソッド開始から3行目で早々に行われていることがわかります。中の実装まで見なくてもメソッドの挙動から明らかではありますが、out を付けた引数は参照渡しになります。
なのでこの代入によって先ほどの問題の tmp = 10 が書き換えられていることは間違いなさそうです。@albireo さんからのコメントを参考に、out引数を持つメソッドを自作して確認してみたところ、そもそもout引数に対してメソッド内で何も値を代入しないとコンパイルエラーになることがわかりました。少なくともout引数が何らかの書き換えが行われていることは確実と言えます。これでもう同じ失敗は繰り返さないでしょうｗ
最後まで読んで下さりありがとうございました。



More than 3 years have passed since last update.Windowsフォームアプリケーションで、閉じるボタン(ウィンドウ右上の×ボタン)を押した際に終了確認用メッセージボックスを出力したい場合があると思います。しかし、別のアプリケーションからProcessクラスのCloseMainWindow()メソッドを実行してウィンドウを閉じる場合は終了確認用メッセージボックスを出力したくない場合もあるかと思います。その対処法を記述します。CloseMainWindow()メソッドが実行されるとCloseReasonプロパティにCloseReason.TaskManagerClosingがセットされます。
しかし、先に閉じるボタンを押して、表示されるメッセージボックスで「いいえ」ボタンを押してクローズ処理をキャンセルする等してCloseReasonプロパティにCloseReason.None以外がセットされると、CloseMainWindow()メソッドが実行されてもCloseReasonプロパティにCloseReason.TaskManagerClosingがセットされません。
そこで、クローズ処理がキャンセルされた場合は、リフレクションを使用してCloseReasonプロパティにCloseReason.Noneをセットしています。
これで期待通りの動作を実現できました。Reference Source - Microsoft不備がございましたら、ご指摘いただければ幸いです。



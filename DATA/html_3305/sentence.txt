More than 1 year has passed since last update.Unity標準の録音機能だとあらかじめ録音時間を指定した固定長でしか録音できません。途中で録音を止めると残り時間に無音データを詰め込まれたものが出てきます。
普通の用途ならこのやり方で必要な長さのAudioClipを作ってUnityWav1で変換をかければ十分だと思います。自分の場合は以下の条件が追加されたので一捻りする必要がありました。gist探すと理屈を解説した記事は見つかるのですが、何故かコピペしてそのまま使えるやつはなかったので、いろんなところからコピペして切り貼りしました。なんかめっちゃかけ算？　してるな？　ぐらいの理解度だ！
特にCreateWriteBufferでバッファを使い切って最初からになったときの処理。
(バッファのヘッドから最後まで) + (バッファの最初から現在のポジションまで)
ですがちょっとくらい取りこぼしててもバレへんやろの精神です。Enumerable.Range()とかで配列作れば確認できますがめんどくせえのでしてません。
Frequencyは44100でしか確認してないので他のサンプリングレートで動くかは未確認。
MaxLengthSecは600なので結局10分もメモリを確保してます。状況に合わせて削ってください。理屈の上では10もあれば動くはずです。using()使ってない
微妙に使い方がまだよくわかってないやつ。
この手のリソースを自動で閉じておいてくれる記法としてはJavaのtry-with-resourcesがいちばん優れてるような気がするんですが、どこも導入してくれなくてつらい。成否がわからない
途中で録音に失敗してもなんらかのゴミファイルは作成されてしまう。なので成否のコールバックが必要だが……。
StopRecordをTaskに置き換えて成否のboolを返すとか。IsRecordingを外部に公開している
内部処理用のフラグと外部公開用のフラグは分割するべき。MonoBehaviourを継承している
コルーチンがなければ継承の必要がない。のでできればTaskにしたい。が、UnityのApiはメインスレッドからしか実行できないのでTaskにすると管理がめんどくせえ！メインスレッドでファイルを書き込みしてる
せめてバッファ変換・ファイル書き込みをワーカースレッドに逃したい。別にそんな処理重くないっぽいけど一応。こんなコードが上がってきたらコードレビューで撥ねますが、まあ動いてるしいいかなって思いました。おしまい。【Unity】長時間のマイク録音を実現する方法
【Unity】AudioListerを録音してwavにする
UnityのMicrophoneで正確な録音時間を取得する方法なんか適当なパスにファイル保存しちゃうのなんで？ ↩



<!DOCTYPE html><html><head><meta charset="utf-8" /><title>Visual Studioでのデザイン時DataContextに適切なViewModelを供給するMarkupExtension - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/soi/items/811a14f7a3822370f33f" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="p/U8dD5WxhGkyYJDTxaZZoFzbneRziYtMW+HIQl1SThE+xFwf69uC7ztQeUPFsV0jehLmuivQJTjciazH2RkdQ==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta content="@soi2flatline" name="twitter:creator" /><meta property="og:type" content="article"><meta property="og:title" content="Visual Studioでのデザイン時DataContextに適切なViewModelを供給するMarkupExtension - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1WbWx6ZFdGc0lGTjBkV1JwYi1PQnAtT0JydU9EaC1PQ3R1T0NwT09Ecy1hWmdrUmhkR0ZEYjI1MFpYaDA0NEdyNllHcDVZaUg0NEdxVm1sbGQwMXZaR1ZzNDRLUzVMNmI1N1dtNDRHWjQ0S0xUV0Z5YTNWd1JYaDBaVzV6YVc5dSZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTU0JnR4dC1jbGlwPWVsbGlwc2lzJnR4dC1hbGlnbj1jZW50ZXIlMkNtaWRkbGUmcz02YzRjNTcwOGRiOGNhZDQ0YTdhODU2ODk3ZWMyNmRjNw&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RSE52YVEmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT00NSZ0eHQtYWxpZ249cmlnaHQlMkNib3R0b20mcz1jY2U0NzBlOTc2ZmUyMWVmODI0NTAxZDY0NDlhYTIxOA&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=58b704f26f1ae35d87816394f8ee9ef5"><meta property="og:description" content="

概要

この記事は、XAML Advent Calendar 2017の10日目の記事です。

ViewとViewModelをどうやって紐付けるかはMVVMでは一度は必ず悩む問題だと思います。
私はDataTemplateでVie..."><meta content="https://qiita.com/soi/items/811a14f7a3822370f33f" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#,.NET,WPF,VisualStudio,Xaml" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 1nzh4zz 38fzdi helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-1nzh4zz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:16px 32px;background-color:#FBE69E;color:rgba(0,0,0,0.87);line-height:1.5;font-weight:600;}@media (max-width:770px){.css-1nzh4zz{padding:16px;}}.css-38fzdi{color:#CA832A;margin-right:4px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-847794b6-6650-4d4f-83ea-dbd4e6005576"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Fsoi%2Fitems%2F811a14f7a3822370f33f">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Fsoi%2Fitems%2F811a14f7a3822370f33f">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-847794b6-6650-4d4f-83ea-dbd4e6005576">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2017-12-09T19:11:30.000+09:00","dateModified":"2018-03-16T13:01:12.000+09:00","headline":"Visual Studioでのデザイン時DataContextに適切なViewModelを供給するMarkupExtension","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1WbWx6ZFdGc0lGTjBkV1JwYi1PQnAtT0JydU9EaC1PQ3R1T0NwT09Ecy1hWmdrUmhkR0ZEYjI1MFpYaDA0NEdyNllHcDVZaUg0NEdxVm1sbGQwMXZaR1ZzNDRLUzVMNmI1N1dtNDRHWjQ0S0xUV0Z5YTNWd1JYaDBaVzV6YVc5dSZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTU0JnR4dC1jbGlwPWVsbGlwc2lzJnR4dC1hbGlnbj1jZW50ZXIlMkNtaWRkbGUmcz02YzRjNTcwOGRiOGNhZDQ0YTdhODU2ODk3ZWMyNmRjNw\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RSE52YVEmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT00NSZ0eHQtYWxpZ249cmlnaHQlMkNib3R0b20mcz1jY2U0NzBlOTc2ZmUyMWVmODI0NTAxZDY0NDlhYTIxOA\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=58b704f26f1ae35d87816394f8ee9ef5","mainEntityOfPage":"https://qiita.com/soi/items/811a14f7a3822370f33f","author":{"@type":"Person","address":"","email":null,"identifier":"soi","name":"soi","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F120077%2Fprofile-images%2F1473714466?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=e5a35cbc09752410b5c78938fa1e1273","url":"https://qiita.com/soi","description":"ソフトウェアエンジニア\r\nC#, Xaml チョットワカル","memberOf":[]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://zine.qiita.com/interview/202105-uzabase/?utm_source=qiita&amp;utm_medium=header-banner">プロダクト全体の「エコシステム」を考えるユーザベースの開発手法とは？</a><a target="_blank" id="header_text_message_2" href="https://zine.qiita.com/interview/202105-uzabase/?utm_source=qiita&amp;utm_medium=header-banner">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"soi","type":"items","id":"811a14f7a3822370f33f"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"プロダクト全体の「エコシステム」を考えるユーザベースの開発手法とは？","url":"https://zine.qiita.com/interview/202105-uzabase/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"soi","type":"items","id":"811a14f7a3822370f33f"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_1","message":"プロダクト全体の「エコシステム」を考えるユーザベースの開発手法とは？","url":"https://zine.qiita.com/interview/202105-uzabase/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"soi","type":"items","id":"811a14f7a3822370f33f"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_2","message":"プロダクト全体の「エコシステム」を考えるユーザベースの開発手法とは？","url":"https://zine.qiita.com/interview/202105-uzabase/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/soi/items/811a14f7a3822370f33f","location":"/soi/items/811a14f7a3822370f33f","scheme":"https","host":"qiita.com","port":null,"pathname":"/soi/items/811a14f7a3822370f33f","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"ZXX4Ish7c5660P6iPaUXMetTetybWV0anyADT9pvBoqGe9UmiYLbhKL0PQR9pUsj58hfMeI4O6NNPaLdzH4rxw==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-3d7d9d19-f0bf-458d-82c7-af81a6a9cb4a"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/soi/items/811a14f7a3822370f33f/likers" class="css-1iupg5d">9</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">7</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/811a14f7a3822370f33f/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/soi/items/811a14f7a3822370f33f/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/soi/items/811a14f7a3822370f33f/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/soi/items/811a14f7a3822370f33f/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/soi/items/811a14f7a3822370f33f.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-1nzh4zz"><span class="fa fa-fw fa-warning css-38fzdi"></span><p>More than 3 years have passed since last update.</p></div><div class="css-helsa7"><div class="css-8qb8m4"><div class="it-AdcalRibbon"><span><a href="/advent-calendar/2017/xaml" class="it-AdcalRibbon_title">XAML<!-- --> Advent Calendar<!-- --> <!-- -->2017</a>Day 10</span></div><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/soi"><img class="css-100alwu eyfquo10" src="https://qiita-image-store.s3.amazonaws.com/0/120077/profile-images/1473714466" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/soi" class="css-10ougpm">@<!-- -->soi</a><div class="css-1ay9vb9"><span><meta content="2017-12-09T10:11:30Z"/><time dateTime="2018-03-16T04:01:12Z" class="css-m19uds">updated at 2018-03-16</time></span></div></div></div></div></div><h1 class="css-cgzq40">Visual Studioでのデザイン時DataContextに適切なViewModelを供給するMarkupExtension</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/.net" class="css-4czcte">.NET</a><a href="/tags/wpf" class="css-4czcte">WPF</a><a href="/tags/visualstudio" class="css-4czcte">VisualStudio</a><a href="/tags/xaml" class="css-4czcte">Xaml</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div>
<h1>
<span id="概要" class="fragment"></span><a href="#%E6%A6%82%E8%A6%81"><i class="fa fa-link"></i></a>概要</h1>

<p>この記事は、XAML Advent Calendar 2017の10日目の記事です。</p>

<p>ViewとViewModelをどうやって紐付けるかはMVVMでは一度は必ず悩む問題だと思います。<br>
私はDataTemplateでViewModel→Viewの登録を行うことが多いです。<br>
しかしVisualStudioでのデザイン時データコンテキスト(<code>d:DataContext</code>)ではその登録とは別に、ViewModelを指定する必要があります。</p>

<p>そこでデザイン時にDataTemplateの情報を元に適切なViewModelを自動配置してくれるMarkupExtensionを作りました。</p>

<h1>
<span id="実行結果" class="fragment"></span><a href="#%E5%AE%9F%E8%A1%8C%E7%B5%90%E6%9E%9C"><i class="fa fa-link"></i></a>実行結果</h1>

<p>題材とするデモアプリの実行結果です。</p>

<p><a href="https://camo.qiitausercontent.com/b30da39f777c66ec15f6f595414e891292316448/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3132303037372f65376237613133362d643839322d303936382d303032302d3737316631313331363530662e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F120077%2Fe7b7a136-d892-0968-0020-771f1131650f.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=bf114282b01705b12e43d6c665eb83bc" alt="スクリーンショット 2017-12-09 17.45.08.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/120077/e7b7a136-d892-0968-0020-771f1131650f.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F120077%2Fe7b7a136-d892-0968-0020-771f1131650f.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=093a7e321c594911f73473ad5fac3f0d 1x" loading="lazy"></a></p>

<p>MainWindowの中に2つのUserControlがあるだけです。</p>

<h1>
<span id="変更前デモアプリコード" class="fragment"></span><a href="#%E5%A4%89%E6%9B%B4%E5%89%8D%E3%83%87%E3%83%A2%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B3%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>変更前デモアプリコード</h1>

<p>今回のMarkupExtension導入前のコードです。<br>
MainWindowではUserControlを直接指定せず、ContentControlに子ViewModelを指定しています。</p>

<div class="code-frame" data-lang="xml">
<div class="code-lang"><span class="bold">MainWindow.xaml</span></div>
<div class="highlight"><pre class="with-code"><code><span class="nt">&lt;Window</span>
    <span class="na">x:Class=</span><span class="s">"DataTemplateByCode2.MainWindow"</span>
    <span class="na">xmlns=</span><span class="s">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span>
    <span class="na">xmlns:x=</span><span class="s">"http://schemas.microsoft.com/winfx/2006/xaml"</span>
    <span class="na">xmlns:d=</span><span class="s">"http://schemas.microsoft.com/expression/blend/2008"</span>
    <span class="na">xmlns:local=</span><span class="s">"clr-namespace:DataTemplateByCode2"</span>
    <span class="na">xmlns:mc=</span><span class="s">"http://schemas.openxmlformats.org/markup-compatibility/2006"</span>
    <span class="na">Title=</span><span class="s">"MainWindow"</span> <span class="na">Width=</span><span class="s">"300"</span> <span class="na">Height=</span><span class="s">"150"</span> <span class="na">mc:Ignorable=</span><span class="s">"d"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Window.DataContext&gt;</span>
        <span class="nt">&lt;local:MainWindowViewModel</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/Window.DataContext&gt;</span>
    <span class="nt">&lt;StackPanel&gt;</span>
        <span class="nt">&lt;TextBlock</span> <span class="na">Text=</span><span class="s">"VM -&gt; View"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;ContentControl</span> <span class="na">Content=</span><span class="s">"{Binding MyUc1VM}"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;ContentControl</span> <span class="na">Content=</span><span class="s">"{Binding MyUc2VM}"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/StackPanel&gt;</span>
<span class="nt">&lt;/Window&gt;</span>
</code></pre></div>
</div>

<p>UserControlではVMのプロパティ<code>Title</code>とバインディングしています。</p>

<div class="code-frame" data-lang="xml">
<div class="code-lang"><span class="bold">MyUc1.xaml</span></div>
<div class="highlight"><pre class="with-code"><code><span class="nt">&lt;UserControl</span>
    <span class="na">x:Class=</span><span class="s">"DataTemplateByCode2.MyUc1"</span>
    <span class="na">xmlns=</span><span class="s">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span>
    <span class="na">xmlns:x=</span><span class="s">"http://schemas.microsoft.com/winfx/2006/xaml"</span>
    <span class="na">xmlns:d=</span><span class="s">"http://schemas.microsoft.com/expression/blend/2008"</span>
    <span class="na">xmlns:local=</span><span class="s">"clr-namespace:DataTemplateByCode2"</span>
    <span class="na">xmlns:mc=</span><span class="s">"http://schemas.openxmlformats.org/markup-compatibility/2006"</span>
    <span class="na">d:DesignHeight=</span><span class="s">"50"</span> <span class="na">d:DesignWidth=</span><span class="s">"200"</span> <span class="na">Background=</span><span class="s">"LightGreen"</span>
    <span class="na">mc:Ignorable=</span><span class="s">"d"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;StackPanel&gt;</span>
        <span class="nt">&lt;TextBlock</span> <span class="na">Text=</span><span class="s">"{Binding Text}"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/StackPanel&gt;</span>
<span class="nt">&lt;/UserControl&gt;</span>
</code></pre></div>
</div>

<p>MainWindowViewModelには2つのVMがプロパティとしてあります。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">MainWindowViewModel.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">MainWindowViewModel</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="n">MyUc1ViewModel</span> <span class="n">MyUc1VM</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MyUc1ViewModel</span><span class="p">();</span>
    <span class="k">public</span> <span class="n">MyUc2ViewModel</span> <span class="n">MyUc2VM</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MyUc2ViewModel</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>UserControlに対応するViewModelには1つプロパティがあるだけです。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">MyUc1ViewModel.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">MyUc1ViewModel</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Title</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="s">"TEXT FROM MyUc1ViewModel"</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>App.xamlと別ResourceDictionaryでDataTemplateを使ってVM→Viewの登録を行います。<br>
App.xaml直下と別ファイルに分けたのは単なる動作確認で普通は統一します。</p>

<div class="code-frame" data-lang="xml">
<div class="code-lang"><span class="bold">App.xaml</span></div>
<div class="highlight"><pre class="with-code"><code><span class="nt">&lt;Application</span>
    <span class="na">x:Class=</span><span class="s">"DataTemplateByCode2.App"</span>
    <span class="na">xmlns=</span><span class="s">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span>
    <span class="na">xmlns:x=</span><span class="s">"http://schemas.microsoft.com/winfx/2006/xaml"</span>
    <span class="na">xmlns:local=</span><span class="s">"clr-namespace:DataTemplateByCode2"</span>
    <span class="na">StartupUri=</span><span class="s">"MainWindow.xaml"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Application.Resources&gt;</span>
        <span class="nt">&lt;ResourceDictionary&gt;</span>
            <span class="nt">&lt;ResourceDictionary.MergedDictionaries&gt;</span>
                <span class="nt">&lt;ResourceDictionary</span> <span class="na">Source=</span><span class="s">"Templates.xaml"</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;/ResourceDictionary.MergedDictionaries&gt;</span>
            <span class="nt">&lt;DataTemplate</span> <span class="na">DataType=</span><span class="s">"{x:Type local:MyUc1ViewModel}"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;local:MyUc1</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;/DataTemplate&gt;</span>
        <span class="nt">&lt;/ResourceDictionary&gt;</span>
    <span class="nt">&lt;/Application.Resources&gt;</span>
<span class="nt">&lt;/Application&gt;</span>
</code></pre></div>
</div>

<div class="code-frame" data-lang="xml">
<div class="code-lang"><span class="bold">Templates.xaml</span></div>
<div class="highlight"><pre class="with-code"><code><span class="nt">&lt;ResourceDictionary</span> <span class="na">xmlns=</span><span class="s">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span>
                    <span class="na">xmlns:x=</span><span class="s">"http://schemas.microsoft.com/winfx/2006/xaml"</span>
                    <span class="na">xmlns:local=</span><span class="s">"clr-namespace:DataTemplateByCode2"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;DataTemplate</span> <span class="na">DataType=</span><span class="s">"{x:Type local:MyUc2ViewModel}"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;local:MyUc2/&gt;</span>
    <span class="nt">&lt;/DataTemplate&gt;</span>
<span class="nt">&lt;/ResourceDictionary&gt;</span>
</code></pre></div>
</div>

<p>もう1つのUserControlと対応するViewModelは背景色と文字列の内容が違うだけなので省略します。</p>

<h1>
<span id="課題" class="fragment"></span><a href="#%E8%AA%B2%E9%A1%8C"><i class="fa fa-link"></i></a>課題</h1>

<p>UserControlにおいて、このままですとデザイナ画面にVM由来の文字列が表示されません。<br>
<a href="https://camo.qiitausercontent.com/8e6109565eca1813b4682d7512f449a57a27485b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3132303037372f31396164306464622d643130632d663837312d373932612d6466626365323665333165342e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F120077%2F19ad0ddb-d10c-f871-792a-dfbce26e31e4.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=38ee35c99ddb37989430964a90f141b6" alt="スクリーンショット 2017-12-09 18.28.42.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/120077/19ad0ddb-d10c-f871-792a-dfbce26e31e4.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F120077%2F19ad0ddb-d10c-f871-792a-dfbce26e31e4.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=4854787ee8cbeeaff57aaae5c7ed6569 1x" loading="lazy"></a></p>

<p>そこでXAML内でデザイン時DataContextを指定します。<br>
先程のMyUc1.xamlのUserControl句の最後に追加します。</p>

<div class="code-frame" data-lang="xml">
<div class="code-lang"><span class="bold">MyUc1.xaml(部分）</span></div>
<div class="highlight"><pre class="with-code"><code>mc:Ignorable="d"
d:DataContext="{d:DesignInstance {x:Type local:MyUc2ViewModel},IsDesignTimeCreatable=True}"&gt;
</code></pre></div>
</div>

<p>無事にデザイナ画面でもViewModel由来の文字列が追加されました。<br>
<a href="https://camo.qiitausercontent.com/0c83111fd61a79e14a3a43fce2e37c0eb81c6b8b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3132303037372f34653238376539352d646535662d616431352d313535642d3639306537306533636266662e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F120077%2F4e287e95-de5f-ad15-155d-690e70e3cbff.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=1560ca9a5523ed149df57da6bad9c7dc" alt="スクリーンショット 2017-12-09 18.28.17.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/120077/4e287e95-de5f-ad15-155d-690e70e3cbff.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F120077%2F4e287e95-de5f-ad15-155d-690e70e3cbff.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=3959d7e90a176f7b58e180ad6acdc24a 1x" loading="lazy"></a></p>

<p>しかしこのままですと重複があります。<br>
つまり<br>
・DataTemplateではViewModel→View<br>
・各Viewのd:DataContextではView→ViewModel<br>
の結びつけが行われており、内容が重複している。</p>

<p>View⇔ViewModel間の組み合わせが変わったら両者を変更する必要があります。<br>
DataTemplateだけ修正してd:DataContexがそのままの場合、<br>
実行時エラーは何も出ませんが、デザイナ画面がエラーしたり、デザイン時と実行時で画面が異なってしまいます。<br>
実は上のコードもUc1にUc2ViewModelを指定していますが、なかなか気づきづらいと思います。</p>

<h1>
<span id="markupextensionの導入" class="fragment"></span><a href="#markupextension%E3%81%AE%E5%B0%8E%E5%85%A5"><i class="fa fa-link"></i></a>MarkupExtensionの導入</h1>

<p>そこでDataTemplateを元にView型から対応するViewModelを供給するMarkupExtensionを使ってこの課題を解決します。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">ViewModelProviderExtension.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="c1">/// &lt;summary&gt;</span>
<span class="c1">/// DataTemplateを元にView型から対応するViewModelを供給するMarkupExtension</span>
<span class="c1">/// &lt;/summary&gt;</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">ViewModelProviderExtension</span> <span class="p">:</span> <span class="n">MarkupExtension</span>
<span class="p">{</span>
    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">/// 検索するView型</span>
    <span class="c1">/// &lt;/summary&gt;</span>
    <span class="k">public</span> <span class="n">Type</span> <span class="n">ViewType</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="k">public</span> <span class="nf">ViewModelProviderExtension</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span>

    <span class="k">public</span> <span class="nf">ViewModelProviderExtension</span><span class="p">(</span><span class="n">Type</span> <span class="n">viewType</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="n">ViewType</span> <span class="p">=</span> <span class="n">viewType</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">override</span> <span class="kt">object</span> <span class="nf">ProvideValue</span><span class="p">(</span><span class="n">IServiceProvider</span> <span class="n">provider</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//現在のアプリケーションのResourceDictionaryと入れ子になっているResourceDictionaryを平坦化</span>
        <span class="kt">var</span> <span class="n">resources</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">ResourceDictionary</span><span class="p">&gt;</span> <span class="p">{</span> <span class="n">Application</span><span class="p">.</span><span class="n">Current</span><span class="p">.</span><span class="n">Resources</span> <span class="p">};</span>
        <span class="n">resources</span><span class="p">.</span><span class="nf">AddRange</span><span class="p">(</span><span class="n">Application</span><span class="p">.</span><span class="n">Current</span><span class="p">.</span><span class="n">Resources</span><span class="p">.</span><span class="n">MergedDictionaries</span><span class="p">);</span>

        <span class="kt">var</span> <span class="n">dataTemplateExs</span> <span class="p">=</span> <span class="n">resources</span>
            <span class="c1">//ResourceからValueを取り出しDataTemplate型だけ抽出して平坦化</span>
            <span class="p">.</span><span class="nf">SelectMany</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Values</span><span class="p">.</span><span class="n">OfType</span><span class="p">&lt;</span><span class="n">DataTemplate</span><span class="p">&gt;())</span>
            <span class="c1">//DataTemplateを匿名型に変換</span>
            <span class="p">.</span><span class="nf">Select</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span>
                <span class="k">new</span>
                <span class="p">{</span>
                    <span class="c1">//Contentを生成してView型情報に変換</span>
                    <span class="n">viewType</span> <span class="p">=</span> <span class="n">x</span><span class="p">.</span><span class="nf">LoadContent</span><span class="p">().</span><span class="nf">GetType</span><span class="p">(),</span>
                    <span class="c1">//DataTypeをViewModel型情報に変換</span>
                    <span class="n">viewModelType</span> <span class="p">=</span> <span class="n">x</span><span class="p">.</span><span class="n">DataType</span> <span class="k">as</span> <span class="n">Type</span>
                <span class="p">});</span>

        <span class="c1">//一致するView型を探し、対応するViewModel型を選択</span>
        <span class="kt">var</span> <span class="n">selectViewModelType</span> <span class="p">=</span> <span class="n">dataTemplateExs</span>
            <span class="p">.</span><span class="nf">FirstOrDefault</span><span class="p">(</span><span class="n">a</span> <span class="p">=&gt;</span> <span class="n">a</span><span class="p">.</span><span class="n">viewType</span> <span class="p">==</span> <span class="n">ViewType</span><span class="p">)</span>
            <span class="p">?.</span><span class="n">viewModelType</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">selectViewModelType</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="c1">//該当するViewModel型を作成</span>
        <span class="kt">var</span> <span class="n">vm</span> <span class="p">=</span> <span class="n">Activator</span><span class="p">.</span><span class="nf">CreateInstance</span><span class="p">(</span><span class="n">selectViewModelType</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">vm</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>ViewModelProviderの実装の説明はコード内に書いたので、そちらを参照下さい。<br>
使用方法はViewModelProviderのコンストラクタに<strong>Viewの型</strong>をわたして、<code>d:DataContext</code>に指定します。</p>

<div class="code-frame" data-lang="xml">
<div class="code-lang"><span class="bold">MyUc1.xaml(部分）</span></div>
<div class="highlight"><pre class="with-code"><code>mc:Ignorable="d"
d:DataContext="{local:ViewModelProvider {x:Type local:MyUc1}}"&gt;
</code></pre></div>
</div>

<p>デザイナ画面も無事直りました。<br>
<a href="https://camo.qiitausercontent.com/110bd774efcfccbe1a7fc092cf93963c9468620f/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3132303037372f31323061353337302d386461632d616135632d356331342d3532386337393537343539322e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F120077%2F120a5370-8dac-aa5c-5c14-528c79574592.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=3bb92d4c0bb2335ddbc7130fc1dbe655" alt="スクリーンショット 2017-12-09 18.49.31.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/120077/120a5370-8dac-aa5c-5c14-528c79574592.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F120077%2F120a5370-8dac-aa5c-5c14-528c79574592.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=a2f97e815280eee90af9ac0a370a6e6c 1x" loading="lazy"></a></p>

<h1>
<span id="実行時にも使用可能" class="fragment"></span><a href="#%E5%AE%9F%E8%A1%8C%E6%99%82%E3%81%AB%E3%82%82%E4%BD%BF%E7%94%A8%E5%8F%AF%E8%83%BD"><i class="fa fa-link"></i></a>実行時にも使用可能</h1>

<p>必要性があるかはわかりませんが、実行時にも使用可能です。<br>
先程のMainWindowを修正します。</p>

<div class="code-frame" data-lang="xml">
<div class="code-lang"><span class="bold">MainWindow.xaml（部分）</span></div>
<div class="highlight"><pre class="with-code"><code><span class="nt">&lt;StackPanel&gt;</span>
    <span class="nt">&lt;TextBlock</span> <span class="na">Text=</span><span class="s">"VM -&gt; View"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;ContentControl</span> <span class="na">Content=</span><span class="s">"{Binding MyUc1VM}"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;ContentControl</span> <span class="na">Content=</span><span class="s">"{Binding MyUc2VM}"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;TextBlock/&gt;</span>
    <span class="nt">&lt;TextBlock</span> <span class="na">Text=</span><span class="s">"View -&gt; VM"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;local:MyUc1</span> <span class="na">DataContext=</span><span class="s">"{local:ViewModelProvider {x:Type local:MyUc1}}"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;local:MyUc2</span> <span class="na">DataContext=</span><span class="s">"{local:ViewModelProvider {x:Type local:MyUc2}}"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/StackPanel&gt;</span>
</code></pre></div>
</div>

<p>実行結果です<br>
<a href="https://camo.qiitausercontent.com/614a15656176f5bd8f833b4f5c3f5a291dd3784b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3132303037372f61663865363962652d646665312d616233372d376335352d6264343732333438633633652e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F120077%2Faf8e69be-dfe1-ab37-7c55-bd472348c63e.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=67672caab8167c22efb5f185444afc4e" alt="スクリーンショット 2017-12-09 18.56.56.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/120077/af8e69be-dfe1-ab37-7c55-bd472348c63e.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F120077%2Faf8e69be-dfe1-ab37-7c55-bd472348c63e.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=32926700befdf4a5665c01f6312e33ba 1x" loading="lazy"></a></p>

<p>ContentControlがViewModelからViewを表示するように<br>
ViewModelProviderがViewに対応したViewModelを供給します。</p>

<h1>
<span id="まとめ" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>まとめ</h1>

<p>デザイン時DataContextはVMの内容を反映したデザインを確認しながらViewを編集できるので便利です。<br>
今回のViewModelProviderを使用するとViewに対応したViewModelが自動で供給されます。<br>
これにより、DataTemplateと重複した記述が削れることと、実行時と違うViewModelを使用するのを防ぐことが出来ます。</p>

<h1>
<span id="注意点" class="fragment"></span><a href="#%E6%B3%A8%E6%84%8F%E7%82%B9"><i class="fa fa-link"></i></a>注意点</h1>

<p>このMarkupExtensionは内部でDataTemplateにある<strong>全ての</strong>Viewのインスタンス生成を行います。<br>
ですのでViewが増えたり、特定のViewのインスタンス生成が重いとデザイナ画面が極端に重くなります。</p>

<p>追伸：ViewTypeを書かずに済むように自動で取得する方法があったら教えてください。</p>

<h1>
<span id="環境" class="fragment"></span><a href="#%E7%92%B0%E5%A2%83"><i class="fa fa-link"></i></a>環境</h1>

<p>VisualStudio2017<br>
.NET Framework 4.7<br>
C#7.1</p>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Fsoi%2Fitems%2F811a14f7a3822370f33f&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Fsoi%2Fitems%2F811a14f7a3822370f33f&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/soi/items/811a14f7a3822370f33f/likers" class="css-1iupg5d">9</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">7</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/811a14f7a3822370f33f/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/soi/items/811a14f7a3822370f33f/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/soi/items/811a14f7a3822370f33f/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/soi/items/811a14f7a3822370f33f/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/soi/items/811a14f7a3822370f33f.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-3d7d9d19-f0bf-458d-82c7-af81a6a9cb4a">{"authorAnalyticsTrackingId":null,"organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-f6da5ff7-8349-4b1a-8e91-ded3bc9d3525"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-f6da5ff7-8349-4b1a-8e91-ded3bc9d3525">{}</script>
      
<div id="LoginModal-react-component-746b34d5-5f9c-49be-94e9-176e8143aee3"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-746b34d5-5f9c-49be-94e9-176e8143aee3">{}</script>
      
<div id="StockModal-react-component-56edc940-6693-482d-b1ba-f12424508f2f"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-56edc940-6693-482d-b1ba-f12424508f2f">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;D7I2lqlCpZe78SfE9iMz8jaavPWfLil6qC6Kvzm01IHsvBuS6LsNjaPV5GK2I2/gOgGZGOZPT8N6MystL6X5zA==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\n\u003ch1\u003e\n\u003cspan id=\"概要\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%A6%82%E8%A6%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e概要\u003c/h1\u003e\n\n\u003cp\u003eこの記事は、XAML Advent Calendar 2017の10日目の記事です。\u003c/p\u003e\n\n\u003cp\u003eViewとViewModelをどうやって紐付けるかはMVVMでは一度は必ず悩む問題だと思います。\u003cbr\u003e\n私はDataTemplateでViewModel→Viewの登録を行うことが多いです。\u003cbr\u003e\nしかしVisualStudioでのデザイン時データコンテキスト(\u003ccode\u003ed:DataContext\u003c/code\u003e)ではその登録とは別に、ViewModelを指定する必要があります。\u003c/p\u003e\n\n\u003cp\u003eそこでデザイン時にDataTemplateの情報を元に適切なViewModelを自動配置してくれるMarkupExtensionを作りました。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"実行結果\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%9F%E8%A1%8C%E7%B5%90%E6%9E%9C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e実行結果\u003c/h1\u003e\n\n\u003cp\u003e題材とするデモアプリの実行結果です。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/b30da39f777c66ec15f6f595414e891292316448/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3132303037372f65376237613133362d643839322d303936382d303032302d3737316631313331363530662e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F120077%2Fe7b7a136-d892-0968-0020-771f1131650f.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=bf114282b01705b12e43d6c665eb83bc\" alt=\"スクリーンショット 2017-12-09 17.45.08.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/120077/e7b7a136-d892-0968-0020-771f1131650f.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F120077%2Fe7b7a136-d892-0968-0020-771f1131650f.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=093a7e321c594911f73473ad5fac3f0d 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eMainWindowの中に2つのUserControlがあるだけです。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"変更前デモアプリコード\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%A4%89%E6%9B%B4%E5%89%8D%E3%83%87%E3%83%A2%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B3%E3%83%BC%E3%83%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e変更前デモアプリコード\u003c/h1\u003e\n\n\u003cp\u003e今回のMarkupExtension導入前のコードです。\u003cbr\u003e\nMainWindowではUserControlを直接指定せず、ContentControlに子ViewModelを指定しています。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"xml\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eMainWindow.xaml\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"nt\"\u003e\u0026lt;Window\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ex:Class=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"DataTemplateByCode2.MainWindow\"\u003c/span\u003e\n    \u003cspan class=\"na\"\u003exmlns=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"http://schemas.microsoft.com/winfx/2006/xaml/presentation\"\u003c/span\u003e\n    \u003cspan class=\"na\"\u003exmlns:x=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"http://schemas.microsoft.com/winfx/2006/xaml\"\u003c/span\u003e\n    \u003cspan class=\"na\"\u003exmlns:d=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"http://schemas.microsoft.com/expression/blend/2008\"\u003c/span\u003e\n    \u003cspan class=\"na\"\u003exmlns:local=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"clr-namespace:DataTemplateByCode2\"\u003c/span\u003e\n    \u003cspan class=\"na\"\u003exmlns:mc=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"http://schemas.openxmlformats.org/markup-compatibility/2006\"\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eTitle=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"MainWindow\"\u003c/span\u003e \u003cspan class=\"na\"\u003eWidth=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"300\"\u003c/span\u003e \u003cspan class=\"na\"\u003eHeight=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"150\"\u003c/span\u003e \u003cspan class=\"na\"\u003emc:Ignorable=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"d\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;Window.DataContext\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"nt\"\u003e\u0026lt;local:MainWindowViewModel\u003c/span\u003e \u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;/Window.DataContext\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;StackPanel\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"nt\"\u003e\u0026lt;TextBlock\u003c/span\u003e \u003cspan class=\"na\"\u003eText=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"VM -\u0026gt; View\"\u003c/span\u003e \u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"nt\"\u003e\u0026lt;ContentControl\u003c/span\u003e \u003cspan class=\"na\"\u003eContent=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"{Binding MyUc1VM}\"\u003c/span\u003e \u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"nt\"\u003e\u0026lt;ContentControl\u003c/span\u003e \u003cspan class=\"na\"\u003eContent=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"{Binding MyUc2VM}\"\u003c/span\u003e \u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;/StackPanel\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/Window\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eUserControlではVMのプロパティ\u003ccode\u003eTitle\u003c/code\u003eとバインディングしています。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"xml\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eMyUc1.xaml\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"nt\"\u003e\u0026lt;UserControl\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ex:Class=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"DataTemplateByCode2.MyUc1\"\u003c/span\u003e\n    \u003cspan class=\"na\"\u003exmlns=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"http://schemas.microsoft.com/winfx/2006/xaml/presentation\"\u003c/span\u003e\n    \u003cspan class=\"na\"\u003exmlns:x=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"http://schemas.microsoft.com/winfx/2006/xaml\"\u003c/span\u003e\n    \u003cspan class=\"na\"\u003exmlns:d=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"http://schemas.microsoft.com/expression/blend/2008\"\u003c/span\u003e\n    \u003cspan class=\"na\"\u003exmlns:local=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"clr-namespace:DataTemplateByCode2\"\u003c/span\u003e\n    \u003cspan class=\"na\"\u003exmlns:mc=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"http://schemas.openxmlformats.org/markup-compatibility/2006\"\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ed:DesignHeight=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"50\"\u003c/span\u003e \u003cspan class=\"na\"\u003ed:DesignWidth=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"200\"\u003c/span\u003e \u003cspan class=\"na\"\u003eBackground=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"LightGreen\"\u003c/span\u003e\n    \u003cspan class=\"na\"\u003emc:Ignorable=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"d\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;StackPanel\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"nt\"\u003e\u0026lt;TextBlock\u003c/span\u003e \u003cspan class=\"na\"\u003eText=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"{Binding Text}\"\u003c/span\u003e \u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;/StackPanel\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/UserControl\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eMainWindowViewModelには2つのVMがプロパティとしてあります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eMainWindowViewModel.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eMainWindowViewModel\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eMyUc1ViewModel\u003c/span\u003e \u003cspan class=\"n\"\u003eMyUc1VM\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMyUc1ViewModel\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eMyUc2ViewModel\u003c/span\u003e \u003cspan class=\"n\"\u003eMyUc2VM\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMyUc2ViewModel\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eUserControlに対応するViewModelには1つプロパティがあるだけです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eMyUc1ViewModel.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eMyUc1ViewModel\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eTitle\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"TEXT FROM MyUc1ViewModel\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eApp.xamlと別ResourceDictionaryでDataTemplateを使ってVM→Viewの登録を行います。\u003cbr\u003e\nApp.xaml直下と別ファイルに分けたのは単なる動作確認で普通は統一します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"xml\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eApp.xaml\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"nt\"\u003e\u0026lt;Application\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ex:Class=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"DataTemplateByCode2.App\"\u003c/span\u003e\n    \u003cspan class=\"na\"\u003exmlns=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"http://schemas.microsoft.com/winfx/2006/xaml/presentation\"\u003c/span\u003e\n    \u003cspan class=\"na\"\u003exmlns:x=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"http://schemas.microsoft.com/winfx/2006/xaml\"\u003c/span\u003e\n    \u003cspan class=\"na\"\u003exmlns:local=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"clr-namespace:DataTemplateByCode2\"\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eStartupUri=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"MainWindow.xaml\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;Application.Resources\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"nt\"\u003e\u0026lt;ResourceDictionary\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"nt\"\u003e\u0026lt;ResourceDictionary.MergedDictionaries\u0026gt;\u003c/span\u003e\n                \u003cspan class=\"nt\"\u003e\u0026lt;ResourceDictionary\u003c/span\u003e \u003cspan class=\"na\"\u003eSource=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Templates.xaml\"\u003c/span\u003e \u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"nt\"\u003e\u0026lt;/ResourceDictionary.MergedDictionaries\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"nt\"\u003e\u0026lt;DataTemplate\u003c/span\u003e \u003cspan class=\"na\"\u003eDataType=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"{x:Type local:MyUc1ViewModel}\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n                \u003cspan class=\"nt\"\u003e\u0026lt;local:MyUc1\u003c/span\u003e \u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"nt\"\u003e\u0026lt;/DataTemplate\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"nt\"\u003e\u0026lt;/ResourceDictionary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;/Application.Resources\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/Application\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"xml\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eTemplates.xaml\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"nt\"\u003e\u0026lt;ResourceDictionary\u003c/span\u003e \u003cspan class=\"na\"\u003exmlns=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"http://schemas.microsoft.com/winfx/2006/xaml/presentation\"\u003c/span\u003e\n                    \u003cspan class=\"na\"\u003exmlns:x=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"http://schemas.microsoft.com/winfx/2006/xaml\"\u003c/span\u003e\n                    \u003cspan class=\"na\"\u003exmlns:local=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"clr-namespace:DataTemplateByCode2\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;DataTemplate\u003c/span\u003e \u003cspan class=\"na\"\u003eDataType=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"{x:Type local:MyUc2ViewModel}\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"nt\"\u003e\u0026lt;local:MyUc2/\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;/DataTemplate\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/ResourceDictionary\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eもう1つのUserControlと対応するViewModelは背景色と文字列の内容が違うだけなので省略します。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"課題\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%AA%B2%E9%A1%8C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e課題\u003c/h1\u003e\n\n\u003cp\u003eUserControlにおいて、このままですとデザイナ画面にVM由来の文字列が表示されません。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/8e6109565eca1813b4682d7512f449a57a27485b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3132303037372f31396164306464622d643130632d663837312d373932612d6466626365323665333165342e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F120077%2F19ad0ddb-d10c-f871-792a-dfbce26e31e4.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=38ee35c99ddb37989430964a90f141b6\" alt=\"スクリーンショット 2017-12-09 18.28.42.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/120077/19ad0ddb-d10c-f871-792a-dfbce26e31e4.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F120077%2F19ad0ddb-d10c-f871-792a-dfbce26e31e4.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=4854787ee8cbeeaff57aaae5c7ed6569 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eそこでXAML内でデザイン時DataContextを指定します。\u003cbr\u003e\n先程のMyUc1.xamlのUserControl句の最後に追加します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"xml\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eMyUc1.xaml(部分）\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003emc:Ignorable=\"d\"\nd:DataContext=\"{d:DesignInstance {x:Type local:MyUc2ViewModel},IsDesignTimeCreatable=True}\"\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e無事にデザイナ画面でもViewModel由来の文字列が追加されました。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/0c83111fd61a79e14a3a43fce2e37c0eb81c6b8b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3132303037372f34653238376539352d646535662d616431352d313535642d3639306537306533636266662e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F120077%2F4e287e95-de5f-ad15-155d-690e70e3cbff.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=1560ca9a5523ed149df57da6bad9c7dc\" alt=\"スクリーンショット 2017-12-09 18.28.17.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/120077/4e287e95-de5f-ad15-155d-690e70e3cbff.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F120077%2F4e287e95-de5f-ad15-155d-690e70e3cbff.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=3959d7e90a176f7b58e180ad6acdc24a 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eしかしこのままですと重複があります。\u003cbr\u003e\nつまり\u003cbr\u003e\n・DataTemplateではViewModel→View\u003cbr\u003e\n・各Viewのd:DataContextではView→ViewModel\u003cbr\u003e\nの結びつけが行われており、内容が重複している。\u003c/p\u003e\n\n\u003cp\u003eView⇔ViewModel間の組み合わせが変わったら両者を変更する必要があります。\u003cbr\u003e\nDataTemplateだけ修正してd:DataContexがそのままの場合、\u003cbr\u003e\n実行時エラーは何も出ませんが、デザイナ画面がエラーしたり、デザイン時と実行時で画面が異なってしまいます。\u003cbr\u003e\n実は上のコードもUc1にUc2ViewModelを指定していますが、なかなか気づきづらいと思います。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"markupextensionの導入\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#markupextension%E3%81%AE%E5%B0%8E%E5%85%A5\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eMarkupExtensionの導入\u003c/h1\u003e\n\n\u003cp\u003eそこでDataTemplateを元にView型から対応するViewModelを供給するMarkupExtensionを使ってこの課題を解決します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eViewModelProviderExtension.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// DataTemplateを元にView型から対応するViewModelを供給するMarkupExtension\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eViewModelProviderExtension\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eMarkupExtension\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// 検索するView型\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eType\u003c/span\u003e \u003cspan class=\"n\"\u003eViewType\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eViewModelProviderExtension\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eViewModelProviderExtension\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eType\u003c/span\u003e \u003cspan class=\"n\"\u003eviewType\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eViewType\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eviewType\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eoverride\u003c/span\u003e \u003cspan class=\"kt\"\u003eobject\u003c/span\u003e \u003cspan class=\"nf\"\u003eProvideValue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIServiceProvider\u003c/span\u003e \u003cspan class=\"n\"\u003eprovider\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//現在のアプリケーションのResourceDictionaryと入れ子になっているResourceDictionaryを平坦化\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eresources\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eResourceDictionary\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003eApplication\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCurrent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eResources\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eresources\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAddRange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eApplication\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCurrent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eResources\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMergedDictionaries\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003edataTemplateExs\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eresources\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e//ResourceからValueを取り出しDataTemplate型だけ抽出して平坦化\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSelectMany\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValues\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eOfType\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eDataTemplate\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;())\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e//DataTemplateを匿名型に変換\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSelect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n                \u003cspan class=\"k\"\u003enew\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"c1\"\u003e//Contentを生成してView型情報に変換\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003eviewType\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLoadContent\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetType\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e\n                    \u003cspan class=\"c1\"\u003e//DataTypeをViewModel型情報に変換\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003eviewModelType\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDataType\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eType\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e//一致するView型を探し、対応するViewModel型を選択\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eselectViewModelType\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edataTemplateExs\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFirstOrDefault\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eviewType\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eViewType\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e?.\u003c/span\u003e\u003cspan class=\"n\"\u003eviewModelType\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eselectViewModelType\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//該当するViewModel型を作成\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003evm\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eActivator\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateInstance\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eselectViewModelType\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003evm\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eViewModelProviderの実装の説明はコード内に書いたので、そちらを参照下さい。\u003cbr\u003e\n使用方法はViewModelProviderのコンストラクタに\u003cstrong\u003eViewの型\u003c/strong\u003eをわたして、\u003ccode\u003ed:DataContext\u003c/code\u003eに指定します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"xml\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eMyUc1.xaml(部分）\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003emc:Ignorable=\"d\"\nd:DataContext=\"{local:ViewModelProvider {x:Type local:MyUc1}}\"\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eデザイナ画面も無事直りました。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/110bd774efcfccbe1a7fc092cf93963c9468620f/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3132303037372f31323061353337302d386461632d616135632d356331342d3532386337393537343539322e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F120077%2F120a5370-8dac-aa5c-5c14-528c79574592.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=3bb92d4c0bb2335ddbc7130fc1dbe655\" alt=\"スクリーンショット 2017-12-09 18.49.31.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/120077/120a5370-8dac-aa5c-5c14-528c79574592.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F120077%2F120a5370-8dac-aa5c-5c14-528c79574592.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=a2f97e815280eee90af9ac0a370a6e6c 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"実行時にも使用可能\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%9F%E8%A1%8C%E6%99%82%E3%81%AB%E3%82%82%E4%BD%BF%E7%94%A8%E5%8F%AF%E8%83%BD\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e実行時にも使用可能\u003c/h1\u003e\n\n\u003cp\u003e必要性があるかはわかりませんが、実行時にも使用可能です。\u003cbr\u003e\n先程のMainWindowを修正します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"xml\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eMainWindow.xaml（部分）\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"nt\"\u003e\u0026lt;StackPanel\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;TextBlock\u003c/span\u003e \u003cspan class=\"na\"\u003eText=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"VM -\u0026gt; View\"\u003c/span\u003e \u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;ContentControl\u003c/span\u003e \u003cspan class=\"na\"\u003eContent=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"{Binding MyUc1VM}\"\u003c/span\u003e \u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;ContentControl\u003c/span\u003e \u003cspan class=\"na\"\u003eContent=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"{Binding MyUc2VM}\"\u003c/span\u003e \u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;TextBlock/\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;TextBlock\u003c/span\u003e \u003cspan class=\"na\"\u003eText=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"View -\u0026gt; VM\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;local:MyUc1\u003c/span\u003e \u003cspan class=\"na\"\u003eDataContext=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"{local:ViewModelProvider {x:Type local:MyUc1}}\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;local:MyUc2\u003c/span\u003e \u003cspan class=\"na\"\u003eDataContext=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"{local:ViewModelProvider {x:Type local:MyUc2}}\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/StackPanel\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e実行結果です\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/614a15656176f5bd8f833b4f5c3f5a291dd3784b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3132303037372f61663865363962652d646665312d616233372d376335352d6264343732333438633633652e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F120077%2Faf8e69be-dfe1-ab37-7c55-bd472348c63e.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=67672caab8167c22efb5f185444afc4e\" alt=\"スクリーンショット 2017-12-09 18.56.56.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/120077/af8e69be-dfe1-ab37-7c55-bd472348c63e.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F120077%2Faf8e69be-dfe1-ab37-7c55-bd472348c63e.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=32926700befdf4a5665c01f6312e33ba 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eContentControlがViewModelからViewを表示するように\u003cbr\u003e\nViewModelProviderがViewに対応したViewModelを供給します。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"まとめ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eまとめ\u003c/h1\u003e\n\n\u003cp\u003eデザイン時DataContextはVMの内容を反映したデザインを確認しながらViewを編集できるので便利です。\u003cbr\u003e\n今回のViewModelProviderを使用するとViewに対応したViewModelが自動で供給されます。\u003cbr\u003e\nこれにより、DataTemplateと重複した記述が削れることと、実行時と違うViewModelを使用するのを防ぐことが出来ます。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"注意点\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%B3%A8%E6%84%8F%E7%82%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e注意点\u003c/h1\u003e\n\n\u003cp\u003eこのMarkupExtensionは内部でDataTemplateにある\u003cstrong\u003e全ての\u003c/strong\u003eViewのインスタンス生成を行います。\u003cbr\u003e\nですのでViewが増えたり、特定のViewのインスタンス生成が重いとデザイナ画面が極端に重くなります。\u003c/p\u003e\n\n\u003cp\u003e追伸：ViewTypeを書かずに済むように自動で取得する方法があったら教えてください。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"環境\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%92%B0%E5%A2%83\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e環境\u003c/h1\u003e\n\n\u003cp\u003eVisualStudio2017\u003cbr\u003e\n.NET Framework 4.7\u003cbr\u003e\nC#7.1\u003c/p\u003e\n","createdAt":"2017-12-09T10:11:30Z","elapsedYearsFromLastModifiedAt":3,"encryptedId":"ZG13b9gm3xfpHARxn6QhtC0vkSB05Qjn--ukjH/mrm4DZw+wj9--+v4/ixdMtUt+C1jR56F1wQ==","isBanned":false,"isDeprecated":true,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2018-03-16T04:01:12Z","likesCount":9,"linkUrl":"https://qiita.com/soi/items/811a14f7a3822370f33f","organization":null,"originalId":585487,"stockedCount":7,"title":"Visual Studioでのデザイン時DataContextに適切なViewModelを供給するMarkupExtension","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%A6%82%E8%A6%81\"\u003e概要\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%AE%9F%E8%A1%8C%E7%B5%90%E6%9E%9C\"\u003e実行結果\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%A4%89%E6%9B%B4%E5%89%8D%E3%83%87%E3%83%A2%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B3%E3%83%BC%E3%83%89\"\u003e変更前デモアプリコード\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E8%AA%B2%E9%A1%8C\"\u003e課題\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#markupextension%E3%81%AE%E5%B0%8E%E5%85%A5\"\u003eMarkupExtensionの導入\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%AE%9F%E8%A1%8C%E6%99%82%E3%81%AB%E3%82%82%E4%BD%BF%E7%94%A8%E5%8F%AF%E8%83%BD\"\u003e実行時にも使用可能\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"\u003eまとめ\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%B3%A8%E6%84%8F%E7%82%B9\"\u003e注意点\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%92%B0%E5%A2%83\"\u003e環境\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":7718,"uuid":"811a14f7a3822370f33f","banReason":null,"adventCalendarItem":{"day":10,"calendar":{"name":"XAML","urlName":"xaml","year":2017,"organization":null}},"author":{"encryptedId":"EMG9dMVZYDfgMOj4xlkV7UAEux+u--HYuCJjzau6PptnIU--q68JSUcO1PLKzO/vqjyJZw==","originalId":120077,"description":"ソフトウェアエンジニア\r\nC#, Xaml チョットワカル","facebookUrl":null,"githubUrl":"https://github.com/soi013","isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"","profileImageUrl":"https://qiita-image-store.s3.amazonaws.com/0/120077/profile-images/1473714466","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F120077%2Fprofile-images%2F1473714466?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=6f7ba83906b324468b29567d27c7dee0","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F120077%2Fprofile-images%2F1473714466?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=e5a35cbc09752410b5c78938fa1e1273","urlName":"soi","websiteUrl":"","twitterUrl":"https://twitter.com/soi2flatline","twitterUrlName":"soi2flatline","revealedOrganizations":{"edges":[]}},"tags":[{"name":"C#","urlName":"csharp"},{"name":".NET","urlName":".net"},{"name":"WPF","urlName":"wpf"},{"name":"VisualStudio","urlName":"visualstudio"},{"name":"Xaml","urlName":"xaml"}],"followingLikers":{"edges":[]},"comments":{"totalCount":0}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

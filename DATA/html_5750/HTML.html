<!DOCTYPE html><html><head><meta charset="utf-8" /><title>C#で半自動ソースコード生成を行う - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/skitoy4321/items/bea79049d2b156f64d78" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="oBDjRVzUD96t0IfgW5h7/Wc5xJtp4rYfj9B9UA1l03lOjQKXladpOE+5FZTsWFoPLKc0ja/Feh/Gp8B4S+E4GA==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta content="@skitoy4321" name="twitter:creator" /><meta property="og:type" content="article"><meta property="og:title" content="C#で半自動ソースコード生成を行う - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1ReVBqZ2FmbGpZcm9oNnJsaTVYamdyM2pnN3pqZ3JuamdyUGpnN3pqZzRubmxKX21pSkRqZ3BMb29ZempnWVkmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT01NCZ0eHQtY2xpcD1lbGxpcHNpcyZ0eHQtYWxpZ249Y2VudGVyJTJDbWlkZGxlJnM9MDBkMDVkYjVjMGQ4YzA4MDBiNGVhZDFlNjUxZmY5ZmE&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RSE5yYVhSdmVUUXpNakUmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT00NSZ0eHQtYWxpZ249cmlnaHQlMkNib3R0b20mcz1jY2M1MmMxZWFiYjkwYjFjMmY5ZTYyZjVkZDk3ZmU4Zg&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=3ae4bc4cca4610353685047c81d41652"><meta property="og:description" content="

はじめに

これは、C#でソースコード生成を実現するための記事となります。
コード生成というとコンパイラーとか低レベルなイメージがありますが、今回行うのは.csの生成となるので、そんなに難しいことはないと思います。

注意: この..."><meta content="https://qiita.com/skitoy4321/items/bea79049d2b156f64d78" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#,Roslyn,Buildalyzer" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 1nzh4zz 38fzdi helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-1nzh4zz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:16px 32px;background-color:#FBE69E;color:rgba(0,0,0,0.87);line-height:1.5;font-weight:600;}@media (max-width:770px){.css-1nzh4zz{padding:16px;}}.css-38fzdi{color:#CA832A;margin-right:4px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-fdf25a89-3fc1-47fe-af59-6f6e66e9d5ca"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Fskitoy4321%2Fitems%2Fbea79049d2b156f64d78">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Fskitoy4321%2Fitems%2Fbea79049d2b156f64d78">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-fdf25a89-3fc1-47fe-af59-6f6e66e9d5ca">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2017-12-12T02:08:03.000+09:00","dateModified":"2018-10-04T17:27:34.000+09:00","headline":"C#で半自動ソースコード生成を行う","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1ReVBqZ2FmbGpZcm9oNnJsaTVYamdyM2pnN3pqZ3JuamdyUGpnN3pqZzRubmxKX21pSkRqZ3BMb29ZempnWVkmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT01NCZ0eHQtY2xpcD1lbGxpcHNpcyZ0eHQtYWxpZ249Y2VudGVyJTJDbWlkZGxlJnM9MDBkMDVkYjVjMGQ4YzA4MDBiNGVhZDFlNjUxZmY5ZmE\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RSE5yYVhSdmVUUXpNakUmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT00NSZ0eHQtYWxpZ249cmlnaHQlMkNib3R0b20mcz1jY2M1MmMxZWFiYjkwYjFjMmY5ZTYyZjVkZDk3ZmU4Zg\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=3ae4bc4cca4610353685047c81d41652","mainEntityOfPage":"https://qiita.com/skitoy4321/items/bea79049d2b156f64d78","author":{"@type":"Person","address":"","email":null,"identifier":"skitoy4321","name":"skitoy4321","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F103253%2Fprofile-images%2F1526359222?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=9623ed561bd61ca207da0cb6419ba01d","url":"https://qiita.com/skitoy4321","description":"","memberOf":[]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://increments.connpass.com/event/211948/">Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催</a><a target="_blank" id="header_text_message_2" href="https://increments.connpass.com/event/211948/">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"skitoy4321","type":"items","id":"bea79049d2b156f64d78"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"skitoy4321","type":"items","id":"bea79049d2b156f64d78"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_1","message":"Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"skitoy4321","type":"items","id":"bea79049d2b156f64d78"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_2","message":"Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/skitoy4321/items/bea79049d2b156f64d78","location":"/skitoy4321/items/bea79049d2b156f64d78","scheme":"https","host":"qiita.com","port":null,"pathname":"/skitoy4321/items/bea79049d2b156f64d78","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"/wdQWcGqHvymx/PGSeH2aiI5Eg0EOL5f+ApC9pFUhxIRmrGLCNl4GkSuYbL+IdeYaafiG8Ifcl+xff/e19Bscw==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-dded4a8a-fb83-4bb5-be81-f7aa989c2f77"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/skitoy4321/items/bea79049d2b156f64d78/likers" class="css-1iupg5d">21</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">27</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/bea79049d2b156f64d78/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/skitoy4321/items/bea79049d2b156f64d78/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/skitoy4321/items/bea79049d2b156f64d78/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/skitoy4321/items/bea79049d2b156f64d78/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/skitoy4321/items/bea79049d2b156f64d78.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-1nzh4zz"><span class="fa fa-fw fa-warning css-38fzdi"></span><p>More than 1 year has passed since last update.</p></div><div class="css-helsa7"><div class="css-8qb8m4"><div class="it-AdcalRibbon"><span><a href="/advent-calendar/2017/csharp" class="it-AdcalRibbon_title">C#<!-- --> Advent Calendar<!-- --> <!-- -->2017</a>Day 12</span></div><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/skitoy4321"><img class="css-100alwu eyfquo10" src="https://qiita-image-store.s3.amazonaws.com/0/103253/profile-images/1526359222" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/skitoy4321" class="css-10ougpm">@<!-- -->skitoy4321</a><div class="css-1ay9vb9"><span><meta content="2017-12-11T17:08:03Z"/><time dateTime="2018-10-04T08:27:34Z" class="css-m19uds">updated at 2018-10-04</time></span></div></div></div></div></div><h1 class="css-cgzq40">C#で半自動ソースコード生成を行う</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/roslyn" class="css-4czcte">Roslyn</a><a href="/tags/buildalyzer" class="css-4czcte">Buildalyzer</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div>
<h1>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h1>

<p>これは、C#でソースコード生成を実現するための記事となります。<br>
コード生成というとコンパイラーとか低レベルなイメージがありますが、今回行うのは.csの生成となるので、そんなに難しいことはないと思います。</p>

<p><strong>注意: この文書はBuildalyzer-0.4.0を基準に書かれています。現在の最新版は2.1.0ですが、仕様が変更されているので、そのうち更新する予定です。</strong></p>

<h1>
<span id="なぜソースコード生成か" class="fragment"></span><a href="#%E3%81%AA%E3%81%9C%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%89%E7%94%9F%E6%88%90%E3%81%8B"><i class="fa fa-link"></i></a>なぜソースコード生成か</h1>

<p>例えば、デバッグ用にあるクラスの全てのパブリックフィールドを文字列として生成する実装を書きたい、となったとします。</p>

<p>ぱっと思いつく方法としては、</p>

<ul>
<li>手で書く</li>
<li>リフレクションを使用して動的に解析</li>
</ul>

<p>があります。<br>
手で書く場合、それが小規模なうちはいいですが、管理するクラスが増えてくると、抜けがないように実装するのが大変になります。<br>
リフレクションを使用する場合、愚直に毎回Typeからメンバーを取り出して...とすると、オーバーヘッドが割と大きく、かといってキャッシュしようとすると、キャッシュをどこに置くのか、オーバーヘッドは無いか、そもそもリフレクションが使えない場合もあるのではないか等、こちらも多少問題があります。<br>
また、リフレクションで解析する場合、実際に処理を走らせないとエラーが見つけにくい、見つかっても問題個所がわかり辛いという欠点もあります。</p>

<p>そこで、<strong>事前にコード解析を行い、コンパイル時点(または以前)に予め静的に特化処理を作っておく</strong>、という方法を使うことにより、<br>
上記の問題を解決することが可能になります。</p>

<p>今回紹介するBuildalyzerを使用した方法の他に、以下のようなものもあります。</p>

<ul>
<li><a href="https://msdn.microsoft.com/ja-jp/library/dd820620.aspx" rel="nofollow noopener" target="_blank">T4を用いた方法</a></li>
<li><a href="http://www.buildinsider.net/enterprise/roslyn/01" rel="nofollow noopener" target="_blank">Roslyn Analyzerによるコード生成</a></li>
<li><a href="https://github.com/daveaglick/Scripty" rel="nofollow noopener" target="_blank">Scripty(CSXより生成)</a></li>
</ul>

<p>それぞれ個性はあるので、色々試してみるのがいいかと思います。<br>
個人的にはVisual Studioを使うことができるなら、T4あるいはRoslyn Analyzerで事足りる場合が多いです。<br>
しかし、これらの方法は依存関係に制限が入ることが多く、たまに要件に合わない場合もあったりするので、そういう場合は今回の記事の方法が役に立つのではないかなと思っています。</p>

<h1>
<span id="前提条件" class="fragment"></span><a href="#%E5%89%8D%E6%8F%90%E6%9D%A1%E4%BB%B6"><i class="fa fa-link"></i></a>前提条件</h1>

<p>以下、この記事内の想定環境について記載します。</p>

<ul>
<li>Windows7以降</li>
<li>.NET Core sdk 2.0以降</li>
<li>Visual Studio Code 1.18以降+C#拡張1.13以降</li>
</ul>

<h1>
<span id="buildalyzerについて" class="fragment"></span><a href="#buildalyzer%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>Buildalyzerについて</h1>

<p>詳しくは<a href="https://github.com/daveaglick/Buildalyzer/blob/master/README.md" rel="nofollow noopener" target="_blank">公式のREADME</a>を読むことになりますが、とりあえず取っ掛かりとして必要な部分を説明します。</p>

<p>ライブラリの機能自体はcsprojの解析とワークスペース作成が主で、解析後はroslynの各種APIを駆使して解析を行うことになります。</p>

<h2>
<span id="導入" class="fragment"></span><a href="#%E5%B0%8E%E5%85%A5"><i class="fa fa-link"></i></a>導入</h2>

<p>以下二つのnugetパッケージをプロジェクトに追加します。</p>

<ul>
<li><code>Buildalyzer</code></li>
<li>
<code>Buildalyzer.Workspaces</code>

<ul>
<li>必須ではないが、アセンブリに関する型情報を取得するためにあった方が便利</li>
</ul>
</li>
</ul>

<h2>
<span id="使用" class="fragment"></span><a href="#%E4%BD%BF%E7%94%A8"><i class="fa fa-link"></i></a>使用</h2>

<h3>
<span id="実装" class="fragment"></span><a href="#%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>実装</h3>

<p>以下二つの名前空間をusingします。</p>

<ul>
<li><code>Buildalyzer</code></li>
<li><code>Buildalyzer.Workspaces</code></li>
</ul>

<p>最初に<code>AnalyzerManager</code>をnewして、次に<code>AnalyzerManager.GetProject(path_to_proj)</code>を実行して、プロジェクト情報を取得することになります。具体的には以下のようなコードになります。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="c1">// Buildalyzerの起点</span>
<span class="n">AnalyzerManager</span> <span class="n">manager</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">AnalyzerManager</span><span class="p">();</span>
<span class="c1">// C#プロジェクトのオープン</span>
<span class="n">ProjectAnalyzer</span> <span class="n">analyzer</span> <span class="p">=</span> <span class="n">manager</span><span class="p">.</span><span class="nf">GetProject</span><span class="p">(</span><span class="s">@"C:\MyCode\MyProject.csproj"</span><span class="p">);</span>
<span class="c1">// プロジェクト情報からRoslynで使うWorkspace(プロジェクトやソリューションをまとめたもの)を生成する。</span>
<span class="c1">// Buildalyzer.Workspacesが必要</span>
<span class="n">Microsoft</span><span class="p">.</span><span class="n">CodeAnalysis</span><span class="p">.</span><span class="n">AdhocWorkspace</span> <span class="n">workspace</span> <span class="p">=</span> <span class="n">analyzer</span><span class="p">.</span><span class="nf">GetWorkspace</span><span class="p">();</span>
<span class="c1">// 以後Microsoft.CodeAnalysis.AdhocWorkspaceを使用する</span>
<span class="k">foreach</span><span class="p">(</span><span class="kt">var</span> <span class="n">project</span> <span class="k">in</span> <span class="n">workspace</span><span class="p">.</span><span class="n">CurrentSolution</span><span class="p">.</span><span class="n">Projects</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// 個々のプロジェクト処理</span>
    <span class="c1">// プロジェクトのコンパイル(シンボル情報構築)</span>
    <span class="c1">// 型がAssemblyではなく、Microsoft.CodeAnalysis.Compilationなので注意</span>
    <span class="kt">var</span> <span class="n">compilation</span> <span class="p">=</span> <span class="k">await</span> <span class="n">project</span><span class="p">.</span><span class="nf">GetCompilationAsync</span><span class="p">();</span>
    <span class="k">foreach</span><span class="p">(</span><span class="kt">var</span> <span class="n">diag</span> <span class="k">in</span> <span class="n">compilation</span><span class="p">.</span><span class="nf">GetDiagnostics</span><span class="p">())</span>
    <span class="p">{</span>
        <span class="c1">// コンパイルエラー等がある場合、</span>
        <span class="c1">// 完了後にGetDiagnostics()を使用してエラー情報を取得する</span>
    <span class="p">}</span>
    <span class="c1">// compilation.GetSymbolsWithNameでクラス定義等が取得可能</span>
    <span class="c1">// キャストしないとISymbolで取得されるため、情報が非常に限定される</span>
    <span class="k">foreach</span><span class="p">(</span><span class="kt">var</span> <span class="n">clsSymbol</span> <span class="k">in</span> <span class="n">compilation</span><span class="p">.</span><span class="nf">GetSymbolsWithName</span><span class="p">(</span><span class="n">_</span> <span class="p">=&gt;</span> <span class="k">true</span><span class="p">,</span> <span class="n">SymbolFilter</span><span class="p">.</span><span class="n">Type</span><span class="p">).</span><span class="n">OfType</span><span class="p">&lt;</span><span class="n">ITypeSymbol</span><span class="p">&gt;())</span>
    <span class="p">{</span>
        <span class="c1">// メンバーの取得</span>
        <span class="c1">// (メソッドやインナークラス等も入るため、ISymbol.Kindで場合分けを行う事)</span>
        <span class="k">foreach</span><span class="p">(</span><span class="kt">var</span> <span class="n">memberSymbol</span> <span class="k">in</span> <span class="n">clsSymbol</span><span class="p">.</span><span class="nf">GetMembers</span><span class="p">())</span>
        <span class="p">{</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3>
<span id="実行" class="fragment"></span><a href="#%E5%AE%9F%E8%A1%8C"><i class="fa fa-link"></i></a>実行</h3>

<p>コード生成部分の実装を終えた後は、それを実際に動かす必要があります。<br>
<a href="https://docs.microsoft.com/ja-jp/dotnet/core/tools/extensibility" rel="nofollow noopener" target="_blank">.NET Core CLI ツールの拡張モデル</a>によると、<br>
いくつかの方法がありますが、今回は<code>各プロジェクト ベースの拡張機能</code>の方法を使用するのが、PATH環境変数も汚さずに済み、カスタムタスクに比べても作りが素直なのでいいのではないかと思います。<br>
MSBuildのカスタムタスクを実装する方法が最も応用が効く方法なのですが、どうもRoslyn関連のDLLが読み込めなかったので、この記事では深入りはしません。</p>

<p>具体的には以下のようにします。</p>

<ol>
<li>
<code>dotnet-[サブコマンド名]</code>という名前でコンソールプロジェクトの作成

<ul>
<li>Project/PropertyGroup/AssemblyNameを追加し、名前を<code>dotnet-[サブコマンド名]</code>のようにしても可</li>
</ul>
</li>
<li>コンソールプロジェクトでコード生成プログラムを実装</li>
<li>nugetパッケージ(nupkg)を作成</li>
<li>使用するプロジェクトのProject/ItemGroup/DotNetCliToolReference要素に追加

<ul>
<li>例: <code>&lt;DotNetCliToolReference Include="[パッケージ名]" Version="[パッケージバージョン]"/&gt;</code>
</li>
<li>
<code>PackageReference</code>や<code>ProjectReference</code>は不可</li>
</ul>
</li>
<li>使用するプロジェクトのcsprojと同フォルダにNuGet.configを作成(<code>dotnet new nugetconfig</code>で雛形作成できる)</li>
<li>nuget.configの<code>configuration/packagesSources</code>に、<code>&lt;add key="[任意の名前]" value="[nupkgがあるフォルダ]"/&gt;</code>という要素を追加</li>
<li>要素を追加したプロジェクトでnugetリストアを実行</li>
</ol>

<p>これで、DotNetCliToolReferenceを追加したcsprojをカレントディレクトリにして、<code>dotnet [サブコマンド]</code>とすると、作成したコンソールプロジェクトが実行されます。</p>

<p>注意点としては、<strong>dotnetサブコマンドのプロジェクトが更新された場合、パッケージ作成プロジェクトと参照プロジェクト両方のパッケージバージョンを上げないと更新が反映されない</strong>という点でしょうか。この辺りはnugetのキャッシュシステムが関係しているので、わかっている人ならば該当パッケージのキャッシュをクリアした上で、restoreするという手もあります。</p>

<h1>
<span id="実装例" class="fragment"></span><a href="#%E5%AE%9F%E8%A3%85%E4%BE%8B"><i class="fa fa-link"></i></a>実装例</h1>

<p><a href="https://github.com/itn3000/buildalyzertest" rel="nofollow noopener" target="_blank">実装例として、テストプロジェクトを作成しました。</a></p>

<ul>
<li>BuildalyzerTest.LibUser

<ul>
<li>コード解析対象</li>
</ul>
</li>
<li>dotnet-buildalyzertest

<ul>
<li>コード解析、生成するコンソールアプリケーション</li>
</ul>
</li>
</ul>

<p>pack.ps1でnupkgを作成し、<code>dotnet restore</code>でBuildalyzerTest.LibUserのrestoreを行うと、以後<code>dotnet buildalyzer-test</code>というコマンドでコード生成を行うことができます。</p>

<p>このプロジェクトでは、<code>-p [csprojのファイルパス]</code>オプションを指定して、クラスの解析と、<br>
メンバーをToStringでつなげた<code>public static string MemberwiseToString(this T obj)</code>という拡張メソッドを作成し、標準出力に出しています。もう少し手を加えれば、csファイルの出力も十分可能です。</p>

<h1>
<span id="注意点" class="fragment"></span><a href="#%E6%B3%A8%E6%84%8F%E7%82%B9"><i class="fa fa-link"></i></a>注意点</h1>

<p>Buildalyzerが依存しているMicrosoft.Buildと、dotnet-sdkのバージョンの食い違いにより、<br>
解析時に例外が発生したり、正しくドキュメント一覧が取れなくなる場合がある。</p>

<p>そのような場合は、コード解析を行うプロジェクトのPackageReferenceに、以下のパッケージを<br>
直接追加すれば、大体の場合現象は回避できる。</p>

<ul>
<li>Microsoft.Build</li>
<li>Microsoft.Build.Tasks.Core</li>
<li>Microsoft.Build.Tasks.Utilities</li>
</ul>

<p>また、回避方法として、Buildalyzerが使用するMicrosoft.Buildのバージョンに対応するSDKを入れた上で、<br>
解析対象のプロジェクトに<a href="https://docs.microsoft.com/ja-jp/dotnet/core/tools/global-json" rel="nofollow noopener" target="_blank">global.json</a>を置いて、sdk/versionの値をそのSDKのバージョンに指定する方法もある。<br>
(Buildalyzer-0.2.1はMicrosoft.Build-15.3.409を参照しているので、sdkバージョンは2.0.xを指定すればOK)</p>

<h1>
<span id="最後に" class="fragment"></span><a href="#%E6%9C%80%E5%BE%8C%E3%81%AB"><i class="fa fa-link"></i></a>最後に</h1>

<h2>
<span id="いい点" class="fragment"></span><a href="#%E3%81%84%E3%81%84%E7%82%B9"><i class="fa fa-link"></i></a>いい点</h2>

<ul>
<li>オーバーヘッドが少ない

<ul>
<li>基本的には愚直に書くのと同じなので、多くの場合、最高効率を目指しやすい</li>
</ul>
</li>
<li>デバッグしやすい

<ul>
<li>できあがるのは普通のC#なので、デバッグの際にどこに問題があるかわかりやすくなる</li>
<li>文法エラー等、単純なミスにコンパイル時に気づくことができる</li>
</ul>
</li>
<li>実装をシンプルにできる(処理のキャッシュを持つ必要がない)</li>
</ul>

<h2>
<span id="悪い点" class="fragment"></span><a href="#%E6%82%AA%E3%81%84%E7%82%B9"><i class="fa fa-link"></i></a>悪い点</h2>

<ul>
<li>前準備が必要

<ul>
<li>ソースコード生成モジュールの作成</li>
<li>使用するプロジェクトのprojファイルに要素追加</li>
</ul>
</li>
<li>生成した成果物を使用するプロジェクトのアセンブリファイルサイズが大きくなりやすい

<ul>
<li>生成したコードが全てコンパイルされるため</li>
</ul>
</li>
</ul>

<p>特に前準備が手間というのは、大きいと思います。大体の場合、時間対効果を考えるならば、リフレクション等で済ませた方が楽です。しかし、ソースコード生成はハマるところにはハマるので、選択肢の一つとして持っておくのもいいのではないかと思います。</p>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Fskitoy4321%2Fitems%2Fbea79049d2b156f64d78&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Fskitoy4321%2Fitems%2Fbea79049d2b156f64d78&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/skitoy4321/items/bea79049d2b156f64d78/likers" class="css-1iupg5d">21</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">27</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/bea79049d2b156f64d78/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/skitoy4321/items/bea79049d2b156f64d78/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/skitoy4321/items/bea79049d2b156f64d78/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/skitoy4321/items/bea79049d2b156f64d78/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/skitoy4321/items/bea79049d2b156f64d78.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-dded4a8a-fb83-4bb5-be81-f7aa989c2f77">{"authorAnalyticsTrackingId":null,"organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-17f8d593-f20c-4d36-bcda-51b5d7ec6161"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-17f8d593-f20c-4d36-bcda-51b5d7ec6161">{}</script>
      
<div id="LoginModal-react-component-1d88302f-3228-41c1-b29c-6e3419ddb930"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-1d88302f-3228-41c1-b29c-6e3419ddb930">{}</script>
      
<div id="StockModal-react-component-1107c959-c684-4ce2-8117-0a7b4534c4b6"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-1107c959-c684-4ce2-8117-0a7b4534c4b6">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;Qd1dNKoFl8et19HScMR+aLPb6DSBTLtaIQaKAMwpU2qvQLzmY3bxIU++Q6bHBF+a+EUYIkdrd1pocTcoiq24Cw==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\n\u003ch1\u003e\n\u003cspan id=\"はじめに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eはじめに\u003c/h1\u003e\n\n\u003cp\u003eこれは、C#でソースコード生成を実現するための記事となります。\u003cbr\u003e\nコード生成というとコンパイラーとか低レベルなイメージがありますが、今回行うのは.csの生成となるので、そんなに難しいことはないと思います。\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003e注意: この文書はBuildalyzer-0.4.0を基準に書かれています。現在の最新版は2.1.0ですが、仕様が変更されているので、そのうち更新する予定です。\u003c/strong\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"なぜソースコード生成か\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AA%E3%81%9C%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%89%E7%94%9F%E6%88%90%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eなぜソースコード生成か\u003c/h1\u003e\n\n\u003cp\u003e例えば、デバッグ用にあるクラスの全てのパブリックフィールドを文字列として生成する実装を書きたい、となったとします。\u003c/p\u003e\n\n\u003cp\u003eぱっと思いつく方法としては、\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e手で書く\u003c/li\u003e\n\u003cli\u003eリフレクションを使用して動的に解析\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eがあります。\u003cbr\u003e\n手で書く場合、それが小規模なうちはいいですが、管理するクラスが増えてくると、抜けがないように実装するのが大変になります。\u003cbr\u003e\nリフレクションを使用する場合、愚直に毎回Typeからメンバーを取り出して...とすると、オーバーヘッドが割と大きく、かといってキャッシュしようとすると、キャッシュをどこに置くのか、オーバーヘッドは無いか、そもそもリフレクションが使えない場合もあるのではないか等、こちらも多少問題があります。\u003cbr\u003e\nまた、リフレクションで解析する場合、実際に処理を走らせないとエラーが見つけにくい、見つかっても問題個所がわかり辛いという欠点もあります。\u003c/p\u003e\n\n\u003cp\u003eそこで、\u003cstrong\u003e事前にコード解析を行い、コンパイル時点(または以前)に予め静的に特化処理を作っておく\u003c/strong\u003e、という方法を使うことにより、\u003cbr\u003e\n上記の問題を解決することが可能になります。\u003c/p\u003e\n\n\u003cp\u003e今回紹介するBuildalyzerを使用した方法の他に、以下のようなものもあります。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://msdn.microsoft.com/ja-jp/library/dd820620.aspx\" rel=\"nofollow noopener\" target=\"_blank\"\u003eT4を用いた方法\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://www.buildinsider.net/enterprise/roslyn/01\" rel=\"nofollow noopener\" target=\"_blank\"\u003eRoslyn Analyzerによるコード生成\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/daveaglick/Scripty\" rel=\"nofollow noopener\" target=\"_blank\"\u003eScripty(CSXより生成)\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eそれぞれ個性はあるので、色々試してみるのがいいかと思います。\u003cbr\u003e\n個人的にはVisual Studioを使うことができるなら、T4あるいはRoslyn Analyzerで事足りる場合が多いです。\u003cbr\u003e\nしかし、これらの方法は依存関係に制限が入ることが多く、たまに要件に合わない場合もあったりするので、そういう場合は今回の記事の方法が役に立つのではないかなと思っています。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"前提条件\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%89%8D%E6%8F%90%E6%9D%A1%E4%BB%B6\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e前提条件\u003c/h1\u003e\n\n\u003cp\u003e以下、この記事内の想定環境について記載します。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eWindows7以降\u003c/li\u003e\n\u003cli\u003e.NET Core sdk 2.0以降\u003c/li\u003e\n\u003cli\u003eVisual Studio Code 1.18以降+C#拡張1.13以降\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"buildalyzerについて\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#buildalyzer%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eBuildalyzerについて\u003c/h1\u003e\n\n\u003cp\u003e詳しくは\u003ca href=\"https://github.com/daveaglick/Buildalyzer/blob/master/README.md\" rel=\"nofollow noopener\" target=\"_blank\"\u003e公式のREADME\u003c/a\u003eを読むことになりますが、とりあえず取っ掛かりとして必要な部分を説明します。\u003c/p\u003e\n\n\u003cp\u003eライブラリの機能自体はcsprojの解析とワークスペース作成が主で、解析後はroslynの各種APIを駆使して解析を行うことになります。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"導入\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%B0%8E%E5%85%A5\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e導入\u003c/h2\u003e\n\n\u003cp\u003e以下二つのnugetパッケージをプロジェクトに追加します。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eBuildalyzer\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eBuildalyzer.Workspaces\u003c/code\u003e\n\n\u003cul\u003e\n\u003cli\u003e必須ではないが、アセンブリに関する型情報を取得するためにあった方が便利\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"使用\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BD%BF%E7%94%A8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e使用\u003c/h2\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"実装\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%9F%E8%A3%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e実装\u003c/h3\u003e\n\n\u003cp\u003e以下二つの名前空間をusingします。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eBuildalyzer\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eBuildalyzer.Workspaces\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e最初に\u003ccode\u003eAnalyzerManager\u003c/code\u003eをnewして、次に\u003ccode\u003eAnalyzerManager.GetProject(path_to_proj)\u003c/code\u003eを実行して、プロジェクト情報を取得することになります。具体的には以下のようなコードになります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// Buildalyzerの起点\u003c/span\u003e\n\u003cspan class=\"n\"\u003eAnalyzerManager\u003c/span\u003e \u003cspan class=\"n\"\u003emanager\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eAnalyzerManager\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// C#プロジェクトのオープン\u003c/span\u003e\n\u003cspan class=\"n\"\u003eProjectAnalyzer\u003c/span\u003e \u003cspan class=\"n\"\u003eanalyzer\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emanager\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetProject\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e@\"C:\\MyCode\\MyProject.csproj\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// プロジェクト情報からRoslynで使うWorkspace(プロジェクトやソリューションをまとめたもの)を生成する。\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// Buildalyzer.Workspacesが必要\u003c/span\u003e\n\u003cspan class=\"n\"\u003eMicrosoft\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCodeAnalysis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAdhocWorkspace\u003c/span\u003e \u003cspan class=\"n\"\u003eworkspace\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eanalyzer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetWorkspace\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 以後Microsoft.CodeAnalysis.AdhocWorkspaceを使用する\u003c/span\u003e\n\u003cspan class=\"k\"\u003eforeach\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eproject\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003eworkspace\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCurrentSolution\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eProjects\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// 個々のプロジェクト処理\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// プロジェクトのコンパイル(シンボル情報構築)\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// 型がAssemblyではなく、Microsoft.CodeAnalysis.Compilationなので注意\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ecompilation\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eproject\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetCompilationAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ediag\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003ecompilation\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetDiagnostics\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// コンパイルエラー等がある場合、\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 完了後にGetDiagnostics()を使用してエラー情報を取得する\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// compilation.GetSymbolsWithNameでクラス定義等が取得可能\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// キャストしないとISymbolで取得されるため、情報が非常に限定される\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eclsSymbol\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003ecompilation\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetSymbolsWithName\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e_\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eSymbolFilter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eType\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003eOfType\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eITypeSymbol\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;())\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// メンバーの取得\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// (メソッドやインナークラス等も入るため、ISymbol.Kindで場合分けを行う事)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ememberSymbol\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003eclsSymbol\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetMembers\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"実行\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%9F%E8%A1%8C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e実行\u003c/h3\u003e\n\n\u003cp\u003eコード生成部分の実装を終えた後は、それを実際に動かす必要があります。\u003cbr\u003e\n\u003ca href=\"https://docs.microsoft.com/ja-jp/dotnet/core/tools/extensibility\" rel=\"nofollow noopener\" target=\"_blank\"\u003e.NET Core CLI ツールの拡張モデル\u003c/a\u003eによると、\u003cbr\u003e\nいくつかの方法がありますが、今回は\u003ccode\u003e各プロジェクト ベースの拡張機能\u003c/code\u003eの方法を使用するのが、PATH環境変数も汚さずに済み、カスタムタスクに比べても作りが素直なのでいいのではないかと思います。\u003cbr\u003e\nMSBuildのカスタムタスクを実装する方法が最も応用が効く方法なのですが、どうもRoslyn関連のDLLが読み込めなかったので、この記事では深入りはしません。\u003c/p\u003e\n\n\u003cp\u003e具体的には以下のようにします。\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e\n\u003ccode\u003edotnet-[サブコマンド名]\u003c/code\u003eという名前でコンソールプロジェクトの作成\n\n\u003cul\u003e\n\u003cli\u003eProject/PropertyGroup/AssemblyNameを追加し、名前を\u003ccode\u003edotnet-[サブコマンド名]\u003c/code\u003eのようにしても可\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eコンソールプロジェクトでコード生成プログラムを実装\u003c/li\u003e\n\u003cli\u003enugetパッケージ(nupkg)を作成\u003c/li\u003e\n\u003cli\u003e使用するプロジェクトのProject/ItemGroup/DotNetCliToolReference要素に追加\n\n\u003cul\u003e\n\u003cli\u003e例: \u003ccode\u003e\u0026lt;DotNetCliToolReference Include=\"[パッケージ名]\" Version=\"[パッケージバージョン]\"/\u0026gt;\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003ePackageReference\u003c/code\u003eや\u003ccode\u003eProjectReference\u003c/code\u003eは不可\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e使用するプロジェクトのcsprojと同フォルダにNuGet.configを作成(\u003ccode\u003edotnet new nugetconfig\u003c/code\u003eで雛形作成できる)\u003c/li\u003e\n\u003cli\u003enuget.configの\u003ccode\u003econfiguration/packagesSources\u003c/code\u003eに、\u003ccode\u003e\u0026lt;add key=\"[任意の名前]\" value=\"[nupkgがあるフォルダ]\"/\u0026gt;\u003c/code\u003eという要素を追加\u003c/li\u003e\n\u003cli\u003e要素を追加したプロジェクトでnugetリストアを実行\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eこれで、DotNetCliToolReferenceを追加したcsprojをカレントディレクトリにして、\u003ccode\u003edotnet [サブコマンド]\u003c/code\u003eとすると、作成したコンソールプロジェクトが実行されます。\u003c/p\u003e\n\n\u003cp\u003e注意点としては、\u003cstrong\u003edotnetサブコマンドのプロジェクトが更新された場合、パッケージ作成プロジェクトと参照プロジェクト両方のパッケージバージョンを上げないと更新が反映されない\u003c/strong\u003eという点でしょうか。この辺りはnugetのキャッシュシステムが関係しているので、わかっている人ならば該当パッケージのキャッシュをクリアした上で、restoreするという手もあります。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"実装例\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%9F%E8%A3%85%E4%BE%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e実装例\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"https://github.com/itn3000/buildalyzertest\" rel=\"nofollow noopener\" target=\"_blank\"\u003e実装例として、テストプロジェクトを作成しました。\u003c/a\u003e\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eBuildalyzerTest.LibUser\n\n\u003cul\u003e\n\u003cli\u003eコード解析対象\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003edotnet-buildalyzertest\n\n\u003cul\u003e\n\u003cli\u003eコード解析、生成するコンソールアプリケーション\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003epack.ps1でnupkgを作成し、\u003ccode\u003edotnet restore\u003c/code\u003eでBuildalyzerTest.LibUserのrestoreを行うと、以後\u003ccode\u003edotnet buildalyzer-test\u003c/code\u003eというコマンドでコード生成を行うことができます。\u003c/p\u003e\n\n\u003cp\u003eこのプロジェクトでは、\u003ccode\u003e-p [csprojのファイルパス]\u003c/code\u003eオプションを指定して、クラスの解析と、\u003cbr\u003e\nメンバーをToStringでつなげた\u003ccode\u003epublic static string MemberwiseToString(this T obj)\u003c/code\u003eという拡張メソッドを作成し、標準出力に出しています。もう少し手を加えれば、csファイルの出力も十分可能です。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"注意点\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%B3%A8%E6%84%8F%E7%82%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e注意点\u003c/h1\u003e\n\n\u003cp\u003eBuildalyzerが依存しているMicrosoft.Buildと、dotnet-sdkのバージョンの食い違いにより、\u003cbr\u003e\n解析時に例外が発生したり、正しくドキュメント一覧が取れなくなる場合がある。\u003c/p\u003e\n\n\u003cp\u003eそのような場合は、コード解析を行うプロジェクトのPackageReferenceに、以下のパッケージを\u003cbr\u003e\n直接追加すれば、大体の場合現象は回避できる。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eMicrosoft.Build\u003c/li\u003e\n\u003cli\u003eMicrosoft.Build.Tasks.Core\u003c/li\u003e\n\u003cli\u003eMicrosoft.Build.Tasks.Utilities\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eまた、回避方法として、Buildalyzerが使用するMicrosoft.Buildのバージョンに対応するSDKを入れた上で、\u003cbr\u003e\n解析対象のプロジェクトに\u003ca href=\"https://docs.microsoft.com/ja-jp/dotnet/core/tools/global-json\" rel=\"nofollow noopener\" target=\"_blank\"\u003eglobal.json\u003c/a\u003eを置いて、sdk/versionの値をそのSDKのバージョンに指定する方法もある。\u003cbr\u003e\n(Buildalyzer-0.2.1はMicrosoft.Build-15.3.409を参照しているので、sdkバージョンは2.0.xを指定すればOK)\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"最後に\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%9C%80%E5%BE%8C%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e最後に\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"いい点\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%84%E3%81%84%E7%82%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eいい点\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003eオーバーヘッドが少ない\n\n\u003cul\u003e\n\u003cli\u003e基本的には愚直に書くのと同じなので、多くの場合、最高効率を目指しやすい\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eデバッグしやすい\n\n\u003cul\u003e\n\u003cli\u003eできあがるのは普通のC#なので、デバッグの際にどこに問題があるかわかりやすくなる\u003c/li\u003e\n\u003cli\u003e文法エラー等、単純なミスにコンパイル時に気づくことができる\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e実装をシンプルにできる(処理のキャッシュを持つ必要がない)\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"悪い点\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%82%AA%E3%81%84%E7%82%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e悪い点\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003e前準備が必要\n\n\u003cul\u003e\n\u003cli\u003eソースコード生成モジュールの作成\u003c/li\u003e\n\u003cli\u003e使用するプロジェクトのprojファイルに要素追加\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e生成した成果物を使用するプロジェクトのアセンブリファイルサイズが大きくなりやすい\n\n\u003cul\u003e\n\u003cli\u003e生成したコードが全てコンパイルされるため\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e特に前準備が手間というのは、大きいと思います。大体の場合、時間対効果を考えるならば、リフレクション等で済ませた方が楽です。しかし、ソースコード生成はハマるところにはハマるので、選択肢の一つとして持っておくのもいいのではないかと思います。\u003c/p\u003e\n","createdAt":"2017-12-11T17:08:03Z","elapsedYearsFromLastModifiedAt":2,"encryptedId":"UDi2dNxvCnkN2XC+DgdRur5eWAWpRMOt--ddWh441UrxR9Jrvl--Ia9uCFQM9TYMWOXSKSwuxg==","isBanned":false,"isDeprecated":true,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2018-10-04T08:27:34Z","likesCount":21,"linkUrl":"https://qiita.com/skitoy4321/items/bea79049d2b156f64d78","organization":null,"originalId":586869,"stockedCount":27,"title":"C#で半自動ソースコード生成を行う","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003eはじめに\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%AA%E3%81%9C%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%89%E7%94%9F%E6%88%90%E3%81%8B\"\u003eなぜソースコード生成か\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%89%8D%E6%8F%90%E6%9D%A1%E4%BB%B6\"\u003e前提条件\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#buildalyzer%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\"\u003eBuildalyzerについて\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%B0%8E%E5%85%A5\"\u003e導入\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%BD%BF%E7%94%A8\"\u003e使用\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%AE%9F%E8%A3%85\"\u003e実装\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%AE%9F%E8%A1%8C\"\u003e実行\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%AE%9F%E8%A3%85%E4%BE%8B\"\u003e実装例\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%B3%A8%E6%84%8F%E7%82%B9\"\u003e注意点\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%9C%80%E5%BE%8C%E3%81%AB\"\u003e最後に\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%84%E3%81%84%E7%82%B9\"\u003eいい点\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%82%AA%E3%81%84%E7%82%B9\"\u003e悪い点\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":10243,"uuid":"bea79049d2b156f64d78","banReason":null,"adventCalendarItem":{"day":12,"calendar":{"name":"C#","urlName":"csharp","year":2017,"organization":null}},"author":{"encryptedId":"QTDN3gt9pMKjoakL4otLpKW6mFuu--4TvCdmX9SVyeT8FH--SRQhqjM20YM2DXn5C1T25w==","originalId":103253,"description":"","facebookUrl":null,"githubUrl":null,"isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"","profileImageUrl":"https://qiita-image-store.s3.amazonaws.com/0/103253/profile-images/1526359222","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F103253%2Fprofile-images%2F1526359222?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=a7dce827dc16582e1b8e9c7a52216638","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F103253%2Fprofile-images%2F1526359222?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=9623ed561bd61ca207da0cb6419ba01d","urlName":"skitoy4321","websiteUrl":"","twitterUrl":"https://twitter.com/skitoy4321","twitterUrlName":"skitoy4321","revealedOrganizations":{"edges":[]}},"tags":[{"name":"C#","urlName":"csharp"},{"name":"Roslyn","urlName":"roslyn"},{"name":"Buildalyzer","urlName":"buildalyzer"}],"followingLikers":{"edges":[]},"comments":{"totalCount":1}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

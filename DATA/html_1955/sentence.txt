More than 1 year has passed since last update.汎用ホスト（GenericHost）におけるログ出力で使用する ILogger のログ出力メソッドの拡張について考えてみます。このドキュメントの内容は .NET Core 3.1 で確認しています。Microsoft.Extensions.Logging.ILogger インターフェースに定義されているログ出力メソッドは Log&lt;TState&gt; のみです。最終的にはこのメソッドに集約されることになります。Microsoft.Extensions.Logging.LoggerExtensions クラスに ILogger インターフェースに対する拡張メソッドが定義されています。通常はこれらのログ出力メソッドを使用することが多いと思います。ログメッセージを生成する Func&lt;string&gt; 型のメソッドを引数として受け取るログ出力メソッドを拡張メソッドとして実装してみます。最終的に ILogger.Log&lt;TState&gt; メソッドを呼び出すこととします。LogMessageBuilderState 型のインスタンスに受け取ったメソッドを格納し、ILogger.Log&lt;TState&gt; メソッドに渡します。CallerInfo 属性を使ったログ出力メソッドを実装してみます。CallerInfo 属性はメソッドの呼び出し元情報を引数として取得することができる属性です。コンパイラによってメソッドの呼び出しコードに値が埋め込まれるため、実行時の負荷はほとんどありません。次のようなログ出力メソッドがあるとします。このログ出力メソッドを次のように呼び出します。CallerInfo 属性にあたる3つの引数は optional ですので省略可能です。コンソールには次のようなログが出力されます。CallerInfo 属性を使ったログ出力メソッドを拡張メソッドとして実装してみます。最終的に ILogger.Log&lt;TState&gt; メソッドを呼び出すこととします。LogWithCallerState 型のインスタンスにログメッセージと呼び出し元情報を格納し、ILogger.Log&lt;TState&gt; メソッドに渡します。フォーマットメソッドは静的フィールドに保持させておく他、ILogger が ILogFormatter&lt;LogWithCallerState&gt; インターフェースを実装する場合はそのフォーマットメソッドを使用するようにしています。



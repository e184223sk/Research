<!DOCTYPE html><html><head><meta charset="utf-8" /><title>Null 非許容な参照型 - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/matarillo/items/4304df03d28db889f7e5" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="RARzWOrxJVlM8Clnc8tc1K2042flLAW49+G8zqE0gce+uOSlksDSqFlE1tLJdVGHYiTBlJJ8N75Z6wwgnWOEUg==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta content="@matarillo" name="twitter:creator" /><meta property="og:type" content="article"><meta property="og:title" content="Null 非許容な参照型 - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1UblZzYkNEcG5aN29xTEhscnJuamdhcmxqNExuaGFmbG5vcyZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTU0JnR4dC1jbGlwPWVsbGlwc2lzJnR4dC1hbGlnbj1jZW50ZXIlMkNtaWRkbGUmcz0xODE4OWE4ZGZlM2RjMmJkNDAxMGVhZjgwZTI1YTZiNg&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RRzFoZEdGeWFXeHNidyZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTQ1JnR4dC1hbGlnbj1yaWdodCUyQ2JvdHRvbSZzPTcyNzI1Y2NmNzc5N2ZmODNhNDc5NTIyOTlhNTJmNGZl&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=d938acaf10e20c845d16a52cadb0d435"><meta property="og:description" content="

この記事について

この記事は2017年 C# Advent Calendar 12月9日の記事です。

C# 8.0に向けて検討中で、11/15にプレビュー版が公開された C# の新機能「nullable reference t..."><meta content="https://qiita.com/matarillo/items/4304df03d28db889f7e5" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#,Kotlin,NULL" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 1nzh4zz 38fzdi helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-1nzh4zz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:16px 32px;background-color:#FBE69E;color:rgba(0,0,0,0.87);line-height:1.5;font-weight:600;}@media (max-width:770px){.css-1nzh4zz{padding:16px;}}.css-38fzdi{color:#CA832A;margin-right:4px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-363104e1-0807-4455-a7b4-b0fdd0bce728"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Fmatarillo%2Fitems%2F4304df03d28db889f7e5">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Fmatarillo%2Fitems%2F4304df03d28db889f7e5">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-363104e1-0807-4455-a7b4-b0fdd0bce728">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2017-12-06T09:44:32.000+09:00","dateModified":"2017-12-12T18:29:35.000+09:00","headline":"Null 非許容な参照型","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1UblZzYkNEcG5aN29xTEhscnJuamdhcmxqNExuaGFmbG5vcyZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTU0JnR4dC1jbGlwPWVsbGlwc2lzJnR4dC1hbGlnbj1jZW50ZXIlMkNtaWRkbGUmcz0xODE4OWE4ZGZlM2RjMmJkNDAxMGVhZjgwZTI1YTZiNg\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RRzFoZEdGeWFXeHNidyZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTQ1JnR4dC1hbGlnbj1yaWdodCUyQ2JvdHRvbSZzPTcyNzI1Y2NmNzc5N2ZmODNhNDc5NTIyOTlhNTJmNGZl\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=d938acaf10e20c845d16a52cadb0d435","mainEntityOfPage":"https://qiita.com/matarillo/items/4304df03d28db889f7e5","author":{"@type":"Person","address":null,"email":null,"identifier":"matarillo","name":"matarillo","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F2079%2Fprofile-images%2F1473680702?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=f5d14452e90e4b7c9f5d33050622ea16","url":"https://qiita.com/matarillo","description":"","memberOf":[]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://zine.qiita.com/interview/202106-uzabase-3/">社員の行動の基盤となるユーザベースのミッション・バリュー</a><a target="_blank" id="header_text_message_2" href="https://zine.qiita.com/interview/202106-uzabase-3/">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"matarillo","type":"items","id":"4304df03d28db889f7e5"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"社員の行動の基盤となるユーザベースのミッション・バリュー","url":"https://zine.qiita.com/interview/202106-uzabase-3/","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"matarillo","type":"items","id":"4304df03d28db889f7e5"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_1","message":"社員の行動の基盤となるユーザベースのミッション・バリュー","url":"https://zine.qiita.com/interview/202106-uzabase-3/","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"matarillo","type":"items","id":"4304df03d28db889f7e5"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_2","message":"社員の行動の基盤となるユーザベースのミッション・バリュー","url":"https://zine.qiita.com/interview/202106-uzabase-3/","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/matarillo/items/4304df03d28db889f7e5","location":"/matarillo/items/4304df03d28db889f7e5","scheme":"https","host":"qiita.com","port":null,"pathname":"/matarillo/items/4304df03d28db889f7e5","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"qtuG/377iUhEqgywGiwo79xuVJ6ft89qFtEKCqOE8TxQZxECBsp+uVEe8wWgkiW8E/52bejn/Wy427rkn9P0qQ==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-9f203829-18b3-48ac-8611-d34ca320821c"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/matarillo/items/4304df03d28db889f7e5/likers" class="css-1iupg5d">52</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">31</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/4304df03d28db889f7e5/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/matarillo/items/4304df03d28db889f7e5/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/matarillo/items/4304df03d28db889f7e5/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/matarillo/items/4304df03d28db889f7e5/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/matarillo/items/4304df03d28db889f7e5.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-1nzh4zz"><span class="fa fa-fw fa-warning css-38fzdi"></span><p>More than 3 years have passed since last update.</p></div><div class="css-helsa7"><div class="css-8qb8m4"><div class="it-AdcalRibbon"><span><a href="/advent-calendar/2017/csharp" class="it-AdcalRibbon_title">C#<!-- --> Advent Calendar<!-- --> <!-- -->2017</a>Day 9</span></div><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/matarillo"><img class="css-100alwu eyfquo10" src="https://qiita-image-store.s3.amazonaws.com/0/2079/profile-images/1473680702" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/matarillo" class="css-10ougpm">@<!-- -->matarillo</a><div class="css-1ay9vb9"><span><meta content="2017-12-06T00:44:32Z"/><time dateTime="2017-12-12T09:29:35Z" class="css-m19uds">updated at 2017-12-12</time></span></div></div></div></div></div><h1 class="css-cgzq40">Null 非許容な参照型</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/kotlin" class="css-4czcte">Kotlin</a><a href="/tags/null" class="css-4czcte">NULL</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div>
<h1>
<span id="この記事について" class="fragment"></span><a href="#%E3%81%93%E3%81%AE%E8%A8%98%E4%BA%8B%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>この記事について</h1>

<p>この記事は<a href="https://qiita.com/advent-calendar/2017/csharp">2017年 C# Advent Calendar</a> 12月9日の記事です。</p>

<p>C# 8.0に向けて検討中で、<a href="https://blogs.msdn.microsoft.com/dotnet/2017/11/15/nullable-reference-types-in-csharp/" rel="nofollow noopener" target="_blank">11/15にプレビュー版が公開された</a> C# の新機能「nullable reference types」について説明するものです。</p>

<p>"nullable reference types" を直訳するなら「Null 許容参照型」になるかと思いますが、この機能の実態を一言で言うと、参照型がnullを <em>可能な限り受け入れない</em> ようにするもの、と考えたほうがいいでしょう。そのあたりのことを説明していきます。</p>

<p>Disclaimer: この記事は11/15のプレビュー版を前提にしたものです。これはあくまで現時点での <a href="https://github.com/dotnet/csharplang/issues/36" rel="nofollow noopener" target="_blank">仕様に関する議論</a> を形にしたプロトタイプでしかなく、今後の議論によって仕様も実装も大きく変わる可能性があると思っていたほうがいいでしょう。CTP (Community Technology Preview) と言われるものよりも実験的な色合いが強いと個人的には理解しています。</p>

<h1>
<span id="プレビュー版を試すための環境" class="fragment"></span><a href="#%E3%83%97%E3%83%AC%E3%83%93%E3%83%A5%E3%83%BC%E7%89%88%E3%82%92%E8%A9%A6%E3%81%99%E3%81%9F%E3%82%81%E3%81%AE%E7%92%B0%E5%A2%83"><i class="fa fa-link"></i></a>プレビュー版を試すための環境</h1>

<p>リリースされたバイナリはC# コンパイラ (Roslyn) 拡張を置き換えてしまいますので、試用専用の環境を用意することを強く推奨します。</p>

<p>Visual Studio 15.5 (プレビュー4以降) が必要で、かつ、他のバージョンをインストールしないでください。複数バージョンのVisual Studioが共存していると、インストール用バッチファイルがエラーになります。</p>

<p>試用環境が準備できたら、<a href="https://github.com/dotnet/csharplang/wiki/Nullable-Reference-Types-Preview" rel="nofollow noopener" target="_blank">GitHubの dotnet/csharplang リポジトリのWiki</a> に行き、リンクされている Roslyn_Nullable_References_Preview.zip をダウンロードして展開した後、Visual Studioを閉じて <code>install.bat</code>を実行してください。</p>

<h1>
<span id="どういうコードの書き方になるか概要" class="fragment"></span><a href="#%E3%81%A9%E3%81%86%E3%81%84%E3%81%86%E3%82%B3%E3%83%BC%E3%83%89%E3%81%AE%E6%9B%B8%E3%81%8D%E6%96%B9%E3%81%AB%E3%81%AA%E3%82%8B%E3%81%8B%E6%A6%82%E8%A6%81"><i class="fa fa-link"></i></a>どういうコードの書き方になるか：概要</h1>

<p>注意：この記事では、型推論（<code>var</code>など）を使っていません。これは、11/15のプレビュー版ではnull非許容参照型と型推論の組み合わせに一部問題があるからです。問題についてはこの記事では扱いませんので、 <a href="https://github.com/dotnet/csharplang/wiki/Nullable-Reference-Types-Preview" rel="nofollow noopener" target="_blank">Wiki</a> などを見てください。（TBD. 余力があったらフォローする。）</p>

<h2>
<span id="概要1-基本" class="fragment"></span><a href="#%E6%A6%82%E8%A6%811-%E5%9F%BA%E6%9C%AC"><i class="fa fa-link"></i></a>概要1. 基本</h2>

<p>参照型は原則的にnullを値に持てなくなります。参照型の変数、フィールド、プロパティ、引数にnullを代入したり、戻り値が参照型のメソッドでnullを返したりすると、コンパイル時に警告されます。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="kt">string</span> <span class="n">s0</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span> <span class="c1">// NG (警告)</span>
<span class="kt">string</span> <span class="n">s1</span> <span class="p">=</span> <span class="k">default</span><span class="p">(</span><span class="kt">string</span><span class="p">);</span> <span class="c1">// NG (警告)</span>
<span class="kt">string</span> <span class="n">s2</span> <span class="p">=</span> <span class="s">"abc"</span><span class="p">;</span> <span class="c1">// OK</span>
<span class="kt">string</span> <span class="n">s3</span> <span class="p">=</span> <span class="n">s2</span><span class="p">;</span> <span class="c1">// OK</span>
</code></pre></div></div>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">static</span> <span class="kt">string</span> <span class="nf">NonNullableString</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">dice</span> <span class="p">=</span> <span class="m">1</span> <span class="p">+</span> <span class="k">new</span> <span class="nf">Random</span><span class="p">().</span><span class="nf">Next</span><span class="p">(</span><span class="m">6</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">dice</span> <span class="p">==</span> <span class="m">6</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">null</span><span class="p">;</span> <span class="c1">// NG (警告)</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="s">"ABC"</span><span class="p">;</span> <span class="c1">// OK</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>null非許容参照型のフィールドを持つ型は、コンストラクターの中で、nullでない値で初期化する必要があります。初期化されないフィールドがあると、コンパイル時に警告されます。<sup id="fnref1"><a href="#fn1" title="this()の呼び出しがあるなど、警告が出ないケースがあることがKnown Issues（既知の問題）として挙がっています。">1</a></sup></p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">class</span> <span class="nc">C</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="kt">string</span> <span class="n">s0</span><span class="p">;</span> <span class="c1">// OK</span>

    <span class="k">private</span> <span class="kt">string</span> <span class="n">s1</span><span class="p">;</span> <span class="c1">// NG (警告)</span>

    <span class="k">public</span> <span class="nf">C</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="n">s0</span> <span class="p">=</span> <span class="s">"ABC"</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>（追記）構造体は、<code>default(T)</code> で初期化すると、すべてのフィールドがデフォルト値となります。フィールドにnull非許容な参照型を含んでいた場合は、そのフィールドの値が <code>null</code> となります。これは本来は警告すべきなのかもしれませんが、現実のコード上にあまりに多いため、あえて警告しない仕様としています。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">struct</span> <span class="nc">V</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Field</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="n">V</span> <span class="k">value</span> <span class="p">=</span> <span class="k">default</span><span class="p">(</span><span class="n">V</span><span class="p">);</span> <span class="c1">// OK（警告なし）</span>
</code></pre></div></div>

<p>nullを代入するかもしれない参照型は、参照型名の末尾に <code>?</code> を付与します。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="kt">string</span><span class="p">?</span> <span class="n">ns0</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span> <span class="c1">// OK</span>
<span class="kt">string</span><span class="p">?</span> <span class="n">ns1</span> <span class="p">=</span> <span class="k">default</span><span class="p">(</span><span class="kt">string</span><span class="p">);</span> <span class="c1">// OK</span>
<span class="kt">string</span><span class="p">?</span> <span class="n">ns2</span> <span class="p">=</span> <span class="s">"ABC"</span><span class="p">;</span> <span class="c1">// OK</span>
<span class="kt">string</span><span class="p">?</span> <span class="n">ns3</span> <span class="p">=</span> <span class="n">ns2</span><span class="p">;</span> <span class="c1">// OK</span>
</code></pre></div></div>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">static</span> <span class="kt">string</span><span class="p">?</span> <span class="nf">NullableString</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">dice</span> <span class="p">=</span> <span class="m">1</span> <span class="p">+</span> <span class="k">new</span> <span class="nf">Random</span><span class="p">().</span><span class="nf">Next</span><span class="p">(</span><span class="m">6</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">dice</span> <span class="p">==</span> <span class="m">6</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">null</span><span class="p">;</span> <span class="c1">// OK</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="s">"ABC"</span><span class="p">;</span> <span class="c1">// OK</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>参照型 <code>A</code> の値を null許容参照型 <code>A?</code> に使うことはできますが、その逆は原則的にできません。（ただし、フロー解析によってその制限は緩められます。そのことは後述します。）</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="kt">string</span> <span class="n">s0</span> <span class="p">=</span> <span class="nf">NonNullableString</span><span class="p">();</span> <span class="c1">// 戻り値はstring型</span>
<span class="kt">string</span><span class="p">?</span> <span class="n">ns0</span> <span class="p">=</span> <span class="n">s0</span><span class="p">;</span> <span class="c1">// OK</span>

<span class="kt">string</span><span class="p">?</span> <span class="n">ns1</span> <span class="p">=</span> <span class="nf">NullableString</span><span class="p">();</span> <span class="c1">// 戻り値はstring?型</span>
<span class="kt">string</span> <span class="n">s1</span> <span class="p">=</span> <span class="n">ns1</span><span class="p">;</span> <span class="c1">// NG (警告)</span>
</code></pre></div></div>

<h2>
<span id="概要2-デリファレンス参照剥がしとフロー解析" class="fragment"></span><a href="#%E6%A6%82%E8%A6%812-%E3%83%87%E3%83%AA%E3%83%95%E3%82%A1%E3%83%AC%E3%83%B3%E3%82%B9%E5%8F%82%E7%85%A7%E5%89%A5%E3%81%8C%E3%81%97%E3%81%A8%E3%83%95%E3%83%AD%E3%83%BC%E8%A7%A3%E6%9E%90"><i class="fa fa-link"></i></a>概要2. デリファレンス(参照剥がし)とフロー解析</h2>

<p>null許容参照型 <code>A?</code> の値は、文字通り<code>null</code>かもしれないので、型 <code>A</code> に定義されているインスタンスメンバー（フィールドやメソッドやプロパティやイベントなど）にアクセスするコード、つまり実行時に<code>NullReferenceException</code>が投げられる可能性があるコードはコンパイル時に警告されます。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="kt">string</span><span class="p">?</span> <span class="n">ns0</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
<span class="kt">string</span> <span class="n">lower</span> <span class="p">=</span> <span class="n">ns0</span><span class="p">.</span><span class="nf">ToLowerInvariant</span><span class="p">();</span> <span class="c1">// NG (警告)</span>
</code></pre></div></div>

<p>そのような状況では、null条件演算子 <code>?.</code> を使うことができます。インスタンスメンバーの型（メソッド呼び出しの場合は戻り値の型）が型 <code>R</code> だった場合は、null条件演算子 <code>?.</code> を通して呼び出すと <code>R?</code> 型となります。これは、型 <code>R</code> が値型だった場合でも参照型だった場合でも同様となります。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="kt">string</span><span class="p">?</span> <span class="n">ns0</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
<span class="kt">string</span><span class="p">?</span> <span class="n">nlower</span> <span class="p">=</span> <span class="n">ns0</span><span class="p">?.</span><span class="nf">ToLowerInvariant</span><span class="p">();</span> <span class="c1">// OK</span>
</code></pre></div></div>

<p>null条件演算子 <code>?.</code> を使った上のコードは、下のように三項条件演算子 <code>? :</code> で分岐したコードと等価です。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="kt">string</span><span class="p">?</span> <span class="n">ns0</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
<span class="kt">string</span><span class="p">?</span> <span class="n">nlower</span> <span class="p">=</span> <span class="p">(</span><span class="n">ns0</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">?</span> <span class="n">ns0</span><span class="p">.</span><span class="nf">ToLowerInvariant</span><span class="p">()</span> <span class="p">:</span> <span class="k">null</span><span class="p">;</span>
</code></pre></div></div>

<p>あるいは、 <code>if</code> 文で分岐しても同じです。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="kt">string</span><span class="p">?</span> <span class="n">ns0</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
<span class="kt">string</span><span class="p">?</span> <span class="n">nlower</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="n">ns0</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">nlower</span> <span class="p">=</span> <span class="n">ns0</span><span class="p">.</span><span class="nf">ToLowerInvariant</span><span class="p">();</span>
<span class="p">}</span>
<span class="k">else</span>
<span class="p">{</span>
    <span class="n">nlower</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>この上の2つのコード片では <code>string?</code> 型のはずの <code>ns0</code> に対して <code>ns0.ToLowerInvariant();</code> のようにメンバーアクセスをしていますが、実はこの2つのコードも問題なくコンパイルできます。（警告が出ません）。それは、三項条件演算子 <code>? :</code> や <code>if</code> 文で、nullチェックの結果で分岐をしているからです。<br>
実は、nullチェックの結果に基づいて分岐をした場合など、null許容参照型 <code>A?</code> の <em>値がnullではないことがコンパイラーにとって明確になっている実行パス</em> では、その範囲に限り、null非許容の <code>A</code> 型として値を利用するコードを書くことができるのです。このように、制御フローの各実行パスにおいて、データの取りうる値をコンパイラーが追跡して認識することを、<strong>データフロー解析</strong>、または省略して<strong>フロー解析</strong>と呼びます。C# 8のnull非許容参照型を使ったコードでは、C#コンパイラがフロー解析を行い、値がnullにならない実行パスを見つけているのです。</p>

<p>フロー解析では、nullチェックの分岐だけではなく、null許容参照型 <code>A?</code> のローカル変数に null非許容の <code>A</code> 型の値を代入したときも追跡されます。その代入を起点として、<code>null</code>そのもの、またはnullの可能性がある <code>A?</code> 型の値を代入するまで、その変数はnullにならない <code>A</code> 型として利用できます。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="kt">string</span> <span class="n">s0</span> <span class="p">=</span> <span class="s">"ABC"</span><span class="p">;</span>
<span class="kt">string</span><span class="p">?</span> <span class="n">ns1</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
<span class="kt">string</span><span class="p">?</span> <span class="n">ns2</span><span class="p">;</span>

<span class="n">ns2</span> <span class="p">=</span> <span class="n">s0</span><span class="p">;</span> <span class="c1">// ☆</span>
<span class="c1">// ☆から◆までの間、ns2はnullではない</span>
<span class="kt">string</span> <span class="n">s1</span> <span class="p">=</span> <span class="n">ns1</span><span class="p">.</span><span class="nf">ToLowerInvariant</span><span class="p">();</span> <span class="c1">// OK</span>

<span class="n">ns2</span> <span class="p">=</span> <span class="n">ns1</span><span class="p">;</span> <span class="c1">// ◆</span>
<span class="c1">// ここから、ns2はnull</span>
<span class="kt">string</span> <span class="n">s2</span> <span class="p">=</span> <span class="n">ns1</span><span class="p">.</span><span class="nf">ToLowerInvariant</span><span class="p">();</span> <span class="c1">// NG (警告)</span>
</code></pre></div></div>

<p>ただし、フロー解析を厳密にかつプログラム全体に渡って行うことはコンパイラーにとって非常に難しいことです。解析を厳密にしたり、解析範囲を広くしたりすればするほど、コンパイル時間も長くなってしまいます。また、マルチスレッドモデルにおいては、ある変数の値を複数のスレッドが変更できる場合、静的な解析ではその変数がnullでないことを保証できなくなります。</p>

<p>そこで、C# 8のnull非許容参照型では、</p>

<ul>
<li>フロー解析は1メソッドの範囲内に限定する（フロー解析の結果をメソッド外に引き継がない）</li>
<li>フロー解析の起点はローカル変数またはメソッド引数に限定する（フィールドやプロパティなどはフロー解析しない）</li>
</ul>

<p>としています。</p>

<p>また、それ以外にも、リリースまでにはサポートしたいけれどもプレビュー版ではまだフロー解析が不十分なケースや、そもそもサポートするべきかどうかがまだ議論中のケースなどもあります。（TBD. 例示）</p>

<p>というわけで、プログラマーにはnullでないことが明らかでも、C#コンパイラーには判断ができない場合があります。そのような場合は、<code>!</code>演算子を使います。<br>
<code>!</code>演算子は、null許容参照型を、警告を出さずに強制的にnull非許容参照型に変換します。<code>!</code> の優先順位は高いので、たとえば警告を出さずに強制的にメンバーアクセスしたければ、<code>!.</code>のように書くこともできます。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="kt">int</span> <span class="n">dice</span> <span class="p">=</span> <span class="m">1</span> <span class="p">+</span> <span class="k">new</span> <span class="nf">Random</span><span class="p">().</span><span class="nf">Next</span><span class="p">(</span><span class="m">6</span><span class="p">);</span>
<span class="kt">string</span><span class="p">?</span> <span class="n">ns0</span> <span class="p">=</span> <span class="p">(</span><span class="n">dice</span> <span class="p">&lt;</span> <span class="m">6</span><span class="p">)</span> <span class="p">?</span> <span class="s">"ABC"</span> <span class="p">:</span> <span class="k">null</span><span class="p">;</span>
<span class="kt">string</span><span class="p">?</span> <span class="n">ns1</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="n">ns0</span> <span class="p">!=</span> <span class="n">ns1</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// ns0はnullではないが、C#コンパイラーはそのような判断をしないため、!演算子を使う</span>
    <span class="kt">string</span> <span class="n">s0</span> <span class="p">=</span> <span class="n">ns0</span><span class="p">!;</span> <span class="c1">// OK</span>
    <span class="kt">string</span> <span class="n">s1</span> <span class="p">=</span> <span class="n">s0</span> <span class="p">+</span> <span class="n">ns0</span><span class="p">!.</span><span class="nf">ToLowerInvariant</span><span class="p">();</span> <span class="c1">// OK</span>
    <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">s1</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>理解の早い方はおわかりと思いますが、この <code>!</code> 演算子はコンパイル時のnullチェックを回避して実行時のnullチェックに変えてしまうものです。誤った使い方をしても警告が出ないので、実行時に<code>NullReferenceException</code>が投げられる可能性を排除できない機能といえます。この機能を使う時は危険性をきちんと理解した上で濫用しないようにしましょう。</p>

<h2>
<span id="概要3-配列ジェネリクス" class="fragment"></span><a href="#%E6%A6%82%E8%A6%813-%E9%85%8D%E5%88%97%E3%82%B8%E3%82%A7%E3%83%8D%E3%83%AA%E3%82%AF%E3%82%B9"><i class="fa fa-link"></i></a>概要3. 配列/ジェネリクス</h2>

<p>配列の要素やジェネリックコレクションの型引数に参照型を指定するときも、デフォルトはnull非許容です。nullを許容させたい場合は <code>?</code> を付与します。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="kt">string</span><span class="p">[]</span> <span class="n">array0</span> <span class="p">=</span> <span class="p">{</span> <span class="s">"a"</span><span class="p">,</span> <span class="s">"b"</span><span class="p">,</span> <span class="s">"c"</span> <span class="p">};</span> <span class="c1">// OK</span>
<span class="kt">string</span><span class="p">[]</span> <span class="n">array1</span> <span class="p">=</span> <span class="p">{</span> <span class="s">"a"</span><span class="p">,</span> <span class="s">"b"</span><span class="p">,</span> <span class="k">null</span> <span class="p">};</span> <span class="c1">// NG (警告)</span>

<span class="kt">string</span><span class="p">?[]</span> <span class="n">narray0</span> <span class="p">=</span> <span class="p">{</span> <span class="s">"a"</span><span class="p">,</span> <span class="s">"b"</span><span class="p">,</span> <span class="k">null</span> <span class="p">};</span> <span class="c1">// OK</span>
<span class="kt">string</span><span class="p">?[]</span> <span class="n">narray1</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">string</span><span class="p">?[]</span> <span class="p">{</span> <span class="s">"a"</span><span class="p">,</span> <span class="s">"b"</span><span class="p">,</span> <span class="k">null</span> <span class="p">};</span> <span class="c1">// OK</span>

<span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">list0</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="p">{</span> <span class="s">"a"</span><span class="p">,</span> <span class="s">"b"</span><span class="p">,</span> <span class="s">"c"</span> <span class="p">};</span> <span class="c1">// OK</span>
<span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">list1</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="p">{</span> <span class="s">"a"</span><span class="p">,</span> <span class="s">"b"</span><span class="p">,</span> <span class="k">null</span> <span class="p">};</span> <span class="c1">// NG (警告)</span>

<span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">?&gt;</span> <span class="n">nlist0</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">?&gt;</span> <span class="p">{</span> <span class="s">"a"</span><span class="p">,</span> <span class="s">"b"</span><span class="p">,</span> <span class="k">null</span> <span class="p">};</span> <span class="c1">// OK</span>
</code></pre></div></div>

<p>（追記）配列は、初期化子なしの <code>new</code> で生成すると、すべての要素がデフォルト値となります。要素の型がnull非許容な参照型だった場合は、すべての要素が <code>null</code> となります。これは本来は警告すべきなのかもしれませんが、現実のコード上にあまりに多いため、あえて警告しない仕様としています。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="kt">string</span><span class="p">[]</span> <span class="n">array</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">string</span><span class="p">[</span><span class="m">10</span><span class="p">];</span> <span class="c1">// OK（警告なし）</span>
</code></pre></div></div>

<p>配列やジェネリックコレクション自体も参照型なので、デフォルトはnull禁止です。配列やジェネリックコレクション自体がnullを許容するようにするには、型全体の末尾に <code>?</code> を置きます。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="kt">string</span><span class="p">[]</span> <span class="n">array0</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span> <span class="c1">// NG (警告)</span>
<span class="kt">string</span><span class="p">[]?</span> <span class="n">n_array1</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span> <span class="c1">// OK</span>

<span class="kt">string</span><span class="p">?[]</span> <span class="n">narray2</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span> <span class="c1">// NG (警告)</span>
<span class="kt">string</span><span class="p">?[]?</span> <span class="n">n_narray3</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span> <span class="c1">// OK</span>

<span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">list0</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span> <span class="c1">// NG (警告)</span>
<span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;?</span> <span class="n">n_list1</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span> <span class="c1">// OK</span>

<span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">?&gt;</span> <span class="n">nlist2</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span> <span class="c1">// NG (警告)</span>
<span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">?&gt;?</span> <span class="n">n_nlist3</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span> <span class="c1">// OK</span>
</code></pre></div></div>

<p>現在の仕様では、配列やジェネリックコレクションは「非変」扱い、つまり、参照型 <code>A</code> の配列やジェネリックコレクションの値を、null許容参照型 <code>A?</code> の配列やジェネリックコレクションに使うことはできません。（追記：配列の共変性については<a href="https://github.com/dotnet/csharplang/wiki/Nullable-Reference-Types-Preview#array-covariance" rel="nofollow noopener" target="_blank">WikiにKnown Issues（既知の問題）として挙がっていました</a>。今後変わる可能性があります。）</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="kt">string</span><span class="p">[]</span> <span class="n">array0</span> <span class="p">=</span> <span class="p">{</span> <span class="s">"a"</span><span class="p">,</span> <span class="s">"b"</span><span class="p">,</span> <span class="s">"c"</span> <span class="p">};</span>
<span class="kt">string</span><span class="p">?[]</span> <span class="n">narray1</span> <span class="p">=</span> <span class="n">array0</span><span class="p">;</span> <span class="c1">// NG (警告)</span>

<span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">list0</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="p">{</span> <span class="s">"a"</span><span class="p">,</span> <span class="s">"b"</span><span class="p">,</span> <span class="s">"c"</span> <span class="p">};</span>
<span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">?&gt;</span> <span class="n">nlist1</span> <span class="p">=</span> <span class="n">list0</span><span class="p">;</span> <span class="c1">// NG (警告)</span>
</code></pre></div></div>

<h1>
<span id="コンパイル結果がどうなるか" class="fragment"></span><a href="#%E3%82%B3%E3%83%B3%E3%83%91%E3%82%A4%E3%83%AB%E7%B5%90%E6%9E%9C%E3%81%8C%E3%81%A9%E3%81%86%E3%81%AA%E3%82%8B%E3%81%8B"><i class="fa fa-link"></i></a>コンパイル結果がどうなるか</h1>

<p>概要を説明しましたが、理解の早い方は「あれ？値型の場合とはいろいろ違うぞ？」と思われたかもしれません。その通りで、参照型に対するnull許容性は、値型に対するnull許容性と似て非なるものです。なぜなら、実現方式が全く異なるためです。一言でまとめると以下のようになります。</p>

<dl>
<dt>値型 <code>V</code> のnull許容性</dt>
<dd>型 <code>V?</code> は コード上も実行時も <code>System.Nullable&lt;V&gt;</code> と等価
</dd>
<dt>参照型 <code>R</code> のnull許容性</dt>
<dd>型 <code>R?</code> はコンパイラーに対する注釈でしかなく、コンパイル後や実行時はただの型 <code>R</code> として扱われる、型消去(Type erasure)</dd>
</dl>

<p>というわけで、参照型のnull許容性では、<code>System.Nullable&lt;T&gt;</code>などの別の型でラップしているわけではないので、値型の時のように <code>HasValue</code> プロパティや <code>Value</code> プロパティを参照するコードを <em>書かなくていい</em> というよりむしろ <em>書けない</em> (その代わり、null許容性がフロー解析によって変化する) のでした。</p>

<p>では、コンパイル結果がどうなるかを、<a href="http://ilspy.net/" rel="nofollow noopener" target="_blank">ILSpy</a>や<a href="https://github.com/0xd4d/dnSpy" rel="nofollow noopener" target="_blank">dnSpy</a>で逆コンパイルしてみましょう。<sup id="fnref2"><a href="#fn2" title="実際には逆コンパイラーの出力を一部修正しています。">2</a></sup><br>
リストAは、ローカル変数にだけnull許容参照型を使った場合です。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">リストA（元のコード）</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">static</span> <span class="k">void</span> <span class="nf">M</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">dice</span> <span class="p">=</span> <span class="m">1</span> <span class="p">+</span> <span class="k">new</span> <span class="nf">Random</span><span class="p">().</span><span class="nf">Next</span><span class="p">(</span><span class="m">6</span><span class="p">);</span>
    <span class="kt">string</span><span class="p">?</span> <span class="n">ns0</span> <span class="p">=</span> <span class="p">(</span><span class="n">dice</span> <span class="p">&lt;</span> <span class="m">6</span><span class="p">)</span> <span class="p">?</span> <span class="s">"ABC"</span> <span class="p">:</span> <span class="k">null</span><span class="p">;</span>
    <span class="kt">string</span><span class="p">?</span> <span class="n">ns1</span> <span class="p">=</span> <span class="n">ns0</span><span class="p">?.</span><span class="nf">ToLowerInvariant</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ns1</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">ns1</span><span class="p">.</span><span class="n">Length</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kt">string</span> <span class="n">s2</span> <span class="p">=</span> <span class="n">ns</span><span class="p">!.</span><span class="nf">Replace</span><span class="p">(</span><span class="sc">'a'</span><span class="p">,</span> <span class="sc">'A'</span><span class="p">);</span>
    <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">s2</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</div>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">リストA（コンパイル結果を逆コンパイルしたコード）</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">static</span> <span class="k">void</span> <span class="nf">M</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">dice</span> <span class="p">=</span> <span class="m">1</span> <span class="p">+</span> <span class="k">new</span> <span class="nf">Random</span><span class="p">().</span><span class="nf">Next</span><span class="p">(</span><span class="m">6</span><span class="p">);</span>
    <span class="kt">string</span> <span class="n">ns0</span> <span class="p">=</span> <span class="p">(</span><span class="n">dice</span> <span class="p">&lt;</span> <span class="m">6</span><span class="p">)</span> <span class="p">?</span> <span class="s">"ABC"</span> <span class="p">:</span> <span class="k">null</span><span class="p">;</span>
    <span class="kt">string</span> <span class="n">ns</span> <span class="p">=</span> <span class="p">(</span><span class="n">ns0</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">?</span> <span class="n">ns0</span><span class="p">.</span><span class="nf">ToLowerInvariant</span><span class="p">()</span> <span class="p">:</span> <span class="k">null</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">flag</span> <span class="p">=</span> <span class="n">ns</span> <span class="p">!=</span> <span class="k">null</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">flag</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">ns</span><span class="p">.</span><span class="n">Length</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kt">string</span> <span class="n">s2</span> <span class="p">=</span> <span class="n">ns</span><span class="p">.</span><span class="nf">Replace</span><span class="p">(</span><span class="sc">'a'</span><span class="p">,</span> <span class="sc">'A'</span><span class="p">);</span>
    <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">s2</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>null条件演算子 <code>?.</code> を使った部分が三項条件演算子によるnullチェックになっている以外は、ほぼ元のコードから注釈を抜いただけのコードになっています。</p>

<p>次に、クラスメンバーにnull許容参照型を使った場合を見てみましょう。リストBはフィールドとプロパティ、リストCはメソッドの引数と戻り値にnull許容参照型を使った例です。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">リストB（元のコード）</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">class</span> <span class="nc">B</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="kt">string</span> <span class="n">string1Field</span><span class="p">;</span>

    <span class="k">private</span> <span class="kt">string</span><span class="p">?</span> <span class="n">nullableString1Field</span><span class="p">;</span>

    <span class="k">public</span> <span class="kt">string</span><span class="p">?</span> <span class="n">NullableString1</span>
    <span class="p">{</span>
        <span class="k">get</span> <span class="p">=&gt;</span> <span class="n">nullableString1Field</span><span class="p">;</span>
        <span class="k">set</span> <span class="p">=&gt;</span> <span class="n">nullableString1Field</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">event</span> <span class="n">EventHandler</span><span class="p">&lt;</span><span class="n">EventArgs</span><span class="p">?&gt;?</span> <span class="n">Foo</span><span class="p">;</span>

    <span class="k">protected</span> <span class="k">virtual</span> <span class="k">void</span> <span class="nf">OnFoo</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">Foo</span><span class="p">?.</span><span class="nf">Invoke</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">EventArgs</span><span class="p">.</span><span class="n">Empty</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div>
</div>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">リストB（コンパイル結果を逆コンパイルしたコード）</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">System.Runtime.CompilerServices</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">B</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="kt">string</span> <span class="n">string1Field</span><span class="p">;</span>

    <span class="p">[</span><span class="n">Nullable</span><span class="p">]</span>
    <span class="k">private</span> <span class="kt">string</span> <span class="n">nullableString1Field</span><span class="p">;</span>

    <span class="p">[</span><span class="n">Nullable</span><span class="p">]</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">NullableString1</span>
    <span class="p">{</span>
        <span class="p">[</span><span class="k">return</span><span class="p">:</span> <span class="n">Nullable</span><span class="p">]</span>
        <span class="k">get</span> <span class="p">=&gt;</span> <span class="n">nullableString1Field</span><span class="p">;</span>
        <span class="p">[</span><span class="n">param</span><span class="p">:</span> <span class="n">Nullable</span><span class="p">]</span>
        <span class="k">set</span> <span class="p">=&gt;</span> <span class="n">nullableString1Field</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="p">[</span><span class="nf">Nullable</span><span class="p">(</span><span class="k">new</span> <span class="kt">bool</span><span class="p">[]{</span><span class="k">true</span><span class="p">,</span> <span class="k">true</span><span class="p">})]</span>
    <span class="k">public</span> <span class="k">event</span> <span class="n">EventHandler</span><span class="p">&lt;</span><span class="n">EventArgs</span><span class="p">&gt;</span> <span class="n">Foo</span><span class="p">;</span>

    <span class="k">protected</span> <span class="k">virtual</span> <span class="k">void</span> <span class="nf">OnFoo</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">EventHandler</span><span class="p">&lt;</span><span class="n">EventArgs</span><span class="p">&gt;</span> <span class="n">_foo</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Foo</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">_foo</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nf">_foo</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">EventArgs</span><span class="p">.</span><span class="n">Empty</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">リストC（元のコード）</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">class</span> <span class="nc">C</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="nf">M0</span><span class="p">(</span><span class="kt">string</span> <span class="n">arg</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">arg</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="kt">string</span><span class="p">?</span> <span class="nf">M1</span><span class="p">(</span><span class="kt">string</span><span class="p">?</span> <span class="n">arg</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">arg</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="kt">string</span><span class="p">?[]</span> <span class="nf">M2</span><span class="p">(</span><span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">?&gt;</span> <span class="n">table</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">table</span><span class="p">.</span><span class="n">Values</span><span class="p">.</span><span class="nf">ToArray</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">リストC（コンパイル結果を逆コンパイルしたコード）</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">System.Runtime.CompilerServices</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">C</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="nf">M0</span><span class="p">(</span><span class="kt">string</span> <span class="n">arg</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">arg</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="p">[</span><span class="k">return</span><span class="p">:</span> <span class="n">Nullable</span><span class="p">]</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="nf">M1</span><span class="p">([</span><span class="n">Nullable</span><span class="p">]</span> <span class="kt">string</span> <span class="n">arg</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">arg</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="p">[</span><span class="k">return</span><span class="p">:</span> <span class="nf">Nullable</span><span class="p">(</span><span class="k">new</span> <span class="kt">bool</span><span class="p">[]{</span><span class="k">false</span><span class="p">,</span> <span class="k">true</span><span class="p">})]</span>
    <span class="k">public</span> <span class="kt">string</span><span class="p">[]</span> <span class="nf">M2</span><span class="p">(</span>
        <span class="p">[</span><span class="nf">Nullable</span><span class="p">(</span><span class="k">new</span> <span class="kt">bool</span><span class="p">[]{</span><span class="k">false</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="k">true</span><span class="p">})]</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;</span> <span class="n">table</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">table</span><span class="p">.</span><span class="n">Values</span><span class="p">.</span><span class="nf">ToArray</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>リストBとリストCのどちらも、型からは注釈が消えているのはリストAと同様です。ただし、どのような注釈が付けられていたのかをコンパイラが判断できるように、<code>[Nullable]</code> カスタム属性が付与されています。<br>
この <code>[Nullable]</code> カスタム属性は、<code>System.Runtime.CompilerServices.NullableAttribute</code> クラスとして定義されるものです。そしてこのクラスは、.NET Frameworkの共通ライブラリ (FCL) に追加されたものではなく、null許容参照型を使ったコードをコンパイルするときにコンパイラが自動生成してアセンブリに追加したものになります。<sup id="fnref3"><a href="#fn3" title="ちなみに、この System.Runtime.CompilerServices.NullableAttribute クラスは、ソースコード中に自分で定義しておくと、そちらが参照され、同名のクラスが別途自動生成されることはありません。">3</a></sup><br>
自動生成されたクラスの実装は次のようなものです。<sup id="fnref4"><a href="#fn4" title="Microsoft.CodeAnalysis.EmbeddedAttribute クラスも同時に生成されていますが、それは省略します。">4</a></sup></p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">NullableAttributeクラス</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">System.Runtime.CompilerServices</span>
<span class="p">{</span>
    <span class="p">[</span><span class="n">Microsoft</span><span class="p">.</span><span class="n">CodeAnalysis</span><span class="p">.</span><span class="n">Embedded</span><span class="p">]</span>
    <span class="p">[</span><span class="n">CompilerGenerated</span><span class="p">]</span>
    <span class="k">internal</span> <span class="k">sealed</span> <span class="k">class</span> <span class="nc">NullableAttribute</span> <span class="p">:</span> <span class="n">Attribute</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="nf">NullableAttribute</span><span class="p">()</span>
        <span class="p">{</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="nf">NullableAttribute</span><span class="p">(</span><span class="kt">bool</span><span class="p">[]</span> <span class="n">transformFlags</span><span class="p">)</span>
        <span class="p">{</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>この <code>[Nullable]</code>カスタム属性は、nullを許容する参照型 <code>A?</code> にはすべて付加されます。一方で、nullを許容しない参照型 <code>A</code> の方には何のカスタム属性も付加されません。 <br>
また、配列やジェネリック型の場合は、<code>bool[]</code>を受け取るコンストラクタが使われているのがわかると思います。これは、「配列やジェネリック型そのものがnullを許容するかどうか」と、「配列の要素、あるいは、ジェネリック型の型引数となっている参照型がnullを許容するかどうか」を区別するフラグとなっています。<code>bool[]</code>の先頭要素が、コンテナー型そのもののnull許容性を表し、それ以降が要素や型引数のnull許容性を順番に表しています。</p>

<h1>
<span id="既存コードとの相互運用性" class="fragment"></span><a href="#%E6%97%A2%E5%AD%98%E3%82%B3%E3%83%BC%E3%83%89%E3%81%A8%E3%81%AE%E7%9B%B8%E4%BA%92%E9%81%8B%E7%94%A8%E6%80%A7"><i class="fa fa-link"></i></a>既存コードとの相互運用性</h1>

<p>ここでは、「既存コード＝C# 7系までのコンパイラーでコンパイルするコード、およびそのようにコンパイルしたアセンブリ」「新規コード＝C# 8以降の、null許容参照型の機能を有効にしたコンパイラーでコンパイルするコード、およびそのようにコンパイルしたアセンブリ」とします。</p>

<h2>
<span id="相互運用性1-新規コードから既存コードを利用する" class="fragment"></span><a href="#%E7%9B%B8%E4%BA%92%E9%81%8B%E7%94%A8%E6%80%A71-%E6%96%B0%E8%A6%8F%E3%82%B3%E3%83%BC%E3%83%89%E3%81%8B%E3%82%89%E6%97%A2%E5%AD%98%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E5%88%A9%E7%94%A8%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>相互運用性1: 新規コードから既存コードを利用する</h2>

<p>既存コードには参照型に <code>[Nullable]</code>属性が付与されていないので、原則として <em>すべての参照型がnull非許容</em> という扱いになります。すると、以下のような問題がおきます。</p>

<ul>
<li>既存コードから受け取る参照型は、型の上ではnull非許容に見えるが、実際にはnullが渡されてくるかもしれない</li>
<li>既存コードに渡す参照型は、既存コードの実装ではnullを許容していたとしても、null許容参照型を渡すとコンパイル時に警告される</li>
</ul>

<p>こうなるのは、「Kotlinとの比較」のところでも書きますが、 <em>意図的な設計</em> であり、プレビュー版の不具合というわけではありません。<sup id="fnref5"><a href="#fn5" title="デフォルトがnull非許容になっていることはWikiにFAQとして上がっています。">5</a></sup><br>
この問題に新規コード側で対処するには、次のようになるでしょう。</p>

<ul>
<li>既存コードから参照型を受け取った場合は、プログラマーの判断で、nullチェックを追加する</li>
<li>既存コードに参照型を渡す場合は、プログラマーの判断で、<code>!</code> を適用する</li>
</ul>

<p>とはいえ、この「デフォルトでnull非許容とみなす」という仕様は、<a href="https://docs.microsoft.com/en-us/dotnet/api/system.linq.enumerable.firstordefault" rel="nofollow noopener" target="_blank"><code>IEnumerable&lt;T&gt;.FirstOrDefault</code>拡張メソッド</a>や、<a href="https://docs.microsoft.com/en-us/dotnet/api/system.collections.generic.dictionary-2.trygetvalue" rel="nofollow noopener" target="_blank"><code>Dictionary&lt;TKey, TValue&gt;.TryGetValue</code>メソッド</a>のように、<code>default(T)</code> つまり参照型では <code>null</code>を返すことを前提とした既存APIとバッティングするものです。この問題は<a href="https://github.com/dotnet/csharplang/blob/master/proposals/nullable-reference-types.md#tweaks" rel="nofollow noopener" target="_blank">C#言語チームも認識している</a>ようですが、今のところはうまい解決策はないようです。</p>

<h2>
<span id="相互運用性2-既存コードから新規コードを利用する" class="fragment"></span><a href="#%E7%9B%B8%E4%BA%92%E9%81%8B%E7%94%A8%E6%80%A72-%E6%97%A2%E5%AD%98%E3%82%B3%E3%83%BC%E3%83%89%E3%81%8B%E3%82%89%E6%96%B0%E8%A6%8F%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E5%88%A9%E7%94%A8%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>相互運用性2: 既存コードから新規コードを利用する</h2>

<p>新規コードで指定した型注釈は、カスタム属性として残るもの以外はすべて削除されるので、既存コード側は特別な考慮をしなくても正しくコンパイルできて動作するはずです。（「正しい」既存コードにはすでに適切なnullチェックが含まれているはずですよね？）</p>

<p>（12/12 aetosさんのコメントを受けて修正）<br>
既存コードから新規コードの注釈を知るのは、リフレクションを使えば一応は可能です。<br>
たとえば、メソッドの戻り値に付いたカスタム属性と、そのコンストラクター引数は次のようにして取得します。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">リフレクションで[Nullable]カスタム属性を得る</span></div>
<div class="highlight"><pre class="with-code"><code><span class="c1">// using System.Reflection;</span>

<span class="n">MethodInfo</span> <span class="n">mi</span> <span class="p">=</span> <span class="k">typeof</span><span class="p">(</span><span class="n">TargetClass</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">GetMethod</span><span class="p">(</span><span class="s">"TargetMethodName"</span><span class="p">,</span> <span class="n">BindingFlags</span><span class="p">.</span><span class="n">Public</span> <span class="p">|</span> <span class="n">BindingFlags</span><span class="p">.</span><span class="n">Instance</span><span class="p">);</span>
<span class="n">ParameterInfo</span> <span class="n">pi</span> <span class="p">=</span> <span class="n">mi</span><span class="p">.</span><span class="nf">ReturnParameter</span><span class="p">();</span>
<span class="n">CustomAttributeData</span> <span class="n">data</span> <span class="p">=</span> <span class="n">pi</span><span class="p">.</span><span class="nf">GetCustomAttributesData</span><span class="p">()</span>
    <span class="p">.</span><span class="nf">FirstOrDefault</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">AttributeType</span><span class="p">.</span><span class="n">FullName</span> <span class="p">==</span> <span class="s">"System.Runtime.CompilerServices.NullableAttribute"</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="n">data</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">ConstructorArguments</span><span class="p">.</span><span class="n">Count</span> <span class="p">==</span> <span class="m">1</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">CustomAttributeTypedArgument</span> <span class="n">arg</span> <span class="p">=</span> <span class="n">data</span><span class="p">.</span><span class="n">ConstructorArguments</span><span class="p">[</span><span class="m">0</span><span class="p">];</span>
        <span class="c1">// 以下略</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>つらつら書きましたが、他言語のコンパイラーを開発していて、C#のnull許容参照型との相互運用性をサポートしようとしているのでもなければ、この属性は無視していいと思います。</p>

<h2>
<span id="相互運用性3-オプトインアウト機構" class="fragment"></span><a href="#%E7%9B%B8%E4%BA%92%E9%81%8B%E7%94%A8%E6%80%A73-%E3%82%AA%E3%83%97%E3%83%88%E3%82%A4%E3%83%B3%E3%82%A2%E3%82%A6%E3%83%88%E6%A9%9F%E6%A7%8B"><i class="fa fa-link"></i></a>相互運用性3: オプトイン/アウト機構</h2>

<p>たとえば、既存コードにnull注釈を追加しないままで、どうにか新しいコンパイラーでコンパイルしたい、などの状況で、警告を抑制したい、無視したい、ということもあるでしょう。そんな時のために、null許容性の不一致から発生する警告を部分的に抑制する機構が検討されています。</p>

<p>ただし、11/15のプレビュー版でいろいろ試した範囲では、警告の抑制はまだ実装されていない様子でした。あくまで、「このような方向で検討されている」という前提で読んで下さい。</p>

<h3>
<span id="オプトアウト1-指定した要素型フィールドプロパティメソッドetcによるnull許容性の警告を抑制する" class="fragment"></span><a href="#%E3%82%AA%E3%83%97%E3%83%88%E3%82%A2%E3%82%A6%E3%83%881-%E6%8C%87%E5%AE%9A%E3%81%97%E3%81%9F%E8%A6%81%E7%B4%A0%E5%9E%8B%E3%83%95%E3%82%A3%E3%83%BC%E3%83%AB%E3%83%89%E3%83%97%E3%83%AD%E3%83%91%E3%83%86%E3%82%A3%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89etc%E3%81%AB%E3%82%88%E3%82%8Bnull%E8%A8%B1%E5%AE%B9%E6%80%A7%E3%81%AE%E8%AD%A6%E5%91%8A%E3%82%92%E6%8A%91%E5%88%B6%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>オプトアウト1. 指定した要素（型、フィールド、プロパティ、メソッド、etc）によるnull許容性の警告を抑制する</h3>

<p><code>System.Runtime.CompilerServices.NullableOptOutAttribute</code> クラスを定義して、そのクラスを使って <code>[NullableOptOut]</code> カスタム属性を付与すると、その属性を付与した要素に関連した警告が抑制される、らしいです。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">NullableOptOutAttributeクラス</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">System.Runtime.CompilerServices</span>
<span class="p">{</span>
    <span class="p">[</span><span class="nf">AttributeUsage</span><span class="p">(</span><span class="n">AttributeTargets</span><span class="p">.</span><span class="n">Module</span> <span class="p">|</span>
                    <span class="n">AttributeTargets</span><span class="p">.</span><span class="n">Class</span> <span class="p">|</span> <span class="n">AttributeTargets</span><span class="p">.</span><span class="n">Struct</span> <span class="p">|</span> <span class="n">AttributeTargets</span><span class="p">.</span><span class="n">Delegate</span> <span class="p">|</span> <span class="n">AttributeTargets</span><span class="p">.</span><span class="n">Interface</span> <span class="p">|</span>
                    <span class="n">AttributeTargets</span><span class="p">.</span><span class="n">Event</span> <span class="p">|</span> <span class="n">AttributeTargets</span><span class="p">.</span><span class="n">Field</span> <span class="p">|</span> <span class="n">AttributeTargets</span><span class="p">.</span><span class="n">Method</span> <span class="p">|</span> <span class="n">AttributeTargets</span><span class="p">.</span><span class="n">Property</span><span class="p">)]</span>
    <span class="k">internal</span> <span class="k">class</span> <span class="nc">NullableOptOutAttribute</span> <span class="p">:</span> <span class="n">Attribute</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="nf">NullableOptOutAttribute</span><span class="p">(</span><span class="kt">bool</span> <span class="n">flag</span> <span class="p">=</span> <span class="k">true</span><span class="p">)</span>
        <span class="p">{</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p><code>bool</code>型のコンストラクター引数は、<code>true</code>の時に警告を抑制し、<code>false</code>の時に警告を出すというものです。たとえば、クラス全体は警告を抑制しつつ、特定のメソッドだけは警告を有効にする、といった時に使います。</p>

<h3>
<span id="オプトアウト2-指定したアセンブリによるnull許容性の警告を抑制する" class="fragment"></span><a href="#%E3%82%AA%E3%83%97%E3%83%88%E3%82%A2%E3%82%A6%E3%83%882-%E6%8C%87%E5%AE%9A%E3%81%97%E3%81%9F%E3%82%A2%E3%82%BB%E3%83%B3%E3%83%96%E3%83%AA%E3%81%AB%E3%82%88%E3%82%8Bnull%E8%A8%B1%E5%AE%B9%E6%80%A7%E3%81%AE%E8%AD%A6%E5%91%8A%E3%82%92%E6%8A%91%E5%88%B6%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>オプトアウト2. 指定したアセンブリによるnull許容性の警告を抑制する</h3>

<p><code>System.Runtime.CompilerServices.NullableOptOutForAssemblyAttribute</code> クラスを定義して、そのクラスを使って <code>[NullableOptOutForAssembly]</code> カスタム属性をモジュールに付与すると、そのモジュール内のコードでは、コンストラクターに文字列で指定したアセンブリに関連した警告が抑制される、らしいです。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">NullableOptOutForAssemblyAttributeクラス</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">System.Runtime.CompilerServices</span>
<span class="p">{</span>
    <span class="p">[</span><span class="nf">AttributeUsage</span><span class="p">(</span><span class="n">AttributeTargets</span><span class="p">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">AllowMultiple</span> <span class="p">=</span> <span class="k">true</span><span class="p">)]</span>
    <span class="k">internal</span> <span class="k">class</span> <span class="nc">NullableOptOutForAssemblyAttribute</span> <span class="p">:</span> <span class="n">Attribute</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="nf">NullableOptOutForAssemblyAttribute</span><span class="p">(</span><span class="kt">string</span> <span class="n">assemblyName</span><span class="p">)</span>
        <span class="p">{</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>この属性はモジュールに対して指定するものなので、 <code>[module: NullableOptOutForAssembly("Foo.Bar.Baz")]</code> のように指定します。</p>

<h1>
<span id="kotlinとの比較" class="fragment"></span><a href="#kotlin%E3%81%A8%E3%81%AE%E6%AF%94%E8%BC%83"><i class="fa fa-link"></i></a>Kotlinとの比較</h1>

<p>参照型のnull許容性を明示できるようになるという機構は、C#のnull安全性を高めるものといえます。このnull安全性という考え方は、最近の新しいプログラミング言語では採用されることが多くなっています。どのような言語で取り入れられているかについては、Qiitaの<a href="https://qiita.com/koher/items/e4835bd429b88809ab33" id="reference-62ace65786e5b7ea2e11">null安全でない言語は、もはやレガシー言語だ</a>という記事によくまとまっています。</p>

<p>C# 8.0で検討されている、null非許容な参照型は、この記事で言うならば<a href="https://kotlinlang.org/" rel="nofollow noopener" target="_blank">Kotlin</a>のものに比較的似ています。似ている点を以下に挙げてみます。</p>

<ul>
<li>(<code>Nullable&lt;T&gt;</code>型や代数的データ型のように)別の型でラップしない</li>
<li>コンパイルすると、カスタムのメタデータ（カスタム属性／アノテーション）が付与された状態になる

<ul>
<li>Kotlinでは 基本的に<code>org.jetbrains.annotations</code>パッケージの <code>Nullable</code>および<code>NotNull</code>アノテーションが使われる</li>
</ul>
</li>
<li>フロー解析によって変数や式の型が変化する

<ul>
<li>Kotlinでは「スマートキャスト」と呼ぶ</li>
</ul>
</li>
<li>nullチェックせずに強制アクセスする記法がある

<ul>
<li>Kotlinでは <code>!!</code> と <code>!.</code> のふたつがある</li>
</ul>
</li>
</ul>

<p>一方で、違っている点を以下に挙げてみます。</p>

<ul>
<li>Kotlinでは、Javaの参照型はnull許容型とnull非許容型のどちらとも決められない「プラットフォーム型」として扱われ、コンパイル時にnull許容性のエラーが報告されない。一方C# 8では、既存コードの参照型はnull非許容型として扱われ、プラットフォーム型のような状態は存在しない。</li>
<li>Kotlinでnull非許容のコードをコンパイルすると <code>NotNull</code>アノテーションが付与されるが、C# 8にはそれに対応するカスタム属性はない。</li>
<li>Kotlinでは、null非許容型を使ったコードをコンパイルすると、実行時にnullチェックして、nullが入っていた場合は実行時例外をスローするコードが生成される。<sup id="fnref6"><a href="#fn6" title="kotlin.jvm.internal.Intrinsics#checkExpressionValueIsNotNull()メソッドによってIllegalStateExceptionが投げられる。ぬるぽではない。">6</a></sup> 一方C# 8では、そのような実行時例外を投げるようなコードは生成されない。</li>
</ul>

<p>1番目の「プラットフォーム型」については、<a href="https://blogs.msdn.microsoft.com/dotnet/2017/11/15/nullable-reference-types-in-csharp/#div-comment-414936" rel="nofollow noopener" target="_blank">MSDNブログのコメント欄でC#のプログラムマネージャであるMads Torgersenがコメントしています</a>。いわく、「複雑になると思ったので入れていない。null許容性が不明な型を入れるとしても、（Kotlinのように）警告なしにするのか、逆にすべてで警告を出すのか、どちらにしたとしても議論になるだろう。」とのことです。<br>
2番目の違いは、1番目の違いから来るものです。（デフォルトがnull非許容なので、<code>NotNull</code>を表明する必要がない）<br>
3番目は、これは私の考えですが、C#の場合はあくまで既存言語のバージョンアップであって、null安全な別言語を作っているわけではないこと、C# は実行時性能をかなり意識していること、<a href="https://docs.microsoft.com/en-us/dotnet/api/system.diagnostics.contracts.contract" rel="nofollow noopener" target="_blank">Contractクラス</a>でも基本的には例外をスローしないこと、などを踏まえた判断ではないかと思います。</p>

<p>繰り返しになりますが、C#の場合はあくまで既存言語のバージョンアップであって、C# 本来の特性（書きやすさや実行性能など）と null安全性とのバランスを重視していると理解しています。なので、null安全性だけを見ると、他の言語と比べて弱い部分が残っていますが、それも含めた設計判断なのだと思います。</p>

<h1>
<span id="落とし穴ジェネリクスとかnull許容値型とか" class="fragment"></span><a href="#%E8%90%BD%E3%81%A8%E3%81%97%E7%A9%B4%E3%82%B8%E3%82%A7%E3%83%8D%E3%83%AA%E3%82%AF%E3%82%B9%E3%81%A8%E3%81%8Bnull%E8%A8%B1%E5%AE%B9%E5%80%A4%E5%9E%8B%E3%81%A8%E3%81%8B"><i class="fa fa-link"></i></a>落とし穴：ジェネリクスとかNull許容値型とか</h1>

<p>この記事はプレビュー版を前提に書いていることもあり、制限事項もいろいろあります。多くの制限事項は<a href="https://github.com/dotnet/csharplang/wiki/Nullable-Reference-Types-Preview#known-issues" rel="nofollow noopener" target="_blank">WikiにKnown Issues（既知の問題）としてまとまっている</a>のですが、ここではジェネリクスに関係することを少しだけ取り上げたいと思います。</p>

<p>参照型に制約されたジェネリック型を見てみます。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">class</span> <span class="nc">Foo</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span>
    <span class="k">where</span> <span class="n">T</span> <span class="p">:</span> <span class="k">class</span>
<span class="err">{</span>
    <span class="nc">public</span> <span class="kt">string</span> <span class="nf">FullName</span><span class="p">(</span><span class="n">T</span> <span class="n">obj</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">obj</span><span class="p">.</span><span class="nf">GetType</span><span class="p">().</span><span class="n">FullName</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>こんな感じで書けるのですが、実はこの<code>T</code>に、null許容参照型を渡せます。（コンパイルエラー<a href="https://docs.microsoft.com/en-us/dotnet/csharp/misc/cs0453" rel="nofollow noopener" target="_blank">CS0453</a>に<em>ならない</em>）</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="n">Foo</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">?&gt;</span> <span class="n">f</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Foo</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">?&gt;();</span> <span class="c1">// コンパイルが通ってしまう</span>
<span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="nf">FullName</span><span class="p">(</span><span class="k">null</span><span class="p">));</span> <span class="c1">// 実行時例外になる</span>
</code></pre></div></div>

<p>これはWikiにはまだ書かれていないのですが、おそらくプレビュー版のみの挙動だと思われます。なぜなら、<a href="https://github.com/dotnet/csharplang/blob/master/proposals/nullable-reference-types.md#generics" rel="nofollow noopener" target="_blank">言語仕様提案のドキュメントにはジェネリクスの制約にnull許容性を明示的に指定する可能性が言及されている</a>からです。<br>
とはいえ、記法として、<code>where T is nonnullable</code> みたいな書き方になるかどうかも含めて、まだ確定はしていません。</p>

<p>次に、参照型にも値型にも制約されていないジェネリック型を見てみます。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">class</span> <span class="nc">Bar</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="n">T</span><span class="p">?</span> <span class="nf">M</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">default</span><span class="p">(</span><span class="n">T</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="nf">N</span><span class="p">(</span><span class="n">T</span><span class="p">?</span> <span class="n">obj</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">obj</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"obj is null"</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"obj == </span><span class="p">{</span><span class="n">obj</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p><code>T</code> 型は参照型にも値型にも制約されていないのですが、これは合法で、コンパイルが通ります。ただし、コンパイル結果を見ると、null許容参照型のように、null許容性が消去されたバイナリになっていました。</p>

<p>こんな型を使うと、ちょっと予想と違う動きをします。</p>

<ul>
<li>
<code>Bar&lt;T&gt;</code>の実装コード中で、<code>T?</code> 型に <code>null</code> を入れられない。（コンパイルエラー<a href="https://docs.microsoft.com/en-us/dotnet/csharp/misc/cs0453" rel="nofollow noopener" target="_blank">CS0453</a>になる）</li>
<li>
<code>Bar&lt;T&gt;</code> の型引数にnull許容値型、たとえば <code>int?</code> を指定してもエラーにならない。（<code>int</code>を指定したのと同じ扱いになる）</li>
<li>
<code>Bar&lt;T&gt;</code> の型引数にたとえば <code>int</code> を指定したとき、メソッド <code>N</code> の引数 <code>obj</code> の型は <code>int?</code> に見えるが、<code>Nullable&lt;int&gt;</code>の値を渡すとコンパイルエラーになる</li>
</ul>

<p><a href="https://github.com/dotnet/csharplang/wiki/Nullable-Reference-Types-Preview#type-parameters" rel="nofollow noopener" target="_blank"><code>T</code> 型が参照型にも値型にも制約されていないときに<code>T?</code>型がエラーにならずに使えるのはKnown Issues（既知の問題）</a>となっているので、このあたりの挙動はいずれ変わるのでしょうけど、参照型にも値型にも制約されていない型引数自体はおそらく合法のまま残ると思われます。</p>

<p><code>T</code> 型が参照型にも値型にも制約されていないときに<code>T?</code>型を使わなければそれでいいかというと、まだ微妙なやつがあります。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">class</span> <span class="nc">Baz</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="n">T</span> <span class="nf">M</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">default</span><span class="p">(</span><span class="n">T</span><span class="p">);</span> <span class="c1">// コンパイルが通ってしまう</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>このように、型 <code>T</code> に対して <code>default(T)</code> を与えるコードは、<code>T</code>が参照型に制約されている場合はエラーになるのですが、上の例のように、<code>T</code> 型が参照型にも値型にも制約されていないときはコンパイルが通ってしまいます。そしてもちろん、型引数 <code>T</code> にnull非許容参照型を指定した場合、このメソッド <code>M()</code> からは <code>null</code> が返ってきます。<br>
これもWikiにはまだ書かれていないですが、いずれ変更になると思われます。</p>

<h1>
<span id="最後に" class="fragment"></span><a href="#%E6%9C%80%E5%BE%8C%E3%81%AB"><i class="fa fa-link"></i></a>最後に</h1>

<p>さて、説明はあくまで概要のみで、プレビュー版の実装など、詳細についてはほとんど触れていないつもりなのですが、それでもそれなりのボリュームになってしまいました。</p>

<p>現在の仕様に対して意見がある人は英語での議論に参加するといいと思いますが、とはいえ<a href="https://github.com/dotnet/csharplang/issues/36" rel="nofollow noopener" target="_blank">これまでの議論は踏まえる必要があるでしょう</a>ね。</p>

<div class="footnotes">
<hr>
<ol>

<li id="fn1">
<p><code>this()</code>の呼び出しがあるなど、警告が出ないケースがあることが<a href="https://github.com/dotnet/csharplang/wiki/Nullable-Reference-Types-Preview#uninitialized-fields-warning" rel="nofollow noopener" target="_blank">Known Issues（既知の問題）</a>として挙がっています。 <a href="#fnref1">↩</a></p>
</li>

<li id="fn2">
<p>実際には逆コンパイラーの出力を一部修正しています。 <a href="#fnref2">↩</a></p>
</li>

<li id="fn3">
<p>ちなみに、この <code>System.Runtime.CompilerServices.NullableAttribute</code> クラスは、ソースコード中に自分で定義しておくと、そちらが参照され、同名のクラスが別途自動生成されることはありません。 <a href="#fnref3">↩</a></p>
</li>

<li id="fn4">
<p><code>Microsoft.CodeAnalysis.EmbeddedAttribute</code> クラスも同時に生成されていますが、それは省略します。 <a href="#fnref4">↩</a></p>
</li>

<li id="fn5">
<p>デフォルトがnull非許容になっていることは<a href="https://github.com/dotnet/csharplang/wiki/Nullable-Reference-Types-Preview#warnings-from-existing-assemblies" rel="nofollow noopener" target="_blank">WikiにFAQとして上がっています</a>。 <a href="#fnref5">↩</a></p>
</li>

<li id="fn6">
<p><code>kotlin.jvm.internal.Intrinsics#checkExpressionValueIsNotNull()</code>メソッドによって<code>IllegalStateException</code>が投げられる。ぬるぽではない。 <a href="#fnref6">↩</a></p>
</li>

</ol>
</div>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Fmatarillo%2Fitems%2F4304df03d28db889f7e5&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Fmatarillo%2Fitems%2F4304df03d28db889f7e5&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/matarillo/items/4304df03d28db889f7e5/likers" class="css-1iupg5d">52</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">31</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/4304df03d28db889f7e5/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/matarillo/items/4304df03d28db889f7e5/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/matarillo/items/4304df03d28db889f7e5/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/matarillo/items/4304df03d28db889f7e5/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/matarillo/items/4304df03d28db889f7e5.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-9f203829-18b3-48ac-8611-d34ca320821c">{"authorAnalyticsTrackingId":null,"organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-955cebb8-eb31-434d-9be0-01af2db17742"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-955cebb8-eb31-434d-9be0-01af2db17742">{}</script>
      
<div id="LoginModal-react-component-1cfb3d84-c9fd-47cc-b2cd-55c85118d30f"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-1cfb3d84-c9fd-47cc-b2cd-55c85118d30f">{}</script>
      
<div id="StockModal-react-component-abec5181-d950-442b-b311-e7cd51dd4e2d"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-abec5181-d950-442b-b311-e7cd51dd4e2d">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;iJ9jtxlnY8HaSpr6zNh+/kWyxXfTL93NEUmPt6VI6+hyI/RKYVaUMM/+ZU92ZnOtiiLnhKR/78u/Qz9ZmR/ufQ==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\n\u003ch1\u003e\n\u003cspan id=\"この記事について\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%93%E3%81%AE%E8%A8%98%E4%BA%8B%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eこの記事について\u003c/h1\u003e\n\n\u003cp\u003eこの記事は\u003ca href=\"https://qiita.com/advent-calendar/2017/csharp\"\u003e2017年 C# Advent Calendar\u003c/a\u003e 12月9日の記事です。\u003c/p\u003e\n\n\u003cp\u003eC# 8.0に向けて検討中で、\u003ca href=\"https://blogs.msdn.microsoft.com/dotnet/2017/11/15/nullable-reference-types-in-csharp/\" rel=\"nofollow noopener\" target=\"_blank\"\u003e11/15にプレビュー版が公開された\u003c/a\u003e C# の新機能「nullable reference types」について説明するものです。\u003c/p\u003e\n\n\u003cp\u003e\"nullable reference types\" を直訳するなら「Null 許容参照型」になるかと思いますが、この機能の実態を一言で言うと、参照型がnullを \u003cem\u003e可能な限り受け入れない\u003c/em\u003e ようにするもの、と考えたほうがいいでしょう。そのあたりのことを説明していきます。\u003c/p\u003e\n\n\u003cp\u003eDisclaimer: この記事は11/15のプレビュー版を前提にしたものです。これはあくまで現時点での \u003ca href=\"https://github.com/dotnet/csharplang/issues/36\" rel=\"nofollow noopener\" target=\"_blank\"\u003e仕様に関する議論\u003c/a\u003e を形にしたプロトタイプでしかなく、今後の議論によって仕様も実装も大きく変わる可能性があると思っていたほうがいいでしょう。CTP (Community Technology Preview) と言われるものよりも実験的な色合いが強いと個人的には理解しています。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"プレビュー版を試すための環境\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%97%E3%83%AC%E3%83%93%E3%83%A5%E3%83%BC%E7%89%88%E3%82%92%E8%A9%A6%E3%81%99%E3%81%9F%E3%82%81%E3%81%AE%E7%92%B0%E5%A2%83\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eプレビュー版を試すための環境\u003c/h1\u003e\n\n\u003cp\u003eリリースされたバイナリはC# コンパイラ (Roslyn) 拡張を置き換えてしまいますので、試用専用の環境を用意することを強く推奨します。\u003c/p\u003e\n\n\u003cp\u003eVisual Studio 15.5 (プレビュー4以降) が必要で、かつ、他のバージョンをインストールしないでください。複数バージョンのVisual Studioが共存していると、インストール用バッチファイルがエラーになります。\u003c/p\u003e\n\n\u003cp\u003e試用環境が準備できたら、\u003ca href=\"https://github.com/dotnet/csharplang/wiki/Nullable-Reference-Types-Preview\" rel=\"nofollow noopener\" target=\"_blank\"\u003eGitHubの dotnet/csharplang リポジトリのWiki\u003c/a\u003e に行き、リンクされている Roslyn_Nullable_References_Preview.zip をダウンロードして展開した後、Visual Studioを閉じて \u003ccode\u003einstall.bat\u003c/code\u003eを実行してください。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"どういうコードの書き方になるか概要\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%A9%E3%81%86%E3%81%84%E3%81%86%E3%82%B3%E3%83%BC%E3%83%89%E3%81%AE%E6%9B%B8%E3%81%8D%E6%96%B9%E3%81%AB%E3%81%AA%E3%82%8B%E3%81%8B%E6%A6%82%E8%A6%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eどういうコードの書き方になるか：概要\u003c/h1\u003e\n\n\u003cp\u003e注意：この記事では、型推論（\u003ccode\u003evar\u003c/code\u003eなど）を使っていません。これは、11/15のプレビュー版ではnull非許容参照型と型推論の組み合わせに一部問題があるからです。問題についてはこの記事では扱いませんので、 \u003ca href=\"https://github.com/dotnet/csharplang/wiki/Nullable-Reference-Types-Preview\" rel=\"nofollow noopener\" target=\"_blank\"\u003eWiki\u003c/a\u003e などを見てください。（TBD. 余力があったらフォローする。）\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"概要1-基本\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%A6%82%E8%A6%811-%E5%9F%BA%E6%9C%AC\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e概要1. 基本\u003c/h2\u003e\n\n\u003cp\u003e参照型は原則的にnullを値に持てなくなります。参照型の変数、フィールド、プロパティ、引数にnullを代入したり、戻り値が参照型のメソッドでnullを返したりすると、コンパイル時に警告されます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003es0\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// NG (警告)\u003c/span\u003e\n\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003es1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003edefault\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e// NG (警告)\u003c/span\u003e\n\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003es2\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"abc\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// OK\u003c/span\u003e\n\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003es3\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003es2\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// OK\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"nf\"\u003eNonNullableString\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003edice\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eRandom\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"nf\"\u003eNext\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e6\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edice\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"m\"\u003e6\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// NG (警告)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"s\"\u003e\"ABC\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// OK\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003enull非許容参照型のフィールドを持つ型は、コンストラクターの中で、nullでない値で初期化する必要があります。初期化されないフィールドがあると、コンパイル時に警告されます。\u003csup id=\"fnref1\"\u003e\u003ca href=\"#fn1\" title=\"this()の呼び出しがあるなど、警告が出ないケースがあることがKnown Issues（既知の問題）として挙がっています。\"\u003e1\u003c/a\u003e\u003c/sup\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eC\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003es0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// OK\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003es1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// NG (警告)\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eC\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003es0\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"ABC\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e（追記）構造体は、\u003ccode\u003edefault(T)\u003c/code\u003e で初期化すると、すべてのフィールドがデフォルト値となります。フィールドにnull非許容な参照型を含んでいた場合は、そのフィールドの値が \u003ccode\u003enull\u003c/code\u003e となります。これは本来は警告すべきなのかもしれませんが、現実のコード上にあまりに多いため、あえて警告しない仕様としています。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"nc\"\u003eV\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eField\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eV\u003c/span\u003e \u003cspan class=\"k\"\u003evalue\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003edefault\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eV\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e// OK（警告なし）\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003enullを代入するかもしれない参照型は、参照型名の末尾に \u003ccode\u003e?\u003c/code\u003e を付与します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003ens0\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// OK\u003c/span\u003e\n\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003ens1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003edefault\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e// OK\u003c/span\u003e\n\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003ens2\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"ABC\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// OK\u003c/span\u003e\n\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003ens3\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ens2\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// OK\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"nf\"\u003eNullableString\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003edice\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eRandom\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"nf\"\u003eNext\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e6\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edice\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"m\"\u003e6\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// OK\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"s\"\u003e\"ABC\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// OK\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e参照型 \u003ccode\u003eA\u003c/code\u003e の値を null許容参照型 \u003ccode\u003eA?\u003c/code\u003e に使うことはできますが、その逆は原則的にできません。（ただし、フロー解析によってその制限は緩められます。そのことは後述します。）\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003es0\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eNonNullableString\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 戻り値はstring型\u003c/span\u003e\n\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003ens0\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003es0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// OK\u003c/span\u003e\n\n\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003ens1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eNullableString\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 戻り値はstring?型\u003c/span\u003e\n\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003es1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ens1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// NG (警告)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"概要2-デリファレンス参照剥がしとフロー解析\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%A6%82%E8%A6%812-%E3%83%87%E3%83%AA%E3%83%95%E3%82%A1%E3%83%AC%E3%83%B3%E3%82%B9%E5%8F%82%E7%85%A7%E5%89%A5%E3%81%8C%E3%81%97%E3%81%A8%E3%83%95%E3%83%AD%E3%83%BC%E8%A7%A3%E6%9E%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e概要2. デリファレンス(参照剥がし)とフロー解析\u003c/h2\u003e\n\n\u003cp\u003enull許容参照型 \u003ccode\u003eA?\u003c/code\u003e の値は、文字通り\u003ccode\u003enull\u003c/code\u003eかもしれないので、型 \u003ccode\u003eA\u003c/code\u003e に定義されているインスタンスメンバー（フィールドやメソッドやプロパティやイベントなど）にアクセスするコード、つまり実行時に\u003ccode\u003eNullReferenceException\u003c/code\u003eが投げられる可能性があるコードはコンパイル時に警告されます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003ens0\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003elower\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ens0\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToLowerInvariant\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e \u003cspan class=\"c1\"\u003e// NG (警告)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eそのような状況では、null条件演算子 \u003ccode\u003e?.\u003c/code\u003e を使うことができます。インスタンスメンバーの型（メソッド呼び出しの場合は戻り値の型）が型 \u003ccode\u003eR\u003c/code\u003e だった場合は、null条件演算子 \u003ccode\u003e?.\u003c/code\u003e を通して呼び出すと \u003ccode\u003eR?\u003c/code\u003e 型となります。これは、型 \u003ccode\u003eR\u003c/code\u003e が値型だった場合でも参照型だった場合でも同様となります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003ens0\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003enlower\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ens0\u003c/span\u003e\u003cspan class=\"p\"\u003e?.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToLowerInvariant\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e \u003cspan class=\"c1\"\u003e// OK\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003enull条件演算子 \u003ccode\u003e?.\u003c/code\u003e を使った上のコードは、下のように三項条件演算子 \u003ccode\u003e? :\u003c/code\u003e で分岐したコードと等価です。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003ens0\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003enlower\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ens0\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003ens0\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToLowerInvariant\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eあるいは、 \u003ccode\u003eif\u003c/code\u003e 文で分岐しても同じです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003ens0\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003enlower\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ens0\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003enlower\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ens0\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToLowerInvariant\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003enlower\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこの上の2つのコード片では \u003ccode\u003estring?\u003c/code\u003e 型のはずの \u003ccode\u003ens0\u003c/code\u003e に対して \u003ccode\u003ens0.ToLowerInvariant();\u003c/code\u003e のようにメンバーアクセスをしていますが、実はこの2つのコードも問題なくコンパイルできます。（警告が出ません）。それは、三項条件演算子 \u003ccode\u003e? :\u003c/code\u003e や \u003ccode\u003eif\u003c/code\u003e 文で、nullチェックの結果で分岐をしているからです。\u003cbr\u003e\n実は、nullチェックの結果に基づいて分岐をした場合など、null許容参照型 \u003ccode\u003eA?\u003c/code\u003e の \u003cem\u003e値がnullではないことがコンパイラーにとって明確になっている実行パス\u003c/em\u003e では、その範囲に限り、null非許容の \u003ccode\u003eA\u003c/code\u003e 型として値を利用するコードを書くことができるのです。このように、制御フローの各実行パスにおいて、データの取りうる値をコンパイラーが追跡して認識することを、\u003cstrong\u003eデータフロー解析\u003c/strong\u003e、または省略して\u003cstrong\u003eフロー解析\u003c/strong\u003eと呼びます。C# 8のnull非許容参照型を使ったコードでは、C#コンパイラがフロー解析を行い、値がnullにならない実行パスを見つけているのです。\u003c/p\u003e\n\n\u003cp\u003eフロー解析では、nullチェックの分岐だけではなく、null許容参照型 \u003ccode\u003eA?\u003c/code\u003e のローカル変数に null非許容の \u003ccode\u003eA\u003c/code\u003e 型の値を代入したときも追跡されます。その代入を起点として、\u003ccode\u003enull\u003c/code\u003eそのもの、またはnullの可能性がある \u003ccode\u003eA?\u003c/code\u003e 型の値を代入するまで、その変数はnullにならない \u003ccode\u003eA\u003c/code\u003e 型として利用できます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003es0\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"ABC\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003ens1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003ens2\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003ens2\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003es0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ☆\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// ☆から◆までの間、ns2はnullではない\u003c/span\u003e\n\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003es1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ens1\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToLowerInvariant\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e \u003cspan class=\"c1\"\u003e// OK\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003ens2\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ens1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ◆\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// ここから、ns2はnull\u003c/span\u003e\n\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003es2\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ens1\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToLowerInvariant\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e \u003cspan class=\"c1\"\u003e// NG (警告)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eただし、フロー解析を厳密にかつプログラム全体に渡って行うことはコンパイラーにとって非常に難しいことです。解析を厳密にしたり、解析範囲を広くしたりすればするほど、コンパイル時間も長くなってしまいます。また、マルチスレッドモデルにおいては、ある変数の値を複数のスレッドが変更できる場合、静的な解析ではその変数がnullでないことを保証できなくなります。\u003c/p\u003e\n\n\u003cp\u003eそこで、C# 8のnull非許容参照型では、\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eフロー解析は1メソッドの範囲内に限定する（フロー解析の結果をメソッド外に引き継がない）\u003c/li\u003e\n\u003cli\u003eフロー解析の起点はローカル変数またはメソッド引数に限定する（フィールドやプロパティなどはフロー解析しない）\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eとしています。\u003c/p\u003e\n\n\u003cp\u003eまた、それ以外にも、リリースまでにはサポートしたいけれどもプレビュー版ではまだフロー解析が不十分なケースや、そもそもサポートするべきかどうかがまだ議論中のケースなどもあります。（TBD. 例示）\u003c/p\u003e\n\n\u003cp\u003eというわけで、プログラマーにはnullでないことが明らかでも、C#コンパイラーには判断ができない場合があります。そのような場合は、\u003ccode\u003e!\u003c/code\u003e演算子を使います。\u003cbr\u003e\n\u003ccode\u003e!\u003c/code\u003e演算子は、null許容参照型を、警告を出さずに強制的にnull非許容参照型に変換します。\u003ccode\u003e!\u003c/code\u003e の優先順位は高いので、たとえば警告を出さずに強制的にメンバーアクセスしたければ、\u003ccode\u003e!.\u003c/code\u003eのように書くこともできます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003edice\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eRandom\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"nf\"\u003eNext\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e6\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003ens0\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edice\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"m\"\u003e6\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"s\"\u003e\"ABC\"\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003ens1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ens0\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003ens1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// ns0はnullではないが、C#コンパイラーはそのような判断をしないため、!演算子を使う\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003es0\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ens0\u003c/span\u003e\u003cspan class=\"p\"\u003e!;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// OK\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003es1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003es0\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003ens0\u003c/span\u003e\u003cspan class=\"p\"\u003e!.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToLowerInvariant\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e \u003cspan class=\"c1\"\u003e// OK\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003es1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e理解の早い方はおわかりと思いますが、この \u003ccode\u003e!\u003c/code\u003e 演算子はコンパイル時のnullチェックを回避して実行時のnullチェックに変えてしまうものです。誤った使い方をしても警告が出ないので、実行時に\u003ccode\u003eNullReferenceException\u003c/code\u003eが投げられる可能性を排除できない機能といえます。この機能を使う時は危険性をきちんと理解した上で濫用しないようにしましょう。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"概要3-配列ジェネリクス\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%A6%82%E8%A6%813-%E9%85%8D%E5%88%97%E3%82%B8%E3%82%A7%E3%83%8D%E3%83%AA%E3%82%AF%E3%82%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e概要3. 配列/ジェネリクス\u003c/h2\u003e\n\n\u003cp\u003e配列の要素やジェネリックコレクションの型引数に参照型を指定するときも、デフォルトはnull非許容です。nullを許容させたい場合は \u003ccode\u003e?\u003c/code\u003e を付与します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003earray0\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"s\"\u003e\"a\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"b\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"c\"\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e \u003cspan class=\"c1\"\u003e// OK\u003c/span\u003e\n\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003earray1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"s\"\u003e\"a\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"b\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e \u003cspan class=\"c1\"\u003e// NG (警告)\u003c/span\u003e\n\n\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e?[]\u003c/span\u003e \u003cspan class=\"n\"\u003enarray0\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"s\"\u003e\"a\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"b\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e \u003cspan class=\"c1\"\u003e// OK\u003c/span\u003e\n\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e?[]\u003c/span\u003e \u003cspan class=\"n\"\u003enarray1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e?[]\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"s\"\u003e\"a\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"b\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e \u003cspan class=\"c1\"\u003e// OK\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003elist0\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"s\"\u003e\"a\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"b\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"c\"\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e \u003cspan class=\"c1\"\u003e// OK\u003c/span\u003e\n\u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003elist1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"s\"\u003e\"a\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"b\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e \u003cspan class=\"c1\"\u003e// NG (警告)\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003enlist0\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"s\"\u003e\"a\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"b\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e \u003cspan class=\"c1\"\u003e// OK\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e（追記）配列は、初期化子なしの \u003ccode\u003enew\u003c/code\u003e で生成すると、すべての要素がデフォルト値となります。要素の型がnull非許容な参照型だった場合は、すべての要素が \u003ccode\u003enull\u003c/code\u003e となります。これは本来は警告すべきなのかもしれませんが、現実のコード上にあまりに多いため、あえて警告しない仕様としています。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003earray\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e \u003cspan class=\"c1\"\u003e// OK（警告なし）\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e配列やジェネリックコレクション自体も参照型なので、デフォルトはnull禁止です。配列やジェネリックコレクション自体がnullを許容するようにするには、型全体の末尾に \u003ccode\u003e?\u003c/code\u003e を置きます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003earray0\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// NG (警告)\u003c/span\u003e\n\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e[]?\u003c/span\u003e \u003cspan class=\"n\"\u003en_array1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// OK\u003c/span\u003e\n\n\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e?[]\u003c/span\u003e \u003cspan class=\"n\"\u003enarray2\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// NG (警告)\u003c/span\u003e\n\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e?[]?\u003c/span\u003e \u003cspan class=\"n\"\u003en_narray3\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// OK\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003elist0\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// NG (警告)\u003c/span\u003e\n\u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;?\u003c/span\u003e \u003cspan class=\"n\"\u003en_list1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// OK\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003enlist2\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// NG (警告)\u003c/span\u003e\n\u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u0026gt;?\u003c/span\u003e \u003cspan class=\"n\"\u003en_nlist3\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// OK\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e現在の仕様では、配列やジェネリックコレクションは「非変」扱い、つまり、参照型 \u003ccode\u003eA\u003c/code\u003e の配列やジェネリックコレクションの値を、null許容参照型 \u003ccode\u003eA?\u003c/code\u003e の配列やジェネリックコレクションに使うことはできません。（追記：配列の共変性については\u003ca href=\"https://github.com/dotnet/csharplang/wiki/Nullable-Reference-Types-Preview#array-covariance\" rel=\"nofollow noopener\" target=\"_blank\"\u003eWikiにKnown Issues（既知の問題）として挙がっていました\u003c/a\u003e。今後変わる可能性があります。）\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003earray0\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"s\"\u003e\"a\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"b\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"c\"\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e?[]\u003c/span\u003e \u003cspan class=\"n\"\u003enarray1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003earray0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// NG (警告)\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003elist0\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"s\"\u003e\"a\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"b\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"c\"\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003enlist1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003elist0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// NG (警告)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"コンパイル結果がどうなるか\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B3%E3%83%B3%E3%83%91%E3%82%A4%E3%83%AB%E7%B5%90%E6%9E%9C%E3%81%8C%E3%81%A9%E3%81%86%E3%81%AA%E3%82%8B%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eコンパイル結果がどうなるか\u003c/h1\u003e\n\n\u003cp\u003e概要を説明しましたが、理解の早い方は「あれ？値型の場合とはいろいろ違うぞ？」と思われたかもしれません。その通りで、参照型に対するnull許容性は、値型に対するnull許容性と似て非なるものです。なぜなら、実現方式が全く異なるためです。一言でまとめると以下のようになります。\u003c/p\u003e\n\n\u003cdl\u003e\n\u003cdt\u003e値型 \u003ccode\u003eV\u003c/code\u003e のnull許容性\u003c/dt\u003e\n\u003cdd\u003e型 \u003ccode\u003eV?\u003c/code\u003e は コード上も実行時も \u003ccode\u003eSystem.Nullable\u0026lt;V\u0026gt;\u003c/code\u003e と等価\n\u003c/dd\u003e\n\u003cdt\u003e参照型 \u003ccode\u003eR\u003c/code\u003e のnull許容性\u003c/dt\u003e\n\u003cdd\u003e型 \u003ccode\u003eR?\u003c/code\u003e はコンパイラーに対する注釈でしかなく、コンパイル後や実行時はただの型 \u003ccode\u003eR\u003c/code\u003e として扱われる、型消去(Type erasure)\u003c/dd\u003e\n\u003c/dl\u003e\n\n\u003cp\u003eというわけで、参照型のnull許容性では、\u003ccode\u003eSystem.Nullable\u0026lt;T\u0026gt;\u003c/code\u003eなどの別の型でラップしているわけではないので、値型の時のように \u003ccode\u003eHasValue\u003c/code\u003e プロパティや \u003ccode\u003eValue\u003c/code\u003e プロパティを参照するコードを \u003cem\u003e書かなくていい\u003c/em\u003e というよりむしろ \u003cem\u003e書けない\u003c/em\u003e (その代わり、null許容性がフロー解析によって変化する) のでした。\u003c/p\u003e\n\n\u003cp\u003eでは、コンパイル結果がどうなるかを、\u003ca href=\"http://ilspy.net/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eILSpy\u003c/a\u003eや\u003ca href=\"https://github.com/0xd4d/dnSpy\" rel=\"nofollow noopener\" target=\"_blank\"\u003ednSpy\u003c/a\u003eで逆コンパイルしてみましょう。\u003csup id=\"fnref2\"\u003e\u003ca href=\"#fn2\" title=\"実際には逆コンパイラーの出力を一部修正しています。\"\u003e2\u003c/a\u003e\u003c/sup\u003e\u003cbr\u003e\nリストAは、ローカル変数にだけnull許容参照型を使った場合です。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eリストA（元のコード）\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eM\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003edice\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eRandom\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"nf\"\u003eNext\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e6\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003ens0\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edice\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"m\"\u003e6\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"s\"\u003e\"ABC\"\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003ens1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ens0\u003c/span\u003e\u003cspan class=\"p\"\u003e?.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToLowerInvariant\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ens1\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ens1\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003es2\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ens\u003c/span\u003e\u003cspan class=\"p\"\u003e!.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReplace\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sc\"\u003e'a'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"sc\"\u003e'A'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003es2\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eリストA（コンパイル結果を逆コンパイルしたコード）\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eM\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003edice\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eRandom\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"nf\"\u003eNext\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e6\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ens0\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edice\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"m\"\u003e6\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"s\"\u003e\"ABC\"\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ens\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ens0\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003ens0\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToLowerInvariant\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eflag\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ens\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eflag\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ens\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003es2\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ens\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReplace\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sc\"\u003e'a'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"sc\"\u003e'A'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003es2\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003enull条件演算子 \u003ccode\u003e?.\u003c/code\u003e を使った部分が三項条件演算子によるnullチェックになっている以外は、ほぼ元のコードから注釈を抜いただけのコードになっています。\u003c/p\u003e\n\n\u003cp\u003e次に、クラスメンバーにnull許容参照型を使った場合を見てみましょう。リストBはフィールドとプロパティ、リストCはメソッドの引数と戻り値にnull許容参照型を使った例です。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eリストB（元のコード）\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eB\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003estring1Field\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003enullableString1Field\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003eNullableString1\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eget\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003enullableString1Field\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eset\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003enullableString1Field\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eevent\u003c/span\u003e \u003cspan class=\"n\"\u003eEventHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eEventArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u0026gt;?\u003c/span\u003e \u003cspan class=\"n\"\u003eFoo\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eprotected\u003c/span\u003e \u003cspan class=\"k\"\u003evirtual\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnFoo\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eFoo\u003c/span\u003e\u003cspan class=\"p\"\u003e?.\u003c/span\u003e\u003cspan class=\"nf\"\u003eInvoke\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eEventArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEmpty\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eリストB（コンパイル結果を逆コンパイルしたコード）\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Runtime.CompilerServices\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eB\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003estring1Field\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eNullable\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003enullableString1Field\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eNullable\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eNullableString1\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eNullable\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eget\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003enullableString1Field\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eparam\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eNullable\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eset\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003enullableString1Field\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eNullable\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e\u003cspan class=\"p\"\u003e[]{\u003c/span\u003e\u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e})]\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eevent\u003c/span\u003e \u003cspan class=\"n\"\u003eEventHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eEventArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eFoo\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eprotected\u003c/span\u003e \u003cspan class=\"k\"\u003evirtual\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnFoo\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eEventHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eEventArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003e_foo\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFoo\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e_foo\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003e_foo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eEventArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEmpty\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eリストC（元のコード）\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eC\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"nf\"\u003eM0\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003earg\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003earg\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"nf\"\u003eM1\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003earg\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003earg\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e?[]\u003c/span\u003e \u003cspan class=\"nf\"\u003eM2\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDictionary\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003etable\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003etable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValues\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToArray\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eリストC（コンパイル結果を逆コンパイルしたコード）\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Runtime.CompilerServices\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eC\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"nf\"\u003eM0\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003earg\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003earg\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eNullable\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"nf\"\u003eM1\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e\u003cspan class=\"n\"\u003eNullable\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003earg\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003earg\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nf\"\u003eNullable\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e\u003cspan class=\"p\"\u003e[]{\u003c/span\u003e\u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e})]\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"nf\"\u003eM2\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eNullable\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e\u003cspan class=\"p\"\u003e[]{\u003c/span\u003e\u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e})]\u003c/span\u003e \u003cspan class=\"n\"\u003eDictionary\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003etable\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003etable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValues\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToArray\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eリストBとリストCのどちらも、型からは注釈が消えているのはリストAと同様です。ただし、どのような注釈が付けられていたのかをコンパイラが判断できるように、\u003ccode\u003e[Nullable]\u003c/code\u003e カスタム属性が付与されています。\u003cbr\u003e\nこの \u003ccode\u003e[Nullable]\u003c/code\u003e カスタム属性は、\u003ccode\u003eSystem.Runtime.CompilerServices.NullableAttribute\u003c/code\u003e クラスとして定義されるものです。そしてこのクラスは、.NET Frameworkの共通ライブラリ (FCL) に追加されたものではなく、null許容参照型を使ったコードをコンパイルするときにコンパイラが自動生成してアセンブリに追加したものになります。\u003csup id=\"fnref3\"\u003e\u003ca href=\"#fn3\" title=\"ちなみに、この System.Runtime.CompilerServices.NullableAttribute クラスは、ソースコード中に自分で定義しておくと、そちらが参照され、同名のクラスが別途自動生成されることはありません。\"\u003e3\u003c/a\u003e\u003c/sup\u003e\u003cbr\u003e\n自動生成されたクラスの実装は次のようなものです。\u003csup id=\"fnref4\"\u003e\u003ca href=\"#fn4\" title=\"Microsoft.CodeAnalysis.EmbeddedAttribute クラスも同時に生成されていますが、それは省略します。\"\u003e4\u003c/a\u003e\u003c/sup\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eNullableAttributeクラス\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Runtime.CompilerServices\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eMicrosoft\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCodeAnalysis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEmbedded\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eCompilerGenerated\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n    \u003cspan class=\"k\"\u003einternal\u003c/span\u003e \u003cspan class=\"k\"\u003esealed\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eNullableAttribute\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eAttribute\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eNullableAttribute\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eNullableAttribute\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003ebool\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003etransformFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eこの \u003ccode\u003e[Nullable]\u003c/code\u003eカスタム属性は、nullを許容する参照型 \u003ccode\u003eA?\u003c/code\u003e にはすべて付加されます。一方で、nullを許容しない参照型 \u003ccode\u003eA\u003c/code\u003e の方には何のカスタム属性も付加されません。 \u003cbr\u003e\nまた、配列やジェネリック型の場合は、\u003ccode\u003ebool[]\u003c/code\u003eを受け取るコンストラクタが使われているのがわかると思います。これは、「配列やジェネリック型そのものがnullを許容するかどうか」と、「配列の要素、あるいは、ジェネリック型の型引数となっている参照型がnullを許容するかどうか」を区別するフラグとなっています。\u003ccode\u003ebool[]\u003c/code\u003eの先頭要素が、コンテナー型そのもののnull許容性を表し、それ以降が要素や型引数のnull許容性を順番に表しています。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"既存コードとの相互運用性\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%97%A2%E5%AD%98%E3%82%B3%E3%83%BC%E3%83%89%E3%81%A8%E3%81%AE%E7%9B%B8%E4%BA%92%E9%81%8B%E7%94%A8%E6%80%A7\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e既存コードとの相互運用性\u003c/h1\u003e\n\n\u003cp\u003eここでは、「既存コード＝C# 7系までのコンパイラーでコンパイルするコード、およびそのようにコンパイルしたアセンブリ」「新規コード＝C# 8以降の、null許容参照型の機能を有効にしたコンパイラーでコンパイルするコード、およびそのようにコンパイルしたアセンブリ」とします。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"相互運用性1-新規コードから既存コードを利用する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%9B%B8%E4%BA%92%E9%81%8B%E7%94%A8%E6%80%A71-%E6%96%B0%E8%A6%8F%E3%82%B3%E3%83%BC%E3%83%89%E3%81%8B%E3%82%89%E6%97%A2%E5%AD%98%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E5%88%A9%E7%94%A8%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e相互運用性1: 新規コードから既存コードを利用する\u003c/h2\u003e\n\n\u003cp\u003e既存コードには参照型に \u003ccode\u003e[Nullable]\u003c/code\u003e属性が付与されていないので、原則として \u003cem\u003eすべての参照型がnull非許容\u003c/em\u003e という扱いになります。すると、以下のような問題がおきます。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e既存コードから受け取る参照型は、型の上ではnull非許容に見えるが、実際にはnullが渡されてくるかもしれない\u003c/li\u003e\n\u003cli\u003e既存コードに渡す参照型は、既存コードの実装ではnullを許容していたとしても、null許容参照型を渡すとコンパイル時に警告される\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eこうなるのは、「Kotlinとの比較」のところでも書きますが、 \u003cem\u003e意図的な設計\u003c/em\u003e であり、プレビュー版の不具合というわけではありません。\u003csup id=\"fnref5\"\u003e\u003ca href=\"#fn5\" title=\"デフォルトがnull非許容になっていることはWikiにFAQとして上がっています。\"\u003e5\u003c/a\u003e\u003c/sup\u003e\u003cbr\u003e\nこの問題に新規コード側で対処するには、次のようになるでしょう。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e既存コードから参照型を受け取った場合は、プログラマーの判断で、nullチェックを追加する\u003c/li\u003e\n\u003cli\u003e既存コードに参照型を渡す場合は、プログラマーの判断で、\u003ccode\u003e!\u003c/code\u003e を適用する\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eとはいえ、この「デフォルトでnull非許容とみなす」という仕様は、\u003ca href=\"https://docs.microsoft.com/en-us/dotnet/api/system.linq.enumerable.firstordefault\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003ccode\u003eIEnumerable\u0026lt;T\u0026gt;.FirstOrDefault\u003c/code\u003e拡張メソッド\u003c/a\u003eや、\u003ca href=\"https://docs.microsoft.com/en-us/dotnet/api/system.collections.generic.dictionary-2.trygetvalue\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003ccode\u003eDictionary\u0026lt;TKey, TValue\u0026gt;.TryGetValue\u003c/code\u003eメソッド\u003c/a\u003eのように、\u003ccode\u003edefault(T)\u003c/code\u003e つまり参照型では \u003ccode\u003enull\u003c/code\u003eを返すことを前提とした既存APIとバッティングするものです。この問題は\u003ca href=\"https://github.com/dotnet/csharplang/blob/master/proposals/nullable-reference-types.md#tweaks\" rel=\"nofollow noopener\" target=\"_blank\"\u003eC#言語チームも認識している\u003c/a\u003eようですが、今のところはうまい解決策はないようです。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"相互運用性2-既存コードから新規コードを利用する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%9B%B8%E4%BA%92%E9%81%8B%E7%94%A8%E6%80%A72-%E6%97%A2%E5%AD%98%E3%82%B3%E3%83%BC%E3%83%89%E3%81%8B%E3%82%89%E6%96%B0%E8%A6%8F%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E5%88%A9%E7%94%A8%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e相互運用性2: 既存コードから新規コードを利用する\u003c/h2\u003e\n\n\u003cp\u003e新規コードで指定した型注釈は、カスタム属性として残るもの以外はすべて削除されるので、既存コード側は特別な考慮をしなくても正しくコンパイルできて動作するはずです。（「正しい」既存コードにはすでに適切なnullチェックが含まれているはずですよね？）\u003c/p\u003e\n\n\u003cp\u003e（12/12 aetosさんのコメントを受けて修正）\u003cbr\u003e\n既存コードから新規コードの注釈を知るのは、リフレクションを使えば一応は可能です。\u003cbr\u003e\nたとえば、メソッドの戻り値に付いたカスタム属性と、そのコンストラクター引数は次のようにして取得します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eリフレクションで[Nullable]カスタム属性を得る\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// using System.Reflection;\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003eMethodInfo\u003c/span\u003e \u003cspan class=\"n\"\u003emi\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eTargetClass\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"TargetMethodName\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eBindingFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePublic\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003eBindingFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eInstance\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003eParameterInfo\u003c/span\u003e \u003cspan class=\"n\"\u003epi\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emi\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReturnParameter\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"n\"\u003eCustomAttributeData\u003c/span\u003e \u003cspan class=\"n\"\u003edata\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003epi\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetCustomAttributesData\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFirstOrDefault\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAttributeType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFullName\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e\"System.Runtime.CompilerServices.NullableAttribute\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eConstructorArguments\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCount\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCustomAttributeTypedArgument\u003c/span\u003e \u003cspan class=\"n\"\u003earg\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eConstructorArguments\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 以下略\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eつらつら書きましたが、他言語のコンパイラーを開発していて、C#のnull許容参照型との相互運用性をサポートしようとしているのでもなければ、この属性は無視していいと思います。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"相互運用性3-オプトインアウト機構\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%9B%B8%E4%BA%92%E9%81%8B%E7%94%A8%E6%80%A73-%E3%82%AA%E3%83%97%E3%83%88%E3%82%A4%E3%83%B3%E3%82%A2%E3%82%A6%E3%83%88%E6%A9%9F%E6%A7%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e相互運用性3: オプトイン/アウト機構\u003c/h2\u003e\n\n\u003cp\u003eたとえば、既存コードにnull注釈を追加しないままで、どうにか新しいコンパイラーでコンパイルしたい、などの状況で、警告を抑制したい、無視したい、ということもあるでしょう。そんな時のために、null許容性の不一致から発生する警告を部分的に抑制する機構が検討されています。\u003c/p\u003e\n\n\u003cp\u003eただし、11/15のプレビュー版でいろいろ試した範囲では、警告の抑制はまだ実装されていない様子でした。あくまで、「このような方向で検討されている」という前提で読んで下さい。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"オプトアウト1-指定した要素型フィールドプロパティメソッドetcによるnull許容性の警告を抑制する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%AA%E3%83%97%E3%83%88%E3%82%A2%E3%82%A6%E3%83%881-%E6%8C%87%E5%AE%9A%E3%81%97%E3%81%9F%E8%A6%81%E7%B4%A0%E5%9E%8B%E3%83%95%E3%82%A3%E3%83%BC%E3%83%AB%E3%83%89%E3%83%97%E3%83%AD%E3%83%91%E3%83%86%E3%82%A3%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89etc%E3%81%AB%E3%82%88%E3%82%8Bnull%E8%A8%B1%E5%AE%B9%E6%80%A7%E3%81%AE%E8%AD%A6%E5%91%8A%E3%82%92%E6%8A%91%E5%88%B6%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eオプトアウト1. 指定した要素（型、フィールド、プロパティ、メソッド、etc）によるnull許容性の警告を抑制する\u003c/h3\u003e\n\n\u003cp\u003e\u003ccode\u003eSystem.Runtime.CompilerServices.NullableOptOutAttribute\u003c/code\u003e クラスを定義して、そのクラスを使って \u003ccode\u003e[NullableOptOut]\u003c/code\u003e カスタム属性を付与すると、その属性を付与した要素に関連した警告が抑制される、らしいです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eNullableOptOutAttributeクラス\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Runtime.CompilerServices\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eAttributeUsage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eAttributeTargets\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eModule\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003eAttributeTargets\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eClass\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003eAttributeTargets\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eStruct\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003eAttributeTargets\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDelegate\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003eAttributeTargets\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eInterface\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003eAttributeTargets\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEvent\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003eAttributeTargets\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eField\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003eAttributeTargets\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMethod\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003eAttributeTargets\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eProperty\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n    \u003cspan class=\"k\"\u003einternal\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eNullableOptOutAttribute\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eAttribute\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eNullableOptOutAttribute\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eflag\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003ebool\u003c/code\u003e型のコンストラクター引数は、\u003ccode\u003etrue\u003c/code\u003eの時に警告を抑制し、\u003ccode\u003efalse\u003c/code\u003eの時に警告を出すというものです。たとえば、クラス全体は警告を抑制しつつ、特定のメソッドだけは警告を有効にする、といった時に使います。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"オプトアウト2-指定したアセンブリによるnull許容性の警告を抑制する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%AA%E3%83%97%E3%83%88%E3%82%A2%E3%82%A6%E3%83%882-%E6%8C%87%E5%AE%9A%E3%81%97%E3%81%9F%E3%82%A2%E3%82%BB%E3%83%B3%E3%83%96%E3%83%AA%E3%81%AB%E3%82%88%E3%82%8Bnull%E8%A8%B1%E5%AE%B9%E6%80%A7%E3%81%AE%E8%AD%A6%E5%91%8A%E3%82%92%E6%8A%91%E5%88%B6%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eオプトアウト2. 指定したアセンブリによるnull許容性の警告を抑制する\u003c/h3\u003e\n\n\u003cp\u003e\u003ccode\u003eSystem.Runtime.CompilerServices.NullableOptOutForAssemblyAttribute\u003c/code\u003e クラスを定義して、そのクラスを使って \u003ccode\u003e[NullableOptOutForAssembly]\u003c/code\u003e カスタム属性をモジュールに付与すると、そのモジュール内のコードでは、コンストラクターに文字列で指定したアセンブリに関連した警告が抑制される、らしいです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eNullableOptOutForAssemblyAttributeクラス\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Runtime.CompilerServices\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eAttributeUsage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eAttributeTargets\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eModule\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eAllowMultiple\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n    \u003cspan class=\"k\"\u003einternal\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eNullableOptOutForAssemblyAttribute\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eAttribute\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eNullableOptOutForAssemblyAttribute\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eassemblyName\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eこの属性はモジュールに対して指定するものなので、 \u003ccode\u003e[module: NullableOptOutForAssembly(\"Foo.Bar.Baz\")]\u003c/code\u003e のように指定します。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"kotlinとの比較\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#kotlin%E3%81%A8%E3%81%AE%E6%AF%94%E8%BC%83\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eKotlinとの比較\u003c/h1\u003e\n\n\u003cp\u003e参照型のnull許容性を明示できるようになるという機構は、C#のnull安全性を高めるものといえます。このnull安全性という考え方は、最近の新しいプログラミング言語では採用されることが多くなっています。どのような言語で取り入れられているかについては、Qiitaの\u003ca href=\"https://qiita.com/koher/items/e4835bd429b88809ab33\" id=\"reference-62ace65786e5b7ea2e11\"\u003enull安全でない言語は、もはやレガシー言語だ\u003c/a\u003eという記事によくまとまっています。\u003c/p\u003e\n\n\u003cp\u003eC# 8.0で検討されている、null非許容な参照型は、この記事で言うならば\u003ca href=\"https://kotlinlang.org/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eKotlin\u003c/a\u003eのものに比較的似ています。似ている点を以下に挙げてみます。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e(\u003ccode\u003eNullable\u0026lt;T\u0026gt;\u003c/code\u003e型や代数的データ型のように)別の型でラップしない\u003c/li\u003e\n\u003cli\u003eコンパイルすると、カスタムのメタデータ（カスタム属性／アノテーション）が付与された状態になる\n\n\u003cul\u003e\n\u003cli\u003eKotlinでは 基本的に\u003ccode\u003eorg.jetbrains.annotations\u003c/code\u003eパッケージの \u003ccode\u003eNullable\u003c/code\u003eおよび\u003ccode\u003eNotNull\u003c/code\u003eアノテーションが使われる\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eフロー解析によって変数や式の型が変化する\n\n\u003cul\u003e\n\u003cli\u003eKotlinでは「スマートキャスト」と呼ぶ\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003enullチェックせずに強制アクセスする記法がある\n\n\u003cul\u003e\n\u003cli\u003eKotlinでは \u003ccode\u003e!!\u003c/code\u003e と \u003ccode\u003e!.\u003c/code\u003e のふたつがある\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e一方で、違っている点を以下に挙げてみます。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eKotlinでは、Javaの参照型はnull許容型とnull非許容型のどちらとも決められない「プラットフォーム型」として扱われ、コンパイル時にnull許容性のエラーが報告されない。一方C# 8では、既存コードの参照型はnull非許容型として扱われ、プラットフォーム型のような状態は存在しない。\u003c/li\u003e\n\u003cli\u003eKotlinでnull非許容のコードをコンパイルすると \u003ccode\u003eNotNull\u003c/code\u003eアノテーションが付与されるが、C# 8にはそれに対応するカスタム属性はない。\u003c/li\u003e\n\u003cli\u003eKotlinでは、null非許容型を使ったコードをコンパイルすると、実行時にnullチェックして、nullが入っていた場合は実行時例外をスローするコードが生成される。\u003csup id=\"fnref6\"\u003e\u003ca href=\"#fn6\" title=\"kotlin.jvm.internal.Intrinsics#checkExpressionValueIsNotNull()メソッドによってIllegalStateExceptionが投げられる。ぬるぽではない。\"\u003e6\u003c/a\u003e\u003c/sup\u003e 一方C# 8では、そのような実行時例外を投げるようなコードは生成されない。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e1番目の「プラットフォーム型」については、\u003ca href=\"https://blogs.msdn.microsoft.com/dotnet/2017/11/15/nullable-reference-types-in-csharp/#div-comment-414936\" rel=\"nofollow noopener\" target=\"_blank\"\u003eMSDNブログのコメント欄でC#のプログラムマネージャであるMads Torgersenがコメントしています\u003c/a\u003e。いわく、「複雑になると思ったので入れていない。null許容性が不明な型を入れるとしても、（Kotlinのように）警告なしにするのか、逆にすべてで警告を出すのか、どちらにしたとしても議論になるだろう。」とのことです。\u003cbr\u003e\n2番目の違いは、1番目の違いから来るものです。（デフォルトがnull非許容なので、\u003ccode\u003eNotNull\u003c/code\u003eを表明する必要がない）\u003cbr\u003e\n3番目は、これは私の考えですが、C#の場合はあくまで既存言語のバージョンアップであって、null安全な別言語を作っているわけではないこと、C# は実行時性能をかなり意識していること、\u003ca href=\"https://docs.microsoft.com/en-us/dotnet/api/system.diagnostics.contracts.contract\" rel=\"nofollow noopener\" target=\"_blank\"\u003eContractクラス\u003c/a\u003eでも基本的には例外をスローしないこと、などを踏まえた判断ではないかと思います。\u003c/p\u003e\n\n\u003cp\u003e繰り返しになりますが、C#の場合はあくまで既存言語のバージョンアップであって、C# 本来の特性（書きやすさや実行性能など）と null安全性とのバランスを重視していると理解しています。なので、null安全性だけを見ると、他の言語と比べて弱い部分が残っていますが、それも含めた設計判断なのだと思います。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"落とし穴ジェネリクスとかnull許容値型とか\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%90%BD%E3%81%A8%E3%81%97%E7%A9%B4%E3%82%B8%E3%82%A7%E3%83%8D%E3%83%AA%E3%82%AF%E3%82%B9%E3%81%A8%E3%81%8Bnull%E8%A8%B1%E5%AE%B9%E5%80%A4%E5%9E%8B%E3%81%A8%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e落とし穴：ジェネリクスとかNull許容値型とか\u003c/h1\u003e\n\n\u003cp\u003eこの記事はプレビュー版を前提に書いていることもあり、制限事項もいろいろあります。多くの制限事項は\u003ca href=\"https://github.com/dotnet/csharplang/wiki/Nullable-Reference-Types-Preview#known-issues\" rel=\"nofollow noopener\" target=\"_blank\"\u003eWikiにKnown Issues（既知の問題）としてまとまっている\u003c/a\u003eのですが、ここではジェネリクスに関係することを少しだけ取り上げたいと思います。\u003c/p\u003e\n\n\u003cp\u003e参照型に制約されたジェネリック型を見てみます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eFoo\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ewhere\u003c/span\u003e \u003cspan class=\"n\"\u003eT\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e\n\u003cspan class=\"err\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nc\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"nf\"\u003eFullName\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e \u003cspan class=\"n\"\u003eobj\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eobj\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetType\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"n\"\u003eFullName\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこんな感じで書けるのですが、実はこの\u003ccode\u003eT\u003c/code\u003eに、null許容参照型を渡せます。（コンパイルエラー\u003ca href=\"https://docs.microsoft.com/en-us/dotnet/csharp/misc/cs0453\" rel=\"nofollow noopener\" target=\"_blank\"\u003eCS0453\u003c/a\u003eに\u003cem\u003eならない\u003c/em\u003e）\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eFoo\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ef\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eFoo\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u0026gt;();\u003c/span\u003e \u003cspan class=\"c1\"\u003e// コンパイルが通ってしまう\u003c/span\u003e\n\u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ef\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFullName\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 実行時例外になる\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれはWikiにはまだ書かれていないのですが、おそらくプレビュー版のみの挙動だと思われます。なぜなら、\u003ca href=\"https://github.com/dotnet/csharplang/blob/master/proposals/nullable-reference-types.md#generics\" rel=\"nofollow noopener\" target=\"_blank\"\u003e言語仕様提案のドキュメントにはジェネリクスの制約にnull許容性を明示的に指定する可能性が言及されている\u003c/a\u003eからです。\u003cbr\u003e\nとはいえ、記法として、\u003ccode\u003ewhere T is nonnullable\u003c/code\u003e みたいな書き方になるかどうかも含めて、まだ確定はしていません。\u003c/p\u003e\n\n\u003cp\u003e次に、参照型にも値型にも制約されていないジェネリック型を見てみます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eBar\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"nf\"\u003eM\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003edefault\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eN\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003eobj\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eobj\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"obj is null\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"obj == \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eobj\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003eT\u003c/code\u003e 型は参照型にも値型にも制約されていないのですが、これは合法で、コンパイルが通ります。ただし、コンパイル結果を見ると、null許容参照型のように、null許容性が消去されたバイナリになっていました。\u003c/p\u003e\n\n\u003cp\u003eこんな型を使うと、ちょっと予想と違う動きをします。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003eBar\u0026lt;T\u0026gt;\u003c/code\u003eの実装コード中で、\u003ccode\u003eT?\u003c/code\u003e 型に \u003ccode\u003enull\u003c/code\u003e を入れられない。（コンパイルエラー\u003ca href=\"https://docs.microsoft.com/en-us/dotnet/csharp/misc/cs0453\" rel=\"nofollow noopener\" target=\"_blank\"\u003eCS0453\u003c/a\u003eになる）\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eBar\u0026lt;T\u0026gt;\u003c/code\u003e の型引数にnull許容値型、たとえば \u003ccode\u003eint?\u003c/code\u003e を指定してもエラーにならない。（\u003ccode\u003eint\u003c/code\u003eを指定したのと同じ扱いになる）\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eBar\u0026lt;T\u0026gt;\u003c/code\u003e の型引数にたとえば \u003ccode\u003eint\u003c/code\u003e を指定したとき、メソッド \u003ccode\u003eN\u003c/code\u003e の引数 \u003ccode\u003eobj\u003c/code\u003e の型は \u003ccode\u003eint?\u003c/code\u003e に見えるが、\u003ccode\u003eNullable\u0026lt;int\u0026gt;\u003c/code\u003eの値を渡すとコンパイルエラーになる\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e\u003ca href=\"https://github.com/dotnet/csharplang/wiki/Nullable-Reference-Types-Preview#type-parameters\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003ccode\u003eT\u003c/code\u003e 型が参照型にも値型にも制約されていないときに\u003ccode\u003eT?\u003c/code\u003e型がエラーにならずに使えるのはKnown Issues（既知の問題）\u003c/a\u003eとなっているので、このあたりの挙動はいずれ変わるのでしょうけど、参照型にも値型にも制約されていない型引数自体はおそらく合法のまま残ると思われます。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eT\u003c/code\u003e 型が参照型にも値型にも制約されていないときに\u003ccode\u003eT?\u003c/code\u003e型を使わなければそれでいいかというと、まだ微妙なやつがあります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eBaz\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eT\u003c/span\u003e \u003cspan class=\"nf\"\u003eM\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003edefault\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e// コンパイルが通ってしまう\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこのように、型 \u003ccode\u003eT\u003c/code\u003e に対して \u003ccode\u003edefault(T)\u003c/code\u003e を与えるコードは、\u003ccode\u003eT\u003c/code\u003eが参照型に制約されている場合はエラーになるのですが、上の例のように、\u003ccode\u003eT\u003c/code\u003e 型が参照型にも値型にも制約されていないときはコンパイルが通ってしまいます。そしてもちろん、型引数 \u003ccode\u003eT\u003c/code\u003e にnull非許容参照型を指定した場合、このメソッド \u003ccode\u003eM()\u003c/code\u003e からは \u003ccode\u003enull\u003c/code\u003e が返ってきます。\u003cbr\u003e\nこれもWikiにはまだ書かれていないですが、いずれ変更になると思われます。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"最後に\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%9C%80%E5%BE%8C%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e最後に\u003c/h1\u003e\n\n\u003cp\u003eさて、説明はあくまで概要のみで、プレビュー版の実装など、詳細についてはほとんど触れていないつもりなのですが、それでもそれなりのボリュームになってしまいました。\u003c/p\u003e\n\n\u003cp\u003e現在の仕様に対して意見がある人は英語での議論に参加するといいと思いますが、とはいえ\u003ca href=\"https://github.com/dotnet/csharplang/issues/36\" rel=\"nofollow noopener\" target=\"_blank\"\u003eこれまでの議論は踏まえる必要があるでしょう\u003c/a\u003eね。\u003c/p\u003e\n\n\u003cdiv class=\"footnotes\"\u003e\n\u003chr\u003e\n\u003col\u003e\n\n\u003cli id=\"fn1\"\u003e\n\u003cp\u003e\u003ccode\u003ethis()\u003c/code\u003eの呼び出しがあるなど、警告が出ないケースがあることが\u003ca href=\"https://github.com/dotnet/csharplang/wiki/Nullable-Reference-Types-Preview#uninitialized-fields-warning\" rel=\"nofollow noopener\" target=\"_blank\"\u003eKnown Issues（既知の問題）\u003c/a\u003eとして挙がっています。 \u003ca href=\"#fnref1\"\u003e↩\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\n\u003cli id=\"fn2\"\u003e\n\u003cp\u003e実際には逆コンパイラーの出力を一部修正しています。 \u003ca href=\"#fnref2\"\u003e↩\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\n\u003cli id=\"fn3\"\u003e\n\u003cp\u003eちなみに、この \u003ccode\u003eSystem.Runtime.CompilerServices.NullableAttribute\u003c/code\u003e クラスは、ソースコード中に自分で定義しておくと、そちらが参照され、同名のクラスが別途自動生成されることはありません。 \u003ca href=\"#fnref3\"\u003e↩\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\n\u003cli id=\"fn4\"\u003e\n\u003cp\u003e\u003ccode\u003eMicrosoft.CodeAnalysis.EmbeddedAttribute\u003c/code\u003e クラスも同時に生成されていますが、それは省略します。 \u003ca href=\"#fnref4\"\u003e↩\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\n\u003cli id=\"fn5\"\u003e\n\u003cp\u003eデフォルトがnull非許容になっていることは\u003ca href=\"https://github.com/dotnet/csharplang/wiki/Nullable-Reference-Types-Preview#warnings-from-existing-assemblies\" rel=\"nofollow noopener\" target=\"_blank\"\u003eWikiにFAQとして上がっています\u003c/a\u003e。 \u003ca href=\"#fnref5\"\u003e↩\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\n\u003cli id=\"fn6\"\u003e\n\u003cp\u003e\u003ccode\u003ekotlin.jvm.internal.Intrinsics#checkExpressionValueIsNotNull()\u003c/code\u003eメソッドによって\u003ccode\u003eIllegalStateException\u003c/code\u003eが投げられる。ぬるぽではない。 \u003ca href=\"#fnref6\"\u003e↩\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\n\u003c/ol\u003e\n\u003c/div\u003e\n","createdAt":"2017-12-06T00:44:32Z","elapsedYearsFromLastModifiedAt":3,"encryptedId":"zC8gFZsHpkTzplXVButilRWzf1AMy368--4MBmUG7MK63pb6kp--5dUs+ktV/IpYxmfMbKbRLQ==","isBanned":false,"isDeprecated":true,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2017-12-12T09:29:35Z","likesCount":52,"linkUrl":"https://qiita.com/matarillo/items/4304df03d28db889f7e5","organization":null,"originalId":583537,"stockedCount":31,"title":"Null 非許容な参照型","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%93%E3%81%AE%E8%A8%98%E4%BA%8B%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\"\u003eこの記事について\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%97%E3%83%AC%E3%83%93%E3%83%A5%E3%83%BC%E7%89%88%E3%82%92%E8%A9%A6%E3%81%99%E3%81%9F%E3%82%81%E3%81%AE%E7%92%B0%E5%A2%83\"\u003eプレビュー版を試すための環境\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%A9%E3%81%86%E3%81%84%E3%81%86%E3%82%B3%E3%83%BC%E3%83%89%E3%81%AE%E6%9B%B8%E3%81%8D%E6%96%B9%E3%81%AB%E3%81%AA%E3%82%8B%E3%81%8B%E6%A6%82%E8%A6%81\"\u003eどういうコードの書き方になるか：概要\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%A6%82%E8%A6%811-%E5%9F%BA%E6%9C%AC\"\u003e概要1. 基本\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%A6%82%E8%A6%812-%E3%83%87%E3%83%AA%E3%83%95%E3%82%A1%E3%83%AC%E3%83%B3%E3%82%B9%E5%8F%82%E7%85%A7%E5%89%A5%E3%81%8C%E3%81%97%E3%81%A8%E3%83%95%E3%83%AD%E3%83%BC%E8%A7%A3%E6%9E%90\"\u003e概要2. デリファレンス(参照剥がし)とフロー解析\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%A6%82%E8%A6%813-%E9%85%8D%E5%88%97%E3%82%B8%E3%82%A7%E3%83%8D%E3%83%AA%E3%82%AF%E3%82%B9\"\u003e概要3. 配列/ジェネリクス\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B3%E3%83%B3%E3%83%91%E3%82%A4%E3%83%AB%E7%B5%90%E6%9E%9C%E3%81%8C%E3%81%A9%E3%81%86%E3%81%AA%E3%82%8B%E3%81%8B\"\u003eコンパイル結果がどうなるか\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%97%A2%E5%AD%98%E3%82%B3%E3%83%BC%E3%83%89%E3%81%A8%E3%81%AE%E7%9B%B8%E4%BA%92%E9%81%8B%E7%94%A8%E6%80%A7\"\u003e既存コードとの相互運用性\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%9B%B8%E4%BA%92%E9%81%8B%E7%94%A8%E6%80%A71-%E6%96%B0%E8%A6%8F%E3%82%B3%E3%83%BC%E3%83%89%E3%81%8B%E3%82%89%E6%97%A2%E5%AD%98%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E5%88%A9%E7%94%A8%E3%81%99%E3%82%8B\"\u003e相互運用性1: 新規コードから既存コードを利用する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%9B%B8%E4%BA%92%E9%81%8B%E7%94%A8%E6%80%A72-%E6%97%A2%E5%AD%98%E3%82%B3%E3%83%BC%E3%83%89%E3%81%8B%E3%82%89%E6%96%B0%E8%A6%8F%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E5%88%A9%E7%94%A8%E3%81%99%E3%82%8B\"\u003e相互運用性2: 既存コードから新規コードを利用する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%9B%B8%E4%BA%92%E9%81%8B%E7%94%A8%E6%80%A73-%E3%82%AA%E3%83%97%E3%83%88%E3%82%A4%E3%83%B3%E3%82%A2%E3%82%A6%E3%83%88%E6%A9%9F%E6%A7%8B\"\u003e相互運用性3: オプトイン/アウト機構\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%AA%E3%83%97%E3%83%88%E3%82%A2%E3%82%A6%E3%83%881-%E6%8C%87%E5%AE%9A%E3%81%97%E3%81%9F%E8%A6%81%E7%B4%A0%E5%9E%8B%E3%83%95%E3%82%A3%E3%83%BC%E3%83%AB%E3%83%89%E3%83%97%E3%83%AD%E3%83%91%E3%83%86%E3%82%A3%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89etc%E3%81%AB%E3%82%88%E3%82%8Bnull%E8%A8%B1%E5%AE%B9%E6%80%A7%E3%81%AE%E8%AD%A6%E5%91%8A%E3%82%92%E6%8A%91%E5%88%B6%E3%81%99%E3%82%8B\"\u003eオプトアウト1. 指定した要素（型、フィールド、プロパティ、メソッド、etc）によるnull許容性の警告を抑制する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%AA%E3%83%97%E3%83%88%E3%82%A2%E3%82%A6%E3%83%882-%E6%8C%87%E5%AE%9A%E3%81%97%E3%81%9F%E3%82%A2%E3%82%BB%E3%83%B3%E3%83%96%E3%83%AA%E3%81%AB%E3%82%88%E3%82%8Bnull%E8%A8%B1%E5%AE%B9%E6%80%A7%E3%81%AE%E8%AD%A6%E5%91%8A%E3%82%92%E6%8A%91%E5%88%B6%E3%81%99%E3%82%8B\"\u003eオプトアウト2. 指定したアセンブリによるnull許容性の警告を抑制する\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#kotlin%E3%81%A8%E3%81%AE%E6%AF%94%E8%BC%83\"\u003eKotlinとの比較\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E8%90%BD%E3%81%A8%E3%81%97%E7%A9%B4%E3%82%B8%E3%82%A7%E3%83%8D%E3%83%AA%E3%82%AF%E3%82%B9%E3%81%A8%E3%81%8Bnull%E8%A8%B1%E5%AE%B9%E5%80%A4%E5%9E%8B%E3%81%A8%E3%81%8B\"\u003e落とし穴：ジェネリクスとかNull許容値型とか\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%9C%80%E5%BE%8C%E3%81%AB\"\u003e最後に\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":28001,"uuid":"4304df03d28db889f7e5","banReason":null,"adventCalendarItem":{"day":9,"calendar":{"name":"C#","urlName":"csharp","year":2017,"organization":null}},"author":{"encryptedId":"Mak4Pea3luT1mw5uBdXuZkEmIg==--xr+G8l5YzcWy+H9Y--irVOfwM9Clv4nG9RMPAbwQ==","originalId":2079,"description":"","facebookUrl":null,"githubUrl":"https://github.com/matarillo","isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"","profileImageUrl":"https://qiita-image-store.s3.amazonaws.com/0/2079/profile-images/1473680702","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F2079%2Fprofile-images%2F1473680702?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=fcc5bb05225881c227703339a5b282b7","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F2079%2Fprofile-images%2F1473680702?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=f5d14452e90e4b7c9f5d33050622ea16","urlName":"matarillo","websiteUrl":null,"twitterUrl":"https://twitter.com/matarillo","twitterUrlName":"matarillo","revealedOrganizations":{"edges":[]}},"tags":[{"name":"C#","urlName":"csharp"},{"name":"Kotlin","urlName":"kotlin"},{"name":"NULL","urlName":"null"}],"followingLikers":{"edges":[]},"comments":{"totalCount":6}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

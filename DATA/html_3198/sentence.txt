More than 1 year has passed since last update.TCP/IPサーバでクライアントと通信している時、クライアントとの接続が切れた場合の処理のまとめです。
接続が切れたとは、以下の場合です。クライアントがshutdownを実行して回線を切った場合、サーバーのNetworkStream.Read()は長さ０の通信を受け取って終了します。クライアントがWSACleanupを実行たり、ExitProcessして回線を切った場合、サーバーのNetworkStream.Read()は例外を投げて終了します。通常は無反応です。
Keep-aliveの設定を行っておくと設定条件となった時、強制終了したときと同様にNetworkStream.Read()は例外を投げて終了します。keep-aliveとは、接続している相手に定期的にプローブという通信を投げ応答があるかどうかを確認するもので、応答がなくなったら回線に異常が生じたと検出する手法です。
プローブのON/OFF、クライアントとの通信がなくなってからプローブを送信するまでの待ち時間、プローブを送信する間隔を設定します。待ち時間と間隔はミリ秒で設定します。
この例では、スイッチはON、待ち時間２秒、間隔１秒、です。Windowsでは１０回連続でプローブの応答がなかったら例外を発生するようです。プローブはネットワークトラフィックを増やします。その点は注意。参考URL
https://www.codeproject.com/Articles/117557/Set-Keep-Alive-Values



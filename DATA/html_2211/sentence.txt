WPFでDataGridなどのItemControlを使用していると複数を選択した際のSelectedItemsを取得したいということがあります。
この際に、コードビハインドを使用すればあまり苦労せずに使用できますが、ViewModelとBindingしようとすると、難しくなってしまいます。
ググるとこれでもかというほどたくさんの実装方法が出ていますが、自分の記録用としてもここに記載しようと思います。
ここではDataGridを例に取り上げてみます。まずはシンプルなものからIsSelectedのバインディング方法ですが、これはDataGridの場合、DataGrid.RowStyleを以下のコードのように設定するとできますDataGridにはSelectedItemsというDependency Propertyがないので、この場合はビヘイビアを作成してバインドできるようにします
ビヘイビアのコードは以下の通りです
DataGridで使用するだけでなく、ItemsControlを継承したコントロールで使用できるようにSelectorのビヘイビアとして作成しています。
そのためにOnSelectionChangedでvar selector = AssociatedObjectとしています。varはdynamicとしてもかまいませんDependency PropertyとしてSelectedItemsを作成し、OnSelectionChangedでAddedItems、RemovedItemsで項目を追加削除しています
あとは、Viewで以下のように使用しますこれでSelectedItemsとのバインディングが可能となりました。



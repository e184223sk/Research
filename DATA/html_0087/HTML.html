<!DOCTYPE html><html><head><meta charset="utf-8" /><title>wixsharpでインストーラーを作る - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/skitoy4321/items/111ca55899473b9c2df4" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="LBbDG8sdlP3960l4oifab6JITBDBzVRPTsdLMLpIydENHB//wTR5HnGvXdRQYykMV9PqhoGnQOJB21SppXZGAg==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta content="@skitoy4321" name="twitter:creator" /><meta property="og:type" content="article"><meta property="og:title" content="wixsharpでインストーラーを作る - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1kMmw0YzJoaGNuRGpnYWZqZ3FUamc3UGpncm5qZzRqamc3empnNm5qZzd6amdwTGt2WnpqZ29zJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NTQmdHh0LWNsaXA9ZWxsaXBzaXMmdHh0LWFsaWduPWNlbnRlciUyQ21pZGRsZSZzPWVkYTQ3OTBkYTMwMWI2YWUzN2MxZmFkNGIzYzA0MGU2&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RSE5yYVhSdmVUUXpNakUmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT00NSZ0eHQtYWxpZ249cmlnaHQlMkNib3R0b20mcz1jY2M1MmMxZWFiYjkwYjFjMmY5ZTYyZjVkZDk3ZmU4Zg&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=ca9ca6f5f700908a9cb704ffd8bfdc08"><meta property="og:description" content="

はじめに

Windows向けインストーラーの形式として、MSIというものが存在する。
インストーラー作成ツールとしてメジャーなものには、VSのインストールプロジェクト、あるいはInstallShieldなどがあるが、
このMSI..."><meta content="https://qiita.com/skitoy4321/items/111ca55899473b9c2df4" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#,msi,WiXToolset" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-0bed6c6e-78e7-450e-93d6-9893301c5fc9"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Fskitoy4321%2Fitems%2F111ca55899473b9c2df4">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Fskitoy4321%2Fitems%2F111ca55899473b9c2df4">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-0bed6c6e-78e7-450e-93d6-9893301c5fc9">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2021-01-20T21:44:44.000+09:00","dateModified":"2021-01-20T21:49:53.000+09:00","headline":"wixsharpでインストーラーを作る","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1kMmw0YzJoaGNuRGpnYWZqZ3FUamc3UGpncm5qZzRqamc3empnNm5qZzd6amdwTGt2WnpqZ29zJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NTQmdHh0LWNsaXA9ZWxsaXBzaXMmdHh0LWFsaWduPWNlbnRlciUyQ21pZGRsZSZzPWVkYTQ3OTBkYTMwMWI2YWUzN2MxZmFkNGIzYzA0MGU2\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RSE5yYVhSdmVUUXpNakUmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT00NSZ0eHQtYWxpZ249cmlnaHQlMkNib3R0b20mcz1jY2M1MmMxZWFiYjkwYjFjMmY5ZTYyZjVkZDk3ZmU4Zg\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=ca9ca6f5f700908a9cb704ffd8bfdc08","mainEntityOfPage":"https://qiita.com/skitoy4321/items/111ca55899473b9c2df4","author":{"@type":"Person","address":"","email":null,"identifier":"skitoy4321","name":"skitoy4321","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F103253%2Fprofile-images%2F1526359222?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=9623ed561bd61ca207da0cb6419ba01d","url":"https://qiita.com/skitoy4321","description":"","memberOf":[]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://increments.connpass.com/event/211948/">Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催</a><a target="_blank" id="header_text_message_2" href="https://increments.connpass.com/event/211948/">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"skitoy4321","type":"items","id":"111ca55899473b9c2df4"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"skitoy4321","type":"items","id":"111ca55899473b9c2df4"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_1","message":"Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"skitoy4321","type":"items","id":"111ca55899473b9c2df4"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_2","message":"Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/skitoy4321/items/111ca55899473b9c2df4","location":"/skitoy4321/items/111ca55899473b9c2df4","scheme":"https","host":"qiita.com","port":null,"pathname":"/skitoy4321/items/111ca55899473b9c2df4","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"KVFsHWOV65W1/UftsDqc+TzBZueRjGaBN47Ou6IB/YcIW7D5abwGdjm5U0FCfm+ayVrAcdHmciw4ktEivT9yVA==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-2fc38c3b-00aa-49e2-b37a-60c57c665169"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/skitoy4321/items/111ca55899473b9c2df4/likers" class="css-1iupg5d">4</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">7</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/111ca55899473b9c2df4/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/skitoy4321/items/111ca55899473b9c2df4/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/skitoy4321/items/111ca55899473b9c2df4/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/skitoy4321/items/111ca55899473b9c2df4/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/skitoy4321/items/111ca55899473b9c2df4.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/skitoy4321"><img class="css-100alwu eyfquo10" src="https://qiita-image-store.s3.amazonaws.com/0/103253/profile-images/1526359222" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/skitoy4321" class="css-10ougpm">@<!-- -->skitoy4321</a><div class="css-1ay9vb9"><span><meta content="2021-01-20T12:44:44Z"/><time dateTime="2021-01-20T12:49:53Z" class="css-m19uds">updated at 2021-01-20</time></span></div></div></div></div></div><h1 class="css-cgzq40">wixsharpでインストーラーを作る</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/msi" class="css-4czcte">msi</a><a href="/tags/wixtoolset" class="css-4czcte">WiXToolset</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div>
<h1>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h1>

<p>Windows向けインストーラーの形式として、MSIというものが存在する。<br>
インストーラー作成ツールとしてメジャーなものには、VSのインストールプロジェクト、あるいはInstallShieldなどがあるが、<br>
このMSIを基盤としている(<a href="https://nsis.sourceforge.io/Main_Page" rel="nofollow noopener" target="_blank">NSIS</a>や<a href="https://jrsoftware.org/isinfo.php" rel="nofollow noopener" target="_blank">Inno Setup</a>は別の仕組み)。</p>

<p>このMSIを作るための手法として、<a href="http://wixtoolset.org/" rel="nofollow noopener" target="_blank">Wix Toolset</a>というものが存在する。<br>
XMLで宣言的にコンポーネント等を設定して、MSIを作るというものだ。</p>

<p>しかしこのwix、再利用がしにくい部分がある、記述が冗長になりやすい、補完が難しい等、作りこんでいくと多少苦しくなる時がある。<br>
そのようなwixをC#で記述することによって、IDE(vsやvscode)の補完や、処理の再利用などをしやすくした <a href="https://github.com/oleg-shilo/wixsharp" rel="nofollow noopener" target="_blank">WixSharp</a> なるものが存在する。</p>

<p>今回は、そのWixSharpをvscodeで記述するための最初のステップや、注意するべき点について記述したいと思う。</p>

<p>なお、WixSharpを使うに当たりMSIとWixの関連領域に踏み込むことは不可避なので、これらも並行して学んでいくと良いと思う。</p>

<h1>
<span id="wixsharpとは" class="fragment"></span><a href="#wixsharp%E3%81%A8%E3%81%AF"><i class="fa fa-link"></i></a>WixSharpとは</h1>

<p>WixSharpとは、C#でMSIパッケージの生成をできるようにしたライブラリで、ほとんどの機能はWixのラッパーとなる。<br>
また、Wixに備わっているDTF(Deployment Tool Foundation)を利用することによって、winformsやWPFでのUI記述や、.NETによるカスタムアクションの定義等を容易に行う事が可能になる。<br>
もともとCS-Scriptという、Roslyn以前にC#をスクリプトで使おうというプロジェクトの一つの活用事例として作られたものであるが、実際はCS-Scriptなしでも単体のライブラリとして存在している。</p>

<p>今回は執筆時点での最新版である1.15.0をベースに書いていく。</p>

<h1>
<span id="前提条件" class="fragment"></span><a href="#%E5%89%8D%E6%8F%90%E6%9D%A1%E4%BB%B6"><i class="fa fa-link"></i></a>前提条件</h1>

<p>本記事の中で必要なものは以下の通り</p>

<ul>
<li>Windowsマシン

<ul>
<li>そもそもMSIがWindows専用の機構であるため</li>
</ul>
</li>
<li>.NET Framework SDK

<ul>
<li>WixSharpは.NET Framework用のライブラリしか提供してないため</li>
</ul>
</li>
<li>Windows 10 SDK

<ul>
<li>インストールコンポーネントの中の"MSI Tools"というものがあるので、それを有効にする</li>
</ul>
</li>
<li>Wix v3

<ul>
<li>
<a href="https://wixtoolset.org/releases/" class="autolink" rel="nofollow noopener" target="_blank">https://wixtoolset.org/releases/</a> より、最新安定版をDLする</li>
<li>
<code>*-binaries.zip</code>と<code>*.exe</code>があるが、片方はバイナリのみ、片方はインストーラーとなり、今回はどちらでも構わない</li>
</ul>
</li>
<li>Visual Studio Code + C#拡張

<ul>
<li>エディタとして本記事で使う</li>
</ul>
</li>
<li>Visual Studio + .NET開発 サポート

<ul>
<li>同じくC#拡張のため</li>
<li>最低限Visual Studio Build Toolでも可</li>
</ul>
</li>
</ul>

<h1>
<span id="使用するwixの準備" class="fragment"></span><a href="#%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8Bwix%E3%81%AE%E6%BA%96%E5%82%99"><i class="fa fa-link"></i></a>使用するWixの準備</h1>

<p>WixSharpはその性質上、Wixの実行バイナリ(candle.exe等)がどうしても必要になる。そのため、Wixの実行バイナリがあるフォルダがどこにあるかを知る必要がある。<br>
定義するための手法は以下のようなものがあり、いずれも設定されたディレクトリ直下にcandle.exe等があることが期待される。<br>
上から順に優先される。</p>

<ol>
<li>MSI生成時に<code>WixSharp.Compiler.WixLocation</code>に設定する</li>
<li>コマンドライン引数で<code>/WIXBIN:</code>をプレフィックスに持つものを探し、その後ろのパスを使用する

<ul>
<li>MSBuildで使う用</li>
</ul>
</li>
<li>環境変数の<code>WIXSHARP_WIXDIR</code>を取得

<ul>
<li>エラーメッセージ等でも示されているので、環境変数で設定する場合はこの方法が一番いいかも</li>
</ul>
</li>
<li>環境変数の<code>WixLocation</code>を取得</li>
<li>環境変数の<code>WIX</code>を取得し、その後ろに<code>bin</code>フォルダを追加する

<ul>
<li>WIXをMSI経由でインストールした場合、環境変数<code>WIX</code>は自動的に設定される</li>
</ul>
</li>
<li>
<code>%ProgramFiles%</code>の配下にあるWixインストールディレクトリを検索し、あればそこに<code>bin</code>を追加する</li>
<li>
<code>..\..\Wix_bin\bin</code>、<code>..\..\..\..\Wix_bin\bin</code>、<code>..\..\..\..\..\Wix_bin\bin</code>を検索し、あれば採用する

<ul>
<li>サンプル用なので実際には期待しない方が良い</li>
</ul>
</li>
</ol>

<p>MSIからWixをインストールした場合、大抵の場合は<code>WIX</code>環境変数の部分で引っかかると思う</p>

<h1>
<span id="msi生成プロジェクトの準備" class="fragment"></span><a href="#msi%E7%94%9F%E6%88%90%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E6%BA%96%E5%82%99"><i class="fa fa-link"></i></a>MSI生成プロジェクトの準備</h1>

<h2>
<span id="新規プロジェクトの生成" class="fragment"></span><a href="#%E6%96%B0%E8%A6%8F%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E7%94%9F%E6%88%90"><i class="fa fa-link"></i></a>新規プロジェクトの生成</h2>

<p>さて、Wix実行ファイルの場所特定ができたら、次はMSIを生成するプロジェクトの作成である。<br>
といっても、生成するのは普通のC#のコンソールプロジェクトで、<code>dotnet new console</code>辺りで作ればいいだけである。<br>
ただし、WixSharpのライブラリは.NET Framework製なので、後でTargetFrameworkを.NET Framework系のものに変えておこう(<code>net461</code>とか<code>net35</code>とか)</p>

<h2>
<span id="nugetパッケージの追加" class="fragment"></span><a href="#nuget%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%81%AE%E8%BF%BD%E5%8A%A0"><i class="fa fa-link"></i></a>nugetパッケージの追加</h2>

<p>プロジェクトの生成が完了したら、WixSharpのnugetパッケージを追加することになる。<br>
WixSharpには以下のように複数のnugetパッケージが存在するため、自分のプロジェクトに合わせて参照するものを変えること。</p>

<ul>
<li>WixSharp.bin

<ul>
<li>ライブラリ部分のパッケージ</li>
</ul>
</li>
<li>WixSharp

<ul>
<li>WixSharp.bin + MSBuild時に更新が入った場合、自動的にプログラムが実行されるようになる→ビルドするだけでMSIができるようになる</li>
</ul>
</li>
<li>WixSharp.Lab

<ul>
<li>WixSharp.binに比べて実験的な機能が含まれている</li>
<li>WixSharp.binと共存可</li>
<li>1.15.0時点では画面生成用のクラスが含まれている(WixSharp.Controls)</li>
</ul>
</li>
</ul>

<h1>
<span id="実装" class="fragment"></span><a href="#%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>実装</h1>

<p>プロジェクトの準備ができたら、ソースを編集していく。<br>
おおまかには以下のような流れとなる</p>

<ol>
<li>
<code>WixSharp.Project</code>インスタンスの生成</li>
<li>ProductCode、UpgradeCode、言語設定等の主要属性の設定</li>
<li>以下を再帰的に行う

<ol>
<li>
<code>WixSharp.Dir</code>の生成

<ul>
<li>インストールルート以外は、全てディレクトリ単体の名前を指定する</li>
</ul>
</li>
<li>生成したディレクトリ内に<code>WixSharp.File</code>オブジェクト等をnewして追加

<ul>
<li>ファイルの他、レジストリやサービス登録等もここで追加する</li>
</ul>
</li>
<li>内部に更にディレクトリがある場合、<code>WixSharp.Dir</code>を生成して繰り返す</li>
</ol>
</li>
<li>カスタムアクションがあればそれを定義して、Projectインスタンスに追加する</li>
</ol>

<p>この他にも、MSIのネイティブUIを定義できたり、Windows FormsやWPFを使って画面を作成することもできるが、長くなるのでこの記事では取り上げない。</p>

<h2>
<span id="主に決めるべき主要属性" class="fragment"></span><a href="#%E4%B8%BB%E3%81%AB%E6%B1%BA%E3%82%81%E3%82%8B%E3%81%B9%E3%81%8D%E4%B8%BB%E8%A6%81%E5%B1%9E%E6%80%A7"><i class="fa fa-link"></i></a>主に決めるべき主要属性</h2>

<p>wixsharpでは、wixに関するプロパティが細かい所まで設定できるが、その中でも最初に考慮した方が良いものを挙げていく。<br>
下で紹介されている他にも、成果物出力先決定などに使われるOutDir等の設定があるが、あまり重要ではないため省略する。<br>
全て見たい場合は、<a href="https://github.com/oleg-shilo/wixsharp/blob/v1.15.0.0/Source/src/WixSharp/Project.cs" rel="nofollow noopener" target="_blank">WixSharpのコードを見ること</a></p>

<h3>
<span id="upgradecode" class="fragment"></span><a href="#upgradecode"><i class="fa fa-link"></i></a>UpgradeCode</h3>

<p>MSIでいう所の <a href="https://docs.microsoft.com/en-us/windows/win32/msi/upgradecode" rel="nofollow noopener" target="_blank">UpgradeCodeプロパティ</a>を設定する。<br>
<strong>よほどのことが無い限り、MSIのUpgradeCodeは変わらないはずなので、とりあえず設定しておく方がいい。</strong></p>

<h3>
<span id="productcode" class="fragment"></span><a href="#productcode"><i class="fa fa-link"></i></a>ProductCode</h3>

<p>MSIでいう所の <a href="https://docs.microsoft.com/en-us/windows/win32/msi/productcode" rel="nofollow noopener" target="_blank">ProductCodeプロパティ</a> を設定する。<br>
ProductCodeプロパティはメジャー/マイナーアップグレードの主要な判断材料となるため、よく考えて設定する、しないを決定すること。<br>
また、WixSharpにおいては、<strong>各コンポーネント(ファイル等)のGUIDはProductCodeを基点に一意に決定されるため、値の取り扱いについては十分注意すること</strong>。</p>

<h3>
<span id="guid" class="fragment"></span><a href="#guid"><i class="fa fa-link"></i></a>GUID</h3>

<p>これはWixSharp独自のプロパティで、設定すると後述するProductCodeやUpgradeCodeが手動設定されていない場合の基点となる。<br>
WixSharpがUpgradeCode、ProductCodeがどのように決定するかは以下の図を参照。</p>

<p><a href="https://camo.qiitausercontent.com/528d173861b5be61b841f954e7aa39ad56468fc5/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3130333235332f63636430643533322d333133652d653363322d656233322d3962653939393735396639322e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F103253%2Fccd0d532-313e-e3c2-eb32-9be999759f92.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=7a144bf8641c72e513032a01843fedab" alt="UpgradeCode決定手順" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/103253/ccd0d532-313e-e3c2-eb32-9be999759f92.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F103253%2Fccd0d532-313e-e3c2-eb32-9be999759f92.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=2293ca0a6023f763abda4c79d5529629 1x" loading="lazy"></a></p>

<p><a href="https://camo.qiitausercontent.com/9d52f2ab9e6346cd6ad2b524ecfb41df5709cc49/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3130333235332f65663736313339372d616331622d376563332d643363372d6536376232626263343639322e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F103253%2Fef761397-ac1b-7ec3-d3c7-e67b2bbc4692.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=5fff0ff4d933657723716f25a8524f24" alt="ProductCodeの決定の仕方" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/103253/ef761397-ac1b-7ec3-d3c7-e67b2bbc4692.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F103253%2Fef761397-ac1b-7ec3-d3c7-e67b2bbc4692.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=f69db94d87dcbb64fd72cfe16bc50e0b 1x" loading="lazy"></a></p>

<h3>
<span id="majorupgrade" class="fragment"></span><a href="#majorupgrade"><i class="fa fa-link"></i></a>MajorUpgrade</h3>

<p>メジャーアップグレードで、ダウングレードを許すか、どのタイミングで既存プロダクトの削除を行うかを設定する。<br>
メジャーアップグレードをしたいならば必ず設定しておくこと。<br>
それぞれのフィールドの意味は以下で、<a href="https://wixtoolset.org/documentation/manual/v3/xsd/wix/majorupgrade.html" rel="nofollow noopener" target="_blank">WixのMajorUpgradeエレメントに対応する</a></p>

<ul>
<li>
<code>bool? AllowDowngrades</code>(default=false)

<ul>
<li>古いバージョンへのダウングレードを検知したとき、インストールをブロックするかどうか</li>
</ul>
</li>
<li>
<code>bool? AllowSameVersionUpgrades</code>(default=true)

<ul>
<li>バージョン番号が同じ場合でも、メジャーアップグレードを許可するか</li>
</ul>
</li>
<li>
<code>bool? Disallow</code>(default=false)

<ul>
<li>メジャーアップグレードを禁止する</li>
</ul>
</li>
<li>
<code>string DisallowUpgradeErrorMessage</code>

<ul>
<li>メジャーアップグレードを検知したときに、エラー画面とともに表示されるメッセージ</li>
</ul>
</li>
<li>
<code>bool? IgnoreRemoveFailure</code>(default=false)

<ul>
<li>メジャーアップグレードの時にアンインストールを実行して失敗したとき、アップグレードを続行するかどうか</li>
<li>続行したときに何が起こるかは個別の事情が絡むため網羅的にいいにくいので、実際どうなるかを確かめてから設定すること</li>
</ul>
</li>
<li>
<code>bool? MigrateFeatures</code>(default=true)

<ul>
<li>Featuresを継承するかどうか</li>
</ul>
</li>
<li>
<code>string RemoveFeatures</code>

<ul>
<li>指定したFeatureがインストールされている時、それらを再インストールしない</li>
</ul>
</li>
<li>
<code>WixSharp.UpgradeSchedule? Schedule</code>(default=afterInstallValidate)

<ul>
<li>メジャーアップグレードの中で、アンインストールをどのタイミングで行うか設定する</li>
<li>大体はデフォルトのままで問題ないが、<strong>アップグレードが途中で失敗して中断した場合、元バージョンもろとも消え去ってしまう</strong>ため、可能性がある場合は注意すること</li>
</ul>
</li>
</ul>

<h3>
<span id="majorupgradestrategy" class="fragment"></span><a href="#majorupgradestrategy"><i class="fa fa-link"></i></a>MajorUpgradeStrategy</h3>

<p>メジャーアップグレードをどのバージョンからどのバージョンまでで有効にするか等を決定する。<br>
<a href="https://wixtoolset.org/documentation/manual/v3/xsd/wix/upgrade.html" rel="nofollow noopener" target="_blank">Wixでいう所の、Upgradeエレメントに対応する</a></p>

<h3>
<span id="version" class="fragment"></span><a href="#version"><i class="fa fa-link"></i></a>Version</h3>

<p>ここでバージョンを設定すると、ProductVersionプロパティが設定され、作成するMSIパッケージのバージョンになる。<br>
ただし、MSIのルールとして、<code>[major].[minor].[build]</code>(各構成要素は全て整数)のように形式が決まっているので注意。<br>
詳しくは <a href="https://docs.microsoft.com/en-us/windows/win32/msi/productversion" rel="nofollow noopener" target="_blank">MSIのドキュメントを参照</a></p>

<p><a href="https://docs.microsoft.com/en-us/windows/win32/msi/major-upgrades" rel="nofollow noopener" target="_blank">MSIにおいてバージョン番号は、メジャー/マイナー/スモールアップデートに関わる所なので気を付けること。</a></p>

<h3>
<span id="ui" class="fragment"></span><a href="#ui"><i class="fa fa-link"></i></a>UI</h3>

<p>Wixが標準で用意しているUIのどれを使うかを選択する。使えるのは以下で、<code>WixSharp.WUI</code>というenumクラスの値を指定する。<br>
ここで設定すると、<code>UIRef</code>にIDを指定したものが追加される。<br>
それぞれのダイアログの解説については、Wixのものをそのまま使っているだけなので、<a href="https://wixtoolset.org//documentation/manual/v3/wixui/wixui_dialog_library.html" rel="nofollow noopener" target="_blank">wixtoolsetのWixUIダイアログの解説</a>を参照。</p>

<p>ここではテンプレートから選ぶような感じになるが、アプリ独自要素(シリアルとか)をインストールUIで設定させたい場合もあるだろう。そのような時はカスタムダイアログを作ることになると思うが、これが書くとまた長いので、<a href="https://github.com/oleg-shilo/wixsharp/tree/master/Source/src/WixSharp.Samples/Wix%23%20Samples/Custom_UI" rel="nofollow noopener" target="_blank">公式のサンプルソースへのリンクを紹介するだけに留めたい</a>。サンプルでは、WinFormsやWPFのダイアログをUIシーケンスの中に挟み込んでいる。</p>

<h3>
<span id="properties" class="fragment"></span><a href="#properties"><i class="fa fa-link"></i></a>Properties</h3>

<p>MSIのユーザー定義プロパティを追加する。<br>
<code>AddProperties</code>メソッドで追加が可能。<br>
なお、<strong>ここで定義できる値は、全てインストール実行前に値が決定されるもの</strong>となることに注意。<br>
具体的に言うと、例えばあるプロパティの値に<code>[PROPERTY_A]\ABC</code>のような、他のプロパティに依存した値を付けても、実際に使う時にはプロパティ指定部分が空になったり、意図した値が反映されない場合がある(インストールディレクトリの指定等)。<br>
そのような場合は、後述するカスタムアクションの一種である<code>WixSharp.SetPropertyAction</code>を使用する必要がある。このアクションを使う時も、アクションの実行順に注意しないと、意図した結果にならない場合があることに注意。</p>

<h3>
<span id="sourcebasedir" class="fragment"></span><a href="#sourcebasedir"><i class="fa fa-link"></i></a>SourceBaseDir</h3>

<p>ファイル等のコンポーネントを指定する際、ソースに相対パスを指定した時の基点となるフォルダを指定する。<br>
設定しないときは、カレントディレクトリが使われる。</p>

<h2>
<span id="コンポーネントの追加" class="fragment"></span><a href="#%E3%82%B3%E3%83%B3%E3%83%9D%E3%83%BC%E3%83%8D%E3%83%B3%E3%83%88%E3%81%AE%E8%BF%BD%E5%8A%A0"><i class="fa fa-link"></i></a>コンポーネントの追加</h2>

<p>プロジェクトの属性が決まったら、各種コンポーネント(ファイル、レジストリ等)を追加していく。<br>
基本的にインストールルートとなる<code>WixSharp.Dir</code>を作成し、そこにどんどんコンポーネントや配下のフォルダを作成していく形になる。<br>
作成の時はLinq to XMLのように、コンストラクタで追加していってもいいし、インスタンスを作成した後追加していってもいい。</p>

<p>ソースでいうと</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="c1">// `WixSharp.Project`に対する便利拡張メソッドを使用するため</span>
<span class="c1">// using WixSharp.CommonTasks;</span>
<span class="kt">var</span> <span class="n">project</span> <span class="p">=</span> <span class="k">new</span> <span class="n">WixSharp</span><span class="p">.</span><span class="nf">Project</span><span class="p">(</span><span class="s">"ProjectName"</span><span class="p">);</span>
<span class="cp">#region "projectオブジェクトへのプロパティ設定等"
#endregion
</span><span class="c1">// コンストラクタ時に追加</span>
<span class="kt">var</span> <span class="n">dir</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Dir</span><span class="p">(</span><span class="k">new</span> <span class="n">WixSharp</span><span class="p">.</span><span class="nf">Id</span><span class="p">(</span><span class="s">"DirID"</span><span class="p">),</span> <span class="s">"%ProgramFiles%Hoge"</span><span class="p">,</span> 
    <span class="k">new</span> <span class="n">WixSharp</span><span class="p">.</span><span class="nf">File</span><span class="p">(</span><span class="k">new</span> <span class="n">WixSharp</span><span class="p">.</span><span class="nf">Id</span><span class="p">(</span><span class="s">"File1"</span><span class="p">),</span> <span class="s">"path/to/source1"</span><span class="p">)</span>
    <span class="p">);</span>
<span class="c1">// 後から追加</span>
<span class="c1">// ここで設定するIdはWixSharp上のIDで、MSIのコンポーネントに設定するGUIDのIDは別途設定されることに注意</span>
<span class="n">dir</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">WixSharp</span><span class="p">.</span><span class="nf">File</span><span class="p">(</span><span class="k">new</span> <span class="n">WixSharp</span><span class="p">.</span><span class="nf">Id</span><span class="p">(</span><span class="s">"File2"</span><span class="p">),</span> <span class="s">"path/to/source2"</span><span class="p">));</span>
<span class="c1">// プロジェクトインスタンスに追加</span>
<span class="n">project</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">dir</span><span class="p">);</span> 
</code></pre></div></div>

<p>のような感じになる。レジストリを追加するときは、<code>WixSharp.File</code>の代わりに<code>WixSharp.RegKey</code>を使う。<br>
なお、インストールはしないが、カスタムアクションなどで使用するファイルがある場合は、<code>WixSharp.Binary</code>を使って追加する。これはDirに所属している必要は無い。</p>

<h3>
<span id="feature" class="fragment"></span><a href="#feature"><i class="fa fa-link"></i></a>Feature</h3>

<p>例えばWindows SDKをインストールする時、インストールするコンポーネントを選択する画面が出てくると思うが、<br>
あれを実現しているのがFeatureという機能となる。<br>
特に指定しない限り、WixSharpは全てのコンポーネントを同じFeatureに属するものとして処理するが、<br>
例えばインストール時にコンポーネントを選択させたい場合は、このFeatureを使うことになる。<br>
基本的には、<code>WixSharp.Feature</code>オブジェクトを最初に生成しておき、各<code>WixSharp.File</code>等のコンポーネントを生成する時、<code>Feature</code>フィールドがあると思うので、そこに設定すればいい。<br>
サンプルコードは<a href="https://github.com/oleg-shilo/wixsharp/blob/master/Source/src/WixSharp.Samples/Wix%23%20Samples/Features/setup.cs" rel="nofollow noopener" target="_blank">WixSharpのリポジトリにあるので</a>、そこを参照すること</p>

<h2>
<span id="カスタムアクションの追加" class="fragment"></span><a href="#%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%A0%E3%82%A2%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E8%BF%BD%E5%8A%A0"><i class="fa fa-link"></i></a>カスタムアクションの追加</h2>

<p>コンポーネントが追加し終わったら、カスタムアクションを追加していく。<br>
カスタムアクションは全て<code>WixSharp.Action</code>から派生しており、共通属性として以下のものを持つ</p>

<ul>
<li>
<code>string Name</code>

<ul>
<li>カスタムアクションの名前</li>
<li>他から参照する時に使われるので、少なくともプロジェクトの中ではユニークであること</li>
</ul>
</li>
<li>
<code>WixSharp.Conditon Condition</code>

<ul>
<li>カスタムアクションを実行するかしないか</li>
<li>文法は <a href="https://docs.microsoft.com/en-us/windows/win32/msi/conditional-statement-syntax" rel="nofollow noopener" target="_blank">MSIのもの</a> がそのまま使えるが、代表的なものは、<code>WixSharp.Condition</code>の静的フィールドとして定義されている</li>
</ul>
</li>
<li>
<code>WixSharp.Execute Execute</code>

<ul>
<li>カスタムアクション実行のコンテキストを指定する(MSI由来)</li>
<li>各設定の詳細は<a href="https://wixtoolset.org/documentation/manual/v3/xsd/wix/customaction.html" rel="nofollow noopener" target="_blank">Wix公式ドキュメント</a>にある</li>
<li>だいたい"immediate"か"deferred"で、デフォルトは"immediate"</li>
<li>なんでこんな設定があるかという事については書くと長いので、<a href="https://docs.microsoft.com/en-us/windows/win32/msi/deferred-execution-custom-actions" rel="nofollow noopener" target="_blank">MSI公式ドキュメント</a>を参照</li>
<li><a href="https://docs.microsoft.com/en-us/windows/win32/msi/obtaining-context-information-for-deferred-execution-custom-actions" rel="nofollow noopener" target="_blank">deferredアクションにした場合、一部のAPIについて制約が付くことに注意(特にプロパティ周り)</a></li>
</ul>
</li>
<li>
<code>bool? Impersonate</code>

<ul>
<li>ユーザー権限(UAC無し)で実行するか(=true)、システム権限(UAC有)で実行するか(=false)で、デフォルトはtrue</li>
<li>falseで実行したいときは、更にExecuteを"deferred"にする必要がある</li>
</ul>
</li>
<li>
<code>WixSharp.Return Return</code>

<ul>
<li>カスタムアクションの実行結果をどう処理するか(戻り値が0かどうかで成功/失敗を判断)</li>
<li>通常は<code>check</code>(デフォルト)か<code>ignore</code>
</li>
</ul>
</li>
<li>
<code>WixSharp.Sequence</code>

<ul>
<li>インストールシーケンスのうち、どのシーケンスに所属するかを指定する</li>
<li>大体<code>InstallExecuteSequence</code>(インストール開始後)か、<code>InstallUISequence</code>(MSIのUI画面)になる</li>
<li>代表的なものは<code>WixSharp.Sequence</code>に静的フィールドとして存在する</li>
</ul>
</li>
<li>
<code>WixSharp.Step</code>、<code>WixSharp.When</code>

<ul>
<li>カスタムアクションをどの時点(Step)の前後どちらで(When)実行するかを指定する(相対指定)</li>
<li>代表的なものは<code>WixSharp.Step</code>に静的フィールドが存在するが、自分のカスタムアクションのIDを指定することも可</li>
</ul>
</li>
<li>
<code>WixSharp.SequenceNumber</code>

<ul>
<li>相対指定ではなく、絶対的な数値の順番で指定する</li>
<li>
<code>Step</code>、<code>When</code>設定とは排他</li>
<li>何を指定すべきかは、MSIの仕組みを知っていないと厳しいため、上級者向け</li>
</ul>
</li>
</ul>

<p>カスタムアクションの種類は、WixSharpにおいては以下のものが公式として存在する。</p>

<ul>
<li>BinaryFileAction

<ul>
<li>MSIに組み込んだ"Binary"ファイルを取り出して、実行可能ファイルとして実行する</li>
</ul>
</li>
<li>ManagedAction

<ul>
<li>DTF(Deployment Tools Foundation)というwix提供の機能を利用して、C#の静的メソッドをカスタムアクションとして実行する</li>
<li>作り方は後述</li>
</ul>
</li>
<li>ElevatedManagedAction

<ul>
<li>上記ManagedActionを管理者権限で実行する</li>
<li>実際は、上記ManagedActionに<code>execute=deferred</code>と<code>impersonate=no</code>が設定されたものになる</li>
</ul>
</li>
<li>InstalledFileAction

<ul>
<li>インストールする(されているファイル)を、IDをキーにして実行する</li>
</ul>
</li>
<li>PathFileAction

<ul>
<li>システムに存在するEXEを指定して実行する</li>
</ul>
</li>
<li>SetPropertyAction

<ul>
<li>
<strong>インストーラー実行時</strong>にプロパティを設定する</li>
<li>インストール中に値が変わるプロパティを基に更に他のプロパティを設定したい場合に使う</li>
<li>カスタムアクション実行時点のプロパティ値を使用するため、実行順に注意すること</li>
</ul>
</li>
</ul>

<p>他にWixとしては、ネイティブDLLの中の関数を実行するということも可能だが、WixSharpではデフォルトでやり方が用意されているわけではない。</p>

<h3>
<span id="managedactionの作り方" class="fragment"></span><a href="#managedaction%E3%81%AE%E4%BD%9C%E3%82%8A%E6%96%B9"><i class="fa fa-link"></i></a>ManagedActionの作り方</h3>

<p>C#でManagedActionを使う場合、いくつかの手順を踏む必要がある。<br>
まず最初に、Microsoft.Deployment.WindowsInstaller.dllを、カスタムアクションを仕込むプロジェクトへ参照追加する必要がある。<br>
カスタムアクションを入れるプロジェクトは、現在wixsharpを使用しているプロジェクトでもいいし、また別途プロジェクトを用意しても構わない。<br>
これは、Wixをインストールするか、zipアーカイブを展開すると、candle.exe等があるフォルダに同梱されている。<br>
これを直接Reference等で参照する。</p>

<p>次に、実行するメソッドを定義するわけだが、</p>

<ul>
<li>所属するクラスがpublic</li>
<li>型が<code>public static ActionResult [メソッド名](Microsoft.Deployment.WindowsInstaller.Session)</code>であること</li>
<li>属性に<code>Microsoft.Deployment.WindowsInstaller.CustomAction</code>があること</li>
</ul>

<p>を満たせばOK。例として下記。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">CustomAction.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">Microsoft.Deployment.WindowsInstaller</span><span class="p">;</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">CustomActions</span>
<span class="p">{</span>
  <span class="c1">// WixSharp側で参照するための名前を設定する</span>
  <span class="c1">// デフォルトはメソッド名がそのまま使われる</span>
  <span class="p">[</span><span class="nf">CustomAction</span><span class="p">(</span><span class="s">"Method1"</span><span class="p">)]</span>
  <span class="k">public</span> <span class="k">static</span> <span class="n">ActionResult</span> <span class="nf">Method1</span><span class="p">(</span><span class="n">Session</span> <span class="n">session</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="c1">// 例外等エラーが起きてcatchしないと、制御が効かずにそのまま終わる可能性があるので注意</span>
    <span class="k">try</span>
    <span class="p">{</span>
      <span class="c1">// MSIのログに出力</span>
      <span class="n">session</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">"in customaction"</span><span class="p">);</span>
      <span class="c1">// MSIプロパティを設定する</span>
      <span class="c1">// Execute=immediateの時に使えるが、他の場合は無視される</span>
      <span class="n">session</span><span class="p">[</span><span class="s">"A_PROPERTY"</span><span class="p">]</span> <span class="p">=</span> <span class="s">"ABCDE"</span><span class="p">;</span>
      <span class="c1">// MSIプロパティを取得する</span>
      <span class="c1">// Execute=immediateの時に使えるが、他の時はnullになる</span>
      <span class="kt">string</span> <span class="n">propb</span> <span class="p">=</span> <span class="n">session</span><span class="p">[</span><span class="s">"B_PROPERTY"</span><span class="p">];</span>
      <span class="c1">// CustomActionDataを取得する</span>
      <span class="c1">// Execute=deferredの時に、ここに値が入り、そうでないときはnull</span>
      <span class="kt">string</span> <span class="n">caData</span> <span class="p">=</span> <span class="n">session</span><span class="p">.</span><span class="n">CustomActionData</span><span class="p">;</span>

      <span class="k">return</span> <span class="n">ActionResult</span><span class="p">.</span><span class="n">Success</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">catch</span><span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">session</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">"error: {0}"</span><span class="p">,</span> <span class="n">e</span><span class="p">);</span>
      <span class="k">return</span> <span class="n">ActionResult</span><span class="p">.</span><span class="n">Failure</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>上記を満たしたメソッドを用意した上で(仮に<code>CustomActions.Method1</code>とする)、ManagedActionを以下のように追加する。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="n">project</span><span class="p">.</span><span class="nf">AddAction</span><span class="p">(</span><span class="k">new</span> <span class="n">WixSharp</span><span class="p">.</span><span class="nf">ManagedAction</span><span class="p">(</span><span class="s">"Method1"</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// カスタムアクションメソッドが入っているアセンブリを指定する</span>
    <span class="c1">// %this%は、このプロジェクトのアセンブリを意味する特別な文字列(デフォルトは%this%)</span>
    <span class="n">ActionAssembly</span> <span class="p">=</span> <span class="s">"%this%"</span><span class="p">,</span>
    <span class="n">Condition</span> <span class="p">=</span> <span class="n">Condition</span><span class="p">.</span><span class="n">NOT_Installed</span><span class="p">,</span>
    <span class="n">Execute</span> <span class="p">=</span> <span class="n">Execute</span><span class="p">.</span><span class="n">immediate</span><span class="p">,</span>
    <span class="n">Impersonate</span> <span class="p">=</span> <span class="k">true</span><span class="p">,</span>
    <span class="c1">// ActionAssemblyに、DTFとシステムアセンブリ以外の依存がある場合、ここにもれなく記述する</span>
    <span class="n">RefAssemblies</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">string</span><span class="p">[],</span>
    <span class="n">Return</span> <span class="p">=</span> <span class="n">Return</span><span class="p">.</span><span class="n">check</span><span class="p">,</span>
    <span class="n">Step</span> <span class="p">=</span> <span class="n">Step</span><span class="p">.</span><span class="n">AppSearch</span><span class="p">,</span>
    <span class="c1">// Execute=deferredの時、ここにプロパティ名をカンマ区切りで入れる必要がある</span>
    <span class="c1">// こうすると、CustomActionDataに"A_PROPERTY=[A_PROPERTYの値];B_PROPERTY=[B_PROPERTYの値]"のように、値が格納される</span>
    <span class="n">UsesProperties</span> <span class="p">=</span> <span class="s">"A_PROPERTY,B_PROPERTY"</span><span class="p">,</span>
<span class="p">});</span>
</code></pre></div></div>

<p>注意点として、<strong>ManagedActionを使用すると、その時点でMSIのインストールに.NET Framework依存ができてしまうため、ManagedActionが使用しているフレームワークバージョンは確実に満たせるように、開発要件を定めておくこと</strong></p>

<h2>
<span id="msiの生成" class="fragment"></span><a href="#msi%E3%81%AE%E7%94%9F%E6%88%90"><i class="fa fa-link"></i></a>MSIの生成</h2>

<p>さて、全てのプロジェクト設定が終わったら、最後に<code>WixSharp.Project.BuildMsi(string path = null)</code>を実行する。<br>
出力されるMSIファイルは、指定が無ければカレントディレクトリの"[プロダクト名].msi"という名前で出力される。<br>
また、同時に生成されたwxsファイルが、"wix/[プロジェクト名].g.wxs"として出力される。<br>
こちらは、生成結果の確認等に使うと良いだろう。</p>

<p>また、MSIを作らずにwxsの確認だけ行いたい場合は、<code>WixSharp.Project.BuildWxs(string path = null)</code>を実行する。<br>
こちらはWixのツールを実行しないので、BuildMsiでエラーが出た時にwxsの中身を確認したい場合に使うと良いと思う。</p>

<h1>
<span id="終わりに" class="fragment"></span><a href="#%E7%B5%82%E3%82%8F%E3%82%8A%E3%81%AB"><i class="fa fa-link"></i></a>終わりに</h1>

<p>ここまでWixSharpの入り口として記事を書いたが、MSIネイティブやWindows Formsを画面に使えたり、あるいはMSIを実行するためのブートストラッパーの作成ができるなど、ここでは紹介していない機能が色々あるので、機会があればまたその辺りの記事を書いてみたい。</p>

<h1>
<span id="参考リンク" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E3%83%AA%E3%83%B3%E3%82%AF"><i class="fa fa-link"></i></a>参考リンク</h1>

<ul>
<li><a href="https://github.com/oleg-shilo/wixsharp/tree/v1.15.0.0/" rel="nofollow noopener" target="_blank">WixSharpのソース</a></li>
<li><a href="https://github.com/oleg-shilo/wixsharp/tree/v1.15.0.0/Source/src/WixSharp.Samples" rel="nofollow noopener" target="_blank">WixSharpのサンプルソース集</a></li>
<li><a href="https://docs.microsoft.com/en-us/windows/win32/msi/major-upgrades" rel="nofollow noopener" target="_blank">MSIのメジャーアップグレードについて</a></li>
<li>
<a href="https://docs.microsoft.com/ja-jp/windows/msix/overview" rel="nofollow noopener" target="_blank">MSIX</a>

<ul>
<li>次世代Windowsパッケージシステム</li>
<li>
<a href="https://www.firegiant.com/products/wix-expansion-pack/msix/" rel="nofollow noopener" target="_blank">Wixでも有料サポートで作成は可能</a>だが、WixSharpでは使えない</li>
</ul>
</li>
<li><a href="https://wixtoolset.org/" rel="nofollow noopener" target="_blank">Wix Toolsetのサイト</a></li>
<li><a href="https://wixtoolset.org/documentation/manual/v3/" rel="nofollow noopener" target="_blank">Wixのリファレンス(v3)</a></li>
<li><a href="https://nsis.sourceforge.io/Main_Page" rel="nofollow noopener" target="_blank">NSIS</a></li>
<li><a href="https://jrsoftware.org/isinfo.php" rel="nofollow noopener" target="_blank">Inno Setup</a></li>
<li>Orca

<ul>
<li>MS謹製のMSI閲覧、更新用ツール</li>
<li>Windows SDKの中にあるが、標準ではインストールされず、中にOrca.msiが含まれているので、これをインストールする</li>
</ul>
</li>
<li>
<a href="https://github.com/activescott/lessmsi" rel="nofollow noopener" target="_blank">lessmsi</a>

<ul>
<li>MSIの中身の展開や、プロパティの閲覧等をコマンドラインから行える</li>
<li>orcaの起動が面倒なときなどに有用</li>
</ul>
</li>
</ul>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Fskitoy4321%2Fitems%2F111ca55899473b9c2df4&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Fskitoy4321%2Fitems%2F111ca55899473b9c2df4&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/skitoy4321/items/111ca55899473b9c2df4/likers" class="css-1iupg5d">4</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">7</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/111ca55899473b9c2df4/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/skitoy4321/items/111ca55899473b9c2df4/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/skitoy4321/items/111ca55899473b9c2df4/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/skitoy4321/items/111ca55899473b9c2df4/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/skitoy4321/items/111ca55899473b9c2df4.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-2fc38c3b-00aa-49e2-b37a-60c57c665169">{"authorAnalyticsTrackingId":null,"organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-f1b96000-ed58-419b-842c-3ed68c7a3a86"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-f1b96000-ed58-419b-842c-3ed68c7a3a86">{}</script>
      
<div id="LoginModal-react-component-8ac6199e-d78c-4769-bdb2-44e52fc13ff4"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-8ac6199e-d78c-4769-bdb2-44e52fc13ff4">{}</script>
      
<div id="StockModal-react-component-4b7af239-6be7-423e-8c17-a89634645693"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-4b7af239-6be7-423e-8c17-a89634645693">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;BNYe5PSv5REOswwQiVnNbhwz+jdLZwzU08nDovg0xsgl3MIA/oYI8oL3GLx7HT4N6ahcoQsNGHnc1dw75wpJGw==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\n\u003ch1\u003e\n\u003cspan id=\"はじめに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eはじめに\u003c/h1\u003e\n\n\u003cp\u003eWindows向けインストーラーの形式として、MSIというものが存在する。\u003cbr\u003e\nインストーラー作成ツールとしてメジャーなものには、VSのインストールプロジェクト、あるいはInstallShieldなどがあるが、\u003cbr\u003e\nこのMSIを基盤としている(\u003ca href=\"https://nsis.sourceforge.io/Main_Page\" rel=\"nofollow noopener\" target=\"_blank\"\u003eNSIS\u003c/a\u003eや\u003ca href=\"https://jrsoftware.org/isinfo.php\" rel=\"nofollow noopener\" target=\"_blank\"\u003eInno Setup\u003c/a\u003eは別の仕組み)。\u003c/p\u003e\n\n\u003cp\u003eこのMSIを作るための手法として、\u003ca href=\"http://wixtoolset.org/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eWix Toolset\u003c/a\u003eというものが存在する。\u003cbr\u003e\nXMLで宣言的にコンポーネント等を設定して、MSIを作るというものだ。\u003c/p\u003e\n\n\u003cp\u003eしかしこのwix、再利用がしにくい部分がある、記述が冗長になりやすい、補完が難しい等、作りこんでいくと多少苦しくなる時がある。\u003cbr\u003e\nそのようなwixをC#で記述することによって、IDE(vsやvscode)の補完や、処理の再利用などをしやすくした \u003ca href=\"https://github.com/oleg-shilo/wixsharp\" rel=\"nofollow noopener\" target=\"_blank\"\u003eWixSharp\u003c/a\u003e なるものが存在する。\u003c/p\u003e\n\n\u003cp\u003e今回は、そのWixSharpをvscodeで記述するための最初のステップや、注意するべき点について記述したいと思う。\u003c/p\u003e\n\n\u003cp\u003eなお、WixSharpを使うに当たりMSIとWixの関連領域に踏み込むことは不可避なので、これらも並行して学んでいくと良いと思う。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"wixsharpとは\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#wixsharp%E3%81%A8%E3%81%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eWixSharpとは\u003c/h1\u003e\n\n\u003cp\u003eWixSharpとは、C#でMSIパッケージの生成をできるようにしたライブラリで、ほとんどの機能はWixのラッパーとなる。\u003cbr\u003e\nまた、Wixに備わっているDTF(Deployment Tool Foundation)を利用することによって、winformsやWPFでのUI記述や、.NETによるカスタムアクションの定義等を容易に行う事が可能になる。\u003cbr\u003e\nもともとCS-Scriptという、Roslyn以前にC#をスクリプトで使おうというプロジェクトの一つの活用事例として作られたものであるが、実際はCS-Scriptなしでも単体のライブラリとして存在している。\u003c/p\u003e\n\n\u003cp\u003e今回は執筆時点での最新版である1.15.0をベースに書いていく。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"前提条件\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%89%8D%E6%8F%90%E6%9D%A1%E4%BB%B6\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e前提条件\u003c/h1\u003e\n\n\u003cp\u003e本記事の中で必要なものは以下の通り\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eWindowsマシン\n\n\u003cul\u003e\n\u003cli\u003eそもそもMSIがWindows専用の機構であるため\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e.NET Framework SDK\n\n\u003cul\u003e\n\u003cli\u003eWixSharpは.NET Framework用のライブラリしか提供してないため\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eWindows 10 SDK\n\n\u003cul\u003e\n\u003cli\u003eインストールコンポーネントの中の\"MSI Tools\"というものがあるので、それを有効にする\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eWix v3\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"https://wixtoolset.org/releases/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://wixtoolset.org/releases/\u003c/a\u003e より、最新安定版をDLする\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003e*-binaries.zip\u003c/code\u003eと\u003ccode\u003e*.exe\u003c/code\u003eがあるが、片方はバイナリのみ、片方はインストーラーとなり、今回はどちらでも構わない\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eVisual Studio Code + C#拡張\n\n\u003cul\u003e\n\u003cli\u003eエディタとして本記事で使う\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eVisual Studio + .NET開発 サポート\n\n\u003cul\u003e\n\u003cli\u003e同じくC#拡張のため\u003c/li\u003e\n\u003cli\u003e最低限Visual Studio Build Toolでも可\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"使用するwixの準備\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8Bwix%E3%81%AE%E6%BA%96%E5%82%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e使用するWixの準備\u003c/h1\u003e\n\n\u003cp\u003eWixSharpはその性質上、Wixの実行バイナリ(candle.exe等)がどうしても必要になる。そのため、Wixの実行バイナリがあるフォルダがどこにあるかを知る必要がある。\u003cbr\u003e\n定義するための手法は以下のようなものがあり、いずれも設定されたディレクトリ直下にcandle.exe等があることが期待される。\u003cbr\u003e\n上から順に優先される。\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eMSI生成時に\u003ccode\u003eWixSharp.Compiler.WixLocation\u003c/code\u003eに設定する\u003c/li\u003e\n\u003cli\u003eコマンドライン引数で\u003ccode\u003e/WIXBIN:\u003c/code\u003eをプレフィックスに持つものを探し、その後ろのパスを使用する\n\n\u003cul\u003e\n\u003cli\u003eMSBuildで使う用\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e環境変数の\u003ccode\u003eWIXSHARP_WIXDIR\u003c/code\u003eを取得\n\n\u003cul\u003e\n\u003cli\u003eエラーメッセージ等でも示されているので、環境変数で設定する場合はこの方法が一番いいかも\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e環境変数の\u003ccode\u003eWixLocation\u003c/code\u003eを取得\u003c/li\u003e\n\u003cli\u003e環境変数の\u003ccode\u003eWIX\u003c/code\u003eを取得し、その後ろに\u003ccode\u003ebin\u003c/code\u003eフォルダを追加する\n\n\u003cul\u003e\n\u003cli\u003eWIXをMSI経由でインストールした場合、環境変数\u003ccode\u003eWIX\u003c/code\u003eは自動的に設定される\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003e%ProgramFiles%\u003c/code\u003eの配下にあるWixインストールディレクトリを検索し、あればそこに\u003ccode\u003ebin\u003c/code\u003eを追加する\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003e..\\..\\Wix_bin\\bin\u003c/code\u003e、\u003ccode\u003e..\\..\\..\\..\\Wix_bin\\bin\u003c/code\u003e、\u003ccode\u003e..\\..\\..\\..\\..\\Wix_bin\\bin\u003c/code\u003eを検索し、あれば採用する\n\n\u003cul\u003e\n\u003cli\u003eサンプル用なので実際には期待しない方が良い\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eMSIからWixをインストールした場合、大抵の場合は\u003ccode\u003eWIX\u003c/code\u003e環境変数の部分で引っかかると思う\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"msi生成プロジェクトの準備\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#msi%E7%94%9F%E6%88%90%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E6%BA%96%E5%82%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eMSI生成プロジェクトの準備\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"新規プロジェクトの生成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%96%B0%E8%A6%8F%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E7%94%9F%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e新規プロジェクトの生成\u003c/h2\u003e\n\n\u003cp\u003eさて、Wix実行ファイルの場所特定ができたら、次はMSIを生成するプロジェクトの作成である。\u003cbr\u003e\nといっても、生成するのは普通のC#のコンソールプロジェクトで、\u003ccode\u003edotnet new console\u003c/code\u003e辺りで作ればいいだけである。\u003cbr\u003e\nただし、WixSharpのライブラリは.NET Framework製なので、後でTargetFrameworkを.NET Framework系のものに変えておこう(\u003ccode\u003enet461\u003c/code\u003eとか\u003ccode\u003enet35\u003c/code\u003eとか)\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"nugetパッケージの追加\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#nuget%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%81%AE%E8%BF%BD%E5%8A%A0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003enugetパッケージの追加\u003c/h2\u003e\n\n\u003cp\u003eプロジェクトの生成が完了したら、WixSharpのnugetパッケージを追加することになる。\u003cbr\u003e\nWixSharpには以下のように複数のnugetパッケージが存在するため、自分のプロジェクトに合わせて参照するものを変えること。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eWixSharp.bin\n\n\u003cul\u003e\n\u003cli\u003eライブラリ部分のパッケージ\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eWixSharp\n\n\u003cul\u003e\n\u003cli\u003eWixSharp.bin + MSBuild時に更新が入った場合、自動的にプログラムが実行されるようになる→ビルドするだけでMSIができるようになる\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eWixSharp.Lab\n\n\u003cul\u003e\n\u003cli\u003eWixSharp.binに比べて実験的な機能が含まれている\u003c/li\u003e\n\u003cli\u003eWixSharp.binと共存可\u003c/li\u003e\n\u003cli\u003e1.15.0時点では画面生成用のクラスが含まれている(WixSharp.Controls)\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"実装\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%9F%E8%A3%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e実装\u003c/h1\u003e\n\n\u003cp\u003eプロジェクトの準備ができたら、ソースを編集していく。\u003cbr\u003e\nおおまかには以下のような流れとなる\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e\n\u003ccode\u003eWixSharp.Project\u003c/code\u003eインスタンスの生成\u003c/li\u003e\n\u003cli\u003eProductCode、UpgradeCode、言語設定等の主要属性の設定\u003c/li\u003e\n\u003cli\u003e以下を再帰的に行う\n\n\u003col\u003e\n\u003cli\u003e\n\u003ccode\u003eWixSharp.Dir\u003c/code\u003eの生成\n\n\u003cul\u003e\n\u003cli\u003eインストールルート以外は、全てディレクトリ単体の名前を指定する\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e生成したディレクトリ内に\u003ccode\u003eWixSharp.File\u003c/code\u003eオブジェクト等をnewして追加\n\n\u003cul\u003e\n\u003cli\u003eファイルの他、レジストリやサービス登録等もここで追加する\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e内部に更にディレクトリがある場合、\u003ccode\u003eWixSharp.Dir\u003c/code\u003eを生成して繰り返す\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/li\u003e\n\u003cli\u003eカスタムアクションがあればそれを定義して、Projectインスタンスに追加する\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eこの他にも、MSIのネイティブUIを定義できたり、Windows FormsやWPFを使って画面を作成することもできるが、長くなるのでこの記事では取り上げない。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"主に決めるべき主要属性\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%B8%BB%E3%81%AB%E6%B1%BA%E3%82%81%E3%82%8B%E3%81%B9%E3%81%8D%E4%B8%BB%E8%A6%81%E5%B1%9E%E6%80%A7\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e主に決めるべき主要属性\u003c/h2\u003e\n\n\u003cp\u003ewixsharpでは、wixに関するプロパティが細かい所まで設定できるが、その中でも最初に考慮した方が良いものを挙げていく。\u003cbr\u003e\n下で紹介されている他にも、成果物出力先決定などに使われるOutDir等の設定があるが、あまり重要ではないため省略する。\u003cbr\u003e\n全て見たい場合は、\u003ca href=\"https://github.com/oleg-shilo/wixsharp/blob/v1.15.0.0/Source/src/WixSharp/Project.cs\" rel=\"nofollow noopener\" target=\"_blank\"\u003eWixSharpのコードを見ること\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"upgradecode\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#upgradecode\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eUpgradeCode\u003c/h3\u003e\n\n\u003cp\u003eMSIでいう所の \u003ca href=\"https://docs.microsoft.com/en-us/windows/win32/msi/upgradecode\" rel=\"nofollow noopener\" target=\"_blank\"\u003eUpgradeCodeプロパティ\u003c/a\u003eを設定する。\u003cbr\u003e\n\u003cstrong\u003eよほどのことが無い限り、MSIのUpgradeCodeは変わらないはずなので、とりあえず設定しておく方がいい。\u003c/strong\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"productcode\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#productcode\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eProductCode\u003c/h3\u003e\n\n\u003cp\u003eMSIでいう所の \u003ca href=\"https://docs.microsoft.com/en-us/windows/win32/msi/productcode\" rel=\"nofollow noopener\" target=\"_blank\"\u003eProductCodeプロパティ\u003c/a\u003e を設定する。\u003cbr\u003e\nProductCodeプロパティはメジャー/マイナーアップグレードの主要な判断材料となるため、よく考えて設定する、しないを決定すること。\u003cbr\u003e\nまた、WixSharpにおいては、\u003cstrong\u003e各コンポーネント(ファイル等)のGUIDはProductCodeを基点に一意に決定されるため、値の取り扱いについては十分注意すること\u003c/strong\u003e。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"guid\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#guid\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eGUID\u003c/h3\u003e\n\n\u003cp\u003eこれはWixSharp独自のプロパティで、設定すると後述するProductCodeやUpgradeCodeが手動設定されていない場合の基点となる。\u003cbr\u003e\nWixSharpがUpgradeCode、ProductCodeがどのように決定するかは以下の図を参照。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/528d173861b5be61b841f954e7aa39ad56468fc5/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3130333235332f63636430643533322d333133652d653363322d656233322d3962653939393735396639322e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F103253%2Fccd0d532-313e-e3c2-eb32-9be999759f92.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=7a144bf8641c72e513032a01843fedab\" alt=\"UpgradeCode決定手順\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/103253/ccd0d532-313e-e3c2-eb32-9be999759f92.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F103253%2Fccd0d532-313e-e3c2-eb32-9be999759f92.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=2293ca0a6023f763abda4c79d5529629 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/9d52f2ab9e6346cd6ad2b524ecfb41df5709cc49/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3130333235332f65663736313339372d616331622d376563332d643363372d6536376232626263343639322e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F103253%2Fef761397-ac1b-7ec3-d3c7-e67b2bbc4692.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=5fff0ff4d933657723716f25a8524f24\" alt=\"ProductCodeの決定の仕方\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/103253/ef761397-ac1b-7ec3-d3c7-e67b2bbc4692.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F103253%2Fef761397-ac1b-7ec3-d3c7-e67b2bbc4692.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=f69db94d87dcbb64fd72cfe16bc50e0b 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"majorupgrade\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#majorupgrade\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eMajorUpgrade\u003c/h3\u003e\n\n\u003cp\u003eメジャーアップグレードで、ダウングレードを許すか、どのタイミングで既存プロダクトの削除を行うかを設定する。\u003cbr\u003e\nメジャーアップグレードをしたいならば必ず設定しておくこと。\u003cbr\u003e\nそれぞれのフィールドの意味は以下で、\u003ca href=\"https://wixtoolset.org/documentation/manual/v3/xsd/wix/majorupgrade.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eWixのMajorUpgradeエレメントに対応する\u003c/a\u003e\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003ebool? AllowDowngrades\u003c/code\u003e(default=false)\n\n\u003cul\u003e\n\u003cli\u003e古いバージョンへのダウングレードを検知したとき、インストールをブロックするかどうか\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003ebool? AllowSameVersionUpgrades\u003c/code\u003e(default=true)\n\n\u003cul\u003e\n\u003cli\u003eバージョン番号が同じ場合でも、メジャーアップグレードを許可するか\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003ebool? Disallow\u003c/code\u003e(default=false)\n\n\u003cul\u003e\n\u003cli\u003eメジャーアップグレードを禁止する\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003estring DisallowUpgradeErrorMessage\u003c/code\u003e\n\n\u003cul\u003e\n\u003cli\u003eメジャーアップグレードを検知したときに、エラー画面とともに表示されるメッセージ\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003ebool? IgnoreRemoveFailure\u003c/code\u003e(default=false)\n\n\u003cul\u003e\n\u003cli\u003eメジャーアップグレードの時にアンインストールを実行して失敗したとき、アップグレードを続行するかどうか\u003c/li\u003e\n\u003cli\u003e続行したときに何が起こるかは個別の事情が絡むため網羅的にいいにくいので、実際どうなるかを確かめてから設定すること\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003ebool? MigrateFeatures\u003c/code\u003e(default=true)\n\n\u003cul\u003e\n\u003cli\u003eFeaturesを継承するかどうか\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003estring RemoveFeatures\u003c/code\u003e\n\n\u003cul\u003e\n\u003cli\u003e指定したFeatureがインストールされている時、それらを再インストールしない\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eWixSharp.UpgradeSchedule? Schedule\u003c/code\u003e(default=afterInstallValidate)\n\n\u003cul\u003e\n\u003cli\u003eメジャーアップグレードの中で、アンインストールをどのタイミングで行うか設定する\u003c/li\u003e\n\u003cli\u003e大体はデフォルトのままで問題ないが、\u003cstrong\u003eアップグレードが途中で失敗して中断した場合、元バージョンもろとも消え去ってしまう\u003c/strong\u003eため、可能性がある場合は注意すること\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"majorupgradestrategy\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#majorupgradestrategy\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eMajorUpgradeStrategy\u003c/h3\u003e\n\n\u003cp\u003eメジャーアップグレードをどのバージョンからどのバージョンまでで有効にするか等を決定する。\u003cbr\u003e\n\u003ca href=\"https://wixtoolset.org/documentation/manual/v3/xsd/wix/upgrade.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eWixでいう所の、Upgradeエレメントに対応する\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"version\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#version\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eVersion\u003c/h3\u003e\n\n\u003cp\u003eここでバージョンを設定すると、ProductVersionプロパティが設定され、作成するMSIパッケージのバージョンになる。\u003cbr\u003e\nただし、MSIのルールとして、\u003ccode\u003e[major].[minor].[build]\u003c/code\u003e(各構成要素は全て整数)のように形式が決まっているので注意。\u003cbr\u003e\n詳しくは \u003ca href=\"https://docs.microsoft.com/en-us/windows/win32/msi/productversion\" rel=\"nofollow noopener\" target=\"_blank\"\u003eMSIのドキュメントを参照\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://docs.microsoft.com/en-us/windows/win32/msi/major-upgrades\" rel=\"nofollow noopener\" target=\"_blank\"\u003eMSIにおいてバージョン番号は、メジャー/マイナー/スモールアップデートに関わる所なので気を付けること。\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"ui\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#ui\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eUI\u003c/h3\u003e\n\n\u003cp\u003eWixが標準で用意しているUIのどれを使うかを選択する。使えるのは以下で、\u003ccode\u003eWixSharp.WUI\u003c/code\u003eというenumクラスの値を指定する。\u003cbr\u003e\nここで設定すると、\u003ccode\u003eUIRef\u003c/code\u003eにIDを指定したものが追加される。\u003cbr\u003e\nそれぞれのダイアログの解説については、Wixのものをそのまま使っているだけなので、\u003ca href=\"https://wixtoolset.org//documentation/manual/v3/wixui/wixui_dialog_library.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003ewixtoolsetのWixUIダイアログの解説\u003c/a\u003eを参照。\u003c/p\u003e\n\n\u003cp\u003eここではテンプレートから選ぶような感じになるが、アプリ独自要素(シリアルとか)をインストールUIで設定させたい場合もあるだろう。そのような時はカスタムダイアログを作ることになると思うが、これが書くとまた長いので、\u003ca href=\"https://github.com/oleg-shilo/wixsharp/tree/master/Source/src/WixSharp.Samples/Wix%23%20Samples/Custom_UI\" rel=\"nofollow noopener\" target=\"_blank\"\u003e公式のサンプルソースへのリンクを紹介するだけに留めたい\u003c/a\u003e。サンプルでは、WinFormsやWPFのダイアログをUIシーケンスの中に挟み込んでいる。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"properties\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#properties\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eProperties\u003c/h3\u003e\n\n\u003cp\u003eMSIのユーザー定義プロパティを追加する。\u003cbr\u003e\n\u003ccode\u003eAddProperties\u003c/code\u003eメソッドで追加が可能。\u003cbr\u003e\nなお、\u003cstrong\u003eここで定義できる値は、全てインストール実行前に値が決定されるもの\u003c/strong\u003eとなることに注意。\u003cbr\u003e\n具体的に言うと、例えばあるプロパティの値に\u003ccode\u003e[PROPERTY_A]\\ABC\u003c/code\u003eのような、他のプロパティに依存した値を付けても、実際に使う時にはプロパティ指定部分が空になったり、意図した値が反映されない場合がある(インストールディレクトリの指定等)。\u003cbr\u003e\nそのような場合は、後述するカスタムアクションの一種である\u003ccode\u003eWixSharp.SetPropertyAction\u003c/code\u003eを使用する必要がある。このアクションを使う時も、アクションの実行順に注意しないと、意図した結果にならない場合があることに注意。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"sourcebasedir\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#sourcebasedir\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eSourceBaseDir\u003c/h3\u003e\n\n\u003cp\u003eファイル等のコンポーネントを指定する際、ソースに相対パスを指定した時の基点となるフォルダを指定する。\u003cbr\u003e\n設定しないときは、カレントディレクトリが使われる。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"コンポーネントの追加\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B3%E3%83%B3%E3%83%9D%E3%83%BC%E3%83%8D%E3%83%B3%E3%83%88%E3%81%AE%E8%BF%BD%E5%8A%A0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eコンポーネントの追加\u003c/h2\u003e\n\n\u003cp\u003eプロジェクトの属性が決まったら、各種コンポーネント(ファイル、レジストリ等)を追加していく。\u003cbr\u003e\n基本的にインストールルートとなる\u003ccode\u003eWixSharp.Dir\u003c/code\u003eを作成し、そこにどんどんコンポーネントや配下のフォルダを作成していく形になる。\u003cbr\u003e\n作成の時はLinq to XMLのように、コンストラクタで追加していってもいいし、インスタンスを作成した後追加していってもいい。\u003c/p\u003e\n\n\u003cp\u003eソースでいうと\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// `WixSharp.Project`に対する便利拡張メソッドを使用するため\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// using WixSharp.CommonTasks;\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eproject\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eWixSharp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eProject\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"ProjectName\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#region \"projectオブジェクトへのプロパティ設定等\"\n#endregion\n\u003c/span\u003e\u003cspan class=\"c1\"\u003e// コンストラクタ時に追加\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003edir\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eDir\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eWixSharp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eId\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"DirID\"\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"s\"\u003e\"%ProgramFiles%Hoge\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \n    \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eWixSharp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFile\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eWixSharp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eId\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"File1\"\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"s\"\u003e\"path/to/source1\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 後から追加\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// ここで設定するIdはWixSharp上のIDで、MSIのコンポーネントに設定するGUIDのIDは別途設定されることに注意\u003c/span\u003e\n\u003cspan class=\"n\"\u003edir\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eWixSharp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFile\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eWixSharp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eId\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"File2\"\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"s\"\u003e\"path/to/source2\"\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// プロジェクトインスタンスに追加\u003c/span\u003e\n\u003cspan class=\"n\"\u003eproject\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edir\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eのような感じになる。レジストリを追加するときは、\u003ccode\u003eWixSharp.File\u003c/code\u003eの代わりに\u003ccode\u003eWixSharp.RegKey\u003c/code\u003eを使う。\u003cbr\u003e\nなお、インストールはしないが、カスタムアクションなどで使用するファイルがある場合は、\u003ccode\u003eWixSharp.Binary\u003c/code\u003eを使って追加する。これはDirに所属している必要は無い。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"feature\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#feature\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eFeature\u003c/h3\u003e\n\n\u003cp\u003e例えばWindows SDKをインストールする時、インストールするコンポーネントを選択する画面が出てくると思うが、\u003cbr\u003e\nあれを実現しているのがFeatureという機能となる。\u003cbr\u003e\n特に指定しない限り、WixSharpは全てのコンポーネントを同じFeatureに属するものとして処理するが、\u003cbr\u003e\n例えばインストール時にコンポーネントを選択させたい場合は、このFeatureを使うことになる。\u003cbr\u003e\n基本的には、\u003ccode\u003eWixSharp.Feature\u003c/code\u003eオブジェクトを最初に生成しておき、各\u003ccode\u003eWixSharp.File\u003c/code\u003e等のコンポーネントを生成する時、\u003ccode\u003eFeature\u003c/code\u003eフィールドがあると思うので、そこに設定すればいい。\u003cbr\u003e\nサンプルコードは\u003ca href=\"https://github.com/oleg-shilo/wixsharp/blob/master/Source/src/WixSharp.Samples/Wix%23%20Samples/Features/setup.cs\" rel=\"nofollow noopener\" target=\"_blank\"\u003eWixSharpのリポジトリにあるので\u003c/a\u003e、そこを参照すること\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"カスタムアクションの追加\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%A0%E3%82%A2%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E8%BF%BD%E5%8A%A0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eカスタムアクションの追加\u003c/h2\u003e\n\n\u003cp\u003eコンポーネントが追加し終わったら、カスタムアクションを追加していく。\u003cbr\u003e\nカスタムアクションは全て\u003ccode\u003eWixSharp.Action\u003c/code\u003eから派生しており、共通属性として以下のものを持つ\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003estring Name\u003c/code\u003e\n\n\u003cul\u003e\n\u003cli\u003eカスタムアクションの名前\u003c/li\u003e\n\u003cli\u003e他から参照する時に使われるので、少なくともプロジェクトの中ではユニークであること\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eWixSharp.Conditon Condition\u003c/code\u003e\n\n\u003cul\u003e\n\u003cli\u003eカスタムアクションを実行するかしないか\u003c/li\u003e\n\u003cli\u003e文法は \u003ca href=\"https://docs.microsoft.com/en-us/windows/win32/msi/conditional-statement-syntax\" rel=\"nofollow noopener\" target=\"_blank\"\u003eMSIのもの\u003c/a\u003e がそのまま使えるが、代表的なものは、\u003ccode\u003eWixSharp.Condition\u003c/code\u003eの静的フィールドとして定義されている\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eWixSharp.Execute Execute\u003c/code\u003e\n\n\u003cul\u003e\n\u003cli\u003eカスタムアクション実行のコンテキストを指定する(MSI由来)\u003c/li\u003e\n\u003cli\u003e各設定の詳細は\u003ca href=\"https://wixtoolset.org/documentation/manual/v3/xsd/wix/customaction.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eWix公式ドキュメント\u003c/a\u003eにある\u003c/li\u003e\n\u003cli\u003eだいたい\"immediate\"か\"deferred\"で、デフォルトは\"immediate\"\u003c/li\u003e\n\u003cli\u003eなんでこんな設定があるかという事については書くと長いので、\u003ca href=\"https://docs.microsoft.com/en-us/windows/win32/msi/deferred-execution-custom-actions\" rel=\"nofollow noopener\" target=\"_blank\"\u003eMSI公式ドキュメント\u003c/a\u003eを参照\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://docs.microsoft.com/en-us/windows/win32/msi/obtaining-context-information-for-deferred-execution-custom-actions\" rel=\"nofollow noopener\" target=\"_blank\"\u003edeferredアクションにした場合、一部のAPIについて制約が付くことに注意(特にプロパティ周り)\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003ebool? Impersonate\u003c/code\u003e\n\n\u003cul\u003e\n\u003cli\u003eユーザー権限(UAC無し)で実行するか(=true)、システム権限(UAC有)で実行するか(=false)で、デフォルトはtrue\u003c/li\u003e\n\u003cli\u003efalseで実行したいときは、更にExecuteを\"deferred\"にする必要がある\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eWixSharp.Return Return\u003c/code\u003e\n\n\u003cul\u003e\n\u003cli\u003eカスタムアクションの実行結果をどう処理するか(戻り値が0かどうかで成功/失敗を判断)\u003c/li\u003e\n\u003cli\u003e通常は\u003ccode\u003echeck\u003c/code\u003e(デフォルト)か\u003ccode\u003eignore\u003c/code\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eWixSharp.Sequence\u003c/code\u003e\n\n\u003cul\u003e\n\u003cli\u003eインストールシーケンスのうち、どのシーケンスに所属するかを指定する\u003c/li\u003e\n\u003cli\u003e大体\u003ccode\u003eInstallExecuteSequence\u003c/code\u003e(インストール開始後)か、\u003ccode\u003eInstallUISequence\u003c/code\u003e(MSIのUI画面)になる\u003c/li\u003e\n\u003cli\u003e代表的なものは\u003ccode\u003eWixSharp.Sequence\u003c/code\u003eに静的フィールドとして存在する\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eWixSharp.Step\u003c/code\u003e、\u003ccode\u003eWixSharp.When\u003c/code\u003e\n\n\u003cul\u003e\n\u003cli\u003eカスタムアクションをどの時点(Step)の前後どちらで(When)実行するかを指定する(相対指定)\u003c/li\u003e\n\u003cli\u003e代表的なものは\u003ccode\u003eWixSharp.Step\u003c/code\u003eに静的フィールドが存在するが、自分のカスタムアクションのIDを指定することも可\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eWixSharp.SequenceNumber\u003c/code\u003e\n\n\u003cul\u003e\n\u003cli\u003e相対指定ではなく、絶対的な数値の順番で指定する\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eStep\u003c/code\u003e、\u003ccode\u003eWhen\u003c/code\u003e設定とは排他\u003c/li\u003e\n\u003cli\u003e何を指定すべきかは、MSIの仕組みを知っていないと厳しいため、上級者向け\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eカスタムアクションの種類は、WixSharpにおいては以下のものが公式として存在する。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eBinaryFileAction\n\n\u003cul\u003e\n\u003cli\u003eMSIに組み込んだ\"Binary\"ファイルを取り出して、実行可能ファイルとして実行する\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eManagedAction\n\n\u003cul\u003e\n\u003cli\u003eDTF(Deployment Tools Foundation)というwix提供の機能を利用して、C#の静的メソッドをカスタムアクションとして実行する\u003c/li\u003e\n\u003cli\u003e作り方は後述\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eElevatedManagedAction\n\n\u003cul\u003e\n\u003cli\u003e上記ManagedActionを管理者権限で実行する\u003c/li\u003e\n\u003cli\u003e実際は、上記ManagedActionに\u003ccode\u003eexecute=deferred\u003c/code\u003eと\u003ccode\u003eimpersonate=no\u003c/code\u003eが設定されたものになる\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eInstalledFileAction\n\n\u003cul\u003e\n\u003cli\u003eインストールする(されているファイル)を、IDをキーにして実行する\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003ePathFileAction\n\n\u003cul\u003e\n\u003cli\u003eシステムに存在するEXEを指定して実行する\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eSetPropertyAction\n\n\u003cul\u003e\n\u003cli\u003e\n\u003cstrong\u003eインストーラー実行時\u003c/strong\u003eにプロパティを設定する\u003c/li\u003e\n\u003cli\u003eインストール中に値が変わるプロパティを基に更に他のプロパティを設定したい場合に使う\u003c/li\u003e\n\u003cli\u003eカスタムアクション実行時点のプロパティ値を使用するため、実行順に注意すること\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e他にWixとしては、ネイティブDLLの中の関数を実行するということも可能だが、WixSharpではデフォルトでやり方が用意されているわけではない。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"managedactionの作り方\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#managedaction%E3%81%AE%E4%BD%9C%E3%82%8A%E6%96%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eManagedActionの作り方\u003c/h3\u003e\n\n\u003cp\u003eC#でManagedActionを使う場合、いくつかの手順を踏む必要がある。\u003cbr\u003e\nまず最初に、Microsoft.Deployment.WindowsInstaller.dllを、カスタムアクションを仕込むプロジェクトへ参照追加する必要がある。\u003cbr\u003e\nカスタムアクションを入れるプロジェクトは、現在wixsharpを使用しているプロジェクトでもいいし、また別途プロジェクトを用意しても構わない。\u003cbr\u003e\nこれは、Wixをインストールするか、zipアーカイブを展開すると、candle.exe等があるフォルダに同梱されている。\u003cbr\u003e\nこれを直接Reference等で参照する。\u003c/p\u003e\n\n\u003cp\u003e次に、実行するメソッドを定義するわけだが、\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e所属するクラスがpublic\u003c/li\u003e\n\u003cli\u003e型が\u003ccode\u003epublic static ActionResult [メソッド名](Microsoft.Deployment.WindowsInstaller.Session)\u003c/code\u003eであること\u003c/li\u003e\n\u003cli\u003e属性に\u003ccode\u003eMicrosoft.Deployment.WindowsInstaller.CustomAction\u003c/code\u003eがあること\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eを満たせばOK。例として下記。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eCustomAction.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eMicrosoft.Deployment.WindowsInstaller\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eCustomActions\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e// WixSharp側で参照するための名前を設定する\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e// デフォルトはメソッド名がそのまま使われる\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eCustomAction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Method1\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n  \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eActionResult\u003c/span\u003e \u003cspan class=\"nf\"\u003eMethod1\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eSession\u003c/span\u003e \u003cspan class=\"n\"\u003esession\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// 例外等エラーが起きてcatchしないと、制御が効かずにそのまま終わる可能性があるので注意\u003c/span\u003e\n    \u003cspan class=\"k\"\u003etry\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"c1\"\u003e// MSIのログに出力\u003c/span\u003e\n      \u003cspan class=\"n\"\u003esession\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"in customaction\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n      \u003cspan class=\"c1\"\u003e// MSIプロパティを設定する\u003c/span\u003e\n      \u003cspan class=\"c1\"\u003e// Execute=immediateの時に使えるが、他の場合は無視される\u003c/span\u003e\n      \u003cspan class=\"n\"\u003esession\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"A_PROPERTY\"\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"ABCDE\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"c1\"\u003e// MSIプロパティを取得する\u003c/span\u003e\n      \u003cspan class=\"c1\"\u003e// Execute=immediateの時に使えるが、他の時はnullになる\u003c/span\u003e\n      \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003epropb\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esession\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"B_PROPERTY\"\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n      \u003cspan class=\"c1\"\u003e// CustomActionDataを取得する\u003c/span\u003e\n      \u003cspan class=\"c1\"\u003e// Execute=deferredの時に、ここに値が入り、そうでないときはnull\u003c/span\u003e\n      \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ecaData\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esession\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCustomActionData\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n      \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eActionResult\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSuccess\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ecatch\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eException\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"n\"\u003esession\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"error: {0}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n      \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eActionResult\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFailure\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e上記を満たしたメソッドを用意した上で(仮に\u003ccode\u003eCustomActions.Method1\u003c/code\u003eとする)、ManagedActionを以下のように追加する。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eproject\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAddAction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eWixSharp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eManagedAction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Method1\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// カスタムアクションメソッドが入っているアセンブリを指定する\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// %this%は、このプロジェクトのアセンブリを意味する特別な文字列(デフォルトは%this%)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eActionAssembly\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"%this%\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eCondition\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eCondition\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNOT_Installed\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eExecute\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eExecute\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eimmediate\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eImpersonate\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// ActionAssemblyに、DTFとシステムアセンブリ以外の依存がある場合、ここにもれなく記述する\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eRefAssemblies\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e[],\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eReturn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eReturn\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003echeck\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eStep\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eStep\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAppSearch\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// Execute=deferredの時、ここにプロパティ名をカンマ区切りで入れる必要がある\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// こうすると、CustomActionDataに\"A_PROPERTY=[A_PROPERTYの値];B_PROPERTY=[B_PROPERTYの値]\"のように、値が格納される\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eUsesProperties\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"A_PROPERTY,B_PROPERTY\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e注意点として、\u003cstrong\u003eManagedActionを使用すると、その時点でMSIのインストールに.NET Framework依存ができてしまうため、ManagedActionが使用しているフレームワークバージョンは確実に満たせるように、開発要件を定めておくこと\u003c/strong\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"msiの生成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#msi%E3%81%AE%E7%94%9F%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eMSIの生成\u003c/h2\u003e\n\n\u003cp\u003eさて、全てのプロジェクト設定が終わったら、最後に\u003ccode\u003eWixSharp.Project.BuildMsi(string path = null)\u003c/code\u003eを実行する。\u003cbr\u003e\n出力されるMSIファイルは、指定が無ければカレントディレクトリの\"[プロダクト名].msi\"という名前で出力される。\u003cbr\u003e\nまた、同時に生成されたwxsファイルが、\"wix/[プロジェクト名].g.wxs\"として出力される。\u003cbr\u003e\nこちらは、生成結果の確認等に使うと良いだろう。\u003c/p\u003e\n\n\u003cp\u003eまた、MSIを作らずにwxsの確認だけ行いたい場合は、\u003ccode\u003eWixSharp.Project.BuildWxs(string path = null)\u003c/code\u003eを実行する。\u003cbr\u003e\nこちらはWixのツールを実行しないので、BuildMsiでエラーが出た時にwxsの中身を確認したい場合に使うと良いと思う。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"終わりに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%B5%82%E3%82%8F%E3%82%8A%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e終わりに\u003c/h1\u003e\n\n\u003cp\u003eここまでWixSharpの入り口として記事を書いたが、MSIネイティブやWindows Formsを画面に使えたり、あるいはMSIを実行するためのブートストラッパーの作成ができるなど、ここでは紹介していない機能が色々あるので、機会があればまたその辺りの記事を書いてみたい。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"参考リンク\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8F%82%E8%80%83%E3%83%AA%E3%83%B3%E3%82%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e参考リンク\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/oleg-shilo/wixsharp/tree/v1.15.0.0/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eWixSharpのソース\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/oleg-shilo/wixsharp/tree/v1.15.0.0/Source/src/WixSharp.Samples\" rel=\"nofollow noopener\" target=\"_blank\"\u003eWixSharpのサンプルソース集\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://docs.microsoft.com/en-us/windows/win32/msi/major-upgrades\" rel=\"nofollow noopener\" target=\"_blank\"\u003eMSIのメジャーアップグレードについて\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://docs.microsoft.com/ja-jp/windows/msix/overview\" rel=\"nofollow noopener\" target=\"_blank\"\u003eMSIX\u003c/a\u003e\n\n\u003cul\u003e\n\u003cli\u003e次世代Windowsパッケージシステム\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://www.firegiant.com/products/wix-expansion-pack/msix/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eWixでも有料サポートで作成は可能\u003c/a\u003eだが、WixSharpでは使えない\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://wixtoolset.org/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eWix Toolsetのサイト\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://wixtoolset.org/documentation/manual/v3/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eWixのリファレンス(v3)\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://nsis.sourceforge.io/Main_Page\" rel=\"nofollow noopener\" target=\"_blank\"\u003eNSIS\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://jrsoftware.org/isinfo.php\" rel=\"nofollow noopener\" target=\"_blank\"\u003eInno Setup\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003eOrca\n\n\u003cul\u003e\n\u003cli\u003eMS謹製のMSI閲覧、更新用ツール\u003c/li\u003e\n\u003cli\u003eWindows SDKの中にあるが、標準ではインストールされず、中にOrca.msiが含まれているので、これをインストールする\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://github.com/activescott/lessmsi\" rel=\"nofollow noopener\" target=\"_blank\"\u003elessmsi\u003c/a\u003e\n\n\u003cul\u003e\n\u003cli\u003eMSIの中身の展開や、プロパティの閲覧等をコマンドラインから行える\u003c/li\u003e\n\u003cli\u003eorcaの起動が面倒なときなどに有用\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","createdAt":"2021-01-20T12:44:44Z","elapsedYearsFromLastModifiedAt":0,"encryptedId":"wgho0NK+miAyT7fpCRpWaRkP9cHegJZp2Q==--5X/YIkevkT90l064--6URG7JolyAan0nHipdWMyA==","isBanned":false,"isDeprecated":false,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2021-01-20T12:49:53Z","likesCount":4,"linkUrl":"https://qiita.com/skitoy4321/items/111ca55899473b9c2df4","organization":null,"originalId":1380264,"stockedCount":7,"title":"wixsharpでインストーラーを作る","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003eはじめに\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#wixsharp%E3%81%A8%E3%81%AF\"\u003eWixSharpとは\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%89%8D%E6%8F%90%E6%9D%A1%E4%BB%B6\"\u003e前提条件\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8Bwix%E3%81%AE%E6%BA%96%E5%82%99\"\u003e使用するWixの準備\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#msi%E7%94%9F%E6%88%90%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E6%BA%96%E5%82%99\"\u003eMSI生成プロジェクトの準備\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%96%B0%E8%A6%8F%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E7%94%9F%E6%88%90\"\u003e新規プロジェクトの生成\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#nuget%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%81%AE%E8%BF%BD%E5%8A%A0\"\u003enugetパッケージの追加\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%AE%9F%E8%A3%85\"\u003e実装\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%B8%BB%E3%81%AB%E6%B1%BA%E3%82%81%E3%82%8B%E3%81%B9%E3%81%8D%E4%B8%BB%E8%A6%81%E5%B1%9E%E6%80%A7\"\u003e主に決めるべき主要属性\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#upgradecode\"\u003eUpgradeCode\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#productcode\"\u003eProductCode\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#guid\"\u003eGUID\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#majorupgrade\"\u003eMajorUpgrade\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#majorupgradestrategy\"\u003eMajorUpgradeStrategy\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#version\"\u003eVersion\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#ui\"\u003eUI\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#properties\"\u003eProperties\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#sourcebasedir\"\u003eSourceBaseDir\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B3%E3%83%B3%E3%83%9D%E3%83%BC%E3%83%8D%E3%83%B3%E3%83%88%E3%81%AE%E8%BF%BD%E5%8A%A0\"\u003eコンポーネントの追加\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#feature\"\u003eFeature\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%A0%E3%82%A2%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E8%BF%BD%E5%8A%A0\"\u003eカスタムアクションの追加\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#managedaction%E3%81%AE%E4%BD%9C%E3%82%8A%E6%96%B9\"\u003eManagedActionの作り方\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#msi%E3%81%AE%E7%94%9F%E6%88%90\"\u003eMSIの生成\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%B5%82%E3%82%8F%E3%82%8A%E3%81%AB\"\u003e終わりに\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%8F%82%E8%80%83%E3%83%AA%E3%83%B3%E3%82%AF\"\u003e参考リンク\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":1040,"uuid":"111ca55899473b9c2df4","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"2oGxn0k+tFAiMU2OrVLWim+ptgiI--cq7OqFSMz8BeyMS6--bzaX4P5AqrzD8oyTBaKg9A==","originalId":103253,"description":"","facebookUrl":null,"githubUrl":null,"isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"","profileImageUrl":"https://qiita-image-store.s3.amazonaws.com/0/103253/profile-images/1526359222","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F103253%2Fprofile-images%2F1526359222?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=a7dce827dc16582e1b8e9c7a52216638","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F103253%2Fprofile-images%2F1526359222?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=9623ed561bd61ca207da0cb6419ba01d","urlName":"skitoy4321","websiteUrl":"","twitterUrl":"https://twitter.com/skitoy4321","twitterUrlName":"skitoy4321","revealedOrganizations":{"edges":[]}},"tags":[{"name":"C#","urlName":"csharp"},{"name":"msi","urlName":"msi"},{"name":"WiXToolset","urlName":"wixtoolset"}],"followingLikers":{"edges":[]},"comments":{"totalCount":0}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

More than 1 year has passed since last update.Prism とは Windows クライアントアプリケーション開発で使える代表的な MVVM フレームワークの１つPrismはよく使うのですが、先輩が環境構築しくれていて自分でインストールなどしたことなかったので
今回は一からインストールして環境構築してみました。ウィザードが立ち上がるのでインストールを実行VisualStudioを再起動させて新規のプロジェクトを作成検索バーでprismを調べ、Prism Blank App(WPF)を選択してプロジェクトを作成するプロジェクト起動時はxamlなどにエラーがでますがPrismをNugetから落とせていないためです。ビルド時にNugetからインポートしてくれるので、まずはデバッグ実行をしてみましょう。デフォルトで作られるMainWindow.xamlにはContentControlがあります。
アプリ起動時にこの画面が表示され、ContentRegionに他のUserControlを入れ替えることで画面遷移を実現します。これまたデフォルトで作られているApp.xaml.csには
- CreateShell
が最初から記述されています。Oninitialized()メソッドの中でRequestNavigateメソッドを呼んでいます。
第一引数でRegionName、第二引数で第一引数の場所にUserControl(.xaml)を張り付けます。RegisterTypes()メソッドでは、画面遷移させたいUserControlを登録させます。
今回はCameraScreenViewとSelectScreenのUserControlを画面遷移させたいので、RegisterForNavigationメソッドで登録します。これでアプリが起動するときに、MainWindowの空間にSelectScreen.xamlが表示される形になります。次にボタンを押したときの画面遷移についてです。
SelectScreen.xamlは次のようにします。ViewModelは以下のようにボタンを押したときの処理(NextCommand)には、コンストラクタでRegionNavigationService.RequestNavigate()を呼び、遷移したい画面(xaml)を渡してあげます。これで
1. ShellにUserControlを張り付け
2. ボタンを押したときに画面を遷移させるの2つができました。今回CameraScreenからSelectScreenに遷移したときに、SelectScreenの一部領域をHiddenからVisibleに変更したかったので、
1. CameraScreenViewModelの遷移ボタンを押下したときに、NavigationParameters.AddでkeyとValueを登録
2. RequestNavigate()の第二引数に1の値を指定
3. SelectScreenViewModelのOnNavigatedToでパラメータを受け取り、プロパティに反映させるPrismはプロジェクト作成時にViewsとViewModelを作ってくれます。
自分はViewのコードビハインドでViewModelとバインディングさせるほうが好きです。
c#
public MainWindow()
{
   Initialize();
   this.DateContect = new MainWindowViewModel(); // ViewModelをバインド
}

あとはModelは随時作成して、
ViewModelのインスタンス生成時に必要なModelのインスタンスをフィールド変数に格納して、
Commandに処理を記述する流れです。OpenCvSharpをNugetからインポートしましょう。
WPF + OpenCVSharp + Camera上記のコードをほぼ流用でカメラを起動できました。
画面遷移させるときにカメラをきちんと止めるかインスタンスを破棄しないと例外がおきるみたいです。Nextボタンを押下して、撮影画面に遷移
ボタンが増えてるのがわかります
Startを押してカメラを起動
ViewboxのImageにきちんとBitmapをバインディングできてます
Nextボタンを押下して、SelectScreenに遷移
きちんとパラメータをうけとり、非表示にしていた空間をVisiblityに変更できています
MVVM フレームワーク Prism の全体概観WPF Prism episode: 3 ～ Re: ゼロから始める Prism 生活 ～Prism-SampleResionNavigationService画面遷移時のパラメータ受け取りWPF + OpenCVSharp + Camera



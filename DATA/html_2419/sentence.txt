More than 1 year has passed since last update.ASP.NET Core 3.0 Razor Pages 事始め(8)の続きです。今回は公式チュートリアルのASP.NET Core で Razor ページに新しいフィールドを追加するに沿って進めていこうと思います。それでは、チュートリアルに沿って進めていきます。まず、Movieモデルへ評価を示すプロパティを追加します。Models/Movie.cs ファイルを開き、Rating プロパティを追加します。Index.cshtmlを開き、Rating フィールドを追加します。Create.cshtmlにも、Ratingのフィールドを追加します。同様にして、Edit.cshtml, Delete.cshtml, Details.cshtml にもRatingフィールドを追加します。ビルドして、実行してみます。しかし、Indexページを開こうとすると、以下の例外が発生してしまいます。これは、データベースのMovie テーブにRatingカラムがまだ存在しないためです。Code First Migrations を利用して、これを解決します。まず、SeedDataクラスを変更し、Ratingプロパティに値を設定するようにします。次のコマンドを実行します。最初にDBを削除します。これは、SeedDataでのデータ初期化コードを動かすためです。以下実行結果の抜粋です。正常に終了しました。なお、SQLiteの場合、EFはカラムの変更はサポートしていませんでしたが、試した範囲では、
カラムの追加は大丈夫みたいです。dropでDB削除せずに、マイグレーションを行なってみましたが、正常にコマンドが終了しました。それでは、実行してみます。うまく動作しました。新規追加、編集、詳細なども動作するかを確認します。ところで、この "R"ってなんだろう？ 調べたら、Restricted の頭文字のようです。R：17歳未満の子供は同伴する保護者または成人の保護者が必要です。ということらしいです。G, PG, PG-13, R, NC-17 があるらしいです。サンプルコードで代入されていた NAは、評価無しということかな。ここまで書いて気がついたんですが、と指定してるのに、編集ページ(Edit.cshtml)では、小数部が表示されてます。この小数部を表示しないようにするには、ApplyFormatInEditModeプロパティを使えば良いみたいです。これで以下のような表示になりました。今回はこれでおしまい。いよいよ次回がチュートリアルの最後となります。



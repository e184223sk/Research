<!DOCTYPE html><html><head><meta charset="utf-8" /><title>初心者のためのTask.Run(), async/awaitの使い方 - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/inew/items/0126270bca99883605de" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="d2qLji9XiO34QS6Hde0mOtZqyfT5NIuZJIBQ6Ul88t6f5y76iRkFhVlS00FHr/cCq/wWcoSSteIggV/A7zK9pw==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta content="@_inevv" name="twitter:creator" /><meta property="og:type" content="article"><meta property="og:title" content="初心者のためのTask.Run(), async/awaitの使い方 - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND01WWlkNWItRDZJQ0Y0NEd1NDRHZjQ0S0I0NEd1VkdGemF5NVNkVzRvS1N3Z1lYTjVibU12WVhkaGFYVGpnYTdrdmJfamdZVG1scmsmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT01NCZ0eHQtY2xpcD1lbGxpcHNpcyZ0eHQtYWxpZ249Y2VudGVyJTJDbWlkZGxlJnM9MGE5ZDZkYzE3ZTM3NmQ2ZmExMzMwNTk5MmJlMjgxYmI&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RR2x1WlhjJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NDUmdHh0LWFsaWduPXJpZ2h0JTJDYm90dG9tJnM9OGYxNGU4ODA4YjI3MmYxNDU3NDg2OTk4Mzg0OTUyNzY&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=d6ecb24684c31de648ca71430a3e9cd6"><meta property="og:description" content="

はじめに

最近、Unity/C#でもちょいちょい非同期処理を書いているんですが、なんだかんだやっぱり非同期は難しいです。  

そこで、GoogleでTaskやasync/awaitについて検索すると、「TaskをWait()す..."><meta content="https://qiita.com/inew/items/0126270bca99883605de" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#,task,Unity,非同期処理" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 1nzh4zz 38fzdi helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-1nzh4zz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:16px 32px;background-color:#FBE69E;color:rgba(0,0,0,0.87);line-height:1.5;font-weight:600;}@media (max-width:770px){.css-1nzh4zz{padding:16px;}}.css-38fzdi{color:#CA832A;margin-right:4px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-449c502d-322b-4171-9334-9097b756a457"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Finew%2Fitems%2F0126270bca99883605de">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Finew%2Fitems%2F0126270bca99883605de">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-449c502d-322b-4171-9334-9097b756a457">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2018-12-06T03:04:45.000+09:00","dateModified":"2020-05-10T01:08:26.000+09:00","headline":"初心者のためのTask.Run(), async/awaitの使い方","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND01WWlkNWItRDZJQ0Y0NEd1NDRHZjQ0S0I0NEd1VkdGemF5NVNkVzRvS1N3Z1lYTjVibU12WVhkaGFYVGpnYTdrdmJfamdZVG1scmsmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT01NCZ0eHQtY2xpcD1lbGxpcHNpcyZ0eHQtYWxpZ249Y2VudGVyJTJDbWlkZGxlJnM9MGE5ZDZkYzE3ZTM3NmQ2ZmExMzMwNTk5MmJlMjgxYmI\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RR2x1WlhjJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NDUmdHh0LWFsaWduPXJpZ2h0JTJDYm90dG9tJnM9OGYxNGU4ODA4YjI3MmYxNDU3NDg2OTk4Mzg0OTUyNzY\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=d6ecb24684c31de648ca71430a3e9cd6","mainEntityOfPage":"https://qiita.com/inew/items/0126270bca99883605de","author":{"@type":"Person","address":"","email":null,"identifier":"inew","name":"inew","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fs3-ap-northeast-1.amazonaws.com%2Fqiita-image-store%2F0%2F222054%2Faf399caf96f7a308aad9bd9323967fcee1803c2e%2Fx_large.png%3F1570011674?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=3ca9f2f752fdd1bcb294cfeec40ba838","url":"https://qiita.com/inew","description":"自動化大好きふくろう","memberOf":[]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://increments.connpass.com/event/211948/">「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催</a><a target="_blank" id="header_text_message_2" href="https://increments.connpass.com/event/211948/">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"inew","type":"items","id":"0126270bca99883605de"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"inew","type":"items","id":"0126270bca99883605de"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":0,"pos_id":"header_text_message_1","message":"「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"inew","type":"items","id":"0126270bca99883605de"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":0,"pos_id":"header_text_message_2","message":"「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/inew/items/0126270bca99883605de","location":"/inew/items/0126270bca99883605de","scheme":"https","host":"qiita.com","port":null,"pathname":"/inew/items/0126270bca99883605de","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"8dSgrB98EjZylJiFu5ciA0djuxyCgLk/p9syv0tEab0ZWQXYuTKfXtOHZUOJ1fM7OvVkmv8mh0Sj2j2W7QomxA==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-4ee7e96b-fb3f-4504-9764-808d2792cbd9"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/inew/items/0126270bca99883605de/likers" class="css-1iupg5d">142</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">147</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/0126270bca99883605de/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/inew/items/0126270bca99883605de/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/inew/items/0126270bca99883605de/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/inew/items/0126270bca99883605de/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/inew/items/0126270bca99883605de.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-1nzh4zz"><span class="fa fa-fw fa-warning css-38fzdi"></span><p>More than 1 year has passed since last update.</p></div><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/inew"><img class="css-100alwu eyfquo10" src="https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/222054/af399caf96f7a308aad9bd9323967fcee1803c2e/x_large.png?1570011674" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/inew" class="css-10ougpm">@<!-- -->inew</a><div class="css-1ay9vb9"><span><meta content="2018-12-05T18:04:45Z"/><time dateTime="2020-05-09T16:08:26Z" class="css-m19uds">updated at 2020-05-09</time></span></div></div></div></div></div><h1 class="css-cgzq40">初心者のためのTask.Run(), async/awaitの使い方</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/task" class="css-4czcte">task</a><a href="/tags/unity" class="css-4czcte">Unity</a><a href="/tags/%e9%9d%9e%e5%90%8c%e6%9c%9f%e5%87%a6%e7%90%86" class="css-4czcte">非同期処理</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div>
<h1>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h1>

<p>最近、Unity/C#でもちょいちょい非同期処理を書いているんですが、なんだかんだやっぱり非同期は難しいです。  </p>

<p>そこで、GoogleでTaskやasync/awaitについて検索すると、「TaskをWait()するのはダメ！」とか「async voidは基本的に使っちゃダメ！」といった記事はよく見かけるのですが、<b>じゃあどう書けばいいんじゃ</b>と思って探してみると、なかなか記事が見つかりません。見つかっても、「UIのクリックイベントにasync voidのメソッドを登録して...」という記事が多いです。<br>
残念ながら僕はUnityユーザなので、コードを書いてて非同期処理をしたいとき、処理のきっかけはUIのクリックイベントではない時の方が多く、あまり参考にすることができませんでした。</p>

<p>ということで、UnityでTask, async/awaitを使おうとしたときに僕が困ったことや、その結果わかってきた使い方をできるだけ具体的に書いていこうと思います。<br>
何個かブログを書くかもしれませんが、今回の主役は<code>Task.Run()</code>です。</p>

<p>なお、マサカリは大歓迎です。</p>

<h1>
<span id="関連記事" class="fragment"></span><a href="#%E9%96%A2%E9%80%A3%E8%A8%98%E4%BA%8B"><i class="fa fa-link"></i></a>関連記事</h1>

<p>この記事を読む前に、以下におすすめの記事を載せます。読んだことがない人は事前に読んでみてください。<br>
なお、今回の記事ではUniRxについては触れていきません。</p>

<p><a href="https://qiita.com/acple@github/items/8f63aacb13de9954c5da" id="reference-6b420b304d38d623fdb4">Taskを極めろ！async/await完全攻略</a></p>

<h1>
<span id="taskrun" class="fragment"></span><a href="#taskrun"><i class="fa fa-link"></i></a>Task.Run()</h1>

<p>さて、なにかとよく出てくる<code>Task.Run()</code>ですが、こいつは一体何をしてくれる関数なのでしょうか。<br>
詳しくは<a href="https://qiita.com/acple@github/items/8f63aacb13de9954c5da">この記事</a>に書いてありますが、ざっくり言ってしまうと、「<strong>同期処理（もともと非同期処理ではなかった処理）</strong>をまとめてタスクを作り、<strong>別スレッドで実行する</strong>」関数です。</p>

<p>個人的には、以下の３つの使い方を押さえておけば大体何とかなると思います。</p>

<ul>
<li>重い同期処理（返り値なし）を非同期にしたい場合</li>
<li>重い同期処理（返り値あり）を非同期にしたい場合</li>
<li>非同期で無限ループを回したい場合</li>
</ul>

<h1>
<span id="1-重い同期処理返り値なしを非同期にしたい場合" class="fragment"></span><a href="#1-%E9%87%8D%E3%81%84%E5%90%8C%E6%9C%9F%E5%87%A6%E7%90%86%E8%BF%94%E3%82%8A%E5%80%A4%E3%81%AA%E3%81%97%E3%82%92%E9%9D%9E%E5%90%8C%E6%9C%9F%E3%81%AB%E3%81%97%E3%81%9F%E3%81%84%E5%A0%B4%E5%90%88"><i class="fa fa-link"></i></a>1. 重い同期処理（返り値なし）を非同期にしたい場合</h1>

<p>まず簡単な例として、以下のような重い処理が必要になったとします。</p>

<div class="code-frame" data-lang="CS">
<div class="code-lang"><span class="bold">非同期処理が必要な重い処理（返り値なし）</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">private</span> <span class="k">void</span> <span class="nf">HeavyMethod</span><span class="p">(</span><span class="kt">string</span> <span class="n">str</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// 何か重い処理</span>
    <span class="n">Thread</span><span class="p">.</span><span class="nf">Sleep</span><span class="p">(</span><span class="m">1000</span><span class="p">);</span>

    <span class="c1">// 重い処理をした続きの処理</span>
    <span class="nf">SomethingNextMethod</span><span class="p">(</span><span class="n">str</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">private</span> <span class="k">void</span> <span class="nf">SomethingNextMethod</span><span class="p">(</span><span class="kt">string</span> <span class="n">str</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// 何か続きの処理</span>
    <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="n">str</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>よく見るサンプルコードですね。<br>
このとき、<code>HeavyMethod()</code>の中には<code>await</code>を使う処理がないものとします。</p>

<p>このままUnityのメインスレッドで、<code>HeavyMethod()</code>を呼ぶと、画面がガッと止まってしまうので、重い処理の部分を<code>Task.Run()</code>で別スレッドで処理を行ってあげる必要があります。<br>
具体的にはこうです。</p>

<div class="code-frame" data-lang="CS">
<div class="code-lang"><span class="bold">HeavyMethod()を別スレッドで走らせるメソッド</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">void</span> <span class="nf">HogeHoge</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">Task</span><span class="p">.</span><span class="nf">Run</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="nf">HeavyMethod</span><span class="p">(</span><span class="s">"hoge"</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>実をいうと個人的にはこの書き方は好きではないのですが、こうすれば<code>HogeHoge()</code>メソッドを発動することで、画面のフリーズを避けることができます。</p>

<h2>
<span id="taskrunの落とし穴" class="fragment"></span><a href="#taskrun%E3%81%AE%E8%90%BD%E3%81%A8%E3%81%97%E7%A9%B4"><i class="fa fa-link"></i></a>Task.Run()の落とし穴</h2>

<p>...が、実はこのコードには少し問題があります。<br>
それは、<code>SomethingNextMethod()</code>以降の処理が行われるスレッドに関してです。<br>
最初に言ったとおり、<code>Task.Run()</code>は引数として与えられた処理を<strong>別スレッドで</strong>実行します。つまり、本来別スレッドで行ってほしくない<code>SomethingNextMethod()</code>の処理まで別スレッドで行われてしまうということです。これはメソッドだけでなく、<code>Task.Run()</code>内で発火したイベントでも同様のことが起こります。とんだ落とし穴です。</p>

<p>「別スレッドで処理が続くと何がダメなの？」と思うかもしれませんが、実は「メインスレッドからしか実行できないメソッド」というのはいくつも存在します。個人的な経験だと、IBMのWatsonで音声認識を開始するときのメソッドがそうでした。</p>

<p>で、これを何とかするためには、<strong>SynchronizationContext</strong>というものを使う必要があります。<br>
僕の記事では詳しく紹介できませんが、<a href="/toRisouP" class="user-mention js-hovercard" title="toRisouP" data-hovercard-target-type="user" data-hovercard-target-name="toRisouP">@toRisouP</a> さんの<a href="https://qiita.com/toRisouP/items/a2c1bb1b0c4f73366bc6" id="reference-f35ba3c8b7f0af58ea63">こちらの記事</a>に分かりやすく書いてあります。<br>
このオブジェクトを使えば、自分の指定したスレッドで処理を走らせることができます。現在の処理が走っているスレッドは<code>Thread.CurrentThread.ManagedThreadId</code>で確認することができるので、ちょっと以下のコードをUnityで走らせて確認してみましょう。</p>

<div class="code-frame" data-lang="CS">
<div class="code-lang"><span class="bold">実行スレッドの確認</span></div>
<div class="highlight"><pre class="with-code"><code><span class="c1">/// &lt;summary&gt;</span>
<span class="c1">/// メインスレッドに処理を戻すためのオブジェクト</span>
<span class="c1">/// &lt;/summary&gt;</span>
<span class="k">private</span> <span class="n">SynchronizationContext</span> <span class="n">_mainContext</span><span class="p">;</span>

<span class="k">private</span> <span class="k">void</span> <span class="nf">Start</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">_mainContext</span> <span class="p">=</span> <span class="n">SynchronizationContext</span><span class="p">.</span><span class="n">Current</span><span class="p">;</span>

    <span class="nf">Hoge</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">void</span> <span class="nf">Hoge</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">$"Main thread ID : "</span> <span class="p">+</span> <span class="n">Thread</span><span class="p">.</span><span class="n">CurrentThread</span><span class="p">.</span><span class="n">ManagedThreadId</span><span class="p">);</span>

    <span class="n">Task</span><span class="p">.</span><span class="nf">Run</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="nf">HeavyMethod</span><span class="p">());</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">void</span> <span class="nf">HeavyMethod</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// 何か重い処理</span>
    <span class="n">Thread</span><span class="p">.</span><span class="nf">Sleep</span><span class="p">(</span><span class="m">1000</span><span class="p">);</span>

    <span class="c1">// そのままメソッドを続けて書いた場合</span>
    <span class="nf">SomethingNextMethod</span><span class="p">(</span><span class="s">"Hoge"</span><span class="p">);</span>

    <span class="c1">// メインスレッドに処理を戻したい場合</span>
    <span class="n">_mainContext</span><span class="p">.</span><span class="nf">Post</span><span class="p">(</span><span class="n">_</span> <span class="p">=&gt;</span> <span class="nf">SomethingNextMethod</span><span class="p">(</span><span class="s">"Fuga"</span><span class="p">),</span> <span class="k">null</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">private</span> <span class="k">void</span> <span class="nf">SomethingNextMethod</span><span class="p">(</span><span class="kt">string</span> <span class="n">str</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">$"[</span><span class="p">{</span><span class="n">str</span><span class="p">}</span><span class="s">] Thread ID : "</span> <span class="p">+</span> <span class="n">Thread</span><span class="p">.</span><span class="n">CurrentThread</span><span class="p">.</span><span class="n">ManagedThreadId</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>結果は、以下のようになりました。<br>
<a href="https://camo.qiitausercontent.com/c21a7b2a11e6688de82c6a6cb3cc8b6bccecaeba/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3232323035342f64656264306233302d353566352d666431612d323737362d3034373264646130626665642e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F222054%2Fdebd0b30-55f5-fd1a-2776-0472dda0bfed.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=51887a4df11b105f649a14b041b6c453" alt="スクリーンショット (33).png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/222054/debd0b30-55f5-fd1a-2776-0472dda0bfed.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F222054%2Fdebd0b30-55f5-fd1a-2776-0472dda0bfed.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=b57d822f68d14122d19fcad181ab4264 1x" loading="lazy"></a><br>
<strong>SynchronizationContext</strong>を使って実行スレッドを指定しなかった場合では、処理が別スレッドで走ってしまっていることがわかると思います。ちなみに、僕が実行したときは<code>Task.Run()</code>でスレッド番号92が使われていますが、<code>Task.Run()</code>は内部で<code>スレッドプール</code>という仕組みを使っているため、毎回実行スレッドが変わります。</p>

<p>スレッド関係のバグは気づかないところで起きてたりもするので、特に意図がない場合はSynchronizationContextを使って、処理はメインスレッドに戻したほうが良いでしょう。</p>

<h1>
<span id="2-重い同期処理返り値ありを非同期にしたい場合" class="fragment"></span><a href="#2-%E9%87%8D%E3%81%84%E5%90%8C%E6%9C%9F%E5%87%A6%E7%90%86%E8%BF%94%E3%82%8A%E5%80%A4%E3%81%82%E3%82%8A%E3%82%92%E9%9D%9E%E5%90%8C%E6%9C%9F%E3%81%AB%E3%81%97%E3%81%9F%E3%81%84%E5%A0%B4%E5%90%88"><i class="fa fa-link"></i></a>2. 重い同期処理（返り値あり）を非同期にしたい場合</h1>

<p>前述の落とし穴を見ていて、こう思った方もいるかもしれません。</p>

<p>「<code>Task.Run()</code>でメソッドを発動させるのが少し面倒なら、<code>HeavyMethod()</code>で値を返すようにして、<code>HogeHoge()</code>内で続きの処理を書けばいいのでは？」と。</p>

<p>はい。詳しくは後述しますが、実は<code>await</code>修飾子を使うことで、スレッドを意識せずに処理をつなげて書くことができます。<br>
ということで、次に<code>HeavyMethod()</code>に返り値がある場合を見てみましょう。<br>
具体的には以下のようなメソッドがあり、<code>HeavyMethod()</code>の処理を実行した後に、その結果を使って何かしらの処理を続けたいとします。</p>

<div class="code-frame" data-lang="CS">
<div class="code-lang"><span class="bold">非同期処理が必要な重い処理（返り値あり）</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">private</span> <span class="kt">string</span> <span class="nf">HeavyMethod</span><span class="p">(</span><span class="kt">string</span> <span class="n">str</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// 何か重い処理</span>
    <span class="n">Thread</span><span class="p">.</span><span class="nf">Sleep</span><span class="p">(</span><span class="m">1000</span><span class="p">);</span>

    <span class="k">return</span> <span class="n">str</span> <span class="p">+</span> <span class="s">"fuga"</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>これを非同期で処理する場合は、以下のように書きます。</p>

<div class="code-frame" data-lang="CS">
<div class="code-lang"><span class="bold">HeavyMethod()のみを別スレッドで走らせるメソッド</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">HogeHogeAsync</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// 重い処理を非同期で実行し、その結果を得る</span>
    <span class="kt">string</span> <span class="n">result</span> <span class="p">=</span> <span class="k">await</span> <span class="n">Task</span><span class="p">.</span><span class="nf">Run</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="nf">HeavyMethod</span><span class="p">(</span><span class="s">"hoge"</span><span class="p">));</span>

    <span class="c1">// 重い処理をした続きの処理</span>
    <span class="nf">SomethingNextMethod</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">private</span> <span class="k">void</span> <span class="nf">SomethingNextMethod</span><span class="p">(</span><span class="kt">string</span> <span class="n">str</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="n">str</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>ようやくasync/awaitが出てきました。こいつらがやっていることは以下の通りです。</p>

<ul>
<li>
<code>async</code>

<ul>
<li>メソッド内で<code>await</code>修飾子を使えるようにする</li>
</ul>
</li>
<li>
<code>await</code>

<ul>
<li>
<code>Task.Run()</code>で作成したタスクの実行が終了するまで、<code>HogeHogeAsync()</code>メソッドの処理を止める<br>
（元のスレッドをフリーズさせるわけではない）</li>
<li>タスクが終了した場合は、<code>Task.Run()</code>が返してくる<code>Task&lt;string&gt;</code>からstringを抜き出して返し、<strong>元のスレッドで</strong><code>HogeHogeAsync()</code>内の処理を続行する<br>
（ただしUnity上での挙動 - 参考：<a href="https://www.slideshare.net/UnityTechnologiesJapan/unite-tokyo-2018asyncawait%EF%BC%89" class="autolink" rel="nofollow noopener" target="_blank">https://www.slideshare.net/UnityTechnologiesJapan/unite-tokyo-2018asyncawait）</a>
</li>
</ul>
</li>
</ul>

<p>この<code>await</code>の働きのおかげで、実行スレッドを手動でもとに戻してあげる必要がなくなりました。<br>
このように、<code>await</code>は使う側がスレッドや<code>Task</code>を意識せずに処理を続けて書けるようにしてくれる構文なんですね。</p>

<p>よっしゃ、勝ったな。非同期完全に理解した。<br>
あとは<code>HogeHogeAsync()</code>を使うだけ......</p>

<p>...ん？</p>

<h2>
<span id="落とし穴その２hogehogeasyncを使ってみる" class="fragment"></span><a href="#%E8%90%BD%E3%81%A8%E3%81%97%E7%A9%B4%E3%81%9D%E3%81%AE%EF%BC%92hogehogeasync%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>落とし穴その２（HogeHogeAsync()を使ってみる）</h2>

<p><code>HogeHogeAsync()</code>を別のメソッドから使うと、こんな警告が出てきました。<br>
<a href="https://camo.qiitausercontent.com/eb5dfb0c4614e235011e14af16a08207a618c167/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3232323035342f38383131396636632d616435362d373566372d643334302d3761383163313964346563342e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F222054%2F88119f6c-ad56-75f7-d340-7a81c19d4ec4.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=a057b1fef5e428d2587a6c70cbeccebb" alt="スクリーンショット (38).png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/222054/88119f6c-ad56-75f7-d340-7a81c19d4ec4.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F222054%2F88119f6c-ad56-75f7-d340-7a81c19d4ec4.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=e12b7c75b3678645ae714833a4bf8a0e 1x" loading="lazy"></a><br>
えっ、なにこれは。<br>
とりあえず実行は出来るみたいだけど、気味が悪いな......なんとかしよう。</p>

<h3>
<span id="試行その１awaitを追加してみる" class="fragment"></span><a href="#%E8%A9%A6%E8%A1%8C%E3%81%9D%E3%81%AE%EF%BC%91await%E3%82%92%E8%BF%BD%E5%8A%A0%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>試行その１：<code>await</code>を追加してみる</h3>

<p>Visual Studioさんに<code>await</code>つけろって言われてるんなら、素直につけてみましょう。<br>
<a href="https://camo.qiitausercontent.com/84a07332c7e8838e07cecd16526617fba3de98eb/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3232323035342f39393563623537362d333032372d333233332d323135352d3461356237303564626633632e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F222054%2F995cb576-3027-3233-2155-4a5b705dbf3c.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=49f860b2c292b3858b1d400e2e962d79" alt="スクリーンショット (39).png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/222054/995cb576-3027-3233-2155-4a5b705dbf3c.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F222054%2F995cb576-3027-3233-2155-4a5b705dbf3c.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=cb2777ab656319a73c967acd19ffe024 1x" loading="lazy"></a><br>
警告どころかエラーになりました。<br>
内容は「<code>await</code>使ってるのに<code>FugaFuga()</code>メソッドに<code>async</code>修飾子がついてないよ」というもの。<br>
なんだ、じゃあ<code>async</code>つければいいや。<br>
<a href="https://camo.qiitausercontent.com/9c95d5304330483f38e3bfea3b9511e04ba08cf7/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3232323035342f39303336363230322d383466372d376665652d326630352d6638653362623032613336392e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F222054%2F90366202-84f7-7fee-2f05-f8e3bb02a369.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=4990da63b1b92d6e44fcae7ab21c9074" alt="スクリーンショット (41).png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/222054/90366202-84f7-7fee-2f05-f8e3bb02a369.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F222054%2F90366202-84f7-7fee-2f05-f8e3bb02a369.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=6d933bc3ef3092068d4b6ee993fbc8ff 1x" loading="lazy"></a><br>
よし、警告は消えたな。</p>

<p><del>...ん？</del></p>

<p><del>ああああ、<strong><code>async void</code></strong>！！、<strong><code>async void</code></strong>じゃないか！！！</del><br>
<del>こりゃだめだ、しかもこれ結局<code>FugaFuga()</code>を使うメソッドまで、無限に<code>async</code>をつけなきゃいけないじゃないか！</del></p>

<p><font color="red"><code>FugaFuga()</code>が別スレッドから呼ばれない限り、これでいいです。<br>
<code>FugaFuga()</code>が別スレッドから呼ばれるなら、<code>HogeHogeAsync()</code>内の例外が握りつぶされないように、ちゃんとエラーハンドリングして<code>SynchronizationContext</code>の<code>Post()</code>メソッドで例外をメインスレッドに投げ直してあげてください（2020/5/10 修正）</font></p>

<h3>
<span id="試行その２hogehogeasyncを改変してみる" class="fragment"></span><a href="#%E8%A9%A6%E8%A1%8C%E3%81%9D%E3%81%AE%EF%BC%92hogehogeasync%E3%82%92%E6%94%B9%E5%A4%89%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>試行その２：<code>HogeHogeAsync()</code>を改変してみる</h3>

<p><code>await</code>を一度使うと、それを使う側まですべて<code>async/await</code>修飾子をつけなきゃいけない...（思い込み）<br>
じゃあ<code>await</code>を一度も使わなければいいのでは？？？</p>

<p>そういえば<code>Task</code>には<code>task.Result</code>ってプロパティがあったな...<br>
<code>await</code>ではなくこれを使えばいいのでは？？？</p>

<div class="code-frame" data-lang="CS">
<div class="code-lang"><span class="bold">絶望のデッドロックコード</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">private</span> <span class="k">void</span> <span class="nf">FugaFuga</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nf">HogeHoge</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">void</span> <span class="nf">HogeHoge</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// Taskはawaitせず直接受け取って</span>
    <span class="kt">var</span> <span class="n">task</span> <span class="p">=</span> <span class="n">Task</span><span class="p">.</span><span class="nf">Run</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="nf">HeavyMethod</span><span class="p">(</span><span class="s">"hoge"</span><span class="p">));</span>

    <span class="c1">// task.Resultで直接、値にアクセスする</span>
    <span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="n">task</span><span class="p">.</span><span class="n">Result</span><span class="p">;</span> <span class="c1">// ここで結局スレッドが止まる</span>
    <span class="nf">SomethingNextMethod</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p><del>はい、デッドロックです。</del><br>
<del>実は<code>task.Result</code>の内部では<code>Task</code>を<code>Wait()</code>する処理が走ります。</del><br>
<del>そのとき、なぜデッドロックが発生するかは過去にたくさんの記事が書いてあるので見てみてください。</del></p>

<p><font color="red"><code>Task.Run()</code>の中の処理は別のスレッドプールで走るため、<code>task.Result</code>でメインスレッドを止めてもデッドロックはしませんが、結局処理が完了するまでメインスレッドが止まってしまうため、非同期処理ではなくなってしまいます。<br>
これはC#組み込みの<code>async Task</code>メソッドでも同じ挙動になりますが、実行時のスレッドでタスクの完了を待ち受ける<code>async Task</code>メソッドで<code>task.Result</code>すると、タスクの完了を待ち受けるスレッドを停止してしまうことになり、デッドロックするので注意です。（2020/5/10 修正）</font></p>

<h3>
<span id="じゃあどうするか" class="fragment"></span><a href="#%E3%81%98%E3%82%83%E3%81%82%E3%81%A9%E3%81%86%E3%81%99%E3%82%8B%E3%81%8B"><i class="fa fa-link"></i></a>じゃあどうするか</h3>

<p><font color="red">エラーハンドリングさえちゃんとしとけば試行1のやり方でいいです（2020/5/10 修正）</font></p>

<p><del>試行１、試行２はダメでした。</del><br>
<del>じゃあどうすればいいかというと、こう書くことです。</del></p>

<div class="code-frame" data-lang="CS">
<div class="code-lang"><span class="bold">問題なくasyncメソッドを使う方法</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">private</span> <span class="k">void</span> <span class="nf">FugaFuga</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">task</span> <span class="p">=</span> <span class="nf">HogeHogeAsync</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">HogeHogeAsync</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">string</span> <span class="n">result</span> <span class="p">=</span> <span class="k">await</span> <span class="n">Task</span><span class="p">.</span><span class="nf">Run</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="nf">HeavyMethod</span><span class="p">(</span><span class="s">"hoge"</span><span class="p">));</span>

    <span class="nf">SomethingNextMethod</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p><del>追加されたのは、<code>FugaFuga()</code>メソッドの中で、<code>HogeHogeAsync()</code>を<code>await</code>せずに、ただの<code>Task</code>を変数<code>task</code>に代入する処理だけです。これで警告が消えます。</del></p>

<p><del>そのあとの処理には全く影響がないのに、なぜこれで警告が消えるのでしょうか。</del><br>
<del>そのヒントがこのページに書いてあります。</del></p>

<p><del><a href="https://hiroronn.hatenablog.jp/entry/20171005/1507207811" rel="nofollow noopener" target="_blank">async、awaitそしてTaskについて（非同期とは何なのか）</a></del></p>

<p><del>以下引用です</del></p>

<blockquote>
<ul>
<li>
<del>同期処理</del>

<ul>
<li><del>処理が終わるまで待つ</del></li>
</ul>
</li>
<li>
<del>非同期処理</del>

<ul>
<li><del>処理が終わるまで待つかどうかを、<strong>利用者に委ねる</strong></del></li>
</ul>
</li>
</ul>
</blockquote>

<p><del>ここに書いてある通り、<code>async</code>のついたメソッドは利用者側で、処理を<strong>待つ</strong>ことも、<strong>待たない</strong>こともできます。<br>
また、<a href="https://qiita.com/acple@github/items/8f63aacb13de9954c5da">Taskを極めろ！async/await完全攻略</a>には、以下のようにも書いてあります。</del></p>

<blockquote>
<p><del>本来、Taskは好きなときに好きなようにWaitしても全く問題ないものだった</del></p>
</blockquote>

<p><del>つまり、本来はこういう書き方ができたはずだったのでしょう。</del><br>
<del>実際、<code>ConfigureAwait(false)</code>を使えば以下のようなコードでもデッドロックを回避できます。</del></p>

<div class="code-frame" data-lang="CS"><div class="highlight"><pre class="with-code"><code>
<span class="k">private</span> <span class="k">void</span> <span class="nf">FugaFuga</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// HogeHogeAsync()のタスク(Task&lt;string&gt;)をそのまま受け取り</span>
    <span class="kt">var</span> <span class="n">task</span> <span class="p">=</span> <span class="nf">HogeHogeAsync</span><span class="p">();</span>

    <span class="c1">// taskの完了を待つ</span>
    <span class="n">task</span><span class="p">.</span><span class="nf">Wait</span><span class="p">();</span>

    <span class="c1">// taskの処理は終了しているので、Resultを参照</span>
    <span class="nf">SomethingNextMethod</span><span class="p">(</span><span class="n">task</span><span class="p">.</span><span class="n">Result</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="nf">HogeHogeAsync</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="k">await</span> <span class="n">Task</span><span class="p">.</span><span class="nf">Run</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="nf">HeavyMethod</span><span class="p">(</span><span class="s">"hoge"</span><span class="p">));</span>
    <span class="c1">// return await Task.Run(() =&gt; HeavyMethod("hoge")).ConfigureAwait(false); // これならデッドロックしない</span>
<span class="p">}</span>
</code></pre></div></div>

<p><del>エディタの立場に立ってこれを加味すると、「あとで<code>Wait()</code>するかもしれないんだし、すぐに<code>await</code>しないにしてもとりあえず<code>Task</code>は受け取っておきなよ。処理投げっぱなしは良くないよ」という気持ちになるのでしょう。</del><br>
<del>これが、あの「<code>この呼び出しを待たないため、現在のメソッドの...</code>」という警告の原因ではないかと思います。</del></p>

<p>余談ですが、僕は「タスクを変数<code>_</code>として受け取っておき、その後一切処理をしない」ことを、暗黙的に「そこの非同期処理は完了待ちをしない」ことを明示する目印としています。<br>
なので僕は、<strong>1.重い処理に返り値がない場合</strong>のような処理を書く時も、以下のような書き方を好んでいます。</p>

<div class="code-frame" data-lang="CS"><div class="highlight"><pre class="with-code"><code><span class="c1">// 特に問題ないけど、あまり好きではない</span>
<span class="n">Task</span><span class="p">.</span><span class="nf">Run</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="nf">HeavyMethod</span><span class="p">(</span><span class="s">"hoge"</span><span class="p">));</span>

<span class="c1">// C# 6.0ならこう</span>
<span class="kt">var</span> <span class="n">_</span> <span class="p">=</span> <span class="n">Task</span><span class="p">.</span><span class="nf">Run</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="nf">HeavyMethod</span><span class="p">(</span><span class="s">"hoge"</span><span class="p">));</span>

<span class="c1">// C# 7.0以降ならこう ... discards (値の破棄)</span>
<span class="n">_</span> <span class="p">=</span> <span class="n">Task</span><span class="p">.</span><span class="nf">Run</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="nf">HeavyMethod</span><span class="p">(</span><span class="s">"hoge"</span><span class="p">));</span>
</code></pre></div></div>

<p>複数のタスクを複雑に組み合わせて一つのタスクを作りたいときは、何か意味のある名前を付けてあげればいいと思います。</p>

<h1>
<span id="3-非同期で無限ループを回す" class="fragment"></span><a href="#3-%E9%9D%9E%E5%90%8C%E6%9C%9F%E3%81%A7%E7%84%A1%E9%99%90%E3%83%AB%E3%83%BC%E3%83%97%E3%82%92%E5%9B%9E%E3%81%99"><i class="fa fa-link"></i></a>3. 非同期で無限ループを回す</h1>

<p>最後に非同期で無限ループを回したいときの使い方です。<br>
使いどころとしては、自前でオレオレネットワークライブラリを書いてたりすると使う必要が出てきます。<br>
例えば以下のコードは、クライアントとTCP通信するサーバ側の処理の雛形です。</p>

<div class="code-frame" data-lang="CS">
<div class="code-lang"><span class="bold">TcpServer.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="c1">/// &lt;summary&gt;</span>
<span class="c1">/// クライアントと非同期で受信・送信処理を開始する</span>
<span class="c1">/// &lt;/summary&gt;</span>
<span class="k">public</span> <span class="k">void</span> <span class="nf">Communicate</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">_communicateLoop</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>

    <span class="kt">var</span> <span class="n">_</span> <span class="p">=</span> <span class="n">Task</span><span class="p">.</span><span class="nf">Run</span><span class="p">(()</span> <span class="p">=&gt;</span> 
    <span class="p">{</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">_communicateLoop</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">try</span>
            <span class="p">{</span>
                <span class="c1">// クライアントとの送信・受信処理</span>
            <span class="p">}</span>
            <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">Debug</span><span class="p">.</span><span class="nf">LogWarning</span><span class="p">(</span><span class="s">"[Server] "</span> <span class="p">+</span> <span class="n">e</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p><code>Task.Run()</code>の中にラムダ式ですべてのコードが書いてあるだけで今まで書いてきたことと特に違いはなく、無限ループなので処理の待ち受けをしていません。<br>
もし<code>while</code>の中からイベントを発火するようなことがあれば、<strong>SynchronizationContext</strong>の使用を考えるのも<strong>1.重い処理に返り値がない場合</strong>と同様です。</p>

<h1>
<span id="さいごに" class="fragment"></span><a href="#%E3%81%95%E3%81%84%E3%81%94%E3%81%AB"><i class="fa fa-link"></i></a>さいごに</h1>

<p>今回の記事では、<code>Task.Run()</code>を使った基本的な非同期処理について書いていきましたが、別に「非同期処理といえば<code>Task.Run()</code>」という訳では<strong>全く</strong>ありません。<br>
むしろ<code>async/await</code>だけで事足りることの方が多いと思いますし、個人的にも無限ループくらいにしか使いません（だいたい非同期処理したい時にはデフォルトで<code>await</code>できるメソッドが存在する）。</p>

<p>しかし、<code>Task.Run()</code>と<code>async/await</code>の関係がよく分からず、一時期混乱していたので今回の記事を書こうと思いました。<br>
今回の内容が、誰かのお役に立てば幸いです。</p>

<p>もし気力が残ってたら、次回は<code>Task.Run()</code>を使わない非同期処理や、<code>Task</code>そのものについて書けたらと思います。</p>

<p>最後まで読んでいただきありがとうございました。</p>

<ul>
<li>追記

<ul>
<li>Unityのawaitの挙動について補足（2018/12/06）<br>
参考：<a href="https://www.slideshare.net/UnityTechnologiesJapan/unite-tokyo-2018asyncawait" class="autolink" rel="nofollow noopener" target="_blank">https://www.slideshare.net/UnityTechnologiesJapan/unite-tokyo-2018asyncawait</a>
</li>
<li>
<a href="https://qiita.com/Alupaca1363Inew/items/edcc70f0abf9273e2397" id="reference-97c007af8da6c3805421">Task.Run()ではなく用意されている非同期メソッドを使おう</a>（2019/09/16）

<ul>
<li>無駄なTask.Run()を消そうという記事をアップロードしました</li>
</ul>
</li>
</ul>
</li>
</ul>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Finew%2Fitems%2F0126270bca99883605de&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Finew%2Fitems%2F0126270bca99883605de&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/inew/items/0126270bca99883605de/likers" class="css-1iupg5d">142</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">147</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/0126270bca99883605de/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/inew/items/0126270bca99883605de/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/inew/items/0126270bca99883605de/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/inew/items/0126270bca99883605de/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/inew/items/0126270bca99883605de.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-4ee7e96b-fb3f-4504-9764-808d2792cbd9">{"authorAnalyticsTrackingId":null,"organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-6ddbce1c-22b3-47d3-9cce-88821c696462"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-6ddbce1c-22b3-47d3-9cce-88821c696462">{}</script>
      
<div id="LoginModal-react-component-e44db1de-fa69-4330-81b3-9039b9256786"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-e44db1de-fa69-4330-81b3-9039b9256786">{}</script>
      
<div id="StockModal-react-component-d4848f1b-ae7d-43c4-91e0-09fb6fcadba0"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-d4848f1b-ae7d-43c4-91e0-09fb6fcadba0">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;zGXbnq7Z+WGsuHyvVWXON0GH86lQW5mYtc5flHi4eRQk6H7qCJd0CQ2rgWlnJx8PPBEsLy39p+Oxz1C93vY2bQ==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\n\u003ch1\u003e\n\u003cspan id=\"はじめに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eはじめに\u003c/h1\u003e\n\n\u003cp\u003e最近、Unity/C#でもちょいちょい非同期処理を書いているんですが、なんだかんだやっぱり非同期は難しいです。  \u003c/p\u003e\n\n\u003cp\u003eそこで、GoogleでTaskやasync/awaitについて検索すると、「TaskをWait()するのはダメ！」とか「async voidは基本的に使っちゃダメ！」といった記事はよく見かけるのですが、\u003cb\u003eじゃあどう書けばいいんじゃ\u003c/b\u003eと思って探してみると、なかなか記事が見つかりません。見つかっても、「UIのクリックイベントにasync voidのメソッドを登録して...」という記事が多いです。\u003cbr\u003e\n残念ながら僕はUnityユーザなので、コードを書いてて非同期処理をしたいとき、処理のきっかけはUIのクリックイベントではない時の方が多く、あまり参考にすることができませんでした。\u003c/p\u003e\n\n\u003cp\u003eということで、UnityでTask, async/awaitを使おうとしたときに僕が困ったことや、その結果わかってきた使い方をできるだけ具体的に書いていこうと思います。\u003cbr\u003e\n何個かブログを書くかもしれませんが、今回の主役は\u003ccode\u003eTask.Run()\u003c/code\u003eです。\u003c/p\u003e\n\n\u003cp\u003eなお、マサカリは大歓迎です。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"関連記事\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%96%A2%E9%80%A3%E8%A8%98%E4%BA%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e関連記事\u003c/h1\u003e\n\n\u003cp\u003eこの記事を読む前に、以下におすすめの記事を載せます。読んだことがない人は事前に読んでみてください。\u003cbr\u003e\nなお、今回の記事ではUniRxについては触れていきません。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita.com/acple@github/items/8f63aacb13de9954c5da\" id=\"reference-6b420b304d38d623fdb4\"\u003eTaskを極めろ！async/await完全攻略\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"taskrun\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#taskrun\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eTask.Run()\u003c/h1\u003e\n\n\u003cp\u003eさて、なにかとよく出てくる\u003ccode\u003eTask.Run()\u003c/code\u003eですが、こいつは一体何をしてくれる関数なのでしょうか。\u003cbr\u003e\n詳しくは\u003ca href=\"https://qiita.com/acple@github/items/8f63aacb13de9954c5da\"\u003eこの記事\u003c/a\u003eに書いてありますが、ざっくり言ってしまうと、「\u003cstrong\u003e同期処理（もともと非同期処理ではなかった処理）\u003c/strong\u003eをまとめてタスクを作り、\u003cstrong\u003e別スレッドで実行する\u003c/strong\u003e」関数です。\u003c/p\u003e\n\n\u003cp\u003e個人的には、以下の３つの使い方を押さえておけば大体何とかなると思います。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e重い同期処理（返り値なし）を非同期にしたい場合\u003c/li\u003e\n\u003cli\u003e重い同期処理（返り値あり）を非同期にしたい場合\u003c/li\u003e\n\u003cli\u003e非同期で無限ループを回したい場合\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"1-重い同期処理返り値なしを非同期にしたい場合\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#1-%E9%87%8D%E3%81%84%E5%90%8C%E6%9C%9F%E5%87%A6%E7%90%86%E8%BF%94%E3%82%8A%E5%80%A4%E3%81%AA%E3%81%97%E3%82%92%E9%9D%9E%E5%90%8C%E6%9C%9F%E3%81%AB%E3%81%97%E3%81%9F%E3%81%84%E5%A0%B4%E5%90%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e1. 重い同期処理（返り値なし）を非同期にしたい場合\u003c/h1\u003e\n\n\u003cp\u003eまず簡単な例として、以下のような重い処理が必要になったとします。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"CS\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e非同期処理が必要な重い処理（返り値なし）\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eHeavyMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// 何か重い処理\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eThread\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSleep\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1000\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// 重い処理をした続きの処理\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eSomethingNextMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eSomethingNextMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// 何か続きの処理\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eよく見るサンプルコードですね。\u003cbr\u003e\nこのとき、\u003ccode\u003eHeavyMethod()\u003c/code\u003eの中には\u003ccode\u003eawait\u003c/code\u003eを使う処理がないものとします。\u003c/p\u003e\n\n\u003cp\u003eこのままUnityのメインスレッドで、\u003ccode\u003eHeavyMethod()\u003c/code\u003eを呼ぶと、画面がガッと止まってしまうので、重い処理の部分を\u003ccode\u003eTask.Run()\u003c/code\u003eで別スレッドで処理を行ってあげる必要があります。\u003cbr\u003e\n具体的にはこうです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"CS\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eHeavyMethod()を別スレッドで走らせるメソッド\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eHogeHoge\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eTask\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRun\u003c/span\u003e\u003cspan class=\"p\"\u003e(()\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eHeavyMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"hoge\"\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e実をいうと個人的にはこの書き方は好きではないのですが、こうすれば\u003ccode\u003eHogeHoge()\u003c/code\u003eメソッドを発動することで、画面のフリーズを避けることができます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"taskrunの落とし穴\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#taskrun%E3%81%AE%E8%90%BD%E3%81%A8%E3%81%97%E7%A9%B4\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eTask.Run()の落とし穴\u003c/h2\u003e\n\n\u003cp\u003e...が、実はこのコードには少し問題があります。\u003cbr\u003e\nそれは、\u003ccode\u003eSomethingNextMethod()\u003c/code\u003e以降の処理が行われるスレッドに関してです。\u003cbr\u003e\n最初に言ったとおり、\u003ccode\u003eTask.Run()\u003c/code\u003eは引数として与えられた処理を\u003cstrong\u003e別スレッドで\u003c/strong\u003e実行します。つまり、本来別スレッドで行ってほしくない\u003ccode\u003eSomethingNextMethod()\u003c/code\u003eの処理まで別スレッドで行われてしまうということです。これはメソッドだけでなく、\u003ccode\u003eTask.Run()\u003c/code\u003e内で発火したイベントでも同様のことが起こります。とんだ落とし穴です。\u003c/p\u003e\n\n\u003cp\u003e「別スレッドで処理が続くと何がダメなの？」と思うかもしれませんが、実は「メインスレッドからしか実行できないメソッド」というのはいくつも存在します。個人的な経験だと、IBMのWatsonで音声認識を開始するときのメソッドがそうでした。\u003c/p\u003e\n\n\u003cp\u003eで、これを何とかするためには、\u003cstrong\u003eSynchronizationContext\u003c/strong\u003eというものを使う必要があります。\u003cbr\u003e\n僕の記事では詳しく紹介できませんが、\u003ca href=\"/toRisouP\" class=\"user-mention js-hovercard\" title=\"toRisouP\" data-hovercard-target-type=\"user\" data-hovercard-target-name=\"toRisouP\"\u003e@toRisouP\u003c/a\u003e さんの\u003ca href=\"https://qiita.com/toRisouP/items/a2c1bb1b0c4f73366bc6\" id=\"reference-f35ba3c8b7f0af58ea63\"\u003eこちらの記事\u003c/a\u003eに分かりやすく書いてあります。\u003cbr\u003e\nこのオブジェクトを使えば、自分の指定したスレッドで処理を走らせることができます。現在の処理が走っているスレッドは\u003ccode\u003eThread.CurrentThread.ManagedThreadId\u003c/code\u003eで確認することができるので、ちょっと以下のコードをUnityで走らせて確認してみましょう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"CS\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e実行スレッドの確認\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// メインスレッドに処理を戻すためのオブジェクト\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eSynchronizationContext\u003c/span\u003e \u003cspan class=\"n\"\u003e_mainContext\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eStart\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003e_mainContext\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eSynchronizationContext\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCurrent\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"nf\"\u003eHoge\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eHoge\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"Main thread ID : \"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eThread\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCurrentThread\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eManagedThreadId\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003eTask\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRun\u003c/span\u003e\u003cspan class=\"p\"\u003e(()\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eHeavyMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eHeavyMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// 何か重い処理\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eThread\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSleep\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1000\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// そのままメソッドを続けて書いた場合\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eSomethingNextMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Hoge\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// メインスレッドに処理を戻したい場合\u003c/span\u003e\n    \u003cspan class=\"n\"\u003e_mainContext\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ePost\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e_\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eSomethingNextMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Fuga\"\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eSomethingNextMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e$\"[\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e] Thread ID : \"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eThread\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCurrentThread\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eManagedThreadId\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e結果は、以下のようになりました。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/c21a7b2a11e6688de82c6a6cb3cc8b6bccecaeba/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3232323035342f64656264306233302d353566352d666431612d323737362d3034373264646130626665642e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F222054%2Fdebd0b30-55f5-fd1a-2776-0472dda0bfed.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=51887a4df11b105f649a14b041b6c453\" alt=\"スクリーンショット (33).png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/222054/debd0b30-55f5-fd1a-2776-0472dda0bfed.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F222054%2Fdebd0b30-55f5-fd1a-2776-0472dda0bfed.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=b57d822f68d14122d19fcad181ab4264 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n\u003cstrong\u003eSynchronizationContext\u003c/strong\u003eを使って実行スレッドを指定しなかった場合では、処理が別スレッドで走ってしまっていることがわかると思います。ちなみに、僕が実行したときは\u003ccode\u003eTask.Run()\u003c/code\u003eでスレッド番号92が使われていますが、\u003ccode\u003eTask.Run()\u003c/code\u003eは内部で\u003ccode\u003eスレッドプール\u003c/code\u003eという仕組みを使っているため、毎回実行スレッドが変わります。\u003c/p\u003e\n\n\u003cp\u003eスレッド関係のバグは気づかないところで起きてたりもするので、特に意図がない場合はSynchronizationContextを使って、処理はメインスレッドに戻したほうが良いでしょう。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"2-重い同期処理返り値ありを非同期にしたい場合\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#2-%E9%87%8D%E3%81%84%E5%90%8C%E6%9C%9F%E5%87%A6%E7%90%86%E8%BF%94%E3%82%8A%E5%80%A4%E3%81%82%E3%82%8A%E3%82%92%E9%9D%9E%E5%90%8C%E6%9C%9F%E3%81%AB%E3%81%97%E3%81%9F%E3%81%84%E5%A0%B4%E5%90%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2. 重い同期処理（返り値あり）を非同期にしたい場合\u003c/h1\u003e\n\n\u003cp\u003e前述の落とし穴を見ていて、こう思った方もいるかもしれません。\u003c/p\u003e\n\n\u003cp\u003e「\u003ccode\u003eTask.Run()\u003c/code\u003eでメソッドを発動させるのが少し面倒なら、\u003ccode\u003eHeavyMethod()\u003c/code\u003eで値を返すようにして、\u003ccode\u003eHogeHoge()\u003c/code\u003e内で続きの処理を書けばいいのでは？」と。\u003c/p\u003e\n\n\u003cp\u003eはい。詳しくは後述しますが、実は\u003ccode\u003eawait\u003c/code\u003e修飾子を使うことで、スレッドを意識せずに処理をつなげて書くことができます。\u003cbr\u003e\nということで、次に\u003ccode\u003eHeavyMethod()\u003c/code\u003eに返り値がある場合を見てみましょう。\u003cbr\u003e\n具体的には以下のようなメソッドがあり、\u003ccode\u003eHeavyMethod()\u003c/code\u003eの処理を実行した後に、その結果を使って何かしらの処理を続けたいとします。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"CS\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e非同期処理が必要な重い処理（返り値あり）\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"nf\"\u003eHeavyMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// 何か重い処理\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eThread\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSleep\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1000\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003estr\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\"fuga\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eこれを非同期で処理する場合は、以下のように書きます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"CS\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eHeavyMethod()のみを別スレッドで走らせるメソッド\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e \u003cspan class=\"nf\"\u003eHogeHogeAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// 重い処理を非同期で実行し、その結果を得る\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eresult\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRun\u003c/span\u003e\u003cspan class=\"p\"\u003e(()\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eHeavyMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"hoge\"\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// 重い処理をした続きの処理\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eSomethingNextMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eresult\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eSomethingNextMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eようやくasync/awaitが出てきました。こいつらがやっていることは以下の通りです。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003easync\u003c/code\u003e\n\n\u003cul\u003e\n\u003cli\u003eメソッド内で\u003ccode\u003eawait\u003c/code\u003e修飾子を使えるようにする\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eawait\u003c/code\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003eTask.Run()\u003c/code\u003eで作成したタスクの実行が終了するまで、\u003ccode\u003eHogeHogeAsync()\u003c/code\u003eメソッドの処理を止める\u003cbr\u003e\n（元のスレッドをフリーズさせるわけではない）\u003c/li\u003e\n\u003cli\u003eタスクが終了した場合は、\u003ccode\u003eTask.Run()\u003c/code\u003eが返してくる\u003ccode\u003eTask\u0026lt;string\u0026gt;\u003c/code\u003eからstringを抜き出して返し、\u003cstrong\u003e元のスレッドで\u003c/strong\u003e\u003ccode\u003eHogeHogeAsync()\u003c/code\u003e内の処理を続行する\u003cbr\u003e\n（ただしUnity上での挙動 - 参考：\u003ca href=\"https://www.slideshare.net/UnityTechnologiesJapan/unite-tokyo-2018asyncawait%EF%BC%89\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://www.slideshare.net/UnityTechnologiesJapan/unite-tokyo-2018asyncawait）\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eこの\u003ccode\u003eawait\u003c/code\u003eの働きのおかげで、実行スレッドを手動でもとに戻してあげる必要がなくなりました。\u003cbr\u003e\nこのように、\u003ccode\u003eawait\u003c/code\u003eは使う側がスレッドや\u003ccode\u003eTask\u003c/code\u003eを意識せずに処理を続けて書けるようにしてくれる構文なんですね。\u003c/p\u003e\n\n\u003cp\u003eよっしゃ、勝ったな。非同期完全に理解した。\u003cbr\u003e\nあとは\u003ccode\u003eHogeHogeAsync()\u003c/code\u003eを使うだけ......\u003c/p\u003e\n\n\u003cp\u003e...ん？\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"落とし穴その２hogehogeasyncを使ってみる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%90%BD%E3%81%A8%E3%81%97%E7%A9%B4%E3%81%9D%E3%81%AE%EF%BC%92hogehogeasync%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e落とし穴その２（HogeHogeAsync()を使ってみる）\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003eHogeHogeAsync()\u003c/code\u003eを別のメソッドから使うと、こんな警告が出てきました。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/eb5dfb0c4614e235011e14af16a08207a618c167/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3232323035342f38383131396636632d616435362d373566372d643334302d3761383163313964346563342e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F222054%2F88119f6c-ad56-75f7-d340-7a81c19d4ec4.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=a057b1fef5e428d2587a6c70cbeccebb\" alt=\"スクリーンショット (38).png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/222054/88119f6c-ad56-75f7-d340-7a81c19d4ec4.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F222054%2F88119f6c-ad56-75f7-d340-7a81c19d4ec4.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=e12b7c75b3678645ae714833a4bf8a0e 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\nえっ、なにこれは。\u003cbr\u003e\nとりあえず実行は出来るみたいだけど、気味が悪いな......なんとかしよう。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"試行その１awaitを追加してみる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A9%A6%E8%A1%8C%E3%81%9D%E3%81%AE%EF%BC%91await%E3%82%92%E8%BF%BD%E5%8A%A0%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e試行その１：\u003ccode\u003eawait\u003c/code\u003eを追加してみる\u003c/h3\u003e\n\n\u003cp\u003eVisual Studioさんに\u003ccode\u003eawait\u003c/code\u003eつけろって言われてるんなら、素直につけてみましょう。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/84a07332c7e8838e07cecd16526617fba3de98eb/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3232323035342f39393563623537362d333032372d333233332d323135352d3461356237303564626633632e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F222054%2F995cb576-3027-3233-2155-4a5b705dbf3c.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=49f860b2c292b3858b1d400e2e962d79\" alt=\"スクリーンショット (39).png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/222054/995cb576-3027-3233-2155-4a5b705dbf3c.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F222054%2F995cb576-3027-3233-2155-4a5b705dbf3c.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=cb2777ab656319a73c967acd19ffe024 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n警告どころかエラーになりました。\u003cbr\u003e\n内容は「\u003ccode\u003eawait\u003c/code\u003e使ってるのに\u003ccode\u003eFugaFuga()\u003c/code\u003eメソッドに\u003ccode\u003easync\u003c/code\u003e修飾子がついてないよ」というもの。\u003cbr\u003e\nなんだ、じゃあ\u003ccode\u003easync\u003c/code\u003eつければいいや。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/9c95d5304330483f38e3bfea3b9511e04ba08cf7/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3232323035342f39303336363230322d383466372d376665652d326630352d6638653362623032613336392e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F222054%2F90366202-84f7-7fee-2f05-f8e3bb02a369.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=4990da63b1b92d6e44fcae7ab21c9074\" alt=\"スクリーンショット (41).png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/222054/90366202-84f7-7fee-2f05-f8e3bb02a369.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F222054%2F90366202-84f7-7fee-2f05-f8e3bb02a369.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=6d933bc3ef3092068d4b6ee993fbc8ff 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\nよし、警告は消えたな。\u003c/p\u003e\n\n\u003cp\u003e\u003cdel\u003e...ん？\u003c/del\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cdel\u003eああああ、\u003cstrong\u003e\u003ccode\u003easync void\u003c/code\u003e\u003c/strong\u003e！！、\u003cstrong\u003e\u003ccode\u003easync void\u003c/code\u003e\u003c/strong\u003eじゃないか！！！\u003c/del\u003e\u003cbr\u003e\n\u003cdel\u003eこりゃだめだ、しかもこれ結局\u003ccode\u003eFugaFuga()\u003c/code\u003eを使うメソッドまで、無限に\u003ccode\u003easync\u003c/code\u003eをつけなきゃいけないじゃないか！\u003c/del\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cfont color=\"red\"\u003e\u003ccode\u003eFugaFuga()\u003c/code\u003eが別スレッドから呼ばれない限り、これでいいです。\u003cbr\u003e\n\u003ccode\u003eFugaFuga()\u003c/code\u003eが別スレッドから呼ばれるなら、\u003ccode\u003eHogeHogeAsync()\u003c/code\u003e内の例外が握りつぶされないように、ちゃんとエラーハンドリングして\u003ccode\u003eSynchronizationContext\u003c/code\u003eの\u003ccode\u003ePost()\u003c/code\u003eメソッドで例外をメインスレッドに投げ直してあげてください（2020/5/10 修正）\u003c/font\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"試行その２hogehogeasyncを改変してみる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A9%A6%E8%A1%8C%E3%81%9D%E3%81%AE%EF%BC%92hogehogeasync%E3%82%92%E6%94%B9%E5%A4%89%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e試行その２：\u003ccode\u003eHogeHogeAsync()\u003c/code\u003eを改変してみる\u003c/h3\u003e\n\n\u003cp\u003e\u003ccode\u003eawait\u003c/code\u003eを一度使うと、それを使う側まですべて\u003ccode\u003easync/await\u003c/code\u003e修飾子をつけなきゃいけない...（思い込み）\u003cbr\u003e\nじゃあ\u003ccode\u003eawait\u003c/code\u003eを一度も使わなければいいのでは？？？\u003c/p\u003e\n\n\u003cp\u003eそういえば\u003ccode\u003eTask\u003c/code\u003eには\u003ccode\u003etask.Result\u003c/code\u003eってプロパティがあったな...\u003cbr\u003e\n\u003ccode\u003eawait\u003c/code\u003eではなくこれを使えばいいのでは？？？\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"CS\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e絶望のデッドロックコード\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eFugaFuga\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eHogeHoge\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eHogeHoge\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// Taskはawaitせず直接受け取って\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003etask\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRun\u003c/span\u003e\u003cspan class=\"p\"\u003e(()\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eHeavyMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"hoge\"\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// task.Resultで直接、値にアクセスする\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eresult\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etask\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eResult\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ここで結局スレッドが止まる\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eSomethingNextMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eresult\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003cdel\u003eはい、デッドロックです。\u003c/del\u003e\u003cbr\u003e\n\u003cdel\u003e実は\u003ccode\u003etask.Result\u003c/code\u003eの内部では\u003ccode\u003eTask\u003c/code\u003eを\u003ccode\u003eWait()\u003c/code\u003eする処理が走ります。\u003c/del\u003e\u003cbr\u003e\n\u003cdel\u003eそのとき、なぜデッドロックが発生するかは過去にたくさんの記事が書いてあるので見てみてください。\u003c/del\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cfont color=\"red\"\u003e\u003ccode\u003eTask.Run()\u003c/code\u003eの中の処理は別のスレッドプールで走るため、\u003ccode\u003etask.Result\u003c/code\u003eでメインスレッドを止めてもデッドロックはしませんが、結局処理が完了するまでメインスレッドが止まってしまうため、非同期処理ではなくなってしまいます。\u003cbr\u003e\nこれはC#組み込みの\u003ccode\u003easync Task\u003c/code\u003eメソッドでも同じ挙動になりますが、実行時のスレッドでタスクの完了を待ち受ける\u003ccode\u003easync Task\u003c/code\u003eメソッドで\u003ccode\u003etask.Result\u003c/code\u003eすると、タスクの完了を待ち受けるスレッドを停止してしまうことになり、デッドロックするので注意です。（2020/5/10 修正）\u003c/font\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"じゃあどうするか\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%98%E3%82%83%E3%81%82%E3%81%A9%E3%81%86%E3%81%99%E3%82%8B%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eじゃあどうするか\u003c/h3\u003e\n\n\u003cp\u003e\u003cfont color=\"red\"\u003eエラーハンドリングさえちゃんとしとけば試行1のやり方でいいです（2020/5/10 修正）\u003c/font\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cdel\u003e試行１、試行２はダメでした。\u003c/del\u003e\u003cbr\u003e\n\u003cdel\u003eじゃあどうすればいいかというと、こう書くことです。\u003c/del\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"CS\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e問題なくasyncメソッドを使う方法\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eFugaFuga\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003etask\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eHogeHogeAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e \u003cspan class=\"nf\"\u003eHogeHogeAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eresult\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRun\u003c/span\u003e\u003cspan class=\"p\"\u003e(()\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eHeavyMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"hoge\"\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\n    \u003cspan class=\"nf\"\u003eSomethingNextMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eresult\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003cdel\u003e追加されたのは、\u003ccode\u003eFugaFuga()\u003c/code\u003eメソッドの中で、\u003ccode\u003eHogeHogeAsync()\u003c/code\u003eを\u003ccode\u003eawait\u003c/code\u003eせずに、ただの\u003ccode\u003eTask\u003c/code\u003eを変数\u003ccode\u003etask\u003c/code\u003eに代入する処理だけです。これで警告が消えます。\u003c/del\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cdel\u003eそのあとの処理には全く影響がないのに、なぜこれで警告が消えるのでしょうか。\u003c/del\u003e\u003cbr\u003e\n\u003cdel\u003eそのヒントがこのページに書いてあります。\u003c/del\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cdel\u003e\u003ca href=\"https://hiroronn.hatenablog.jp/entry/20171005/1507207811\" rel=\"nofollow noopener\" target=\"_blank\"\u003easync、awaitそしてTaskについて（非同期とは何なのか）\u003c/a\u003e\u003c/del\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cdel\u003e以下引用です\u003c/del\u003e\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cdel\u003e同期処理\u003c/del\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003cdel\u003e処理が終わるまで待つ\u003c/del\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cdel\u003e非同期処理\u003c/del\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003cdel\u003e処理が終わるまで待つかどうかを、\u003cstrong\u003e利用者に委ねる\u003c/strong\u003e\u003c/del\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e\u003cdel\u003eここに書いてある通り、\u003ccode\u003easync\u003c/code\u003eのついたメソッドは利用者側で、処理を\u003cstrong\u003e待つ\u003c/strong\u003eことも、\u003cstrong\u003e待たない\u003c/strong\u003eこともできます。\u003cbr\u003e\nまた、\u003ca href=\"https://qiita.com/acple@github/items/8f63aacb13de9954c5da\"\u003eTaskを極めろ！async/await完全攻略\u003c/a\u003eには、以下のようにも書いてあります。\u003c/del\u003e\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003cdel\u003e本来、Taskは好きなときに好きなようにWaitしても全く問題ないものだった\u003c/del\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e\u003cdel\u003eつまり、本来はこういう書き方ができたはずだったのでしょう。\u003c/del\u003e\u003cbr\u003e\n\u003cdel\u003e実際、\u003ccode\u003eConfigureAwait(false)\u003c/code\u003eを使えば以下のようなコードでもデッドロックを回避できます。\u003c/del\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"CS\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eFugaFuga\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// HogeHogeAsync()のタスク(Task\u0026lt;string\u0026gt;)をそのまま受け取り\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003etask\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eHogeHogeAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// taskの完了を待つ\u003c/span\u003e\n    \u003cspan class=\"n\"\u003etask\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWait\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// taskの処理は終了しているので、Resultを参照\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eSomethingNextMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etask\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eResult\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eHogeHogeAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRun\u003c/span\u003e\u003cspan class=\"p\"\u003e(()\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eHeavyMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"hoge\"\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// return await Task.Run(() =\u0026gt; HeavyMethod(\"hoge\")).ConfigureAwait(false); // これならデッドロックしない\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003cdel\u003eエディタの立場に立ってこれを加味すると、「あとで\u003ccode\u003eWait()\u003c/code\u003eするかもしれないんだし、すぐに\u003ccode\u003eawait\u003c/code\u003eしないにしてもとりあえず\u003ccode\u003eTask\u003c/code\u003eは受け取っておきなよ。処理投げっぱなしは良くないよ」という気持ちになるのでしょう。\u003c/del\u003e\u003cbr\u003e\n\u003cdel\u003eこれが、あの「\u003ccode\u003eこの呼び出しを待たないため、現在のメソッドの...\u003c/code\u003e」という警告の原因ではないかと思います。\u003c/del\u003e\u003c/p\u003e\n\n\u003cp\u003e余談ですが、僕は「タスクを変数\u003ccode\u003e_\u003c/code\u003eとして受け取っておき、その後一切処理をしない」ことを、暗黙的に「そこの非同期処理は完了待ちをしない」ことを明示する目印としています。\u003cbr\u003e\nなので僕は、\u003cstrong\u003e1.重い処理に返り値がない場合\u003c/strong\u003eのような処理を書く時も、以下のような書き方を好んでいます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"CS\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// 特に問題ないけど、あまり好きではない\u003c/span\u003e\n\u003cspan class=\"n\"\u003eTask\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRun\u003c/span\u003e\u003cspan class=\"p\"\u003e(()\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eHeavyMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"hoge\"\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// C# 6.0ならこう\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003e_\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRun\u003c/span\u003e\u003cspan class=\"p\"\u003e(()\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eHeavyMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"hoge\"\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// C# 7.0以降ならこう ... discards (値の破棄)\u003c/span\u003e\n\u003cspan class=\"n\"\u003e_\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRun\u003c/span\u003e\u003cspan class=\"p\"\u003e(()\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eHeavyMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"hoge\"\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e複数のタスクを複雑に組み合わせて一つのタスクを作りたいときは、何か意味のある名前を付けてあげればいいと思います。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"3-非同期で無限ループを回す\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#3-%E9%9D%9E%E5%90%8C%E6%9C%9F%E3%81%A7%E7%84%A1%E9%99%90%E3%83%AB%E3%83%BC%E3%83%97%E3%82%92%E5%9B%9E%E3%81%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e3. 非同期で無限ループを回す\u003c/h1\u003e\n\n\u003cp\u003e最後に非同期で無限ループを回したいときの使い方です。\u003cbr\u003e\n使いどころとしては、自前でオレオレネットワークライブラリを書いてたりすると使う必要が出てきます。\u003cbr\u003e\n例えば以下のコードは、クライアントとTCP通信するサーバ側の処理の雛形です。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"CS\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eTcpServer.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// クライアントと非同期で受信・送信処理を開始する\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eCommunicate\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003e_communicateLoop\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003e_\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRun\u003c/span\u003e\u003cspan class=\"p\"\u003e(()\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ewhile\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e_communicateLoop\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003etry\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// クライアントとの送信・受信処理\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ecatch\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eException\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLogWarning\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"[Server] \"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003eTask.Run()\u003c/code\u003eの中にラムダ式ですべてのコードが書いてあるだけで今まで書いてきたことと特に違いはなく、無限ループなので処理の待ち受けをしていません。\u003cbr\u003e\nもし\u003ccode\u003ewhile\u003c/code\u003eの中からイベントを発火するようなことがあれば、\u003cstrong\u003eSynchronizationContext\u003c/strong\u003eの使用を考えるのも\u003cstrong\u003e1.重い処理に返り値がない場合\u003c/strong\u003eと同様です。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"さいごに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%95%E3%81%84%E3%81%94%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eさいごに\u003c/h1\u003e\n\n\u003cp\u003e今回の記事では、\u003ccode\u003eTask.Run()\u003c/code\u003eを使った基本的な非同期処理について書いていきましたが、別に「非同期処理といえば\u003ccode\u003eTask.Run()\u003c/code\u003e」という訳では\u003cstrong\u003e全く\u003c/strong\u003eありません。\u003cbr\u003e\nむしろ\u003ccode\u003easync/await\u003c/code\u003eだけで事足りることの方が多いと思いますし、個人的にも無限ループくらいにしか使いません（だいたい非同期処理したい時にはデフォルトで\u003ccode\u003eawait\u003c/code\u003eできるメソッドが存在する）。\u003c/p\u003e\n\n\u003cp\u003eしかし、\u003ccode\u003eTask.Run()\u003c/code\u003eと\u003ccode\u003easync/await\u003c/code\u003eの関係がよく分からず、一時期混乱していたので今回の記事を書こうと思いました。\u003cbr\u003e\n今回の内容が、誰かのお役に立てば幸いです。\u003c/p\u003e\n\n\u003cp\u003eもし気力が残ってたら、次回は\u003ccode\u003eTask.Run()\u003c/code\u003eを使わない非同期処理や、\u003ccode\u003eTask\u003c/code\u003eそのものについて書けたらと思います。\u003c/p\u003e\n\n\u003cp\u003e最後まで読んでいただきありがとうございました。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e追記\n\n\u003cul\u003e\n\u003cli\u003eUnityのawaitの挙動について補足（2018/12/06）\u003cbr\u003e\n参考：\u003ca href=\"https://www.slideshare.net/UnityTechnologiesJapan/unite-tokyo-2018asyncawait\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://www.slideshare.net/UnityTechnologiesJapan/unite-tokyo-2018asyncawait\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://qiita.com/Alupaca1363Inew/items/edcc70f0abf9273e2397\" id=\"reference-97c007af8da6c3805421\"\u003eTask.Run()ではなく用意されている非同期メソッドを使おう\u003c/a\u003e（2019/09/16）\n\n\u003cul\u003e\n\u003cli\u003e無駄なTask.Run()を消そうという記事をアップロードしました\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","createdAt":"2018-12-05T18:04:45Z","elapsedYearsFromLastModifiedAt":1,"encryptedId":"YNIxLRwSwBryonxN+XExppeT75saYwQ1--5kF7QUMJE0lIsstt--LrY8bOaDEyua/uWzn/rV9w==","isBanned":false,"isDeprecated":true,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2020-05-09T16:08:26Z","likesCount":142,"linkUrl":"https://qiita.com/inew/items/0126270bca99883605de","organization":null,"originalId":733947,"stockedCount":147,"title":"初心者のためのTask.Run(), async/awaitの使い方","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003eはじめに\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E9%96%A2%E9%80%A3%E8%A8%98%E4%BA%8B\"\u003e関連記事\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#taskrun\"\u003eTask.Run()\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#1-%E9%87%8D%E3%81%84%E5%90%8C%E6%9C%9F%E5%87%A6%E7%90%86%E8%BF%94%E3%82%8A%E5%80%A4%E3%81%AA%E3%81%97%E3%82%92%E9%9D%9E%E5%90%8C%E6%9C%9F%E3%81%AB%E3%81%97%E3%81%9F%E3%81%84%E5%A0%B4%E5%90%88\"\u003e1. 重い同期処理（返り値なし）を非同期にしたい場合\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#taskrun%E3%81%AE%E8%90%BD%E3%81%A8%E3%81%97%E7%A9%B4\"\u003eTask.Run()の落とし穴\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#2-%E9%87%8D%E3%81%84%E5%90%8C%E6%9C%9F%E5%87%A6%E7%90%86%E8%BF%94%E3%82%8A%E5%80%A4%E3%81%82%E3%82%8A%E3%82%92%E9%9D%9E%E5%90%8C%E6%9C%9F%E3%81%AB%E3%81%97%E3%81%9F%E3%81%84%E5%A0%B4%E5%90%88\"\u003e2. 重い同期処理（返り値あり）を非同期にしたい場合\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E8%90%BD%E3%81%A8%E3%81%97%E7%A9%B4%E3%81%9D%E3%81%AE%EF%BC%92hogehogeasync%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B\"\u003e落とし穴その２（HogeHogeAsync()を使ってみる）\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E8%A9%A6%E8%A1%8C%E3%81%9D%E3%81%AE%EF%BC%91await%E3%82%92%E8%BF%BD%E5%8A%A0%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B\"\u003e試行その１：awaitを追加してみる\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E8%A9%A6%E8%A1%8C%E3%81%9D%E3%81%AE%EF%BC%92hogehogeasync%E3%82%92%E6%94%B9%E5%A4%89%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B\"\u003e試行その２：HogeHogeAsync()を改変してみる\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%98%E3%82%83%E3%81%82%E3%81%A9%E3%81%86%E3%81%99%E3%82%8B%E3%81%8B\"\u003eじゃあどうするか\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#3-%E9%9D%9E%E5%90%8C%E6%9C%9F%E3%81%A7%E7%84%A1%E9%99%90%E3%83%AB%E3%83%BC%E3%83%97%E3%82%92%E5%9B%9E%E3%81%99\"\u003e3. 非同期で無限ループを回す\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%95%E3%81%84%E3%81%94%E3%81%AB\"\u003eさいごに\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":100858,"uuid":"0126270bca99883605de","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"NFbCGmPO78V1TwMaikkC8NYhZW1o--khn0XrsknY69IfB3--ZvawNkWkXeyyhcMTntRDbA==","originalId":222054,"description":"自動化大好きふくろう","facebookUrl":null,"githubUrl":null,"isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"inew","profileImageUrl":"https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/222054/af399caf96f7a308aad9bd9323967fcee1803c2e/x_large.png?1570011674","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fs3-ap-northeast-1.amazonaws.com%2Fqiita-image-store%2F0%2F222054%2Faf399caf96f7a308aad9bd9323967fcee1803c2e%2Fx_large.png%3F1570011674?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=f595599039538a6176525ded34681c8b","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fs3-ap-northeast-1.amazonaws.com%2Fqiita-image-store%2F0%2F222054%2Faf399caf96f7a308aad9bd9323967fcee1803c2e%2Fx_large.png%3F1570011674?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=3ca9f2f752fdd1bcb294cfeec40ba838","urlName":"inew","websiteUrl":"","twitterUrl":"https://twitter.com/_inevv","twitterUrlName":"_inevv","revealedOrganizations":{"edges":[]}},"tags":[{"name":"C#","urlName":"csharp"},{"name":"task","urlName":"task"},{"name":"Unity","urlName":"unity"},{"name":"非同期処理","urlName":"%e9%9d%9e%e5%90%8c%e6%9c%9f%e5%87%a6%e7%90%86"}],"followingLikers":{"edges":[]},"comments":{"totalCount":2}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

More than 3 years have passed since last update.なんか正月ヒマだったのでかきぞめとしてプログラムを作りたかった。
あとAzure Functionsも使ってみたかった。毎朝決まった時間にYahoo占いのサイトにアクセスして、自分の星座の占い結果をメール通知してくれるシステム全体的な制御 -&gt; Integromatで作る
htmlをパースするAPI -&gt; Azure Functionsで実装Integromatって何よ？って人はこちらを参考いただければ下記のようにhtmlとxpathの配列を受け取って、xpathに対応する値の取得結果を返すwebAPIを作った。
自分しか使わないのでエラー処理とかはなし。実装コードは以下。HtmlAgilityPackというパッケージを使用。
Azure FunctionsでNuGetパッケージを使用するやり方はここを参考にした。簡単なシナリオを作成。
シナリオのスクショだけ貼ってもわけわからんのでざっと説明すると
①
毎朝特定の時間になったら発火して、Yahoo占いのサイトにアクセスして、その日の占いのhtmlページを取得。
②
取得したhtmlデータと、解析用XPathでjsonデータを作って、先程のAzure Functionsで作ったAPIに投げる。
③
APIからのレスポンスデータを本文とタイトルにして、Gmailでメール送信。これだけ。
本当はGoogle Homeに喋らせようと思ったけどデフォルトで占い機能がついてた（「今日の運勢は？」って聞いたら答えてくれた）のでやめた。サーバーやら何やら考えずにAPI作れるAzure Functionsは偉大。
全体制御はIntegromatでやって、コード書かなきゃいけない所はAzure Functionsでやるっていう構成でいけば柔軟に対応できる。
Logic AppとAzure Functionsの組み合わせがMicrosoft的には王道なんだろうけどLogic Appはまだ使ったことないから今度触ってみたいと思う。



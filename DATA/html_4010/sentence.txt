More than 1 year has passed since last update..NET Framework で CoClass を実装して登録し，そのクラスが外部のアプリケーションから呼び出される。.NET Framework 4.5
Windows 10 (x64)interface の宣言に， InterfaceTypeAttribute を設定していなかった。呼び出し元プロセスに Visual Studio でアタッチするとこのような例外が表示された。


C# で COM に登録するクラスを作って実験していたところ，特定のタイミングで呼び出し元のアプリケーションが落ちる。
C# で書いた部分に問題があると考え，try-catch など普段通りデバッグを行ってみるも，これらのすべてに到達せずに落ちる。何の前触れもなく。Visual Studio をそのプロセスに接続してから実験を行うと，このような表示が。
実験を続けていたら，少なくともこのタイミングで落ちるということが特定できたので，コードを減らして実験をしたところ，
C# で書いたクラスのインスタンスを COM を通して外部から呼び出されるように登録するコードを実行しない，あるいは登録後すぐに登録を解除したところ，落ちないことが分かった。登録メソッドに渡す引数の型を確認して，渡すクラスの宣言を確認し，インターフェースの確認をしたところで， InterfaceTypeAttribute をこのインターフェースだけ書き忘れていることがわかり，書き加えたところ登録をしてもアクセス違反が発生しなくなった。自分の場合は，後ろから3番目のメソッドが呼び出されるときにアクセス違反になっていたのだが，メソッドが4つ以上あるインターフェースの，最初に書かれたメソッドが呼び出されるような場合はもしかすると4番目のメソッドが呼び出されるかもしれない。IUnknown が QueryInterface, AddRef, Release の3つを持っているため，3つずれた結果，自分の場合は存在しない領域を参照してしまっていたのではないかと考えている。[要検証] Access Violation した。よくわからない。



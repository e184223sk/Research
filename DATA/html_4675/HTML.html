<!DOCTYPE html><html><head><meta charset="utf-8" /><title>RaspberryPi 3 B+ &amp; Windows10 IoT CoreでONNXモデルを使う - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/koppe/items/71328b67c5f63e45369c" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="gylDVyxjQk90XyPm2nm6Fuu4l9BhzmY9i3jyAYiZTL/rnRGoZ4Tx5ZWYFe+clrrvdkgYc6bq+39Ywn1rfE0JaQ==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta property="og:type" content="article"><meta property="og:title" content="RaspberryPi 3 B+ &amp; Windows10 IoT CoreでONNXモデルを使う - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1VbUZ6Y0dKbGNuSjVVR2tnTXlCQ0t5QW1JRmRwYm1SdmQzTXhNQ0JKYjFRZ1EyOXlaZU9CcDA5T1RsampnNkxqZzRmamc2dmpncExrdmJfamdZWSZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTU0JnR4dC1jbGlwPWVsbGlwc2lzJnR4dC1hbGlnbj1jZW50ZXIlMkNtaWRkbGUmcz1hMDZjMDIyODQzM2YyODUxZTRiNzc1MjliODhiNGViMg&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RR3R2Y0hCbCZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTQ1JnR4dC1hbGlnbj1yaWdodCUyQ2JvdHRvbSZzPTZhMTZlNzc1NGQ2YzZiYTg5MjQ1ZmVlNzQ4ZWQwMWNm&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=4c53182b656ef7eb56511ac1469a1569"><meta property="og:description" content="

この記事について

マイクロソフトがWindows10でのONNXをサポートを公式に宣言したのが2018年3月。
多くの人々が苦労しているであろう深層学習の実装について現実的な手段の一つとして期待できるのではないでしょうか？

今..."><meta content="https://qiita.com/koppe/items/71328b67c5f63e45369c" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#,RaspberryPi,Windows10IoTCore,ONNX,WindowsML" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 1nzh4zz 38fzdi helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-1nzh4zz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:16px 32px;background-color:#FBE69E;color:rgba(0,0,0,0.87);line-height:1.5;font-weight:600;}@media (max-width:770px){.css-1nzh4zz{padding:16px;}}.css-38fzdi{color:#CA832A;margin-right:4px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-9f664ee6-ae08-491c-8c84-d683db5c7e17"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Fkoppe%2Fitems%2F71328b67c5f63e45369c">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Fkoppe%2Fitems%2F71328b67c5f63e45369c">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-9f664ee6-ae08-491c-8c84-d683db5c7e17">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2018-09-02T21:26:12.000+09:00","dateModified":"2018-10-21T19:00:59.000+09:00","headline":"RaspberryPi 3 B+ \u0026 Windows10 IoT CoreでONNXモデルを使う","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1VbUZ6Y0dKbGNuSjVVR2tnTXlCQ0t5QW1JRmRwYm1SdmQzTXhNQ0JKYjFRZ1EyOXlaZU9CcDA5T1RsampnNkxqZzRmamc2dmpncExrdmJfamdZWSZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTU0JnR4dC1jbGlwPWVsbGlwc2lzJnR4dC1hbGlnbj1jZW50ZXIlMkNtaWRkbGUmcz1hMDZjMDIyODQzM2YyODUxZTRiNzc1MjliODhiNGViMg\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RR3R2Y0hCbCZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTQ1JnR4dC1hbGlnbj1yaWdodCUyQ2JvdHRvbSZzPTZhMTZlNzc1NGQ2YzZiYTg5MjQ1ZmVlNzQ4ZWQwMWNm\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=4c53182b656ef7eb56511ac1469a1569","mainEntityOfPage":"https://qiita.com/koppe/items/71328b67c5f63e45369c","author":{"@type":"Person","address":null,"email":null,"identifier":"koppe","name":"koppe","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F248663%2Fprofile-images%2F1557039463?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=dd934ae8cdd09cc0481d824098bf0a39","url":"https://qiita.com/koppe","description":null,"memberOf":[]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://increments.connpass.com/event/211948/">Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催</a><a target="_blank" id="header_text_message_2" href="https://increments.connpass.com/event/211948/">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"koppe","type":"items","id":"71328b67c5f63e45369c"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"koppe","type":"items","id":"71328b67c5f63e45369c"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_1","message":"Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"koppe","type":"items","id":"71328b67c5f63e45369c"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_2","message":"Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/koppe/items/71328b67c5f63e45369c","location":"/koppe/items/71328b67c5f63e45369c","scheme":"https","host":"qiita.com","port":null,"pathname":"/koppe/items/71328b67c5f63e45369c","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"ZaSh3+K2qheRkMyalt/9rb+C5HE0Qj6JE9II+Am1idANEPMgqVEZvXBX+pPQMP1UInJr0vNmo8vAaIeS/WHMBg==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-8a45b659-f68f-4f05-bbe1-3319c948cf02"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/koppe/items/71328b67c5f63e45369c/likers" class="css-1iupg5d">9</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">13</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/71328b67c5f63e45369c/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/koppe/items/71328b67c5f63e45369c/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/koppe/items/71328b67c5f63e45369c/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/koppe/items/71328b67c5f63e45369c/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/koppe/items/71328b67c5f63e45369c.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-1nzh4zz"><span class="fa fa-fw fa-warning css-38fzdi"></span><p>More than 1 year has passed since last update.</p></div><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/koppe"><img class="css-100alwu eyfquo10" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/248663/profile-images/1557039463" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/koppe" class="css-10ougpm">@<!-- -->koppe</a><div class="css-1ay9vb9"><span><meta content="2018-09-02T12:26:12Z"/><time dateTime="2018-10-21T10:00:59Z" class="css-m19uds">updated at 2018-10-21</time></span></div></div></div></div></div><h1 class="css-cgzq40">RaspberryPi 3 B+ &amp; Windows10 IoT CoreでONNXモデルを使う</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/raspberrypi" class="css-4czcte">RaspberryPi</a><a href="/tags/windows10iotcore" class="css-4czcte">Windows10IoTCore</a><a href="/tags/onnx" class="css-4czcte">ONNX</a><a href="/tags/windowsml" class="css-4czcte">WindowsML</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div>
<h1>
<span id="この記事について" class="fragment"></span><a href="#%E3%81%93%E3%81%AE%E8%A8%98%E4%BA%8B%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>この記事について</h1>

<p>マイクロソフトがWindows10でのONNXをサポートを公式に宣言したのが2018年3月。<br>
多くの人々が苦労しているであろう深層学習の実装について現実的な手段の一つとして期待できるのではないでしょうか？</p>

<p>今回はONNXのサポートの具合がどんなもんかを勉強を兼ねて確かめてみました。</p>

<h1>
<span id="目標" class="fragment"></span><a href="#%E7%9B%AE%E6%A8%99"><i class="fa fa-link"></i></a>目標</h1>

<p>「RaspberryPi3 Model B+ にて WEBカメラの画像 で推論する」ところまでを目標にします。<br>
（ユニバーサルWindowsアプリで作成するので一般のWindows10でも普通に動作します。）</p>

<h1>
<span id="1準備" class="fragment"></span><a href="#1%E6%BA%96%E5%82%99"><i class="fa fa-link"></i></a>1.準備</h1>

<h2>
<span id="1-1-pc環境の準備" class="fragment"></span><a href="#1-1-pc%E7%92%B0%E5%A2%83%E3%81%AE%E6%BA%96%E5%82%99"><i class="fa fa-link"></i></a>1-1. PC環境の準備</h2>

<p>まずはパソコン側を整えます。</p>

<ul>
<li>Visual Studio 2017</li>
<li><a href="https://www.microsoft.com/en-us/software-download/windowsinsiderpreviewiso" rel="nofollow noopener" target="_blank">Windows10 Insider Preview (Build 17744)</a></li>
<li><a href="https://www.microsoft.com/en-us/software-download/windowsinsiderpreviewSDK" rel="nofollow noopener" target="_blank">Windows10 SDK Insider Preview (Build 17744)</a></li>
</ul>

<p>MSのサイトからダウンロードですね。</p>

<p>Insider Preview版を使用するので安全のために仮想環境などでやるのが良いと思います。<br>
ちなみに私は面倒だったので無謀にもメイン環境を更新してしまいましたが。まぁ何とかなる。</p>

<h2>
<span id="1-2-ラズパイの準備" class="fragment"></span><a href="#1-2-%E3%83%A9%E3%82%BA%E3%83%91%E3%82%A4%E3%81%AE%E6%BA%96%E5%82%99"><i class="fa fa-link"></i></a>1-2. ラズパイの準備</h2>

<p>以下の環境で開発します。</p>

<ul>
<li>RaspberryPi 3 Model B+</li>
<li><a href="https://www.microsoft.com/en-us/software-download/windowsiot" rel="nofollow noopener" target="_blank">Windows IoT Core Technical Preview Build(Build 17744)</a></li>
</ul>

<p>これもInsider Preview版を使用します。</p>

<p>リンク先の中段くらいに以下の記述があると思うので、そこからファイルをダウンロード<br>
（これ以外のビルドはRaspberryPi3B+に焼いても起動しない）</p>

<blockquote>
<p>Additional Insider Preview downloads<br>
　RaspberryPi 3B+ Technical Preview Build 17661</p>
</blockquote>

<p>ダウンロードしたファイルを実行すると、<br>
インストーラーが少々不親切ですが以下のフォルダにイメージファイル(FFUファイル)が出力されます。<br>
C:\Program Files (x86)\Microsoft IoT\FFU\RaspberryPi2</p>

<p>FFUファイルを「Windows10 IoT Core Dashboard」でSDカードに焼けばOKです。<br>
Windows10 IoT Core Dashboardがない人は<a href="https://developer.microsoft.com/ja-jp/windows/iot/Downloads" rel="nofollow noopener" target="_blank">ここから落とす</a></p>

<p>SDカードを刺して起動するとネットワーク経由のOSアップデートが始まるので完了まで放置します。</p>

<h2>
<span id="1-3-onnxモデルを準備" class="fragment"></span><a href="#1-3-onnx%E3%83%A2%E3%83%87%E3%83%AB%E3%82%92%E6%BA%96%E5%82%99"><i class="fa fa-link"></i></a>1-3. ONNXモデルを準備</h2>

<p>自分で作っても良いし、落としてきても良い<br>
<a href="https://github.com/onnx/models" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/onnx/models</a><br>
今回は「mobilenet v2」を使用します。</p>

<p>適当に準備すればいいのだが、どうもモデルサイズが大きいとエラー吐いて読めないので、mobilenetとか小さいモデルが推奨。ちなみにalexnetはラズパイNG、ローカルPCはOKだった。</p>

<p>関係無いけど、ONNXって「オニキス」っていうんですね。少し前まで知らなかった。</p>

<h2>
<span id="1-4-imagenetのクラスidラベル名のデータを用意する" class="fragment"></span><a href="#1-4-imagenet%E3%81%AE%E3%82%AF%E3%83%A9%E3%82%B9id%E3%83%A9%E3%83%99%E3%83%AB%E5%90%8D%E3%81%AE%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92%E7%94%A8%E6%84%8F%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>1-4. ImageNetのクラスIDラベル名のデータを用意する</h2>

<p>上記のgithubページから飛ぶことができます。<br>
リンクも貼っておきます。<br>
<a href="https://github.com/onnx/models/blob/master/models/image_classification/synset.txt" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/onnx/models/blob/master/models/image_classification/synset.txt</a><br>
こっちも良いかも<br>
<a href="https://gist.github.com/yrevar/942d3a0ac09ec9e5eb3a" class="autolink" rel="nofollow noopener" target="_blank">https://gist.github.com/yrevar/942d3a0ac09ec9e5eb3a</a></p>

<h1>
<span id="2-ユニバーサルwindowsアプリケーションの作成" class="fragment"></span><a href="#2-%E3%83%A6%E3%83%8B%E3%83%90%E3%83%BC%E3%82%B5%E3%83%ABwindows%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>2. ユニバーサルWindowsアプリケーションの作成</h1>

<p>Windows10 IoT Core用のアプリケーションはユニバーサルWindowsアプリケーション(UWP)として作成します。<br>
ソリューション全体はgithubを参照ください(<a href="https://github.com/nkoppe/UWP_ONNX_Demo" rel="nofollow noopener" target="_blank">Github</a>)</p>

<h2>
<span id="2-1-プロジェクトの作成" class="fragment"></span><a href="#2-1-%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>2-1. プロジェクトの作成</h2>

<p>Visual C# → Windowsユニバーサル → 空白のアプリ(ユニバーサルWindows)　を選択します。<br>
ターゲットバージョンと最小バージョンは、今回は「Build 17738」をターゲットにします。<br>
<a href="https://camo.qiitausercontent.com/8693f674127ba033b27d13f784e5dfe1b76fe08b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3234383636332f39633638383239622d383834342d346136352d373836342d3630623039333435666632342e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F248663%2F9c68829b-8844-4a65-7864-60b09345ff24.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=f32c5d0e74391c0de6dfcffb4579216d" alt="image.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/248663/9c68829b-8844-4a65-7864-60b09345ff24.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F248663%2F9c68829b-8844-4a65-7864-60b09345ff24.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=996c3265048e15a6e4e863ecb3f87b33 1x" loading="lazy"></a></p>

<h2>
<span id="2-2-モデルの投入" class="fragment"></span><a href="#2-2-%E3%83%A2%E3%83%87%E3%83%AB%E3%81%AE%E6%8A%95%E5%85%A5"><i class="fa fa-link"></i></a>2-2. モデルの投入</h2>

<p>コマンドプロンプトを起動します。<br>
先ほどダウンロードしたモデルファイルがあるディレクトリに移動し、以下のコマンドでモデルのラッパークラスを生成します。</p>

<div class="code-frame" data-lang="">
<div class="code-lang"><span class="bold">コマンドプロンプト</span></div>
<div class="highlight"><pre class="with-code"><code>&gt; "C:\Program Files (x86)\Windows Kits\10\bin\10.0.17738.0\x64\mlgen.exe" -i MobileNetv2-1.0.onnx -l CS -n MobileNet -o MobileNetv2-1.0.cs
</code></pre></div>
</div>

<p>必要に応じてファイル名を変えてください。</p>

<p>すると「MobileNetv2-1.0.cs」が生成されます。<br>
中身は以下のような感じになります。</p>

<p>(2018.10.11追記)<br>
 Windows10 ver1809リリースに伴い、最新のmlgen.exeは以下のフォルダにあります。<br>
「C:\Program Files (x86)\Windows Kits\10\bin\10.0.17763.0\x64\mlgen.exe」</p>

<div class="code-frame" data-lang="c#">
<div class="code-lang"><span class="bold">C#</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">sealed</span> <span class="k">class</span> <span class="nc">Input</span>
<span class="p">{</span>
  <span class="k">public</span> <span class="n">TensorFloat</span> <span class="n">data</span><span class="p">;</span> <span class="c1">// shape(1,3,224,224)</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">sealed</span> <span class="k">class</span> <span class="nc">Output</span>
<span class="p">{</span>
  <span class="k">public</span> <span class="n">TensorFloat</span> <span class="n">mobilenetv20_output_flatten0_reshape0</span><span class="p">;</span> <span class="c1">// shape(1,1000)</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">sealed</span> <span class="k">class</span> <span class="nc">Model</span>
<span class="p">{</span>
  <span class="k">private</span> <span class="n">LearningModel</span> <span class="n">model</span><span class="p">;</span>
  <span class="k">private</span> <span class="n">LearningModelSession</span> <span class="n">session</span><span class="p">;</span>
  <span class="k">private</span> <span class="n">LearningModelBinding</span> <span class="n">binding</span><span class="p">;</span>
  <span class="k">public</span> <span class="k">static</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">Model</span><span class="p">&gt;</span> <span class="nf">CreateFromStreamAsync</span><span class="p">(</span><span class="n">IRandomAccessStreamReference</span> <span class="n">stream</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">Model</span> <span class="n">learningModel</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Model</span><span class="p">();</span>
    <span class="n">learningModel</span><span class="p">.</span><span class="n">model</span> <span class="p">=</span> <span class="k">await</span> <span class="n">LearningModel</span><span class="p">.</span><span class="nf">LoadFromStreamAsync</span><span class="p">(</span><span class="n">stream</span><span class="p">);</span>
    <span class="n">learningModel</span><span class="p">.</span><span class="n">session</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">LearningModelSession</span><span class="p">(</span><span class="n">learningModel</span><span class="p">.</span><span class="n">model</span><span class="p">);</span>
    <span class="n">learningModel</span><span class="p">.</span><span class="n">binding</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">LearningModelBinding</span><span class="p">(</span><span class="n">learningModel</span><span class="p">.</span><span class="n">session</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">learningModel</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">Output</span><span class="p">&gt;</span> <span class="nf">EvaluateAsync</span><span class="p">(</span><span class="n">Input</span> <span class="n">input</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">binding</span><span class="p">.</span><span class="nf">Bind</span><span class="p">(</span><span class="s">"data"</span><span class="p">,</span> <span class="n">input</span><span class="p">.</span><span class="n">data</span><span class="p">);</span>
    <span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="k">await</span> <span class="n">session</span><span class="p">.</span><span class="nf">EvaluateAsync</span><span class="p">(</span><span class="n">binding</span><span class="p">,</span> <span class="s">"0"</span><span class="p">);</span>
    <span class="kt">var</span> <span class="n">output</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Output</span><span class="p">();</span>
    <span class="n">output</span><span class="p">.</span><span class="n">mobilenetv20_output_flatten0_reshape0</span> <span class="p">=</span> <span class="n">result</span><span class="p">.</span><span class="n">Outputs</span><span class="p">[</span><span class="s">"mobilenetv20_output_flatten0_reshape0"</span><span class="p">]</span> <span class="k">as</span> <span class="n">TensorFloat</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">output</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>モデルの入力クラス、出力クラス、モデル本体クラスの３つが生成されました。</p>

<p>&lt;余談&gt;<br>
WindowsMLはWindows10 version 1803から実装されていますが、どうも現在は仕様変更が入っているようです。1803ではTensorFloat型は未実装です。もうすぐリリースのversion 1809以降はTensorFloat型が基本になるんじゃないでしょうか。<br>
&lt;余談終わり&gt;</p>

<p>次に、プロジェクトへモデルを追加します。<br>
モデルファイルをAssetsフォルダへ、ラッパークラスはプロジェクトのルートに置いておきます。<br>
<a href="https://camo.qiitausercontent.com/6f9fae14175f62ea7930ff21ee1c4b653e149f0a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3234383636332f65316166303035392d336262382d373631622d333935312d3538646130343436613037362e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F248663%2Fe1af0059-3bb8-761b-3951-58da0446a076.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=e9307b2ed251cf0074d1c4ce8fb0b67b" alt="image.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/248663/e1af0059-3bb8-761b-3951-58da0446a076.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F248663%2Fe1af0059-3bb8-761b-3951-58da0446a076.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=ffefb22e8f3c0b9fd62d197fd23f7e4d 1x" loading="lazy"></a><br>
こんな感じ<br>
この時、モデルファイルのプロパティを以下のように変更しておきます。</p>

<ul>
<li> ビルドアクション：　コンテンツ</li>
<li> 出力ディレクトリにコピー:　新しい場合はコピーする</li>
</ul>

<h2>
<span id="2-3-コードを書く" class="fragment"></span><a href="#2-3-%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E6%9B%B8%E3%81%8F"><i class="fa fa-link"></i></a>2-3. コードを書く</h2>

<p>粛々とコーディングします。<br>
3分クッキングのように軽くペタッと貼っていますが、うまくいかなくて苦労しました。<br>
この記事を参考にさせていただきました。</p>

<blockquote>
<p><a href="https://qiita.com/ymym3412/items/05a7cecf81309a3f131e" id="reference-2a792acd8e2a41530512">3分で分かる！ONNXフォーマットとWindows Machine Learning！</a></p>
</blockquote>

<p>大事そうなところや苦労したポイントだけピックアップして書きます。<br>
コード全体はgithubを参照ください(<a href="https://github.com/nkoppe/UWP_ONNX_Demo" rel="nofollow noopener" target="_blank">Github</a>)</p>

<h3>
<span id="モデルを読み込む" class="fragment"></span><a href="#%E3%83%A2%E3%83%87%E3%83%AB%E3%82%92%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%82%80"><i class="fa fa-link"></i></a>モデルを読み込む</h3>

<p>作成したラッパークラスの中身を確認し、そのクラス名のインスタンスを作成します。<br>
今回は「Model」というクラスが生成されているので、以下のコードになります。</p>

<div class="code-frame" data-lang="c#">
<div class="code-lang"><span class="bold">C#</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">try</span>
<span class="p">{</span>
  <span class="c1">//モデルをロードする</span>
  <span class="n">Windows</span><span class="p">.</span><span class="n">Storage</span><span class="p">.</span><span class="n">StorageFile</span> <span class="n">modelFile</span> <span class="p">=</span>
    <span class="k">await</span> <span class="n">Windows</span><span class="p">.</span><span class="n">Storage</span><span class="p">.</span><span class="n">StorageFile</span><span class="p">.</span><span class="nf">GetFileFromApplicationUriAsync</span><span class="p">(</span>
                        <span class="k">new</span> <span class="nf">Uri</span><span class="p">(</span><span class="s">"ms-appx:///Assets/mobilenet.onnx"</span><span class="p">));</span>        <span class="c1">//AssetsからonnxモデルのStorageFileオブジェクトを取得</span>
  <span class="c1">//読み込んだ後メンバ変数へ格納</span>
  <span class="n">ModelGen</span> <span class="p">=</span> <span class="k">await</span> <span class="n">Model</span><span class="p">.</span><span class="nf">CreateFromStreamAsync</span><span class="p">(</span><span class="n">modelFile</span><span class="p">);</span>  <span class="c1">//ModelGenはMainPageクラスのメンバ変数</span>
<span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">Debug</span><span class="p">.</span><span class="nf">Print</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="nf">ToString</span><span class="p">());</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>モデルを読み込むタイミングとしては、UIロード完了イベントなどが良いと思います。</p>

<h3>
<span id="カメラから画像を取得" class="fragment"></span><a href="#%E3%82%AB%E3%83%A1%E3%83%A9%E3%81%8B%E3%82%89%E7%94%BB%E5%83%8F%E3%82%92%E5%8F%96%E5%BE%97"><i class="fa fa-link"></i></a>カメラから画像を取得</h3>

<p>今回は、スレッドタイマを使用してUIとは別スレッドでWEBカメラから画像を読み込み推論していきます。</p>

<p>スレッドタイマやWEBカメラの詳細な使い方は他の方の作例を参照ください。<br>
ここでは呼び出しだけ記述しておきます。<br>
まずWEBカメラから画像を取得する処理です。</p>

<div class="code-frame" data-lang="c#">
<div class="code-lang"><span class="bold">C#</span></div>
<div class="highlight"><pre class="with-code"><code><span class="c1">//カメラの初期化は省略</span>

<span class="c1">//画像を取得する</span>
<span class="n">BitmapPixelFormat</span> <span class="n">InputPixelFormat</span> <span class="p">=</span> <span class="n">BitmapPixelFormat</span><span class="p">.</span><span class="n">Bgra8</span><span class="p">;</span>
<span class="k">using</span> <span class="p">(</span><span class="n">VideoFrame</span> <span class="n">previewFrame</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">VideoFrame</span><span class="p">(</span><span class="n">InputPixelFormat</span><span class="p">,</span> <span class="m">640</span><span class="p">,</span> <span class="m">480</span><span class="p">,</span> <span class="n">BitmapAlphaMode</span><span class="p">.</span><span class="n">Ignore</span><span class="p">))</span>
<span class="p">{</span>
  <span class="c1">//フレームを取得</span>
  <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="n">mediaCapture</span><span class="p">.</span><span class="nf">GetPreviewFrameAsync</span><span class="p">(</span><span class="n">previewFrame</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">previewFrame</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>       <span class="c1">//フレームを正しく取得できた時</span>
  <span class="p">{</span>
    <span class="c1">//画像を変換して推論する処理（後述）</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>書き出しはこんな感じ。このスコープの中に処理を実装していきます。</p>

<p>※ちなみに、WebカメラにロジクールC270を使うと怪しい動作をする。大人しく違うWebカメラを使うのが良い。海外でも同じ報告が上がっていたのでどうもUWPのライブラリの問題の気がする。<br>
（ローカルx86/x64環境で実行すると例外を吐いてフレームが取得できない、リモートARM環境は映像がちらつくが一応動く）</p>

<h3>
<span id="キャプチャ画像をリサイズする" class="fragment"></span><a href="#%E3%82%AD%E3%83%A3%E3%83%97%E3%83%81%E3%83%A3%E7%94%BB%E5%83%8F%E3%82%92%E3%83%AA%E3%82%B5%E3%82%A4%E3%82%BA%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>キャプチャ画像をリサイズする</h3>

<p>VideoFrameクラスのままでは使えないのでデータ変換をしていきます。<br>
まずはリサイズしつつSoftwareBitmapオブジェクトに変換します</p>

<div class="code-frame" data-lang="c#">
<div class="code-lang"><span class="bold">C#</span></div>
<div class="highlight"><pre class="with-code"><code><span class="c1">//ほしい仕様のSoftwareBitmapを作成</span>
<span class="n">SoftwareBitmap</span> <span class="n">bitmapBuffer</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SoftwareBitmap</span><span class="p">(</span><span class="n">BitmapPixelFormat</span><span class="p">.</span><span class="n">Bgra8</span><span class="p">,</span> <span class="m">224</span><span class="p">,</span> <span class="m">224</span><span class="p">,</span> <span class="n">BitmapAlphaMode</span><span class="p">.</span><span class="n">Ignore</span><span class="p">);</span>

<span class="c1">//SoftwareBitmapでVideoFrameを作成する</span>
<span class="n">VideoFrame</span> <span class="n">buffer</span> <span class="p">=</span> <span class="n">VideoFrame</span><span class="p">.</span><span class="nf">CreateWithSoftwareBitmap</span><span class="p">(</span><span class="n">bitmapBuffer</span><span class="p">);</span>

<span class="c1">//キャプチャしたフレームを作成したVideoFrameへコピーする</span>
<span class="k">await</span> <span class="n">previewFrame</span><span class="p">.</span><span class="nf">CopyToAsync</span><span class="p">(</span><span class="n">buffer</span><span class="p">);</span>

<span class="c1">//SoftwareBitmapを取得する（これはリサイズ済み）</span>
<span class="n">SoftwareBitmap</span> <span class="n">resizedBitmap</span> <span class="p">=</span> <span class="n">buffer</span><span class="p">.</span><span class="n">SoftwareBitmap</span><span class="p">;</span>
</code></pre></div>
</div>

<h3>
<span id="1次元のバイト配列に変換する" class="fragment"></span><a href="#1%E6%AC%A1%E5%85%83%E3%81%AE%E3%83%90%E3%82%A4%E3%83%88%E9%85%8D%E5%88%97%E3%81%AB%E5%A4%89%E6%8F%9B%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>1次元のバイト配列に変換する</h3>

<p>次に、WriteableBitmapに変換し、さらにバイト配列に変換します。</p>

<div class="code-frame" data-lang="c#">
<div class="code-lang"><span class="bold">C#</span></div>
<div class="highlight"><pre class="with-code"><code><span class="c1">//WritableBitmapへ変換する</span>
<span class="n">WriteableBitmap</span> <span class="n">innerBitmap</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
<span class="kt">byte</span><span class="p">[]</span> <span class="n">buf</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
<span class="k">await</span> <span class="n">Dispatcher</span><span class="p">.</span><span class="nf">RunAsync</span><span class="p">(</span><span class="n">Windows</span><span class="p">.</span><span class="n">UI</span><span class="p">.</span><span class="n">Core</span><span class="p">.</span><span class="n">CoreDispatcherPriority</span><span class="p">.</span><span class="n">Normal</span><span class="p">,</span> <span class="k">async</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="n">innerBitmap</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">WriteableBitmap</span><span class="p">(</span><span class="n">resizedBitmap</span><span class="p">.</span><span class="n">PixelWidth</span><span class="p">,</span> <span class="n">resizedBitmap</span><span class="p">.</span><span class="n">PixelHeight</span><span class="p">);</span>

    <span class="n">resizedBitmap</span><span class="p">.</span><span class="nf">CopyToBuffer</span><span class="p">(</span><span class="n">innerBitmap</span><span class="p">.</span><span class="n">PixelBuffer</span><span class="p">);</span>
    <span class="n">buf</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="p">[</span><span class="n">innerBitmap</span><span class="p">.</span><span class="n">PixelBuffer</span><span class="p">.</span><span class="n">Length</span><span class="p">];</span>
    <span class="n">innerBitmap</span><span class="p">.</span><span class="n">PixelBuffer</span><span class="p">.</span><span class="nf">CopyTo</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
  <span class="p">});</span>

<span class="c1">//バッファへコピーする</span>
<span class="c1">//innerBitmap.PixelBuffer.CopyTo(buf);</span>
<span class="n">SoftwareBitmap</span> <span class="n">sb</span> <span class="p">=</span> <span class="n">SoftwareBitmap</span><span class="p">.</span><span class="nf">CreateCopyFromBuffer</span><span class="p">(</span><span class="n">buf</span><span class="p">.</span><span class="nf">AsBuffer</span><span class="p">(),</span> <span class="n">BitmapPixelFormat</span><span class="p">.</span><span class="n">Bgra8</span><span class="p">,</span> <span class="m">224</span><span class="p">,</span><span class="m">224</span><span class="p">,</span> <span class="n">BitmapAlphaMode</span><span class="p">.</span><span class="n">Ignore</span><span class="p">);</span>
</code></pre></div>
</div>

<p>ここで、わざわざラムダ式で実行しているのは、UIと別スレッド(ex.スレッドタイマなど)で実行することを前提にしているためです。</p>

<h3>
<span id="データを整形正規化する" class="fragment"></span><a href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92%E6%95%B4%E5%BD%A2%E6%AD%A3%E8%A6%8F%E5%8C%96%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>データを整形・正規化する</h3>

<p>もう一息です。<br>
1次元配列にできましたが、現在のデータには問題があります。</p>

<ul>
<li>アルファチャンネルがある</li>
<li>MobileNetの入力段は[3,224,224]の形状 (現時点では[224,224,4])</li>
<li>正規化していない(255で割ってない)</li>
</ul>

<p>これを力業で直します。OpenCV使ったりするのも良いかもしれません。<br>
ただ、処理がそこまで遅いかというと遅くないので力業も悪くないと思います。</p>

<div class="code-frame" data-lang="c#">
<div class="code-lang"><span class="bold">C#</span></div>
<div class="highlight"><pre class="with-code"><code><span class="c1">//画像のアルファチャンネル削除と配列形状変更</span>
<span class="kt">byte</span><span class="p">[]</span> <span class="n">buf2</span> <span class="p">=</span> <span class="nf">ConvertImageaArray</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>  <span class="c1">//自作関数</span>

<span class="c1">//正規化しつつfloat配列に変換する</span>
<span class="kt">float</span><span class="p">[]</span> <span class="n">inData</span> <span class="p">=</span> <span class="nf">NormalizeImage</span><span class="p">(</span><span class="n">buf2</span><span class="p">);</span>  <span class="c1">//自作関数</span>

<span class="c1">//----------自作関数は以下の通り------------</span>
<span class="c1">// 画像の行列を[*,*,4]からアルファを消して、さらに[3,*,*]の並びに変換する</span>
<span class="k">private</span> <span class="kt">byte</span><span class="p">[]</span> <span class="nf">ConvertImageaArray</span><span class="p">(</span><span class="kt">byte</span><span class="p">[]</span> <span class="n">src</span><span class="p">)</span>
<span class="p">{</span>
  <span class="c1">//戻り値用の配列を準備</span>
  <span class="kt">byte</span><span class="p">[]</span> <span class="n">res</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="p">[(</span><span class="n">src</span><span class="p">.</span><span class="n">Length</span> <span class="p">/</span> <span class="m">4</span><span class="p">)</span> <span class="p">*</span> <span class="m">3</span><span class="p">];</span>

  <span class="kt">int</span> <span class="n">offset_b</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">offset_g</span> <span class="p">=</span> <span class="n">src</span><span class="p">.</span><span class="n">Length</span> <span class="p">/</span> <span class="m">4</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">offset_r</span> <span class="p">=</span> <span class="n">src</span><span class="p">.</span><span class="n">Length</span> <span class="p">/</span> <span class="m">2</span><span class="p">;</span>

  <span class="kt">int</span> <span class="n">j</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">src</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">i</span> <span class="p">+=</span> <span class="m">4</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">res</span><span class="p">[</span><span class="n">offset_b</span> <span class="p">+</span> <span class="n">j</span><span class="p">]</span> <span class="p">=</span> <span class="n">src</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="n">res</span><span class="p">[</span><span class="n">offset_g</span> <span class="p">+</span> <span class="n">j</span><span class="p">]</span> <span class="p">=</span> <span class="n">src</span><span class="p">[</span><span class="n">i</span> <span class="p">+</span> <span class="m">1</span><span class="p">];</span>
    <span class="n">res</span><span class="p">[</span><span class="n">offset_r</span> <span class="p">+</span> <span class="n">j</span><span class="p">]</span> <span class="p">=</span> <span class="n">src</span><span class="p">[</span><span class="n">i</span> <span class="p">+</span> <span class="m">2</span><span class="p">];</span>
    <span class="n">j</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// 画像の正規化処理</span>
<span class="k">private</span> <span class="kt">float</span><span class="p">[]</span> <span class="nf">NormalizeImage</span><span class="p">(</span><span class="kt">byte</span><span class="p">[]</span> <span class="n">src</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">float</span><span class="p">[]</span> <span class="n">normalized</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">float</span><span class="p">[</span><span class="n">src</span><span class="p">.</span><span class="n">Length</span><span class="p">];</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">src</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
  <span class="p">{</span>
    <span class="n">normalized</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">=</span> <span class="n">src</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">/</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="m">255.0</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">normalized</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>※mobilenet向けの正規化処理、平均値を0にしたり標準偏差で割る必要があるかどうか分からないです。<br>
とりあえず、上記の処理で何となく結果が出るので、ここでは上記の処理だけにしておきます。</p>

<h3>
<span id="モデルに入力して結果を受け取る" class="fragment"></span><a href="#%E3%83%A2%E3%83%87%E3%83%AB%E3%81%AB%E5%85%A5%E5%8A%9B%E3%81%97%E3%81%A6%E7%B5%90%E6%9E%9C%E3%82%92%E5%8F%97%E3%81%91%E5%8F%96%E3%82%8B"><i class="fa fa-link"></i></a>モデルに入力して結果を受け取る</h3>

<p>今までつらつらコードを書きましたが、肝心の推論はたったの数行で終わります。</p>

<div class="code-frame" data-lang="c#">
<div class="code-lang"><span class="bold">C#</span></div>
<div class="highlight"><pre class="with-code"><code><span class="c1">//入力用のテンソルを作成（Windows.AI.MachineLearning.TensorFloatクラス）</span>
<span class="n">TensorFloat</span> <span class="n">tf</span> <span class="p">=</span>
  <span class="n">TensorFloat</span><span class="p">.</span><span class="nf">CreateFromArray</span><span class="p">(</span><span class="k">new</span> <span class="kt">long</span><span class="p">[]</span> <span class="p">{</span> <span class="m">1</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">224</span><span class="p">,</span> <span class="m">224</span> <span class="p">},</span> <span class="n">inData</span><span class="p">);</span>

<span class="c1">//入力用のインスタンスを作成</span>
<span class="n">Input</span> <span class="n">indata</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Input</span><span class="p">();</span>
<span class="n">indata</span><span class="p">.</span><span class="n">data</span> <span class="p">=</span> <span class="n">tf</span><span class="p">;</span>

<span class="c1">//AIモデルにデータを渡すと結果の入ったリストが返る</span>
<span class="n">Output</span> <span class="n">output</span> <span class="p">=</span> <span class="k">await</span> <span class="n">ModelGen</span><span class="p">.</span><span class="nf">EvaluateAsync</span><span class="p">(</span><span class="n">modelInput</span><span class="p">);</span>
</code></pre></div>
</div>

<p>上記のInput型とOutput型は、モデルファイルのラッパークラスに含まれているモノです。<br>
したがって使用するモデルに応じて名称が変わります。</p>

<h3>
<span id="推論結果を表示する" class="fragment"></span><a href="#%E6%8E%A8%E8%AB%96%E7%B5%90%E6%9E%9C%E3%82%92%E8%A1%A8%E7%A4%BA%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>推論結果を表示する</h3>

<p>今回のコードはUIとは別スレッドで実行することを前提にしているのでDispatcher.RunAsyncを使います。</p>

<div class="code-frame" data-lang="c#">
<div class="code-lang"><span class="bold">C#</span></div>
<div class="highlight"><pre class="with-code"><code><span class="c1">//UIスレッドに結果を表示</span>
<span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="n">Dispatcher</span><span class="p">.</span><span class="nf">RunAsync</span><span class="p">(</span><span class="n">Windows</span><span class="p">.</span><span class="n">UI</span><span class="p">.</span><span class="n">Core</span><span class="p">.</span><span class="n">CoreDispatcherPriority</span><span class="p">.</span><span class="n">Normal</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span>
<span class="p">{</span>
  <span class="c1">//予測結果を表示</span>
  <span class="kt">var</span> <span class="n">result_vec</span> <span class="p">=</span> <span class="n">output</span><span class="p">.</span><span class="n">mobilenetv20_output_flatten0_reshape0</span><span class="p">.</span><span class="nf">GetAsVectorView</span><span class="p">();</span>
  <span class="kt">var</span> <span class="n">list</span> <span class="p">=</span> <span class="n">result_vec</span><span class="p">.</span><span class="n">ToArray</span><span class="p">&lt;</span><span class="kt">float</span><span class="p">&gt;();</span>
  <span class="kt">var</span> <span class="n">max1st</span> <span class="p">=</span> <span class="n">list</span><span class="p">.</span><span class="nf">Max</span><span class="p">();</span>
  <span class="kt">var</span> <span class="n">index1st</span> <span class="p">=</span> <span class="n">Array</span><span class="p">.</span><span class="nf">IndexOf</span><span class="p">(</span><span class="n">list</span><span class="p">,</span> <span class="n">max1st</span><span class="p">);</span>     <span class="c1">//最大確率のインデックスを取得</span>

  <span class="kt">string</span> <span class="n">ans</span> <span class="p">=</span> <span class="n">classList</span><span class="p">.</span><span class="n">Classes</span><span class="p">[</span><span class="n">index1st</span><span class="p">].</span><span class="nf">ToString</span><span class="p">();</span>

  <span class="c1">//結果表示</span>
  <span class="k">this</span><span class="p">.</span><span class="n">Text_Result_1st</span><span class="p">.</span><span class="n">Text</span> <span class="p">=</span> <span class="n">ans</span> <span class="p">+</span> <span class="s">":"</span> <span class="p">+</span> <span class="n">max1st</span><span class="p">.</span><span class="nf">ToString</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div>
</div>

<p>結果表示用の「Text_Result_1st」という名前のTextBlockに結果を代入して完了です。<br>
また「classList」のインスタンスは自作の「IDとクラス名のリスト」のクラスです。</p>

<h1>
<span id="3仕上げ" class="fragment"></span><a href="#3%E4%BB%95%E4%B8%8A%E3%81%92"><i class="fa fa-link"></i></a>3.仕上げ</h1>

<p>最後は以下の手順で完了です。</p>

<ol>
<li>デバッグが終わったらリリースビルドを作成する（自動でRaspberryPiの方に転送される）</li>
<li>IoT Dashboardからデバイスポータルを開く</li>
<li>左のメニューから Apps &gt; App maneger に入り、自分がビルドしたAppNameを見つける。</li>
<li>StartupのラジオボタンをONにする</li>
</ol>

<p>以上で、電源投入すると自動でソフトが立ち上がり、延々と推論を繰り返すデバイスができあがります。<br>
起動完了まで3分半くらい？です。遅いわけでは無いですが微妙です。</p>

<h1>
<span id="4感想" class="fragment"></span><a href="#4%E6%84%9F%E6%83%B3"><i class="fa fa-link"></i></a>4.感想</h1>

<p>UWPアプリに関する情報が少なくて以外と苦労しました。<br>
作ってみて改めて感じるのは、Windows10でONNXモデルが扱えるのは大きいです。<br>
ディープラーニング実装のハードルが劇的に下がる気がします。<br>
特に組込機器ではWindows 10 IoT Core/Enterpriseが走ると思うので、C#でソフト作って動作させられます。<br>
現状、ONNXモデルのサポート範囲は広くないかもしれませんが、それでも強力です。</p>

<ul>
<li>SonyのNeural Network ConsoleやMATLABといったローカル環境や、Custom Vision ServiceなどクラウドサービスではGUIベースでモデルを作成・訓練ができ、ONNX出力したり簡単に変換ができるので、フレームワークの使い方を覚える必要がない選択肢が出てくる。</li>
<li>OS本体のインストールだけでONNXが扱えて、ライブラリのバージョンが合わないなどのトラブルがない。</li>
<li>Linuxのようなインストール後のネット接続は不要(セキュリティの問題で現場に入れた設備がネットに接続不可の場合も多い)</li>
<li>リッチなUIを備えたソフトの製作が簡単</li>
<li>OSのサポート期間が長い</li>
</ul>

<p>来年は産業界への深層学習の展開が加速しそうです。<br>
2019年頭には<a href="https://www.lattepanda.com/" rel="nofollow noopener" target="_blank">LATTEPANDA ALPHA</a>が日本でも発売するので盛り上がりそうな気がします。<br>
あとは、NVIDIA JetsonにWindows10 IoTが対応してくれるとすごく助かるのですが・・・。そんな日がくるだろうか？</p>

<h1>
<span id="5参考資料" class="fragment"></span><a href="#5%E5%8F%82%E8%80%83%E8%B3%87%E6%96%99"><i class="fa fa-link"></i></a>5.参考資料</h1>

<p>以下の記事を参考にさせていただきました。ありがとうございます。</p>

<ul>
<li>Custom Vision Serviceから出力したモデルを使ってWindowsML上で物体認識をする　<a href="https://qiita.com/linyixian/items/1ba75afe7bdf93bd53f8" id="reference-583c5c1b294ba485441b">その1</a>　<a href="https://qiita.com/linyixian/items/65e979fa3714a6f1b8af" id="reference-078c17f8f7885fd302b9">その2</a>　<a href="Custom%20Vision%20Service%E3%81%8B%E3%82%89%E5%87%BA%E5%8A%9B%E3%81%97%E3%81%9F%E3%83%A2%E3%83%87%E3%83%AB%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6WindowsML%E4%B8%8A%E3%81%A7%E7%89%A9%E4%BD%93%E8%AA%8D%E8%AD%98%E3%82%92%E3%81%99%E3%82%8B">その3</a>
</li>
<li><a href="https://qiita.com/ymym3412/items/05a7cecf81309a3f131e">3分で分かる！ONNXフォーマットとWindows Machine Learning！</a></li>
</ul>

<h1>
<span id="関連記事" class="fragment"></span><a href="#%E9%96%A2%E9%80%A3%E8%A8%98%E4%BA%8B"><i class="fa fa-link"></i></a>関連記事</h1>

<p>ONNXモデルを作るにあたり、便利なツールであるMMdnnの簡単な解説を書きました。(2018.09.04)<br>
<a href="https://qiita.com/koppe/items/7f85f5411539390c4499" class="autolink" id="reference-0e908d671c906fac1974">https://qiita.com/koppe/items/7f85f5411539390c4499</a><br>
kerasモデルをONNXに変換できました。ONNXの可能性を感じますね。</p>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Fkoppe%2Fitems%2F71328b67c5f63e45369c&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Fkoppe%2Fitems%2F71328b67c5f63e45369c&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/koppe/items/71328b67c5f63e45369c/likers" class="css-1iupg5d">9</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">13</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/71328b67c5f63e45369c/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/koppe/items/71328b67c5f63e45369c/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/koppe/items/71328b67c5f63e45369c/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/koppe/items/71328b67c5f63e45369c/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/koppe/items/71328b67c5f63e45369c.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-8a45b659-f68f-4f05-bbe1-3319c948cf02">{"authorAnalyticsTrackingId":"UA-125138348-1","organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-1679f89b-5d85-4c67-af5f-74afe759b18c"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-1679f89b-5d85-4c67-af5f-74afe759b18c">{}</script>
      
<div id="LoginModal-react-component-7c7d2d5f-6f43-4eeb-880f-c8d6e39d1162"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-7c7d2d5f-6f43-4eeb-880f-c8d6e39d1162">{}</script>
      
<div id="StockModal-react-component-6fc6ab80-7177-4d03-be87-c357c51e4537"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-6fc6ab80-7177-4d03-be87-c357c51e4537">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;tVklYkfqAjywYBWugRugP68nfI7H3vohTTAuFovaD1zd7XedDA2xllGnI6fH9KDGMtfzLQD6Z2OeiqF8fw5Kig==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\n\u003ch1\u003e\n\u003cspan id=\"この記事について\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%93%E3%81%AE%E8%A8%98%E4%BA%8B%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eこの記事について\u003c/h1\u003e\n\n\u003cp\u003eマイクロソフトがWindows10でのONNXをサポートを公式に宣言したのが2018年3月。\u003cbr\u003e\n多くの人々が苦労しているであろう深層学習の実装について現実的な手段の一つとして期待できるのではないでしょうか？\u003c/p\u003e\n\n\u003cp\u003e今回はONNXのサポートの具合がどんなもんかを勉強を兼ねて確かめてみました。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"目標\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%9B%AE%E6%A8%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e目標\u003c/h1\u003e\n\n\u003cp\u003e「RaspberryPi3 Model B+ にて WEBカメラの画像 で推論する」ところまでを目標にします。\u003cbr\u003e\n（ユニバーサルWindowsアプリで作成するので一般のWindows10でも普通に動作します。）\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"1準備\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#1%E6%BA%96%E5%82%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e1.準備\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"1-1-pc環境の準備\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#1-1-pc%E7%92%B0%E5%A2%83%E3%81%AE%E6%BA%96%E5%82%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e1-1. PC環境の準備\u003c/h2\u003e\n\n\u003cp\u003eまずはパソコン側を整えます。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eVisual Studio 2017\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://www.microsoft.com/en-us/software-download/windowsinsiderpreviewiso\" rel=\"nofollow noopener\" target=\"_blank\"\u003eWindows10 Insider Preview (Build 17744)\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://www.microsoft.com/en-us/software-download/windowsinsiderpreviewSDK\" rel=\"nofollow noopener\" target=\"_blank\"\u003eWindows10 SDK Insider Preview (Build 17744)\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eMSのサイトからダウンロードですね。\u003c/p\u003e\n\n\u003cp\u003eInsider Preview版を使用するので安全のために仮想環境などでやるのが良いと思います。\u003cbr\u003e\nちなみに私は面倒だったので無謀にもメイン環境を更新してしまいましたが。まぁ何とかなる。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"1-2-ラズパイの準備\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#1-2-%E3%83%A9%E3%82%BA%E3%83%91%E3%82%A4%E3%81%AE%E6%BA%96%E5%82%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e1-2. ラズパイの準備\u003c/h2\u003e\n\n\u003cp\u003e以下の環境で開発します。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eRaspberryPi 3 Model B+\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://www.microsoft.com/en-us/software-download/windowsiot\" rel=\"nofollow noopener\" target=\"_blank\"\u003eWindows IoT Core Technical Preview Build(Build 17744)\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eこれもInsider Preview版を使用します。\u003c/p\u003e\n\n\u003cp\u003eリンク先の中段くらいに以下の記述があると思うので、そこからファイルをダウンロード\u003cbr\u003e\n（これ以外のビルドはRaspberryPi3B+に焼いても起動しない）\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eAdditional Insider Preview downloads\u003cbr\u003e\n　RaspberryPi 3B+ Technical Preview Build 17661\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eダウンロードしたファイルを実行すると、\u003cbr\u003e\nインストーラーが少々不親切ですが以下のフォルダにイメージファイル(FFUファイル)が出力されます。\u003cbr\u003e\nC:\\Program Files (x86)\\Microsoft IoT\\FFU\\RaspberryPi2\u003c/p\u003e\n\n\u003cp\u003eFFUファイルを「Windows10 IoT Core Dashboard」でSDカードに焼けばOKです。\u003cbr\u003e\nWindows10 IoT Core Dashboardがない人は\u003ca href=\"https://developer.microsoft.com/ja-jp/windows/iot/Downloads\" rel=\"nofollow noopener\" target=\"_blank\"\u003eここから落とす\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eSDカードを刺して起動するとネットワーク経由のOSアップデートが始まるので完了まで放置します。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"1-3-onnxモデルを準備\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#1-3-onnx%E3%83%A2%E3%83%87%E3%83%AB%E3%82%92%E6%BA%96%E5%82%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e1-3. ONNXモデルを準備\u003c/h2\u003e\n\n\u003cp\u003e自分で作っても良いし、落としてきても良い\u003cbr\u003e\n\u003ca href=\"https://github.com/onnx/models\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/onnx/models\u003c/a\u003e\u003cbr\u003e\n今回は「mobilenet v2」を使用します。\u003c/p\u003e\n\n\u003cp\u003e適当に準備すればいいのだが、どうもモデルサイズが大きいとエラー吐いて読めないので、mobilenetとか小さいモデルが推奨。ちなみにalexnetはラズパイNG、ローカルPCはOKだった。\u003c/p\u003e\n\n\u003cp\u003e関係無いけど、ONNXって「オニキス」っていうんですね。少し前まで知らなかった。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"1-4-imagenetのクラスidラベル名のデータを用意する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#1-4-imagenet%E3%81%AE%E3%82%AF%E3%83%A9%E3%82%B9id%E3%83%A9%E3%83%99%E3%83%AB%E5%90%8D%E3%81%AE%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92%E7%94%A8%E6%84%8F%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e1-4. ImageNetのクラスIDラベル名のデータを用意する\u003c/h2\u003e\n\n\u003cp\u003e上記のgithubページから飛ぶことができます。\u003cbr\u003e\nリンクも貼っておきます。\u003cbr\u003e\n\u003ca href=\"https://github.com/onnx/models/blob/master/models/image_classification/synset.txt\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/onnx/models/blob/master/models/image_classification/synset.txt\u003c/a\u003e\u003cbr\u003e\nこっちも良いかも\u003cbr\u003e\n\u003ca href=\"https://gist.github.com/yrevar/942d3a0ac09ec9e5eb3a\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://gist.github.com/yrevar/942d3a0ac09ec9e5eb3a\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"2-ユニバーサルwindowsアプリケーションの作成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#2-%E3%83%A6%E3%83%8B%E3%83%90%E3%83%BC%E3%82%B5%E3%83%ABwindows%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E4%BD%9C%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2. ユニバーサルWindowsアプリケーションの作成\u003c/h1\u003e\n\n\u003cp\u003eWindows10 IoT Core用のアプリケーションはユニバーサルWindowsアプリケーション(UWP)として作成します。\u003cbr\u003e\nソリューション全体はgithubを参照ください(\u003ca href=\"https://github.com/nkoppe/UWP_ONNX_Demo\" rel=\"nofollow noopener\" target=\"_blank\"\u003eGithub\u003c/a\u003e)\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"2-1-プロジェクトの作成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#2-1-%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E4%BD%9C%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2-1. プロジェクトの作成\u003c/h2\u003e\n\n\u003cp\u003eVisual C# → Windowsユニバーサル → 空白のアプリ(ユニバーサルWindows)　を選択します。\u003cbr\u003e\nターゲットバージョンと最小バージョンは、今回は「Build 17738」をターゲットにします。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/8693f674127ba033b27d13f784e5dfe1b76fe08b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3234383636332f39633638383239622d383834342d346136352d373836342d3630623039333435666632342e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F248663%2F9c68829b-8844-4a65-7864-60b09345ff24.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=f32c5d0e74391c0de6dfcffb4579216d\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/248663/9c68829b-8844-4a65-7864-60b09345ff24.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F248663%2F9c68829b-8844-4a65-7864-60b09345ff24.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=996c3265048e15a6e4e863ecb3f87b33 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"2-2-モデルの投入\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#2-2-%E3%83%A2%E3%83%87%E3%83%AB%E3%81%AE%E6%8A%95%E5%85%A5\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2-2. モデルの投入\u003c/h2\u003e\n\n\u003cp\u003eコマンドプロンプトを起動します。\u003cbr\u003e\n先ほどダウンロードしたモデルファイルがあるディレクトリに移動し、以下のコマンドでモデルのラッパークラスを生成します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eコマンドプロンプト\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u0026gt; \"C:\\Program Files (x86)\\Windows Kits\\10\\bin\\10.0.17738.0\\x64\\mlgen.exe\" -i MobileNetv2-1.0.onnx -l CS -n MobileNet -o MobileNetv2-1.0.cs\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e必要に応じてファイル名を変えてください。\u003c/p\u003e\n\n\u003cp\u003eすると「MobileNetv2-1.0.cs」が生成されます。\u003cbr\u003e\n中身は以下のような感じになります。\u003c/p\u003e\n\n\u003cp\u003e(2018.10.11追記)\u003cbr\u003e\n Windows10 ver1809リリースに伴い、最新のmlgen.exeは以下のフォルダにあります。\u003cbr\u003e\n「C:\\Program Files (x86)\\Windows Kits\\10\\bin\\10.0.17763.0\\x64\\mlgen.exe」\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eC#\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003esealed\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eInput\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eTensorFloat\u003c/span\u003e \u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// shape(1,3,224,224)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003esealed\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eOutput\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eTensorFloat\u003c/span\u003e \u003cspan class=\"n\"\u003emobilenetv20_output_flatten0_reshape0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// shape(1,1000)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003esealed\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eModel\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eLearningModel\u003c/span\u003e \u003cspan class=\"n\"\u003emodel\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eLearningModelSession\u003c/span\u003e \u003cspan class=\"n\"\u003esession\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eLearningModelBinding\u003c/span\u003e \u003cspan class=\"n\"\u003ebinding\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eModel\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eCreateFromStreamAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIRandomAccessStreamReference\u003c/span\u003e \u003cspan class=\"n\"\u003estream\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eModel\u003c/span\u003e \u003cspan class=\"n\"\u003elearningModel\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eModel\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"n\"\u003elearningModel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emodel\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eLearningModel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLoadFromStreamAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estream\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003elearningModel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esession\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eLearningModelSession\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elearningModel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emodel\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003elearningModel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ebinding\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eLearningModelBinding\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elearningModel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esession\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003elearningModel\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"n\"\u003eTask\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eOutput\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eEvaluateAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eInput\u003c/span\u003e \u003cspan class=\"n\"\u003einput\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ebinding\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eBind\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"data\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003einput\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eresult\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003esession\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEvaluateAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebinding\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"0\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eoutput\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eOutput\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eoutput\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emobilenetv20_output_flatten0_reshape0\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eresult\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eOutputs\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"mobilenetv20_output_flatten0_reshape0\"\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eTensorFloat\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eoutput\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eモデルの入力クラス、出力クラス、モデル本体クラスの３つが生成されました。\u003c/p\u003e\n\n\u003cp\u003e\u0026lt;余談\u0026gt;\u003cbr\u003e\nWindowsMLはWindows10 version 1803から実装されていますが、どうも現在は仕様変更が入っているようです。1803ではTensorFloat型は未実装です。もうすぐリリースのversion 1809以降はTensorFloat型が基本になるんじゃないでしょうか。\u003cbr\u003e\n\u0026lt;余談終わり\u0026gt;\u003c/p\u003e\n\n\u003cp\u003e次に、プロジェクトへモデルを追加します。\u003cbr\u003e\nモデルファイルをAssetsフォルダへ、ラッパークラスはプロジェクトのルートに置いておきます。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/6f9fae14175f62ea7930ff21ee1c4b653e149f0a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3234383636332f65316166303035392d336262382d373631622d333935312d3538646130343436613037362e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F248663%2Fe1af0059-3bb8-761b-3951-58da0446a076.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=e9307b2ed251cf0074d1c4ce8fb0b67b\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/248663/e1af0059-3bb8-761b-3951-58da0446a076.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F248663%2Fe1af0059-3bb8-761b-3951-58da0446a076.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=ffefb22e8f3c0b9fd62d197fd23f7e4d 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\nこんな感じ\u003cbr\u003e\nこの時、モデルファイルのプロパティを以下のように変更しておきます。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e ビルドアクション：　コンテンツ\u003c/li\u003e\n\u003cli\u003e 出力ディレクトリにコピー:　新しい場合はコピーする\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"2-3-コードを書く\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#2-3-%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E6%9B%B8%E3%81%8F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2-3. コードを書く\u003c/h2\u003e\n\n\u003cp\u003e粛々とコーディングします。\u003cbr\u003e\n3分クッキングのように軽くペタッと貼っていますが、うまくいかなくて苦労しました。\u003cbr\u003e\nこの記事を参考にさせていただきました。\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://qiita.com/ymym3412/items/05a7cecf81309a3f131e\" id=\"reference-2a792acd8e2a41530512\"\u003e3分で分かる！ONNXフォーマットとWindows Machine Learning！\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e大事そうなところや苦労したポイントだけピックアップして書きます。\u003cbr\u003e\nコード全体はgithubを参照ください(\u003ca href=\"https://github.com/nkoppe/UWP_ONNX_Demo\" rel=\"nofollow noopener\" target=\"_blank\"\u003eGithub\u003c/a\u003e)\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"モデルを読み込む\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%A2%E3%83%87%E3%83%AB%E3%82%92%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%82%80\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eモデルを読み込む\u003c/h3\u003e\n\n\u003cp\u003e作成したラッパークラスの中身を確認し、そのクラス名のインスタンスを作成します。\u003cbr\u003e\n今回は「Model」というクラスが生成されているので、以下のコードになります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eC#\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003etry\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e//モデルをロードする\u003c/span\u003e\n  \u003cspan class=\"n\"\u003eWindows\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eStorage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eStorageFile\u003c/span\u003e \u003cspan class=\"n\"\u003emodelFile\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eWindows\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eStorage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eStorageFile\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetFileFromApplicationUriAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n                        \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eUri\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"ms-appx:///Assets/mobilenet.onnx\"\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e        \u003cspan class=\"c1\"\u003e//AssetsからonnxモデルのStorageFileオブジェクトを取得\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e//読み込んだ後メンバ変数へ格納\u003c/span\u003e\n  \u003cspan class=\"n\"\u003eModelGen\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eModel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateFromStreamAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emodelFile\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e  \u003cspan class=\"c1\"\u003e//ModelGenはMainPageクラスのメンバ変数\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"k\"\u003ecatch\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eException\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ePrint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToString\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eモデルを読み込むタイミングとしては、UIロード完了イベントなどが良いと思います。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"カメラから画像を取得\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%AB%E3%83%A1%E3%83%A9%E3%81%8B%E3%82%89%E7%94%BB%E5%83%8F%E3%82%92%E5%8F%96%E5%BE%97\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eカメラから画像を取得\u003c/h3\u003e\n\n\u003cp\u003e今回は、スレッドタイマを使用してUIとは別スレッドでWEBカメラから画像を読み込み推論していきます。\u003c/p\u003e\n\n\u003cp\u003eスレッドタイマやWEBカメラの詳細な使い方は他の方の作例を参照ください。\u003cbr\u003e\nここでは呼び出しだけ記述しておきます。\u003cbr\u003e\nまずWEBカメラから画像を取得する処理です。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eC#\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e//カメラの初期化は省略\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e//画像を取得する\u003c/span\u003e\n\u003cspan class=\"n\"\u003eBitmapPixelFormat\u003c/span\u003e \u003cspan class=\"n\"\u003eInputPixelFormat\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eBitmapPixelFormat\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBgra8\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eVideoFrame\u003c/span\u003e \u003cspan class=\"n\"\u003epreviewFrame\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eVideoFrame\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eInputPixelFormat\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e640\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e480\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eBitmapAlphaMode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIgnore\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e//フレームを取得\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emediaCapture\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetPreviewFrameAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epreviewFrame\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epreviewFrame\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e       \u003cspan class=\"c1\"\u003e//フレームを正しく取得できた時\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//画像を変換して推論する処理（後述）\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e書き出しはこんな感じ。このスコープの中に処理を実装していきます。\u003c/p\u003e\n\n\u003cp\u003e※ちなみに、WebカメラにロジクールC270を使うと怪しい動作をする。大人しく違うWebカメラを使うのが良い。海外でも同じ報告が上がっていたのでどうもUWPのライブラリの問題の気がする。\u003cbr\u003e\n（ローカルx86/x64環境で実行すると例外を吐いてフレームが取得できない、リモートARM環境は映像がちらつくが一応動く）\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"キャプチャ画像をリサイズする\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%AD%E3%83%A3%E3%83%97%E3%83%81%E3%83%A3%E7%94%BB%E5%83%8F%E3%82%92%E3%83%AA%E3%82%B5%E3%82%A4%E3%82%BA%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eキャプチャ画像をリサイズする\u003c/h3\u003e\n\n\u003cp\u003eVideoFrameクラスのままでは使えないのでデータ変換をしていきます。\u003cbr\u003e\nまずはリサイズしつつSoftwareBitmapオブジェクトに変換します\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eC#\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e//ほしい仕様のSoftwareBitmapを作成\u003c/span\u003e\n\u003cspan class=\"n\"\u003eSoftwareBitmap\u003c/span\u003e \u003cspan class=\"n\"\u003ebitmapBuffer\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eSoftwareBitmap\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eBitmapPixelFormat\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBgra8\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e224\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e224\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eBitmapAlphaMode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIgnore\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e//SoftwareBitmapでVideoFrameを作成する\u003c/span\u003e\n\u003cspan class=\"n\"\u003eVideoFrame\u003c/span\u003e \u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eVideoFrame\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateWithSoftwareBitmap\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebitmapBuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e//キャプチャしたフレームを作成したVideoFrameへコピーする\u003c/span\u003e\n\u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003epreviewFrame\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCopyToAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e//SoftwareBitmapを取得する（これはリサイズ済み）\u003c/span\u003e\n\u003cspan class=\"n\"\u003eSoftwareBitmap\u003c/span\u003e \u003cspan class=\"n\"\u003eresizedBitmap\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSoftwareBitmap\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"1次元のバイト配列に変換する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#1%E6%AC%A1%E5%85%83%E3%81%AE%E3%83%90%E3%82%A4%E3%83%88%E9%85%8D%E5%88%97%E3%81%AB%E5%A4%89%E6%8F%9B%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e1次元のバイト配列に変換する\u003c/h3\u003e\n\n\u003cp\u003e次に、WriteableBitmapに変換し、さらにバイト配列に変換します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eC#\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e//WritableBitmapへ変換する\u003c/span\u003e\n\u003cspan class=\"n\"\u003eWriteableBitmap\u003c/span\u003e \u003cspan class=\"n\"\u003einnerBitmap\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003ebuf\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eDispatcher\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRunAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eWindows\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUI\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCore\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCoreDispatcherPriority\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNormal\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003einnerBitmap\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eWriteableBitmap\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eresizedBitmap\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePixelWidth\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eresizedBitmap\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePixelHeight\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003eresizedBitmap\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCopyToBuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003einnerBitmap\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePixelBuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ebuf\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003einnerBitmap\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePixelBuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"n\"\u003einnerBitmap\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePixelBuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCopyTo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebuf\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e//バッファへコピーする\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//innerBitmap.PixelBuffer.CopyTo(buf);\u003c/span\u003e\n\u003cspan class=\"n\"\u003eSoftwareBitmap\u003c/span\u003e \u003cspan class=\"n\"\u003esb\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eSoftwareBitmap\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateCopyFromBuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebuf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAsBuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \u003cspan class=\"n\"\u003eBitmapPixelFormat\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBgra8\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e224\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"m\"\u003e224\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eBitmapAlphaMode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIgnore\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eここで、わざわざラムダ式で実行しているのは、UIと別スレッド(ex.スレッドタイマなど)で実行することを前提にしているためです。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"データを整形正規化する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92%E6%95%B4%E5%BD%A2%E6%AD%A3%E8%A6%8F%E5%8C%96%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eデータを整形・正規化する\u003c/h3\u003e\n\n\u003cp\u003eもう一息です。\u003cbr\u003e\n1次元配列にできましたが、現在のデータには問題があります。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eアルファチャンネルがある\u003c/li\u003e\n\u003cli\u003eMobileNetの入力段は[3,224,224]の形状 (現時点では[224,224,4])\u003c/li\u003e\n\u003cli\u003e正規化していない(255で割ってない)\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eこれを力業で直します。OpenCV使ったりするのも良いかもしれません。\u003cbr\u003e\nただ、処理がそこまで遅いかというと遅くないので力業も悪くないと思います。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eC#\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e//画像のアルファチャンネル削除と配列形状変更\u003c/span\u003e\n\u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003ebuf2\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eConvertImageaArray\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebuf\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e  \u003cspan class=\"c1\"\u003e//自作関数\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e//正規化しつつfloat配列に変換する\u003c/span\u003e\n\u003cspan class=\"kt\"\u003efloat\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003einData\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eNormalizeImage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebuf2\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e  \u003cspan class=\"c1\"\u003e//自作関数\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e//----------自作関数は以下の通り------------\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 画像の行列を[*,*,4]からアルファを消して、さらに[3,*,*]の並びに変換する\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"nf\"\u003eConvertImageaArray\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003esrc\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e//戻り値用の配列を準備\u003c/span\u003e\n  \u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003eres\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[(\u003c/span\u003e\u003cspan class=\"n\"\u003esrc\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e \u003cspan class=\"p\"\u003e/\u003c/span\u003e \u003cspan class=\"m\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"m\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\n  \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eoffset_b\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eoffset_g\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esrc\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e \u003cspan class=\"p\"\u003e/\u003c/span\u003e \u003cspan class=\"m\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eoffset_r\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esrc\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e \u003cspan class=\"p\"\u003e/\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n  \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ej\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003esrc\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eoffset_b\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003ej\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esrc\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eoffset_g\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003ej\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esrc\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eoffset_r\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003ej\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esrc\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ej\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// 画像の正規化処理\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"nf\"\u003eNormalizeImage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003esrc\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003enormalized\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003esrc\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n  \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003esrc\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003enormalized\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esrc\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e/\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003efloat\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"m\"\u003e255.0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003enormalized\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e※mobilenet向けの正規化処理、平均値を0にしたり標準偏差で割る必要があるかどうか分からないです。\u003cbr\u003e\nとりあえず、上記の処理で何となく結果が出るので、ここでは上記の処理だけにしておきます。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"モデルに入力して結果を受け取る\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%A2%E3%83%87%E3%83%AB%E3%81%AB%E5%85%A5%E5%8A%9B%E3%81%97%E3%81%A6%E7%B5%90%E6%9E%9C%E3%82%92%E5%8F%97%E3%81%91%E5%8F%96%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eモデルに入力して結果を受け取る\u003c/h3\u003e\n\n\u003cp\u003e今までつらつらコードを書きましたが、肝心の推論はたったの数行で終わります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eC#\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e//入力用のテンソルを作成（Windows.AI.MachineLearning.TensorFloatクラス）\u003c/span\u003e\n\u003cspan class=\"n\"\u003eTensorFloat\u003c/span\u003e \u003cspan class=\"n\"\u003etf\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e\n  \u003cspan class=\"n\"\u003eTensorFloat\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateFromArray\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003elong\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e224\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e224\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e \u003cspan class=\"n\"\u003einData\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e//入力用のインスタンスを作成\u003c/span\u003e\n\u003cspan class=\"n\"\u003eInput\u003c/span\u003e \u003cspan class=\"n\"\u003eindata\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eInput\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"n\"\u003eindata\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e//AIモデルにデータを渡すと結果の入ったリストが返る\u003c/span\u003e\n\u003cspan class=\"n\"\u003eOutput\u003c/span\u003e \u003cspan class=\"n\"\u003eoutput\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eModelGen\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEvaluateAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emodelInput\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e上記のInput型とOutput型は、モデルファイルのラッパークラスに含まれているモノです。\u003cbr\u003e\nしたがって使用するモデルに応じて名称が変わります。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"推論結果を表示する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%8E%A8%E8%AB%96%E7%B5%90%E6%9E%9C%E3%82%92%E8%A1%A8%E7%A4%BA%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e推論結果を表示する\u003c/h3\u003e\n\n\u003cp\u003e今回のコードはUIとは別スレッドで実行することを前提にしているのでDispatcher.RunAsyncを使います。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eC#\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e//UIスレッドに結果を表示\u003c/span\u003e\n\u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDispatcher\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRunAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eWindows\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUI\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCore\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCoreDispatcherPriority\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNormal\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e//予測結果を表示\u003c/span\u003e\n  \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eresult_vec\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eoutput\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emobilenetv20_output_flatten0_reshape0\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetAsVectorView\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n  \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003elist\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eresult_vec\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eToArray\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003efloat\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n  \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003emax1st\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003elist\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eMax\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n  \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eindex1st\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eArray\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eIndexOf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elist\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emax1st\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e     \u003cspan class=\"c1\"\u003e//最大確率のインデックスを取得\u003c/span\u003e\n\n  \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eans\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eclassList\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eClasses\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex1st\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nf\"\u003eToString\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n  \u003cspan class=\"c1\"\u003e//結果表示\u003c/span\u003e\n  \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eText_Result_1st\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eText\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eans\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\":\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003emax1st\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToString\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e結果表示用の「Text_Result_1st」という名前のTextBlockに結果を代入して完了です。\u003cbr\u003e\nまた「classList」のインスタンスは自作の「IDとクラス名のリスト」のクラスです。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"3仕上げ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#3%E4%BB%95%E4%B8%8A%E3%81%92\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e3.仕上げ\u003c/h1\u003e\n\n\u003cp\u003e最後は以下の手順で完了です。\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eデバッグが終わったらリリースビルドを作成する（自動でRaspberryPiの方に転送される）\u003c/li\u003e\n\u003cli\u003eIoT Dashboardからデバイスポータルを開く\u003c/li\u003e\n\u003cli\u003e左のメニューから Apps \u0026gt; App maneger に入り、自分がビルドしたAppNameを見つける。\u003c/li\u003e\n\u003cli\u003eStartupのラジオボタンをONにする\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003e以上で、電源投入すると自動でソフトが立ち上がり、延々と推論を繰り返すデバイスができあがります。\u003cbr\u003e\n起動完了まで3分半くらい？です。遅いわけでは無いですが微妙です。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"4感想\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#4%E6%84%9F%E6%83%B3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e4.感想\u003c/h1\u003e\n\n\u003cp\u003eUWPアプリに関する情報が少なくて以外と苦労しました。\u003cbr\u003e\n作ってみて改めて感じるのは、Windows10でONNXモデルが扱えるのは大きいです。\u003cbr\u003e\nディープラーニング実装のハードルが劇的に下がる気がします。\u003cbr\u003e\n特に組込機器ではWindows 10 IoT Core/Enterpriseが走ると思うので、C#でソフト作って動作させられます。\u003cbr\u003e\n現状、ONNXモデルのサポート範囲は広くないかもしれませんが、それでも強力です。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eSonyのNeural Network ConsoleやMATLABといったローカル環境や、Custom Vision ServiceなどクラウドサービスではGUIベースでモデルを作成・訓練ができ、ONNX出力したり簡単に変換ができるので、フレームワークの使い方を覚える必要がない選択肢が出てくる。\u003c/li\u003e\n\u003cli\u003eOS本体のインストールだけでONNXが扱えて、ライブラリのバージョンが合わないなどのトラブルがない。\u003c/li\u003e\n\u003cli\u003eLinuxのようなインストール後のネット接続は不要(セキュリティの問題で現場に入れた設備がネットに接続不可の場合も多い)\u003c/li\u003e\n\u003cli\u003eリッチなUIを備えたソフトの製作が簡単\u003c/li\u003e\n\u003cli\u003eOSのサポート期間が長い\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e来年は産業界への深層学習の展開が加速しそうです。\u003cbr\u003e\n2019年頭には\u003ca href=\"https://www.lattepanda.com/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eLATTEPANDA ALPHA\u003c/a\u003eが日本でも発売するので盛り上がりそうな気がします。\u003cbr\u003e\nあとは、NVIDIA JetsonにWindows10 IoTが対応してくれるとすごく助かるのですが・・・。そんな日がくるだろうか？\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"5参考資料\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#5%E5%8F%82%E8%80%83%E8%B3%87%E6%96%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e5.参考資料\u003c/h1\u003e\n\n\u003cp\u003e以下の記事を参考にさせていただきました。ありがとうございます。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eCustom Vision Serviceから出力したモデルを使ってWindowsML上で物体認識をする　\u003ca href=\"https://qiita.com/linyixian/items/1ba75afe7bdf93bd53f8\" id=\"reference-583c5c1b294ba485441b\"\u003eその1\u003c/a\u003e　\u003ca href=\"https://qiita.com/linyixian/items/65e979fa3714a6f1b8af\" id=\"reference-078c17f8f7885fd302b9\"\u003eその2\u003c/a\u003e　\u003ca href=\"Custom%20Vision%20Service%E3%81%8B%E3%82%89%E5%87%BA%E5%8A%9B%E3%81%97%E3%81%9F%E3%83%A2%E3%83%87%E3%83%AB%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6WindowsML%E4%B8%8A%E3%81%A7%E7%89%A9%E4%BD%93%E8%AA%8D%E8%AD%98%E3%82%92%E3%81%99%E3%82%8B\"\u003eその3\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://qiita.com/ymym3412/items/05a7cecf81309a3f131e\"\u003e3分で分かる！ONNXフォーマットとWindows Machine Learning！\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"関連記事\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%96%A2%E9%80%A3%E8%A8%98%E4%BA%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e関連記事\u003c/h1\u003e\n\n\u003cp\u003eONNXモデルを作るにあたり、便利なツールであるMMdnnの簡単な解説を書きました。(2018.09.04)\u003cbr\u003e\n\u003ca href=\"https://qiita.com/koppe/items/7f85f5411539390c4499\" class=\"autolink\" id=\"reference-0e908d671c906fac1974\"\u003ehttps://qiita.com/koppe/items/7f85f5411539390c4499\u003c/a\u003e\u003cbr\u003e\nkerasモデルをONNXに変換できました。ONNXの可能性を感じますね。\u003c/p\u003e\n","createdAt":"2018-09-02T12:26:12Z","elapsedYearsFromLastModifiedAt":2,"encryptedId":"q1ki+ec0geAEG3Skbdq6PrrEJCpMZkqT--6xhs9JjZEYGKcSPa--GLjLk6F7I9GEIWkmulsjjw==","isBanned":false,"isDeprecated":true,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2018-10-21T10:00:59Z","likesCount":9,"linkUrl":"https://qiita.com/koppe/items/71328b67c5f63e45369c","organization":null,"originalId":685952,"stockedCount":13,"title":"RaspberryPi 3 B+ \u0026 Windows10 IoT CoreでONNXモデルを使う","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%93%E3%81%AE%E8%A8%98%E4%BA%8B%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\"\u003eこの記事について\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%9B%AE%E6%A8%99\"\u003e目標\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#1%E6%BA%96%E5%82%99\"\u003e1.準備\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#1-1-pc%E7%92%B0%E5%A2%83%E3%81%AE%E6%BA%96%E5%82%99\"\u003e1-1. PC環境の準備\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#1-2-%E3%83%A9%E3%82%BA%E3%83%91%E3%82%A4%E3%81%AE%E6%BA%96%E5%82%99\"\u003e1-2. ラズパイの準備\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#1-3-onnx%E3%83%A2%E3%83%87%E3%83%AB%E3%82%92%E6%BA%96%E5%82%99\"\u003e1-3. ONNXモデルを準備\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#1-4-imagenet%E3%81%AE%E3%82%AF%E3%83%A9%E3%82%B9id%E3%83%A9%E3%83%99%E3%83%AB%E5%90%8D%E3%81%AE%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92%E7%94%A8%E6%84%8F%E3%81%99%E3%82%8B\"\u003e1-4. ImageNetのクラスIDラベル名のデータを用意する\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#2-%E3%83%A6%E3%83%8B%E3%83%90%E3%83%BC%E3%82%B5%E3%83%ABwindows%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E4%BD%9C%E6%88%90\"\u003e2. ユニバーサルWindowsアプリケーションの作成\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#2-1-%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E4%BD%9C%E6%88%90\"\u003e2-1. プロジェクトの作成\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#2-2-%E3%83%A2%E3%83%87%E3%83%AB%E3%81%AE%E6%8A%95%E5%85%A5\"\u003e2-2. モデルの投入\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#2-3-%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E6%9B%B8%E3%81%8F\"\u003e2-3. コードを書く\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%A2%E3%83%87%E3%83%AB%E3%82%92%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%82%80\"\u003eモデルを読み込む\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%AB%E3%83%A1%E3%83%A9%E3%81%8B%E3%82%89%E7%94%BB%E5%83%8F%E3%82%92%E5%8F%96%E5%BE%97\"\u003eカメラから画像を取得\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%AD%E3%83%A3%E3%83%97%E3%83%81%E3%83%A3%E7%94%BB%E5%83%8F%E3%82%92%E3%83%AA%E3%82%B5%E3%82%A4%E3%82%BA%E3%81%99%E3%82%8B\"\u003eキャプチャ画像をリサイズする\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#1%E6%AC%A1%E5%85%83%E3%81%AE%E3%83%90%E3%82%A4%E3%83%88%E9%85%8D%E5%88%97%E3%81%AB%E5%A4%89%E6%8F%9B%E3%81%99%E3%82%8B\"\u003e1次元のバイト配列に変換する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92%E6%95%B4%E5%BD%A2%E6%AD%A3%E8%A6%8F%E5%8C%96%E3%81%99%E3%82%8B\"\u003eデータを整形・正規化する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%A2%E3%83%87%E3%83%AB%E3%81%AB%E5%85%A5%E5%8A%9B%E3%81%97%E3%81%A6%E7%B5%90%E6%9E%9C%E3%82%92%E5%8F%97%E3%81%91%E5%8F%96%E3%82%8B\"\u003eモデルに入力して結果を受け取る\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%8E%A8%E8%AB%96%E7%B5%90%E6%9E%9C%E3%82%92%E8%A1%A8%E7%A4%BA%E3%81%99%E3%82%8B\"\u003e推論結果を表示する\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#3%E4%BB%95%E4%B8%8A%E3%81%92\"\u003e3.仕上げ\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#4%E6%84%9F%E6%83%B3\"\u003e4.感想\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#5%E5%8F%82%E8%80%83%E8%B3%87%E6%96%99\"\u003e5.参考資料\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E9%96%A2%E9%80%A3%E8%A8%98%E4%BA%8B\"\u003e関連記事\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":8120,"uuid":"71328b67c5f63e45369c","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"iQLSA+2IsvM6EwjJ/hel6TqQEAEb--+RXLx2r2X9kWXXHl--seFMr/MJMtg80jYrV//H2Q==","originalId":248663,"description":"","facebookUrl":null,"githubUrl":"https://github.com/nkoppe","isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"","profileImageUrl":"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/248663/profile-images/1557039463","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F248663%2Fprofile-images%2F1557039463?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=dfdc015211357dd0ed6f0d7212926f7b","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F248663%2Fprofile-images%2F1557039463?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=dd934ae8cdd09cc0481d824098bf0a39","urlName":"koppe","websiteUrl":null,"twitterUrl":null,"twitterUrlName":null,"revealedOrganizations":{"edges":[]}},"tags":[{"name":"C#","urlName":"csharp"},{"name":"RaspberryPi","urlName":"raspberrypi"},{"name":"Windows10IoTCore","urlName":"windows10iotcore"},{"name":"ONNX","urlName":"onnx"},{"name":"WindowsML","urlName":"windowsml"}],"followingLikers":{"edges":[]},"comments":{"totalCount":1}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

<!DOCTYPE html><html><head><meta charset="utf-8" /><title>iOSの「ショートカット」アプリとXamarinアプリを連携させてみた話 - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/theiru/items/89df46f0dcf69f108218" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="B6wbpyk4c9XszzfFZgCcRsqBJtTZ2skKyNcBz9e5Cugi69N7x0yrKuGWWCyHOLfn7K21Ns78BEDOnl8BuzMTTQ==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta content="@theiru" name="twitter:creator" /><meta property="og:type" content="article"><meta property="og:title" content="iOSの「ショートカット」アプリとXamarinアプリを連携させてみた話 - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1hVTlUNDRHdTQ0Q000NEszNDRPbjQ0Tzg0NE9JNDRLcjQ0T0Q0NE9JNDRDTjQ0S2k0NE9YNDRPcTQ0R29XR0Z0WVhKcGJ1T0NvdU9EbC1PRHF1T0NrdW1Bby1hUXV1T0JsZU9CbS1PQnB1T0J2LU9Cbi1pcHNRJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NTQmdHh0LWNsaXA9ZWxsaXBzaXMmdHh0LWFsaWduPWNlbnRlciUyQ21pZGRsZSZzPWE5OGVkOTAyM2NhZjAwYmM5Yjc0MGM2NGEyNjgzMjlj&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RSFJvWldseWRRJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NDUmdHh0LWFsaWduPXJpZ2h0JTJDYm90dG9tJnM9YWQzZmUwMTk4MTAzNTYyODdmZmVjOGZjMTk3OWQwZTQ&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=4f117d43ff601ebb873e9a1759a1c48a"><meta property="og:description" content="この記事は KLab Engineer Advent Calendar 2018 の17日目の記事です。


概要

iOSの自動化ツールである「ショートカット」アプリと、x-callback-urlを使った連携をXamarinで実装..."><meta content="https://qiita.com/theiru/items/89df46f0dcf69f108218" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#,iOS,ショートカット,Xamarin" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 1nzh4zz 38fzdi helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-1nzh4zz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:16px 32px;background-color:#FBE69E;color:rgba(0,0,0,0.87);line-height:1.5;font-weight:600;}@media (max-width:770px){.css-1nzh4zz{padding:16px;}}.css-38fzdi{color:#CA832A;margin-right:4px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-46711935-bcf7-4524-bf9a-396cfcc89927"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Ftheiru%2Fitems%2F89df46f0dcf69f108218">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Ftheiru%2Fitems%2F89df46f0dcf69f108218">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-46711935-bcf7-4524-bf9a-396cfcc89927">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2018-12-17T22:01:42.000+09:00","dateModified":"2018-12-17T22:02:51.000+09:00","headline":"iOSの「ショートカット」アプリとXamarinアプリを連携させてみた話","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1hVTlUNDRHdTQ0Q000NEszNDRPbjQ0Tzg0NE9JNDRLcjQ0T0Q0NE9JNDRDTjQ0S2k0NE9YNDRPcTQ0R29XR0Z0WVhKcGJ1T0NvdU9EbC1PRHF1T0NrdW1Bby1hUXV1T0JsZU9CbS1PQnB1T0J2LU9Cbi1pcHNRJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NTQmdHh0LWNsaXA9ZWxsaXBzaXMmdHh0LWFsaWduPWNlbnRlciUyQ21pZGRsZSZzPWE5OGVkOTAyM2NhZjAwYmM5Yjc0MGM2NGEyNjgzMjlj\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RSFJvWldseWRRJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NDUmdHh0LWFsaWduPXJpZ2h0JTJDYm90dG9tJnM9YWQzZmUwMTk4MTAzNTYyODdmZmVjOGZjMTk3OWQwZTQ\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=4f117d43ff601ebb873e9a1759a1c48a","mainEntityOfPage":"https://qiita.com/theiru/items/89df46f0dcf69f108218","author":{"@type":"Person","address":"","email":null,"identifier":"theiru","name":"theiru","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F38187%2Fprofile-images%2F1473687676?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=7382043b092eb97687a8f1846ec87e76","url":"https://qiita.com/theiru","description":"","memberOf":[{"@type":"Organization","address":"東京都港区六本木6-10-1 六本木ヒルズ森タワー","legalName":"KLab 株式会社","image":"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/1f0599f57dd2e2f685c289d2e0033ecbdcef75c3/original.jpg?1608641209","logo":"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/38118b7763a3eb16a11b5acd0f9d72457d9bed3c/original.jpg?1608640519","identifier":"klab","description":"モバイルオンラインゲーム、その他スマートフォン関連サービス、及びサーバーインフラ開発・運用"}]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://zine.qiita.com/interview/202107-hitachi-3/?utm_source=qiita&amp;utm_medium=header-banner">日立の研究者が、2年間ドイツ人工知能研究センターで学んだこと</a><a target="_blank" id="header_text_message_2" href="https://zine.qiita.com/interview/202107-hitachi-3/?utm_source=qiita&amp;utm_medium=header-banner">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"theiru","type":"items","id":"89df46f0dcf69f108218"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"日立の研究者が、2年間ドイツ人工知能研究センターで学んだこと","url":"https://zine.qiita.com/interview/202107-hitachi-3/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"theiru","type":"items","id":"89df46f0dcf69f108218"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":0,"pos_id":"header_text_message_1","message":"日立の研究者が、2年間ドイツ人工知能研究センターで学んだこと","url":"https://zine.qiita.com/interview/202107-hitachi-3/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"theiru","type":"items","id":"89df46f0dcf69f108218"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":0,"pos_id":"header_text_message_2","message":"日立の研究者が、2年間ドイツ人工知能研究センターで学んだこと","url":"https://zine.qiita.com/interview/202107-hitachi-3/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/theiru/items/89df46f0dcf69f108218","location":"/theiru/items/89df46f0dcf69f108218","scheme":"https","host":"qiita.com","port":null,"pathname":"/theiru/items/89df46f0dcf69f108218","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"F+nfuqxPJH1zgHHssk+qxtZgYs7BvUzh7ZsCUob1GGYyrhdmQjv8gn7ZHgVTd4Fn8EzxLNabgavr0lyc6n8Bww==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-810a3482-445a-48dd-ab8c-c6c209022318"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/theiru/items/89df46f0dcf69f108218/likers" class="css-1iupg5d">12</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">5</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/89df46f0dcf69f108218/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/theiru/items/89df46f0dcf69f108218/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/theiru/items/89df46f0dcf69f108218/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/theiru/items/89df46f0dcf69f108218/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/theiru/items/89df46f0dcf69f108218.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-1nzh4zz"><span class="fa fa-fw fa-warning css-38fzdi"></span><p>More than 1 year has passed since last update.</p></div><div class="css-helsa7"><div class="css-8qb8m4"><div class="it-AdcalRibbon"><span><a href="/advent-calendar/2018/klab" class="it-AdcalRibbon_title">KLab Engineer<!-- --> Advent Calendar<!-- --> <!-- -->2018</a>Day 17</span></div><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/theiru"><img class="css-100alwu eyfquo10" src="https://qiita-image-store.s3.amazonaws.com/0/38187/profile-images/1473687676" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/theiru" class="css-10ougpm">@<!-- -->theiru</a><div class="css-1ay9vb9"><span><meta content="2018-12-17T13:01:42Z"/><time dateTime="2018-12-17T13:02:51Z" class="css-m19uds">updated at 2018-12-17</time></span></div></div></div></div></div><h1 class="css-cgzq40">iOSの「ショートカット」アプリとXamarinアプリを連携させてみた話</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/ios" class="css-4czcte">iOS</a><a href="/tags/%e3%82%b7%e3%83%a7%e3%83%bc%e3%83%88%e3%82%ab%e3%83%83%e3%83%88" class="css-4czcte">ショートカット</a><a href="/tags/xamarin" class="css-4czcte">Xamarin</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div><p>この記事は <a href="https://qiita.com/advent-calendar/2018/klab">KLab Engineer Advent Calendar 2018</a> の17日目の記事です。</p>

<h1>
<span id="概要" class="fragment"></span><a href="#%E6%A6%82%E8%A6%81"><i class="fa fa-link"></i></a>概要</h1>

<p>iOSの自動化ツールである「ショートカット」アプリと、x-callback-urlを使った連携をXamarinで実装してみました。</p>

<p><a href="http://x-callback-url.com/" rel="nofollow noopener" target="_blank">x-callback-url</a> のページにはInterAppCommunication(以下IAC)というフレームワーク用意されていますが、これに似たものをXamarin+C#に移植して実装します。</p>

<p>x-callbackも「ショートカット」アプリもiOS用のものなので、iOSユーザが対象です。</p>

<h2>
<span id="ショートカットとは" class="fragment"></span><a href="#%E3%82%B7%E3%83%A7%E3%83%BC%E3%83%88%E3%82%AB%E3%83%83%E3%83%88%E3%81%A8%E3%81%AF"><i class="fa fa-link"></i></a>ショートカットとは</h2>

<p>簡単に説明すると、自動化マクロをビジュアルプログラミングできるiOSアプリです。スクリプトの共有もできます。<br>
昔は「workflow」と呼ばれていたようですが、名称を「ショートカット」に変えたようです。<del>とても検索しづらい。</del></p>

<p>変数や繰り返しなど、基本的なプログラミング機能を備えているほか、「カレンダー」などの標準のiOSアプリだけでなく、「Twitter」「Evernote」などへの操作も標準で用意されています。<br>
SSH経由でスクリプトを実行したり、「Pythonista」(有料アプリ)と連携してPythonコードを実行することもできるようなので、なかなか夢が広がります。</p>

<h2>
<span id="x-callback-urlとは" class="fragment"></span><a href="#x-callback-url%E3%81%A8%E3%81%AF"><i class="fa fa-link"></i></a>x-callback-urlとは</h2>

<p>URLスキームを利用したiOSアプリ間の連携を行うためのプロトコルです。<br>
アプリAがアプリBを起動し、アプリBの処理が終わったらアプリAに処理が戻る、といった事ができます。URLのクエリパラメータとして引数を受け渡しができるので、細かい連携も可能です。</p>

<p>それなりに昔からあるので、<a href="http://x-callback-url.com/apps/" rel="nofollow noopener" target="_blank">いろいろなアプリが対応しているようです</a>。</p>

<p>URLは以下の書式で記述します</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>&lt;scheme&gt;://&lt;host&gt;/&lt;action&gt;?&lt;x-callback parameter&gt;&amp;&lt;action parameter&gt;
</code></pre></div></div>

<ul>
<li>scheme: 起動したいアプリのURLスキーム</li>
<li>host: <code>x-callback-url</code>
</li>
<li>action: 実行したい内容。アプリの実装による。</li>
<li>x-callback parameter: x-callback用の引数。</li>
<li>action parameter: actionに渡す引数。アプリの実装による。接頭辞に<code>x-</code>は付けないほうが良い。</li>
</ul>

<p>x-callback用の引数は以下のものがあります。</p>

<ul>
<li>x-success: 成功した時に起動するURL</li>
<li>x-cancel: キャンセルした時に起動するURL</li>
<li>x-error: エラーの時に起動するURL</li>
<li>x-source: 呼び出したアプリ</li>
</ul>

<h1>
<span id="実装" class="fragment"></span><a href="#%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>実装</h1>

<h2>
<span id="使用環境" class="fragment"></span><a href="#%E4%BD%BF%E7%94%A8%E7%92%B0%E5%A2%83"><i class="fa fa-link"></i></a>使用環境</h2>

<ul>
<li>macOS Mojave 10.14.2</li>
<li>Xcode 10.1(10B61)</li>
<li>Visual Studio Community 2017 for Mac 7.7(build 1868)</li>
<li>iOS 12.1.1(16C50)</li>
<li>ショートカット 2.1.2</li>
</ul>

<h2>
<span id="プロジェクトの作成" class="fragment"></span><a href="#%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>プロジェクトの作成</h2>

<p>x-callback-urlでのみ使うので、なるべくシンプルに<code>iOS&gt;アプリ&gt;単一ビューアプリ</code>で作ります。</p>

<p>チーム設定やプロビジョニングは慣れないとハマるポイントですが、この記事では割愛します。<br>
おもちゃを作って試す程度ならこのあたりの記事が参考になります。<br>
<a href="https://qiita.com/natsumo/items/3f1dd0e7f5471bd4b7d9" id="reference-5991a616fe05263343d7">【Xcode】AppleDeveloperProgramに登録不要！！実機ビルドする方法</a><br>
<a href="https://qiita.com/muak_x/items/98c8e6b36de1f6d012d0" id="reference-110748c59f46872d0bed">Xamarin StudioでiOSの無料実機テストするまでのメモ書き</a></p>

<h2>
<span id="urlスキームで起動できるようにする" class="fragment"></span><a href="#url%E3%82%B9%E3%82%AD%E3%83%BC%E3%83%A0%E3%81%A7%E8%B5%B7%E5%8B%95%E3%81%A7%E3%81%8D%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>URLスキームで起動できるようにする</h2>

<p>URLスキームで起動できるようにするためには<code>Info.plist</code>を変更する必要があります。<br>
以下のように、<code>詳細設定&gt;URLを追加</code>を選択して<code>URLScheme</code>を設定します。<br>
今回は<code>xcallbackurl</code>で起動できるようにしました。<br>
<a href="https://camo.qiitausercontent.com/dbcab0488404aaa4b09dc84c0629c72e14483113/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33383138372f39303563373830392d636330662d613161612d346661342d3435613165626231376435382e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F38187%2F905c7809-cc0f-a1aa-4fa4-45a1ebb17d58.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=69a7aa510a27be3d4706d079969baaf8" alt="urlScheme.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/38187/905c7809-cc0f-a1aa-4fa4-45a1ebb17d58.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F38187%2F905c7809-cc0f-a1aa-4fa4-45a1ebb17d58.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=d118abd60d3d11ccc1e053d1c0388984 1x" loading="lazy"></a></p>

<h2>
<span id="とりあえず雑にコールバックさせてみる" class="fragment"></span><a href="#%E3%81%A8%E3%82%8A%E3%81%82%E3%81%88%E3%81%9A%E9%9B%91%E3%81%AB%E3%82%B3%E3%83%BC%E3%83%AB%E3%83%90%E3%83%83%E3%82%AF%E3%81%95%E3%81%9B%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>とりあえず雑にコールバックさせてみる</h2>

<h3>
<span id="ショートカット側" class="fragment"></span><a href="#%E3%82%B7%E3%83%A7%E3%83%BC%E3%83%88%E3%82%AB%E3%83%83%E3%83%88%E5%81%B4"><i class="fa fa-link"></i></a>ショートカット側</h3>

<ol>
<li>「テキスト」で<code>xcallbackurl://x-callback-url/test</code>を設定する。</li>
<li>
<code>XコールバックのURLを開く</code>に渡す。</li>
</ol>

<p><a href="https://camo.qiitausercontent.com/3195d4ca72cd9122945d53cd9f820bd92ea59730/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33383138372f61373866323138312d623536642d346631322d333765332d3561666563306231326633352e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F38187%2Fa78f2181-b56d-4f12-37e3-5afec0b12f35.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=e24c06f5c266ae794564e645157ed1bc" width="320px" alt="ショートカットの設定" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/38187/a78f2181-b56d-4f12-37e3-5afec0b12f35.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F38187%2Fa78f2181-b56d-4f12-37e3-5afec0b12f35.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=b2f01ca5223a0d685173f1ae34f24f4a 1x" loading="lazy"></a></p>

<p>「ショートカット」アプリがx-callbackのパラメータを埋めてくれるので、実際には以下のように呼び出されます。</p>

<p><code>xcallbackurl://x-callback-url/test?x-cancel=shortcuts-production://x-callback-url/ic-cancel/82FF00AF-11AF-4A86-A94C-E7DB7EB69950&amp;x-error=...</code></p>

<p>ここからx-sucessを取り出して実行してみます</p>

<div class="code-frame" data-lang="c#">
<div class="code-lang"><span class="bold">AppDelegate.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Web</span><span class="p">;</span>
<span class="c1">// 略</span>

<span class="k">namespace</span> <span class="nn">xcallbackurl</span>
<span class="p">{</span>
    <span class="p">[</span><span class="nf">Register</span><span class="p">(</span><span class="s">"AppDelegate"</span><span class="p">)]</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">AppDelegate</span> <span class="p">:</span> <span class="n">UIApplicationDelegate</span>
    <span class="p">{</span>
        <span class="c1">// 略</span>

        <span class="p">[</span><span class="nf">Export</span><span class="p">(</span><span class="s">"application:openURL:options:"</span><span class="p">)]</span>
        <span class="k">public</span> <span class="k">override</span> <span class="kt">bool</span> <span class="nf">OpenUrl</span><span class="p">(</span><span class="n">UIApplication</span> <span class="n">app</span><span class="p">,</span> <span class="n">NSUrl</span> <span class="n">url</span><span class="p">,</span> <span class="n">NSDictionary</span> <span class="n">options</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">uri</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Uri</span><span class="p">(</span><span class="n">url</span><span class="p">.</span><span class="n">AbsoluteString</span><span class="p">);</span>
            <span class="kt">var</span> <span class="n">query</span> <span class="p">=</span> <span class="n">HttpUtility</span><span class="p">.</span><span class="nf">ParseQueryString</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="n">Query</span><span class="p">);</span>
            <span class="kt">var</span> <span class="n">xSuccess</span> <span class="p">=</span> <span class="n">query</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="s">"x-success"</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(!</span><span class="kt">string</span><span class="p">.</span><span class="nf">IsNullOrEmpty</span><span class="p">(</span><span class="n">xSuccess</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="n">app</span><span class="p">.</span><span class="nf">OpenUrl</span><span class="p">(</span><span class="k">new</span> <span class="nf">NSUrl</span><span class="p">(</span><span class="n">xSuccess</span> <span class="p">+</span> <span class="s">"?hoge=fuga"</span><span class="p">),</span> <span class="k">new</span> <span class="nf">NSDictionary</span><span class="p">(),</span> <span class="k">null</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>まずURLスキームで起動された場合のURLからクエリを取り出します。<br>
次に <code>x-success</code> の返答URLに <code>hoge=fuga</code> というパラメータを追加してコールバックを返します。</p>

<p>ちなみに初期状態では <code>System.Web</code> がなかったので、 <code>System.Web.Services</code> のパッケージを追加しました。 <code>プロジェクト&gt;参照の編集</code> から追加できます。</p>

<h3>
<span id="実行してみる" class="fragment"></span><a href="#%E5%AE%9F%E8%A1%8C%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>実行してみる</h3>

<p><a href="https://camo.qiitausercontent.com/2459755ccde8a97ef9d5384ed35858481431bf18/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33383138372f37386462653636612d643734642d373236662d363765652d3632363432326632633164362e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F38187%2F78dbe66a-d74d-726f-67ee-626422f2c1d6.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=759dd5706c8e8a59e8a583a2fe14d83b" width="320px" alt="実行結果" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/38187/78dbe66a-d74d-726f-67ee-626422f2c1d6.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F38187%2F78dbe66a-d74d-726f-67ee-626422f2c1d6.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=aa53aac129cf0b75c09f06297e15a317 1x" loading="lazy"></a></p>

<p>実行すると一度作成したアプリが起動し、すぐに「ショートカット」がアクティブになります。戻り値も受け取れました。</p>

<h2>
<span id="もう少し扱いやすくする" class="fragment"></span><a href="#%E3%82%82%E3%81%86%E5%B0%91%E3%81%97%E6%89%B1%E3%81%84%E3%82%84%E3%81%99%E3%81%8F%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>もう少し扱いやすくする</h2>

<p>提供されているObjective-Cのフレームワーク<a href="https://github.com/tapsandswipes/InterAppCommunication" rel="nofollow noopener" target="_blank">Inter-App Communication(IAC)</a>を参考にC#に移植してみます。「ショートカット」アプリから呼び出せるようになれば十分遊べるので、URLスキームで起動する側ことにしました。</p>

<h3>
<span id="実装のためのインタフェースと管理クラスを作る" class="fragment"></span><a href="#%E5%AE%9F%E8%A3%85%E3%81%AE%E3%81%9F%E3%82%81%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9%E3%81%A8%E7%AE%A1%E7%90%86%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%92%E4%BD%9C%E3%82%8B"><i class="fa fa-link"></i></a>実装のためのインタフェースと管理クラスを作る</h3>

<p>挙動を実装するためのインタフェースとして <code>IXCAganet</code> を作ります。<br>
さらに、インタフェースをまとめるクラスをSingletonで作っておきます。</p>

<div class="code-frame" data-lang="c#">
<div class="code-lang"><span class="bold">IXCAgent.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">delegate</span> <span class="k">void</span> <span class="nf">XCSuccess</span><span class="p">(</span><span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;</span> <span class="n">parameters</span><span class="p">);</span>
<span class="k">public</span> <span class="k">delegate</span> <span class="k">void</span> <span class="nf">XCCancel</span><span class="p">();</span>
<span class="k">public</span> <span class="k">delegate</span> <span class="k">void</span> <span class="nf">XCError</span><span class="p">(</span><span class="kt">string</span> <span class="n">errorMessage</span><span class="p">,</span> <span class="kt">string</span> <span class="n">errorCode</span><span class="p">,</span> <span class="kt">string</span> <span class="n">errorDomain</span><span class="p">);</span>
<span class="k">public</span> <span class="k">interface</span> <span class="nc">IXCAgent</span>
<span class="p">{</span>
    <span class="kt">bool</span> <span class="nf">Supports</span><span class="p">(</span><span class="kt">string</span> <span class="n">action</span><span class="p">);</span>

    <span class="k">void</span> <span class="nf">Perform</span><span class="p">(</span><span class="kt">string</span> <span class="n">action</span><span class="p">,</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;</span> <span class="n">parameters</span><span class="p">,</span>
        <span class="n">XCSuccess</span> <span class="n">onSuccess</span><span class="p">,</span> <span class="n">XCCancel</span> <span class="n">onCancel</span><span class="p">,</span> <span class="n">XCError</span> <span class="n">onError</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</div>

<div class="code-frame" data-lang="c#">
<div class="code-lang"><span class="bold">XCManager.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">XCManager</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">XCManager</span> <span class="n">Instance</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">XCManager</span><span class="p">();</span>
    <span class="k">private</span> <span class="nf">XCManager</span><span class="p">(){}</span>

    <span class="n">HashSet</span><span class="p">&lt;</span><span class="n">IXCAgent</span><span class="p">&gt;</span> <span class="n">agents</span> <span class="p">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="p">&lt;</span><span class="n">IXCAgent</span><span class="p">&gt;();</span>

    <span class="k">public</span> <span class="k">void</span> <span class="nf">AddAgent</span><span class="p">(</span><span class="n">IXCAgent</span> <span class="n">agent</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">agents</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">agent</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="nf">ClearAgegnts</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">agents</span><span class="p">.</span><span class="nf">Clear</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<h3>
<span id="urlをパースする" class="fragment"></span><a href="#url%E3%82%92%E3%83%91%E3%83%BC%E3%82%B9%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>URLをパースする</h3>

<div class="code-frame" data-lang="c#">
<div class="code-lang"><span class="bold">XCManager.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">void</span> <span class="nf">ParseUrl</span><span class="p">(</span><span class="n">NSUrl</span> <span class="n">url</span><span class="p">,</span>
    <span class="k">out</span> <span class="kt">string</span> <span class="n">action</span><span class="p">,</span>
    <span class="k">out</span> <span class="kt">string</span> <span class="n">xSuccess</span><span class="p">,</span> <span class="k">out</span> <span class="kt">string</span> <span class="n">xError</span><span class="p">,</span> <span class="k">out</span> <span class="kt">string</span> <span class="n">xCancel</span><span class="p">,</span>
    <span class="k">out</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;</span> <span class="n">parameters</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">query</span> <span class="p">=</span> <span class="n">HttpUtility</span><span class="p">.</span><span class="nf">ParseQueryString</span><span class="p">(</span><span class="n">url</span><span class="p">.</span><span class="n">Query</span><span class="p">);</span>

    <span class="n">xSuccess</span> <span class="p">=</span> <span class="n">query</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="s">"x-success"</span><span class="p">);</span>
    <span class="n">xError</span> <span class="p">=</span> <span class="n">query</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="s">"x-error"</span><span class="p">);</span>
    <span class="n">xCancel</span> <span class="p">=</span> <span class="n">query</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="s">"x-cancel"</span><span class="p">);</span>

    <span class="n">action</span> <span class="p">=</span> <span class="n">url</span><span class="p">.</span><span class="n">Path</span><span class="p">.</span><span class="nf">TrimStart</span><span class="p">(</span><span class="sc">'/'</span><span class="p">);</span>

    <span class="n">parameters</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;();</span>
    <span class="k">foreach</span><span class="p">(</span><span class="kt">var</span> <span class="n">key</span> <span class="k">in</span> <span class="n">query</span><span class="p">.</span><span class="n">AllKeys</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">k</span> <span class="p">=</span> <span class="n">HttpUtility</span><span class="p">.</span><span class="nf">UrlDecode</span><span class="p">(</span><span class="n">key</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(!</span><span class="n">k</span><span class="p">.</span><span class="nf">StartsWith</span><span class="p">(</span><span class="s">"x-"</span><span class="p">,</span> <span class="n">StringComparison</span><span class="p">.</span><span class="n">Ordinal</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">parameters</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="p">=</span> <span class="n">HttpUtility</span><span class="p">.</span><span class="nf">UrlDecode</span><span class="p">(</span><span class="n">query</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="n">k</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>x-callback用のパラメータとアクション用のパラメータを分解しています。<br>
簡略化のため、使う予定のない <code>x-source</code> は取得していません。<br>
機能実装で利用する <code>parameters</code> はC#で扱いやすいDictionary<br>
で処理します。<br>
URLスキーム自体は同じキーを複数登録できてますが、混乱の元なのでキーが単一になるように制限してみました。</p>

<h3>
<span id="クエリパラメータを含んだnsurlを生成する関数" class="fragment"></span><a href="#%E3%82%AF%E3%82%A8%E3%83%AA%E3%83%91%E3%83%A9%E3%83%A1%E3%83%BC%E3%82%BF%E3%82%92%E5%90%AB%E3%82%93%E3%81%A0nsurl%E3%82%92%E7%94%9F%E6%88%90%E3%81%99%E3%82%8B%E9%96%A2%E6%95%B0"><i class="fa fa-link"></i></a>クエリパラメータを含んだNSUrlを生成する関数</h3>

<div class="code-frame" data-lang="c#">
<div class="code-lang"><span class="bold">XCManager.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="n">NSUrl</span> <span class="nf">CreateUrl</span><span class="p">(</span><span class="kt">string</span> <span class="n">xcbUrl</span><span class="p">,</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;</span> <span class="n">parameters</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">parameters</span> <span class="p">==</span> <span class="k">null</span> <span class="p">||</span> <span class="n">parameters</span><span class="p">.</span><span class="n">Count</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">NSUrl</span><span class="p">(</span><span class="n">xcbUrl</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kt">var</span> <span class="n">url</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringBuilder</span><span class="p">(</span><span class="n">xcbUrl</span><span class="p">);</span>
    <span class="kt">var</span> <span class="n">separate</span> <span class="p">=</span> <span class="sc">'?'</span><span class="p">;</span>
    <span class="k">foreach</span><span class="p">(</span><span class="kt">var</span> <span class="n">parameter</span> <span class="k">in</span> <span class="n">parameters</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">url</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="n">separate</span><span class="p">);</span>
        <span class="n">url</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="n">HttpUtility</span><span class="p">.</span><span class="nf">UrlEncode</span><span class="p">(</span><span class="n">Uri</span><span class="p">.</span><span class="nf">EscapeUriString</span><span class="p">(</span><span class="n">parameter</span><span class="p">.</span><span class="n">Key</span><span class="p">)));</span>
        <span class="n">url</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="sc">'='</span><span class="p">);</span>
        <span class="n">url</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="n">HttpUtility</span><span class="p">.</span><span class="nf">UrlEncode</span><span class="p">(</span><span class="n">Uri</span><span class="p">.</span><span class="nf">EscapeUriString</span><span class="p">(</span><span class="n">parameter</span><span class="p">.</span><span class="n">Value</span><span class="p">)));</span>
        <span class="n">separate</span> <span class="p">=</span> <span class="sc">'&amp;'</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">NSUrl</span><span class="p">(</span><span class="n">url</span><span class="p">.</span><span class="nf">ToString</span><span class="p">());</span>
<span class="p">}</span>

<span class="n">NSUrl</span> <span class="nf">CreateErrorUrl</span><span class="p">(</span><span class="kt">string</span> <span class="n">xcbUrl</span><span class="p">,</span> <span class="kt">string</span> <span class="n">message</span><span class="p">,</span> <span class="kt">string</span> <span class="n">code</span><span class="p">,</span> <span class="kt">string</span> <span class="n">domain</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">parameters</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;()</span>
    <span class="p">{</span>
        <span class="p">{</span> <span class="s">"errorMessage"</span><span class="p">,</span> <span class="n">message</span> <span class="p">},</span>
        <span class="p">{</span> <span class="s">"error-Code"</span><span class="p">,</span> <span class="n">code</span> <span class="p">},</span>
        <span class="p">{</span> <span class="s">"errorDomain"</span><span class="p">,</span> <span class="n">domain</span> <span class="p">}</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="nf">CreateUrl</span><span class="p">(</span><span class="n">xcbUrl</span><span class="p">,</span> <span class="n">parameters</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>DictionaryにまとめたクエリパラメータをURLに変換する処理です。<br>
エラー時のクエリパラメータは、参考にしているIACの実装に合わせたキーを設定するようにしました。</p>

<p>URLエンコードは <code>HttpUtility.UrlEncode(urlString)</code> を単純に呼ぶだけでは駄目でした。<br>
<code>HttpUtility.UrlEncode</code> はスペースを <code>+</code> に変換しますが、ショートカットは <code>%20</code> になる想定で、エンコード方法に差があるのが原因のようです。<br>
<code>HttpUtility.UrlEncode(Uri.EscapeUriString(urlString))</code> とした所、ショートカット側で正しくデコードできる形式になりました。</p>

<p>おそらくこんな面倒な事をしなくても簡単な方法はありそうですが、自分の検索能力では見つからず。。。力不足を実感します。</p>

<h3>
<span id="用意したパーツをつなぎ合わせてixcagentを処理する" class="fragment"></span><a href="#%E7%94%A8%E6%84%8F%E3%81%97%E3%81%9F%E3%83%91%E3%83%BC%E3%83%84%E3%82%92%E3%81%A4%E3%81%AA%E3%81%8E%E5%90%88%E3%82%8F%E3%81%9B%E3%81%A6ixcagent%E3%82%92%E5%87%A6%E7%90%86%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>用意したパーツをつなぎ合わせてIXCAgentを処理する</h3>

<div class="code-frame" data-lang="c#">
<div class="code-lang"><span class="bold">XCManager.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">void</span> <span class="nf">ProcessAgents</span><span class="p">(</span><span class="n">UIApplication</span> <span class="n">app</span><span class="p">,</span> <span class="n">NSUrl</span> <span class="n">url</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">url</span><span class="p">.</span><span class="n">Host</span> <span class="p">!=</span> <span class="s">"x-callback-url"</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nf">ParseUrl</span><span class="p">(</span><span class="n">url</span><span class="p">,</span>
        <span class="k">out</span> <span class="kt">string</span> <span class="n">action</span><span class="p">,</span>
        <span class="k">out</span> <span class="kt">string</span> <span class="n">xSuccess</span><span class="p">,</span> <span class="k">out</span> <span class="kt">string</span> <span class="n">xError</span><span class="p">,</span> <span class="k">out</span> <span class="kt">string</span> <span class="n">xCancel</span><span class="p">,</span>
        <span class="k">out</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;</span> <span class="n">parameters</span><span class="p">);</span>
    <span class="kt">var</span> <span class="n">onSuccess</span> <span class="p">=</span> <span class="n">dict</span> <span class="p">=&gt;</span>
        <span class="n">app</span><span class="p">.</span><span class="nf">OpenUrl</span><span class="p">(</span><span class="nf">CreateUrl</span><span class="p">(</span><span class="n">xSuccess</span><span class="p">,</span> <span class="n">dict</span><span class="p">),</span> <span class="k">new</span> <span class="nf">NSDictionary</span><span class="p">(),</span> <span class="k">null</span><span class="p">);</span>
    <span class="kt">var</span> <span class="n">onCancel</span> <span class="p">=</span> <span class="p">()</span> <span class="p">=&gt;</span>
        <span class="n">app</span><span class="p">.</span><span class="nf">OpenUrl</span><span class="p">(</span><span class="k">new</span> <span class="nf">NSUrl</span><span class="p">(</span><span class="n">xCancel</span><span class="p">),</span> <span class="k">new</span> <span class="nf">NSDictionary</span><span class="p">(),</span> <span class="k">null</span><span class="p">);</span>
    <span class="kt">var</span> <span class="n">onError</span> <span class="p">=</span> <span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">domain</span><span class="p">)</span> <span class="p">=&gt;</span>
        <span class="n">app</span><span class="p">.</span><span class="nf">OpenUrl</span><span class="p">(</span><span class="nf">CreateErrorUrl</span><span class="p">(</span><span class="n">xError</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">domain</span><span class="p">),</span> <span class="k">new</span> <span class="nf">NSDictionary</span><span class="p">(),</span> <span class="k">null</span><span class="p">);</span>

    <span class="k">try</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">supportedAgent</span> <span class="n">agents</span><span class="p">.</span><span class="nf">FirstOrDefault</span><span class="p">(</span><span class="n">agent</span> <span class="p">=&gt;</span> <span class="nf">agent</span><span class="p">(</span><span class="n">action</span><span class="p">));</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">supportedAgent</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">callbackUrl</span> <span class="p">=</span> <span class="nf">CreateErrorUrl</span><span class="p">(</span><span class="n">xError</span><span class="p">,</span> <span class="s">"NotFoundAction"</span><span class="p">,</span> <span class="s">"1"</span><span class="p">,</span> <span class="s">"Client"</span><span class="p">);</span>
            <span class="n">app</span><span class="p">.</span><span class="nf">OpenUrl</span><span class="p">(</span><span class="n">callbackUrl</span><span class="p">,</span> <span class="k">new</span> <span class="nf">NSDictionary</span><span class="p">(),</span> <span class="k">null</span><span class="p">);</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nf">supportedAgent</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">onSuccess</span><span class="p">,</span> <span class="n">onCancel</span><span class="p">,</span> <span class="n">onError</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">var</span> <span class="n">callbackUrl</span> <span class="p">=</span> <span class="nf">CreateErrorUrl</span><span class="p">(</span><span class="n">xError</span><span class="p">,</span> <span class="n">e</span><span class="p">.</span><span class="n">Message</span><span class="p">,</span> <span class="s">"1"</span><span class="p">,</span> <span class="s">"XCManager"</span><span class="p">);</span>
        <span class="n">app</span><span class="p">.</span><span class="nf">OpenUrl</span><span class="p">(</span><span class="n">callbackUrl</span><span class="p">,</span> <span class="k">new</span> <span class="nf">NSDictionary</span><span class="p">(),</span> <span class="k">null</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>大まかに以下の処理をしています。</p>

<ol>
<li>URLをパースする</li>
<li>コールバック用のdelegateを生成する</li>
<li>登録された呼び出したいactionをサポートしているAgentを見つける</li>
<li>Agentが見つかれば処理。なければエラー。</li>
</ol>

<p>Agent中ではどんな実装をしているのか分からないので、雑にtry-catchで囲んでおきます。<br>
エラーを握りつぶしているので若干怖いですが、ここでは規格通りに呼び出されたx-callbackなら確実に完了するような実装に倒しました。</p>

<h3>
<span id="足し算をするだけのactionを作る" class="fragment"></span><a href="#%E8%B6%B3%E3%81%97%E7%AE%97%E3%82%92%E3%81%99%E3%82%8B%E3%81%A0%E3%81%91%E3%81%AEaction%E3%82%92%E4%BD%9C%E3%82%8B"><i class="fa fa-link"></i></a>足し算をするだけのactionを作る</h3>

<p>まず書式を考えます。</p>

<p>入力例: <code>add?lhs=2&amp;rhs=4.2</code><br>
結果例: <code>result=6.2</code></p>

<p>ついでに文字列のエンコーディングを確認するため、出力用の文字を指定できるように拡張しておきます。</p>

<p>入力例: <code>add?lhs=2&amp;rhs=4.2&amp;text=result</code><br>
結果例: <code>result=result%3D6.2</code></p>

<p>これを実装すると以下のような感じになります。<br>
入力ミスに気づきやすいように、actionの引数を処理できない時は専用のエラーを出すようにしました。</p>

<div class="code-frame" data-lang="c#">
<div class="code-lang"><span class="bold">AddAgent.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">class</span> <span class="nc">AddAgent</span> <span class="p">:</span> <span class="n">IXCAgent</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">bool</span> <span class="nf">Supports</span><span class="p">(</span><span class="kt">string</span> <span class="n">action</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">action</span> <span class="p">==</span> <span class="s">"add"</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="nf">Perform</span><span class="p">(</span><span class="kt">string</span> <span class="n">action</span><span class="p">,</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;</span> <span class="n">parameters</span><span class="p">,</span>
        <span class="n">XCSuccess</span> <span class="n">onSuccess</span><span class="p">,</span> <span class="n">XCCancel</span> <span class="n">onCancel</span><span class="p">,</span> <span class="n">XCError</span> <span class="n">onError</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">string</span> <span class="n">result</span><span class="p">;</span>
        <span class="k">try</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">lhs</span> <span class="p">=</span> <span class="n">Double</span><span class="p">.</span><span class="nf">Parse</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s">"lhs"</span><span class="p">]);</span>
            <span class="kt">var</span> <span class="n">rhs</span> <span class="p">=</span> <span class="n">Double</span><span class="p">.</span><span class="nf">Parse</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s">"rhs"</span><span class="p">]);</span>
            <span class="kt">var</span> <span class="n">sum</span> <span class="p">=</span> <span class="n">lhs</span> <span class="p">+</span> <span class="n">rhs</span><span class="p">;</span>
            <span class="n">result</span> <span class="p">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s">"text"</span><span class="p">]</span> <span class="p">+</span> <span class="s">"="</span> <span class="p">+</span> <span class="n">result</span><span class="p">.</span><span class="nf">ToString</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="nf">onError</span><span class="p">(</span><span class="s">"ParameterError"</span><span class="p">,</span> <span class="s">"1"</span><span class="p">,</span> <span class="s">"AddAgent"</span><span class="p">);</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kt">var</span> <span class="n">callbackParams</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;</span>
        <span class="p">{</span>
            <span class="p">{</span> <span class="s">"result"</span><span class="p">,</span> <span class="n">result</span> <span class="p">}</span>
        <span class="p">};</span>
        <span class="nf">onSuccess</span><span class="p">(</span><span class="n">callbackParams</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<h3>
<span id="actionの処理を登録登録解除する" class="fragment"></span><a href="#action%E3%81%AE%E5%87%A6%E7%90%86%E3%82%92%E7%99%BB%E9%8C%B2%E7%99%BB%E9%8C%B2%E8%A7%A3%E9%99%A4%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>actionの処理を登録/登録解除する</h3>

<div class="code-frame" data-lang="c#">
<div class="code-lang"><span class="bold">AppDelegate.cs</span></div>
<div class="highlight"><pre class="with-code"><code>        <span class="k">public</span> <span class="k">override</span> <span class="kt">bool</span> <span class="nf">FinishedLaunching</span><span class="p">(</span><span class="n">UIApplication</span> <span class="n">application</span><span class="p">,</span> <span class="n">NSDictionary</span> <span class="n">launchOptions</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">XCManager</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="nf">AddAgent</span><span class="p">(</span><span class="k">new</span> <span class="nf">AddAgent</span><span class="p">());</span>
            <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">OnResignActivation</span><span class="p">(</span><span class="n">UIApplication</span> <span class="n">application</span><span class="p">)</span>
        <span class="p">{</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">DidEnterBackground</span><span class="p">(</span><span class="n">UIApplication</span> <span class="n">application</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">XCManager</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="nf">ClearAgegnts</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">WillEnterForeground</span><span class="p">(</span><span class="n">UIApplication</span> <span class="n">application</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">XCManager</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="nf">AddAgent</span><span class="p">(</span><span class="k">new</span> <span class="nf">AddAgent</span><span class="p">());</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">OnActivated</span><span class="p">(</span><span class="n">UIApplication</span> <span class="n">application</span><span class="p">)</span>
        <span class="p">{</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">WillTerminate</span><span class="p">(</span><span class="n">UIApplication</span> <span class="n">application</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">XCManager</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="nf">ClearAgegnts</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="p">[</span><span class="nf">Export</span><span class="p">(</span><span class="s">"application:openURL:options:"</span><span class="p">)]</span>
        <span class="k">public</span> <span class="k">override</span> <span class="kt">bool</span> <span class="nf">OpenUrl</span><span class="p">(</span><span class="n">UIApplication</span> <span class="n">app</span><span class="p">,</span> <span class="n">NSUrl</span> <span class="n">url</span><span class="p">,</span> <span class="n">NSDictionary</span> <span class="n">options</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">XCManager</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="nf">ProcessAgents</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">url</span><span class="p">);</span>
            <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
        <span class="p">}</span>
</code></pre></div>
</div>

<p>非アクティブ中にメモリが開放されたりするので、アクティブになった時にactionを登録し直しておきます。<br>
念の為、多重登録にならないように非アクティブになる時には登録を解除しておきます。</p>

<p>こちらの記事を参考にさせていただきました。<br>
<a href="https://qiita.com/mfujiwara/items/cf3d61a96cf4fdfc1162">AppDelegateのメソッドが呼ばれるタイミングと実装すべき内容（iOS11）</a></p>

<h2>
<span id="呼び出してみる" class="fragment"></span><a href="#%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>呼び出してみる</h2>

<h3>
<span id="ショートカットアプリの設定" class="fragment"></span><a href="#%E3%82%B7%E3%83%A7%E3%83%BC%E3%83%88%E3%82%AB%E3%83%83%E3%83%88%E3%82%A2%E3%83%97%E3%83%AA%E3%81%AE%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>「ショートカット」アプリの設定</h3>

<p>以下のように組みました</p>

<table><tr>
 <td>
  <a href="https://camo.qiitausercontent.com/54409f9312b90d53448cb7deceddf7b8124fc10d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33383138372f33393637383438392d333037642d313735322d613239612d6436313537303130633063662e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F38187%2F39678489-307d-1752-a29a-d6157010c0cf.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=a53ea882fab100fe685efd41d8fe3a56" width="320px" alt="shortcut02-1/2" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/38187/39678489-307d-1752-a29a-d6157010c0cf.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F38187%2F39678489-307d-1752-a29a-d6157010c0cf.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=2abe9ef978267d2a5f89918be14afb8d 1x" loading="lazy"></a>
 </td>
 <td>
  <a href="https://camo.qiitausercontent.com/c16a48437ec706a239933bba7a32f35afc08e596/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33383138372f31376230633262612d333537332d613732392d323066382d6438663532666161633534312e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F38187%2F17b0c2ba-3573-a729-20f8-d8f52faac541.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=6e9c62e54edb086c21d7cc7eebe560a1" width="320px" alt="shortcut02-2/2" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/38187/17b0c2ba-3573-a729-20f8-d8f52faac541.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F38187%2F17b0c2ba-3573-a729-20f8-d8f52faac541.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=cc4835d4f3cfa51152f1daa48cdf01a2 1x" loading="lazy"></a>
 </td>
</tr></table>

<h3>
<span id="実行してみる-1" class="fragment"></span><a href="#%E5%AE%9F%E8%A1%8C%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B-1"><i class="fa fa-link"></i></a>実行してみる</h3>

<p><a href="https://camo.qiitausercontent.com/805148f54b3b381a0309151dc3642dcfb7f2c7ff/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33383138372f37306233313537352d363431342d623333612d366137332d6337306538306564663034652e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F38187%2F70b31575-6414-b33a-6a73-c70e80edf04e.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=3c74711f30d01cac7992c33961fe693f" width="320px" alt="shortcut02-result" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/38187/70b31575-6414-b33a-6a73-c70e80edf04e.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F38187%2F70b31575-6414-b33a-6a73-c70e80edf04e.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=20b95cb3140fdfda5fcf0384cc51a43d 1x" loading="lazy"></a></p>

<p><code></code> や <code>&amp;</code> もエンコードで壊れることなく、コールバックを実行できました。</p>

<h1>
<span id="iacを参考に移植してみた所感" class="fragment"></span><a href="#iac%E3%82%92%E5%8F%82%E8%80%83%E3%81%AB%E7%A7%BB%E6%A4%8D%E3%81%97%E3%81%A6%E3%81%BF%E3%81%9F%E6%89%80%E6%84%9F"><i class="fa fa-link"></i></a>IACを参考に移植してみた所感</h1>

<h2>
<span id="エラー処理" class="fragment"></span><a href="#%E3%82%A8%E3%83%A9%E3%83%BC%E5%87%A6%E7%90%86"><i class="fa fa-link"></i></a>エラー処理</h2>

<p>Objective-Cの <code>NSError</code> が元々持っているためだと思いますが、<code>errorCode</code> や <code>errorDomain</code> といった情報を持っているのは便利そうでした。<br>
IACではもう少しうまくエラー処理をしていて、利用者側が意識しなくても、それなりにわかりやすいドメインが選ばれるようになってました。</p>

<h2>
<span id="x-cancel" class="fragment"></span><a href="#x-cancel"><i class="fa fa-link"></i></a>x-cancel</h2>

<p>IACでは <code>IACDelegate</code> に <code>OnSuccess</code> と <code>OnFailure</code> しか用意されていません。<br>
Successがboolで成功かキャンセルを判断するようになっています。<br>
この辺りの意図はあまりつかめませんでした。</p>

<p>キャンセルでは戻り値用の辞書を渡さないので、この記事の実装では使わない引数は受け取らずに済むように、明確に関数を分けました。</p>

<h2>
<span id="実行効率" class="fragment"></span><a href="#%E5%AE%9F%E8%A1%8C%E5%8A%B9%E7%8E%87"><i class="fa fa-link"></i></a>実行効率</h2>

<p>この記事の実装では、利用可能なAgentを毎回取得していますが、IACではactionをキーとした辞書から処理をO(1)で呼び出しているようでした。</p>

<h1>
<span id="その他" class="fragment"></span><a href="#%E3%81%9D%E3%81%AE%E4%BB%96"><i class="fa fa-link"></i></a>その他</h1>

<h2>
<span id="canopenurl" class="fragment"></span><a href="#canopenurl"><i class="fa fa-link"></i></a>CanOpenURL</h2>

<p><code>UIApplication.CanOpenURL</code>という関数があります。指定したSchemeのアプリがインストールできるか調べるための関数です。<br>
いかにも <code>UIApplication.OpenURL</code> を実行する前に呼んだほうが良さそうに見えますが、x-callbackでの用途なら <strong>呼ばないのが正解</strong> のようです。</p>

<p>というのも、iOS9以降では何もしないと <strong>必ずfalseが返ります</strong> 。<br>
正しく判定するには、Info.plistに <code>LSApplicationQueriesSchemes</code> の配列項目を作り、調べたいschemeを列挙しておく必要があります。</p>

<p>x-callbackはどんなアプリから呼び出されるのか分からないので、予め列挙しておくことができません。<br>
どうしてもURL開けたかどうか確認したいなら <code>UIApplication.OpenURL</code> のcallbackで判定すると良さそうです。</p>

<p>ややこしいですが、多分アプリがインストールされているのか判断できてしまうので、プライバシーの点で問題になったのでしょう。</p>

<h2>
<span id="複数の戻り値を返す場合" class="fragment"></span><a href="#%E8%A4%87%E6%95%B0%E3%81%AE%E6%88%BB%E3%82%8A%E5%80%A4%E3%82%92%E8%BF%94%E3%81%99%E5%A0%B4%E5%90%88"><i class="fa fa-link"></i></a>複数の戻り値を返す場合</h2>

<p>この記事では戻り値として1つのクエリパラメータを渡すものしか実装しませんでしたが、複数のクエリパラメータを渡した場合は「ショートカット」アプリでの扱い方が以下のように違います。</p>

<p>1つのクエリパラメータが返った時は、キーを捨てた値だけが文字列として次の処理に渡されます。<br>
複数のクエリパラメータが返った時は、すべてのキーを含んだ辞書として扱います。<br>
辞書はJsonに変換したり、標準機能でキーを指定して取り出すこともできます。</p>

<h1>
<span id="まとめ" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>まとめ</h1>

<p>個人で楽しむ分には困らないくらいには自由に拡張できるようになりました。</p>

<p>これ以外にも、IACのバインディングライブラリを作成してXamarinから呼び出せるようにしたり、「Pythonista」アプリを購入してPythonで拡張したり、標準機能では出来ない拡張機能を呼び出す方法はいろいろあります。</p>

<p>振り返ると、数ある方法の中でも茨の道を進んだ気もしますが、こういうライブラリは偉い人の知恵が詰まっているので、車輪の再発明とはいえ適度に勉強になる題材でした。<br>
自分なりの工夫もいくつか入れてみましたが「いやいや！元の方が良いよ！」などのツッコミもお待ちしております。</p>

<p>最後まで読んで頂き、ありがとうございました。</p>

<h1>
<span id="参考" class="fragment"></span><a href="#%E5%8F%82%E8%80%83"><i class="fa fa-link"></i></a>参考</h1>

<p><a href="https://techlife.cookpad.com/entry/2014/11/14/143841" rel="nofollow noopener" target="_blank">iOSアプリ間連携の実装に x-callback-url を使う</a><br>
<a href="http://yebisupress.dac.co.jp/2015/06/22/x-callback-url%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%81%9F/" rel="nofollow noopener" target="_blank">x-callback-urlを使ってみた</a><br>
<a href="https://qiita.com/nagaoyuriko/items/67c5e262f6e88cd88885" id="reference-d93f0e53a7d11a2b8845">【Swift】特定のアプリがインストールされているかどうかで処理を分ける 2017完全版 - URL SchemesとLSApplicationQueriesSchemes -</a><br>
<a href="https://stackoverflow.com/questions/1517586/how-do-i-replace-all-the-spaces-with-20-in-c" rel="nofollow noopener" target="_blank">How do I replace all the spaces with %20 in C#?</a></p>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Ftheiru%2Fitems%2F89df46f0dcf69f108218&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Ftheiru%2Fitems%2F89df46f0dcf69f108218&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/theiru/items/89df46f0dcf69f108218/likers" class="css-1iupg5d">12</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">5</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/89df46f0dcf69f108218/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/theiru/items/89df46f0dcf69f108218/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/theiru/items/89df46f0dcf69f108218/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/theiru/items/89df46f0dcf69f108218/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/theiru/items/89df46f0dcf69f108218.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-810a3482-445a-48dd-ab8c-c6c209022318">{"authorAnalyticsTrackingId":null,"organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-2cef9f64-ef1f-4807-ba0c-a290dc5cc684"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-2cef9f64-ef1f-4807-ba0c-a290dc5cc684">{}</script>
      
<div id="LoginModal-react-component-7782873e-dd38-416d-8281-b865ae0fc559"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-7782873e-dd38-416d-8281-b865ae0fc559">{}</script>
      
<div id="StockModal-react-component-f639de55-2ecf-4272-8572-6f2713e51f10"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-f639de55-2ecf-4272-8572-6f2713e51f10">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;QYcEIqK0gP7oBit/rkGry6Vog/ERS5NF75RU21CNdwNkwMz+TMBYAeVfRJZPeYBqg0QQEwZtXg/p3QoVPAdupg==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\u003cp\u003eこの記事は \u003ca href=\"https://qiita.com/advent-calendar/2018/klab\"\u003eKLab Engineer Advent Calendar 2018\u003c/a\u003e の17日目の記事です。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"概要\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%A6%82%E8%A6%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e概要\u003c/h1\u003e\n\n\u003cp\u003eiOSの自動化ツールである「ショートカット」アプリと、x-callback-urlを使った連携をXamarinで実装してみました。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"http://x-callback-url.com/\" rel=\"nofollow noopener\" target=\"_blank\"\u003ex-callback-url\u003c/a\u003e のページにはInterAppCommunication(以下IAC)というフレームワーク用意されていますが、これに似たものをXamarin+C#に移植して実装します。\u003c/p\u003e\n\n\u003cp\u003ex-callbackも「ショートカット」アプリもiOS用のものなので、iOSユーザが対象です。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ショートカットとは\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B7%E3%83%A7%E3%83%BC%E3%83%88%E3%82%AB%E3%83%83%E3%83%88%E3%81%A8%E3%81%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eショートカットとは\u003c/h2\u003e\n\n\u003cp\u003e簡単に説明すると、自動化マクロをビジュアルプログラミングできるiOSアプリです。スクリプトの共有もできます。\u003cbr\u003e\n昔は「workflow」と呼ばれていたようですが、名称を「ショートカット」に変えたようです。\u003cdel\u003eとても検索しづらい。\u003c/del\u003e\u003c/p\u003e\n\n\u003cp\u003e変数や繰り返しなど、基本的なプログラミング機能を備えているほか、「カレンダー」などの標準のiOSアプリだけでなく、「Twitter」「Evernote」などへの操作も標準で用意されています。\u003cbr\u003e\nSSH経由でスクリプトを実行したり、「Pythonista」(有料アプリ)と連携してPythonコードを実行することもできるようなので、なかなか夢が広がります。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"x-callback-urlとは\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#x-callback-url%E3%81%A8%E3%81%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ex-callback-urlとは\u003c/h2\u003e\n\n\u003cp\u003eURLスキームを利用したiOSアプリ間の連携を行うためのプロトコルです。\u003cbr\u003e\nアプリAがアプリBを起動し、アプリBの処理が終わったらアプリAに処理が戻る、といった事ができます。URLのクエリパラメータとして引数を受け渡しができるので、細かい連携も可能です。\u003c/p\u003e\n\n\u003cp\u003eそれなりに昔からあるので、\u003ca href=\"http://x-callback-url.com/apps/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eいろいろなアプリが対応しているようです\u003c/a\u003e。\u003c/p\u003e\n\n\u003cp\u003eURLは以下の書式で記述します\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u0026lt;scheme\u0026gt;://\u0026lt;host\u0026gt;/\u0026lt;action\u0026gt;?\u0026lt;x-callback parameter\u0026gt;\u0026amp;\u0026lt;action parameter\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cul\u003e\n\u003cli\u003escheme: 起動したいアプリのURLスキーム\u003c/li\u003e\n\u003cli\u003ehost: \u003ccode\u003ex-callback-url\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003eaction: 実行したい内容。アプリの実装による。\u003c/li\u003e\n\u003cli\u003ex-callback parameter: x-callback用の引数。\u003c/li\u003e\n\u003cli\u003eaction parameter: actionに渡す引数。アプリの実装による。接頭辞に\u003ccode\u003ex-\u003c/code\u003eは付けないほうが良い。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003ex-callback用の引数は以下のものがあります。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003ex-success: 成功した時に起動するURL\u003c/li\u003e\n\u003cli\u003ex-cancel: キャンセルした時に起動するURL\u003c/li\u003e\n\u003cli\u003ex-error: エラーの時に起動するURL\u003c/li\u003e\n\u003cli\u003ex-source: 呼び出したアプリ\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"実装\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%9F%E8%A3%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e実装\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"使用環境\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BD%BF%E7%94%A8%E7%92%B0%E5%A2%83\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e使用環境\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003emacOS Mojave 10.14.2\u003c/li\u003e\n\u003cli\u003eXcode 10.1(10B61)\u003c/li\u003e\n\u003cli\u003eVisual Studio Community 2017 for Mac 7.7(build 1868)\u003c/li\u003e\n\u003cli\u003eiOS 12.1.1(16C50)\u003c/li\u003e\n\u003cli\u003eショートカット 2.1.2\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"プロジェクトの作成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E4%BD%9C%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eプロジェクトの作成\u003c/h2\u003e\n\n\u003cp\u003ex-callback-urlでのみ使うので、なるべくシンプルに\u003ccode\u003eiOS\u0026gt;アプリ\u0026gt;単一ビューアプリ\u003c/code\u003eで作ります。\u003c/p\u003e\n\n\u003cp\u003eチーム設定やプロビジョニングは慣れないとハマるポイントですが、この記事では割愛します。\u003cbr\u003e\nおもちゃを作って試す程度ならこのあたりの記事が参考になります。\u003cbr\u003e\n\u003ca href=\"https://qiita.com/natsumo/items/3f1dd0e7f5471bd4b7d9\" id=\"reference-5991a616fe05263343d7\"\u003e【Xcode】AppleDeveloperProgramに登録不要！！実機ビルドする方法\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://qiita.com/muak_x/items/98c8e6b36de1f6d012d0\" id=\"reference-110748c59f46872d0bed\"\u003eXamarin StudioでiOSの無料実機テストするまでのメモ書き\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"urlスキームで起動できるようにする\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#url%E3%82%B9%E3%82%AD%E3%83%BC%E3%83%A0%E3%81%A7%E8%B5%B7%E5%8B%95%E3%81%A7%E3%81%8D%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eURLスキームで起動できるようにする\u003c/h2\u003e\n\n\u003cp\u003eURLスキームで起動できるようにするためには\u003ccode\u003eInfo.plist\u003c/code\u003eを変更する必要があります。\u003cbr\u003e\n以下のように、\u003ccode\u003e詳細設定\u0026gt;URLを追加\u003c/code\u003eを選択して\u003ccode\u003eURLScheme\u003c/code\u003eを設定します。\u003cbr\u003e\n今回は\u003ccode\u003excallbackurl\u003c/code\u003eで起動できるようにしました。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/dbcab0488404aaa4b09dc84c0629c72e14483113/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33383138372f39303563373830392d636330662d613161612d346661342d3435613165626231376435382e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F38187%2F905c7809-cc0f-a1aa-4fa4-45a1ebb17d58.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=69a7aa510a27be3d4706d079969baaf8\" alt=\"urlScheme.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/38187/905c7809-cc0f-a1aa-4fa4-45a1ebb17d58.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F38187%2F905c7809-cc0f-a1aa-4fa4-45a1ebb17d58.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=d118abd60d3d11ccc1e053d1c0388984 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"とりあえず雑にコールバックさせてみる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%A8%E3%82%8A%E3%81%82%E3%81%88%E3%81%9A%E9%9B%91%E3%81%AB%E3%82%B3%E3%83%BC%E3%83%AB%E3%83%90%E3%83%83%E3%82%AF%E3%81%95%E3%81%9B%E3%81%A6%E3%81%BF%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eとりあえず雑にコールバックさせてみる\u003c/h2\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"ショートカット側\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B7%E3%83%A7%E3%83%BC%E3%83%88%E3%82%AB%E3%83%83%E3%83%88%E5%81%B4\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eショートカット側\u003c/h3\u003e\n\n\u003col\u003e\n\u003cli\u003e「テキスト」で\u003ccode\u003excallbackurl://x-callback-url/test\u003c/code\u003eを設定する。\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eXコールバックのURLを開く\u003c/code\u003eに渡す。\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/3195d4ca72cd9122945d53cd9f820bd92ea59730/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33383138372f61373866323138312d623536642d346631322d333765332d3561666563306231326633352e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F38187%2Fa78f2181-b56d-4f12-37e3-5afec0b12f35.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=e24c06f5c266ae794564e645157ed1bc\" width=\"320px\" alt=\"ショートカットの設定\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/38187/a78f2181-b56d-4f12-37e3-5afec0b12f35.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F38187%2Fa78f2181-b56d-4f12-37e3-5afec0b12f35.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=b2f01ca5223a0d685173f1ae34f24f4a 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e「ショートカット」アプリがx-callbackのパラメータを埋めてくれるので、実際には以下のように呼び出されます。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003excallbackurl://x-callback-url/test?x-cancel=shortcuts-production://x-callback-url/ic-cancel/82FF00AF-11AF-4A86-A94C-E7DB7EB69950\u0026amp;x-error=...\u003c/code\u003e\u003c/p\u003e\n\n\u003cp\u003eここからx-sucessを取り出して実行してみます\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eAppDelegate.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Web\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 略\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003excallbackurl\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eRegister\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"AppDelegate\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eAppDelegate\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eUIApplicationDelegate\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 略\u003c/span\u003e\n\n        \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eExport\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"application:openURL:options:\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eoverride\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"nf\"\u003eOpenUrl\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eUIApplication\u003c/span\u003e \u003cspan class=\"n\"\u003eapp\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eNSUrl\u003c/span\u003e \u003cspan class=\"n\"\u003eurl\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eNSDictionary\u003c/span\u003e \u003cspan class=\"n\"\u003eoptions\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003euri\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eUri\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eurl\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAbsoluteString\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003equery\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eHttpUtility\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eParseQueryString\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003euri\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eQuery\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003exSuccess\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003equery\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGet\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"x-success\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(!\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eIsNullOrEmpty\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003exSuccess\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eapp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eOpenUrl\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eNSUrl\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003exSuccess\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\"?hoge=fuga\"\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eNSDictionary\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eまずURLスキームで起動された場合のURLからクエリを取り出します。\u003cbr\u003e\n次に \u003ccode\u003ex-success\u003c/code\u003e の返答URLに \u003ccode\u003ehoge=fuga\u003c/code\u003e というパラメータを追加してコールバックを返します。\u003c/p\u003e\n\n\u003cp\u003eちなみに初期状態では \u003ccode\u003eSystem.Web\u003c/code\u003e がなかったので、 \u003ccode\u003eSystem.Web.Services\u003c/code\u003e のパッケージを追加しました。 \u003ccode\u003eプロジェクト\u0026gt;参照の編集\u003c/code\u003e から追加できます。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"実行してみる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%9F%E8%A1%8C%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e実行してみる\u003c/h3\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/2459755ccde8a97ef9d5384ed35858481431bf18/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33383138372f37386462653636612d643734642d373236662d363765652d3632363432326632633164362e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F38187%2F78dbe66a-d74d-726f-67ee-626422f2c1d6.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=759dd5706c8e8a59e8a583a2fe14d83b\" width=\"320px\" alt=\"実行結果\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/38187/78dbe66a-d74d-726f-67ee-626422f2c1d6.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F38187%2F78dbe66a-d74d-726f-67ee-626422f2c1d6.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=aa53aac129cf0b75c09f06297e15a317 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e実行すると一度作成したアプリが起動し、すぐに「ショートカット」がアクティブになります。戻り値も受け取れました。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"もう少し扱いやすくする\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%82%E3%81%86%E5%B0%91%E3%81%97%E6%89%B1%E3%81%84%E3%82%84%E3%81%99%E3%81%8F%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eもう少し扱いやすくする\u003c/h2\u003e\n\n\u003cp\u003e提供されているObjective-Cのフレームワーク\u003ca href=\"https://github.com/tapsandswipes/InterAppCommunication\" rel=\"nofollow noopener\" target=\"_blank\"\u003eInter-App Communication(IAC)\u003c/a\u003eを参考にC#に移植してみます。「ショートカット」アプリから呼び出せるようになれば十分遊べるので、URLスキームで起動する側ことにしました。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"実装のためのインタフェースと管理クラスを作る\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%9F%E8%A3%85%E3%81%AE%E3%81%9F%E3%82%81%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9%E3%81%A8%E7%AE%A1%E7%90%86%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%92%E4%BD%9C%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e実装のためのインタフェースと管理クラスを作る\u003c/h3\u003e\n\n\u003cp\u003e挙動を実装するためのインタフェースとして \u003ccode\u003eIXCAganet\u003c/code\u003e を作ります。\u003cbr\u003e\nさらに、インタフェースをまとめるクラスをSingletonで作っておきます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eIXCAgent.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003edelegate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eXCSuccess\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDictionary\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eparameters\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003edelegate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eXCCancel\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003edelegate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eXCError\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eerrorMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eerrorCode\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eerrorDomain\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003einterface\u003c/span\u003e \u003cspan class=\"nc\"\u003eIXCAgent\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"nf\"\u003eSupports\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eaction\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003ePerform\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eaction\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eDictionary\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eparameters\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eXCSuccess\u003c/span\u003e \u003cspan class=\"n\"\u003eonSuccess\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eXCCancel\u003c/span\u003e \u003cspan class=\"n\"\u003eonCancel\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eXCError\u003c/span\u003e \u003cspan class=\"n\"\u003eonError\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eXCManager.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eXCManager\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eXCManager\u003c/span\u003e \u003cspan class=\"n\"\u003eInstance\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eXCManager\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"nf\"\u003eXCManager\u003c/span\u003e\u003cspan class=\"p\"\u003e(){}\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003eHashSet\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eIXCAgent\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eagents\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eHashSet\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eIXCAgent\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eAddAgent\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eIXCAgent\u003c/span\u003e \u003cspan class=\"n\"\u003eagent\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eagents\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eagent\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eClearAgegnts\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eagents\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eClear\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"urlをパースする\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#url%E3%82%92%E3%83%91%E3%83%BC%E3%82%B9%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eURLをパースする\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eXCManager.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eParseUrl\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eNSUrl\u003c/span\u003e \u003cspan class=\"n\"\u003eurl\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eaction\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003exSuccess\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003exError\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003exCancel\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003eDictionary\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eparameters\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003equery\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eHttpUtility\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eParseQueryString\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eurl\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eQuery\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003exSuccess\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003equery\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGet\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"x-success\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003exError\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003equery\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGet\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"x-error\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003exCancel\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003equery\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGet\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"x-cancel\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003eaction\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eurl\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePath\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eTrimStart\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sc\"\u003e'/'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003eparameters\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eDictionary\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ekey\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003equery\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAllKeys\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ek\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eHttpUtility\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eUrlDecode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ekey\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(!\u003c/span\u003e\u003cspan class=\"n\"\u003ek\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eStartsWith\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"x-\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eStringComparison\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eOrdinal\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eparameters\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ek\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eHttpUtility\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eUrlDecode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003equery\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGet\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ek\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003ex-callback用のパラメータとアクション用のパラメータを分解しています。\u003cbr\u003e\n簡略化のため、使う予定のない \u003ccode\u003ex-source\u003c/code\u003e は取得していません。\u003cbr\u003e\n機能実装で利用する \u003ccode\u003eparameters\u003c/code\u003e はC#で扱いやすいDictionary\u003cbr\u003e\nで処理します。\u003cbr\u003e\nURLスキーム自体は同じキーを複数登録できてますが、混乱の元なのでキーが単一になるように制限してみました。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"クエリパラメータを含んだnsurlを生成する関数\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%AF%E3%82%A8%E3%83%AA%E3%83%91%E3%83%A9%E3%83%A1%E3%83%BC%E3%82%BF%E3%82%92%E5%90%AB%E3%82%93%E3%81%A0nsurl%E3%82%92%E7%94%9F%E6%88%90%E3%81%99%E3%82%8B%E9%96%A2%E6%95%B0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eクエリパラメータを含んだNSUrlを生成する関数\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eXCManager.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eNSUrl\u003c/span\u003e \u003cspan class=\"nf\"\u003eCreateUrl\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003excbUrl\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eDictionary\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eparameters\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eparameters\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e||\u003c/span\u003e \u003cspan class=\"n\"\u003eparameters\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCount\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eNSUrl\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003excbUrl\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eurl\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eStringBuilder\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003excbUrl\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eseparate\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"sc\"\u003e'?'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eparameter\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003eparameters\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eurl\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAppend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eseparate\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eurl\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAppend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eHttpUtility\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eUrlEncode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eUri\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEscapeUriString\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eparameter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eKey\u003c/span\u003e\u003cspan class=\"p\"\u003e)));\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eurl\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAppend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sc\"\u003e'='\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eurl\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAppend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eHttpUtility\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eUrlEncode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eUri\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEscapeUriString\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eparameter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e)));\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eseparate\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"sc\"\u003e'\u0026amp;'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eNSUrl\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eurl\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToString\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003eNSUrl\u003c/span\u003e \u003cspan class=\"nf\"\u003eCreateErrorUrl\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003excbUrl\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ecode\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003edomain\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eparameters\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eDictionary\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"s\"\u003e\"errorMessage\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"s\"\u003e\"error-Code\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecode\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"s\"\u003e\"errorDomain\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edomain\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nf\"\u003eCreateUrl\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003excbUrl\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eparameters\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eDictionaryにまとめたクエリパラメータをURLに変換する処理です。\u003cbr\u003e\nエラー時のクエリパラメータは、参考にしているIACの実装に合わせたキーを設定するようにしました。\u003c/p\u003e\n\n\u003cp\u003eURLエンコードは \u003ccode\u003eHttpUtility.UrlEncode(urlString)\u003c/code\u003e を単純に呼ぶだけでは駄目でした。\u003cbr\u003e\n\u003ccode\u003eHttpUtility.UrlEncode\u003c/code\u003e はスペースを \u003ccode\u003e+\u003c/code\u003e に変換しますが、ショートカットは \u003ccode\u003e%20\u003c/code\u003e になる想定で、エンコード方法に差があるのが原因のようです。\u003cbr\u003e\n\u003ccode\u003eHttpUtility.UrlEncode(Uri.EscapeUriString(urlString))\u003c/code\u003e とした所、ショートカット側で正しくデコードできる形式になりました。\u003c/p\u003e\n\n\u003cp\u003eおそらくこんな面倒な事をしなくても簡単な方法はありそうですが、自分の検索能力では見つからず。。。力不足を実感します。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"用意したパーツをつなぎ合わせてixcagentを処理する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%94%A8%E6%84%8F%E3%81%97%E3%81%9F%E3%83%91%E3%83%BC%E3%83%84%E3%82%92%E3%81%A4%E3%81%AA%E3%81%8E%E5%90%88%E3%82%8F%E3%81%9B%E3%81%A6ixcagent%E3%82%92%E5%87%A6%E7%90%86%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e用意したパーツをつなぎ合わせてIXCAgentを処理する\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eXCManager.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eProcessAgents\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eUIApplication\u003c/span\u003e \u003cspan class=\"n\"\u003eapp\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eNSUrl\u003c/span\u003e \u003cspan class=\"n\"\u003eurl\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eurl\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eHost\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"x-callback-url\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"nf\"\u003eParseUrl\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eurl\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eaction\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003exSuccess\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003exError\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003exCancel\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003eDictionary\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eparameters\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eonSuccess\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edict\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eapp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eOpenUrl\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateUrl\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003exSuccess\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edict\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eNSDictionary\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eonCancel\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eapp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eOpenUrl\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eNSUrl\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003exCancel\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eNSDictionary\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eonError\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecode\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edomain\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eapp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eOpenUrl\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateErrorUrl\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003exError\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecode\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edomain\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eNSDictionary\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003etry\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003esupportedAgent\u003c/span\u003e \u003cspan class=\"n\"\u003eagents\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFirstOrDefault\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eagent\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eagent\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eaction\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esupportedAgent\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ecallbackUrl\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eCreateErrorUrl\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003exError\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"NotFoundAction\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"1\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Client\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eapp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eOpenUrl\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecallbackUrl\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eNSDictionary\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003esupportedAgent\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eaction\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eparameters\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eonSuccess\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eonCancel\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eonError\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003ecatch\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eException\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ecallbackUrl\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eCreateErrorUrl\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003exError\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"1\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"XCManager\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eapp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eOpenUrl\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecallbackUrl\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eNSDictionary\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e大まかに以下の処理をしています。\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eURLをパースする\u003c/li\u003e\n\u003cli\u003eコールバック用のdelegateを生成する\u003c/li\u003e\n\u003cli\u003e登録された呼び出したいactionをサポートしているAgentを見つける\u003c/li\u003e\n\u003cli\u003eAgentが見つかれば処理。なければエラー。\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eAgent中ではどんな実装をしているのか分からないので、雑にtry-catchで囲んでおきます。\u003cbr\u003e\nエラーを握りつぶしているので若干怖いですが、ここでは規格通りに呼び出されたx-callbackなら確実に完了するような実装に倒しました。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"足し算をするだけのactionを作る\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%B6%B3%E3%81%97%E7%AE%97%E3%82%92%E3%81%99%E3%82%8B%E3%81%A0%E3%81%91%E3%81%AEaction%E3%82%92%E4%BD%9C%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e足し算をするだけのactionを作る\u003c/h3\u003e\n\n\u003cp\u003eまず書式を考えます。\u003c/p\u003e\n\n\u003cp\u003e入力例: \u003ccode\u003eadd?lhs=2\u0026amp;rhs=4.2\u003c/code\u003e\u003cbr\u003e\n結果例: \u003ccode\u003eresult=6.2\u003c/code\u003e\u003c/p\u003e\n\n\u003cp\u003eついでに文字列のエンコーディングを確認するため、出力用の文字を指定できるように拡張しておきます。\u003c/p\u003e\n\n\u003cp\u003e入力例: \u003ccode\u003eadd?lhs=2\u0026amp;rhs=4.2\u0026amp;text=result\u003c/code\u003e\u003cbr\u003e\n結果例: \u003ccode\u003eresult=result%3D6.2\u003c/code\u003e\u003c/p\u003e\n\n\u003cp\u003eこれを実装すると以下のような感じになります。\u003cbr\u003e\n入力ミスに気づきやすいように、actionの引数を処理できない時は専用のエラーを出すようにしました。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eAddAgent.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eAddAgent\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIXCAgent\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"nf\"\u003eSupports\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eaction\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eaction\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e\"add\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003ePerform\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eaction\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eDictionary\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eparameters\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eXCSuccess\u003c/span\u003e \u003cspan class=\"n\"\u003eonSuccess\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eXCCancel\u003c/span\u003e \u003cspan class=\"n\"\u003eonCancel\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eXCError\u003c/span\u003e \u003cspan class=\"n\"\u003eonError\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eresult\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003etry\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003elhs\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eDouble\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eParse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eparameters\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"lhs\"\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003erhs\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eDouble\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eParse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eparameters\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"rhs\"\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003esum\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003elhs\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003erhs\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eresult\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eparameters\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"text\"\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\"=\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eresult\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToString\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003ecatch\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eException\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eonError\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"ParameterError\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"1\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"AddAgent\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ecallbackParams\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eDictionary\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"s\"\u003e\"result\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eresult\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eonSuccess\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecallbackParams\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"actionの処理を登録登録解除する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#action%E3%81%AE%E5%87%A6%E7%90%86%E3%82%92%E7%99%BB%E9%8C%B2%E7%99%BB%E9%8C%B2%E8%A7%A3%E9%99%A4%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eactionの処理を登録/登録解除する\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eAppDelegate.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eoverride\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"nf\"\u003eFinishedLaunching\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eUIApplication\u003c/span\u003e \u003cspan class=\"n\"\u003eapplication\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eNSDictionary\u003c/span\u003e \u003cspan class=\"n\"\u003elaunchOptions\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eXCManager\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eInstance\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAddAgent\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eAddAgent\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eoverride\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnResignActivation\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eUIApplication\u003c/span\u003e \u003cspan class=\"n\"\u003eapplication\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eoverride\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eDidEnterBackground\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eUIApplication\u003c/span\u003e \u003cspan class=\"n\"\u003eapplication\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eXCManager\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eInstance\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eClearAgegnts\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eoverride\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eWillEnterForeground\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eUIApplication\u003c/span\u003e \u003cspan class=\"n\"\u003eapplication\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eXCManager\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eInstance\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAddAgent\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eAddAgent\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eoverride\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnActivated\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eUIApplication\u003c/span\u003e \u003cspan class=\"n\"\u003eapplication\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eoverride\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eWillTerminate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eUIApplication\u003c/span\u003e \u003cspan class=\"n\"\u003eapplication\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eXCManager\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eInstance\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eClearAgegnts\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eExport\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"application:openURL:options:\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eoverride\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"nf\"\u003eOpenUrl\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eUIApplication\u003c/span\u003e \u003cspan class=\"n\"\u003eapp\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eNSUrl\u003c/span\u003e \u003cspan class=\"n\"\u003eurl\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eNSDictionary\u003c/span\u003e \u003cspan class=\"n\"\u003eoptions\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eXCManager\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eInstance\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eProcessAgents\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eapp\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eurl\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e非アクティブ中にメモリが開放されたりするので、アクティブになった時にactionを登録し直しておきます。\u003cbr\u003e\n念の為、多重登録にならないように非アクティブになる時には登録を解除しておきます。\u003c/p\u003e\n\n\u003cp\u003eこちらの記事を参考にさせていただきました。\u003cbr\u003e\n\u003ca href=\"https://qiita.com/mfujiwara/items/cf3d61a96cf4fdfc1162\"\u003eAppDelegateのメソッドが呼ばれるタイミングと実装すべき内容（iOS11）\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"呼び出してみる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e呼び出してみる\u003c/h2\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"ショートカットアプリの設定\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B7%E3%83%A7%E3%83%BC%E3%83%88%E3%82%AB%E3%83%83%E3%83%88%E3%82%A2%E3%83%97%E3%83%AA%E3%81%AE%E8%A8%AD%E5%AE%9A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e「ショートカット」アプリの設定\u003c/h3\u003e\n\n\u003cp\u003e以下のように組みました\u003c/p\u003e\n\n\u003ctable\u003e\u003ctr\u003e\n \u003ctd\u003e\n  \u003ca href=\"https://camo.qiitausercontent.com/54409f9312b90d53448cb7deceddf7b8124fc10d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33383138372f33393637383438392d333037642d313735322d613239612d6436313537303130633063662e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F38187%2F39678489-307d-1752-a29a-d6157010c0cf.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=a53ea882fab100fe685efd41d8fe3a56\" width=\"320px\" alt=\"shortcut02-1/2\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/38187/39678489-307d-1752-a29a-d6157010c0cf.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F38187%2F39678489-307d-1752-a29a-d6157010c0cf.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=2abe9ef978267d2a5f89918be14afb8d 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\n \u003c/td\u003e\n \u003ctd\u003e\n  \u003ca href=\"https://camo.qiitausercontent.com/c16a48437ec706a239933bba7a32f35afc08e596/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33383138372f31376230633262612d333537332d613732392d323066382d6438663532666161633534312e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F38187%2F17b0c2ba-3573-a729-20f8-d8f52faac541.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=6e9c62e54edb086c21d7cc7eebe560a1\" width=\"320px\" alt=\"shortcut02-2/2\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/38187/17b0c2ba-3573-a729-20f8-d8f52faac541.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F38187%2F17b0c2ba-3573-a729-20f8-d8f52faac541.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=cc4835d4f3cfa51152f1daa48cdf01a2 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\n \u003c/td\u003e\n\u003c/tr\u003e\u003c/table\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"実行してみる-1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%9F%E8%A1%8C%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B-1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e実行してみる\u003c/h3\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/805148f54b3b381a0309151dc3642dcfb7f2c7ff/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33383138372f37306233313537352d363431342d623333612d366137332d6337306538306564663034652e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F38187%2F70b31575-6414-b33a-6a73-c70e80edf04e.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=3c74711f30d01cac7992c33961fe693f\" width=\"320px\" alt=\"shortcut02-result\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/38187/70b31575-6414-b33a-6a73-c70e80edf04e.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F38187%2F70b31575-6414-b33a-6a73-c70e80edf04e.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=20b95cb3140fdfda5fcf0384cc51a43d 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003e\u003c/code\u003e や \u003ccode\u003e\u0026amp;\u003c/code\u003e もエンコードで壊れることなく、コールバックを実行できました。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"iacを参考に移植してみた所感\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#iac%E3%82%92%E5%8F%82%E8%80%83%E3%81%AB%E7%A7%BB%E6%A4%8D%E3%81%97%E3%81%A6%E3%81%BF%E3%81%9F%E6%89%80%E6%84%9F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eIACを参考に移植してみた所感\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"エラー処理\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%A8%E3%83%A9%E3%83%BC%E5%87%A6%E7%90%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eエラー処理\u003c/h2\u003e\n\n\u003cp\u003eObjective-Cの \u003ccode\u003eNSError\u003c/code\u003e が元々持っているためだと思いますが、\u003ccode\u003eerrorCode\u003c/code\u003e や \u003ccode\u003eerrorDomain\u003c/code\u003e といった情報を持っているのは便利そうでした。\u003cbr\u003e\nIACではもう少しうまくエラー処理をしていて、利用者側が意識しなくても、それなりにわかりやすいドメインが選ばれるようになってました。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"x-cancel\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#x-cancel\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ex-cancel\u003c/h2\u003e\n\n\u003cp\u003eIACでは \u003ccode\u003eIACDelegate\u003c/code\u003e に \u003ccode\u003eOnSuccess\u003c/code\u003e と \u003ccode\u003eOnFailure\u003c/code\u003e しか用意されていません。\u003cbr\u003e\nSuccessがboolで成功かキャンセルを判断するようになっています。\u003cbr\u003e\nこの辺りの意図はあまりつかめませんでした。\u003c/p\u003e\n\n\u003cp\u003eキャンセルでは戻り値用の辞書を渡さないので、この記事の実装では使わない引数は受け取らずに済むように、明確に関数を分けました。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"実行効率\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%9F%E8%A1%8C%E5%8A%B9%E7%8E%87\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e実行効率\u003c/h2\u003e\n\n\u003cp\u003eこの記事の実装では、利用可能なAgentを毎回取得していますが、IACではactionをキーとした辞書から処理をO(1)で呼び出しているようでした。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"その他\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%9D%E3%81%AE%E4%BB%96\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eその他\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"canopenurl\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#canopenurl\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eCanOpenURL\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003eUIApplication.CanOpenURL\u003c/code\u003eという関数があります。指定したSchemeのアプリがインストールできるか調べるための関数です。\u003cbr\u003e\nいかにも \u003ccode\u003eUIApplication.OpenURL\u003c/code\u003e を実行する前に呼んだほうが良さそうに見えますが、x-callbackでの用途なら \u003cstrong\u003e呼ばないのが正解\u003c/strong\u003e のようです。\u003c/p\u003e\n\n\u003cp\u003eというのも、iOS9以降では何もしないと \u003cstrong\u003e必ずfalseが返ります\u003c/strong\u003e 。\u003cbr\u003e\n正しく判定するには、Info.plistに \u003ccode\u003eLSApplicationQueriesSchemes\u003c/code\u003e の配列項目を作り、調べたいschemeを列挙しておく必要があります。\u003c/p\u003e\n\n\u003cp\u003ex-callbackはどんなアプリから呼び出されるのか分からないので、予め列挙しておくことができません。\u003cbr\u003e\nどうしてもURL開けたかどうか確認したいなら \u003ccode\u003eUIApplication.OpenURL\u003c/code\u003e のcallbackで判定すると良さそうです。\u003c/p\u003e\n\n\u003cp\u003eややこしいですが、多分アプリがインストールされているのか判断できてしまうので、プライバシーの点で問題になったのでしょう。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"複数の戻り値を返す場合\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A4%87%E6%95%B0%E3%81%AE%E6%88%BB%E3%82%8A%E5%80%A4%E3%82%92%E8%BF%94%E3%81%99%E5%A0%B4%E5%90%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e複数の戻り値を返す場合\u003c/h2\u003e\n\n\u003cp\u003eこの記事では戻り値として1つのクエリパラメータを渡すものしか実装しませんでしたが、複数のクエリパラメータを渡した場合は「ショートカット」アプリでの扱い方が以下のように違います。\u003c/p\u003e\n\n\u003cp\u003e1つのクエリパラメータが返った時は、キーを捨てた値だけが文字列として次の処理に渡されます。\u003cbr\u003e\n複数のクエリパラメータが返った時は、すべてのキーを含んだ辞書として扱います。\u003cbr\u003e\n辞書はJsonに変換したり、標準機能でキーを指定して取り出すこともできます。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"まとめ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eまとめ\u003c/h1\u003e\n\n\u003cp\u003e個人で楽しむ分には困らないくらいには自由に拡張できるようになりました。\u003c/p\u003e\n\n\u003cp\u003eこれ以外にも、IACのバインディングライブラリを作成してXamarinから呼び出せるようにしたり、「Pythonista」アプリを購入してPythonで拡張したり、標準機能では出来ない拡張機能を呼び出す方法はいろいろあります。\u003c/p\u003e\n\n\u003cp\u003e振り返ると、数ある方法の中でも茨の道を進んだ気もしますが、こういうライブラリは偉い人の知恵が詰まっているので、車輪の再発明とはいえ適度に勉強になる題材でした。\u003cbr\u003e\n自分なりの工夫もいくつか入れてみましたが「いやいや！元の方が良いよ！」などのツッコミもお待ちしております。\u003c/p\u003e\n\n\u003cp\u003e最後まで読んで頂き、ありがとうございました。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"参考\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8F%82%E8%80%83\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e参考\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"https://techlife.cookpad.com/entry/2014/11/14/143841\" rel=\"nofollow noopener\" target=\"_blank\"\u003eiOSアプリ間連携の実装に x-callback-url を使う\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"http://yebisupress.dac.co.jp/2015/06/22/x-callback-url%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%81%9F/\" rel=\"nofollow noopener\" target=\"_blank\"\u003ex-callback-urlを使ってみた\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://qiita.com/nagaoyuriko/items/67c5e262f6e88cd88885\" id=\"reference-d93f0e53a7d11a2b8845\"\u003e【Swift】特定のアプリがインストールされているかどうかで処理を分ける 2017完全版 - URL SchemesとLSApplicationQueriesSchemes -\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://stackoverflow.com/questions/1517586/how-do-i-replace-all-the-spaces-with-20-in-c\" rel=\"nofollow noopener\" target=\"_blank\"\u003eHow do I replace all the spaces with %20 in C#?\u003c/a\u003e\u003c/p\u003e\n","createdAt":"2018-12-17T13:01:42Z","elapsedYearsFromLastModifiedAt":2,"encryptedId":"RkkXUsxvA7/gydLVLW4D+XI/14BuWEXn--RecHMyrmi7kJR5iQ--NWNY1t3kUPUWOlwo0u6BcA==","isBanned":false,"isDeprecated":true,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2018-12-17T13:02:51Z","likesCount":12,"linkUrl":"https://qiita.com/theiru/items/89df46f0dcf69f108218","organization":null,"originalId":743687,"stockedCount":5,"title":"iOSの「ショートカット」アプリとXamarinアプリを連携させてみた話","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%A6%82%E8%A6%81\"\u003e概要\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B7%E3%83%A7%E3%83%BC%E3%83%88%E3%82%AB%E3%83%83%E3%83%88%E3%81%A8%E3%81%AF\"\u003eショートカットとは\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#x-callback-url%E3%81%A8%E3%81%AF\"\u003ex-callback-urlとは\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%AE%9F%E8%A3%85\"\u003e実装\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%BD%BF%E7%94%A8%E7%92%B0%E5%A2%83\"\u003e使用環境\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E4%BD%9C%E6%88%90\"\u003eプロジェクトの作成\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#url%E3%82%B9%E3%82%AD%E3%83%BC%E3%83%A0%E3%81%A7%E8%B5%B7%E5%8B%95%E3%81%A7%E3%81%8D%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%99%E3%82%8B\"\u003eURLスキームで起動できるようにする\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%A8%E3%82%8A%E3%81%82%E3%81%88%E3%81%9A%E9%9B%91%E3%81%AB%E3%82%B3%E3%83%BC%E3%83%AB%E3%83%90%E3%83%83%E3%82%AF%E3%81%95%E3%81%9B%E3%81%A6%E3%81%BF%E3%82%8B\"\u003eとりあえず雑にコールバックさせてみる\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B7%E3%83%A7%E3%83%BC%E3%83%88%E3%82%AB%E3%83%83%E3%83%88%E5%81%B4\"\u003eショートカット側\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%AE%9F%E8%A1%8C%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B\"\u003e実行してみる\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%82%E3%81%86%E5%B0%91%E3%81%97%E6%89%B1%E3%81%84%E3%82%84%E3%81%99%E3%81%8F%E3%81%99%E3%82%8B\"\u003eもう少し扱いやすくする\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%AE%9F%E8%A3%85%E3%81%AE%E3%81%9F%E3%82%81%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9%E3%81%A8%E7%AE%A1%E7%90%86%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%92%E4%BD%9C%E3%82%8B\"\u003e実装のためのインタフェースと管理クラスを作る\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#url%E3%82%92%E3%83%91%E3%83%BC%E3%82%B9%E3%81%99%E3%82%8B\"\u003eURLをパースする\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%AF%E3%82%A8%E3%83%AA%E3%83%91%E3%83%A9%E3%83%A1%E3%83%BC%E3%82%BF%E3%82%92%E5%90%AB%E3%82%93%E3%81%A0nsurl%E3%82%92%E7%94%9F%E6%88%90%E3%81%99%E3%82%8B%E9%96%A2%E6%95%B0\"\u003eクエリパラメータを含んだNSUrlを生成する関数\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%94%A8%E6%84%8F%E3%81%97%E3%81%9F%E3%83%91%E3%83%BC%E3%83%84%E3%82%92%E3%81%A4%E3%81%AA%E3%81%8E%E5%90%88%E3%82%8F%E3%81%9B%E3%81%A6ixcagent%E3%82%92%E5%87%A6%E7%90%86%E3%81%99%E3%82%8B\"\u003e用意したパーツをつなぎ合わせてIXCAgentを処理する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E8%B6%B3%E3%81%97%E7%AE%97%E3%82%92%E3%81%99%E3%82%8B%E3%81%A0%E3%81%91%E3%81%AEaction%E3%82%92%E4%BD%9C%E3%82%8B\"\u003e足し算をするだけのactionを作る\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#action%E3%81%AE%E5%87%A6%E7%90%86%E3%82%92%E7%99%BB%E9%8C%B2%E7%99%BB%E9%8C%B2%E8%A7%A3%E9%99%A4%E3%81%99%E3%82%8B\"\u003eactionの処理を登録/登録解除する\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B\"\u003e呼び出してみる\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B7%E3%83%A7%E3%83%BC%E3%83%88%E3%82%AB%E3%83%83%E3%83%88%E3%82%A2%E3%83%97%E3%83%AA%E3%81%AE%E8%A8%AD%E5%AE%9A\"\u003e「ショートカット」アプリの設定\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%AE%9F%E8%A1%8C%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B-1\"\u003e実行してみる\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#iac%E3%82%92%E5%8F%82%E8%80%83%E3%81%AB%E7%A7%BB%E6%A4%8D%E3%81%97%E3%81%A6%E3%81%BF%E3%81%9F%E6%89%80%E6%84%9F\"\u003eIACを参考に移植してみた所感\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%A8%E3%83%A9%E3%83%BC%E5%87%A6%E7%90%86\"\u003eエラー処理\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#x-cancel\"\u003ex-cancel\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%AE%9F%E8%A1%8C%E5%8A%B9%E7%8E%87\"\u003e実行効率\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%9D%E3%81%AE%E4%BB%96\"\u003eその他\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#canopenurl\"\u003eCanOpenURL\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E8%A4%87%E6%95%B0%E3%81%AE%E6%88%BB%E3%82%8A%E5%80%A4%E3%82%92%E8%BF%94%E3%81%99%E5%A0%B4%E5%90%88\"\u003e複数の戻り値を返す場合\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"\u003eまとめ\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%8F%82%E8%80%83\"\u003e参考\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":3602,"uuid":"89df46f0dcf69f108218","banReason":null,"adventCalendarItem":{"day":17,"calendar":{"name":"KLab Engineer","urlName":"klab","year":2018,"organization":null}},"author":{"encryptedId":"30hUiIkmAgWDnueoRF5g5M8wfkM=--UNRpkVke9u8flMXp--hWhQA3nwd9Hsv3/uyA+Xug==","originalId":38187,"description":"","facebookUrl":null,"githubUrl":null,"isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"","profileImageUrl":"https://qiita-image-store.s3.amazonaws.com/0/38187/profile-images/1473687676","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F38187%2Fprofile-images%2F1473687676?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=75ff0b67e5a06cd47ca1a7ec3940b920","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F38187%2Fprofile-images%2F1473687676?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=7382043b092eb97687a8f1846ec87e76","urlName":"theiru","websiteUrl":"","twitterUrl":"https://twitter.com/theiru","twitterUrlName":"theiru","revealedOrganizations":{"edges":[{"node":{"encryptedId":"XgwUfnzwJV8b0m69UbwYrni+CzfRpKOeY4A=--9SADLVP5qxmdaUIc--hz/eYi+gWp+ebpkSOtajHQ==","isBetaReleaseEnabled":false,"isFollowableByViewer":false,"isFollowedByViewer":false,"name":"KLab 株式会社","logoUrl":"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/38118b7763a3eb16a11b5acd0f9d72457d9bed3c/original.jpg?1608640519","urlName":"klab","description":"モバイルオンラインゲーム、その他スマートフォン関連サービス、及びサーバーインフラ開発・運用","url":"http://www.klab.com/jp/"}}]}},"tags":[{"name":"C#","urlName":"csharp"},{"name":"iOS","urlName":"ios"},{"name":"ショートカット","urlName":"%e3%82%b7%e3%83%a7%e3%83%bc%e3%83%88%e3%82%ab%e3%83%83%e3%83%88"},{"name":"Xamarin","urlName":"xamarin"}],"followingLikers":{"edges":[]},"comments":{"totalCount":0}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

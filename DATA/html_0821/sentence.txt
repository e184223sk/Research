どうも、コードビハインドに１行でも書いたら死ぬ呪いにかかっているデンパ時計と申します。
皆さんはWPFでいろんなデータを表示するときに一度はDataGridを使ったことがあるかと思います。
上のカラムをぽちっと押すといい感じにソートしてくれるのですが、一度ソートするとなぜか戻せない罠が存在するんですよね。
初心者殺し過ぎて泣けます。コードビハインドからとか、ViewModel側からとかで元に戻す方法もあるのですが大量に画面作ってるとその一個一個に書いていくのめんどくさいのでUserControlカスタムコントロールとして作成します。なんてことないですね。DataGridを継承してソート用のOnSortingをオーバーライドするだけです。
カラムを押したときはListSortDirectionがAscending→Descending→Ascending→Descending…と繰り返すので、Descendingの後に元に戻す処理を書いて既存の処理をすっ飛ばすようなコードになってます。
後は適当にxamlとかViewModelを書いて終わりです。実際に実行するとこんな感じになります。
左のDataGridがWPF標準のもので一回ソートしたらソートされっぱなし。
右が今回作成したDataGridでカラムを３回押すとソートが元に戻ります。余談ですがshiftキーを押しながらカラムを押すと複数条件でソートできるみたいですね。今回作成した コード(github)(2021/07/11 追記)
添付プロパティの方が良いではないか？とのコメントを頂きました。スタイル等をDataGirdでいじっている場合は既存のDataGridのまま機能を追加できるのでこちらの方がいいですね。



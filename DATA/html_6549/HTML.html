<!DOCTYPE html><html><head><meta charset="utf-8" /><title>コンピュータ将棋ソフトとの対局サーバーを立てよう＜その１１＞ - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/muzudho1/items/3d292bafc4a8fa54eb43" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="EpZen/tVgSpsKjkZZq87rQcXUQ3zV3BEowdmoVyVLq1nllZcpRYn/HH99zcRVtJpbjZG8oIXXxxdLEr2/HhL0Q==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta content="@muzudho1" name="twitter:creator" /><meta property="og:type" content="article"><meta property="og:title" content="コンピュータ将棋ソフトとの対局サーバーを立てよう＜その１１＞ - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND00NEt6NDRPejQ0T1U0NE9sNDRPODQ0S181YkNHNXFPTDQ0Szk0NE9WNDRPSTQ0R280NEd1NWEtLTViR0E0NEsxNDRPODQ0T1E0NE84NDRLUzU2dUw0NEdtNDRLSTQ0R0c3N3ljNDRHZDQ0R3U3N3lSNzd5Ujc3eWUmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT01NCZ0eHQtY2xpcD1lbGxpcHNpcyZ0eHQtYWxpZ249Y2VudGVyJTJDbWlkZGxlJnM9ZTRjMmUxMDBhN2NlZTBkMjAwNjlkOGNhOGRjODRkNTk&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RRzExZW5Wa2FHOHgmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT00NSZ0eHQtYWxpZ249cmlnaHQlMkNib3R0b20mcz0yNzBmM2IxNzA3MjZjZWFjNGMyNjg1YTgwYTdjMjY5Ng&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=0d705db81a9edd29013d990e1bb57ea9"><meta property="og:description" content="前回の記事 : http://qiita.com/muzudho1/items/6fbe1681a7e14dcac3f2


バグの原因を調べよう

コンシューマの受信ループを　別スレッドにしてから　おかしくなった気がする。

じゃあ..."><meta content="https://qiita.com/muzudho1/items/3d292bafc4a8fa54eb43" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C++,C#,コンピュータ将棋,libev,AMQP-CPP" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 1nzh4zz 38fzdi helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-1nzh4zz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:16px 32px;background-color:#FBE69E;color:rgba(0,0,0,0.87);line-height:1.5;font-weight:600;}@media (max-width:770px){.css-1nzh4zz{padding:16px;}}.css-38fzdi{color:#CA832A;margin-right:4px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-6ec0e6ee-c0a2-4815-9989-7553d8c2fc75"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Fmuzudho1%2Fitems%2F3d292bafc4a8fa54eb43">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Fmuzudho1%2Fitems%2F3d292bafc4a8fa54eb43">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-6ec0e6ee-c0a2-4815-9989-7553d8c2fc75">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/cpp","name":"C++"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2017-03-14T06:52:56.000+09:00","dateModified":"2017-03-15T07:24:24.000+09:00","headline":"コンピュータ将棋ソフトとの対局サーバーを立てよう＜その１１＞","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND00NEt6NDRPejQ0T1U0NE9sNDRPODQ0S181YkNHNXFPTDQ0Szk0NE9WNDRPSTQ0R280NEd1NWEtLTViR0E0NEsxNDRPODQ0T1E0NE84NDRLUzU2dUw0NEdtNDRLSTQ0R0c3N3ljNDRHZDQ0R3U3N3lSNzd5Ujc3eWUmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT01NCZ0eHQtY2xpcD1lbGxpcHNpcyZ0eHQtYWxpZ249Y2VudGVyJTJDbWlkZGxlJnM9ZTRjMmUxMDBhN2NlZTBkMjAwNjlkOGNhOGRjODRkNTk\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RRzExZW5Wa2FHOHgmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT00NSZ0eHQtYWxpZ249cmlnaHQlMkNib3R0b20mcz0yNzBmM2IxNzA3MjZjZWFjNGMyNjg1YTgwYTdjMjY5Ng\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=0d705db81a9edd29013d990e1bb57ea9","mainEntityOfPage":"https://qiita.com/muzudho1/items/3d292bafc4a8fa54eb43","author":{"@type":"Person","address":"埼玉","email":null,"identifier":"muzudho1","name":"muzudho1","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fpbs.twimg.com%2Fprofile_images%2F378800000224959199%2F109762cc48c6e63fad3fbe01065cf862_normal.png?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=3ed9df1f72e7b42b01bc26234820b49f","url":"https://qiita.com/muzudho1","description":"（＾～＾）","memberOf":[]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://zine.qiita.com/interview/202106-uzabase-3/">社員の行動の基盤となるユーザベースのミッション・バリュー</a><a target="_blank" id="header_text_message_2" href="https://zine.qiita.com/interview/202106-uzabase-3/">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"muzudho1","type":"items","id":"3d292bafc4a8fa54eb43"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"社員の行動の基盤となるユーザベースのミッション・バリュー","url":"https://zine.qiita.com/interview/202106-uzabase-3/","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"muzudho1","type":"items","id":"3d292bafc4a8fa54eb43"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_1","message":"社員の行動の基盤となるユーザベースのミッション・バリュー","url":"https://zine.qiita.com/interview/202106-uzabase-3/","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"muzudho1","type":"items","id":"3d292bafc4a8fa54eb43"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_2","message":"社員の行動の基盤となるユーザベースのミッション・バリュー","url":"https://zine.qiita.com/interview/202106-uzabase-3/","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/muzudho1/items/3d292bafc4a8fa54eb43","location":"/muzudho1/items/3d292bafc4a8fa54eb43","scheme":"https","host":"qiita.com","port":null,"pathname":"/muzudho1/items/3d292bafc4a8fa54eb43","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"koqaGteKLss5xXItbHb1t+1EyxUxuBwn4GGDmYEmG1fnipLZicmIHSQSvAMbjxxzhGXc6kD4M38eSq/OIct+Kw==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-681f3a1a-6c03-4513-86f1-475d4ff0448e"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/muzudho1/items/3d292bafc4a8fa54eb43/likers" class="css-1iupg5d">0</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">1</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/3d292bafc4a8fa54eb43/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/muzudho1/items/3d292bafc4a8fa54eb43/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/muzudho1/items/3d292bafc4a8fa54eb43/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/muzudho1/items/3d292bafc4a8fa54eb43/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/muzudho1/items/3d292bafc4a8fa54eb43.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-1nzh4zz"><span class="fa fa-fw fa-warning css-38fzdi"></span><p>More than 3 years have passed since last update.</p></div><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/muzudho1"><img class="css-100alwu eyfquo10" src="https://pbs.twimg.com/profile_images/378800000224959199/109762cc48c6e63fad3fbe01065cf862_normal.png" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/muzudho1" class="css-10ougpm">@<!-- -->muzudho1</a><div class="css-1ay9vb9"><span><meta content="2017-03-13T21:52:56Z"/><time dateTime="2017-03-14T22:24:24Z" class="css-m19uds">updated at 2017-03-14</time></span></div></div></div></div></div><h1 class="css-cgzq40">コンピュータ将棋ソフトとの対局サーバーを立てよう＜その１１＞</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/cpp" class="css-4czcte">C++</a><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/%e3%82%b3%e3%83%b3%e3%83%94%e3%83%a5%e3%83%bc%e3%82%bf%e5%b0%86%e6%a3%8b" class="css-4czcte">コンピュータ将棋</a><a href="/tags/libev" class="css-4czcte">libev</a><a href="/tags/amqp-cpp" class="css-4czcte">AMQP-CPP</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div><p>前回の記事 : <a href="http://qiita.com/muzudho1/items/6fbe1681a7e14dcac3f2" class="autolink" id="reference-af85235244f8a382e785">http://qiita.com/muzudho1/items/6fbe1681a7e14dcac3f2</a></p>

<h1>
<span id="バグの原因を調べよう" class="fragment"></span><a href="#%E3%83%90%E3%82%B0%E3%81%AE%E5%8E%9F%E5%9B%A0%E3%82%92%E8%AA%BF%E3%81%B9%E3%82%88%E3%81%86"><i class="fa fa-link"></i></a>バグの原因を調べよう</h1>

<p>コンシューマの受信ループを　別スレッドにしてから　おかしくなった気がする。</p>

<p>じゃあ、コンシューマの受信ループは　別スレッドにせず、<br>
プロデューサーの送信を　別スレッドにしたらいいのか？</p>

<p>試すだけ試そう。</p>

<p>まず、ev_loop がエラーを出すソースコード。</p>

<div class="code-frame" data-lang="cpp"><div class="highlight"><pre><code><span class="c1">// OS      : Windows10 : // このプログラムは動かない</span>
<span class="c1">//</span>
<span class="c1">// OS      : Ubuntu 16.04</span>
<span class="c1">// Library : libev</span>
<span class="c1">//         : Install   : Command  : sudo apt-get update</span>
<span class="c1">//                                : sudo apt-get install libev-dev</span>
<span class="c1">// Service : RabbitMQ</span>
<span class="c1">//         : Reference : Web site : Top page http://www.rabbitmq.com/</span>
<span class="c1">//         : Install   : Web site : Installing on Debian / Ubuntu http://www.rabbitmq.com/install-debian.html</span>
<span class="c1">//         : Manual    : Command  : man rabbitmqctl</span>
<span class="c1">//         : Start     : Command  : rabbitmq-server</span>
<span class="c1">//         : Stop      : Command  : rabbitmqctl stop</span>
<span class="c1">//         : Check     : Command  : rabbitmqctl status</span>
<span class="c1">//         :           : Command  : rabbitmqctl list_queues</span>
<span class="c1">// Library : AMQP-CPP</span>
<span class="c1">//         : Reference : Web site : AMQP-CPP README.md https://github.com/CopernicaMarketingSoftware/AMQP-CPP</span>
<span class="c1">//         : Reference : Web site : QueueDeclare http://docs.spring.io/spring-amqp-net/docs/1.0.x/api/html/Spring.Messaging.Amqp.Rabbit~Spring.Messaging.Amqp.Rabbit.Connection.CachedModel~QueueDeclare(String,Boolean,Boolean,Boolean,Boolean,Boolean,IDictionary).html</span>
<span class="c1">//         : Reference : Web site : EventingBasicConsumer https://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v1.4.0/rabbitmq-dotnet-client-1.4.0-net-2.0-htmldoc/type-RabbitMQ.Client.Events.EventingBasicConsumer.html</span>
<span class="c1">//         : Reference : Web site : BasicConsume https://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v1.4.0/rabbitmq-dotnet-client-1.4.0-net-2.0-htmldoc/type-RabbitMQ.Client.IModel.html#method-M:RabbitMQ.Client.IModel.BasicConsume(System.UInt16,System.String,System.Boolean,System.Collections.IDictionary,RabbitMQ.Client.IBasicConsumer)</span>
<span class="c1">//         : Reference : Web site : C#でconstな配列を実現する (もっとクールにプログラミング) http://pgnote.net/?p=885</span>
<span class="c1">//         : Reference : Web site : AMQP-CPP (docsforge.com) http://docsforge.com/11/AMQP-CPP/docs/latest/namespace-AMQP/class-TcpConnection/</span>
<span class="c1">//</span>
<span class="c1">// Program : this</span>
<span class="c1">//         : Compile   : Command  : g++ -std=c++11 tamesi33a2_cpp.cpp -o tamesi33a2_cpp.exe -lev -lamqpcpp -pthread</span>
<span class="c1">//         : Execute   : Command  : // バックグラウンドで実行</span>
<span class="c1">//                                : ./tamesi33a2_cpp.exe --msgqueue 1117 durable 1116 durable 2&gt; ./tamesi33a2_cpp.err.log &amp;</span>
<span class="c1">//         : Stop      : Typing   : [Ctrl]+[C]</span>
<span class="c1">//</span>
<span class="c1">// メッセージの末尾に daze を付けます。</span>
<span class="c1">// デキューは「1112」、エンキューは「1113」キューに向けて行います。</span>
<span class="c1">// 標準入出力は、キーボード、画面には接続しないようにします。</span>

<span class="cp">#include &lt;string&gt; // std::string
#include &lt;iostream&gt; // std::cout
#include &lt;sstream&gt; // std::ostringstream
#include &lt;chrono&gt;
#include &lt;thread&gt; // sleep_for
#include &lt;future&gt; // thread
</span>
<span class="c1">// プロセス間通信用</span>
<span class="cp">#include &lt;ev.h&gt;
#include &lt;amqpcpp.h&gt;
#include &lt;amqpcpp/libev.h&gt;
</span>
<span class="k">static</span> <span class="n">AMQP</span><span class="o">::</span><span class="n">Address</span> <span class="n">ADDRESS</span><span class="p">{</span> <span class="s">"amqp://localhost:5672"</span> <span class="p">};</span>
<span class="c1">// 0 : enqueue用設定</span>
<span class="c1">// 1 : dequeue用設定</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">ENQUEUE_INDEX</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">DEQUEUE_INDEX</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">NUM_INDEX</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="k">static</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">name_queues</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="s">"1117"</span><span class="p">,</span> <span class="s">"1116"</span> <span class="p">};</span>
<span class="k">static</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">lifeSpan_queues</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="s">"durable"</span><span class="p">,</span> <span class="s">"durable"</span> <span class="p">};</span>

<span class="c1">/// &lt;summary&gt;</span>
<span class="c1">/// 回転式バッファー。</span>
<span class="c1">/// これはメイン・スレッドに置く。</span>
<span class="c1">/// デキューのスレッドでエンキューすることはできない。</span>
<span class="c1">/// デキュー処理は、回転式バッファーを仲介にしてエンキュー処理にメッセージを渡す。</span>
<span class="c1">/// &lt;/summary&gt;</span>
<span class="k">namespace</span> <span class="n">rotationBuffer</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">bufferSize</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
    <span class="k">static</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">buffer</span><span class="p">[</span><span class="n">bufferSize</span><span class="p">]</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="k">static</span> <span class="kt">int</span> <span class="n">bufferCursors</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">};</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">PUT_INDEX</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">GET_INDEX</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

    <span class="n">std</span><span class="o">::</span><span class="n">mutex</span> <span class="n">_mutex</span><span class="p">;</span>
    <span class="k">static</span> <span class="kt">void</span> <span class="n">putMessage</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">message</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">unique_lock</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="o">&gt;</span> <span class="n">lock</span><span class="p">(</span><span class="n">_mutex</span><span class="p">);</span>
        <span class="n">buffer</span><span class="p">[</span><span class="n">bufferCursors</span><span class="p">[</span><span class="n">PUT_INDEX</span><span class="p">]]</span> <span class="o">=</span> <span class="n">message</span><span class="p">;</span>
        <span class="n">bufferCursors</span><span class="p">[</span><span class="n">PUT_INDEX</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">bufferCursors</span><span class="p">[</span><span class="n">PUT_INDEX</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">bufferSize</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">bufferCursors</span><span class="p">[</span><span class="n">PUT_INDEX</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">static</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">getMessage</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">unique_lock</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="o">&gt;</span> <span class="n">lock</span><span class="p">(</span><span class="n">_mutex</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="s">""</span> <span class="o">!=</span> <span class="n">buffer</span><span class="p">[</span><span class="n">bufferCursors</span><span class="p">[</span><span class="n">GET_INDEX</span><span class="p">]])</span>
        <span class="p">{</span>
            <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">message</span> <span class="o">=</span> <span class="n">buffer</span><span class="p">[</span><span class="n">bufferCursors</span><span class="p">[</span><span class="n">GET_INDEX</span><span class="p">]];</span>
            <span class="n">buffer</span><span class="p">[</span><span class="n">bufferCursors</span><span class="p">[</span><span class="n">GET_INDEX</span><span class="p">]]</span> <span class="o">=</span> <span class="s">""</span><span class="p">;</span>
            <span class="n">bufferCursors</span><span class="p">[</span><span class="n">GET_INDEX</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">bufferCursors</span><span class="p">[</span><span class="n">GET_INDEX</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">bufferSize</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="n">bufferCursors</span><span class="p">[</span><span class="n">GET_INDEX</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">message</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="s">""</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// メッセージキューにエンキュー</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">enqueue</span><span class="p">(</span><span class="k">struct</span> <span class="nc">ev_loop</span><span class="o">*</span> <span class="n">loop</span><span class="p">,</span> <span class="n">AMQP</span><span class="o">::</span><span class="n">TcpConnection</span><span class="o">&amp;</span> <span class="n">connection</span><span class="p">,</span> <span class="n">AMQP</span><span class="o">::</span><span class="n">TcpChannel</span><span class="o">&amp;</span> <span class="n">channel</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">message</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">exchange_name</span> <span class="o">=</span> <span class="s">"myexchange"</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">routing_key</span> <span class="o">=</span> <span class="s">""</span><span class="p">;</span>

    <span class="kt">int</span> <span class="n">lifeSpan</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">a</span> <span class="o">=</span> <span class="n">lifeSpan_queues</span><span class="p">[</span><span class="n">ENQUEUE_INDEX</span><span class="p">];</span>
    <span class="k">if</span>      <span class="p">(</span><span class="s">"durable"</span>    <span class="o">==</span> <span class="n">a</span><span class="p">)</span> <span class="p">{</span> <span class="n">lifeSpan</span> <span class="o">=</span> <span class="n">AMQP</span><span class="o">::</span><span class="n">durable</span><span class="p">;</span>    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="s">"autodelete"</span> <span class="o">==</span> <span class="n">a</span><span class="p">)</span> <span class="p">{</span> <span class="n">lifeSpan</span> <span class="o">=</span> <span class="n">AMQP</span><span class="o">::</span><span class="n">autodelete</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="s">"passive"</span>    <span class="o">==</span> <span class="n">a</span><span class="p">)</span> <span class="p">{</span> <span class="n">lifeSpan</span> <span class="o">=</span> <span class="n">AMQP</span><span class="o">::</span><span class="n">passive</span><span class="p">;</span>    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="s">"exclusive"</span>  <span class="o">==</span> <span class="n">a</span><span class="p">)</span> <span class="p">{</span> <span class="n">lifeSpan</span> <span class="o">=</span> <span class="n">AMQP</span><span class="o">::</span><span class="n">exclusive</span><span class="p">;</span>  <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">"未対応のキュー寿命が指定されました。["</span><span class="o">+</span> <span class="n">a</span> <span class="o">+</span><span class="s">"]"</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">channel</span><span class="p">.</span><span class="n">declareQueue</span><span class="p">(</span><span class="n">name_queues</span><span class="p">[</span><span class="n">ENQUEUE_INDEX</span><span class="p">],</span> <span class="n">lifeSpan</span><span class="p">)</span>
        <span class="p">.</span><span class="n">onError</span><span class="p">([</span><span class="o">&amp;</span><span class="n">a</span><span class="p">](</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">errMsg</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">"error declaring queue: "</span> <span class="o">&lt;&lt;</span> <span class="n">errMsg</span> <span class="o">&lt;&lt;</span> <span class="s">" lifeSpan=["</span> <span class="o">&lt;&lt;</span> <span class="n">a</span> <span class="o">&lt;&lt;</span> <span class="s">"]"</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
        <span class="p">});</span>

    <span class="n">channel</span><span class="p">.</span><span class="n">bindQueue</span><span class="p">(</span><span class="n">exchange_name</span><span class="p">,</span> <span class="n">name_queues</span><span class="p">[</span><span class="n">ENQUEUE_INDEX</span><span class="p">],</span> <span class="n">routing_key</span><span class="p">)</span>
        <span class="p">.</span><span class="n">onSuccess</span><span class="p">([</span><span class="o">&amp;</span><span class="n">connection</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">channel</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">exchange_name</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">routing_key</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">message</span><span class="p">]()</span> <span class="p">{</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">channel</span><span class="p">.</span><span class="n">publish</span><span class="p">(</span><span class="n">exchange_name</span><span class="p">,</span> <span class="n">routing_key</span><span class="p">,</span> <span class="n">message</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">message</span><span class="p">.</span><span class="n">size</span><span class="p">()))</span> <span class="p">{</span>
            <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">"failed to publish?</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// break in ev loop.</span>
        <span class="n">connection</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
    <span class="p">});</span>

    <span class="c1">// このループは、パブリッシュ後に抜ける</span>
    <span class="n">ev_run</span><span class="p">(</span><span class="n">loop</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// 受信できたときに割り込んでくる処理</span>
<span class="c1">// startConsume() しておくこと。</span>
<span class="k">static</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="nf">dequeue</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">message</span><span class="p">;</span>

    <span class="k">while</span> <span class="p">(</span><span class="s">""</span> <span class="o">==</span> <span class="n">message</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">message</span> <span class="o">=</span> <span class="n">rotationBuffer</span><span class="o">::</span><span class="n">getMessage</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">message</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// メッセージ・キューの監視を開始</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">workConsume</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// Connect to the AMQP service.</span>
    <span class="k">auto</span> <span class="o">*</span><span class="n">loop</span> <span class="o">=</span> <span class="n">EV_DEFAULT</span><span class="p">;</span>
    <span class="n">AMQP</span><span class="o">::</span><span class="n">LibEvHandler</span> <span class="n">handler</span><span class="p">(</span><span class="n">loop</span><span class="p">);</span>
    <span class="n">AMQP</span><span class="o">::</span><span class="n">TcpConnection</span> <span class="n">connection</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handler</span><span class="p">,</span> <span class="n">ADDRESS</span><span class="p">);</span>
    <span class="n">AMQP</span><span class="o">::</span><span class="n">TcpChannel</span> <span class="n">channel</span><span class="p">(</span><span class="o">&amp;</span><span class="n">connection</span><span class="p">);</span>

    <span class="c1">// I will go to the front of the box named "1111".</span>
    <span class="kt">int</span> <span class="n">lifeSpan</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">a</span> <span class="o">=</span> <span class="n">lifeSpan_queues</span><span class="p">[</span><span class="n">DEQUEUE_INDEX</span><span class="p">];</span>
    <span class="k">if</span>      <span class="p">(</span><span class="s">"durable"</span>    <span class="o">==</span> <span class="n">a</span><span class="p">)</span> <span class="p">{</span> <span class="n">lifeSpan</span> <span class="o">=</span> <span class="n">AMQP</span><span class="o">::</span><span class="n">durable</span><span class="p">;</span>    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="s">"autodelete"</span> <span class="o">==</span> <span class="n">a</span><span class="p">)</span> <span class="p">{</span> <span class="n">lifeSpan</span> <span class="o">=</span> <span class="n">AMQP</span><span class="o">::</span><span class="n">autodelete</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="s">"passive"</span>    <span class="o">==</span> <span class="n">a</span><span class="p">)</span> <span class="p">{</span> <span class="n">lifeSpan</span> <span class="o">=</span> <span class="n">AMQP</span><span class="o">::</span><span class="n">passive</span><span class="p">;</span>    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="s">"exclusive"</span>  <span class="o">==</span> <span class="n">a</span><span class="p">)</span> <span class="p">{</span> <span class="n">lifeSpan</span> <span class="o">=</span> <span class="n">AMQP</span><span class="o">::</span><span class="n">exclusive</span><span class="p">;</span>  <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">"未対応のキュー寿命が指定されました。["</span> <span class="o">+</span> <span class="n">a</span> <span class="o">+</span> <span class="s">"]"</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">channel</span><span class="p">.</span><span class="n">declareQueue</span><span class="p">(</span><span class="n">name_queues</span><span class="p">[</span><span class="n">DEQUEUE_INDEX</span><span class="p">],</span> <span class="n">lifeSpan</span><span class="p">);</span>

    <span class="c1">// I look inside the box.</span>
    <span class="k">auto</span> <span class="n">errorCb</span> <span class="o">=</span> <span class="p">[</span><span class="o">&amp;</span><span class="n">a</span><span class="p">](</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">errMsg</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">"My ID watching failed ["</span> <span class="o">&lt;&lt;</span> <span class="n">errMsg</span> <span class="o">&lt;&lt;</span> <span class="s">"] lifeSpan=["</span> <span class="o">&lt;&lt;</span> <span class="n">a</span> <span class="o">&lt;&lt;</span> <span class="s">"]"</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="k">auto</span> <span class="n">messageCb</span> <span class="o">=</span> <span class="p">[</span><span class="o">&amp;</span><span class="n">channel</span><span class="p">](</span><span class="k">const</span> <span class="n">AMQP</span><span class="o">::</span><span class="n">Message</span> <span class="o">&amp;</span><span class="n">message</span><span class="p">,</span> <span class="kt">uint64_t</span> <span class="n">deliveryTag</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">redelivered</span><span class="p">)</span> <span class="p">{</span>

        <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">myString</span><span class="p">(</span><span class="n">message</span><span class="p">.</span><span class="n">body</span><span class="p">(),</span> <span class="n">message</span><span class="p">.</span><span class="n">bodySize</span><span class="p">());</span>
        <span class="n">rotationBuffer</span><span class="o">::</span><span class="n">putMessage</span><span class="p">(</span><span class="n">myString</span><span class="p">);</span>

        <span class="n">channel</span><span class="p">.</span><span class="n">ack</span><span class="p">(</span><span class="n">deliveryTag</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="n">channel</span><span class="p">.</span><span class="n">consume</span><span class="p">(</span><span class="n">name_queues</span><span class="p">[</span><span class="n">DEQUEUE_INDEX</span><span class="p">])</span>
        <span class="p">.</span><span class="n">onReceived</span><span class="p">(</span><span class="n">messageCb</span><span class="p">)</span>
        <span class="p">.</span><span class="n">onError</span><span class="p">(</span><span class="n">errorCb</span><span class="p">);</span>

    <span class="c1">// I will keep on forever.</span>
    <span class="n">ev_run</span><span class="p">(</span><span class="n">loop</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

    <span class="c1">// I will not come here.</span>
    <span class="k">return</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">cmdArg</span><span class="p">;</span>
    <span class="c1">// プログラム名を省き、コマンドライン引数だけをつなげる。</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">argc</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">cmdArg</span> <span class="o">+=</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="s">" "</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">std</span><span class="o">::</span><span class="n">istringstream</span> <span class="n">ssCmd</span><span class="p">(</span><span class="n">cmdArg</span><span class="p">);</span>

    <span class="c1">// 半角スペース区切りの最初の1トークンを拾う</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">token</span><span class="p">;</span>
    <span class="n">ssCmd</span> <span class="o">&gt;&gt;</span> <span class="n">token</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">token</span> <span class="o">==</span> <span class="s">"--msgqueue"</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// ex.) --msgqueue 1115 durable 1114 durable</span>
        <span class="n">ssCmd</span> <span class="o">&gt;&gt;</span> <span class="n">name_queues</span><span class="p">[</span><span class="n">ENQUEUE_INDEX</span><span class="p">];</span>
        <span class="n">ssCmd</span> <span class="o">&gt;&gt;</span> <span class="n">lifeSpan_queues</span><span class="p">[</span><span class="n">ENQUEUE_INDEX</span><span class="p">];</span>
        <span class="n">ssCmd</span> <span class="o">&gt;&gt;</span> <span class="n">name_queues</span><span class="p">[</span><span class="n">DEQUEUE_INDEX</span><span class="p">];</span>
        <span class="n">ssCmd</span> <span class="o">&gt;&gt;</span> <span class="n">lifeSpan_queues</span><span class="p">[</span><span class="n">DEQUEUE_INDEX</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="c1">// デキューの常時監視をスタート</span>
    <span class="k">auto</span> <span class="n">th1</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="p">([]</span> <span class="p">{</span> <span class="n">workConsume</span><span class="p">();</span> <span class="p">});</span>

    <span class="c1">// エンキュー用の接続</span>
    <span class="c1">//auto* loop = EV_DEFAULT;</span>
    <span class="k">struct</span> <span class="nc">ev_loop</span><span class="o">*</span> <span class="n">loop</span> <span class="o">=</span> <span class="n">EV_DEFAULT</span><span class="p">;</span>
    <span class="n">AMQP</span><span class="o">::</span><span class="n">LibEvHandler</span> <span class="n">handler</span><span class="p">{</span> <span class="n">loop</span> <span class="p">};</span>
    <span class="n">AMQP</span><span class="o">::</span><span class="n">TcpConnection</span> <span class="n">connection</span><span class="p">{</span> <span class="o">&amp;</span><span class="n">handler</span><span class="p">,</span> <span class="n">ADDRESS</span> <span class="p">};</span>
    <span class="n">AMQP</span><span class="o">::</span><span class="n">TcpChannel</span> <span class="n">channel</span><span class="p">{</span> <span class="o">&amp;</span><span class="n">connection</span> <span class="p">};</span>

    <span class="c1">// 無限ループ</span>
    <span class="k">for</span> <span class="p">(;;)</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">message</span> <span class="o">=</span> <span class="n">rotationBuffer</span><span class="o">::</span><span class="n">getMessage</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="s">""</span> <span class="o">!=</span> <span class="n">message</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// 末尾に daze を付ける。</span>
            <span class="n">message</span> <span class="o">+=</span> <span class="s">"daze"</span><span class="p">;</span>

            <span class="c1">// エンキューする</span>
            <span class="n">enqueue</span><span class="p">(</span><span class="n">loop</span><span class="p">,</span> <span class="n">connection</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="n">message</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">sleep_for</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">milliseconds</span><span class="p">(</span><span class="mi">20</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="c1">// このプログラムは、自分では接続を切らない。</span>

    <span class="c1">// th1 スレッドの終了を待つ</span>
    <span class="n">th1</span><span class="p">.</span><span class="n">join</span><span class="p">();</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>これを改造することにする。</p>

<p>現状</p>

<ul>
<li>デキューを別スレッドにする</li>
<li>エンキューの無限ループを回す</li>
</ul>

<p>にしているが、次のように変える。</p>

<ul>
<li>エンキューを別スレッドにする</li>
<li>デキューの ev_loop を置いておくに任せる</li>
</ul>

<p>何が違うのか、という気はする。</p>

<h1>
<span id="名前は-tamesi35a2_cppcpp-にする" class="fragment"></span><a href="#%E5%90%8D%E5%89%8D%E3%81%AF-tamesi35a2_cppcpp-%E3%81%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>名前は tamesi35a2_cpp.cpp にする</h1>

<p>ちょっと待て。</p>

<p>無限ループの外で接続して、無限ループの中で切断してないか？<br>
これでは　接続と切断の１対１対応が　崩れている。</p>

<p>いったん、tamesi33a2_cpp.cpp のこの部分を直そう。</p>

<p>tamesi35a2_cpp.cpp</p>

<div class="code-frame" data-lang="cpp"><div class="highlight"><pre><code><span class="c1">// OS      : Windows10 : // このプログラムは動かない</span>
<span class="c1">//</span>
<span class="c1">// OS      : Ubuntu 16.04</span>
<span class="c1">// Library : libev</span>
<span class="c1">//         : Install   : Command  : sudo apt-get update</span>
<span class="c1">//                                : sudo apt-get install libev-dev</span>
<span class="c1">// Service : RabbitMQ</span>
<span class="c1">//         : Reference : Web site : Top page http://www.rabbitmq.com/</span>
<span class="c1">//         : Install   : Web site : Installing on Debian / Ubuntu http://www.rabbitmq.com/install-debian.html</span>
<span class="c1">//         : Manual    : Command  : man rabbitmqctl</span>
<span class="c1">//         : Start     : Command  : rabbitmq-server</span>
<span class="c1">//         : Stop      : Command  : rabbitmqctl stop</span>
<span class="c1">//         : Check     : Command  : rabbitmqctl status</span>
<span class="c1">//         :           : Command  : rabbitmqctl list_queues</span>
<span class="c1">// Library : AMQP-CPP</span>
<span class="c1">//         : Reference : Web site : AMQP-CPP README.md https://github.com/CopernicaMarketingSoftware/AMQP-CPP</span>
<span class="c1">//         : Reference : Web site : QueueDeclare http://docs.spring.io/spring-amqp-net/docs/1.0.x/api/html/Spring.Messaging.Amqp.Rabbit~Spring.Messaging.Amqp.Rabbit.Connection.CachedModel~QueueDeclare(String,Boolean,Boolean,Boolean,Boolean,Boolean,IDictionary).html</span>
<span class="c1">//         : Reference : Web site : EventingBasicConsumer https://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v1.4.0/rabbitmq-dotnet-client-1.4.0-net-2.0-htmldoc/type-RabbitMQ.Client.Events.EventingBasicConsumer.html</span>
<span class="c1">//         : Reference : Web site : BasicConsume https://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v1.4.0/rabbitmq-dotnet-client-1.4.0-net-2.0-htmldoc/type-RabbitMQ.Client.IModel.html#method-M:RabbitMQ.Client.IModel.BasicConsume(System.UInt16,System.String,System.Boolean,System.Collections.IDictionary,RabbitMQ.Client.IBasicConsumer)</span>
<span class="c1">//         : Reference : Web site : C#でconstな配列を実現する (もっとクールにプログラミング) http://pgnote.net/?p=885</span>
<span class="c1">//         : Reference : Web site : AMQP-CPP (docsforge.com) http://docsforge.com/11/AMQP-CPP/docs/latest/namespace-AMQP/class-TcpConnection/</span>
<span class="c1">//</span>
<span class="c1">// Program : this</span>
<span class="c1">//         : Compile   : Command  : g++ -std=c++11 tamesi35a2_cpp.cpp -o tamesi35a2_cpp.exe -lev -lamqpcpp -pthread</span>
<span class="c1">//         : Execute   : Command  : // バックグラウンドで実行</span>
<span class="c1">//                                : ./tamesi35a2_cpp.exe --msgqueue 1117 durable 1116 durable 2&gt; ./tamesi35a2_cpp.err.log &amp;</span>
<span class="c1">//         : Stop      : Typing   : [Ctrl]+[C]</span>
<span class="c1">//</span>
<span class="c1">// メッセージの末尾に daze を付けます。</span>
<span class="c1">// デキューは「1112」、エンキューは「1113」キューに向けて行います。</span>
<span class="c1">// 標準入出力は、キーボード、画面には接続しないようにします。</span>

<span class="cp">#include &lt;string&gt; // std::string
#include &lt;iostream&gt; // std::cout
#include &lt;sstream&gt; // std::ostringstream
#include &lt;chrono&gt;
#include &lt;thread&gt; // sleep_for
#include &lt;future&gt; // thread
</span>
<span class="c1">// プロセス間通信用</span>
<span class="cp">#include &lt;ev.h&gt;
#include &lt;amqpcpp.h&gt;
#include &lt;amqpcpp/libev.h&gt;
</span>
<span class="k">static</span> <span class="n">AMQP</span><span class="o">::</span><span class="n">Address</span> <span class="n">ADDRESS</span><span class="p">{</span> <span class="s">"amqp://localhost:5672"</span> <span class="p">};</span>
<span class="c1">// 0 : enqueue用設定</span>
<span class="c1">// 1 : dequeue用設定</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">ENQUEUE_INDEX</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">DEQUEUE_INDEX</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">NUM_INDEX</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="k">static</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">name_queues</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="s">"1117"</span><span class="p">,</span> <span class="s">"1116"</span> <span class="p">};</span>
<span class="k">static</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">lifeSpan_queues</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="s">"durable"</span><span class="p">,</span> <span class="s">"durable"</span> <span class="p">};</span>

<span class="c1">/// &lt;summary&gt;</span>
<span class="c1">/// 回転式バッファー。</span>
<span class="c1">/// これはメイン・スレッドに置く。</span>
<span class="c1">/// デキューのスレッドでエンキューすることはできない。</span>
<span class="c1">/// デキュー処理は、回転式バッファーを仲介にしてエンキュー処理にメッセージを渡す。</span>
<span class="c1">/// &lt;/summary&gt;</span>
<span class="k">namespace</span> <span class="n">rotationBuffer</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">bufferSize</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
    <span class="k">static</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">buffer</span><span class="p">[</span><span class="n">bufferSize</span><span class="p">]</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="k">static</span> <span class="kt">int</span> <span class="n">bufferCursors</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">};</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">PUT_INDEX</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">GET_INDEX</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

    <span class="n">std</span><span class="o">::</span><span class="n">mutex</span> <span class="n">_mutex</span><span class="p">;</span>
    <span class="k">static</span> <span class="kt">void</span> <span class="n">putMessage</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">message</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">unique_lock</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="o">&gt;</span> <span class="n">lock</span><span class="p">(</span><span class="n">_mutex</span><span class="p">);</span>
        <span class="n">buffer</span><span class="p">[</span><span class="n">bufferCursors</span><span class="p">[</span><span class="n">PUT_INDEX</span><span class="p">]]</span> <span class="o">=</span> <span class="n">message</span><span class="p">;</span>
        <span class="n">bufferCursors</span><span class="p">[</span><span class="n">PUT_INDEX</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">bufferCursors</span><span class="p">[</span><span class="n">PUT_INDEX</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">bufferSize</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">bufferCursors</span><span class="p">[</span><span class="n">PUT_INDEX</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">static</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">getMessage</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">unique_lock</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="o">&gt;</span> <span class="n">lock</span><span class="p">(</span><span class="n">_mutex</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="s">""</span> <span class="o">!=</span> <span class="n">buffer</span><span class="p">[</span><span class="n">bufferCursors</span><span class="p">[</span><span class="n">GET_INDEX</span><span class="p">]])</span>
        <span class="p">{</span>
            <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">message</span> <span class="o">=</span> <span class="n">buffer</span><span class="p">[</span><span class="n">bufferCursors</span><span class="p">[</span><span class="n">GET_INDEX</span><span class="p">]];</span>
            <span class="n">buffer</span><span class="p">[</span><span class="n">bufferCursors</span><span class="p">[</span><span class="n">GET_INDEX</span><span class="p">]]</span> <span class="o">=</span> <span class="s">""</span><span class="p">;</span>
            <span class="n">bufferCursors</span><span class="p">[</span><span class="n">GET_INDEX</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">bufferCursors</span><span class="p">[</span><span class="n">GET_INDEX</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">bufferSize</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="n">bufferCursors</span><span class="p">[</span><span class="n">GET_INDEX</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">message</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="s">""</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// メッセージキューにエンキュー</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">enqueue</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">message</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// エンキュー用の接続</span>
    <span class="c1">//auto* loop = EV_DEFAULT;</span>
    <span class="k">struct</span> <span class="nc">ev_loop</span><span class="o">*</span> <span class="n">loop</span> <span class="o">=</span> <span class="n">EV_DEFAULT</span><span class="p">;</span>
    <span class="n">AMQP</span><span class="o">::</span><span class="n">LibEvHandler</span> <span class="n">handler</span><span class="p">{</span> <span class="n">loop</span> <span class="p">};</span>
    <span class="n">AMQP</span><span class="o">::</span><span class="n">TcpConnection</span> <span class="n">connection</span><span class="p">{</span> <span class="o">&amp;</span><span class="n">handler</span><span class="p">,</span> <span class="n">ADDRESS</span> <span class="p">};</span>
    <span class="n">AMQP</span><span class="o">::</span><span class="n">TcpChannel</span> <span class="n">channel</span><span class="p">{</span> <span class="o">&amp;</span><span class="n">connection</span> <span class="p">};</span>

    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">exchange_name</span> <span class="o">=</span> <span class="s">"myexchange"</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">routing_key</span> <span class="o">=</span> <span class="s">""</span><span class="p">;</span>

    <span class="kt">int</span> <span class="n">lifeSpan</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">a</span> <span class="o">=</span> <span class="n">lifeSpan_queues</span><span class="p">[</span><span class="n">ENQUEUE_INDEX</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="s">"durable"</span> <span class="o">==</span> <span class="n">a</span><span class="p">)</span> <span class="p">{</span> <span class="n">lifeSpan</span> <span class="o">=</span> <span class="n">AMQP</span><span class="o">::</span><span class="n">durable</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="s">"autodelete"</span> <span class="o">==</span> <span class="n">a</span><span class="p">)</span> <span class="p">{</span> <span class="n">lifeSpan</span> <span class="o">=</span> <span class="n">AMQP</span><span class="o">::</span><span class="n">autodelete</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="s">"passive"</span> <span class="o">==</span> <span class="n">a</span><span class="p">)</span> <span class="p">{</span> <span class="n">lifeSpan</span> <span class="o">=</span> <span class="n">AMQP</span><span class="o">::</span><span class="n">passive</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="s">"exclusive"</span> <span class="o">==</span> <span class="n">a</span><span class="p">)</span> <span class="p">{</span> <span class="n">lifeSpan</span> <span class="o">=</span> <span class="n">AMQP</span><span class="o">::</span><span class="n">exclusive</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">"未対応のキュー寿命が指定されました。["</span> <span class="o">+</span> <span class="n">a</span> <span class="o">+</span> <span class="s">"]"</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">channel</span><span class="p">.</span><span class="n">declareQueue</span><span class="p">(</span><span class="n">name_queues</span><span class="p">[</span><span class="n">ENQUEUE_INDEX</span><span class="p">],</span> <span class="n">lifeSpan</span><span class="p">)</span>
        <span class="p">.</span><span class="n">onError</span><span class="p">([</span><span class="o">&amp;</span><span class="n">a</span><span class="p">](</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">errMsg</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">"error declaring queue: "</span> <span class="o">&lt;&lt;</span> <span class="n">errMsg</span> <span class="o">&lt;&lt;</span> <span class="s">" lifeSpan=["</span> <span class="o">&lt;&lt;</span> <span class="n">a</span> <span class="o">&lt;&lt;</span> <span class="s">"]"</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="p">});</span>

    <span class="n">channel</span><span class="p">.</span><span class="n">bindQueue</span><span class="p">(</span><span class="n">exchange_name</span><span class="p">,</span> <span class="n">name_queues</span><span class="p">[</span><span class="n">ENQUEUE_INDEX</span><span class="p">],</span> <span class="n">routing_key</span><span class="p">)</span>
        <span class="p">.</span><span class="n">onSuccess</span><span class="p">([</span><span class="o">&amp;</span><span class="n">connection</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">channel</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">exchange_name</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">routing_key</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">message</span><span class="p">]()</span> <span class="p">{</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">channel</span><span class="p">.</span><span class="n">publish</span><span class="p">(</span><span class="n">exchange_name</span><span class="p">,</span> <span class="n">routing_key</span><span class="p">,</span> <span class="n">message</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">message</span><span class="p">.</span><span class="n">size</span><span class="p">()))</span> <span class="p">{</span>
            <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">"failed to publish?</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// break in ev loop.</span>
        <span class="n">connection</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
    <span class="p">});</span>

    <span class="c1">// このループは、パブリッシュ後に抜ける</span>
    <span class="n">ev_run</span><span class="p">(</span><span class="n">loop</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// 受信できたときに割り込んでくる処理</span>
<span class="c1">// startConsume() しておくこと。</span>
<span class="k">static</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="nf">dequeue</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">message</span><span class="p">;</span>

    <span class="k">while</span> <span class="p">(</span><span class="s">""</span> <span class="o">==</span> <span class="n">message</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">message</span> <span class="o">=</span> <span class="n">rotationBuffer</span><span class="o">::</span><span class="n">getMessage</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">message</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">//// メッセージ・キューの送信を担当</span>
<span class="c1">//static void workProduce()</span>
<span class="c1">//{</span>
<span class="c1">//</span>
<span class="c1">//}</span>

<span class="c1">// メッセージ・キューの監視を開始</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">workConsume</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// Connect to the AMQP service.</span>
    <span class="k">auto</span> <span class="o">*</span><span class="n">loop</span> <span class="o">=</span> <span class="n">EV_DEFAULT</span><span class="p">;</span>
    <span class="n">AMQP</span><span class="o">::</span><span class="n">LibEvHandler</span> <span class="n">handler</span><span class="p">(</span><span class="n">loop</span><span class="p">);</span>
    <span class="n">AMQP</span><span class="o">::</span><span class="n">TcpConnection</span> <span class="n">connection</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handler</span><span class="p">,</span> <span class="n">ADDRESS</span><span class="p">);</span>
    <span class="n">AMQP</span><span class="o">::</span><span class="n">TcpChannel</span> <span class="n">channel</span><span class="p">(</span><span class="o">&amp;</span><span class="n">connection</span><span class="p">);</span>

    <span class="c1">// I will go to the front of the box named "1111".</span>
    <span class="kt">int</span> <span class="n">lifeSpan</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">a</span> <span class="o">=</span> <span class="n">lifeSpan_queues</span><span class="p">[</span><span class="n">DEQUEUE_INDEX</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="s">"durable"</span> <span class="o">==</span> <span class="n">a</span><span class="p">)</span> <span class="p">{</span> <span class="n">lifeSpan</span> <span class="o">=</span> <span class="n">AMQP</span><span class="o">::</span><span class="n">durable</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="s">"autodelete"</span> <span class="o">==</span> <span class="n">a</span><span class="p">)</span> <span class="p">{</span> <span class="n">lifeSpan</span> <span class="o">=</span> <span class="n">AMQP</span><span class="o">::</span><span class="n">autodelete</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="s">"passive"</span> <span class="o">==</span> <span class="n">a</span><span class="p">)</span> <span class="p">{</span> <span class="n">lifeSpan</span> <span class="o">=</span> <span class="n">AMQP</span><span class="o">::</span><span class="n">passive</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="s">"exclusive"</span> <span class="o">==</span> <span class="n">a</span><span class="p">)</span> <span class="p">{</span> <span class="n">lifeSpan</span> <span class="o">=</span> <span class="n">AMQP</span><span class="o">::</span><span class="n">exclusive</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">"未対応のキュー寿命が指定されました。["</span> <span class="o">+</span> <span class="n">a</span> <span class="o">+</span> <span class="s">"]"</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">channel</span><span class="p">.</span><span class="n">declareQueue</span><span class="p">(</span><span class="n">name_queues</span><span class="p">[</span><span class="n">DEQUEUE_INDEX</span><span class="p">],</span> <span class="n">lifeSpan</span><span class="p">);</span>

    <span class="c1">// I look inside the box.</span>
    <span class="k">auto</span> <span class="n">errorCb</span> <span class="o">=</span> <span class="p">[</span><span class="o">&amp;</span><span class="n">a</span><span class="p">](</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">errMsg</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">"My ID watching failed ["</span> <span class="o">&lt;&lt;</span> <span class="n">errMsg</span> <span class="o">&lt;&lt;</span> <span class="s">"] lifeSpan=["</span> <span class="o">&lt;&lt;</span> <span class="n">a</span> <span class="o">&lt;&lt;</span> <span class="s">"]"</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="k">auto</span> <span class="n">messageCb</span> <span class="o">=</span> <span class="p">[</span><span class="o">&amp;</span><span class="n">channel</span><span class="p">](</span><span class="k">const</span> <span class="n">AMQP</span><span class="o">::</span><span class="n">Message</span> <span class="o">&amp;</span><span class="n">message</span><span class="p">,</span> <span class="kt">uint64_t</span> <span class="n">deliveryTag</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">redelivered</span><span class="p">)</span> <span class="p">{</span>

        <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">myString</span><span class="p">(</span><span class="n">message</span><span class="p">.</span><span class="n">body</span><span class="p">(),</span> <span class="n">message</span><span class="p">.</span><span class="n">bodySize</span><span class="p">());</span>
        <span class="n">rotationBuffer</span><span class="o">::</span><span class="n">putMessage</span><span class="p">(</span><span class="n">myString</span><span class="p">);</span>

        <span class="n">channel</span><span class="p">.</span><span class="n">ack</span><span class="p">(</span><span class="n">deliveryTag</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="n">channel</span><span class="p">.</span><span class="n">consume</span><span class="p">(</span><span class="n">name_queues</span><span class="p">[</span><span class="n">DEQUEUE_INDEX</span><span class="p">])</span>
        <span class="p">.</span><span class="n">onReceived</span><span class="p">(</span><span class="n">messageCb</span><span class="p">)</span>
        <span class="p">.</span><span class="n">onError</span><span class="p">(</span><span class="n">errorCb</span><span class="p">);</span>

    <span class="c1">// I will keep on forever.</span>
    <span class="n">ev_run</span><span class="p">(</span><span class="n">loop</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

    <span class="c1">// I will not come here.</span>
    <span class="k">return</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">cmdArg</span><span class="p">;</span>
    <span class="c1">// プログラム名を省き、コマンドライン引数だけをつなげる。</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">argc</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">cmdArg</span> <span class="o">+=</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="s">" "</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">std</span><span class="o">::</span><span class="n">istringstream</span> <span class="n">ssCmd</span><span class="p">(</span><span class="n">cmdArg</span><span class="p">);</span>

    <span class="c1">// 半角スペース区切りの最初の1トークンを拾う</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">token</span><span class="p">;</span>
    <span class="n">ssCmd</span> <span class="o">&gt;&gt;</span> <span class="n">token</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">token</span> <span class="o">==</span> <span class="s">"--msgqueue"</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// ex.) --msgqueue 1115 durable 1114 durable</span>
        <span class="n">ssCmd</span> <span class="o">&gt;&gt;</span> <span class="n">name_queues</span><span class="p">[</span><span class="n">ENQUEUE_INDEX</span><span class="p">];</span>
        <span class="n">ssCmd</span> <span class="o">&gt;&gt;</span> <span class="n">lifeSpan_queues</span><span class="p">[</span><span class="n">ENQUEUE_INDEX</span><span class="p">];</span>
        <span class="n">ssCmd</span> <span class="o">&gt;&gt;</span> <span class="n">name_queues</span><span class="p">[</span><span class="n">DEQUEUE_INDEX</span><span class="p">];</span>
        <span class="n">ssCmd</span> <span class="o">&gt;&gt;</span> <span class="n">lifeSpan_queues</span><span class="p">[</span><span class="n">DEQUEUE_INDEX</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="c1">// デキューの常時監視をスタート</span>
    <span class="k">auto</span> <span class="n">th1</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="p">([]</span> <span class="p">{</span> <span class="n">workConsume</span><span class="p">();</span> <span class="p">});</span>

    <span class="c1">// 無限ループ</span>
    <span class="k">for</span> <span class="p">(;;)</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">message</span> <span class="o">=</span> <span class="n">rotationBuffer</span><span class="o">::</span><span class="n">getMessage</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="s">""</span> <span class="o">!=</span> <span class="n">message</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// 末尾に daze を付ける。</span>
            <span class="n">message</span> <span class="o">+=</span> <span class="s">"daze"</span><span class="p">;</span>

            <span class="c1">// エンキューする</span>
            <span class="n">enqueue</span><span class="p">(</span> <span class="n">message</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">sleep_for</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">milliseconds</span><span class="p">(</span><span class="mi">20</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="c1">// このプログラムは、自分では接続を切らない。</span>

    <span class="c1">// th1 スレッドの終了を待つ</span>
    <span class="n">th1</span><span class="p">.</span><span class="n">join</span><span class="p">();</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code># g++ -std=c++11 tamesi35a2_cpp.cpp -o tamesi35a2_cpp.exe -lev -lamqpcpp -pthread
# ./tamesi35a2_cpp.exe --msgqueue 1117 durable 1116 durable 2&gt; ./tamesi35a2_cpp.err.log &amp;
[1] 20175
</code></pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code># ./tamesi33a2_cpp.exe --msgqueue 1117 durable 1116 durable &amp;
[2] 20225
My ID watching failed [Channel is in error state] lifeSpan=[durable]
</code></pre></div></div>

<p>うーむ。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code># ps aux | grep .exe
root      1743  3.5  0.0 126580    52 ?        Sl   Mar11 153:59 /usr/bin/cli ./loop28_cs.exe
root      1820  0.0  0.0   4216    12 ?        S    Mar11   0:24 ./loop28_cpp.exe
root      3554  0.2  0.4 179196  4916 ?        Sl   Mar13   2:11 ./tamesi33a2_cpp.exe
root      7457  0.2  0.2 244736  2904 ?        Sl   Mar13   1:49 ./tamesi33a2_cpp.exe --msgqueue 1117 durable 1116 durable
root     11288  0.2  0.4 341724  4428 ?        Sl   Mar11   9:53 /usr/bin/cli ./tamesi33a2_cs.exe
root     20175  0.2  0.3 170872  3156 pts/6    Sl   07:28   0:00 ./tamesi35a2_cpp.exe --msgqueue 1117 durable 1116 durable
root     20225  0.2  0.2 244736  2876 pts/6    Sl   07:31   0:00 ./tamesi33a2_cpp.exe --msgqueue 1117 durable 1116 durable
root     20240  0.2  0.2 179200  2984 pts/6    Sl   07:32   0:00 ./tamesi33a2_cpp.exe --msgqueue 1117 durable 1116 durable
root     20259  0.0  0.0  12936   988 pts/6    S+   07:33   0:00 grep --color=auto .exe
</code></pre></div></div>

<p>なんか　いっぱい動いてるな。止めるか。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code># kill 1743
# kill 1820
# kill 3554
# kill 7457
# kill 11288
# kill 20175
# kill 20225
[1]   Terminated              ./tamesi35a2_cpp.exe --msgqueue 1117 durable 1116 durable 2&gt; ./tamesi35a2_cpp.err.log
# kill 20240
[2]-  Terminated              ./tamesi33a2_cpp.exe --msgqueue 1117 durable 1116 durable
# ps aux | grep .exe
root     20296  0.0  0.0  12936   984 pts/6    S+   07:35   0:00 grep --color=auto .exe
[3]+  Terminated              ./tamesi33a2_cpp.exe --msgqueue 1117 durable 1116 durable
</code></pre></div></div>

<p>起動するプログラム番号も間違えてるし。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code># ./tamesi35a2_cpp.exe --msgqueue 1117 durable 1116 durable &amp;
[1] 20308
My ID watching failed [Channel is in error state] lifeSpan=[durable]
# ./tamesi35a2_cpp.exe --msgqueue 1117 durable 1116 durable &amp;
[2] 20324
My ID watching failed [Channel is in error state] lifeSpan=[durable]
</code></pre></div></div>

<p>うーむ。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code># ./tamesi35a2_cpp.exe --msgqueue 1117 durable 1116 durable 2&gt; ./tamesi35a2_cpp.err.log &amp;
[3] 20489
Welcome! AMQP::durable=[1] AMQP::autodelete=[2] AMQP::passive=[8] AMQP::exclusive=[512]
</code></pre></div></div>

<p>ためしに値を出力したら　うまくいったぞ？</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code># ./tamesi34_cs.exe
削除したいキューがあれば名前を、無ければ空文字列を入れろだぜ☆（＾～＾）
キュー名を入力    : キューを削除します
空文字列で[Enter] : 次のステップへ進む
Name or empty ? &gt;
エンキュー先のメッセージ・キューの名前を入れろだぜ☆（＾～＾）
Queue name? &gt; 1116
エンキュー先のメッセージ・キューの寿命を、足し算して答えろだぜ☆（＾～＾）
(1) durable    : RabbitMQが止まってもキューを残す
(2) autodelete : コンシューマーが１人も接続していなかったら消す
(4) passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ
(8) exclusive  : この接続でだけ使える。この接続が切れたら消す
Number ? &gt; 1
デキュー先のメッセージ・キューの名前を入れろだぜ☆（＾～＾）
Queue name? &gt; 1117
デキュー先のメッセージ・キューの寿命を、足し算して答えろだぜ☆（＾～＾）
(1) durable    : RabbitMQが止まってもキューを残す
(2) autodelete : コンシューマーが１人も接続していなかったら消す
(4) passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ
(8) exclusive  : この接続でだけ使える。この接続が切れたら消す
Number ? &gt; 1
GetChannel index = [1]
    QUEUE_NAMES[index] = [1117]
    passive_lifeSpans[index] = [False]
    durable_lifeSpans[index] = [True]
    exclusive_lifeSpans[index] = [False]
    autodelete_lifeSpans[index] = [False]
    nowait は仮に false 固定
    arguments は仮に null 固定
終了するときは[Ctrl]+[C]キーを押せだぜ☆（＾～＾）
エンキューするときはメッセージを打ち込んで[Enter]キーを押せだぜ☆(＾◇＾)
Enqueue? &gt; usi
GetChannel index = [0]
    QUEUE_NAMES[index] = [1116]
    passive_lifeSpans[index] = [False]
    durable_lifeSpans[index] = [True]
    exclusive_lifeSpans[index] = [False]
    autodelete_lifeSpans[index] = [False]
    nowait は仮に false 固定
    arguments は仮に null 固定

Unhandled Exception:
RabbitMQ.Client.Exceptions.OperationInterruptedException: The AMQP operation was interrupted: AMQP close-reason, initiated by Peer, code=406, text="PRECONDITION_FAILED - inequivalent arg 'durable' for queue '1116' in vhost '/': received 'true' but current is 'false'", classId=50, methodId=10, cause=
  at RabbitMQ.Client.Impl.SimpleBlockingRpcContinuation.GetReply () &lt;0x41a50410 + 0x00107&gt; in &lt;filename unknown&gt;:0
  at RabbitMQ.Client.Impl.ModelBase.ModelRpc (RabbitMQ.Client.Impl.MethodBase method, RabbitMQ.Client.Impl.ContentHeaderBase header, System.Byte[] body) &lt;0x41a4e290 + 0x000fd&gt; in &lt;filename unknown&gt;:0
  at RabbitMQ.Client.Framing.Impl.v0_8.Model.QueueDeclare (System.String queue, Boolean passive, Boolean durable, Boolean exclusive, Boolean autoDelete, Boolean nowait, IDictionary arguments) &lt;0x41a526b0 + 0x00113&gt; in &lt;filename unknown&gt;:0
  at UsagiMQ.Program.GetChannel (Int32 index) &lt;0x41a13d20 + 0x00436&gt; in &lt;filename unknown&gt;:0
  at UsagiMQ.Program.Enqueue (System.String message) &lt;0x41a537c0 + 0x00013&gt; in &lt;filename unknown&gt;:0
  at UsagiMQ.Program.Main (System.String[] args) &lt;0x41a0ed50 + 0x0099f&gt; in &lt;filename unknown&gt;:0
[ERROR] FATAL UNHANDLED EXCEPTION: RabbitMQ.Client.Exceptions.OperationInterruptedException: The AMQP operation was interrupted: AMQP close-reason, initiated by Peer, code=406, text="PRECONDITION_FAILED - inequivalent arg 'durable' for queue '1116' in vhost '/': received 'true' but current is 'false'", classId=50, methodId=10, cause=
  at RabbitMQ.Client.Impl.SimpleBlockingRpcContinuation.GetReply () &lt;0x41a50410 + 0x00107&gt; in &lt;filename unknown&gt;:0
  at RabbitMQ.Client.Impl.ModelBase.ModelRpc (RabbitMQ.Client.Impl.MethodBase method, RabbitMQ.Client.Impl.ContentHeaderBase header, System.Byte[] body) &lt;0x41a4e290 + 0x000fd&gt; in &lt;filename unknown&gt;:0
  at RabbitMQ.Client.Framing.Impl.v0_8.Model.QueueDeclare (System.String queue, Boolean passive, Boolean durable, Boolean exclusive, Boolean autoDelete, Boolean nowait, IDictionary arguments) &lt;0x41a526b0 + 0x00113&gt; in &lt;filename unknown&gt;:0
  at UsagiMQ.Program.GetChannel (Int32 index) &lt;0x41a13d20 + 0x00436&gt; in &lt;filename unknown&gt;:0
  at UsagiMQ.Program.Enqueue (System.String message) &lt;0x41a537c0 + 0x00013&gt; in &lt;filename unknown&gt;:0
  at UsagiMQ.Program.Main (System.String[] args) &lt;0x41a0ed50 + 0x0099f&gt; in &lt;filename unknown&gt;:0
</code></pre></div></div>

<p>このエラーも分からずじまい。</p>

<p>接続部分を直そう。</p>

<p>あれっ、直してこれか。</p>

<p>じゃあ、C++ と C# で送受信テストしてみよう。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code># ps aux | grep exe
root     20308  0.2  0.3 170872  3156 pts/6    Sl   07:35   0:02 ./tamesi35a2_cpp.exe --msgqueue 1117 durable 1116 durable
root     20324  0.2  0.5 170872  5188 pts/6    Sl   07:36   0:01 ./tamesi35a2_cpp.exe --msgqueue 1117 durable 1116 durable
root     20489  0.2  0.3 170872  3136 pts/6    Sl   07:42   0:00 ./tamesi35a2_cpp.exe --msgqueue 1117 durable 1116 durable
root     20587  0.0  0.0  12936   988 pts/6    S+   07:48   0:00 grep --color=auto exe
</code></pre></div></div>

<p>なんで　こんなにプロセス立ってるんだろな。</p>

<h1>
<span id="c-ではシングルトンでやってた" class="fragment"></span><a href="#c-%E3%81%A7%E3%81%AF%E3%82%B7%E3%83%B3%E3%82%B0%E3%83%AB%E3%83%88%E3%83%B3%E3%81%A7%E3%82%84%E3%81%A3%E3%81%A6%E3%81%9F"><i class="fa fa-link"></i></a>C# ではシングルトンでやってた</h1>

<p>tamesi33a2_cs.cs</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre><code><span class="c1">// OS  : Windows 10</span>
<span class="c1">// IDE : Visual Studio 2015</span>
<span class="c1">//       Install : NuGet   : Install-Package RabbitMQ.Client -Version 4.1.1</span>
<span class="c1">//</span>
<span class="c1">// OS  : Ubuntu 16.04</span>
<span class="c1">//       Compile : Command : mcs /r:RabbitMQ.Client.dll -define:UBUNTU tamesi33a2_cs.cs</span>
<span class="c1">//               : Command : chmod 755 tamesi33a2_cs.cs</span>
<span class="c1">//       Execute : Command : // バックグラウンドで実行する</span>
<span class="c1">//                         : nohup ./tamesi33a2_cs.exe &gt; ./tamesi33a2_cs.out.log 2&gt; ./tamesi33a2_cs.err.log &lt; /dev/null &amp;</span>
<span class="c1">//       Check   :         : // tamesi33a1_cs.exe を使う</span>
<span class="c1">//--------------------------------------------------------------------------------</span>
<span class="c1">// tamesi33a2_cs.cs</span>

<span class="c1">// Ubuntu の RabbitMQ はソースのバージョンが古いのか、API が異なった。</span>
<span class="c1">// #define UBUNTU</span>

<span class="k">using</span> <span class="nn">RabbitMQ.Client</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">RabbitMQ.Client.Events</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.ObjectModel</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Text</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Threading</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">UsagiMQ</span>
<span class="p">{</span>
    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">/// メッセージの末尾に daze を付けます。</span>
    <span class="c1">/// デキューは「1112」、エンキューは「1113」キューに向けて行います。</span>
    <span class="c1">/// 標準入出力は、キーボード、画面には接続しないようにします。</span>
    <span class="c1">/// </span>
    <span class="c1">/// 参照 : QueueDeclare http://docs.spring.io/spring-amqp-net/docs/1.0.x/api/html/Spring.Messaging.Amqp.Rabbit~Spring.Messaging.Amqp.Rabbit.Connection.CachedModel~QueueDeclare(String,Boolean,Boolean,Boolean,Boolean,Boolean,IDictionary).html</span>
    <span class="c1">/// 参照 : EventingBasicConsumer https://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v1.4.0/rabbitmq-dotnet-client-1.4.0-net-2.0-htmldoc/type-RabbitMQ.Client.Events.EventingBasicConsumer.html</span>
    <span class="c1">/// 参照 : BasicConsume https://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v1.4.0/rabbitmq-dotnet-client-1.4.0-net-2.0-htmldoc/type-RabbitMQ.Client.IModel.html#method-M:RabbitMQ.Client.IModel.BasicConsume(System.UInt16,System.String,System.Boolean,System.Collections.IDictionary,RabbitMQ.Client.IBasicConsumer)</span>
    <span class="c1">/// 参照 : C#でconstな配列を実現する (もっとクールにプログラミング) http://pgnote.net/?p=885</span>
    <span class="c1">/// &lt;/summary&gt;</span>
    <span class="k">class</span> <span class="nc">Program</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="k">const</span> <span class="kt">string</span> <span class="n">HOST_NAME</span> <span class="p">=</span> <span class="s">"localhost"</span><span class="p">;</span>
        <span class="k">public</span> <span class="k">static</span> <span class="k">readonly</span> <span class="n">ReadOnlyCollection</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">QUEUE_NAMES</span> <span class="p">=</span>
            <span class="n">Array</span><span class="p">.</span><span class="nf">AsReadOnly</span><span class="p">(</span><span class="k">new</span> <span class="kt">string</span><span class="p">[]</span> <span class="p">{</span> <span class="s">"1113"</span><span class="p">,</span> <span class="s">"1112"</span> <span class="p">});</span>
        <span class="k">public</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">ENQUEUE_INDEX</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
        <span class="k">public</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">DEQUEUE_INDEX</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span>

        <span class="c1">// 回転式バッファー</span>
        <span class="k">public</span> <span class="k">static</span> <span class="n">RotationBuffer</span> <span class="n">rollingBuffer</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RotationBuffer</span><span class="p">();</span>

        <span class="k">public</span> <span class="k">static</span> <span class="n">ConnectionFactory</span> <span class="nf">GetFactory</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">null</span> <span class="p">==</span> <span class="n">m_factory_</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">m_factory_</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ConnectionFactory</span><span class="p">()</span> <span class="p">{</span> <span class="n">HostName</span> <span class="p">=</span> <span class="n">HOST_NAME</span> <span class="p">};</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">m_factory_</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">static</span> <span class="n">ConnectionFactory</span> <span class="n">m_factory_</span><span class="p">;</span>

        <span class="k">public</span> <span class="k">static</span> <span class="n">IConnection</span> <span class="nf">GetConnection</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">null</span> <span class="p">==</span> <span class="n">m_connection_</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">m_connection_</span> <span class="p">=</span> <span class="nf">GetFactory</span><span class="p">().</span><span class="nf">CreateConnection</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">m_connection_</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">static</span> <span class="n">IConnection</span> <span class="n">m_connection_</span><span class="p">;</span>

        <span class="k">public</span> <span class="k">static</span> <span class="kt">bool</span> <span class="nf">IsConnected</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">null</span> <span class="p">!=</span> <span class="n">m_connection_</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="n">m_connection_</span><span class="p">.</span><span class="n">IsOpen</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">static</span> <span class="n">IModel</span> <span class="nf">GetChannel</span><span class="p">(</span><span class="kt">int</span> <span class="n">index</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">null</span> <span class="p">==</span> <span class="n">m_channels_</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
            <span class="p">{</span>
                <span class="n">m_channels_</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">=</span> <span class="nf">GetConnection</span><span class="p">().</span><span class="nf">CreateModel</span><span class="p">();</span>
<span class="cp">#if UBUNTU
</span>                <span class="c1">// Ubuntuでは何故か Spring.Messaging.Amqp.Rabbit の引数 7 つのやつになっている。</span>
                <span class="n">m_channels_</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="nf">QueueDeclare</span><span class="p">(</span><span class="n">QUEUE_NAMES</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="k">false</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span>
<span class="cp">#else
</span>                <span class="n">m_channels_</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="nf">QueueDeclare</span><span class="p">(</span><span class="n">QUEUE_NAMES</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="k">false</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span>
<span class="cp">#endif
</span>            <span class="p">}</span>
            <span class="k">return</span> <span class="n">m_channels_</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
        <span class="p">}</span>
        <span class="k">static</span> <span class="n">IModel</span><span class="p">[]</span> <span class="n">m_channels_</span> <span class="p">=</span> <span class="k">new</span> <span class="n">IModel</span><span class="p">[</span><span class="m">2</span><span class="p">];</span>

        <span class="k">public</span> <span class="k">static</span> <span class="n">EventingBasicConsumer</span> <span class="nf">GetConsumer</span><span class="p">(</span><span class="kt">int</span> <span class="n">index</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">null</span> <span class="p">==</span> <span class="n">m_consumers_</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
            <span class="p">{</span>
<span class="cp">#if UBUNTU
</span>                <span class="c1">// Ubuntuでは何故か v1.4.0 の引数が 0 個のやつになっている。調べたが引数が1個～6個のものは無かった。</span>
                <span class="n">m_consumers_</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">EventingBasicConsumer</span><span class="p">();</span>
<span class="cp">#else
</span>                <span class="n">m_consumers_</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">EventingBasicConsumer</span><span class="p">(</span><span class="nf">GetChannel</span><span class="p">(</span><span class="n">index</span><span class="p">));</span>
<span class="cp">#endif
</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">m_consumers_</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
        <span class="p">}</span>
        <span class="k">static</span> <span class="n">EventingBasicConsumer</span><span class="p">[]</span> <span class="n">m_consumers_</span> <span class="p">=</span> <span class="k">new</span> <span class="n">EventingBasicConsumer</span><span class="p">[</span><span class="m">2</span><span class="p">];</span>

        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// 受信できたときに割り込んでくる処理</span>
        <span class="c1">/// &lt;/summary&gt;</span>
<span class="cp">#if UBUNTU
</span>        <span class="k">public</span> <span class="k">static</span> <span class="n">BasicDeliverEventHandler</span> <span class="nf">GetReceiveHandler</span><span class="p">()</span>
<span class="cp">#else
</span>        <span class="k">public</span> <span class="k">static</span> <span class="n">EventHandler</span><span class="p">&lt;</span><span class="n">BasicDeliverEventArgs</span><span class="p">&gt;</span> <span class="nf">GetReceiveHandler</span><span class="p">()</span>
<span class="cp">#endif
</span>        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">null</span> <span class="p">==</span> <span class="n">m_eventHandler_</span><span class="p">)</span>
            <span class="p">{</span>
<span class="cp">#if UBUNTU
</span>                <span class="n">m_eventHandler_</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">BasicDeliverEventHandler</span><span class="p">((</span><span class="n">model</span><span class="p">,</span> <span class="n">ea</span><span class="p">)</span> <span class="p">=&gt;</span>
<span class="cp">#else
</span>                <span class="n">m_eventHandler_</span> <span class="p">=</span> <span class="k">new</span> <span class="n">EventHandler</span><span class="p">&lt;</span><span class="n">BasicDeliverEventArgs</span><span class="p">&gt;((</span><span class="n">model</span><span class="p">,</span> <span class="n">ea</span><span class="p">)</span> <span class="p">=&gt;</span>
<span class="cp">#endif
</span>                <span class="p">{</span>
                    <span class="kt">byte</span><span class="p">[]</span> <span class="n">body</span> <span class="p">=</span> <span class="n">ea</span><span class="p">.</span><span class="n">Body</span><span class="p">;</span>
                    <span class="kt">string</span> <span class="n">message</span> <span class="p">=</span> <span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">.</span><span class="nf">GetString</span><span class="p">(</span><span class="n">body</span><span class="p">);</span>

                    <span class="c1">// 末尾に daze を付ける。</span>
                    <span class="n">message</span> <span class="p">+=</span> <span class="s">"daze"</span><span class="p">;</span>

                    <span class="c1">// 回転式バッファーに入れる</span>
                    <span class="n">rollingBuffer</span><span class="p">.</span><span class="nf">PutMessage</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
                <span class="p">});</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="n">m_eventHandler_</span><span class="p">;</span>
        <span class="p">}</span>

<span class="cp">#if UBUNTU
</span>        <span class="k">static</span> <span class="n">BasicDeliverEventHandler</span> <span class="n">m_eventHandler_</span><span class="p">;</span>
<span class="cp">#else
</span>        <span class="k">static</span> <span class="n">EventHandler</span><span class="p">&lt;</span><span class="n">BasicDeliverEventArgs</span><span class="p">&gt;</span> <span class="n">m_eventHandler_</span><span class="p">;</span>
<span class="cp">#endif
</span>
        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// 対応するオープンは無いけれど、開けたら閉める、を完璧に対応する必要がある。</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="k">static</span> <span class="k">void</span> <span class="nf">CloseChannel</span><span class="p">(</span><span class="kt">int</span> <span class="n">index</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">null</span> <span class="p">!=</span> <span class="n">m_channels_</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
            <span class="p">{</span>
                <span class="n">m_channels_</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="nf">Close</span><span class="p">();</span>
                <span class="n">m_channels_</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// 常時監視をスタート</span>
            <span class="nf">StartDequeue</span><span class="p">();</span>

            <span class="c1">// 無限ループ</span>
            <span class="k">while</span> <span class="p">(</span><span class="nf">IsConnected</span><span class="p">())</span>
            <span class="p">{</span>
                <span class="kt">string</span> <span class="n">message</span> <span class="p">=</span> <span class="n">rollingBuffer</span><span class="p">.</span><span class="nf">GetMessage</span><span class="p">();</span>
                <span class="k">if</span> <span class="p">(</span><span class="k">null</span> <span class="p">!=</span> <span class="n">message</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="c1">// エンキューする</span>
                    <span class="nf">Enqueue</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="n">Thread</span><span class="p">.</span><span class="nf">Sleep</span><span class="p">(</span><span class="m">20</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="c1">// このプログラムは、自分では接続を切らない。</span>
        <span class="p">}</span>

        <span class="k">static</span> <span class="k">void</span> <span class="nf">Enqueue</span><span class="p">(</span><span class="kt">string</span> <span class="n">message</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">IModel</span> <span class="n">channel</span> <span class="p">=</span> <span class="nf">GetChannel</span><span class="p">(</span><span class="n">ENQUEUE_INDEX</span><span class="p">);</span>

            <span class="kt">byte</span><span class="p">[]</span> <span class="n">body</span> <span class="p">=</span> <span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
            <span class="n">channel</span><span class="p">.</span><span class="nf">BasicPublish</span><span class="p">(</span><span class="s">""</span><span class="p">,</span> <span class="n">QUEUE_NAMES</span><span class="p">[</span><span class="n">ENQUEUE_INDEX</span><span class="p">],</span> <span class="k">null</span><span class="p">,</span> <span class="n">body</span><span class="p">);</span>

            <span class="c1">// 対応するオープンは無いが、ちゃんと閉じないと、レシーブしてくれない。</span>
            <span class="nf">CloseChannel</span><span class="p">(</span><span class="n">ENQUEUE_INDEX</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">static</span> <span class="k">void</span> <span class="nf">StartDequeue</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">IModel</span> <span class="n">channel</span> <span class="p">=</span> <span class="nf">GetChannel</span><span class="p">(</span><span class="n">DEQUEUE_INDEX</span><span class="p">);</span>
            <span class="n">EventingBasicConsumer</span> <span class="n">consumer</span> <span class="p">=</span> <span class="nf">GetConsumer</span><span class="p">(</span><span class="n">DEQUEUE_INDEX</span><span class="p">);</span>
            <span class="c1">// 受信できたときに割り込んでくる処理</span>
            <span class="n">consumer</span><span class="p">.</span><span class="n">Received</span> <span class="p">+=</span> <span class="nf">GetReceiveHandler</span><span class="p">();</span>

<span class="cp">#if UBUNTU
</span>            <span class="c1">// Ubuntuでは何故か引数が 5 個のやつになっている。</span>
            <span class="n">channel</span><span class="p">.</span><span class="nf">BasicConsume</span><span class="p">(</span> <span class="n">QUEUE_NAMES</span><span class="p">[</span><span class="n">DEQUEUE_INDEX</span><span class="p">],</span> <span class="k">true</span><span class="p">,</span> <span class="s">""</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="n">consumer</span><span class="p">);</span>
<span class="cp">#else
</span>            <span class="n">channel</span><span class="p">.</span><span class="nf">BasicConsume</span><span class="p">(</span> <span class="n">QUEUE_NAMES</span><span class="p">[</span><span class="n">DEQUEUE_INDEX</span><span class="p">],</span> <span class="k">true</span><span class="p">,</span> <span class="n">consumer</span><span class="p">);</span>
<span class="cp">#endif
</span>
            <span class="c1">// 割込み処理の削除</span>
            <span class="c1">// consumer.Received -= GetReceiveHandler();</span>

            <span class="c1">// 対応するオープンは無いが、ちゃんと閉じないと、レシーブしてくれない。</span>
            <span class="c1">// CloseChannel(DEQUEUE_INDEX);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">/// 回転式バッファー。</span>
    <span class="c1">/// これはメイン・スレッドに置く。</span>
    <span class="c1">/// デキューのスレッドでエンキューすることはできない。</span>
    <span class="c1">/// デキュー処理は、回転式バッファーを仲介にしてエンキュー処理にメッセージを渡す。</span>
    <span class="c1">/// &lt;/summary&gt;</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">RotationBuffer</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">bufferSize</span> <span class="p">=</span> <span class="m">100</span><span class="p">;</span>
        <span class="k">public</span> <span class="kt">string</span><span class="p">[]</span> <span class="n">buffer</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">string</span><span class="p">[</span><span class="n">bufferSize</span><span class="p">];</span>
        <span class="k">public</span> <span class="kt">int</span><span class="p">[]</span> <span class="n">bufferCursors</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">int</span><span class="p">[]</span> <span class="p">{</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span> <span class="p">};</span>
        <span class="k">public</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">PUT_INDEX</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
        <span class="k">public</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">GET_INDEX</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">PutMessage</span><span class="p">(</span><span class="kt">string</span> <span class="n">message</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">buffer</span><span class="p">[</span><span class="n">bufferCursors</span><span class="p">[</span><span class="n">PUT_INDEX</span><span class="p">]]</span> <span class="p">=</span> <span class="n">message</span><span class="p">;</span>
            <span class="n">bufferCursors</span><span class="p">[</span><span class="n">PUT_INDEX</span><span class="p">]++;</span>
            <span class="k">if</span> <span class="p">(!(</span><span class="n">bufferCursors</span><span class="p">[</span><span class="n">PUT_INDEX</span><span class="p">]</span> <span class="p">&lt;</span> <span class="n">bufferSize</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="n">bufferCursors</span><span class="p">[</span><span class="n">PUT_INDEX</span><span class="p">]</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="nf">GetMessage</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">null</span> <span class="p">!=</span> <span class="n">buffer</span><span class="p">[</span><span class="n">bufferCursors</span><span class="p">[</span><span class="n">GET_INDEX</span><span class="p">]])</span>
            <span class="p">{</span>
                <span class="kt">string</span> <span class="n">message</span> <span class="p">=</span> <span class="n">buffer</span><span class="p">[</span><span class="n">bufferCursors</span><span class="p">[</span><span class="n">GET_INDEX</span><span class="p">]];</span>
                <span class="n">buffer</span><span class="p">[</span><span class="n">bufferCursors</span><span class="p">[</span><span class="n">GET_INDEX</span><span class="p">]]</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
                <span class="n">bufferCursors</span><span class="p">[</span><span class="n">GET_INDEX</span><span class="p">]++;</span>
                <span class="k">if</span> <span class="p">(!(</span><span class="n">bufferCursors</span><span class="p">[</span><span class="n">GET_INDEX</span><span class="p">]</span> <span class="p">&lt;</span> <span class="n">bufferSize</span><span class="p">))</span>
                <span class="p">{</span>
                    <span class="n">bufferCursors</span><span class="p">[</span><span class="n">GET_INDEX</span><span class="p">]</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">return</span> <span class="n">message</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2>
<span id="番号を合わせて-tamesi35a2_cscs-に変えてみる" class="fragment"></span><a href="#%E7%95%AA%E5%8F%B7%E3%82%92%E5%90%88%E3%82%8F%E3%81%9B%E3%81%A6-tamesi35a2_cscs-%E3%81%AB%E5%A4%89%E3%81%88%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>番号を合わせて tamesi35a2_cs.cs に変えてみる</h2>

<p>キュー名も選べるように改造しよう。 tamesi34_cs.cs ではそういう機能を入れていた。</p>

<p>tamesi34_cs.cs</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre><code><span class="c1">// OS  : Windows 10</span>
<span class="c1">// IDE : Visual Studio 2015</span>
<span class="c1">//       Install : NuGet   : Install-Package RabbitMQ.Client -Version 4.1.1</span>
<span class="c1">//</span>
<span class="c1">// OS  : Ubuntu 16.04</span>
<span class="c1">//       Compile : Command : mcs /r:RabbitMQ.Client.dll -define:UBUNTU tamesi34_cs.cs</span>
<span class="c1">//               : Command : // chmod 755 tamesi34_cs.cs</span>
<span class="c1">//       Execute : Command : // フォアグラウンドで実行する</span>
<span class="c1">//                         : ./tamesi34_cs.exe 2&gt; ./tamesi34_cs.err.log</span>
<span class="c1">//       Check   : Command : // キューの中身の数を調べる</span>
<span class="c1">//                         : rabbitmqctl list_queues</span>
<span class="c1">//</span>
<span class="c1">// Library : RabbitMQ</span>
<span class="c1">//           Refference : Website : RabbitMQ http://www.rabbitmq.com/</span>
<span class="c1">//                      : Website : RabbitMQ管理コマンド（rabbitmqctl）使い方 (Qiita) http://qiita.com/tamikura@github/items/5293cda4c0026b2d7022</span>
<span class="c1">//                      : Website : amqpを使ってRabbitMQのキューを操作する (Qiita) http://qiita.com/tamikura@github/items/a268afa51c5537ca4fe6</span>
<span class="c1">//--------------------------------------------------------------------------------</span>
<span class="c1">// tamesi34_cs.cs</span>

<span class="c1">// Ubuntu の RabbitMQ はソースのバージョンが古いのか、API が異なった。</span>
<span class="c1">// #define UBUNTU</span>

<span class="k">using</span> <span class="nn">RabbitMQ.Client</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">RabbitMQ.Client.Events</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Text</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">UsagiMQ</span>
<span class="p">{</span>
    <span class="p">[</span><span class="n">Flags</span><span class="p">]</span>
    <span class="k">enum</span> <span class="n">LifeSpanType</span>
    <span class="p">{</span>
        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// RabbitMQが止まってもキューを残す</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="n">Durable</span> <span class="p">=</span> <span class="m">1</span><span class="p">,</span>
        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// コンシューマーが１人も接続していなかったら消す</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="n">Autodelete</span> <span class="p">=</span> <span class="m">0x1</span><span class="p">&lt;&lt;</span><span class="m">1</span><span class="p">,</span>
        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// キューが存在するかどうかチェックするだけ。中身見ない時これ</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="n">Passive</span> <span class="p">=</span> <span class="m">0x1</span> <span class="p">&lt;&lt;</span> <span class="m">2</span><span class="p">,</span>
        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// この接続でだけ使える。この接続が切れたら消す</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="n">Exclusive</span> <span class="p">=</span> <span class="m">0x1</span> <span class="p">&lt;&lt;</span> <span class="m">3</span>
    <span class="p">}</span>

    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">/// メッセージを　エンキューします。</span>
    <span class="c1">/// キューの名前は指定してください。</span>
    <span class="c1">/// デキューは割込みを受け付けます。</span>
    <span class="c1">/// </span>
    <span class="c1">/// 参照 : QueueDeclare (v1.0) http://docs.spring.io/spring-amqp-net/docs/1.0.x/api/html/Spring.Messaging.Amqp.Rabbit~Spring.Messaging.Amqp.Rabbit.Connection.CachedModel~QueueDeclare(String,Boolean,Boolean,Boolean,Boolean,Boolean,IDictionary).html</span>
    <span class="c1">/// 参照 : EventingBasicConsumer https://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v1.4.0/rabbitmq-dotnet-client-1.4.0-net-2.0-htmldoc/type-RabbitMQ.Client.Events.EventingBasicConsumer.html</span>
    <span class="c1">/// 参照 : QueueDelete (v1.4) https://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v1.4.0/rabbitmq-dotnet-client-1.4.0-net-2.0-htmldoc/type-RabbitMQ.Client.IModel.html#method-M:RabbitMQ.Client.IModel.QueueDelete(System.UInt16,System.String,System.Boolean,System.Boolean,System.Boolean)</span>
    <span class="c1">/// 参照 : BasicConsume https://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v1.4.0/rabbitmq-dotnet-client-1.4.0-net-2.0-htmldoc/type-RabbitMQ.Client.IModel.html#method-M:RabbitMQ.Client.IModel.BasicConsume(System.UInt16,System.String,System.Boolean,System.Collections.IDictionary,RabbitMQ.Client.IBasicConsumer)</span>
    <span class="c1">/// 参照 : C#でconstな配列を実現する (もっとクールにプログラミング) http://pgnote.net/?p=885</span>
    <span class="c1">/// &lt;/summary&gt;</span>
    <span class="k">class</span> <span class="nc">Program</span>
    <span class="p">{</span>
        <span class="k">const</span> <span class="kt">int</span> <span class="n">ENQUEUE_INDEX</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
        <span class="k">const</span> <span class="kt">int</span> <span class="n">DEQUEUE_INDEX</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span>
        <span class="k">const</span> <span class="kt">int</span> <span class="n">DELETEQUEUE_INDEX</span> <span class="p">=</span> <span class="m">2</span><span class="p">;</span>
        <span class="k">const</span> <span class="kt">int</span> <span class="n">NUM_INDEX</span> <span class="p">=</span> <span class="m">3</span><span class="p">;</span>
        <span class="k">const</span> <span class="kt">string</span> <span class="n">HOST_NAME</span> <span class="p">=</span> <span class="s">"localhost"</span><span class="p">;</span>
        <span class="k">static</span> <span class="kt">string</span><span class="p">[]</span> <span class="n">QUEUE_NAMES</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">string</span><span class="p">[</span><span class="n">NUM_INDEX</span><span class="p">];</span>
        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// キューの寿命（複合可能）</span>
        <span class="c1">/// durable    : RabbitMQが止まってもキューを残す</span>
        <span class="c1">/// autodelete : コンシューマーが１人も接続していなかったら消す</span>
        <span class="c1">/// passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ</span>
        <span class="c1">/// exclusive  : この接続でだけ使える。この接続が切れたら消す</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="k">static</span> <span class="n">LifeSpanType</span><span class="p">[]</span> <span class="n">lifeSpans_queue</span> <span class="p">=</span> <span class="k">new</span> <span class="n">LifeSpanType</span><span class="p">[</span><span class="n">NUM_INDEX</span><span class="p">];</span>
        <span class="k">static</span> <span class="kt">bool</span><span class="p">[]</span>
            <span class="n">durable_lifeSpans</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">bool</span><span class="p">[</span><span class="n">NUM_INDEX</span><span class="p">],</span>
            <span class="n">autodelete_lifeSpans</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">bool</span><span class="p">[</span><span class="n">NUM_INDEX</span><span class="p">],</span>
            <span class="n">passive_lifeSpans</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">bool</span><span class="p">[</span><span class="n">NUM_INDEX</span><span class="p">],</span>
            <span class="n">exclusive_lifeSpans</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">bool</span><span class="p">[</span><span class="n">NUM_INDEX</span><span class="p">];</span>
        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// </span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="c1">/// &lt;param name="index_queue"&gt;&lt;/param&gt;</span>
        <span class="c1">/// &lt;param name="name_queue"&gt;&lt;/param&gt;</span>
        <span class="c1">/// &lt;param name="lifeSpan"&gt;</span>
        <span class="c1">/// (0) durable</span>
        <span class="c1">/// (1) autodelete</span>
        <span class="c1">/// (2) passive</span>
        <span class="c1">/// (3) exclusive</span>
        <span class="c1">/// &lt;/param&gt;</span>
        <span class="k">static</span> <span class="k">void</span> <span class="nf">SetLifeSpan</span><span class="p">(</span><span class="kt">int</span> <span class="n">index_queue</span><span class="p">,</span> <span class="kt">string</span> <span class="n">name_queue</span><span class="p">,</span> <span class="n">LifeSpanType</span> <span class="n">lifeSpan</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">QUEUE_NAMES</span><span class="p">[</span><span class="n">index_queue</span><span class="p">]</span> <span class="p">=</span> <span class="n">name_queue</span><span class="p">;</span>
            <span class="n">lifeSpans_queue</span><span class="p">[</span><span class="n">index_queue</span><span class="p">]</span> <span class="p">=</span> <span class="n">lifeSpan</span><span class="p">;</span>

            <span class="c1">// 一旦クリアー</span>
            <span class="n">durable_lifeSpans</span><span class="p">[</span><span class="n">index_queue</span><span class="p">]</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
            <span class="n">autodelete_lifeSpans</span><span class="p">[</span><span class="n">index_queue</span><span class="p">]</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
            <span class="n">passive_lifeSpans</span><span class="p">[</span><span class="n">index_queue</span><span class="p">]</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
            <span class="n">exclusive_lifeSpans</span><span class="p">[</span><span class="n">index_queue</span><span class="p">]</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>

            <span class="c1">// durable</span>
            <span class="k">if</span> <span class="p">(((</span><span class="kt">int</span><span class="p">)</span><span class="n">lifeSpan</span> <span class="p">&amp;</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">LifeSpanType</span><span class="p">.</span><span class="n">Durable</span><span class="p">)</span> <span class="p">==</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">LifeSpanType</span><span class="p">.</span><span class="n">Durable</span><span class="p">)</span> <span class="p">{</span> <span class="n">durable_lifeSpans</span><span class="p">[</span><span class="n">index_queue</span><span class="p">]</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span> <span class="p">}</span>
            <span class="c1">// autodelete</span>
            <span class="k">if</span> <span class="p">(((</span><span class="kt">int</span><span class="p">)</span><span class="n">lifeSpan</span> <span class="p">&amp;</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">LifeSpanType</span><span class="p">.</span><span class="n">Autodelete</span><span class="p">)</span> <span class="p">==</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">LifeSpanType</span><span class="p">.</span><span class="n">Autodelete</span><span class="p">)</span> <span class="p">{</span> <span class="n">autodelete_lifeSpans</span><span class="p">[</span><span class="n">index_queue</span><span class="p">]</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span> <span class="p">}</span>
            <span class="c1">// passive</span>
            <span class="k">if</span> <span class="p">(((</span><span class="kt">int</span><span class="p">)</span><span class="n">lifeSpan</span> <span class="p">&amp;</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">LifeSpanType</span><span class="p">.</span><span class="n">Passive</span><span class="p">)</span> <span class="p">==</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">LifeSpanType</span><span class="p">.</span><span class="n">Passive</span><span class="p">)</span> <span class="p">{</span> <span class="n">passive_lifeSpans</span><span class="p">[</span><span class="n">index_queue</span><span class="p">]</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span> <span class="p">}</span>
            <span class="c1">// exclusive</span>
            <span class="k">if</span> <span class="p">(((</span><span class="kt">int</span><span class="p">)</span><span class="n">lifeSpan</span> <span class="p">&amp;</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">LifeSpanType</span><span class="p">.</span><span class="n">Exclusive</span><span class="p">)</span> <span class="p">==</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">LifeSpanType</span><span class="p">.</span><span class="n">Exclusive</span><span class="p">)</span> <span class="p">{</span> <span class="n">exclusive_lifeSpans</span><span class="p">[</span><span class="n">index_queue</span><span class="p">]</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span> <span class="p">}</span>
        <span class="p">}</span>


        <span class="k">public</span> <span class="k">static</span> <span class="n">ConnectionFactory</span> <span class="nf">GetFactory</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">null</span> <span class="p">==</span> <span class="n">m_factory_</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">m_factory_</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ConnectionFactory</span><span class="p">()</span> <span class="p">{</span> <span class="n">HostName</span> <span class="p">=</span> <span class="n">HOST_NAME</span> <span class="p">};</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">m_factory_</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">static</span> <span class="n">ConnectionFactory</span> <span class="n">m_factory_</span><span class="p">;</span>

        <span class="k">public</span> <span class="k">static</span> <span class="n">IConnection</span> <span class="nf">GetConnection</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">null</span> <span class="p">==</span> <span class="n">m_connection_</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">m_connection_</span> <span class="p">=</span> <span class="nf">GetFactory</span><span class="p">().</span><span class="nf">CreateConnection</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">m_connection_</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">static</span> <span class="n">IConnection</span> <span class="n">m_connection_</span><span class="p">;</span>

        <span class="k">public</span> <span class="k">static</span> <span class="n">IModel</span> <span class="nf">GetChannel</span><span class="p">(</span><span class="kt">int</span> <span class="n">index</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">null</span> <span class="p">==</span> <span class="n">m_channels_</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
            <span class="p">{</span>
                <span class="n">m_channels_</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">=</span> <span class="nf">GetConnection</span><span class="p">().</span><span class="nf">CreateModel</span><span class="p">();</span>

                <span class="c1">// 引数が7つの QueueDeclare でエラーを吐くことがあるので、情報を出力しておく。</span>
                <span class="n">Console</span><span class="p">.</span><span class="n">Error</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"GetChannel index = ["</span> <span class="p">+</span> <span class="n">index</span> <span class="p">+</span> <span class="s">"]"</span><span class="p">);</span>
                <span class="n">Console</span><span class="p">.</span><span class="n">Error</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"    QUEUE_NAMES[index] = ["</span> <span class="p">+</span> <span class="n">QUEUE_NAMES</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">+</span> <span class="s">"]"</span><span class="p">);</span>
                <span class="n">Console</span><span class="p">.</span><span class="n">Error</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"    passive_lifeSpans[index] = ["</span> <span class="p">+</span> <span class="n">passive_lifeSpans</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">+</span> <span class="s">"]"</span><span class="p">);</span>
                <span class="n">Console</span><span class="p">.</span><span class="n">Error</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"    durable_lifeSpans[index] = ["</span> <span class="p">+</span> <span class="n">durable_lifeSpans</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">+</span> <span class="s">"]"</span><span class="p">);</span>
                <span class="n">Console</span><span class="p">.</span><span class="n">Error</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"    exclusive_lifeSpans[index] = ["</span> <span class="p">+</span> <span class="n">exclusive_lifeSpans</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">+</span> <span class="s">"]"</span><span class="p">);</span>
                <span class="n">Console</span><span class="p">.</span><span class="n">Error</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"    autodelete_lifeSpans[index] = ["</span> <span class="p">+</span> <span class="n">autodelete_lifeSpans</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">+</span> <span class="s">"]"</span><span class="p">);</span>
                <span class="n">Console</span><span class="p">.</span><span class="n">Error</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"    nowait は仮に false 固定"</span><span class="p">);</span>
                <span class="n">Console</span><span class="p">.</span><span class="n">Error</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"    arguments は仮に null 固定"</span><span class="p">);</span>

<span class="cp">#if UBUNTU
</span>                <span class="c1">// Ubuntuでは何故か Spring.Messaging.Amqp.Rabbit の引数 7 つのやつになっている。</span>
                <span class="n">m_channels_</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="nf">QueueDeclare</span><span class="p">(</span><span class="n">QUEUE_NAMES</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">passive_lifeSpans</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">durable_lifeSpans</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">exclusive_lifeSpans</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">autodelete_lifeSpans</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="k">false</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span>
<span class="cp">#else
</span>                <span class="n">m_channels_</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="nf">QueueDeclare</span><span class="p">(</span><span class="n">QUEUE_NAMES</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">durable_lifeSpans</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">exclusive_lifeSpans</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">autodelete_lifeSpans</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="k">null</span><span class="p">);</span>
<span class="cp">#endif
</span>            <span class="p">}</span>
            <span class="k">return</span> <span class="n">m_channels_</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
        <span class="p">}</span>
        <span class="k">static</span> <span class="n">IModel</span><span class="p">[]</span> <span class="n">m_channels_</span> <span class="p">=</span> <span class="k">new</span> <span class="n">IModel</span><span class="p">[</span><span class="n">NUM_INDEX</span><span class="p">];</span>

        <span class="k">public</span> <span class="k">static</span> <span class="n">EventingBasicConsumer</span> <span class="nf">GetConsumer</span><span class="p">(</span><span class="kt">int</span> <span class="n">index</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">null</span> <span class="p">==</span> <span class="n">m_consumers_</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
            <span class="p">{</span>
<span class="cp">#if UBUNTU
</span>                <span class="c1">// Ubuntuでは何故か v1.4.0 の引数が 0 個のやつになっている。調べたが引数が1個～6個のものは無かった。</span>
                <span class="n">m_consumers_</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">EventingBasicConsumer</span><span class="p">();</span>
<span class="cp">#else
</span>                <span class="n">m_consumers_</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">EventingBasicConsumer</span><span class="p">(</span><span class="nf">GetChannel</span><span class="p">(</span><span class="n">index</span><span class="p">));</span>
<span class="cp">#endif
</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">m_consumers_</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
        <span class="p">}</span>
        <span class="k">static</span> <span class="n">EventingBasicConsumer</span><span class="p">[]</span> <span class="n">m_consumers_</span> <span class="p">=</span> <span class="k">new</span> <span class="n">EventingBasicConsumer</span><span class="p">[</span><span class="n">NUM_INDEX</span><span class="p">];</span>

        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// 受信できたときに割り込んでくる処理</span>
        <span class="c1">/// &lt;/summary&gt;</span>
<span class="cp">#if UBUNTU
</span>        <span class="k">public</span> <span class="k">static</span> <span class="n">BasicDeliverEventHandler</span> <span class="nf">GetDequeueHandler</span><span class="p">()</span>
<span class="cp">#else
</span>        <span class="k">public</span> <span class="k">static</span> <span class="n">EventHandler</span><span class="p">&lt;</span><span class="n">BasicDeliverEventArgs</span><span class="p">&gt;</span> <span class="nf">GetDequeueHandler</span><span class="p">()</span>
<span class="cp">#endif
</span>        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">null</span> <span class="p">==</span> <span class="n">m_dequeueHandler_</span><span class="p">)</span>
            <span class="p">{</span>
<span class="cp">#if UBUNTU
</span>                <span class="n">m_dequeueHandler_</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">BasicDeliverEventHandler</span><span class="p">((</span><span class="n">model</span><span class="p">,</span> <span class="n">ea</span><span class="p">)</span> <span class="p">=&gt;</span>
<span class="cp">#else
</span>                <span class="n">m_dequeueHandler_</span> <span class="p">=</span> <span class="k">new</span> <span class="n">EventHandler</span><span class="p">&lt;</span><span class="n">BasicDeliverEventArgs</span><span class="p">&gt;((</span><span class="n">model</span><span class="p">,</span> <span class="n">ea</span><span class="p">)</span> <span class="p">=&gt;</span>
<span class="cp">#endif
</span>                <span class="p">{</span>
                    <span class="kt">byte</span><span class="p">[]</span> <span class="n">body</span> <span class="p">=</span> <span class="n">ea</span><span class="p">.</span><span class="n">Body</span><span class="p">;</span>
                    <span class="kt">string</span> <span class="n">message</span> <span class="p">=</span> <span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">.</span><span class="nf">GetString</span><span class="p">(</span><span class="n">body</span><span class="p">);</span>
                    <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"&lt;---- [interrupt!] Dequeue(^q^) {0}"</span><span class="p">,</span> <span class="n">message</span><span class="p">);</span>
                <span class="p">});</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="n">m_dequeueHandler_</span><span class="p">;</span>
        <span class="p">}</span>

<span class="cp">#if UBUNTU
</span>        <span class="k">static</span> <span class="n">BasicDeliverEventHandler</span> <span class="n">m_dequeueHandler_</span><span class="p">;</span>
<span class="cp">#else
</span>        <span class="k">static</span> <span class="n">EventHandler</span><span class="p">&lt;</span><span class="n">BasicDeliverEventArgs</span><span class="p">&gt;</span> <span class="n">m_dequeueHandler_</span><span class="p">;</span>
<span class="cp">#endif
</span>
        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// 対応するオープンは無いけれど、開けたら閉める、を完璧に対応する必要がある。</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="k">static</span> <span class="k">void</span> <span class="nf">CloseConnection</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">null</span> <span class="p">!=</span> <span class="n">m_connection_</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">m_connection_</span><span class="p">.</span><span class="nf">Close</span><span class="p">();</span>
                <span class="n">m_connection_</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// 対応するオープンは無いけれど、開けたら閉める、を完璧に対応する必要がある。</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="k">static</span> <span class="k">void</span> <span class="nf">CloseChannel</span><span class="p">(</span><span class="kt">int</span> <span class="n">index</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">null</span> <span class="p">!=</span> <span class="n">m_channels_</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
            <span class="p">{</span>
                <span class="n">m_channels_</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="nf">Close</span><span class="p">();</span>
                <span class="n">m_channels_</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">//----------------------------------------</span>
            <span class="c1">// Delete</span>
            <span class="c1">//----------------------------------------</span>
            <span class="k">for</span> <span class="p">(;;)</span>
            <span class="p">{</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="s">@"削除したいキューがあれば名前を、無ければ空文字列を入れろだぜ☆（＾～＾）
キュー名を入力    : キューを削除します
空文字列で[Enter] : 次のステップへ進む
Name or empty ? &gt; "</span><span class="p">);</span>
                <span class="kt">string</span> <span class="n">queueName_delete</span> <span class="p">=</span> <span class="n">Console</span><span class="p">.</span><span class="nf">ReadLine</span><span class="p">();</span>
                <span class="k">if</span> <span class="p">(</span><span class="s">""</span><span class="p">==</span> <span class="n">queueName_delete</span><span class="p">.</span><span class="nf">Trim</span><span class="p">())</span>
                <span class="p">{</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="p">}</span>


                <span class="n">Console</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="s">@"削除するメッセージ・キューの寿命を、足し算して答えろだぜ☆（＾～＾）
("</span><span class="p">+</span> <span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">LifeSpanType</span><span class="p">.</span><span class="n">Durable</span><span class="p">)</span> <span class="p">+</span> <span class="s">@") durable    : RabbitMQが止まってもキューを残す
("</span> <span class="p">+</span> <span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">LifeSpanType</span><span class="p">.</span><span class="n">Autodelete</span><span class="p">)</span> <span class="p">+</span> <span class="s">@") autodelete : コンシューマーが１人も接続していなかったら消す
("</span> <span class="p">+</span> <span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">LifeSpanType</span><span class="p">.</span><span class="n">Passive</span><span class="p">)</span> <span class="p">+</span> <span class="s">@") passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ
("</span> <span class="p">+</span> <span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">LifeSpanType</span><span class="p">.</span><span class="n">Exclusive</span><span class="p">)</span> <span class="p">+</span> <span class="s">@") exclusive  : この接続でだけ使える。この接続が切れたら消す
Number ? &gt; "</span><span class="p">);</span>
                <span class="n">LifeSpanType</span> <span class="n">lifeSpan_delete</span> <span class="p">=</span> <span class="p">(</span><span class="n">LifeSpanType</span><span class="p">)</span><span class="kt">int</span><span class="p">.</span><span class="nf">Parse</span><span class="p">(</span><span class="n">Console</span><span class="p">.</span><span class="nf">ReadLine</span><span class="p">());</span>
                <span class="nf">SetLifeSpan</span><span class="p">(</span><span class="n">DELETEQUEUE_INDEX</span><span class="p">,</span> <span class="n">queueName_delete</span><span class="p">,</span> <span class="n">lifeSpan_delete</span><span class="p">);</span>
                <span class="kt">uint</span> <span class="n">result</span> <span class="p">=</span> <span class="nf">DeleteQueue</span><span class="p">();</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">@"["</span><span class="p">+</span> <span class="n">queueName_delete</span> <span class="p">+</span> <span class="s">"]キューを削除したはずだぜ☆（＾～＾） result=["</span><span class="p">+</span> <span class="n">result</span> <span class="p">+</span> <span class="s">"]"</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="c1">//----------------------------------------</span>
            <span class="c1">// Enqueue settings</span>
            <span class="c1">//----------------------------------------</span>
            <span class="k">for</span> <span class="p">(;;)</span>
            <span class="p">{</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="s">@"エンキュー先のメッセージ・キューの名前を入れろだぜ☆（＾～＾）
Queue name? &gt; "</span><span class="p">);</span>
                <span class="kt">string</span> <span class="n">queueName_enqueue</span> <span class="p">=</span> <span class="n">Console</span><span class="p">.</span><span class="nf">ReadLine</span><span class="p">();</span>

                <span class="n">Console</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="s">@"エンキュー先のメッセージ・キューの寿命を、足し算して答えろだぜ☆（＾～＾）
("</span> <span class="p">+</span> <span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">LifeSpanType</span><span class="p">.</span><span class="n">Durable</span><span class="p">)</span> <span class="p">+</span> <span class="s">@") durable    : RabbitMQが止まってもキューを残す
("</span> <span class="p">+</span> <span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">LifeSpanType</span><span class="p">.</span><span class="n">Autodelete</span><span class="p">)</span> <span class="p">+</span> <span class="s">@") autodelete : コンシューマーが１人も接続していなかったら消す
("</span> <span class="p">+</span> <span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">LifeSpanType</span><span class="p">.</span><span class="n">Passive</span><span class="p">)</span> <span class="p">+</span> <span class="s">@") passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ
("</span> <span class="p">+</span> <span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">LifeSpanType</span><span class="p">.</span><span class="n">Exclusive</span><span class="p">)</span> <span class="p">+</span> <span class="s">@") exclusive  : この接続でだけ使える。この接続が切れたら消す
Number ? &gt; "</span><span class="p">);</span>
                <span class="kt">int</span> <span class="n">lifeSpan_enqueue</span><span class="p">;</span>
                <span class="k">if</span><span class="p">(</span><span class="kt">int</span><span class="p">.</span><span class="nf">TryParse</span><span class="p">(</span><span class="n">Console</span><span class="p">.</span><span class="nf">ReadLine</span><span class="p">(),</span><span class="k">out</span> <span class="n">lifeSpan_enqueue</span><span class="p">))</span>
                <span class="p">{</span>
                    <span class="nf">SetLifeSpan</span><span class="p">(</span><span class="n">ENQUEUE_INDEX</span><span class="p">,</span> <span class="n">queueName_enqueue</span><span class="p">,</span> <span class="p">(</span><span class="n">LifeSpanType</span><span class="p">)</span><span class="n">lifeSpan_enqueue</span><span class="p">);</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="c1">//----------------------------------------</span>
            <span class="c1">// Enqueue settings</span>
            <span class="c1">//----------------------------------------</span>
            <span class="k">for</span> <span class="p">(;;)</span>
            <span class="p">{</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="s">@"デキュー先のメッセージ・キューの名前を入れろだぜ☆（＾～＾）
Queue name? &gt; "</span><span class="p">);</span>
                <span class="kt">string</span> <span class="n">queueName_dequeue</span> <span class="p">=</span> <span class="n">Console</span><span class="p">.</span><span class="nf">ReadLine</span><span class="p">();</span>

                <span class="n">Console</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="s">@"デキュー先のメッセージ・キューの寿命を、足し算して答えろだぜ☆（＾～＾）
("</span> <span class="p">+</span> <span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">LifeSpanType</span><span class="p">.</span><span class="n">Durable</span><span class="p">)</span> <span class="p">+</span> <span class="s">@") durable    : RabbitMQが止まってもキューを残す
("</span> <span class="p">+</span> <span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">LifeSpanType</span><span class="p">.</span><span class="n">Autodelete</span><span class="p">)</span> <span class="p">+</span> <span class="s">@") autodelete : コンシューマーが１人も接続していなかったら消す
("</span> <span class="p">+</span> <span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">LifeSpanType</span><span class="p">.</span><span class="n">Passive</span><span class="p">)</span> <span class="p">+</span> <span class="s">@") passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ
("</span> <span class="p">+</span> <span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">LifeSpanType</span><span class="p">.</span><span class="n">Exclusive</span><span class="p">)</span> <span class="p">+</span> <span class="s">@") exclusive  : この接続でだけ使える。この接続が切れたら消す
Number ? &gt; "</span><span class="p">);</span>
                <span class="kt">int</span> <span class="n">lifeSpan_dequeue</span><span class="p">;</span>
                <span class="k">if</span><span class="p">(</span><span class="kt">int</span><span class="p">.</span><span class="nf">TryParse</span><span class="p">(</span><span class="n">Console</span><span class="p">.</span><span class="nf">ReadLine</span><span class="p">(),</span><span class="k">out</span> <span class="n">lifeSpan_dequeue</span><span class="p">))</span>
                <span class="p">{</span>
                    <span class="nf">StartConsume</span><span class="p">(</span><span class="n">queueName_dequeue</span><span class="p">,</span> <span class="p">(</span><span class="n">LifeSpanType</span><span class="p">)</span><span class="n">lifeSpan_dequeue</span><span class="p">);</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="n">Console</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="s">@"終了するときは[Ctrl]+[C]キーを押せだぜ☆（＾～＾）
エンキューするときはメッセージを打ち込んで[Enter]キーを押せだぜ☆(＾◇＾)
Enqueue? &gt; "</span><span class="p">);</span>
            <span class="k">for</span> <span class="p">(;;)</span>
            <span class="p">{</span>
                <span class="c1">// "Hello World!" などを入力</span>
                <span class="kt">string</span> <span class="n">line</span> <span class="p">=</span> <span class="n">Console</span><span class="p">.</span><span class="nf">ReadLine</span><span class="p">();</span>
                <span class="nf">Enqueue</span><span class="p">(</span><span class="n">line</span><span class="p">);</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="s">@"Enqueue? &gt; "</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="c1">// ここには来ない</span>
            <span class="c1">// CloseConnection();</span>
        <span class="p">}</span>

        <span class="k">static</span> <span class="kt">uint</span> <span class="nf">DeleteQueue</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">IModel</span> <span class="n">channel</span> <span class="p">=</span> <span class="nf">GetChannel</span><span class="p">(</span><span class="n">DELETEQUEUE_INDEX</span><span class="p">);</span>

<span class="cp">#if UBUNTU
</span>            <span class="c1">// Ubuntuでは何故か 昔の .Net 用の引数 5 つのやつの変則版になっている。</span>
            <span class="c1">// uint QueueDelete(ushort ticket, string queue, bool ifUnused, bool ifEmpty, bool nowait)</span>
            <span class="kt">uint</span> <span class="n">result</span> <span class="p">=</span> <span class="n">channel</span><span class="p">.</span><span class="nf">QueueDelete</span><span class="p">(</span> <span class="n">QUEUE_NAMES</span><span class="p">[</span><span class="n">DELETEQUEUE_INDEX</span><span class="p">],</span><span class="k">true</span><span class="p">,</span><span class="k">true</span><span class="p">,</span><span class="k">true</span><span class="p">);</span>
<span class="cp">#else
</span>            <span class="kt">uint</span> <span class="n">result</span> <span class="p">=</span> <span class="n">channel</span><span class="p">.</span><span class="nf">QueueDelete</span><span class="p">(</span><span class="n">QUEUE_NAMES</span><span class="p">[</span><span class="n">DELETEQUEUE_INDEX</span><span class="p">],</span><span class="k">true</span><span class="p">,</span><span class="k">true</span><span class="p">);</span>
<span class="cp">#endif
</span>
            <span class="c1">// 対応するオープンは無いが、ちゃんと閉じないと、レシーブしてくれない。</span>
            <span class="nf">CloseChannel</span><span class="p">(</span><span class="n">DELETEQUEUE_INDEX</span><span class="p">);</span>
            <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">static</span> <span class="k">void</span> <span class="nf">Enqueue</span><span class="p">(</span><span class="kt">string</span> <span class="n">message</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">IModel</span> <span class="n">channel</span> <span class="p">=</span> <span class="nf">GetChannel</span><span class="p">(</span><span class="n">ENQUEUE_INDEX</span><span class="p">);</span>

            <span class="kt">byte</span><span class="p">[]</span> <span class="n">body</span> <span class="p">=</span> <span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
            <span class="n">channel</span><span class="p">.</span><span class="nf">BasicPublish</span><span class="p">(</span><span class="s">""</span><span class="p">,</span> <span class="n">QUEUE_NAMES</span><span class="p">[</span><span class="n">ENQUEUE_INDEX</span><span class="p">],</span> <span class="k">null</span><span class="p">,</span> <span class="n">body</span><span class="p">);</span>

            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">" Enqueue(^q^) {0}"</span><span class="p">,</span> <span class="n">message</span><span class="p">);</span>

            <span class="c1">// 対応するオープンは無いが、ちゃんと閉じないと、レシーブしてくれない。</span>
            <span class="nf">CloseChannel</span><span class="p">(</span><span class="n">ENQUEUE_INDEX</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// </span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="c1">/// &lt;param name="name_queue"&gt;メッセージ・キューの名前&lt;/param&gt;</span>
        <span class="c1">/// &lt;param name="lifeSpan_queue"&gt;既存のメッセージ・キューの場合、メッセージ・キューの設定は合わせる必要がある。</span>
        <span class="c1">/// durable    : RabbitMQが止まってもキューを残す</span>
        <span class="c1">/// autodelete : コンシューマーが１人も接続していなかったら消す</span>
        <span class="c1">/// passive    : キューが存在するかどうかチェックするだけで、中身を見ない時はこれ</span>
        <span class="c1">/// exclusive  : この接続でだけ使える。この接続が切れたら消す</span>
        <span class="c1">/// &lt;/param&gt;</span>
        <span class="k">static</span> <span class="k">void</span> <span class="nf">StartConsume</span><span class="p">(</span><span class="kt">string</span> <span class="n">name_queue</span><span class="p">,</span> <span class="n">LifeSpanType</span> <span class="n">lifeSpan_queue</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nf">SetLifeSpan</span><span class="p">(</span><span class="n">DEQUEUE_INDEX</span><span class="p">,</span> <span class="n">name_queue</span><span class="p">,</span> <span class="n">lifeSpan_queue</span><span class="p">);</span>

            <span class="n">IModel</span> <span class="n">channel</span> <span class="p">=</span> <span class="nf">GetChannel</span><span class="p">(</span><span class="n">DEQUEUE_INDEX</span><span class="p">);</span>
            <span class="n">EventingBasicConsumer</span> <span class="n">consumer</span> <span class="p">=</span> <span class="nf">GetConsumer</span><span class="p">(</span><span class="n">DEQUEUE_INDEX</span><span class="p">);</span>

            <span class="c1">// 受信できたときに割り込んでくる処理</span>
            <span class="n">consumer</span><span class="p">.</span><span class="n">Received</span> <span class="p">+=</span> <span class="nf">GetDequeueHandler</span><span class="p">();</span>

<span class="cp">#if UBUNTU
</span>            <span class="c1">// Ubuntuでは何故か引数が 5 個のやつになっている。</span>
            <span class="n">channel</span><span class="p">.</span><span class="nf">BasicConsume</span><span class="p">(</span> <span class="n">QUEUE_NAMES</span><span class="p">[</span><span class="n">DEQUEUE_INDEX</span><span class="p">],</span> <span class="k">true</span><span class="p">,</span> <span class="s">""</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="n">consumer</span><span class="p">);</span>
<span class="cp">#else
</span>            <span class="n">channel</span><span class="p">.</span><span class="nf">BasicConsume</span><span class="p">(</span> <span class="n">QUEUE_NAMES</span><span class="p">[</span><span class="n">DEQUEUE_INDEX</span><span class="p">],</span> <span class="k">true</span><span class="p">,</span> <span class="n">consumer</span><span class="p">);</span>
<span class="cp">#endif
</span>            <span class="c1">// 終了はさせない</span>
            <span class="c1">// consumer.Received -= GetReceiveHandler();</span>
            <span class="c1">// CloseChannel(DEQUEUE_INDEX);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>QueryDeclare の引数は false の方が良かったんだろうか？</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>#if UBUNTU
            // Ubuntuでは何故か Spring.Messaging.Amqp.Rabbit の引数 7 つのやつになっている。
            // m_channels_[index].QueueDeclare(QUEUE_NAMES[index], false, false, false, false, false, null);
            m_channels_[index].QueueDeclare(QUEUE_NAMES[index], passive_lifeSpans[index], durable_lifeSpans[index], exclusive_lifeSpans[index], autodelete_lifeSpans[index], false, null);
#else
            //m_channels_[index].QueueDeclare(QUEUE_NAMES[index], false, false, false, null);
            m_channels_[index].QueueDeclare(QUEUE_NAMES[index], durable_lifeSpans[index], exclusive_lifeSpans[index], autodelete_lifeSpans[index], null);
#endif
</code></pre></div></div>

<p>こんなコードでいいんだろうか？</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre><code><span class="c1">//--------------------------------------------------------------------------------</span>
<span class="c1">// tamesi35a2_cs.cs</span>
<span class="c1">//</span>
<span class="c1">// メッセージの末尾に daze を付けます。</span>
<span class="c1">// 標準入出力は、キーボード、画面には接続しないようにします。</span>
<span class="c1">// キューの名前は指定してください。</span>
<span class="c1">// デキューは割込みを受け付けます。</span>
<span class="c1">//--------------------------------------------------------------------------------</span>
<span class="c1">// OS  : Windows 10</span>
<span class="c1">// IDE : Visual Studio 2015</span>
<span class="c1">//       Install : NuGet   : Install-Package RabbitMQ.Client -Version 4.1.1</span>
<span class="c1">//</span>
<span class="c1">// OS  : Ubuntu 16.04</span>
<span class="c1">//       Compile : Command : mcs /r:RabbitMQ.Client.dll -define:UBUNTU tamesi35a2_cs.cs</span>
<span class="c1">//               : Command : // chmod 755 tamesi35a2_cs.cs</span>
<span class="c1">//       Execute : Command : // バックグラウンドで実行する</span>
<span class="c1">//                         : nohup ./tamesi35a2_cs.exe &gt; ./tamesi35a2_cs.out.log 2&gt; ./tamesi35a2_cs.err.log &lt; /dev/null &amp;</span>
<span class="c1">//       Check   :         : // tamesi33a1_cs.exe を使う</span>
<span class="c1">//--------------------------------------------------------------------------------</span>

<span class="c1">// Ubuntu の RabbitMQ はソースのバージョンが古いのか、API が異なった。</span>
<span class="c1">// #define UBUNTU</span>

<span class="k">using</span> <span class="nn">RabbitMQ.Client</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">RabbitMQ.Client.Events</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Text</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Threading</span><span class="p">;</span>

<span class="c1">/// &lt;summary&gt;</span>
<span class="c1">/// このプログラム内だけで使われる数字。AMQP-CPPでの実装とは異なる。</span>
<span class="c1">/// AMQP-CPPでの実装 : AMQP::durable=[1] AMQP::autodelete=[2] AMQP::passive=[8] AMQP::exclusive=[512]</span>
<span class="c1">/// &lt;/summary&gt;</span>
<span class="p">[</span><span class="n">Flags</span><span class="p">]</span>
<span class="k">enum</span> <span class="n">LifeSpanType</span>
<span class="p">{</span>
    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">/// RabbitMQが止まってもキューを残す</span>
    <span class="c1">/// &lt;/summary&gt;</span>
    <span class="n">Durable</span> <span class="p">=</span> <span class="m">1</span><span class="p">,</span>
    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">/// コンシューマーが１人も接続していなかったら消す</span>
    <span class="c1">/// &lt;/summary&gt;</span>
    <span class="n">Autodelete</span> <span class="p">=</span> <span class="m">0x1</span> <span class="p">&lt;&lt;</span> <span class="m">1</span><span class="p">,</span>
    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">/// キューが存在するかどうかチェックするだけ。中身見ない時これ</span>
    <span class="c1">/// &lt;/summary&gt;</span>
    <span class="n">Passive</span> <span class="p">=</span> <span class="m">0x1</span> <span class="p">&lt;&lt;</span> <span class="m">2</span><span class="p">,</span>
    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">/// この接続でだけ使える。この接続が切れたら消す</span>
    <span class="c1">/// &lt;/summary&gt;</span>
    <span class="n">Exclusive</span> <span class="p">=</span> <span class="m">0x1</span> <span class="p">&lt;&lt;</span> <span class="m">3</span>
<span class="p">}</span>

<span class="c1">/// &lt;summary&gt;</span>
<span class="c1">/// 参照 : QueueDeclare http://docs.spring.io/spring-amqp-net/docs/1.0.x/api/html/Spring.Messaging.Amqp.Rabbit~Spring.Messaging.Amqp.Rabbit.Connection.CachedModel~QueueDeclare(String,Boolean,Boolean,Boolean,Boolean,Boolean,IDictionary).html</span>
<span class="c1">/// 参照 : EventingBasicConsumer https://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v1.4.0/rabbitmq-dotnet-client-1.4.0-net-2.0-htmldoc/type-RabbitMQ.Client.Events.EventingBasicConsumer.html</span>
<span class="c1">/// 参照 : BasicConsume https://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v1.4.0/rabbitmq-dotnet-client-1.4.0-net-2.0-htmldoc/type-RabbitMQ.Client.IModel.html#method-M:RabbitMQ.Client.IModel.BasicConsume(System.UInt16,System.String,System.Boolean,System.Collections.IDictionary,RabbitMQ.Client.IBasicConsumer)</span>
<span class="c1">/// 参照 : C#でconstな配列を実現する (もっとクールにプログラミング) http://pgnote.net/?p=885</span>
<span class="c1">/// &lt;/summary&gt;</span>
<span class="k">class</span> <span class="nc">Program</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">ENQUEUE_INDEX</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">DEQUEUE_INDEX</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">DELETEQUEUE_INDEX</span> <span class="p">=</span> <span class="m">2</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">NUM_INDEX</span> <span class="p">=</span> <span class="m">3</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">string</span> <span class="n">HOST_NAME</span> <span class="p">=</span> <span class="s">"localhost"</span><span class="p">;</span>
    <span class="k">static</span> <span class="kt">string</span><span class="p">[]</span> <span class="n">QUEUE_NAMES</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">string</span><span class="p">[</span><span class="n">NUM_INDEX</span><span class="p">];</span>
    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">/// キューの寿命（複合可能）</span>
    <span class="c1">/// durable    : RabbitMQが止まってもキューを残す</span>
    <span class="c1">/// autodelete : コンシューマーが１人も接続していなかったら消す</span>
    <span class="c1">/// passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ</span>
    <span class="c1">/// exclusive  : この接続でだけ使える。この接続が切れたら消す</span>
    <span class="c1">/// &lt;/summary&gt;</span>
    <span class="k">static</span> <span class="n">LifeSpanType</span><span class="p">[]</span> <span class="n">lifeSpans_queue</span> <span class="p">=</span> <span class="k">new</span> <span class="n">LifeSpanType</span><span class="p">[</span><span class="n">NUM_INDEX</span><span class="p">];</span>
    <span class="k">static</span> <span class="kt">bool</span><span class="p">[]</span>
        <span class="n">durable_lifeSpans</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">bool</span><span class="p">[</span><span class="n">NUM_INDEX</span><span class="p">],</span>
        <span class="n">autodelete_lifeSpans</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">bool</span><span class="p">[</span><span class="n">NUM_INDEX</span><span class="p">],</span>
        <span class="n">passive_lifeSpans</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">bool</span><span class="p">[</span><span class="n">NUM_INDEX</span><span class="p">],</span>
        <span class="n">exclusive_lifeSpans</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">bool</span><span class="p">[</span><span class="n">NUM_INDEX</span><span class="p">];</span>
    <span class="k">static</span> <span class="k">void</span> <span class="nf">SetLifeSpan</span><span class="p">(</span><span class="kt">int</span> <span class="n">index_queue</span><span class="p">,</span> <span class="kt">string</span> <span class="n">name_queue</span><span class="p">,</span> <span class="n">LifeSpanType</span> <span class="n">lifeSpan</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">QUEUE_NAMES</span><span class="p">[</span><span class="n">index_queue</span><span class="p">]</span> <span class="p">=</span> <span class="n">name_queue</span><span class="p">;</span>
        <span class="n">lifeSpans_queue</span><span class="p">[</span><span class="n">index_queue</span><span class="p">]</span> <span class="p">=</span> <span class="n">lifeSpan</span><span class="p">;</span>

        <span class="c1">// 一旦クリアー</span>
        <span class="n">durable_lifeSpans</span><span class="p">[</span><span class="n">index_queue</span><span class="p">]</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
        <span class="n">autodelete_lifeSpans</span><span class="p">[</span><span class="n">index_queue</span><span class="p">]</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
        <span class="n">passive_lifeSpans</span><span class="p">[</span><span class="n">index_queue</span><span class="p">]</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
        <span class="n">exclusive_lifeSpans</span><span class="p">[</span><span class="n">index_queue</span><span class="p">]</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>

        <span class="c1">// durable</span>
        <span class="k">if</span> <span class="p">(((</span><span class="kt">int</span><span class="p">)</span><span class="n">lifeSpan</span> <span class="p">&amp;</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">LifeSpanType</span><span class="p">.</span><span class="n">Durable</span><span class="p">)</span> <span class="p">==</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">LifeSpanType</span><span class="p">.</span><span class="n">Durable</span><span class="p">)</span> <span class="p">{</span> <span class="n">durable_lifeSpans</span><span class="p">[</span><span class="n">index_queue</span><span class="p">]</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span> <span class="p">}</span>
        <span class="c1">// autodelete</span>
        <span class="k">if</span> <span class="p">(((</span><span class="kt">int</span><span class="p">)</span><span class="n">lifeSpan</span> <span class="p">&amp;</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">LifeSpanType</span><span class="p">.</span><span class="n">Autodelete</span><span class="p">)</span> <span class="p">==</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">LifeSpanType</span><span class="p">.</span><span class="n">Autodelete</span><span class="p">)</span> <span class="p">{</span> <span class="n">autodelete_lifeSpans</span><span class="p">[</span><span class="n">index_queue</span><span class="p">]</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span> <span class="p">}</span>
        <span class="c1">// passive</span>
        <span class="k">if</span> <span class="p">(((</span><span class="kt">int</span><span class="p">)</span><span class="n">lifeSpan</span> <span class="p">&amp;</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">LifeSpanType</span><span class="p">.</span><span class="n">Passive</span><span class="p">)</span> <span class="p">==</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">LifeSpanType</span><span class="p">.</span><span class="n">Passive</span><span class="p">)</span> <span class="p">{</span> <span class="n">passive_lifeSpans</span><span class="p">[</span><span class="n">index_queue</span><span class="p">]</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span> <span class="p">}</span>
        <span class="c1">// exclusive</span>
        <span class="k">if</span> <span class="p">(((</span><span class="kt">int</span><span class="p">)</span><span class="n">lifeSpan</span> <span class="p">&amp;</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">LifeSpanType</span><span class="p">.</span><span class="n">Exclusive</span><span class="p">)</span> <span class="p">==</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">LifeSpanType</span><span class="p">.</span><span class="n">Exclusive</span><span class="p">)</span> <span class="p">{</span> <span class="n">exclusive_lifeSpans</span><span class="p">[</span><span class="n">index_queue</span><span class="p">]</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// 回転式バッファー</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">RotationBuffer</span> <span class="n">rollingBuffer</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RotationBuffer</span><span class="p">();</span>

    <span class="k">public</span> <span class="k">static</span> <span class="n">ConnectionFactory</span> <span class="nf">GetFactory</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">null</span> <span class="p">==</span> <span class="n">m_factory_</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">m_factory_</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ConnectionFactory</span><span class="p">()</span> <span class="p">{</span> <span class="n">HostName</span> <span class="p">=</span> <span class="n">HOST_NAME</span> <span class="p">};</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">m_factory_</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">static</span> <span class="n">ConnectionFactory</span> <span class="n">m_factory_</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">static</span> <span class="n">IConnection</span> <span class="nf">GetConnection</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">null</span> <span class="p">==</span> <span class="n">m_connection_</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">m_connection_</span> <span class="p">=</span> <span class="nf">GetFactory</span><span class="p">().</span><span class="nf">CreateConnection</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">m_connection_</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">static</span> <span class="n">IConnection</span> <span class="n">m_connection_</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">static</span> <span class="kt">bool</span> <span class="nf">IsConnected</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">null</span> <span class="p">!=</span> <span class="n">m_connection_</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">m_connection_</span><span class="p">.</span><span class="n">IsOpen</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">static</span> <span class="n">IModel</span> <span class="nf">GetChannel</span><span class="p">(</span><span class="kt">int</span> <span class="n">index</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">null</span> <span class="p">==</span> <span class="n">m_channels_</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
        <span class="p">{</span>
            <span class="n">m_channels_</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">=</span> <span class="nf">GetConnection</span><span class="p">().</span><span class="nf">CreateModel</span><span class="p">();</span>

            <span class="c1">// 引数が7つの QueueDeclare でエラーを吐くことがあるので、情報を出力しておく。</span>
            <span class="n">Console</span><span class="p">.</span><span class="n">Error</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"GetChannel index = ["</span> <span class="p">+</span> <span class="n">index</span> <span class="p">+</span> <span class="s">"]"</span><span class="p">);</span>
            <span class="n">Console</span><span class="p">.</span><span class="n">Error</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"    QUEUE_NAMES[index] = ["</span> <span class="p">+</span> <span class="n">QUEUE_NAMES</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">+</span> <span class="s">"]"</span><span class="p">);</span>
            <span class="n">Console</span><span class="p">.</span><span class="n">Error</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"    passive_lifeSpans[index] = ["</span> <span class="p">+</span> <span class="n">passive_lifeSpans</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">+</span> <span class="s">"]"</span><span class="p">);</span>
            <span class="n">Console</span><span class="p">.</span><span class="n">Error</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"    durable_lifeSpans[index] = ["</span> <span class="p">+</span> <span class="n">durable_lifeSpans</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">+</span> <span class="s">"]"</span><span class="p">);</span>
            <span class="n">Console</span><span class="p">.</span><span class="n">Error</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"    exclusive_lifeSpans[index] = ["</span> <span class="p">+</span> <span class="n">exclusive_lifeSpans</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">+</span> <span class="s">"]"</span><span class="p">);</span>
            <span class="n">Console</span><span class="p">.</span><span class="n">Error</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"    autodelete_lifeSpans[index] = ["</span> <span class="p">+</span> <span class="n">autodelete_lifeSpans</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">+</span> <span class="s">"]"</span><span class="p">);</span>
            <span class="n">Console</span><span class="p">.</span><span class="n">Error</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"    nowait は仮に false 固定"</span><span class="p">);</span>
            <span class="n">Console</span><span class="p">.</span><span class="n">Error</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"    arguments は仮に null 固定"</span><span class="p">);</span>

<span class="cp">#if UBUNTU
</span>            <span class="c1">// Ubuntuでは何故か Spring.Messaging.Amqp.Rabbit の引数 7 つのやつになっている。</span>
            <span class="c1">// m_channels_[index].QueueDeclare(QUEUE_NAMES[index], false, false, false, false, false, null);</span>
            <span class="n">m_channels_</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="nf">QueueDeclare</span><span class="p">(</span><span class="n">QUEUE_NAMES</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">passive_lifeSpans</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">durable_lifeSpans</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">exclusive_lifeSpans</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">autodelete_lifeSpans</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="k">false</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span>
<span class="cp">#else
</span>            <span class="c1">//m_channels_[index].QueueDeclare(QUEUE_NAMES[index], false, false, false, null);</span>
            <span class="n">m_channels_</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="nf">QueueDeclare</span><span class="p">(</span><span class="n">QUEUE_NAMES</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">durable_lifeSpans</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">exclusive_lifeSpans</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">autodelete_lifeSpans</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="k">null</span><span class="p">);</span>
<span class="cp">#endif
</span>        <span class="p">}</span>
        <span class="k">return</span> <span class="n">m_channels_</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">static</span> <span class="n">IModel</span><span class="p">[]</span> <span class="n">m_channels_</span> <span class="p">=</span> <span class="k">new</span> <span class="n">IModel</span><span class="p">[</span><span class="m">2</span><span class="p">];</span>

    <span class="k">public</span> <span class="k">static</span> <span class="n">EventingBasicConsumer</span> <span class="nf">GetConsumer</span><span class="p">(</span><span class="kt">int</span> <span class="n">index</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">null</span> <span class="p">==</span> <span class="n">m_consumers_</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
        <span class="p">{</span>
<span class="cp">#if UBUNTU
</span>            <span class="c1">// Ubuntuでは何故か v1.4.0 の引数が 0 個のやつになっている。調べたが引数が1個～6個のものは無かった。</span>
            <span class="n">m_consumers_</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">EventingBasicConsumer</span><span class="p">();</span>
<span class="cp">#else
</span>            <span class="n">m_consumers_</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">EventingBasicConsumer</span><span class="p">(</span><span class="nf">GetChannel</span><span class="p">(</span><span class="n">index</span><span class="p">));</span>
<span class="cp">#endif
</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">m_consumers_</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">static</span> <span class="n">EventingBasicConsumer</span><span class="p">[]</span> <span class="n">m_consumers_</span> <span class="p">=</span> <span class="k">new</span> <span class="n">EventingBasicConsumer</span><span class="p">[</span><span class="m">2</span><span class="p">];</span>

    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">/// 受信できたときに割り込んでくる処理</span>
    <span class="c1">/// &lt;/summary&gt;</span>
<span class="cp">#if UBUNTU
</span>    <span class="k">public</span> <span class="k">static</span> <span class="n">BasicDeliverEventHandler</span> <span class="nf">GetDequeueHandler</span><span class="p">()</span>
<span class="cp">#else
</span>    <span class="k">public</span> <span class="k">static</span> <span class="n">EventHandler</span><span class="p">&lt;</span><span class="n">BasicDeliverEventArgs</span><span class="p">&gt;</span> <span class="nf">GetDequeueHandler</span><span class="p">()</span>
<span class="cp">#endif
</span>    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">null</span> <span class="p">==</span> <span class="n">m_dequeueHandler_</span><span class="p">)</span>
        <span class="p">{</span>
<span class="cp">#if UBUNTU
</span>            <span class="n">m_dequeueHandler_</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">BasicDeliverEventHandler</span><span class="p">((</span><span class="n">model</span><span class="p">,</span> <span class="n">ea</span><span class="p">)</span> <span class="p">=&gt;</span>
<span class="cp">#else
</span>            <span class="n">m_dequeueHandler_</span> <span class="p">=</span> <span class="k">new</span> <span class="n">EventHandler</span><span class="p">&lt;</span><span class="n">BasicDeliverEventArgs</span><span class="p">&gt;((</span><span class="n">model</span><span class="p">,</span> <span class="n">ea</span><span class="p">)</span> <span class="p">=&gt;</span>
<span class="cp">#endif
</span>            <span class="p">{</span>
                <span class="kt">byte</span><span class="p">[]</span> <span class="n">body</span> <span class="p">=</span> <span class="n">ea</span><span class="p">.</span><span class="n">Body</span><span class="p">;</span>
                <span class="kt">string</span> <span class="n">message</span> <span class="p">=</span> <span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">.</span><span class="nf">GetString</span><span class="p">(</span><span class="n">body</span><span class="p">);</span>

                <span class="c1">// 回転式バッファーに入れる</span>
                <span class="n">rollingBuffer</span><span class="p">.</span><span class="nf">PutMessage</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
            <span class="p">});</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">m_dequeueHandler_</span><span class="p">;</span>
    <span class="p">}</span>

<span class="cp">#if UBUNTU
</span>    <span class="k">static</span> <span class="n">BasicDeliverEventHandler</span> <span class="n">m_dequeueHandler_</span><span class="p">;</span>
<span class="cp">#else
</span>    <span class="k">static</span> <span class="n">EventHandler</span><span class="p">&lt;</span><span class="n">BasicDeliverEventArgs</span><span class="p">&gt;</span> <span class="n">m_dequeueHandler_</span><span class="p">;</span>
<span class="cp">#endif
</span>
    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">/// 対応するオープンは無いけれど、開けたら閉める、を完璧に対応する必要がある。</span>
    <span class="c1">/// &lt;/summary&gt;</span>
    <span class="k">static</span> <span class="k">void</span> <span class="nf">CloseChannel</span><span class="p">(</span><span class="kt">int</span> <span class="n">index</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">null</span> <span class="p">!=</span> <span class="n">m_channels_</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
        <span class="p">{</span>
            <span class="n">m_channels_</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="nf">Close</span><span class="p">();</span>
            <span class="n">m_channels_</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">static</span> <span class="kt">uint</span> <span class="nf">DeleteQueue</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">IModel</span> <span class="n">channel</span> <span class="p">=</span> <span class="nf">GetChannel</span><span class="p">(</span><span class="n">DELETEQUEUE_INDEX</span><span class="p">);</span>

<span class="cp">#if UBUNTU
</span>            <span class="c1">// Ubuntuでは何故か 昔の .Net 用の引数 5 つのやつの変則版になっている。</span>
            <span class="c1">// uint QueueDelete(ushort ticket, string queue, bool ifUnused, bool ifEmpty, bool nowait)</span>
            <span class="kt">uint</span> <span class="n">result</span> <span class="p">=</span> <span class="n">channel</span><span class="p">.</span><span class="nf">QueueDelete</span><span class="p">(</span> <span class="n">QUEUE_NAMES</span><span class="p">[</span><span class="n">DELETEQUEUE_INDEX</span><span class="p">],</span><span class="k">true</span><span class="p">,</span><span class="k">true</span><span class="p">,</span><span class="k">true</span><span class="p">);</span>
<span class="cp">#else
</span>        <span class="kt">uint</span> <span class="n">result</span> <span class="p">=</span> <span class="n">channel</span><span class="p">.</span><span class="nf">QueueDelete</span><span class="p">(</span><span class="n">QUEUE_NAMES</span><span class="p">[</span><span class="n">DELETEQUEUE_INDEX</span><span class="p">],</span> <span class="k">true</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
<span class="cp">#endif
</span>
        <span class="c1">// 対応するオープンは無いが、ちゃんと閉じないと、レシーブしてくれない。</span>
        <span class="nf">CloseChannel</span><span class="p">(</span><span class="n">DELETEQUEUE_INDEX</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">static</span> <span class="k">void</span> <span class="nf">Enqueue</span><span class="p">(</span><span class="kt">string</span> <span class="n">message</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// 末尾に daze を付ける。</span>
        <span class="n">message</span> <span class="p">+=</span> <span class="s">"daze"</span><span class="p">;</span>

        <span class="n">IModel</span> <span class="n">channel</span> <span class="p">=</span> <span class="nf">GetChannel</span><span class="p">(</span><span class="n">ENQUEUE_INDEX</span><span class="p">);</span>
        <span class="kt">byte</span><span class="p">[]</span> <span class="n">body</span> <span class="p">=</span> <span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
        <span class="n">channel</span><span class="p">.</span><span class="nf">BasicPublish</span><span class="p">(</span><span class="s">""</span><span class="p">,</span> <span class="n">QUEUE_NAMES</span><span class="p">[</span><span class="n">ENQUEUE_INDEX</span><span class="p">],</span> <span class="k">null</span><span class="p">,</span> <span class="n">body</span><span class="p">);</span>

        <span class="c1">// 対応するオープンは無いが、ちゃんと閉じないと、レシーブしてくれない。</span>
        <span class="nf">CloseChannel</span><span class="p">(</span><span class="n">ENQUEUE_INDEX</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">static</span> <span class="k">void</span> <span class="nf">StartConsume</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">IModel</span> <span class="n">channel</span> <span class="p">=</span> <span class="nf">GetChannel</span><span class="p">(</span><span class="n">DEQUEUE_INDEX</span><span class="p">);</span>
        <span class="n">EventingBasicConsumer</span> <span class="n">consumer</span> <span class="p">=</span> <span class="nf">GetConsumer</span><span class="p">(</span><span class="n">DEQUEUE_INDEX</span><span class="p">);</span>
        <span class="c1">// 受信できたときに割り込んでくる処理</span>
        <span class="n">consumer</span><span class="p">.</span><span class="n">Received</span> <span class="p">+=</span> <span class="nf">GetDequeueHandler</span><span class="p">();</span>

<span class="cp">#if UBUNTU
</span>        <span class="c1">// Ubuntuでは何故か引数が 5 個のやつになっている。</span>
        <span class="n">channel</span><span class="p">.</span><span class="nf">BasicConsume</span><span class="p">(</span> <span class="n">QUEUE_NAMES</span><span class="p">[</span><span class="n">DEQUEUE_INDEX</span><span class="p">],</span> <span class="k">true</span><span class="p">,</span> <span class="s">""</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="n">consumer</span><span class="p">);</span>
<span class="cp">#else
</span>        <span class="n">channel</span><span class="p">.</span><span class="nf">BasicConsume</span><span class="p">(</span><span class="n">QUEUE_NAMES</span><span class="p">[</span><span class="n">DEQUEUE_INDEX</span><span class="p">],</span> <span class="k">true</span><span class="p">,</span> <span class="n">consumer</span><span class="p">);</span>
<span class="cp">#endif
</span>
        <span class="c1">// 終了はさせない</span>
        <span class="c1">// consumer.Received -= GetReceiveHandler();</span>
        <span class="c1">// CloseChannel(DEQUEUE_INDEX);</span>
    <span class="p">}</span>

    <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//----------------------------------------</span>
        <span class="c1">// Delete</span>
        <span class="c1">//----------------------------------------</span>
        <span class="k">for</span> <span class="p">(;;)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="s">@"削除したいキューがあれば名前を、無ければ空文字列を入れろだぜ☆（＾～＾）
キュー名を入力    : キューを削除します
空文字列で[Enter] : 次のステップへ進む
Name or empty ? &gt; "</span><span class="p">);</span>
            <span class="kt">string</span> <span class="n">queueName_delete</span> <span class="p">=</span> <span class="n">Console</span><span class="p">.</span><span class="nf">ReadLine</span><span class="p">();</span>
            <span class="k">if</span> <span class="p">(</span><span class="s">""</span> <span class="p">==</span> <span class="n">queueName_delete</span><span class="p">.</span><span class="nf">Trim</span><span class="p">())</span>
            <span class="p">{</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>


            <span class="n">Console</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="s">@"削除するメッセージ・キューの寿命を、足し算して答えろだぜ☆（＾～＾）
("</span> <span class="p">+</span> <span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">LifeSpanType</span><span class="p">.</span><span class="n">Durable</span><span class="p">)</span> <span class="p">+</span> <span class="s">@") durable    : RabbitMQが止まってもキューを残す
("</span> <span class="p">+</span> <span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">LifeSpanType</span><span class="p">.</span><span class="n">Autodelete</span><span class="p">)</span> <span class="p">+</span> <span class="s">@") autodelete : コンシューマーが１人も接続していなかったら消す
("</span> <span class="p">+</span> <span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">LifeSpanType</span><span class="p">.</span><span class="n">Passive</span><span class="p">)</span> <span class="p">+</span> <span class="s">@") passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ
("</span> <span class="p">+</span> <span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">LifeSpanType</span><span class="p">.</span><span class="n">Exclusive</span><span class="p">)</span> <span class="p">+</span> <span class="s">@") exclusive  : この接続でだけ使える。この接続が切れたら消す
Number ? &gt; "</span><span class="p">);</span>
            <span class="n">LifeSpanType</span> <span class="n">lifeSpan_delete</span> <span class="p">=</span> <span class="p">(</span><span class="n">LifeSpanType</span><span class="p">)</span><span class="kt">int</span><span class="p">.</span><span class="nf">Parse</span><span class="p">(</span><span class="n">Console</span><span class="p">.</span><span class="nf">ReadLine</span><span class="p">());</span>
            <span class="nf">SetLifeSpan</span><span class="p">(</span><span class="n">DELETEQUEUE_INDEX</span><span class="p">,</span> <span class="n">queueName_delete</span><span class="p">,</span> <span class="n">lifeSpan_delete</span><span class="p">);</span>
            <span class="kt">uint</span> <span class="n">result</span> <span class="p">=</span> <span class="nf">DeleteQueue</span><span class="p">();</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">@"["</span> <span class="p">+</span> <span class="n">queueName_delete</span> <span class="p">+</span> <span class="s">"]キューを削除したはずだぜ☆（＾～＾） result=["</span> <span class="p">+</span> <span class="n">result</span> <span class="p">+</span> <span class="s">"]"</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">//----------------------------------------</span>
        <span class="c1">// Enqueue settings</span>
        <span class="c1">//----------------------------------------</span>
        <span class="k">for</span> <span class="p">(;;)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="s">@"エンキュー先のメッセージ・キューの名前を入れろだぜ☆（＾～＾）
Queue name? &gt; "</span><span class="p">);</span>
            <span class="kt">string</span> <span class="n">queueName_enqueue</span> <span class="p">=</span> <span class="n">Console</span><span class="p">.</span><span class="nf">ReadLine</span><span class="p">();</span>

            <span class="n">Console</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="s">@"エンキュー先のメッセージ・キューの寿命を、足し算して答えろだぜ☆（＾～＾）
("</span> <span class="p">+</span> <span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">LifeSpanType</span><span class="p">.</span><span class="n">Durable</span><span class="p">)</span> <span class="p">+</span> <span class="s">@") durable    : RabbitMQが止まってもキューを残す
("</span> <span class="p">+</span> <span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">LifeSpanType</span><span class="p">.</span><span class="n">Autodelete</span><span class="p">)</span> <span class="p">+</span> <span class="s">@") autodelete : コンシューマーが１人も接続していなかったら消す
("</span> <span class="p">+</span> <span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">LifeSpanType</span><span class="p">.</span><span class="n">Passive</span><span class="p">)</span> <span class="p">+</span> <span class="s">@") passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ
("</span> <span class="p">+</span> <span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">LifeSpanType</span><span class="p">.</span><span class="n">Exclusive</span><span class="p">)</span> <span class="p">+</span> <span class="s">@") exclusive  : この接続でだけ使える。この接続が切れたら消す
Number ? &gt; "</span><span class="p">);</span>
            <span class="kt">int</span> <span class="n">lifeSpan_enqueue</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="kt">int</span><span class="p">.</span><span class="nf">TryParse</span><span class="p">(</span><span class="n">Console</span><span class="p">.</span><span class="nf">ReadLine</span><span class="p">(),</span> <span class="k">out</span> <span class="n">lifeSpan_enqueue</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="nf">SetLifeSpan</span><span class="p">(</span><span class="n">ENQUEUE_INDEX</span><span class="p">,</span> <span class="n">queueName_enqueue</span><span class="p">,</span> <span class="p">(</span><span class="n">LifeSpanType</span><span class="p">)</span><span class="n">lifeSpan_enqueue</span><span class="p">);</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">//----------------------------------------</span>
        <span class="c1">// Enqueue settings</span>
        <span class="c1">//----------------------------------------</span>
        <span class="k">for</span> <span class="p">(;;)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="s">@"デキュー先のメッセージ・キューの名前を入れろだぜ☆（＾～＾）
Queue name? &gt; "</span><span class="p">);</span>
            <span class="kt">string</span> <span class="n">queueName_dequeue</span> <span class="p">=</span> <span class="n">Console</span><span class="p">.</span><span class="nf">ReadLine</span><span class="p">();</span>

            <span class="n">Console</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="s">@"デキュー先のメッセージ・キューの寿命を、足し算して答えろだぜ☆（＾～＾）
("</span> <span class="p">+</span> <span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">LifeSpanType</span><span class="p">.</span><span class="n">Durable</span><span class="p">)</span> <span class="p">+</span> <span class="s">@") durable    : RabbitMQが止まってもキューを残す
("</span> <span class="p">+</span> <span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">LifeSpanType</span><span class="p">.</span><span class="n">Autodelete</span><span class="p">)</span> <span class="p">+</span> <span class="s">@") autodelete : コンシューマーが１人も接続していなかったら消す
("</span> <span class="p">+</span> <span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">LifeSpanType</span><span class="p">.</span><span class="n">Passive</span><span class="p">)</span> <span class="p">+</span> <span class="s">@") passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ
("</span> <span class="p">+</span> <span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">LifeSpanType</span><span class="p">.</span><span class="n">Exclusive</span><span class="p">)</span> <span class="p">+</span> <span class="s">@") exclusive  : この接続でだけ使える。この接続が切れたら消す
Number ? &gt; "</span><span class="p">);</span>
            <span class="kt">int</span> <span class="n">lifeSpan_dequeue</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="kt">int</span><span class="p">.</span><span class="nf">TryParse</span><span class="p">(</span><span class="n">Console</span><span class="p">.</span><span class="nf">ReadLine</span><span class="p">(),</span> <span class="k">out</span> <span class="n">lifeSpan_dequeue</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="nf">SetLifeSpan</span><span class="p">(</span><span class="n">DEQUEUE_INDEX</span><span class="p">,</span> <span class="n">queueName_dequeue</span><span class="p">,</span> <span class="p">(</span><span class="n">LifeSpanType</span><span class="p">)</span><span class="n">lifeSpan_dequeue</span><span class="p">);</span>

                <span class="nf">StartConsume</span><span class="p">();</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// 常時監視をスタート</span>
        <span class="nf">StartConsume</span><span class="p">();</span>

        <span class="c1">// 無限ループ</span>
        <span class="k">while</span> <span class="p">(</span><span class="nf">IsConnected</span><span class="p">())</span>
        <span class="p">{</span>
            <span class="kt">string</span> <span class="n">message</span> <span class="p">=</span> <span class="n">rollingBuffer</span><span class="p">.</span><span class="nf">GetMessage</span><span class="p">();</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">null</span> <span class="p">!=</span> <span class="n">message</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="c1">// エンキューする</span>
                <span class="nf">Enqueue</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="n">Thread</span><span class="p">.</span><span class="nf">Sleep</span><span class="p">(</span><span class="m">20</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// このプログラムは、自分では接続を切らない。</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">/// &lt;summary&gt;</span>
<span class="c1">/// 回転式バッファー。</span>
<span class="c1">/// これはメイン・スレッドに置く。</span>
<span class="c1">/// デキューのスレッドでエンキューすることはできない。</span>
<span class="c1">/// デキュー処理は、回転式バッファーを仲介にしてエンキュー処理にメッセージを渡す。</span>
<span class="c1">/// &lt;/summary&gt;</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">RotationBuffer</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">bufferSize</span> <span class="p">=</span> <span class="m">100</span><span class="p">;</span>
    <span class="k">public</span> <span class="kt">string</span><span class="p">[]</span> <span class="n">buffer</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">string</span><span class="p">[</span><span class="n">bufferSize</span><span class="p">];</span>
    <span class="k">public</span> <span class="kt">int</span><span class="p">[]</span> <span class="n">bufferCursors</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">int</span><span class="p">[]</span> <span class="p">{</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span> <span class="p">};</span>
    <span class="k">public</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">PUT_INDEX</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">GET_INDEX</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">PutMessage</span><span class="p">(</span><span class="kt">string</span> <span class="n">message</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">buffer</span><span class="p">[</span><span class="n">bufferCursors</span><span class="p">[</span><span class="n">PUT_INDEX</span><span class="p">]]</span> <span class="p">=</span> <span class="n">message</span><span class="p">;</span>
        <span class="n">bufferCursors</span><span class="p">[</span><span class="n">PUT_INDEX</span><span class="p">]++;</span>
        <span class="k">if</span> <span class="p">(!(</span><span class="n">bufferCursors</span><span class="p">[</span><span class="n">PUT_INDEX</span><span class="p">]</span> <span class="p">&lt;</span> <span class="n">bufferSize</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">bufferCursors</span><span class="p">[</span><span class="n">PUT_INDEX</span><span class="p">]</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="nf">GetMessage</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">null</span> <span class="p">!=</span> <span class="n">buffer</span><span class="p">[</span><span class="n">bufferCursors</span><span class="p">[</span><span class="n">GET_INDEX</span><span class="p">]])</span>
        <span class="p">{</span>
            <span class="kt">string</span> <span class="n">message</span> <span class="p">=</span> <span class="n">buffer</span><span class="p">[</span><span class="n">bufferCursors</span><span class="p">[</span><span class="n">GET_INDEX</span><span class="p">]];</span>
            <span class="n">buffer</span><span class="p">[</span><span class="n">bufferCursors</span><span class="p">[</span><span class="n">GET_INDEX</span><span class="p">]]</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
            <span class="n">bufferCursors</span><span class="p">[</span><span class="n">GET_INDEX</span><span class="p">]++;</span>
            <span class="k">if</span> <span class="p">(!(</span><span class="n">bufferCursors</span><span class="p">[</span><span class="n">GET_INDEX</span><span class="p">]</span> <span class="p">&lt;</span> <span class="n">bufferSize</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="n">bufferCursors</span><span class="p">[</span><span class="n">GET_INDEX</span><span class="p">]</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">message</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>改造し終わってから気づいたんだが、バックグラウンドで動かすプログラムでは　標準入出力で設定なんかできない。</p>

<h1>
<span id="tamesi35a2_cscs-コマンドライン引数指定版" class="fragment"></span><a href="#tamesi35a2_cscs-%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%83%A9%E3%82%A4%E3%83%B3%E5%BC%95%E6%95%B0%E6%8C%87%E5%AE%9A%E7%89%88"><i class="fa fa-link"></i></a>tamesi35a2_cs.cs コマンドライン引数指定版</h1>

<p>こんなんでいいんだろうか？</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre><code><span class="c1">//--------------------------------------------------------------------------------</span>
<span class="c1">// tamesi35a2_cs.cs</span>
<span class="c1">//</span>
<span class="c1">// メッセージの末尾に daze を付けます。</span>
<span class="c1">// 標準入出力は、キーボード、画面には接続しないようにします。</span>
<span class="c1">// キューの名前はコマンドライン引数で指定してください。</span>
<span class="c1">// デキューは割込みを受け付けます。</span>
<span class="c1">//--------------------------------------------------------------------------------</span>
<span class="c1">// OS  : Windows 10</span>
<span class="c1">// IDE : Visual Studio 2015</span>
<span class="c1">//       Install : NuGet   : Install-Package RabbitMQ.Client -Version 4.1.1</span>
<span class="c1">//</span>
<span class="c1">// OS  : Ubuntu 16.04</span>
<span class="c1">//       Compile : Command : mcs /r:RabbitMQ.Client.dll -define:UBUNTU tamesi35a2_cs.cs</span>
<span class="c1">//       Execute : Command : // バックグラウンドで実行する</span>
<span class="c1">//                         : nohup ./tamesi35a2_cs.exe --msgqueue 1117 durable 1116 durable &gt; ./tamesi35a2_cs.out.log 2&gt; ./tamesi35a2_cs.err.log &lt; /dev/null &amp;</span>
<span class="c1">//       Check   :         : // tamesi33a1_cs.exe を使う</span>
<span class="c1">//--------------------------------------------------------------------------------</span>

<span class="c1">// Ubuntu の RabbitMQ はソースのバージョンが古いのか、API が異なった。</span>
<span class="c1">// #define UBUNTU</span>

<span class="k">using</span> <span class="nn">RabbitMQ.Client</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">RabbitMQ.Client.Events</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Text</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Threading</span><span class="p">;</span>

<span class="c1">/// &lt;summary&gt;</span>
<span class="c1">/// このプログラム内だけで使われる数字。AMQP-CPPでの実装とは異なる。</span>
<span class="c1">/// AMQP-CPPでの実装 : AMQP::durable=[1] AMQP::autodelete=[2] AMQP::passive=[8] AMQP::exclusive=[512]</span>
<span class="c1">/// &lt;/summary&gt;</span>
<span class="p">[</span><span class="n">Flags</span><span class="p">]</span>
<span class="k">enum</span> <span class="n">LifeSpanType</span>
<span class="p">{</span>
    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">/// RabbitMQが止まってもキューを残す</span>
    <span class="c1">/// &lt;/summary&gt;</span>
    <span class="n">Durable</span> <span class="p">=</span> <span class="m">1</span><span class="p">,</span>
    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">/// コンシューマーが１人も接続していなかったら消す</span>
    <span class="c1">/// &lt;/summary&gt;</span>
    <span class="n">Autodelete</span> <span class="p">=</span> <span class="m">0x1</span> <span class="p">&lt;&lt;</span> <span class="m">1</span><span class="p">,</span>
    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">/// キューが存在するかどうかチェックするだけ。中身見ない時これ</span>
    <span class="c1">/// &lt;/summary&gt;</span>
    <span class="n">Passive</span> <span class="p">=</span> <span class="m">0x1</span> <span class="p">&lt;&lt;</span> <span class="m">2</span><span class="p">,</span>
    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">/// この接続でだけ使える。この接続が切れたら消す</span>
    <span class="c1">/// &lt;/summary&gt;</span>
    <span class="n">Exclusive</span> <span class="p">=</span> <span class="m">0x1</span> <span class="p">&lt;&lt;</span> <span class="m">3</span>
<span class="p">}</span>

<span class="c1">/// &lt;summary&gt;</span>
<span class="c1">/// 参照 : QueueDeclare http://docs.spring.io/spring-amqp-net/docs/1.0.x/api/html/Spring.Messaging.Amqp.Rabbit~Spring.Messaging.Amqp.Rabbit.Connection.CachedModel~QueueDeclare(String,Boolean,Boolean,Boolean,Boolean,Boolean,IDictionary).html</span>
<span class="c1">/// 参照 : EventingBasicConsumer https://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v1.4.0/rabbitmq-dotnet-client-1.4.0-net-2.0-htmldoc/type-RabbitMQ.Client.Events.EventingBasicConsumer.html</span>
<span class="c1">/// 参照 : BasicConsume https://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v1.4.0/rabbitmq-dotnet-client-1.4.0-net-2.0-htmldoc/type-RabbitMQ.Client.IModel.html#method-M:RabbitMQ.Client.IModel.BasicConsume(System.UInt16,System.String,System.Boolean,System.Collections.IDictionary,RabbitMQ.Client.IBasicConsumer)</span>
<span class="c1">/// 参照 : C#でconstな配列を実現する (もっとクールにプログラミング) http://pgnote.net/?p=885</span>
<span class="c1">/// &lt;/summary&gt;</span>
<span class="k">class</span> <span class="nc">Program</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">ENQUEUE_INDEX</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">DEQUEUE_INDEX</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">NUM_INDEX</span> <span class="p">=</span> <span class="m">2</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">string</span> <span class="n">HOST_NAME</span> <span class="p">=</span> <span class="s">"localhost"</span><span class="p">;</span>
    <span class="k">static</span> <span class="kt">string</span><span class="p">[]</span> <span class="n">name_queues</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">string</span><span class="p">[</span><span class="n">NUM_INDEX</span><span class="p">];</span>
    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">/// キューの寿命（複合可能）</span>
    <span class="c1">/// durable    : RabbitMQが止まってもキューを残す</span>
    <span class="c1">/// autodelete : コンシューマーが１人も接続していなかったら消す</span>
    <span class="c1">/// passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ</span>
    <span class="c1">/// exclusive  : この接続でだけ使える。この接続が切れたら消す</span>
    <span class="c1">/// &lt;/summary&gt;</span>
    <span class="k">static</span> <span class="n">LifeSpanType</span><span class="p">[]</span> <span class="n">lifeSpan_queues</span> <span class="p">=</span> <span class="k">new</span> <span class="n">LifeSpanType</span><span class="p">[</span><span class="n">NUM_INDEX</span><span class="p">];</span>
    <span class="k">static</span> <span class="n">LifeSpanType</span> <span class="nf">LifeSpanString_To_Enum</span><span class="p">(</span><span class="kt">string</span> <span class="n">lifeSpan</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">switch</span> <span class="p">(</span><span class="n">lifeSpan</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">case</span> <span class="s">"durable"</span><span class="p">:</span> <span class="k">return</span> <span class="n">LifeSpanType</span><span class="p">.</span><span class="n">Durable</span><span class="p">;</span>
            <span class="k">case</span> <span class="s">"autodelete"</span><span class="p">:</span> <span class="k">return</span> <span class="n">LifeSpanType</span><span class="p">.</span><span class="n">Autodelete</span><span class="p">;</span>
            <span class="k">case</span> <span class="s">"passive"</span><span class="p">:</span> <span class="k">return</span> <span class="n">LifeSpanType</span><span class="p">.</span><span class="n">Passive</span><span class="p">;</span>
            <span class="k">case</span> <span class="s">"exclusive"</span><span class="p">:</span> <span class="k">return</span> <span class="n">LifeSpanType</span><span class="p">.</span><span class="n">Exclusive</span><span class="p">;</span>
            <span class="k">default</span><span class="p">:</span> <span class="k">throw</span> <span class="k">new</span> <span class="nf">Exception</span><span class="p">(</span><span class="s">"未対応のlifeSpan ["</span> <span class="p">+</span> <span class="n">lifeSpan</span> <span class="p">+</span> <span class="s">"]"</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">static</span> <span class="kt">bool</span><span class="p">[]</span>
        <span class="n">durable_lifeSpans</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">bool</span><span class="p">[</span><span class="n">NUM_INDEX</span><span class="p">],</span>
        <span class="n">autodelete_lifeSpans</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">bool</span><span class="p">[</span><span class="n">NUM_INDEX</span><span class="p">],</span>
        <span class="n">passive_lifeSpans</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">bool</span><span class="p">[</span><span class="n">NUM_INDEX</span><span class="p">],</span>
        <span class="n">exclusive_lifeSpans</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">bool</span><span class="p">[</span><span class="n">NUM_INDEX</span><span class="p">];</span>
    <span class="k">static</span> <span class="k">void</span> <span class="nf">SetLifeSpan</span><span class="p">(</span><span class="kt">int</span> <span class="n">index_queue</span><span class="p">,</span> <span class="kt">string</span> <span class="n">name_queue</span><span class="p">,</span> <span class="n">LifeSpanType</span> <span class="n">lifeSpan</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">name_queues</span><span class="p">[</span><span class="n">index_queue</span><span class="p">]</span> <span class="p">=</span> <span class="n">name_queue</span><span class="p">;</span>
        <span class="n">lifeSpan_queues</span><span class="p">[</span><span class="n">index_queue</span><span class="p">]</span> <span class="p">=</span> <span class="n">lifeSpan</span><span class="p">;</span>

        <span class="c1">// 一旦クリアー</span>
        <span class="n">durable_lifeSpans</span><span class="p">[</span><span class="n">index_queue</span><span class="p">]</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
        <span class="n">autodelete_lifeSpans</span><span class="p">[</span><span class="n">index_queue</span><span class="p">]</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
        <span class="n">passive_lifeSpans</span><span class="p">[</span><span class="n">index_queue</span><span class="p">]</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
        <span class="n">exclusive_lifeSpans</span><span class="p">[</span><span class="n">index_queue</span><span class="p">]</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>

        <span class="c1">// durable</span>
        <span class="k">if</span> <span class="p">(((</span><span class="kt">int</span><span class="p">)</span><span class="n">lifeSpan</span> <span class="p">&amp;</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">LifeSpanType</span><span class="p">.</span><span class="n">Durable</span><span class="p">)</span> <span class="p">==</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">LifeSpanType</span><span class="p">.</span><span class="n">Durable</span><span class="p">)</span> <span class="p">{</span> <span class="n">durable_lifeSpans</span><span class="p">[</span><span class="n">index_queue</span><span class="p">]</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span> <span class="p">}</span>
        <span class="c1">// autodelete</span>
        <span class="k">if</span> <span class="p">(((</span><span class="kt">int</span><span class="p">)</span><span class="n">lifeSpan</span> <span class="p">&amp;</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">LifeSpanType</span><span class="p">.</span><span class="n">Autodelete</span><span class="p">)</span> <span class="p">==</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">LifeSpanType</span><span class="p">.</span><span class="n">Autodelete</span><span class="p">)</span> <span class="p">{</span> <span class="n">autodelete_lifeSpans</span><span class="p">[</span><span class="n">index_queue</span><span class="p">]</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span> <span class="p">}</span>
        <span class="c1">// passive</span>
        <span class="k">if</span> <span class="p">(((</span><span class="kt">int</span><span class="p">)</span><span class="n">lifeSpan</span> <span class="p">&amp;</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">LifeSpanType</span><span class="p">.</span><span class="n">Passive</span><span class="p">)</span> <span class="p">==</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">LifeSpanType</span><span class="p">.</span><span class="n">Passive</span><span class="p">)</span> <span class="p">{</span> <span class="n">passive_lifeSpans</span><span class="p">[</span><span class="n">index_queue</span><span class="p">]</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span> <span class="p">}</span>
        <span class="c1">// exclusive</span>
        <span class="k">if</span> <span class="p">(((</span><span class="kt">int</span><span class="p">)</span><span class="n">lifeSpan</span> <span class="p">&amp;</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">LifeSpanType</span><span class="p">.</span><span class="n">Exclusive</span><span class="p">)</span> <span class="p">==</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">LifeSpanType</span><span class="p">.</span><span class="n">Exclusive</span><span class="p">)</span> <span class="p">{</span> <span class="n">exclusive_lifeSpans</span><span class="p">[</span><span class="n">index_queue</span><span class="p">]</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// 回転式バッファー</span>
    <span class="k">static</span> <span class="n">RotationBuffer</span> <span class="n">rollingBuffer</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RotationBuffer</span><span class="p">();</span>

    <span class="k">static</span> <span class="n">ConnectionFactory</span> <span class="nf">GetFactory</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">null</span> <span class="p">==</span> <span class="n">m_factory_</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">m_factory_</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ConnectionFactory</span><span class="p">()</span> <span class="p">{</span> <span class="n">HostName</span> <span class="p">=</span> <span class="n">HOST_NAME</span> <span class="p">};</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">m_factory_</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">static</span> <span class="n">ConnectionFactory</span> <span class="n">m_factory_</span><span class="p">;</span>

    <span class="k">static</span> <span class="n">IConnection</span> <span class="nf">GetConnection</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">null</span> <span class="p">==</span> <span class="n">m_connection_</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">m_connection_</span> <span class="p">=</span> <span class="nf">GetFactory</span><span class="p">().</span><span class="nf">CreateConnection</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">m_connection_</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">static</span> <span class="n">IConnection</span> <span class="n">m_connection_</span><span class="p">;</span>

    <span class="k">static</span> <span class="kt">bool</span> <span class="nf">IsConnected</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">null</span> <span class="p">!=</span> <span class="n">m_connection_</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">m_connection_</span><span class="p">.</span><span class="n">IsOpen</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">static</span> <span class="n">IModel</span> <span class="nf">GetChannel</span><span class="p">(</span><span class="kt">int</span> <span class="n">index</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">null</span> <span class="p">==</span> <span class="n">m_channels_</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
        <span class="p">{</span>
            <span class="n">m_channels_</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">=</span> <span class="nf">GetConnection</span><span class="p">().</span><span class="nf">CreateModel</span><span class="p">();</span>

            <span class="c1">// 引数が7つの QueueDeclare でエラーを吐くことがあるので、情報を出力しておく。</span>
            <span class="n">Console</span><span class="p">.</span><span class="n">Error</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"GetChannel index = ["</span> <span class="p">+</span> <span class="n">index</span> <span class="p">+</span> <span class="s">"]"</span><span class="p">);</span>
            <span class="n">Console</span><span class="p">.</span><span class="n">Error</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"    QUEUE_NAMES[index] = ["</span> <span class="p">+</span> <span class="n">name_queues</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">+</span> <span class="s">"]"</span><span class="p">);</span>
            <span class="n">Console</span><span class="p">.</span><span class="n">Error</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"    passive_lifeSpans[index] = ["</span> <span class="p">+</span> <span class="n">passive_lifeSpans</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">+</span> <span class="s">"]"</span><span class="p">);</span>
            <span class="n">Console</span><span class="p">.</span><span class="n">Error</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"    durable_lifeSpans[index] = ["</span> <span class="p">+</span> <span class="n">durable_lifeSpans</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">+</span> <span class="s">"]"</span><span class="p">);</span>
            <span class="n">Console</span><span class="p">.</span><span class="n">Error</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"    exclusive_lifeSpans[index] = ["</span> <span class="p">+</span> <span class="n">exclusive_lifeSpans</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">+</span> <span class="s">"]"</span><span class="p">);</span>
            <span class="n">Console</span><span class="p">.</span><span class="n">Error</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"    autodelete_lifeSpans[index] = ["</span> <span class="p">+</span> <span class="n">autodelete_lifeSpans</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">+</span> <span class="s">"]"</span><span class="p">);</span>
            <span class="n">Console</span><span class="p">.</span><span class="n">Error</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"    nowait は仮に false 固定"</span><span class="p">);</span>
            <span class="n">Console</span><span class="p">.</span><span class="n">Error</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"    arguments は仮に null 固定"</span><span class="p">);</span>

<span class="cp">#if UBUNTU
</span>            <span class="c1">// Ubuntuでは何故か Spring.Messaging.Amqp.Rabbit の引数 7 つのやつになっている。</span>
            <span class="c1">// m_channels_[index].QueueDeclare(QUEUE_NAMES[index], false, false, false, false, false, null);</span>
            <span class="n">m_channels_</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="nf">QueueDeclare</span><span class="p">(</span><span class="n">QUEUE_NAMES</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">passive_lifeSpans</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">durable_lifeSpans</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">exclusive_lifeSpans</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">autodelete_lifeSpans</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="k">false</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span>
<span class="cp">#else
</span>            <span class="c1">//m_channels_[index].QueueDeclare(QUEUE_NAMES[index], false, false, false, null);</span>
            <span class="n">m_channels_</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="nf">QueueDeclare</span><span class="p">(</span><span class="n">name_queues</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">durable_lifeSpans</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">exclusive_lifeSpans</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">autodelete_lifeSpans</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="k">null</span><span class="p">);</span>
<span class="cp">#endif
</span>        <span class="p">}</span>
        <span class="k">return</span> <span class="n">m_channels_</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">static</span> <span class="n">IModel</span><span class="p">[]</span> <span class="n">m_channels_</span> <span class="p">=</span> <span class="k">new</span> <span class="n">IModel</span><span class="p">[</span><span class="m">2</span><span class="p">];</span>

    <span class="k">static</span> <span class="n">EventingBasicConsumer</span> <span class="nf">GetConsumer</span><span class="p">(</span><span class="kt">int</span> <span class="n">index</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">null</span> <span class="p">==</span> <span class="n">m_consumers_</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
        <span class="p">{</span>
<span class="cp">#if UBUNTU
</span>            <span class="c1">// Ubuntuでは何故か v1.4.0 の引数が 0 個のやつになっている。調べたが引数が1個～6個のものは無かった。</span>
            <span class="n">m_consumers_</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">EventingBasicConsumer</span><span class="p">();</span>
<span class="cp">#else
</span>            <span class="n">m_consumers_</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">EventingBasicConsumer</span><span class="p">(</span><span class="nf">GetChannel</span><span class="p">(</span><span class="n">index</span><span class="p">));</span>
<span class="cp">#endif
</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">m_consumers_</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">static</span> <span class="n">EventingBasicConsumer</span><span class="p">[]</span> <span class="n">m_consumers_</span> <span class="p">=</span> <span class="k">new</span> <span class="n">EventingBasicConsumer</span><span class="p">[</span><span class="m">2</span><span class="p">];</span>

    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">/// 受信できたときに割り込んでくる処理</span>
    <span class="c1">/// &lt;/summary&gt;</span>
<span class="cp">#if UBUNTU
</span>    <span class="k">public</span> <span class="k">static</span> <span class="n">BasicDeliverEventHandler</span> <span class="nf">GetDequeueHandler</span><span class="p">()</span>
<span class="cp">#else
</span>    <span class="k">static</span> <span class="n">EventHandler</span><span class="p">&lt;</span><span class="n">BasicDeliverEventArgs</span><span class="p">&gt;</span> <span class="nf">GetDequeueHandler</span><span class="p">()</span>
<span class="cp">#endif
</span>    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">null</span> <span class="p">==</span> <span class="n">m_dequeueHandler_</span><span class="p">)</span>
        <span class="p">{</span>
<span class="cp">#if UBUNTU
</span>            <span class="n">m_dequeueHandler_</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">BasicDeliverEventHandler</span><span class="p">((</span><span class="n">model</span><span class="p">,</span> <span class="n">ea</span><span class="p">)</span> <span class="p">=&gt;</span>
<span class="cp">#else
</span>            <span class="n">m_dequeueHandler_</span> <span class="p">=</span> <span class="k">new</span> <span class="n">EventHandler</span><span class="p">&lt;</span><span class="n">BasicDeliverEventArgs</span><span class="p">&gt;((</span><span class="n">model</span><span class="p">,</span> <span class="n">ea</span><span class="p">)</span> <span class="p">=&gt;</span>
<span class="cp">#endif
</span>            <span class="p">{</span>
                <span class="kt">byte</span><span class="p">[]</span> <span class="n">body</span> <span class="p">=</span> <span class="n">ea</span><span class="p">.</span><span class="n">Body</span><span class="p">;</span>
                <span class="kt">string</span> <span class="n">message</span> <span class="p">=</span> <span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">.</span><span class="nf">GetString</span><span class="p">(</span><span class="n">body</span><span class="p">);</span>

                <span class="c1">// 回転式バッファーに入れる</span>
                <span class="n">rollingBuffer</span><span class="p">.</span><span class="nf">PutMessage</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
            <span class="p">});</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">m_dequeueHandler_</span><span class="p">;</span>
    <span class="p">}</span>

<span class="cp">#if UBUNTU
</span>    <span class="k">static</span> <span class="n">BasicDeliverEventHandler</span> <span class="n">m_dequeueHandler_</span><span class="p">;</span>
<span class="cp">#else
</span>    <span class="k">static</span> <span class="n">EventHandler</span><span class="p">&lt;</span><span class="n">BasicDeliverEventArgs</span><span class="p">&gt;</span> <span class="n">m_dequeueHandler_</span><span class="p">;</span>
<span class="cp">#endif
</span>
    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">/// 対応するオープンは無いけれど、開けたら閉める、を完璧に対応する必要がある。</span>
    <span class="c1">/// &lt;/summary&gt;</span>
    <span class="k">static</span> <span class="k">void</span> <span class="nf">CloseChannel</span><span class="p">(</span><span class="kt">int</span> <span class="n">index</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">null</span> <span class="p">!=</span> <span class="n">m_channels_</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
        <span class="p">{</span>
            <span class="n">m_channels_</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="nf">Close</span><span class="p">();</span>
            <span class="n">m_channels_</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">static</span> <span class="k">void</span> <span class="nf">Enqueue</span><span class="p">(</span><span class="kt">string</span> <span class="n">message</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// 末尾に daze を付ける。</span>
        <span class="n">message</span> <span class="p">+=</span> <span class="s">"daze"</span><span class="p">;</span>

        <span class="n">IModel</span> <span class="n">channel</span> <span class="p">=</span> <span class="nf">GetChannel</span><span class="p">(</span><span class="n">ENQUEUE_INDEX</span><span class="p">);</span>
        <span class="kt">byte</span><span class="p">[]</span> <span class="n">body</span> <span class="p">=</span> <span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
        <span class="n">channel</span><span class="p">.</span><span class="nf">BasicPublish</span><span class="p">(</span><span class="s">""</span><span class="p">,</span> <span class="n">name_queues</span><span class="p">[</span><span class="n">ENQUEUE_INDEX</span><span class="p">],</span> <span class="k">null</span><span class="p">,</span> <span class="n">body</span><span class="p">);</span>

        <span class="c1">// 対応するオープンは無いが、ちゃんと閉じないと、レシーブしてくれない。</span>
        <span class="nf">CloseChannel</span><span class="p">(</span><span class="n">ENQUEUE_INDEX</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">static</span> <span class="k">void</span> <span class="nf">StartConsume</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">IModel</span> <span class="n">channel</span> <span class="p">=</span> <span class="nf">GetChannel</span><span class="p">(</span><span class="n">DEQUEUE_INDEX</span><span class="p">);</span>
        <span class="n">EventingBasicConsumer</span> <span class="n">consumer</span> <span class="p">=</span> <span class="nf">GetConsumer</span><span class="p">(</span><span class="n">DEQUEUE_INDEX</span><span class="p">);</span>
        <span class="c1">// 受信できたときに割り込んでくる処理</span>
        <span class="n">consumer</span><span class="p">.</span><span class="n">Received</span> <span class="p">+=</span> <span class="nf">GetDequeueHandler</span><span class="p">();</span>

<span class="cp">#if UBUNTU
</span>        <span class="c1">// Ubuntuでは何故か引数が 5 個のやつになっている。</span>
        <span class="n">channel</span><span class="p">.</span><span class="nf">BasicConsume</span><span class="p">(</span> <span class="n">QUEUE_NAMES</span><span class="p">[</span><span class="n">DEQUEUE_INDEX</span><span class="p">],</span> <span class="k">true</span><span class="p">,</span> <span class="s">""</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="n">consumer</span><span class="p">);</span>
<span class="cp">#else
</span>        <span class="n">channel</span><span class="p">.</span><span class="nf">BasicConsume</span><span class="p">(</span><span class="n">name_queues</span><span class="p">[</span><span class="n">DEQUEUE_INDEX</span><span class="p">],</span> <span class="k">true</span><span class="p">,</span> <span class="n">consumer</span><span class="p">);</span>
<span class="cp">#endif
</span>
        <span class="c1">// 終了はさせない</span>
        <span class="c1">// consumer.Received -= GetReceiveHandler();</span>
        <span class="c1">// CloseChannel(DEQUEUE_INDEX);</span>
    <span class="p">}</span>

    <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">Length</span><span class="p">&lt;</span><span class="m">1</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">goto</span> <span class="n">gt_Error1</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// 引数の解析</span>
        <span class="p">{</span>
            <span class="c1">// 与件</span>
            <span class="c1">// 「--msgqueue 1117 durable 1116 durable」という引数は「--msgqueue」「1117」「durable」「1116」「durable」に分解される。</span>

            <span class="c1">// 受け皿</span>
            <span class="c1">// 0:enqueue 1:dequeue</span>

            <span class="c1">// 記憶</span>
            <span class="kt">int</span> <span class="n">m0</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="c1">// カーソル相当</span>

            <span class="c1">// 解析器</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="kt">string</span> <span class="n">a</span> <span class="k">in</span> <span class="n">args</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">m0</span><span class="p">==</span><span class="m">0</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="k">switch</span> <span class="p">(</span><span class="n">a</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="k">case</span> <span class="s">"--msgqueue"</span><span class="p">:</span> <span class="n">m0</span><span class="p">++;</span> <span class="k">break</span><span class="p">;</span>
                        <span class="k">default</span><span class="p">:</span> <span class="k">goto</span> <span class="n">gt_Error1</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
                <span class="k">else</span> <span class="c1">//--msgqueue 内容</span>
                <span class="p">{</span>
                    <span class="k">switch</span> <span class="p">((</span><span class="n">m0</span> <span class="p">-</span> <span class="m">1</span><span class="p">)</span> <span class="p">%</span> <span class="m">2</span><span class="p">)</span> <span class="c1">// 引数名の分1引いている</span>
                    <span class="p">{</span>
                        <span class="k">case</span> <span class="m">0</span><span class="p">:</span> <span class="n">name_queues</span><span class="p">[(</span><span class="n">m0</span> <span class="p">-</span> <span class="m">1</span><span class="p">)</span> <span class="p">/</span> <span class="m">2</span><span class="p">]</span> <span class="p">=</span> <span class="n">a</span><span class="p">;</span> <span class="n">m0</span><span class="p">++;</span> <span class="k">break</span><span class="p">;</span>
                        <span class="k">case</span> <span class="m">1</span><span class="p">:</span> <span class="n">lifeSpan_queues</span><span class="p">[(</span><span class="n">m0</span> <span class="p">-</span> <span class="m">1</span><span class="p">)</span> <span class="p">/</span> <span class="m">2</span><span class="p">]</span> <span class="p">=</span> <span class="nf">LifeSpanString_To_Enum</span><span class="p">(</span><span class="n">a</span><span class="p">);</span> <span class="n">m0</span><span class="p">++;</span> <span class="k">break</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="c1">// 結果</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="m">2</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="nf">SetLifeSpan</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">name_queues</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">lifeSpan_queues</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// 常時監視をスタート</span>
        <span class="nf">StartConsume</span><span class="p">();</span>

        <span class="c1">// 無限ループ</span>
        <span class="k">while</span> <span class="p">(</span><span class="nf">IsConnected</span><span class="p">())</span>
        <span class="p">{</span>
            <span class="kt">string</span> <span class="n">message</span> <span class="p">=</span> <span class="n">rollingBuffer</span><span class="p">.</span><span class="nf">GetMessage</span><span class="p">();</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">null</span> <span class="p">!=</span> <span class="n">message</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="c1">// エンキューする</span>
                <span class="nf">Enqueue</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="n">Thread</span><span class="p">.</span><span class="nf">Sleep</span><span class="p">(</span><span class="m">20</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// このプログラムは、自分では接続を切らない。</span>
        <span class="k">return</span><span class="p">;</span>

        <span class="n">gt_Error1</span><span class="p">:</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">Exception</span><span class="p">(</span><span class="s">@"コマンドライン引数に「--msgqueue キュー名 寿命 キュー名 寿命」を指定しろだぜ☆（＾～＾）
エンキュー先、デキュー先の順番な☆（＾▽＾）
寿命は durable, autodelete, passive, exclusive のいずれかで、
複合指定にはまだ対応していないぜ☆（＞＿＜）"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">/// &lt;summary&gt;</span>
<span class="c1">/// 回転式バッファー。</span>
<span class="c1">/// これはメイン・スレッドに置く。</span>
<span class="c1">/// デキューのスレッドでエンキューすることはできない。</span>
<span class="c1">/// デキュー処理は、回転式バッファーを仲介にしてエンキュー処理にメッセージを渡す。</span>
<span class="c1">/// &lt;/summary&gt;</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">RotationBuffer</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">bufferSize</span> <span class="p">=</span> <span class="m">100</span><span class="p">;</span>
    <span class="k">public</span> <span class="kt">string</span><span class="p">[]</span> <span class="n">buffer</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">string</span><span class="p">[</span><span class="n">bufferSize</span><span class="p">];</span>
    <span class="k">public</span> <span class="kt">int</span><span class="p">[]</span> <span class="n">bufferCursors</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">int</span><span class="p">[]</span> <span class="p">{</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span> <span class="p">};</span>
    <span class="k">public</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">PUT_INDEX</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">GET_INDEX</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">PutMessage</span><span class="p">(</span><span class="kt">string</span> <span class="n">message</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">buffer</span><span class="p">[</span><span class="n">bufferCursors</span><span class="p">[</span><span class="n">PUT_INDEX</span><span class="p">]]</span> <span class="p">=</span> <span class="n">message</span><span class="p">;</span>
        <span class="n">bufferCursors</span><span class="p">[</span><span class="n">PUT_INDEX</span><span class="p">]++;</span>
        <span class="k">if</span> <span class="p">(!(</span><span class="n">bufferCursors</span><span class="p">[</span><span class="n">PUT_INDEX</span><span class="p">]</span> <span class="p">&lt;</span> <span class="n">bufferSize</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">bufferCursors</span><span class="p">[</span><span class="n">PUT_INDEX</span><span class="p">]</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="nf">GetMessage</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">null</span> <span class="p">!=</span> <span class="n">buffer</span><span class="p">[</span><span class="n">bufferCursors</span><span class="p">[</span><span class="n">GET_INDEX</span><span class="p">]])</span>
        <span class="p">{</span>
            <span class="kt">string</span> <span class="n">message</span> <span class="p">=</span> <span class="n">buffer</span><span class="p">[</span><span class="n">bufferCursors</span><span class="p">[</span><span class="n">GET_INDEX</span><span class="p">]];</span>
            <span class="n">buffer</span><span class="p">[</span><span class="n">bufferCursors</span><span class="p">[</span><span class="n">GET_INDEX</span><span class="p">]]</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
            <span class="n">bufferCursors</span><span class="p">[</span><span class="n">GET_INDEX</span><span class="p">]++;</span>
            <span class="k">if</span> <span class="p">(!(</span><span class="n">bufferCursors</span><span class="p">[</span><span class="n">GET_INDEX</span><span class="p">]</span> <span class="p">&lt;</span> <span class="n">bufferSize</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="n">bufferCursors</span><span class="p">[</span><span class="n">GET_INDEX</span><span class="p">]</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">message</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>そういえば今まで標準入力を捨ててなかった気がするな。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>./tamesi35a2_cs.exe --msgqueue 1117 durable 1116 durable &gt; ./tamesi35a2_cs.out.log 2&gt; ./tamesi35a2_cs.err.log &lt; /dev/null &amp;
</code></pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code># ./tamesi34_cs.exe
削除したいキューがあれば名前を、無ければ空文字列を入れろだぜ☆（＾～＾）
キュー名を入力    : キューを削除します
空文字列で[Enter] : 次のステップへ進む
Name or empty ? &gt;
エンキュー先のメッセージ・キューの名前を入れろだぜ☆（＾～＾）
Queue name? &gt; 1116
エンキュー先のメッセージ・キューの寿命を、足し算して答えろだぜ☆（＾～＾）
(1) durable    : RabbitMQが止まってもキューを残す
(2) autodelete : コンシューマーが１人も接続していなかったら消す
(4) passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ
(8) exclusive  : この接続でだけ使える。この接続が切れたら消す
Number ? &gt; 0
デキュー先のメッセージ・キューの名前を入れろだぜ☆（＾～＾）
Queue name? &gt; 1117
デキュー先のメッセージ・キューの寿命を、足し算して答えろだぜ☆（＾～＾）
(1) durable    : RabbitMQが止まってもキューを残す
(2) autodelete : コンシューマーが１人も接続していなかったら消す
(4) passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ
(8) exclusive  : この接続でだけ使える。この接続が切れたら消す
Number ? &gt; 0
GetChannel index = [1]
    QUEUE_NAMES[index] = [1117]
    passive_lifeSpans[index] = [False]
    durable_lifeSpans[index] = [False]
    exclusive_lifeSpans[index] = [False]
    autodelete_lifeSpans[index] = [False]
    nowait は仮に false 固定
    arguments は仮に null 固定

Unhandled Exception:
RabbitMQ.Client.Exceptions.OperationInterruptedException: The AMQP operation was interrupted: AMQP close-reason, initiated by Peer, code=406, text="PRECONDITION_FAILED - inequivalent arg 'durable' for queue '1117' in vhost '/': received 'false' but current is 'true'", classId=50, methodId=10, cause=
  at RabbitMQ.Client.Impl.SimpleBlockingRpcContinuation.GetReply () &lt;0x4013c420 + 0x00107&gt; in &lt;filename unknown&gt;:0
  at RabbitMQ.Client.Impl.ModelBase.ModelRpc (RabbitMQ.Client.Impl.MethodBase method, RabbitMQ.Client.Impl.ContentHeaderBase header, System.Byte[] body) &lt;0x4013a290 + 0x000fd&gt; in &lt;filename unknown&gt;:0
  at RabbitMQ.Client.Framing.Impl.v0_8.Model.QueueDeclare (System.String queue, Boolean passive, Boolean durable, Boolean exclusive, Boolean autoDelete, Boolean nowait, IDictionary arguments) &lt;0x4013e6d0 + 0x00113&gt; in &lt;filename unknown&gt;:0
  at UsagiMQ.Program.GetChannel (Int32 index) &lt;0x400ffd20 + 0x00436&gt; in &lt;filename unknown&gt;:0
  at UsagiMQ.Program.StartConsume (System.String name_queue, LifeSpanType lifeSpan_queue) &lt;0x400ffc40 + 0x0002b&gt; in &lt;filename unknown&gt;:0
  at UsagiMQ.Program.Main (System.String[] args) &lt;0x400fad50 + 0x0096b&gt; in &lt;filename unknown&gt;:0
[ERROR] FATAL UNHANDLED EXCEPTION: RabbitMQ.Client.Exceptions.OperationInterruptedException: The AMQP operation was interrupted: AMQP close-reason, initiated by Peer, code=406, text="PRECONDITION_FAILED - inequivalent arg 'durable' for queue '1117' in vhost '/': received 'false' but current is 'true'", classId=50, methodId=10, cause=
  at RabbitMQ.Client.Impl.SimpleBlockingRpcContinuation.GetReply () &lt;0x4013c420 + 0x00107&gt; in &lt;filename unknown&gt;:0
  at RabbitMQ.Client.Impl.ModelBase.ModelRpc (RabbitMQ.Client.Impl.MethodBase method, RabbitMQ.Client.Impl.ContentHeaderBase header, System.Byte[] body) &lt;0x4013a290 + 0x000fd&gt; in &lt;filename unknown&gt;:0
  at RabbitMQ.Client.Framing.Impl.v0_8.Model.QueueDeclare (System.String queue, Boolean passive, Boolean durable, Boolean exclusive, Boolean autoDelete, Boolean nowait, IDictionary arguments) &lt;0x4013e6d0 + 0x00113&gt; in &lt;filename unknown&gt;:0
  at UsagiMQ.Program.GetChannel (Int32 index) &lt;0x400ffd20 + 0x00436&gt; in &lt;filename unknown&gt;:0
  at UsagiMQ.Program.StartConsume (System.String name_queue, LifeSpanType lifeSpan_queue) &lt;0x400ffc40 + 0x0002b&gt; in &lt;filename unknown&gt;:0
  at UsagiMQ.Program.Main (System.String[] args) &lt;0x400fad50 + 0x0096b&gt; in &lt;filename unknown&gt;:0
</code></pre></div></div>

<p>チャンネル宣言の引数が４つfalse なのもおかしい。もっと情報を出そう。</p>

<h1>
<span id="visual-studio-2015-で-tamesi34_cscs-を動かしてみた" class="fragment"></span><a href="#visual-studio-2015-%E3%81%A7-tamesi34_cscs-%E3%82%92%E5%8B%95%E3%81%8B%E3%81%97%E3%81%A6%E3%81%BF%E3%81%9F"><i class="fa fa-link"></i></a>Visual Studio 2015 で tamesi34_cs.cs を動かしてみた</h1>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>削除したいキューがあれば名前を、無ければ空文字列を入れろだぜ☆（＾～＾）
キュー名を入力    : キューを削除します
空文字列で[Enter] : 次のステップへ進む
Name or empty ? &gt;
エンキュー先のメッセージ・キューの名前を入れろだぜ☆（＾～＾）
Queue name? &gt; 1117
エンキュー先のメッセージ・キューの寿命を、足し算して答えろだぜ☆（＾～＾）
(1) durable    : RabbitMQが止まってもキューを残す
(2) autodelete : コンシューマーが１人も接続していなかったら消す
(4) passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ
(8) exclusive  : この接続でだけ使える。この接続が切れたら消す
Number ? &gt; 0
デキュー先のメッセージ・キューの名前を入れろだぜ☆（＾～＾）
Queue name? &gt; 1116
デキュー先のメッセージ・キューの寿命を、足し算して答えろだぜ☆（＾～＾）
(1) durable    : RabbitMQが止まってもキューを残す
(2) autodelete : コンシューマーが１人も接続していなかったら消す
(4) passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ
(8) exclusive  : この接続でだけ使える。この接続が切れたら消す
Number ? &gt; 0
tamesi34_cs.cs Dump
    name_queues         [ENQUEUE_INDEX]    =[1117]
    lifeSpan_queues     [ENQUEUE_INDEX]    =[0]
    durable_lifeSpans   [ENQUEUE_INDEX]    =[False]
    autodelete_lifeSpans[ENQUEUE_INDEX]    =[False]
    passive_lifeSpans   [ENQUEUE_INDEX]    =[False]
    exclusive_lifeSpans [ENQUEUE_INDEX]    =[False]
    ----
    name_queues         [DEQUEUE_INDEX]    =[1116]
    lifeSpan_queues     [DEQUEUE_INDEX]    =[0]
    durable_lifeSpans   [DEQUEUE_INDEX]    =[False]
    autodelete_lifeSpans[DEQUEUE_INDEX]    =[False]
    passive_lifeSpans   [DEQUEUE_INDEX]    =[False]
    exclusive_lifeSpans [DEQUEUE_INDEX]    =[False]
    ----
    name_queues         [DELETEQUEUE_INDEX]=[]
    lifeSpan_queues     [DELETEQUEUE_INDEX]=[0]
    durable_lifeSpans   [DELETEQUEUE_INDEX]=[False]
    autodelete_lifeSpans[DELETEQUEUE_INDEX]=[False]
    passive_lifeSpans   [DELETEQUEUE_INDEX]=[False]
    exclusive_lifeSpans [DELETEQUEUE_INDEX]=[False]
    ----

(tamesi34_cs.cs?) GetChannel index = [1]
    name_queues[index] = [1116]
    passive_lifeSpans[index] = [False]
    durable_lifeSpans[index] = [False]
    exclusive_lifeSpans[index] = [False]
    autodelete_lifeSpans[index] = [False]
    nowait は仮に false 固定
    arguments は仮に null 固定
</code></pre></div></div>

<p>おかしいじゃないか。false が４つ入っている。</p>

<p><strong>あっ！</strong> durable、0スタートじゃなくて 1スタートに変えたんだった！</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>削除したいキューがあれば名前を、無ければ空文字列を入れろだぜ☆（＾～＾）
キュー名を入力    : キューを削除します
空文字列で[Enter] : 次のステップへ進む
Name or empty ? &gt;
エンキュー先のメッセージ・キューの名前を入れろだぜ☆（＾～＾）
Queue name? &gt; 1117
エンキュー先のメッセージ・キューの寿命を、足し算して答えろだぜ☆（＾～＾）
(1) durable    : RabbitMQが止まってもキューを残す
(2) autodelete : コンシューマーが１人も接続していなかったら消す
(4) passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ
(8) exclusive  : この接続でだけ使える。この接続が切れたら消す
Number ? &gt; 1
デキュー先のメッセージ・キューの名前を入れろだぜ☆（＾～＾）
Queue name? &gt; 1116
デキュー先のメッセージ・キューの寿命を、足し算して答えろだぜ☆（＾～＾）
(1) durable    : RabbitMQが止まってもキューを残す
(2) autodelete : コンシューマーが１人も接続していなかったら消す
(4) passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ
(8) exclusive  : この接続でだけ使える。この接続が切れたら消す
Number ? &gt; 1
tamesi34_cs.cs Dump
    name_queues         [ENQUEUE_INDEX]    =[1117]
    lifeSpan_queues     [ENQUEUE_INDEX]    =[Durable]
    durable_lifeSpans   [ENQUEUE_INDEX]    =[True]
    autodelete_lifeSpans[ENQUEUE_INDEX]    =[False]
    passive_lifeSpans   [ENQUEUE_INDEX]    =[False]
    exclusive_lifeSpans [ENQUEUE_INDEX]    =[False]
    ----
    name_queues         [DEQUEUE_INDEX]    =[1116]
    lifeSpan_queues     [DEQUEUE_INDEX]    =[Durable]
    durable_lifeSpans   [DEQUEUE_INDEX]    =[True]
    autodelete_lifeSpans[DEQUEUE_INDEX]    =[False]
    passive_lifeSpans   [DEQUEUE_INDEX]    =[False]
    exclusive_lifeSpans [DEQUEUE_INDEX]    =[False]
    ----
    name_queues         [DELETEQUEUE_INDEX]=[]
    lifeSpan_queues     [DELETEQUEUE_INDEX]=[0]
    durable_lifeSpans   [DELETEQUEUE_INDEX]=[False]
    autodelete_lifeSpans[DELETEQUEUE_INDEX]=[False]
    passive_lifeSpans   [DELETEQUEUE_INDEX]=[False]
    exclusive_lifeSpans [DELETEQUEUE_INDEX]=[False]
    ----

(tamesi34_cs.cs?) GetChannel index = [1]
    name_queues[index] = [1116]
    passive_lifeSpans[index] = [False]
    durable_lifeSpans[index] = [True]
    exclusive_lifeSpans[index] = [False]
    autodelete_lifeSpans[index] = [False]
    nowait は仮に false 固定
    arguments は仮に null 固定
終了するときは[Ctrl]+[C]キーを押せだぜ☆（＾～＾）
エンキューするときはメッセージを打ち込んで[Enter]キーを押せだぜ☆(＾◇＾)
Enqueue? &gt;
</code></pre></div></div>

<p>ここまでは　おっけー。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code># ./tamesi35a2_cs.exe --msgqueue 1117 durable 1116 durable &gt; ./tamesi35a2_cs.out.log 2&gt; ./tamesi35a2_cs.err.log &lt; /dev/null &amp;
[1] 24403
# ./tamesi34_cs.exe
削除したいキューがあれば名前を、無ければ空文字列を入れろだぜ☆（＾～＾）
キュー名を入力    : キューを削除します
空文字列で[Enter] : 次のステップへ進む
Name or empty ? &gt;
エンキュー先のメッセージ・キューの名前を入れろだぜ☆（＾～＾）
Queue name? &gt; 1116
エンキュー先のメッセージ・キューの寿命を、足し算して答えろだぜ☆（＾～＾）
(1) durable    : RabbitMQが止まってもキューを残す
(2) autodelete : コンシューマーが１人も接続していなかったら消す
(4) passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ
(8) exclusive  : この接続でだけ使える。この接続が切れたら消す
Number ? &gt; 1
デキュー先のメッセージ・キューの名前を入れろだぜ☆（＾～＾）
Queue name? &gt; 1117
デキュー先のメッセージ・キューの寿命を、足し算して答えろだぜ☆（＾～＾）
(1) durable    : RabbitMQが止まってもキューを残す
(2) autodelete : コンシューマーが１人も接続していなかったら消す
(4) passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ
(8) exclusive  : この接続でだけ使える。この接続が切れたら消す
Number ? &gt; 1
GetChannel index = [1]
    QUEUE_NAMES[index] = [1117]
    passive_lifeSpans[index] = [False]
    durable_lifeSpans[index] = [True]
    exclusive_lifeSpans[index] = [False]
    autodelete_lifeSpans[index] = [False]
    nowait は仮に false 固定
    arguments は仮に null 固定
終了するときは[Ctrl]+[C]キーを押せだぜ☆（＾～＾）
エンキューするときはメッセージを打ち込んで[Enter]キーを押せだぜ☆(＾◇＾)
Enqueue? &gt;
</code></pre></div></div>

<p>1 にしたら、動いてるじゃないか。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>Enqueue? &gt; kame
GetChannel index = [0]
    QUEUE_NAMES[index] = [1116]
    passive_lifeSpans[index] = [False]
    durable_lifeSpans[index] = [True]
    exclusive_lifeSpans[index] = [False]
    autodelete_lifeSpans[index] = [False]
    nowait は仮に false 固定
    arguments は仮に null 固定

Unhandled Exception:
RabbitMQ.Client.Exceptions.OperationInterruptedException: The AMQP operation was interrupted: AMQP close-reason, initiated by Peer, code=406, text="PRECONDITION_FAILED - inequivalent arg 'durable' for queue '1116' in vhost '/': received 'true' but current is 'false'", classId=50, methodId=10, cause=
  at RabbitMQ.Client.Impl.SimpleBlockingRpcContinuation.GetReply () &lt;0x42014f00 + 0x00103&gt; in &lt;filename unknown&gt;:0
  at RabbitMQ.Client.Impl.ModelBase.ModelRpc (RabbitMQ.Client.Impl.MethodBase method, RabbitMQ.Client.Impl.ContentHeaderBase header, System.Byte[] body) &lt;0x42012d90 + 0x000f9&gt; in &lt;filename unknown&gt;:0
  at RabbitMQ.Client.Framing.Impl.v0_8.Model.QueueDeclare (System.String queue, Boolean passive, Boolean durable, Boolean exclusive, Boolean autoDelete, Boolean nowait, IDictionary arguments) &lt;0x420171d0 + 0x00113&gt; in &lt;filename unknown&gt;:0
  at UsagiMQ.Program.GetChannel (Int32 index) &lt;0x41fd88d0 + 0x00436&gt; in &lt;filename unknown&gt;:0
  at UsagiMQ.Program.Enqueue (System.String message) &lt;0x420182e0 + 0x00013&gt; in &lt;filename unknown&gt;:0
  at UsagiMQ.Program.Main (System.String[] args) &lt;0x41fd3d50 + 0x0099f&gt; in &lt;filename unknown&gt;:0
[ERROR] FATAL UNHANDLED EXCEPTION: RabbitMQ.Client.Exceptions.OperationInterruptedException: The AMQP operation was interrupted: AMQP close-reason, initiated by Peer, code=406, text="PRECONDITION_FAILED - inequivalent arg 'durable' for queue '1116' in vhost '/': received 'true' but current is 'false'", classId=50, methodId=10, cause=
  at RabbitMQ.Client.Impl.SimpleBlockingRpcContinuation.GetReply () &lt;0x42014f00 + 0x00103&gt; in &lt;filename unknown&gt;:0
  at RabbitMQ.Client.Impl.ModelBase.ModelRpc (RabbitMQ.Client.Impl.MethodBase method, RabbitMQ.Client.Impl.ContentHeaderBase header, System.Byte[] body) &lt;0x42012d90 + 0x000f9&gt; in &lt;filename unknown&gt;:0
  at RabbitMQ.Client.Framing.Impl.v0_8.Model.QueueDeclare (System.String queue, Boolean passive, Boolean durable, Boolean exclusive, Boolean autoDelete, Boolean nowait, IDictionary arguments) &lt;0x420171d0 + 0x00113&gt; in &lt;filename unknown&gt;:0
  at UsagiMQ.Program.GetChannel (Int32 index) &lt;0x41fd88d0 + 0x00436&gt; in &lt;filename unknown&gt;:0
  at UsagiMQ.Program.Enqueue (System.String message) &lt;0x420182e0 + 0x00013&gt; in &lt;filename unknown&gt;:0
  at UsagiMQ.Program.Main (System.String[] args) &lt;0x41fd3d50 + 0x0099f&gt; in &lt;filename unknown&gt;:0
[1]+  Exit 1                  ./tamesi35a2_cs.exe --msgqueue 1117 durable 1116 durable &gt; ./tamesi35a2_cs.out.log 2&gt; ./tamesi35a2_cs.err.log &lt; /dev/null
</code></pre></div></div>

<p>動いてないぜ。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>PRECONDITION_FAILED - inequivalent arg 'durable' for queue '1116' in vhost '/': received 'true' but current is 'false'
</code></pre></div></div>

<p>こういうエラーなんだろうけど。</p>

<p>じゃあ false にしたらいいのか？</p>

<h1>
<span id="あるいはエンキューを別スレッドにするのがまだ残っている" class="fragment"></span><a href="#%E3%81%82%E3%82%8B%E3%81%84%E3%81%AF%E3%82%A8%E3%83%B3%E3%82%AD%E3%83%A5%E3%83%BC%E3%82%92%E5%88%A5%E3%82%B9%E3%83%AC%E3%83%83%E3%83%89%E3%81%AB%E3%81%99%E3%82%8B%E3%81%AE%E3%81%8C%E3%81%BE%E3%81%A0%E6%AE%8B%E3%81%A3%E3%81%A6%E3%81%84%E3%82%8B"><i class="fa fa-link"></i></a><strong>あるいは　エンキューを別スレッドにするのが　まだ残っている</strong>
</h1>

<h1>
<span id="その前に-visual-studio-2015-でやったら" class="fragment"></span><a href="#%E3%81%9D%E3%81%AE%E5%89%8D%E3%81%AB-visual-studio-2015-%E3%81%A7%E3%82%84%E3%81%A3%E3%81%9F%E3%82%89"><i class="fa fa-link"></i></a>その前に Visual Studio 2015 でやったら</h1>

<p>tamesi34_cs.exe</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>削除したいキューがあれば名前を、無ければ空文字列を入れろだぜ☆（＾～＾）
キュー名を入力    : キューを削除します
空文字列で[Enter] : 次のステップへ進む
Name or empty ? &gt;
エンキュー先のメッセージ・キューの名前を入れろだぜ☆（＾～＾）
Queue name? &gt; 1116
エンキュー先のメッセージ・キューの寿命を、足し算して答えろだぜ☆（＾～＾）
(1) durable    : RabbitMQが止まってもキューを残す
(2) autodelete : コンシューマーが１人も接続していなかったら消す
(4) passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ
(8) exclusive  : この接続でだけ使える。この接続が切れたら消す
Number ? &gt; 1
デキュー先のメッセージ・キューの名前を入れろだぜ☆（＾～＾）
Queue name? &gt; 1117
デキュー先のメッセージ・キューの寿命を、足し算して答えろだぜ☆（＾～＾）
(1) durable    : RabbitMQが止まってもキューを残す
(2) autodelete : コンシューマーが１人も接続していなかったら消す
(4) passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ
(8) exclusive  : この接続でだけ使える。この接続が切れたら消す
Number ? &gt; 1
tamesi34_cs.cs Dump
    name_queues         [ENQUEUE_INDEX]    =[1116]
    lifeSpan_queues     [ENQUEUE_INDEX]    =[Durable]
    durable_lifeSpans   [ENQUEUE_INDEX]    =[True]
    autodelete_lifeSpans[ENQUEUE_INDEX]    =[False]
    passive_lifeSpans   [ENQUEUE_INDEX]    =[False]
    exclusive_lifeSpans [ENQUEUE_INDEX]    =[False]
    ----
    name_queues         [DEQUEUE_INDEX]    =[1117]
    lifeSpan_queues     [DEQUEUE_INDEX]    =[Durable]
    durable_lifeSpans   [DEQUEUE_INDEX]    =[True]
    autodelete_lifeSpans[DEQUEUE_INDEX]    =[False]
    passive_lifeSpans   [DEQUEUE_INDEX]    =[False]
    exclusive_lifeSpans [DEQUEUE_INDEX]    =[False]
    ----
    name_queues         [DELETEQUEUE_INDEX]=[]
    lifeSpan_queues     [DELETEQUEUE_INDEX]=[0]
    durable_lifeSpans   [DELETEQUEUE_INDEX]=[False]
    autodelete_lifeSpans[DELETEQUEUE_INDEX]=[False]
    passive_lifeSpans   [DELETEQUEUE_INDEX]=[False]
    exclusive_lifeSpans [DELETEQUEUE_INDEX]=[False]
    ----

(tamesi34_cs.cs?) GetChannel index = [1]
    name_queues[index] = [1117]
    passive_lifeSpans[index] = [False]
    durable_lifeSpans[index] = [True]
    exclusive_lifeSpans[index] = [False]
    autodelete_lifeSpans[index] = [False]
    nowait は仮に false 固定
    arguments は仮に null 固定
終了するときは[Ctrl]+[C]キーを押せだぜ☆（＾～＾）
エンキューするときはメッセージを打ち込んで[Enter]キーを押せだぜ☆(＾◇＾)
Enqueue? &gt; usi
tamesi34_cs.cs Dump
    name_queues         [ENQUEUE_INDEX]    =[1116]
    lifeSpan_queues     [ENQUEUE_INDEX]    =[Durable]
    durable_lifeSpans   [ENQUEUE_INDEX]    =[True]
    autodelete_lifeSpans[ENQUEUE_INDEX]    =[False]
    passive_lifeSpans   [ENQUEUE_INDEX]    =[False]
    exclusive_lifeSpans [ENQUEUE_INDEX]    =[False]
    ----
    name_queues         [DEQUEUE_INDEX]    =[1117]
    lifeSpan_queues     [DEQUEUE_INDEX]    =[Durable]
    durable_lifeSpans   [DEQUEUE_INDEX]    =[True]
    autodelete_lifeSpans[DEQUEUE_INDEX]    =[False]
    passive_lifeSpans   [DEQUEUE_INDEX]    =[False]
    exclusive_lifeSpans [DEQUEUE_INDEX]    =[False]
    ----
    name_queues         [DELETEQUEUE_INDEX]=[]
    lifeSpan_queues     [DELETEQUEUE_INDEX]=[0]
    durable_lifeSpans   [DELETEQUEUE_INDEX]=[False]
    autodelete_lifeSpans[DELETEQUEUE_INDEX]=[False]
    passive_lifeSpans   [DELETEQUEUE_INDEX]=[False]
    exclusive_lifeSpans [DELETEQUEUE_INDEX]=[False]
    ----

(tamesi34_cs.cs?) GetChannel index = [0]
    name_queues[index] = [1116]
    passive_lifeSpans[index] = [False]
    durable_lifeSpans[index] = [True]
    exclusive_lifeSpans[index] = [False]
    autodelete_lifeSpans[index] = [False]
    nowait は仮に false 固定
    arguments は仮に null 固定
 Enqueue(^q^) usi
Enqueue? &gt; &lt;---- [interrupt!] Dequeue(^q^) usidaze
neko
tamesi34_cs.cs Dump
    name_queues         [ENQUEUE_INDEX]    =[1116]
    lifeSpan_queues     [ENQUEUE_INDEX]    =[Durable]
    durable_lifeSpans   [ENQUEUE_INDEX]    =[True]
    autodelete_lifeSpans[ENQUEUE_INDEX]    =[False]
    passive_lifeSpans   [ENQUEUE_INDEX]    =[False]
    exclusive_lifeSpans [ENQUEUE_INDEX]    =[False]
    ----
    name_queues         [DEQUEUE_INDEX]    =[1117]
    lifeSpan_queues     [DEQUEUE_INDEX]    =[Durable]
    durable_lifeSpans   [DEQUEUE_INDEX]    =[True]
    autodelete_lifeSpans[DEQUEUE_INDEX]    =[False]
    passive_lifeSpans   [DEQUEUE_INDEX]    =[False]
    exclusive_lifeSpans [DEQUEUE_INDEX]    =[False]
    ----
    name_queues         [DELETEQUEUE_INDEX]=[]
    lifeSpan_queues     [DELETEQUEUE_INDEX]=[0]
    durable_lifeSpans   [DELETEQUEUE_INDEX]=[False]
    autodelete_lifeSpans[DELETEQUEUE_INDEX]=[False]
    passive_lifeSpans   [DELETEQUEUE_INDEX]=[False]
    exclusive_lifeSpans [DELETEQUEUE_INDEX]=[False]
    ----

(tamesi34_cs.cs?) GetChannel index = [0]
    name_queues[index] = [1116]
    passive_lifeSpans[index] = [False]
    durable_lifeSpans[index] = [True]
    exclusive_lifeSpans[index] = [False]
    autodelete_lifeSpans[index] = [False]
    nowait は仮に false 固定
    arguments は仮に null 固定
 Enqueue(^q^) neko
Enqueue? &gt; &lt;---- [interrupt!] Dequeue(^q^) nekodaze
zou
tamesi34_cs.cs Dump
    name_queues         [ENQUEUE_INDEX]    =[1116]
    lifeSpan_queues     [ENQUEUE_INDEX]    =[Durable]
    durable_lifeSpans   [ENQUEUE_INDEX]    =[True]
    autodelete_lifeSpans[ENQUEUE_INDEX]    =[False]
    passive_lifeSpans   [ENQUEUE_INDEX]    =[False]
    exclusive_lifeSpans [ENQUEUE_INDEX]    =[False]
    ----
    name_queues         [DEQUEUE_INDEX]    =[1117]
    lifeSpan_queues     [DEQUEUE_INDEX]    =[Durable]
    durable_lifeSpans   [DEQUEUE_INDEX]    =[True]
    autodelete_lifeSpans[DEQUEUE_INDEX]    =[False]
    passive_lifeSpans   [DEQUEUE_INDEX]    =[False]
    exclusive_lifeSpans [DEQUEUE_INDEX]    =[False]
    ----
    name_queues         [DELETEQUEUE_INDEX]=[]
    lifeSpan_queues     [DELETEQUEUE_INDEX]=[0]
    durable_lifeSpans   [DELETEQUEUE_INDEX]=[False]
    autodelete_lifeSpans[DELETEQUEUE_INDEX]=[False]
    passive_lifeSpans   [DELETEQUEUE_INDEX]=[False]
    exclusive_lifeSpans [DELETEQUEUE_INDEX]=[False]
    ----

(tamesi34_cs.cs?) GetChannel index = [0]
    name_queues[index] = [1116]
    passive_lifeSpans[index] = [False]
    durable_lifeSpans[index] = [True]
    exclusive_lifeSpans[index] = [False]
    autodelete_lifeSpans[index] = [False]
    nowait は仮に false 固定
    arguments は仮に null 固定
 Enqueue(^q^) zou
Enqueue? &gt; &lt;---- [interrupt!] Dequeue(^q^) zoudaze
</code></pre></div></div>

<p>tamesi35a2_cs.exe</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>(0) name=[1117] lifeSpan=[Durable]
(1) name=[1116] lifeSpan=[Durable]
(tamesi35a2_cs.cs?) GetChannel index = [1]
    name_queues[index] = [1116]
    passive_lifeSpans[index] = [False]
    durable_lifeSpans[index] = [True]
    exclusive_lifeSpans[index] = [False]
    autodelete_lifeSpans[index] = [False]
    nowait は仮に false 固定
    arguments は仮に null 固定
(tamesi35a2_cs.cs?) GetChannel index = [0]
    name_queues[index] = [1117]
    passive_lifeSpans[index] = [False]
    durable_lifeSpans[index] = [True]
    exclusive_lifeSpans[index] = [False]
    autodelete_lifeSpans[index] = [False]
    nowait は仮に false 固定
    arguments は仮に null 固定
(tamesi35a2_cs.cs?) GetChannel index = [0]
    name_queues[index] = [1117]
    passive_lifeSpans[index] = [False]
    durable_lifeSpans[index] = [True]
    exclusive_lifeSpans[index] = [False]
    autodelete_lifeSpans[index] = [False]
    nowait は仮に false 固定
    arguments は仮に null 固定
(tamesi35a2_cs.cs?) GetChannel index = [0]
    name_queues[index] = [1117]
    passive_lifeSpans[index] = [False]
    durable_lifeSpans[index] = [True]
    exclusive_lifeSpans[index] = [False]
    autodelete_lifeSpans[index] = [False]
    nowait は仮に false 固定
    arguments は仮に null 固定
</code></pre></div></div>

<p>Windows10 なら動いてるのにな。</p>

<p>これを Ubuntu16.04 で実行すると</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>root@tk2-217-18401:/home/★user/shogi/csharp_service# rm tamesi34_cs.cs
root@tk2-217-18401:/home/★user/shogi/csharp_service# nano tamesi34_cs.cs
root@tk2-217-18401:/home/★user/shogi/csharp_service# rm tamesi35a2_cs.cs
root@tk2-217-18401:/home/★user/shogi/csharp_service# nano tamesi35a2_cs.cs
root@tk2-217-18401:/home/★user/shogi/csharp_service# mcs /r:RabbitMQ.Client.dll -define:UBUNTU tamesi34_cs.cs
root@tk2-217-18401:/home/★user/shogi/csharp_service# mcs /r:RabbitMQ.Client.dll -define:UBUNTU tamesi35a2_cs.cs
root@tk2-217-18401:/home/★user/shogi/csharp_service# ./tamesi35a2_cs.exe --msgqueue 1117 durable 1116 durable &gt; ./tamesi35a2_cs.out.log 2&gt; ./tamesi35a2_cs.err.log &lt; /dev/null &amp;
[1] 31008
root@tk2-217-18401:/home/★user/shogi/csharp_service# ./tamesi34_cs.exe 2&gt; ./tamesi34_cs.err.log
削除したいキューがあれば名前を、無ければ空文字列を入れろだぜ☆（＾～＾）
キュー名を入力    : キューを削除します
空文字列で[Enter] : 次のステップへ進む
Name or empty ? &gt;
エンキュー先のメッセージ・キューの名前を入れろだぜ☆（＾～＾）
Queue name? &gt; 1116
エンキュー先のメッセージ・キューの寿命を、足し算して答えろだぜ☆（＾～＾）
(1) durable    : RabbitMQが止まってもキューを残す
(2) autodelete : コンシューマーが１人も接続していなかったら消す
(4) passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ
(8) exclusive  : この接続でだけ使える。この接続が切れたら消す
Number ? &gt; 1
デキュー先のメッセージ・キューの名前を入れろだぜ☆（＾～＾）
Queue name? &gt; 1117
デキュー先のメッセージ・キューの寿命を、足し算して答えろだぜ☆（＾～＾）
(1) durable    : RabbitMQが止まってもキューを残す
(2) autodelete : コンシューマーが１人も接続していなかったら消す
(4) passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ
(8) exclusive  : この接続でだけ使える。この接続が切れたら消す
Number ? &gt; 1
tamesi34_cs.cs Dump
    name_queues         [ENQUEUE_INDEX]    =[1116]
    lifeSpan_queues     [ENQUEUE_INDEX]    =[Durable]
    durable_lifeSpans   [ENQUEUE_INDEX]    =[True]
    autodelete_lifeSpans[ENQUEUE_INDEX]    =[False]
    passive_lifeSpans   [ENQUEUE_INDEX]    =[False]
    exclusive_lifeSpans [ENQUEUE_INDEX]    =[False]
    ----
    name_queues         [DEQUEUE_INDEX]    =[1117]
    lifeSpan_queues     [DEQUEUE_INDEX]    =[Durable]
    durable_lifeSpans   [DEQUEUE_INDEX]    =[True]
    autodelete_lifeSpans[DEQUEUE_INDEX]    =[False]
    passive_lifeSpans   [DEQUEUE_INDEX]    =[False]
    exclusive_lifeSpans [DEQUEUE_INDEX]    =[False]
    ----
    name_queues         [DELETEQUEUE_INDEX]=[]
    lifeSpan_queues     [DELETEQUEUE_INDEX]=[0]
    durable_lifeSpans   [DELETEQUEUE_INDEX]=[False]
    autodelete_lifeSpans[DELETEQUEUE_INDEX]=[False]
    passive_lifeSpans   [DELETEQUEUE_INDEX]=[False]
    exclusive_lifeSpans [DELETEQUEUE_INDEX]=[False]
    ----

(tamesi34_cs.cs?) GetChannel index = [1]
    name_queues[index] = [1117]
    passive_lifeSpans[index] = [False]
    durable_lifeSpans[index] = [True]
    exclusive_lifeSpans[index] = [False]
    autodelete_lifeSpans[index] = [False]
    nowait は仮に false 固定
    arguments は仮に null 固定
終了するときは[Ctrl]+[C]キーを押せだぜ☆（＾～＾）
エンキューするときはメッセージを打ち込んで[Enter]キーを押せだぜ☆(＾◇＾)
Enqueue? &gt; usi
tamesi34_cs.cs Dump
    name_queues         [ENQUEUE_INDEX]    =[1116]
    lifeSpan_queues     [ENQUEUE_INDEX]    =[Durable]
    durable_lifeSpans   [ENQUEUE_INDEX]    =[True]
    autodelete_lifeSpans[ENQUEUE_INDEX]    =[False]
    passive_lifeSpans   [ENQUEUE_INDEX]    =[False]
    exclusive_lifeSpans [ENQUEUE_INDEX]    =[False]
    ----
    name_queues         [DEQUEUE_INDEX]    =[1117]
    lifeSpan_queues     [DEQUEUE_INDEX]    =[Durable]
    durable_lifeSpans   [DEQUEUE_INDEX]    =[True]
    autodelete_lifeSpans[DEQUEUE_INDEX]    =[False]
    passive_lifeSpans   [DEQUEUE_INDEX]    =[False]
    exclusive_lifeSpans [DEQUEUE_INDEX]    =[False]
    ----
    name_queues         [DELETEQUEUE_INDEX]=[]
    lifeSpan_queues     [DELETEQUEUE_INDEX]=[0]
    durable_lifeSpans   [DELETEQUEUE_INDEX]=[False]
    autodelete_lifeSpans[DELETEQUEUE_INDEX]=[False]
    passive_lifeSpans   [DELETEQUEUE_INDEX]=[False]
    exclusive_lifeSpans [DELETEQUEUE_INDEX]=[False]
    ----

(tamesi34_cs.cs?) GetChannel index = [0]
    name_queues[index] = [1116]
    passive_lifeSpans[index] = [False]
    durable_lifeSpans[index] = [True]
    exclusive_lifeSpans[index] = [False]
    autodelete_lifeSpans[index] = [False]
    nowait は仮に false 固定
    arguments は仮に null 固定
[1]+  Exit 1                  ./tamesi35a2_cs.exe --msgqueue 1117 durable 1116 durable &gt; ./tamesi35a2_cs.out.log 2&gt; ./tamesi35a2_cs.err.log &lt; /dev/null
</code></pre></div></div>

<p><strong>プログラム以外の理由で落ちてるのか？</strong></p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code># rabbitmq-server
ERROR: node with name "rabbit" already running on "tk2-217-18401"
</code></pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code># nano tamesi34_cs.err.log
</code></pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>Unhandled Exception:
RabbitMQ.Client.Exceptions.OperationInterruptedException: The AMQP operation was interrupted: AMQP close-reason, initiated by Peer, code=406, text="PRECONDITION_FAILED - inequivalent arg 'durable' for queue '1116' in vhost '/': receiv$
  at RabbitMQ.Client.Impl.SimpleBlockingRpcContinuation.GetReply () &lt;0x40d35fd0 + 0x00103&gt; in &lt;filename unknown&gt;:0
  at RabbitMQ.Client.Impl.ModelBase.ModelRpc (RabbitMQ.Client.Impl.MethodBase method, RabbitMQ.Client.Impl.ContentHeaderBase header, System.Byte[] body) &lt;0x40d33da0 + 0x000f9&gt; in &lt;filename unknown&gt;:0
  at RabbitMQ.Client.Framing.Impl.v0_8.Model.QueueDeclare (System.String queue, Boolean passive, Boolean durable, Boolean exclusive, Boolean autoDelete, Boolean nowait, IDictionary arguments) &lt;0x40d38f30 + 0x00113&gt; in &lt;filename unknow$
  at UsagiMQ.Program.GetChannel (Int32 index) &lt;0x40cf98c0 + 0x0045c&gt; in &lt;filename unknown&gt;:0
  at UsagiMQ.Program.Enqueue (System.String message) &lt;0x40d3a030 + 0x00013&gt; in &lt;filename unknown&gt;:0
  at UsagiMQ.Program.Main (System.String[] args) &lt;0x40cf4d50 + 0x009a7&gt; in &lt;filename unknown&gt;:0
[ERROR] FATAL UNHANDLED EXCEPTION: RabbitMQ.Client.Exceptions.OperationInterruptedException: The AMQP operation was interrupted: AMQP close-reason, initiated by Peer, code=406, text="PRECONDITION_FAILED - inequivalent arg 'durable' fo$
  at RabbitMQ.Client.Impl.SimpleBlockingRpcContinuation.GetReply () &lt;0x40d35fd0 + 0x00103&gt; in &lt;filename unknown&gt;:0
  at RabbitMQ.Client.Impl.ModelBase.ModelRpc (RabbitMQ.Client.Impl.MethodBase method, RabbitMQ.Client.Impl.ContentHeaderBase header, System.Byte[] body) &lt;0x40d33da0 + 0x000f9&gt; in &lt;filename unknown&gt;:0
  at RabbitMQ.Client.Framing.Impl.v0_8.Model.QueueDeclare (System.String queue, Boolean passive, Boolean durable, Boolean exclusive, Boolean autoDelete, Boolean nowait, IDictionary arguments) &lt;0x40d38f30 + 0x00113&gt; in &lt;filename unknow$
  at UsagiMQ.Program.GetChannel (Int32 index) &lt;0x40cf98c0 + 0x0045c&gt; in &lt;filename unknown&gt;:0
  at UsagiMQ.Program.Enqueue (System.String message) &lt;0x40d3a030 + 0x00013&gt; in &lt;filename unknown&gt;:0
  at UsagiMQ.Program.Main (System.String[] args) &lt;0x40cf4d50 + 0x009a7&gt; in &lt;filename unknown&gt;:0

</code></pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code># nano tamesi35a2_cs.err.log
</code></pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>(tamesi35a2_cs.cs?) GetChannel index = [1]
    name_queues[index] = [1116]
    passive_lifeSpans[index] = [False]
    durable_lifeSpans[index] = [True]
    exclusive_lifeSpans[index] = [False]
    autodelete_lifeSpans[index] = [False]
    nowait は仮に false 固定
    arguments は仮に null 固定

Unhandled Exception:
RabbitMQ.Client.Exceptions.OperationInterruptedException: The AMQP operation was interrupted: AMQP close-reason, initiated by Peer, code=406, text="PRECONDITION_FAILED - inequivalent arg 'durable' for queue '1116' in vhost '/': received 'true' but current is 'f$
  at RabbitMQ.Client.Impl.SimpleBlockingRpcContinuation.GetReply () &lt;0x41f435b0 + 0x00107&gt; in &lt;filename unknown&gt;:0
  at RabbitMQ.Client.Impl.ModelBase.ModelRpc (RabbitMQ.Client.Impl.MethodBase method, RabbitMQ.Client.Impl.ContentHeaderBase header, System.Byte[] body) &lt;0x41f413f0 + 0x00101&gt; in &lt;filename unknown&gt;:0
  at RabbitMQ.Client.Framing.Impl.v0_8.Model.QueueDeclare (System.String queue, Boolean passive, Boolean durable, Boolean exclusive, Boolean autoDelete, Boolean nowait, IDictionary arguments) &lt;0x41f45790 + 0x00113&gt; in &lt;filename unknown&gt;:0
  at Program.GetChannel (Int32 index) &lt;0x41f05890 + 0x00436&gt; in &lt;filename unknown&gt;:0
  at Program.StartConsume () &lt;0x41f057d0 + 0x0000f&gt; in &lt;filename unknown&gt;:0
  at Program.Main (System.String[] args) &lt;0x41f03270 + 0x0037b&gt; in &lt;filename unknown&gt;:0
[ERROR] FATAL UNHANDLED EXCEPTION: RabbitMQ.Client.Exceptions.OperationInterruptedException: The AMQP operation was interrupted: AMQP close-reason, initiated by Peer, code=406, text="PRECONDITION_FAILED - inequivalent arg 'durable' for queue '1116' in vhost '/'$
  at RabbitMQ.Client.Impl.SimpleBlockingRpcContinuation.GetReply () &lt;0x41f435b0 + 0x00107&gt; in &lt;filename unknown&gt;:0
  at RabbitMQ.Client.Impl.ModelBase.ModelRpc (RabbitMQ.Client.Impl.MethodBase method, RabbitMQ.Client.Impl.ContentHeaderBase header, System.Byte[] body) &lt;0x41f413f0 + 0x00101&gt; in &lt;filename unknown&gt;:0
  at RabbitMQ.Client.Framing.Impl.v0_8.Model.QueueDeclare (System.String queue, Boolean passive, Boolean durable, Boolean exclusive, Boolean autoDelete, Boolean nowait, IDictionary arguments) &lt;0x41f45790 + 0x00113&gt; in &lt;filename unknown&gt;:0
  at Program.GetChannel (Int32 index) &lt;0x41f05890 + 0x00436&gt; in &lt;filename unknown&gt;:0
  at Program.StartConsume () &lt;0x41f057d0 + 0x0000f&gt; in &lt;filename unknown&gt;:0
  at Program.Main (System.String[] args) &lt;0x41f03270 + 0x0037b&gt; in &lt;filename unknown&gt;:0
</code></pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code># nano tamesi35a2_cs.out.log
</code></pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>(0) name=[1117] lifeSpan=[Durable]
(1) name=[1116] lifeSpan=[Durable]
</code></pre></div></div>

<p>うーむ、</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>RabbitMQ.Client.Framing.Impl.v0_8.Model.QueueDeclare (System.String queue, Boolean passive, Boolean durable, Boolean exclusive, Boolean autoDelete, Boolean nowait, IDictionary arguments)
</code></pre></div></div>

<p>この引数の順序はあってるんだろうか？</p>

<p>順序はあってるし、どうも UBUNTU だと false と言ってくる。 UBUNTU のときだけ全部 false にしてみるか？</p>

<h1>
<span id="ubuntuのときだけ引数をfalse-にするとどうか" class="fragment"></span><a href="#ubuntu%E3%81%AE%E3%81%A8%E3%81%8D%E3%81%A0%E3%81%91%E5%BC%95%E6%95%B0%E3%82%92false-%E3%81%AB%E3%81%99%E3%82%8B%E3%81%A8%E3%81%A9%E3%81%86%E3%81%8B"><i class="fa fa-link"></i></a>UBUNTUのときだけ引数をfalse にするとどうか？</h1>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>root@tk2-217-18401:/home/★user/shogi/csharp_service# ./tamesi35a2_cs.exe --msgqueue 1117 durable 1116 durable &gt; ./tamesi35a2_cs.out.log 2&gt; ./tamesi35a2_cs.err.log &lt; /dev/null &amp;
[3] 31371
root@tk2-217-18401:/home/★user/shogi/csharp_service# ./tamesi34_cs.exe 2&gt; ./tamesi34_cs.err.log
削除したいキューがあれば名前を、無ければ空文字列を入れろだぜ☆（＾～＾）
キュー名を入力    : キューを削除します
空文字列で[Enter] : 次のステップへ進む
Name or empty ? &gt;
エンキュー先のメッセージ・キューの名前を入れろだぜ☆（＾～＾）
Queue name? &gt; 1116
エンキュー先のメッセージ・キューの寿命を、足し算して答えろだぜ☆（＾～＾）
(1) durable    : RabbitMQが止まってもキューを残す
(2) autodelete : コンシューマーが１人も接続していなかったら消す
(4) passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ
(8) exclusive  : この接続でだけ使える。この接続が切れたら消す
Number ? &gt; 1
デキュー先のメッセージ・キューの名前を入れろだぜ☆（＾～＾）
Queue name? &gt; 1117
デキュー先のメッセージ・キューの寿命を、足し算して答えろだぜ☆（＾～＾）
(1) durable    : RabbitMQが止まってもキューを残す
(2) autodelete : コンシューマーが１人も接続していなかったら消す
(4) passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ
(8) exclusive  : この接続でだけ使える。この接続が切れたら消す
Number ? &gt; 1
tamesi34_cs.cs Dump
    name_queues         [ENQUEUE_INDEX]    =[1116]
    lifeSpan_queues     [ENQUEUE_INDEX]    =[Durable]
    durable_lifeSpans   [ENQUEUE_INDEX]    =[True]
    autodelete_lifeSpans[ENQUEUE_INDEX]    =[False]
    passive_lifeSpans   [ENQUEUE_INDEX]    =[False]
    exclusive_lifeSpans [ENQUEUE_INDEX]    =[False]
    ----
    name_queues         [DEQUEUE_INDEX]    =[1117]
    lifeSpan_queues     [DEQUEUE_INDEX]    =[Durable]
    durable_lifeSpans   [DEQUEUE_INDEX]    =[True]
    autodelete_lifeSpans[DEQUEUE_INDEX]    =[False]
    passive_lifeSpans   [DEQUEUE_INDEX]    =[False]
    exclusive_lifeSpans [DEQUEUE_INDEX]    =[False]
    ----
    name_queues         [DELETEQUEUE_INDEX]=[]
    lifeSpan_queues     [DELETEQUEUE_INDEX]=[0]
    durable_lifeSpans   [DELETEQUEUE_INDEX]=[False]
    autodelete_lifeSpans[DELETEQUEUE_INDEX]=[False]
    passive_lifeSpans   [DELETEQUEUE_INDEX]=[False]
    exclusive_lifeSpans [DELETEQUEUE_INDEX]=[False]
    ----

(tamesi34_cs.cs?) GetChannel index = [1]
    name_queues[index] = [1117]
    passive_lifeSpans[index] = [False]
    durable_lifeSpans[index] = [True]
    exclusive_lifeSpans[index] = [False]
    autodelete_lifeSpans[index] = [False]
    nowait は仮に false 固定
    arguments は仮に null 固定
終了するときは[Ctrl]+[C]キーを押せだぜ☆（＾～＾）
エンキューするときはメッセージを打ち込んで[Enter]キーを押せだぜ☆(＾◇＾)
Enqueue? &gt; usi
tamesi34_cs.cs Dump
    name_queues         [ENQUEUE_INDEX]    =[1116]
    lifeSpan_queues     [ENQUEUE_INDEX]    =[Durable]
    durable_lifeSpans   [ENQUEUE_INDEX]    =[True]
    autodelete_lifeSpans[ENQUEUE_INDEX]    =[False]
    passive_lifeSpans   [ENQUEUE_INDEX]    =[False]
    exclusive_lifeSpans [ENQUEUE_INDEX]    =[False]
    ----
    name_queues         [DEQUEUE_INDEX]    =[1117]
    lifeSpan_queues     [DEQUEUE_INDEX]    =[Durable]
    durable_lifeSpans   [DEQUEUE_INDEX]    =[True]
    autodelete_lifeSpans[DEQUEUE_INDEX]    =[False]
    passive_lifeSpans   [DEQUEUE_INDEX]    =[False]
    exclusive_lifeSpans [DEQUEUE_INDEX]    =[False]
    ----
    name_queues         [DELETEQUEUE_INDEX]=[]
    lifeSpan_queues     [DELETEQUEUE_INDEX]=[0]
    durable_lifeSpans   [DELETEQUEUE_INDEX]=[False]
    autodelete_lifeSpans[DELETEQUEUE_INDEX]=[False]
    passive_lifeSpans   [DELETEQUEUE_INDEX]=[False]
    exclusive_lifeSpans [DELETEQUEUE_INDEX]=[False]
    ----

(tamesi34_cs.cs?) GetChannel index = [0]
    name_queues[index] = [1116]
    passive_lifeSpans[index] = [False]
    durable_lifeSpans[index] = [True]
    exclusive_lifeSpans[index] = [False]
    autodelete_lifeSpans[index] = [False]
    nowait は仮に false 固定
    arguments は仮に null 固定
[3]   Exit 1                  ./tamesi35a2_cs.exe --msgqueue 1117 durable 1116 durable &gt; ./tamesi35a2_cs.out.log 2&gt; ./tamesi35a2_cs.err.log &lt; /dev/null
</code></pre></div></div>

<p>落ちているようだ。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>(tamesi35a2_cs.cs?) GetChannel index = [1]
    name_queues[index] = [1116]
    passive_lifeSpans[index] = [False]
    durable_lifeSpans[index] = [True]
    exclusive_lifeSpans[index] = [False]
    autodelete_lifeSpans[index] = [False]
    nowait は仮に false 固定
    arguments は仮に null 固定

Unhandled Exception:
RabbitMQ.Client.Exceptions.OperationInterruptedException: The AMQP operation was interrupted: AMQP close-reason, initiated by Peer, code=406, text="PRECONDITION_FAILED - inequivalent arg 'durable' for queue '1116' in vhost '/': re$
  at RabbitMQ.Client.Impl.SimpleBlockingRpcContinuation.GetReply () &lt;0x403416a0 + 0x00107&gt; in &lt;filename unknown&gt;:0
  at RabbitMQ.Client.Impl.ModelBase.ModelRpc (RabbitMQ.Client.Impl.MethodBase method, RabbitMQ.Client.Impl.ContentHeaderBase header, System.Byte[] body) &lt;0x4033f520 + 0x000fd&gt; in &lt;filename unknown&gt;:0
  at RabbitMQ.Client.Framing.Impl.v0_8.Model.QueueDeclare (System.String queue, Boolean passive, Boolean durable, Boolean exclusive, Boolean autoDelete, Boolean nowait, IDictionary arguments) &lt;0x40343880 + 0x00113&gt; in &lt;filename un$
  at Program.GetChannel (Int32 index) &lt;0x40303890 + 0x00436&gt; in &lt;filename unknown&gt;:0
  at Program.StartConsume () &lt;0x403037d0 + 0x0000f&gt; in &lt;filename unknown&gt;:0
  at Program.Main (System.String[] args) &lt;0x40301270 + 0x0037b&gt; in &lt;filename unknown&gt;:0
[ERROR] FATAL UNHANDLED EXCEPTION: RabbitMQ.Client.Exceptions.OperationInterruptedException: The AMQP operation was interrupted: AMQP close-reason, initiated by Peer, code=406, text="PRECONDITION_FAILED - inequivalent arg 'durable$
  at RabbitMQ.Client.Impl.SimpleBlockingRpcContinuation.GetReply () &lt;0x403416a0 + 0x00107&gt; in &lt;filename unknown&gt;:0
  at RabbitMQ.Client.Impl.ModelBase.ModelRpc (RabbitMQ.Client.Impl.MethodBase method, RabbitMQ.Client.Impl.ContentHeaderBase header, System.Byte[] body) &lt;0x4033f520 + 0x000fd&gt; in &lt;filename unknown&gt;:0
  at RabbitMQ.Client.Framing.Impl.v0_8.Model.QueueDeclare (System.String queue, Boolean passive, Boolean durable, Boolean exclusive, Boolean autoDelete, Boolean nowait, IDictionary arguments) &lt;0x40343880 + 0x00113&gt; in &lt;filename un$
  at Program.GetChannel (Int32 index) &lt;0x40303890 + 0x00436&gt; in &lt;filename unknown&gt;:0
  at Program.StartConsume () &lt;0x403037d0 + 0x0000f&gt; in &lt;filename unknown&gt;:0
  at Program.Main (System.String[] args) &lt;0x40301270 + 0x0037b&gt; in &lt;filename unknown&gt;:0
</code></pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>RabbitMQ.Client.Exceptions.OperationInterruptedException
</code></pre></div></div>

<p>というのは、どういうエラーなのか？</p>

<p>（public class OperationInterruptedException）「www.rabbitmq.com」<br>
<a href="https://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v2.8.6/rabbitmq-dotnet-client-2.8.6-client-htmldoc/html/type-RabbitMQ.Client.Exceptions.OperationInterruptedException.html" class="autolink" rel="nofollow noopener" target="_blank">https://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v2.8.6/rabbitmq-dotnet-client-2.8.6-client-htmldoc/html/type-RabbitMQ.Client.Exceptions.OperationInterruptedException.html</a></p>

<p>Ubuntu16.04 だと、TCP接続がなぜ切れるのか？</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>Console.WriteLine( "("+i+") name=["+ name_queues[i] + "] lifeSpan=["+ lifeSpan_queues[i] + "]");
</code></pre></div></div>

<p>こういうテスト用の標準出力を全部　コメントアウトしてみよう。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>終了するときは[Ctrl]+[C]キーを押せだぜ☆（＾～＾）
エンキューするときはメッセージを打ち込んで[Enter]キーを押せだぜ☆(＾◇＾)
Enqueue? &gt; usi
tamesi34_cs.cs Dump
    name_queues         [ENQUEUE_INDEX]    =[1116]
    lifeSpan_queues     [ENQUEUE_INDEX]    =[Durable]
    durable_lifeSpans   [ENQUEUE_INDEX]    =[True]
    autodelete_lifeSpans[ENQUEUE_INDEX]    =[False]
    passive_lifeSpans   [ENQUEUE_INDEX]    =[False]
    exclusive_lifeSpans [ENQUEUE_INDEX]    =[False]
    ----
    name_queues         [DEQUEUE_INDEX]    =[1117]
    lifeSpan_queues     [DEQUEUE_INDEX]    =[Durable]
    durable_lifeSpans   [DEQUEUE_INDEX]    =[True]
    autodelete_lifeSpans[DEQUEUE_INDEX]    =[False]
    passive_lifeSpans   [DEQUEUE_INDEX]    =[False]
    exclusive_lifeSpans [DEQUEUE_INDEX]    =[False]
    ----
    name_queues         [DELETEQUEUE_INDEX]=[]
    lifeSpan_queues     [DELETEQUEUE_INDEX]=[0]
    durable_lifeSpans   [DELETEQUEUE_INDEX]=[False]
    autodelete_lifeSpans[DELETEQUEUE_INDEX]=[False]
    passive_lifeSpans   [DELETEQUEUE_INDEX]=[False]
    exclusive_lifeSpans [DELETEQUEUE_INDEX]=[False]
    ----

(tamesi34_cs.cs?) GetChannel index = [0]
    name_queues[index] = [1116]
    passive_lifeSpans[index] = [False]
    durable_lifeSpans[index] = [True]
    exclusive_lifeSpans[index] = [False]
    autodelete_lifeSpans[index] = [False]
    nowait は仮に false 固定
    arguments は仮に null 固定
[3]   Exit 1                  ./tamesi35a2_cs.exe --msgqueue 1117 durable 1116 durable &gt; ./tamesi35a2_cs.out.log 2&gt; ./tamesi35a2_cs.err.log &lt; /dev/null
</code></pre></div></div>

<p>それでもダメ。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>received 'true' but current is 'false'", classId=50, methodId=10, cause=
</code></pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>received 'true' but current is 'false'", classId=50, methodId=10, cause=
</code></pre></div></div>

<p>うーむ。</p>

<h1>
<span id="ググろう" class="fragment"></span><a href="#%E3%82%B0%E3%82%B0%E3%82%8D%E3%81%86"><i class="fa fa-link"></i></a>ググろう</h1>

<p>「PRECONDITION_FAILED - inequivalent arg 'durable' for queue #370」（MassTransit/MassTransit）<br>
<a href="https://github.com/MassTransit/MassTransit/issues/370" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/MassTransit/MassTransit/issues/370</a></p>

<p>「Issue in establishing connection with Rabbit MQ」（stack overflow）<br>
<a href="http://stackoverflow.com/questions/31762563/issue-in-establishing-connection-with-rabbit-mq" class="autolink" rel="nofollow noopener" target="_blank">http://stackoverflow.com/questions/31762563/issue-in-establishing-connection-with-rabbit-mq</a></p>

<p>「Correct config using rabbitmq as celery backend」（stack overflow）<br>
<a href="http://stackoverflow.com/questions/27623940/correct-config-using-rabbitmq-as-celery-backend" class="autolink" rel="nofollow noopener" target="_blank">http://stackoverflow.com/questions/27623940/correct-config-using-rabbitmq-as-celery-backend</a></p>

<h1>
<span id="複数指定したい" class="fragment"></span><a href="#%E8%A4%87%E6%95%B0%E6%8C%87%E5%AE%9A%E3%81%97%E3%81%9F%E3%81%84"><i class="fa fa-link"></i></a>複数指定したい</h1>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>--msgqueue 1117 durable 1116 durable
</code></pre></div></div>

<p>これを、</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>--enqueue durable autodelete --dequeue durable autodelete
</code></pre></div></div>

<p>みたいに、複数指定できるようにしたい。</p>

<p>こんな感じだろうか。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre><code><span class="c1">//--------------------------------------------------------------------------------</span>
<span class="c1">// tamesi35a2_cs.cs</span>
<span class="c1">//</span>
<span class="c1">// メッセージの末尾に daze を付けます。</span>
<span class="c1">// 標準入出力は、キーボード、画面には接続しないようにします。</span>
<span class="c1">// キューの名前はコマンドライン引数で指定してください。</span>
<span class="c1">// デキューは割込みを受け付けます。</span>
<span class="c1">//--------------------------------------------------------------------------------</span>
<span class="c1">// OS  : Windows 10</span>
<span class="c1">// IDE : Visual Studio 2015</span>
<span class="c1">//       Install : NuGet   : Install-Package RabbitMQ.Client -Version 4.1.1</span>
<span class="c1">//       Execute : Command : ./tamesi35a2_cs.exe --enqueue 1117 durable --dequeue 1116 durable</span>
<span class="c1">//</span>
<span class="c1">// OS  : Ubuntu 16.04</span>
<span class="c1">//       Compile : Command : mcs /r:RabbitMQ.Client.dll -define:UBUNTU tamesi35a2_cs.cs</span>
<span class="c1">//       Execute : Command : // バックグラウンドで実行する</span>
<span class="c1">//                         : nohup ./tamesi35a2_cs.exe --enqueue 1117 durable autodelete --dequeue 1116 durable autodelete &gt; ./tamesi35a2_cs.out.log 2&gt; ./tamesi35a2_cs.err.log &lt; /dev/null &amp;</span>
<span class="c1">//       Check   :         : // tamesi33a1_cs.exe を使う</span>
<span class="c1">//--------------------------------------------------------------------------------</span>

<span class="c1">// Ubuntu の RabbitMQ はソースのバージョンが古いのか、API が異なった。</span>
<span class="c1">// #define UBUNTU</span>

<span class="k">using</span> <span class="nn">RabbitMQ.Client</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">RabbitMQ.Client.Events</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Text</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Threading</span><span class="p">;</span>

<span class="c1">/// &lt;summary&gt;</span>
<span class="c1">/// このプログラム内だけで使われる数字。AMQP-CPPでの実装とは異なる。</span>
<span class="c1">/// AMQP-CPPでの実装 : AMQP::durable=[1] AMQP::autodelete=[2] AMQP::passive=[8] AMQP::exclusive=[512]</span>
<span class="c1">/// &lt;/summary&gt;</span>
<span class="p">[</span><span class="n">Flags</span><span class="p">]</span>
<span class="k">enum</span> <span class="n">LifeSpanType</span>
<span class="p">{</span>
    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">/// RabbitMQが止まってもキューを残す</span>
    <span class="c1">/// &lt;/summary&gt;</span>
    <span class="n">Durable</span> <span class="p">=</span> <span class="m">1</span><span class="p">,</span>
    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">/// コンシューマーが１人も接続していなかったら消す</span>
    <span class="c1">/// &lt;/summary&gt;</span>
    <span class="n">Autodelete</span> <span class="p">=</span> <span class="m">0x1</span> <span class="p">&lt;&lt;</span> <span class="m">1</span><span class="p">,</span>
    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">/// キューが存在するかどうかチェックするだけ。中身見ない時これ</span>
    <span class="c1">/// &lt;/summary&gt;</span>
    <span class="n">Passive</span> <span class="p">=</span> <span class="m">0x1</span> <span class="p">&lt;&lt;</span> <span class="m">2</span><span class="p">,</span>
    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">/// この接続でだけ使える。この接続が切れたら消す</span>
    <span class="c1">/// &lt;/summary&gt;</span>
    <span class="n">Exclusive</span> <span class="p">=</span> <span class="m">0x1</span> <span class="p">&lt;&lt;</span> <span class="m">3</span>
<span class="p">}</span>

<span class="c1">/// &lt;summary&gt;</span>
<span class="c1">/// 参照 : QueueDeclare http://docs.spring.io/spring-amqp-net/docs/1.0.x/api/html/Spring.Messaging.Amqp.Rabbit~Spring.Messaging.Amqp.Rabbit.Connection.CachedModel~QueueDeclare(String,Boolean,Boolean,Boolean,Boolean,Boolean,IDictionary).html</span>
<span class="c1">/// 参照 : EventingBasicConsumer https://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v1.4.0/rabbitmq-dotnet-client-1.4.0-net-2.0-htmldoc/type-RabbitMQ.Client.Events.EventingBasicConsumer.html</span>
<span class="c1">/// 参照 : BasicConsume https://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v1.4.0/rabbitmq-dotnet-client-1.4.0-net-2.0-htmldoc/type-RabbitMQ.Client.IModel.html#method-M:RabbitMQ.Client.IModel.BasicConsume(System.UInt16,System.String,System.Boolean,System.Collections.IDictionary,RabbitMQ.Client.IBasicConsumer)</span>
<span class="c1">/// 参照 : C#でconstな配列を実現する (もっとクールにプログラミング) http://pgnote.net/?p=885</span>
<span class="c1">/// &lt;/summary&gt;</span>
<span class="k">class</span> <span class="nc">Program</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">ENQUEUE_INDEX</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">DEQUEUE_INDEX</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">NUM_INDEX</span> <span class="p">=</span> <span class="m">2</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">string</span> <span class="n">HOST_NAME</span> <span class="p">=</span> <span class="s">"localhost"</span><span class="p">;</span>
    <span class="k">static</span> <span class="kt">string</span><span class="p">[]</span> <span class="n">name_queues</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">string</span><span class="p">[</span><span class="n">NUM_INDEX</span><span class="p">];</span>
    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">/// キューの寿命（複合可能）</span>
    <span class="c1">/// durable    : RabbitMQが止まってもキューを残す</span>
    <span class="c1">/// autodelete : コンシューマーが１人も接続していなかったら消す</span>
    <span class="c1">/// passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ</span>
    <span class="c1">/// exclusive  : この接続でだけ使える。この接続が切れたら消す</span>
    <span class="c1">/// &lt;/summary&gt;</span>
    <span class="k">static</span> <span class="n">LifeSpanType</span><span class="p">[]</span> <span class="n">lifeSpan_queues</span> <span class="p">=</span> <span class="k">new</span> <span class="n">LifeSpanType</span><span class="p">[</span><span class="n">NUM_INDEX</span><span class="p">];</span>
    <span class="k">static</span> <span class="n">LifeSpanType</span> <span class="nf">LifeSpanString_To_Enum</span><span class="p">(</span><span class="kt">string</span> <span class="n">lifeSpan</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">switch</span> <span class="p">(</span><span class="n">lifeSpan</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">case</span> <span class="s">"durable"</span><span class="p">:</span> <span class="k">return</span> <span class="n">LifeSpanType</span><span class="p">.</span><span class="n">Durable</span><span class="p">;</span>
            <span class="k">case</span> <span class="s">"autodelete"</span><span class="p">:</span> <span class="k">return</span> <span class="n">LifeSpanType</span><span class="p">.</span><span class="n">Autodelete</span><span class="p">;</span>
            <span class="k">case</span> <span class="s">"passive"</span><span class="p">:</span> <span class="k">return</span> <span class="n">LifeSpanType</span><span class="p">.</span><span class="n">Passive</span><span class="p">;</span>
            <span class="k">case</span> <span class="s">"exclusive"</span><span class="p">:</span> <span class="k">return</span> <span class="n">LifeSpanType</span><span class="p">.</span><span class="n">Exclusive</span><span class="p">;</span>
            <span class="k">default</span><span class="p">:</span> <span class="k">throw</span> <span class="k">new</span> <span class="nf">Exception</span><span class="p">(</span><span class="s">"未対応のlifeSpan ["</span> <span class="p">+</span> <span class="n">lifeSpan</span> <span class="p">+</span> <span class="s">"]"</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">static</span> <span class="kt">bool</span><span class="p">[]</span>
        <span class="n">durable_lifeSpans</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">bool</span><span class="p">[</span><span class="n">NUM_INDEX</span><span class="p">],</span>
        <span class="n">autodelete_lifeSpans</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">bool</span><span class="p">[</span><span class="n">NUM_INDEX</span><span class="p">],</span>
        <span class="n">passive_lifeSpans</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">bool</span><span class="p">[</span><span class="n">NUM_INDEX</span><span class="p">],</span>
        <span class="n">exclusive_lifeSpans</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">bool</span><span class="p">[</span><span class="n">NUM_INDEX</span><span class="p">];</span>
    <span class="k">static</span> <span class="k">void</span> <span class="nf">SetLifeSpan</span><span class="p">(</span><span class="kt">int</span> <span class="n">index_queue</span><span class="p">,</span> <span class="kt">string</span> <span class="n">name_queue</span><span class="p">,</span> <span class="n">LifeSpanType</span> <span class="n">lifeSpan</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// 一旦クリアー</span>
        <span class="n">durable_lifeSpans</span><span class="p">[</span><span class="n">index_queue</span><span class="p">]</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
        <span class="n">autodelete_lifeSpans</span><span class="p">[</span><span class="n">index_queue</span><span class="p">]</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
        <span class="n">passive_lifeSpans</span><span class="p">[</span><span class="n">index_queue</span><span class="p">]</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
        <span class="n">exclusive_lifeSpans</span><span class="p">[</span><span class="n">index_queue</span><span class="p">]</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>

        <span class="c1">// durable</span>
        <span class="k">if</span> <span class="p">(((</span><span class="kt">int</span><span class="p">)</span><span class="n">lifeSpan</span> <span class="p">&amp;</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">LifeSpanType</span><span class="p">.</span><span class="n">Durable</span><span class="p">)</span> <span class="p">==</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">LifeSpanType</span><span class="p">.</span><span class="n">Durable</span><span class="p">)</span> <span class="p">{</span> <span class="n">durable_lifeSpans</span><span class="p">[</span><span class="n">index_queue</span><span class="p">]</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span> <span class="p">}</span>
        <span class="c1">// autodelete</span>
        <span class="k">if</span> <span class="p">(((</span><span class="kt">int</span><span class="p">)</span><span class="n">lifeSpan</span> <span class="p">&amp;</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">LifeSpanType</span><span class="p">.</span><span class="n">Autodelete</span><span class="p">)</span> <span class="p">==</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">LifeSpanType</span><span class="p">.</span><span class="n">Autodelete</span><span class="p">)</span> <span class="p">{</span> <span class="n">autodelete_lifeSpans</span><span class="p">[</span><span class="n">index_queue</span><span class="p">]</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span> <span class="p">}</span>
        <span class="c1">// passive</span>
        <span class="k">if</span> <span class="p">(((</span><span class="kt">int</span><span class="p">)</span><span class="n">lifeSpan</span> <span class="p">&amp;</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">LifeSpanType</span><span class="p">.</span><span class="n">Passive</span><span class="p">)</span> <span class="p">==</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">LifeSpanType</span><span class="p">.</span><span class="n">Passive</span><span class="p">)</span> <span class="p">{</span> <span class="n">passive_lifeSpans</span><span class="p">[</span><span class="n">index_queue</span><span class="p">]</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span> <span class="p">}</span>
        <span class="c1">// exclusive</span>
        <span class="k">if</span> <span class="p">(((</span><span class="kt">int</span><span class="p">)</span><span class="n">lifeSpan</span> <span class="p">&amp;</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">LifeSpanType</span><span class="p">.</span><span class="n">Exclusive</span><span class="p">)</span> <span class="p">==</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">LifeSpanType</span><span class="p">.</span><span class="n">Exclusive</span><span class="p">)</span> <span class="p">{</span> <span class="n">exclusive_lifeSpans</span><span class="p">[</span><span class="n">index_queue</span><span class="p">]</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// 回転式バッファー</span>
    <span class="k">static</span> <span class="n">RotationBuffer</span> <span class="n">rollingBuffer</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RotationBuffer</span><span class="p">();</span>

    <span class="k">static</span> <span class="n">ConnectionFactory</span> <span class="nf">GetFactory</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">null</span> <span class="p">==</span> <span class="n">m_factory_</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">m_factory_</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ConnectionFactory</span><span class="p">()</span> <span class="p">{</span> <span class="n">HostName</span> <span class="p">=</span> <span class="n">HOST_NAME</span> <span class="p">};</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">m_factory_</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">static</span> <span class="n">ConnectionFactory</span> <span class="n">m_factory_</span><span class="p">;</span>

    <span class="k">static</span> <span class="n">IConnection</span> <span class="nf">GetConnection</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">null</span> <span class="p">==</span> <span class="n">m_connection_</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">m_connection_</span> <span class="p">=</span> <span class="nf">GetFactory</span><span class="p">().</span><span class="nf">CreateConnection</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">m_connection_</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">static</span> <span class="n">IConnection</span> <span class="n">m_connection_</span><span class="p">;</span>

    <span class="k">static</span> <span class="kt">bool</span> <span class="nf">IsConnected</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">null</span> <span class="p">!=</span> <span class="n">m_connection_</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">m_connection_</span><span class="p">.</span><span class="n">IsOpen</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">static</span> <span class="n">IModel</span> <span class="nf">GetChannel</span><span class="p">(</span><span class="kt">int</span> <span class="n">index</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">null</span> <span class="p">==</span> <span class="n">m_channels_</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
        <span class="p">{</span>
            <span class="n">m_channels_</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">=</span> <span class="nf">GetConnection</span><span class="p">().</span><span class="nf">CreateModel</span><span class="p">();</span>

            <span class="c1">// 引数が7つの QueueDeclare でエラーを吐くことがあるので、情報を出力しておく。</span>
            <span class="n">Console</span><span class="p">.</span><span class="n">Error</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"(tamesi35a2_cs.cs?) GetChannel index = ["</span> <span class="p">+</span> <span class="n">index</span> <span class="p">+</span> <span class="s">"]"</span><span class="p">);</span>
            <span class="n">Console</span><span class="p">.</span><span class="n">Error</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"    name_queues[index] = ["</span> <span class="p">+</span> <span class="n">name_queues</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">+</span> <span class="s">"]"</span><span class="p">);</span>
            <span class="n">Console</span><span class="p">.</span><span class="n">Error</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"    passive_lifeSpans[index] = ["</span> <span class="p">+</span> <span class="n">passive_lifeSpans</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">+</span> <span class="s">"]"</span><span class="p">);</span>
            <span class="n">Console</span><span class="p">.</span><span class="n">Error</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"    durable_lifeSpans[index] = ["</span> <span class="p">+</span> <span class="n">durable_lifeSpans</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">+</span> <span class="s">"]"</span><span class="p">);</span>
            <span class="n">Console</span><span class="p">.</span><span class="n">Error</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"    exclusive_lifeSpans[index] = ["</span> <span class="p">+</span> <span class="n">exclusive_lifeSpans</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">+</span> <span class="s">"]"</span><span class="p">);</span>
            <span class="n">Console</span><span class="p">.</span><span class="n">Error</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"    autodelete_lifeSpans[index] = ["</span> <span class="p">+</span> <span class="n">autodelete_lifeSpans</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">+</span> <span class="s">"]"</span><span class="p">);</span>
            <span class="n">Console</span><span class="p">.</span><span class="n">Error</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"    nowait は仮に false 固定"</span><span class="p">);</span>
            <span class="n">Console</span><span class="p">.</span><span class="n">Error</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"    arguments は仮に null 固定"</span><span class="p">);</span>

<span class="cp">#if UBUNTU
</span>            <span class="c1">// Ubuntuでは何故か Spring.Messaging.Amqp.Rabbit の引数 7 つのやつになっている。</span>
            <span class="c1">// m_channels_[index].QueueDeclare(name_queues[index], false, false, false, false, false, null);</span>
            <span class="c1">// そして false になっているようだ。</span>
            <span class="n">m_channels_</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="nf">QueueDeclare</span><span class="p">(</span><span class="n">name_queues</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">passive_lifeSpans</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">durable_lifeSpans</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">exclusive_lifeSpans</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">autodelete_lifeSpans</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="k">false</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span>
            <span class="c1">//m_channels_[index].QueueDeclare(name_queues[index], false, false, false, false, false, null);</span>
<span class="cp">#else
</span>            <span class="c1">//m_channels_[index].QueueDeclare(name_queues[index], false, false, false, null);</span>
            <span class="n">m_channels_</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="nf">QueueDeclare</span><span class="p">(</span><span class="n">name_queues</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">durable_lifeSpans</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">exclusive_lifeSpans</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">autodelete_lifeSpans</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="k">null</span><span class="p">);</span>
<span class="cp">#endif
</span>        <span class="p">}</span>
        <span class="k">return</span> <span class="n">m_channels_</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">static</span> <span class="n">IModel</span><span class="p">[]</span> <span class="n">m_channels_</span> <span class="p">=</span> <span class="k">new</span> <span class="n">IModel</span><span class="p">[</span><span class="m">2</span><span class="p">];</span>

    <span class="k">static</span> <span class="n">EventingBasicConsumer</span> <span class="nf">GetConsumer</span><span class="p">(</span><span class="kt">int</span> <span class="n">index</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">null</span> <span class="p">==</span> <span class="n">m_consumers_</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
        <span class="p">{</span>
<span class="cp">#if UBUNTU
</span>            <span class="c1">// Ubuntuでは何故か v1.4.0 の引数が 0 個のやつになっている。調べたが引数が1個～6個のものは無かった。</span>
            <span class="n">m_consumers_</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">EventingBasicConsumer</span><span class="p">();</span>
<span class="cp">#else
</span>            <span class="n">m_consumers_</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">EventingBasicConsumer</span><span class="p">(</span><span class="nf">GetChannel</span><span class="p">(</span><span class="n">index</span><span class="p">));</span>
<span class="cp">#endif
</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">m_consumers_</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">static</span> <span class="n">EventingBasicConsumer</span><span class="p">[]</span> <span class="n">m_consumers_</span> <span class="p">=</span> <span class="k">new</span> <span class="n">EventingBasicConsumer</span><span class="p">[</span><span class="m">2</span><span class="p">];</span>

    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">/// 受信できたときに割り込んでくる処理</span>
    <span class="c1">/// &lt;/summary&gt;</span>
<span class="cp">#if UBUNTU
</span>    <span class="k">public</span> <span class="k">static</span> <span class="n">BasicDeliverEventHandler</span> <span class="nf">GetDequeueHandler</span><span class="p">()</span>
<span class="cp">#else
</span>    <span class="k">static</span> <span class="n">EventHandler</span><span class="p">&lt;</span><span class="n">BasicDeliverEventArgs</span><span class="p">&gt;</span> <span class="nf">GetDequeueHandler</span><span class="p">()</span>
<span class="cp">#endif
</span>    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">null</span> <span class="p">==</span> <span class="n">m_dequeueHandler_</span><span class="p">)</span>
        <span class="p">{</span>
<span class="cp">#if UBUNTU
</span>            <span class="n">m_dequeueHandler_</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">BasicDeliverEventHandler</span><span class="p">((</span><span class="n">model</span><span class="p">,</span> <span class="n">ea</span><span class="p">)</span> <span class="p">=&gt;</span>
<span class="cp">#else
</span>            <span class="n">m_dequeueHandler_</span> <span class="p">=</span> <span class="k">new</span> <span class="n">EventHandler</span><span class="p">&lt;</span><span class="n">BasicDeliverEventArgs</span><span class="p">&gt;((</span><span class="n">model</span><span class="p">,</span> <span class="n">ea</span><span class="p">)</span> <span class="p">=&gt;</span>
<span class="cp">#endif
</span>            <span class="p">{</span>
                <span class="kt">byte</span><span class="p">[]</span> <span class="n">body</span> <span class="p">=</span> <span class="n">ea</span><span class="p">.</span><span class="n">Body</span><span class="p">;</span>
                <span class="kt">string</span> <span class="n">message</span> <span class="p">=</span> <span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">.</span><span class="nf">GetString</span><span class="p">(</span><span class="n">body</span><span class="p">);</span>

                <span class="c1">// 回転式バッファーに入れる</span>
                <span class="n">rollingBuffer</span><span class="p">.</span><span class="nf">PutMessage</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
            <span class="p">});</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">m_dequeueHandler_</span><span class="p">;</span>
    <span class="p">}</span>

<span class="cp">#if UBUNTU
</span>    <span class="k">static</span> <span class="n">BasicDeliverEventHandler</span> <span class="n">m_dequeueHandler_</span><span class="p">;</span>
<span class="cp">#else
</span>    <span class="k">static</span> <span class="n">EventHandler</span><span class="p">&lt;</span><span class="n">BasicDeliverEventArgs</span><span class="p">&gt;</span> <span class="n">m_dequeueHandler_</span><span class="p">;</span>
<span class="cp">#endif
</span>
    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">/// 対応するオープンは無いけれど、開けたら閉める、を完璧に対応する必要がある。</span>
    <span class="c1">/// &lt;/summary&gt;</span>
    <span class="k">static</span> <span class="k">void</span> <span class="nf">CloseChannel</span><span class="p">(</span><span class="kt">int</span> <span class="n">index</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">null</span> <span class="p">!=</span> <span class="n">m_channels_</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
        <span class="p">{</span>
            <span class="n">m_channels_</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="nf">Close</span><span class="p">();</span>
            <span class="n">m_channels_</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">static</span> <span class="k">void</span> <span class="nf">Enqueue</span><span class="p">(</span><span class="kt">string</span> <span class="n">message</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// 末尾に daze を付ける。</span>
        <span class="n">message</span> <span class="p">+=</span> <span class="s">"daze"</span><span class="p">;</span>

        <span class="n">IModel</span> <span class="n">channel</span> <span class="p">=</span> <span class="nf">GetChannel</span><span class="p">(</span><span class="n">ENQUEUE_INDEX</span><span class="p">);</span>
        <span class="kt">byte</span><span class="p">[]</span> <span class="n">body</span> <span class="p">=</span> <span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
        <span class="n">channel</span><span class="p">.</span><span class="nf">BasicPublish</span><span class="p">(</span><span class="s">""</span><span class="p">,</span> <span class="n">name_queues</span><span class="p">[</span><span class="n">ENQUEUE_INDEX</span><span class="p">],</span> <span class="k">null</span><span class="p">,</span> <span class="n">body</span><span class="p">);</span>

        <span class="c1">// 対応するオープンは無いが、ちゃんと閉じないと、レシーブしてくれない。</span>
        <span class="nf">CloseChannel</span><span class="p">(</span><span class="n">ENQUEUE_INDEX</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">static</span> <span class="k">void</span> <span class="nf">StartConsume</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">IModel</span> <span class="n">channel</span> <span class="p">=</span> <span class="nf">GetChannel</span><span class="p">(</span><span class="n">DEQUEUE_INDEX</span><span class="p">);</span>
        <span class="n">EventingBasicConsumer</span> <span class="n">consumer</span> <span class="p">=</span> <span class="nf">GetConsumer</span><span class="p">(</span><span class="n">DEQUEUE_INDEX</span><span class="p">);</span>
        <span class="c1">// 受信できたときに割り込んでくる処理</span>
        <span class="n">consumer</span><span class="p">.</span><span class="n">Received</span> <span class="p">+=</span> <span class="nf">GetDequeueHandler</span><span class="p">();</span>

<span class="cp">#if UBUNTU
</span>        <span class="c1">// Ubuntuでは何故か引数が 5 個のやつになっている。</span>
        <span class="n">channel</span><span class="p">.</span><span class="nf">BasicConsume</span><span class="p">(</span> <span class="n">name_queues</span><span class="p">[</span><span class="n">DEQUEUE_INDEX</span><span class="p">],</span> <span class="k">true</span><span class="p">,</span> <span class="s">""</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="n">consumer</span><span class="p">);</span>
<span class="cp">#else
</span>        <span class="n">channel</span><span class="p">.</span><span class="nf">BasicConsume</span><span class="p">(</span> <span class="n">name_queues</span><span class="p">[</span><span class="n">DEQUEUE_INDEX</span><span class="p">],</span> <span class="k">true</span><span class="p">,</span> <span class="n">consumer</span><span class="p">);</span>
<span class="cp">#endif
</span>
        <span class="c1">// 終了はさせない</span>
        <span class="c1">// consumer.Received -= GetReceiveHandler();</span>
        <span class="c1">// CloseChannel(DEQUEUE_INDEX);</span>
    <span class="p">}</span>

    <span class="k">static</span> <span class="k">void</span> <span class="nf">StartProduce</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// 無限ループ</span>
        <span class="k">while</span> <span class="p">(</span><span class="nf">IsConnected</span><span class="p">())</span>
        <span class="p">{</span>
            <span class="kt">string</span> <span class="n">message</span> <span class="p">=</span> <span class="n">rollingBuffer</span><span class="p">.</span><span class="nf">GetMessage</span><span class="p">();</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">null</span> <span class="p">!=</span> <span class="n">message</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="c1">// エンキューする</span>
                <span class="nf">Enqueue</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="n">Thread</span><span class="p">.</span><span class="nf">Sleep</span><span class="p">(</span><span class="m">20</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">Length</span><span class="p">&lt;</span><span class="m">1</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">goto</span> <span class="n">gt_Error1</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// 引数の解析</span>
        <span class="p">{</span>
            <span class="c1">// 与件</span>
            <span class="c1">// 「--enqueue 1117 durable autodelete --dequeue 1116 durable autodelete」</span>
            <span class="c1">// 寿命は可変個数設定可能「durable」「autodelete」「passive」「exclusive」</span>

            <span class="c1">// 受け皿</span>
            <span class="c1">// 0:enqueue 1:dequeue</span>

            <span class="c1">// 記憶</span>
            <span class="kt">int</span> <span class="n">m0</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="c1">// 0:ニュートラル 1:enqueue 2:dequeue</span>
            <span class="kt">int</span> <span class="n">m1</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="c1">// 0:寿命カーソル</span>

            <span class="c1">// 解析器</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="kt">string</span> <span class="n">a</span> <span class="k">in</span> <span class="n">args</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="nf">StartsWith</span><span class="p">(</span><span class="s">"--"</span><span class="p">))</span>
                <span class="p">{</span>
                    <span class="k">switch</span> <span class="p">(</span><span class="n">a</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="k">case</span> <span class="s">"--enqueue"</span><span class="p">:</span> <span class="n">m0</span><span class="p">=</span><span class="m">1</span><span class="p">;</span> <span class="n">m1</span><span class="p">=</span><span class="m">0</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
                        <span class="k">case</span> <span class="s">"--dequeue"</span><span class="p">:</span> <span class="n">m0</span><span class="p">=</span><span class="m">2</span><span class="p">;</span> <span class="n">m1</span><span class="p">=</span><span class="m">0</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
                        <span class="k">default</span><span class="p">:</span> <span class="k">goto</span> <span class="n">gt_Error1</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
                <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="m">0</span> <span class="p">==</span> <span class="n">m1</span><span class="p">)</span> <span class="p">{</span> <span class="n">name_queues</span><span class="p">[</span><span class="n">m0</span> <span class="p">-</span> <span class="m">1</span><span class="p">]</span> <span class="p">=</span> <span class="n">a</span><span class="p">;</span> <span class="n">m1</span><span class="p">++;</span> <span class="p">}</span>
                <span class="k">else</span> <span class="p">{</span> <span class="n">lifeSpan_queues</span><span class="p">[</span><span class="n">m0</span> <span class="p">-</span> <span class="m">1</span><span class="p">]</span> <span class="p">|=</span> <span class="nf">LifeSpanString_To_Enum</span><span class="p">(</span><span class="n">a</span><span class="p">);</span> <span class="n">m1</span><span class="p">++;</span> <span class="p">}</span>
            <span class="p">}</span>

            <span class="c1">// 結果</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="m">2</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span> <span class="s">"("</span><span class="p">+</span><span class="n">i</span><span class="p">+</span><span class="s">") name=["</span><span class="p">+</span> <span class="n">name_queues</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">+</span> <span class="s">"] lifeSpan=["</span><span class="p">+</span> <span class="n">lifeSpan_queues</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">+</span> <span class="s">"]"</span><span class="p">);</span>
                <span class="nf">SetLifeSpan</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">name_queues</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">lifeSpan_queues</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// 常時監視をスタート</span>
        <span class="nf">StartConsume</span><span class="p">();</span>

        <span class="nf">StartProduce</span><span class="p">();</span>

        <span class="c1">// このプログラムは、自分では接続を切らない。</span>
        <span class="k">return</span><span class="p">;</span>

        <span class="n">gt_Error1</span><span class="p">:</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">Exception</span><span class="p">(</span><span class="s">@"コマンドライン引数に「--msgqueue キュー名 寿命 キュー名 寿命」を指定しろだぜ☆（＾～＾）
エンキュー先、デキュー先の順番な☆（＾▽＾）
寿命は durable, autodelete, passive, exclusive のいずれかで、
複合指定にはまだ対応していないぜ☆（＞＿＜）"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">/// &lt;summary&gt;</span>
<span class="c1">/// 回転式バッファー。</span>
<span class="c1">/// これはメイン・スレッドに置く。</span>
<span class="c1">/// デキューのスレッドでエンキューすることはできない。</span>
<span class="c1">/// デキュー処理は、回転式バッファーを仲介にしてエンキュー処理にメッセージを渡す。</span>
<span class="c1">/// &lt;/summary&gt;</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">RotationBuffer</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">bufferSize</span> <span class="p">=</span> <span class="m">100</span><span class="p">;</span>
    <span class="k">public</span> <span class="kt">string</span><span class="p">[]</span> <span class="n">buffer</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">string</span><span class="p">[</span><span class="n">bufferSize</span><span class="p">];</span>
    <span class="k">public</span> <span class="kt">int</span><span class="p">[]</span> <span class="n">bufferCursors</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">int</span><span class="p">[]</span> <span class="p">{</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span> <span class="p">};</span>
    <span class="k">public</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">PUT_INDEX</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">GET_INDEX</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">PutMessage</span><span class="p">(</span><span class="kt">string</span> <span class="n">message</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">buffer</span><span class="p">[</span><span class="n">bufferCursors</span><span class="p">[</span><span class="n">PUT_INDEX</span><span class="p">]]</span> <span class="p">=</span> <span class="n">message</span><span class="p">;</span>
        <span class="n">bufferCursors</span><span class="p">[</span><span class="n">PUT_INDEX</span><span class="p">]++;</span>
        <span class="k">if</span> <span class="p">(!(</span><span class="n">bufferCursors</span><span class="p">[</span><span class="n">PUT_INDEX</span><span class="p">]</span> <span class="p">&lt;</span> <span class="n">bufferSize</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">bufferCursors</span><span class="p">[</span><span class="n">PUT_INDEX</span><span class="p">]</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="nf">GetMessage</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">null</span> <span class="p">!=</span> <span class="n">buffer</span><span class="p">[</span><span class="n">bufferCursors</span><span class="p">[</span><span class="n">GET_INDEX</span><span class="p">]])</span>
        <span class="p">{</span>
            <span class="kt">string</span> <span class="n">message</span> <span class="p">=</span> <span class="n">buffer</span><span class="p">[</span><span class="n">bufferCursors</span><span class="p">[</span><span class="n">GET_INDEX</span><span class="p">]];</span>
            <span class="n">buffer</span><span class="p">[</span><span class="n">bufferCursors</span><span class="p">[</span><span class="n">GET_INDEX</span><span class="p">]]</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
            <span class="n">bufferCursors</span><span class="p">[</span><span class="n">GET_INDEX</span><span class="p">]++;</span>
            <span class="k">if</span> <span class="p">(!(</span><span class="n">bufferCursors</span><span class="p">[</span><span class="n">GET_INDEX</span><span class="p">]</span> <span class="p">&lt;</span> <span class="n">bufferSize</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="n">bufferCursors</span><span class="p">[</span><span class="n">GET_INDEX</span><span class="p">]</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">message</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>root@tk2-217-18401:/home/★user/shogi/csharp_service# rm tamesi35a2_cs.cs
root@tk2-217-18401:/home/★user/shogi/csharp_service# nano tamesi35a2_cs.cs
root@tk2-217-18401:/home/★user/shogi/csharp_service# mcs /r:RabbitMQ.Client.dll -define:UBUNTU tamesi35a2_cs.cs
root@tk2-217-18401:/home/★user/shogi/csharp_service# ./tamesi35a2_cs.exe --enqueue 1117 durable autodelete --dequeue 1116 durable autodelete &gt; ./tamesi35a2_cs.out.log 2&gt; ./tamesi35a2_cs.err.log &lt; /dev/null &amp;
[4] 470
root@tk2-217-18401:/home/★user/shogi/csharp_service# ./tamesi34_cs.exe 2&gt; ./tamesi34_cs.err.log
削除したいキューがあれば名前を、無ければ空文字列を入れろだぜ☆（＾～＾）
キュー名を入力    : キューを削除します
空文字列で[Enter] : 次のステップへ進む
Name or empty ? &gt;
エンキュー先のメッセージ・キューの名前を入れろだぜ☆（＾～＾）
Queue name? &gt; 1116
エンキュー先のメッセージ・キューの寿命を、足し算して答えろだぜ☆（＾～＾）
(1) durable    : RabbitMQが止まってもキューを残す
(2) autodelete : コンシューマーが１人も接続していなかったら消す
(4) passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ
(8) exclusive  : この接続でだけ使える。この接続が切れたら消す
Number ? &gt; 3
デキュー先のメッセージ・キューの名前を入れろだぜ☆（＾～＾）
Queue name? &gt; 1117
デキュー先のメッセージ・キューの寿命を、足し算して答えろだぜ☆（＾～＾）
(1) durable    : RabbitMQが止まってもキューを残す
(2) autodelete : コンシューマーが１人も接続していなかったら消す
(4) passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ
(8) exclusive  : この接続でだけ使える。この接続が切れたら消す
Number ? &gt; 3
tamesi34_cs.cs Dump
    name_queues         [ENQUEUE_INDEX]    =[1116]
    lifeSpan_queues     [ENQUEUE_INDEX]    =[Durable, Autodelete]
    durable_lifeSpans   [ENQUEUE_INDEX]    =[True]
    autodelete_lifeSpans[ENQUEUE_INDEX]    =[True]
    passive_lifeSpans   [ENQUEUE_INDEX]    =[False]
    exclusive_lifeSpans [ENQUEUE_INDEX]    =[False]
    ----
    name_queues         [DEQUEUE_INDEX]    =[1117]
    lifeSpan_queues     [DEQUEUE_INDEX]    =[Durable, Autodelete]
    durable_lifeSpans   [DEQUEUE_INDEX]    =[True]
    autodelete_lifeSpans[DEQUEUE_INDEX]    =[True]
    passive_lifeSpans   [DEQUEUE_INDEX]    =[False]
    exclusive_lifeSpans [DEQUEUE_INDEX]    =[False]
    ----
    name_queues         [DELETEQUEUE_INDEX]=[]
    lifeSpan_queues     [DELETEQUEUE_INDEX]=[0]
    durable_lifeSpans   [DELETEQUEUE_INDEX]=[False]
    autodelete_lifeSpans[DELETEQUEUE_INDEX]=[False]
    passive_lifeSpans   [DELETEQUEUE_INDEX]=[False]
    exclusive_lifeSpans [DELETEQUEUE_INDEX]=[False]
    ----

(tamesi34_cs.cs?) GetChannel index = [1]
    name_queues[index] = [1117]
    passive_lifeSpans[index] = [False]
    durable_lifeSpans[index] = [True]
    exclusive_lifeSpans[index] = [False]
    autodelete_lifeSpans[index] = [True]
    nowait は仮に false 固定
    arguments は仮に null 固定
[4]   Exit 1                  ./tamesi35a2_cs.exe --enqueue 1117 durable autodelete --dequeue 1116 durable autodelete &gt; ./tamesi35a2_cs.out.log 2&gt; ./tamesi35a2_cs.err.log &lt; /dev/null
</code></pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>(tamesi35a2_cs.cs?) GetChannel index = [1]
    name_queues[index] = [1116]
    passive_lifeSpans[index] = [False]
    durable_lifeSpans[index] = [True]
    exclusive_lifeSpans[index] = [False]
    autodelete_lifeSpans[index] = [True]
    nowait は仮に false 固定
    arguments は仮に null 固定

Unhandled Exception:
RabbitMQ.Client.Exceptions.OperationInterruptedException: The AMQP operation was interrupted: AMQP close-reason, initiated by Peer, code=406, text="PRECONDITION_FAILED - inequivalent arg 'durable' for queue '1116' in vhost '/': recei$
  at RabbitMQ.Client.Impl.SimpleBlockingRpcContinuation.GetReply () &lt;0x40044590 + 0x00103&gt; in &lt;filename unknown&gt;:0
  at RabbitMQ.Client.Impl.ModelBase.ModelRpc (RabbitMQ.Client.Impl.MethodBase method, RabbitMQ.Client.Impl.ContentHeaderBase header, System.Byte[] body) &lt;0x40042520 + 0x000f9&gt; in &lt;filename unknown&gt;:0
  at RabbitMQ.Client.Framing.Impl.v0_8.Model.QueueDeclare (System.String queue, Boolean passive, Boolean durable, Boolean exclusive, Boolean autoDelete, Boolean nowait, IDictionary arguments) &lt;0x400467d0 + 0x00113&gt; in &lt;filename unkno$
  at Program.GetChannel (Int32 index) &lt;0x400078d0 + 0x00436&gt; in &lt;filename unknown&gt;:0
  at Program.StartConsume () &lt;0x40007810 + 0x0000f&gt; in &lt;filename unknown&gt;:0
  at Program.Main (System.String[] args) &lt;0x40004270 + 0x003cb&gt; in &lt;filename unknown&gt;:0
[ERROR] FATAL UNHANDLED EXCEPTION: RabbitMQ.Client.Exceptions.OperationInterruptedException: The AMQP operation was interrupted: AMQP close-reason, initiated by Peer, code=406, text="PRECONDITION_FAILED - inequivalent arg 'durable' f$
  at RabbitMQ.Client.Impl.SimpleBlockingRpcContinuation.GetReply () &lt;0x40044590 + 0x00103&gt; in &lt;filename unknown&gt;:0
  at RabbitMQ.Client.Impl.ModelBase.ModelRpc (RabbitMQ.Client.Impl.MethodBase method, RabbitMQ.Client.Impl.ContentHeaderBase header, System.Byte[] body) &lt;0x40042520 + 0x000f9&gt; in &lt;filename unknown&gt;:0
  at RabbitMQ.Client.Framing.Impl.v0_8.Model.QueueDeclare (System.String queue, Boolean passive, Boolean durable, Boolean exclusive, Boolean autoDelete, Boolean nowait, IDictionary arguments) &lt;0x400467d0 + 0x00113&gt; in &lt;filename unkno$
  at Program.GetChannel (Int32 index) &lt;0x400078d0 + 0x00436&gt; in &lt;filename unknown&gt;:0
  at Program.StartConsume () &lt;0x40007810 + 0x0000f&gt; in &lt;filename unknown&gt;:0
  at Program.Main (System.String[] args) &lt;0x40004270 + 0x003cb&gt; in &lt;filename unknown&gt;:0
</code></pre></div></div>

<p>うーむ。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>root@tk2-217-18401:/home/csg10/shogi/csharp_service# ./tamesi34_cs.exe 2&gt; ./tamesi34_cs.err.log
削除したいキューがあれば名前を、無ければ空文字列を入れろだぜ☆（＾～＾）
キュー名を入力    : キューを削除します
空文字列で[Enter] : 次のステップへ進む
Name or empty ? &gt;
エンキュー先のメッセージ・キューの名前を入れろだぜ☆（＾～＾）
Queue name? &gt; 1116
エンキュー先のメッセージ・キューの寿命を、足し算して答えろだぜ☆（＾～＾）
(1) durable    : RabbitMQが止まってもキューを残す
(2) autodelete : コンシューマーが１人も接続していなかったら消す
(4) passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ
(8) exclusive  : この接続でだけ使える。この接続が切れたら消す
Number ? &gt; 3
デキュー先のメッセージ・キューの名前を入れろだぜ☆（＾～＾）
Queue name? &gt; 1117
デキュー先のメッセージ・キューの寿命を、足し算して答えろだぜ☆（＾～＾）
(1) durable    : RabbitMQが止まってもキューを残す
(2) autodelete : コンシューマーが１人も接続していなかったら消す
(4) passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ
(8) exclusive  : この接続でだけ使える。この接続が切れたら消す
Number ? &gt; 3
tamesi34_cs.cs Dump
    name_queues         [ENQUEUE_INDEX]    =[1116]
    lifeSpan_queues     [ENQUEUE_INDEX]    =[Durable, Autodelete]
    durable_lifeSpans   [ENQUEUE_INDEX]    =[True]
    autodelete_lifeSpans[ENQUEUE_INDEX]    =[True]
    passive_lifeSpans   [ENQUEUE_INDEX]    =[False]
    exclusive_lifeSpans [ENQUEUE_INDEX]    =[False]
    ----
    name_queues         [DEQUEUE_INDEX]    =[1117]
    lifeSpan_queues     [DEQUEUE_INDEX]    =[Durable, Autodelete]
    durable_lifeSpans   [DEQUEUE_INDEX]    =[True]
    autodelete_lifeSpans[DEQUEUE_INDEX]    =[True]
    passive_lifeSpans   [DEQUEUE_INDEX]    =[False]
    exclusive_lifeSpans [DEQUEUE_INDEX]    =[False]
    ----
    name_queues         [DELETEQUEUE_INDEX]=[]
    lifeSpan_queues     [DELETEQUEUE_INDEX]=[0]
    durable_lifeSpans   [DELETEQUEUE_INDEX]=[False]
    autodelete_lifeSpans[DELETEQUEUE_INDEX]=[False]
    passive_lifeSpans   [DELETEQUEUE_INDEX]=[False]
    exclusive_lifeSpans [DELETEQUEUE_INDEX]=[False]
    ----

(tamesi34_cs.cs?) GetChannel index = [1]
    name_queues[index] = [1117]
    passive_lifeSpans[index] = [False]
    durable_lifeSpans[index] = [True]
    exclusive_lifeSpans[index] = [False]
    autodelete_lifeSpans[index] = [True]
    nowait は仮に false 固定
    arguments は仮に null 固定
[3]   Exit 1                  ./tamesi35a2_cs.exe --enqueue 1117 durable autodelete --dequeue 1116 durable autodelete &gt; ./tamesi35a2_cs.out.log 2&gt; ./tamesi35a2_cs.err.log &lt; /dev/null
</code></pre></div></div>

<p>これでもダメか。</p>

<h1>
<span id="ググろう-1" class="fragment"></span><a href="#%E3%82%B0%E3%82%B0%E3%82%8D%E3%81%86-1"><i class="fa fa-link"></i></a>ググろう</h1>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>PRECONDITION_FAILED - inequivalent arg 'durable
</code></pre></div></div>

<h1>
<span id="キューを削除しよう" class="fragment"></span><a href="#%E3%82%AD%E3%83%A5%E3%83%BC%E3%82%92%E5%89%8A%E9%99%A4%E3%81%97%E3%82%88%E3%81%86"><i class="fa fa-link"></i></a>キューを削除しよう</h1>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>root@tk2-217-18401:/home/csg10/shogi/csharp_service# rabbitmqctl list_queues
Listing queues ...
1117    0
1118    0
myqueue 0
1115    0
1114    0
1119    0
root@tk2-217-18401:/home/csg10/shogi/csharp_service# ./tamesi34_cs.exe 2&gt; ./tamesi34_cs.err.log
削除したいキューがあれば名前を、無ければ空文字列を入れろだぜ☆（＾～＾）
キュー名を入力    : キューを削除します
空文字列で[Enter] : 次のステップへ進む
Name or empty ? &gt; myqueue
削除するメッセージ・キューの寿命を、足し算して答えろだぜ☆（＾～＾）
(1) durable    : RabbitMQが止まってもキューを残す
(2) autodelete : コンシューマーが１人も接続していなかったら消す
(4) passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ
(8) exclusive  : この接続でだけ使える。この接続が切れたら消す
Number ? &gt; 1
tamesi34_cs.cs Dump
    name_queues         [ENQUEUE_INDEX]    =[]
    lifeSpan_queues     [ENQUEUE_INDEX]    =[0]
    durable_lifeSpans   [ENQUEUE_INDEX]    =[False]
    autodelete_lifeSpans[ENQUEUE_INDEX]    =[False]
    passive_lifeSpans   [ENQUEUE_INDEX]    =[False]
    exclusive_lifeSpans [ENQUEUE_INDEX]    =[False]
    ----
    name_queues         [DEQUEUE_INDEX]    =[]
    lifeSpan_queues     [DEQUEUE_INDEX]    =[0]
    durable_lifeSpans   [DEQUEUE_INDEX]    =[False]
    autodelete_lifeSpans[DEQUEUE_INDEX]    =[False]
    passive_lifeSpans   [DEQUEUE_INDEX]    =[False]
    exclusive_lifeSpans [DEQUEUE_INDEX]    =[False]
    ----
    name_queues         [DELETEQUEUE_INDEX]=[myqueue]
    lifeSpan_queues     [DELETEQUEUE_INDEX]=[Durable]
    durable_lifeSpans   [DELETEQUEUE_INDEX]=[True]
    autodelete_lifeSpans[DELETEQUEUE_INDEX]=[False]
    passive_lifeSpans   [DELETEQUEUE_INDEX]=[False]
    exclusive_lifeSpans [DELETEQUEUE_INDEX]=[False]
    ----

(tamesi34_cs.cs?) GetChannel index = [2]
    name_queues[index] = [myqueue]
    passive_lifeSpans[index] = [False]
    durable_lifeSpans[index] = [True]
    exclusive_lifeSpans[index] = [False]
    autodelete_lifeSpans[index] = [False]
    nowait は仮に false 固定
    arguments は仮に null 固定
[myqueue]キューを削除したはずだぜ☆（＾～＾） result=[4294967295]
削除したいキューがあれば名前を、無ければ空文字列を入れろだぜ☆（＾～＾）
キュー名を入力    : キューを削除します
空文字列で[Enter] : 次のステップへ進む
</code></pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code># rabbitmqctl list_queues
Listing queues ...
1117    0
1118    0
1115    0
1114    0
1119    0
</code></pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code># ./tamesi34_cs.exe 2&gt; ./tamesi34_cs.err.log
削除したいキューがあれば名前を、無ければ空文字列を入れろだぜ☆（＾～＾）
キュー名を入力    : キューを削除します
空文字列で[Enter] : 次のステップへ進む
Name or empty ? &gt; 1114
削除するメッセージ・キューの寿命を、足し算して答えろだぜ☆（＾～＾）
(1) durable    : RabbitMQが止まってもキューを残す
(2) autodelete : コンシューマーが１人も接続していなかったら消す
(4) passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ
(8) exclusive  : この接続でだけ使える。この接続が切れたら消す
Number ? &gt; 1
tamesi34_cs.cs Dump
    name_queues         [ENQUEUE_INDEX]    =[]
    lifeSpan_queues     [ENQUEUE_INDEX]    =[0]
    durable_lifeSpans   [ENQUEUE_INDEX]    =[False]
    autodelete_lifeSpans[ENQUEUE_INDEX]    =[False]
    passive_lifeSpans   [ENQUEUE_INDEX]    =[False]
    exclusive_lifeSpans [ENQUEUE_INDEX]    =[False]
    ----
    name_queues         [DEQUEUE_INDEX]    =[]
    lifeSpan_queues     [DEQUEUE_INDEX]    =[0]
    durable_lifeSpans   [DEQUEUE_INDEX]    =[False]
    autodelete_lifeSpans[DEQUEUE_INDEX]    =[False]
    passive_lifeSpans   [DEQUEUE_INDEX]    =[False]
    exclusive_lifeSpans [DEQUEUE_INDEX]    =[False]
    ----
    name_queues         [DELETEQUEUE_INDEX]=[1114]
    lifeSpan_queues     [DELETEQUEUE_INDEX]=[Durable]
    durable_lifeSpans   [DELETEQUEUE_INDEX]=[True]
    autodelete_lifeSpans[DELETEQUEUE_INDEX]=[False]
    passive_lifeSpans   [DELETEQUEUE_INDEX]=[False]
    exclusive_lifeSpans [DELETEQUEUE_INDEX]=[False]
    ----

(tamesi34_cs.cs?) GetChannel index = [2]
    name_queues[index] = [1114]
    passive_lifeSpans[index] = [False]
    durable_lifeSpans[index] = [True]
    exclusive_lifeSpans[index] = [False]
    autodelete_lifeSpans[index] = [False]
    nowait は仮に false 固定
    arguments は仮に null 固定
[1114]キューを削除したはずだぜ☆（＾～＾） result=[4294967295]
削除したいキューがあれば名前を、無ければ空文字列を入れろだぜ☆（＾～＾）
キュー名を入力    : キューを削除します
空文字列で[Enter] : 次のステップへ進む
</code></pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code># rabbitmqctl list_queues
Listing queues ...
1117    0
1118    0
1115    0
1119    0
</code></pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code># ./tamesi34_cs.exe 2&gt; ./tamesi34_cs.err.log
削除したいキューがあれば名前を、無ければ空文字列を入れろだぜ☆（＾～＾）
キュー名を入力    : キューを削除します
空文字列で[Enter] : 次のステップへ進む
Name or empty ? &gt; 1115
削除するメッセージ・キューの寿命を、足し算して答えろだぜ☆（＾～＾）
(1) durable    : RabbitMQが止まってもキューを残す
(2) autodelete : コンシューマーが１人も接続していなかったら消す
(4) passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ
(8) exclusive  : この接続でだけ使える。この接続が切れたら消す
Number ? &gt; 1
tamesi34_cs.cs Dump
    name_queues         [ENQUEUE_INDEX]    =[]
    lifeSpan_queues     [ENQUEUE_INDEX]    =[0]
    durable_lifeSpans   [ENQUEUE_INDEX]    =[False]
    autodelete_lifeSpans[ENQUEUE_INDEX]    =[False]
    passive_lifeSpans   [ENQUEUE_INDEX]    =[False]
    exclusive_lifeSpans [ENQUEUE_INDEX]    =[False]
    ----
    name_queues         [DEQUEUE_INDEX]    =[]
    lifeSpan_queues     [DEQUEUE_INDEX]    =[0]
    durable_lifeSpans   [DEQUEUE_INDEX]    =[False]
    autodelete_lifeSpans[DEQUEUE_INDEX]    =[False]
    passive_lifeSpans   [DEQUEUE_INDEX]    =[False]
    exclusive_lifeSpans [DEQUEUE_INDEX]    =[False]
    ----
    name_queues         [DELETEQUEUE_INDEX]=[1115]
    lifeSpan_queues     [DELETEQUEUE_INDEX]=[Durable]
    durable_lifeSpans   [DELETEQUEUE_INDEX]=[True]
    autodelete_lifeSpans[DELETEQUEUE_INDEX]=[False]
    passive_lifeSpans   [DELETEQUEUE_INDEX]=[False]
    exclusive_lifeSpans [DELETEQUEUE_INDEX]=[False]
    ----

(tamesi34_cs.cs?) GetChannel index = [2]
    name_queues[index] = [1115]
    passive_lifeSpans[index] = [False]
    durable_lifeSpans[index] = [True]
    exclusive_lifeSpans[index] = [False]
    autodelete_lifeSpans[index] = [False]
    nowait は仮に false 固定
    arguments は仮に null 固定
[1115]キューを削除したはずだぜ☆（＾～＾） result=[4294967295]
削除したいキューがあれば名前を、無ければ空文字列を入れろだぜ☆（＾～＾）
キュー名を入力    : キューを削除します
空文字列で[Enter] : 次のステップへ進む
</code></pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code># rabbitmqctl list_queues
Listing queues ...
1117    0
1118    0
1119    0
</code></pre></div></div>

<p>なんかキューは durable だけ指定すれば全部消せた。</p>

<h1>
<span id="キューを全部消してdurableautodelete-で行けた" class="fragment"></span><a href="#%E3%82%AD%E3%83%A5%E3%83%BC%E3%82%92%E5%85%A8%E9%83%A8%E6%B6%88%E3%81%97%E3%81%A6durableautodelete-%E3%81%A7%E8%A1%8C%E3%81%91%E3%81%9F"><i class="fa fa-link"></i></a>キューを全部消して、durable+autodelete で行けた？</h1>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code># ./tamesi35a2_cs.exe --enqueue 1113 durable autodelete --dequeue 1112 durable autodelete &gt; ./tamesi35a2_cs.out.log 2&gt; ./tamesi35a2_cs.err.log &lt; /dev/null &amp;
[3] 2613
root@tk2-217-18401:/home/csg10/shogi/csharp_service# ./tamesi34_cs.exe
削除したいキューがあれば名前を、無ければ空文字列を入れろだぜ☆（＾～＾）
キュー名を入力    : キューを削除します
空文字列で[Enter] : 次のステップへ進む
Name or empty ? &gt;
エンキュー先のメッセージ・キューの名前を入れろだぜ☆（＾～＾）
Queue name? &gt; 1112
エンキュー先のメッセージ・キューの寿命を、足し算して答えろだぜ☆（＾～＾）
(1) durable    : RabbitMQが止まってもキューを残す
(2) autodelete : コンシューマーが１人も接続していなかったら消す
(4) passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ
(8) exclusive  : この接続でだけ使える。この接続が切れたら消す
Number ? &gt; 3
デキュー先のメッセージ・キューの名前を入れろだぜ☆（＾～＾）
Queue name? &gt; 1113
デキュー先のメッセージ・キューの寿命を、足し算して答えろだぜ☆（＾～＾）
(1) durable    : RabbitMQが止まってもキューを残す
(2) autodelete : コンシューマーが１人も接続していなかったら消す
(4) passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ
(8) exclusive  : この接続でだけ使える。この接続が切れたら消す
Number ? &gt; 3
tamesi34_cs.cs Dump
    name_queues         [ENQUEUE_INDEX]    =[1112]
    lifeSpan_queues     [ENQUEUE_INDEX]    =[Durable, Autodelete]
    durable_lifeSpans   [ENQUEUE_INDEX]    =[True]
    autodelete_lifeSpans[ENQUEUE_INDEX]    =[True]
    passive_lifeSpans   [ENQUEUE_INDEX]    =[False]
    exclusive_lifeSpans [ENQUEUE_INDEX]    =[False]
    ----
    name_queues         [DEQUEUE_INDEX]    =[1113]
    lifeSpan_queues     [DEQUEUE_INDEX]    =[Durable, Autodelete]
    durable_lifeSpans   [DEQUEUE_INDEX]    =[True]
    autodelete_lifeSpans[DEQUEUE_INDEX]    =[True]
    passive_lifeSpans   [DEQUEUE_INDEX]    =[False]
    exclusive_lifeSpans [DEQUEUE_INDEX]    =[False]
    ----
    name_queues         [DELETEQUEUE_INDEX]=[]
    lifeSpan_queues     [DELETEQUEUE_INDEX]=[0]
    durable_lifeSpans   [DELETEQUEUE_INDEX]=[False]
    autodelete_lifeSpans[DELETEQUEUE_INDEX]=[False]
    passive_lifeSpans   [DELETEQUEUE_INDEX]=[False]
    exclusive_lifeSpans [DELETEQUEUE_INDEX]=[False]
    ----

(tamesi34_cs.cs?) GetChannel index = [1]
    name_queues[index] = [1113]
    passive_lifeSpans[index] = [False]
    durable_lifeSpans[index] = [True]
    exclusive_lifeSpans[index] = [False]
    autodelete_lifeSpans[index] = [True]
    nowait は仮に false 固定
    arguments は仮に null 固定
終了するときは[Ctrl]+[C]キーを押せだぜ☆（＾～＾）
エンキューするときはメッセージを打ち込んで[Enter]キーを押せだぜ☆(＾◇＾)
Enqueue? &gt; usi
tamesi34_cs.cs Dump
    name_queues         [ENQUEUE_INDEX]    =[1112]
    lifeSpan_queues     [ENQUEUE_INDEX]    =[Durable, Autodelete]
    durable_lifeSpans   [ENQUEUE_INDEX]    =[True]
    autodelete_lifeSpans[ENQUEUE_INDEX]    =[True]
    passive_lifeSpans   [ENQUEUE_INDEX]    =[False]
    exclusive_lifeSpans [ENQUEUE_INDEX]    =[False]
    ----
    name_queues         [DEQUEUE_INDEX]    =[1113]
    lifeSpan_queues     [DEQUEUE_INDEX]    =[Durable, Autodelete]
    durable_lifeSpans   [DEQUEUE_INDEX]    =[True]
    autodelete_lifeSpans[DEQUEUE_INDEX]    =[True]
    passive_lifeSpans   [DEQUEUE_INDEX]    =[False]
    exclusive_lifeSpans [DEQUEUE_INDEX]    =[False]
    ----
    name_queues         [DELETEQUEUE_INDEX]=[]
    lifeSpan_queues     [DELETEQUEUE_INDEX]=[0]
    durable_lifeSpans   [DELETEQUEUE_INDEX]=[False]
    autodelete_lifeSpans[DELETEQUEUE_INDEX]=[False]
    passive_lifeSpans   [DELETEQUEUE_INDEX]=[False]
    exclusive_lifeSpans [DELETEQUEUE_INDEX]=[False]
    ----

(tamesi34_cs.cs?) GetChannel index = [0]
    name_queues[index] = [1112]
    passive_lifeSpans[index] = [False]
    durable_lifeSpans[index] = [True]
    exclusive_lifeSpans[index] = [False]
    autodelete_lifeSpans[index] = [True]
    nowait は仮に false 固定
    arguments は仮に null 固定
 Enqueue(^q^) usi
Enqueue? &gt; &lt;---- [interrupt!] Dequeue(^q^) usidaze
</code></pre></div></div>

<p>usidaze が返ってきている。Ｃ＃では成功か？</p>

<p>じゃあ</p>

<p>-Windows10 ではデフォルトで durable<br>
-Ubuntu ではデフォルトで durable+autodelete</p>

<p>か。<strong>そんなん分からんなあ。</strong></p>

<h2>
<span id="cでもテストしたいが" class="fragment"></span><a href="#c%E3%81%A7%E3%82%82%E3%83%86%E3%82%B9%E3%83%88%E3%81%97%E3%81%9F%E3%81%84%E3%81%8C"><i class="fa fa-link"></i></a>C++でもテストしたいが</h2>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>root@tk2-217-18401:/home/★user/shogi/csharp_service# jobs
[1]-  Stopped                 nano tamesi34_cs.err.log
[2]+  Stopped                 nano tamesi35a2_cs.out.log
[3]   Running                 ./tamesi35a2_cs.exe --enqueue 1113 durable autodelete --dequeue 1112 durable autodelete &gt; ./tamesi35a2_cs.out.log 2&gt; ./tamesi35a2_cs.err.log &lt; /dev/null &amp;
root@tk2-217-18401:/home/★user/shogi/csharp_service# kill %3
root@tk2-217-18401:/home/★user/shogi/csharp_service# jobs
[1]-  Stopped                 nano tamesi34_cs.err.log
[2]+  Stopped                 nano tamesi35a2_cs.out.log
[3]   Terminated              ./tamesi35a2_cs.exe --enqueue 1113 durable autodelete --dequeue 1112 durable autodelete &gt; ./tamesi35a2_cs.out.log 2&gt; ./tamesi35a2_cs.err.log &lt; /dev/null
</code></pre></div></div>

<p>ジョブを止めておく。</p>

<p>tamesi35a2.cpp をバックグラウンドで動かそう。標準入出力は捨てることが重要。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>./tamesi35a2_cs.exe --enqueue 1113 durable autodelete --dequeue 1112 durable autodelete &gt; ./tamesi35a2_cs.out.log 2&gt; ./tamesi35a2_cs.err.log &lt; /dev/null &amp;
</code></pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>root@tk2-217-18401:~# ./tamesi35a2_cs.exe --enqueue 1113 durable autodelete --dequeue 1112 durable autodelete &gt; ./tamesi35a2_cs.out.log 2&gt; ./tamesi35a2_cs.err.log &lt; /dev/null &amp;
[1] 12555
root@tk2-217-18401:~# jobs
[1]+  Exit 127                ./tamesi35a2_cs.exe --enqueue 1113 durable autodelete --dequeue 1112 durable autodelete &gt; ./tamesi35a2_cs.out.log 2&gt; ./tamesi35a2_cs.err.log &lt; /dev/null
root@tk2-217-18401:~# jobs
</code></pre></div></div>

<p><strong>あれっ？</strong> これ、_cs だぜ。そして　カレント・ディレクトリが違う。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>root@tk2-217-18401:~# cd /home/★user/shogi/cpp_service
root@tk2-217-18401:/home/★user/shogi/cpp_service# ls
consume.cpp               tamesi29a11_enqueueTcp.cpp
consume.exe               tamesi29a11_enqueueTcp.exe
loop28_cpp.cpp            tamesi29a7_main.cpp
loop28_cpp.exe            tamesi29a7_main.exe
publish.cpp               tamesi29a8_example_consume.cpp
publish.exe               tamesi29a9_main.cpp
tamesi28.d                tamesi29a9_main.exe
tamesi29a10_main.cpp      tamesi33a2_cpp.cpp
tamesi29a10_main.exe      tamesi33a2_cpp.err.log
tamesi29a11_enqueueA.cpp  tamesi33a2_cpp.exe
tamesi29a11_enqueueA.exe  tamesi35a2_cpp.cpp
tamesi29a11_enqueueC.cpp  tamesi35a2_cpp.err.log
tamesi29a11_enqueueC.exe  tamesi35a2_cpp.exe
tamesi29a11_enqueue.exe
root@tk2-217-18401:/home/★user/shogi/cpp_service# ./tamesi35a2_cpp.exe --msgqueue 1117 durable 1116 durable 2&gt; ./tamesi35a2_cpp.err.log &amp;
[1] 12608
root@tk2-217-18401:/home/★user/shogi/cpp_service# Welcome! AMQP::durable=[1] AMQP::autodelete=[2] AMQP::passive=[8] AMQP::exclusive=[512]

</code></pre></div></div>

<p>プロンプトが返ってきてしまった。困るぜ。[Entery]キーを押してみる。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code># jobs
[1]+  Running                 ./tamesi35a2_cpp.exe --msgqueue 1117 durable 1116 durable 2&gt; ./tamesi35a2_cpp.err.log &amp;
</code></pre></div></div>

<p>動いているようだ。</p>

<h1>
<span id="記事が長くなってきたので次へ" class="fragment"></span><a href="#%E8%A8%98%E4%BA%8B%E3%81%8C%E9%95%B7%E3%81%8F%E3%81%AA%E3%81%A3%E3%81%A6%E3%81%8D%E3%81%9F%E3%81%AE%E3%81%A7%E6%AC%A1%E3%81%B8"><i class="fa fa-link"></i></a>記事が長くなってきたので次へ。</h1>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Fmuzudho1%2Fitems%2F3d292bafc4a8fa54eb43&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Fmuzudho1%2Fitems%2F3d292bafc4a8fa54eb43&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/muzudho1/items/3d292bafc4a8fa54eb43/likers" class="css-1iupg5d">0</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">1</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/3d292bafc4a8fa54eb43/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/muzudho1/items/3d292bafc4a8fa54eb43/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/muzudho1/items/3d292bafc4a8fa54eb43/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/muzudho1/items/3d292bafc4a8fa54eb43/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/muzudho1/items/3d292bafc4a8fa54eb43.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-681f3a1a-6c03-4513-86f1-475d4ff0448e">{"authorAnalyticsTrackingId":null,"organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-16e9a540-b3ac-47fe-a9db-0facb5b3445e"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-16e9a540-b3ac-47fe-a9db-0facb5b3445e">{}</script>
      
<div id="LoginModal-react-component-612ddc25-dc11-4155-a2ea-eda09481425b"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-612ddc25-dc11-4155-a2ea-eda09481425b">{}</script>
      
<div id="StockModal-react-component-6fb88673-b2a5-4377-8273-d80ec04b1543"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-6fb88673-b2a5-4377-8273-d80ec04b1543">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;cUImji8qoQDa9C6RSYVp5l4Z3DUvoBMAAvf27GH4L4gEQi5NcWkH1scj4L8+fIAiNzjLyl7gPFj83Nq7wRVK9A==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\u003cp\u003e前回の記事 : \u003ca href=\"http://qiita.com/muzudho1/items/6fbe1681a7e14dcac3f2\" class=\"autolink\" id=\"reference-af85235244f8a382e785\"\u003ehttp://qiita.com/muzudho1/items/6fbe1681a7e14dcac3f2\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"バグの原因を調べよう\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%90%E3%82%B0%E3%81%AE%E5%8E%9F%E5%9B%A0%E3%82%92%E8%AA%BF%E3%81%B9%E3%82%88%E3%81%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eバグの原因を調べよう\u003c/h1\u003e\n\n\u003cp\u003eコンシューマの受信ループを　別スレッドにしてから　おかしくなった気がする。\u003c/p\u003e\n\n\u003cp\u003eじゃあ、コンシューマの受信ループは　別スレッドにせず、\u003cbr\u003e\nプロデューサーの送信を　別スレッドにしたらいいのか？\u003c/p\u003e\n\n\u003cp\u003e試すだけ試そう。\u003c/p\u003e\n\n\u003cp\u003eまず、ev_loop がエラーを出すソースコード。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cpp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// OS      : Windows10 : // このプログラムは動かない\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// OS      : Ubuntu 16.04\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// Library : libev\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//         : Install   : Command  : sudo apt-get update\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//                                : sudo apt-get install libev-dev\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// Service : RabbitMQ\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//         : Reference : Web site : Top page http://www.rabbitmq.com/\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//         : Install   : Web site : Installing on Debian / Ubuntu http://www.rabbitmq.com/install-debian.html\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//         : Manual    : Command  : man rabbitmqctl\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//         : Start     : Command  : rabbitmq-server\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//         : Stop      : Command  : rabbitmqctl stop\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//         : Check     : Command  : rabbitmqctl status\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//         :           : Command  : rabbitmqctl list_queues\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// Library : AMQP-CPP\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//         : Reference : Web site : AMQP-CPP README.md https://github.com/CopernicaMarketingSoftware/AMQP-CPP\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//         : Reference : Web site : QueueDeclare http://docs.spring.io/spring-amqp-net/docs/1.0.x/api/html/Spring.Messaging.Amqp.Rabbit~Spring.Messaging.Amqp.Rabbit.Connection.CachedModel~QueueDeclare(String,Boolean,Boolean,Boolean,Boolean,Boolean,IDictionary).html\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//         : Reference : Web site : EventingBasicConsumer https://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v1.4.0/rabbitmq-dotnet-client-1.4.0-net-2.0-htmldoc/type-RabbitMQ.Client.Events.EventingBasicConsumer.html\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//         : Reference : Web site : BasicConsume https://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v1.4.0/rabbitmq-dotnet-client-1.4.0-net-2.0-htmldoc/type-RabbitMQ.Client.IModel.html#method-M:RabbitMQ.Client.IModel.BasicConsume(System.UInt16,System.String,System.Boolean,System.Collections.IDictionary,RabbitMQ.Client.IBasicConsumer)\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//         : Reference : Web site : C#でconstな配列を実現する (もっとクールにプログラミング) http://pgnote.net/?p=885\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//         : Reference : Web site : AMQP-CPP (docsforge.com) http://docsforge.com/11/AMQP-CPP/docs/latest/namespace-AMQP/class-TcpConnection/\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// Program : this\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//         : Compile   : Command  : g++ -std=c++11 tamesi33a2_cpp.cpp -o tamesi33a2_cpp.exe -lev -lamqpcpp -pthread\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//         : Execute   : Command  : // バックグラウンドで実行\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//                                : ./tamesi33a2_cpp.exe --msgqueue 1117 durable 1116 durable 2\u0026gt; ./tamesi33a2_cpp.err.log \u0026amp;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//         : Stop      : Typing   : [Ctrl]+[C]\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// メッセージの末尾に daze を付けます。\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// デキューは「1112」、エンキューは「1113」キューに向けて行います。\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 標準入出力は、キーボード、画面には接続しないようにします。\u003c/span\u003e\n\n\u003cspan class=\"cp\"\u003e#include \u0026lt;string\u0026gt; // std::string\n#include \u0026lt;iostream\u0026gt; // std::cout\n#include \u0026lt;sstream\u0026gt; // std::ostringstream\n#include \u0026lt;chrono\u0026gt;\n#include \u0026lt;thread\u0026gt; // sleep_for\n#include \u0026lt;future\u0026gt; // thread\n\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// プロセス間通信用\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#include \u0026lt;ev.h\u0026gt;\n#include \u0026lt;amqpcpp.h\u0026gt;\n#include \u0026lt;amqpcpp/libev.h\u0026gt;\n\u003c/span\u003e\n\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eAMQP\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eAddress\u003c/span\u003e \u003cspan class=\"n\"\u003eADDRESS\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"s\"\u003e\"amqp://localhost:5672\"\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 0 : enqueue用設定\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 1 : dequeue用設定\u003c/span\u003e\n\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eENQUEUE_INDEX\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eDEQUEUE_INDEX\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eNUM_INDEX\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ename_queues\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"s\"\u003e\"1117\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"1116\"\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan_queues\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"s\"\u003e\"durable\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"durable\"\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// 回転式バッファー。\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// これはメイン・スレッドに置く。\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// デキューのスレッドでエンキューすることはできない。\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// デキュー処理は、回転式バッファーを仲介にしてエンキュー処理にメッセージを渡す。\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"n\"\u003erotationBuffer\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ebufferSize\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e100\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ebufferSize\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{};\u003c/span\u003e\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n    \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ePUT_INDEX\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eGET_INDEX\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003emutex\u003c/span\u003e \u003cspan class=\"n\"\u003e_mutex\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"n\"\u003eputMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eunique_lock\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003emutex\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003elock\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e_mutex\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ePUT_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e]]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ePUT_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ePUT_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003ebufferSize\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ePUT_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003egetMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eunique_lock\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003emutex\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003elock\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e_mutex\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\"\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eGET_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e]])\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eGET_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e]];\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eGET_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e]]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eGET_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eGET_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003ebufferSize\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eGET_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"s\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// メッセージキューにエンキュー\u003c/span\u003e\n\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eenqueue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"nc\"\u003eev_loop\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003eloop\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eAMQP\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eTcpConnection\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003econnection\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eAMQP\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eTcpChannel\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eexchange_name\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"myexchange\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003erouting_key\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan_queues\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eENQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e      \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"durable\"\u003c/span\u003e    \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eAMQP\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003edurable\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"autodelete\"\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eAMQP\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eautodelete\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"passive\"\u003c/span\u003e    \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eAMQP\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003epassive\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"exclusive\"\u003c/span\u003e  \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eAMQP\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eexclusive\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ecerr\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"s\"\u003e\"未対応のキュー寿命が指定されました。[\"\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"s\"\u003e\"]\"\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eendl\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eexit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edeclareQueue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ename_queues\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eENQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eonError\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e](\u003c/span\u003e\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003echar\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003eerrMsg\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ecerr\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"s\"\u003e\"error declaring queue: \"\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003eerrMsg\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"s\"\u003e\" lifeSpan=[\"\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"s\"\u003e\"]\"\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ebindQueue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eexchange_name\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ename_queues\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eENQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003erouting_key\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eonSuccess\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003econnection\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003eexchange_name\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003erouting_key\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e]()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epublish\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eexchange_name\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003erouting_key\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ec_str\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esize\u003c/span\u003e\u003cspan class=\"p\"\u003e()))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ecerr\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"s\"\u003e\"failed to publish?\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// break in ev loop.\u003c/span\u003e\n        \u003cspan class=\"n\"\u003econnection\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eclose\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// このループは、パブリッシュ後に抜ける\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eev_run\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eloop\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// 受信できたときに割り込んでくる処理\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// startConsume() しておくこと。\u003c/span\u003e\n\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003estring\u003c/span\u003e \u003cspan class=\"nf\"\u003edequeue\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003ewhile\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\"\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003emessage\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003erotationBuffer\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003egetMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// メッセージ・キューの監視を開始\u003c/span\u003e\n\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eworkConsume\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// Connect to the AMQP service.\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eauto\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eloop\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eEV_DEFAULT\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eAMQP\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eLibEvHandler\u003c/span\u003e \u003cspan class=\"n\"\u003ehandler\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eloop\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eAMQP\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eTcpConnection\u003c/span\u003e \u003cspan class=\"n\"\u003econnection\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003ehandler\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eADDRESS\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eAMQP\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eTcpChannel\u003c/span\u003e \u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003econnection\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// I will go to the front of the box named \"1111\".\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan_queues\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eDEQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e      \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"durable\"\u003c/span\u003e    \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eAMQP\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003edurable\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"autodelete\"\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eAMQP\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eautodelete\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"passive\"\u003c/span\u003e    \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eAMQP\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003epassive\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"exclusive\"\u003c/span\u003e  \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eAMQP\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eexclusive\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ecerr\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"s\"\u003e\"未対応のキュー寿命が指定されました。[\"\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\"]\"\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eendl\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eexit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edeclareQueue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ename_queues\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eDEQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// I look inside the box.\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eauto\u003c/span\u003e \u003cspan class=\"n\"\u003eerrorCb\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e](\u003c/span\u003e\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eerrMsg\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ecerr\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"s\"\u003e\"My ID watching failed [\"\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003eerrMsg\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"s\"\u003e\"] lifeSpan=[\"\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"s\"\u003e\"]\"\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eendl\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eauto\u003c/span\u003e \u003cspan class=\"n\"\u003emessageCb\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e](\u003c/span\u003e\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003eAMQP\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eMessage\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003euint64_t\u003c/span\u003e \u003cspan class=\"n\"\u003edeliveryTag\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eredelivered\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003emyString\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ebody\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ebodySize\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n        \u003cspan class=\"n\"\u003erotationBuffer\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eputMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emyString\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eack\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edeliveryTag\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n    \u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econsume\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ename_queues\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eDEQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eonReceived\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emessageCb\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eonError\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eerrorCb\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// I will keep on forever.\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eev_run\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eloop\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// I will not come here.\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"nf\"\u003emain\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eargc\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003echar\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003eargv\u003c/span\u003e\u003cspan class=\"p\"\u003e[])\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ecmdArg\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// プログラム名を省き、コマンドライン引数だけをつなげる。\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003eargc\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecmdArg\u003c/span\u003e \u003cspan class=\"o\"\u003e+=\u003c/span\u003e \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eargv\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\" \"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eistringstream\u003c/span\u003e \u003cspan class=\"n\"\u003essCmd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecmdArg\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// 半角スペース区切りの最初の1トークンを拾う\u003c/span\u003e\n    \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003etoken\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003essCmd\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003etoken\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etoken\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e\"--msgqueue\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// ex.) --msgqueue 1115 durable 1114 durable\u003c/span\u003e\n        \u003cspan class=\"n\"\u003essCmd\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ename_queues\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eENQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n        \u003cspan class=\"n\"\u003essCmd\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan_queues\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eENQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n        \u003cspan class=\"n\"\u003essCmd\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ename_queues\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eDEQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n        \u003cspan class=\"n\"\u003essCmd\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan_queues\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eDEQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// デキューの常時監視をスタート\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eauto\u003c/span\u003e \u003cspan class=\"n\"\u003eth1\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"kr\"\u003ethread\u003c/span\u003e\u003cspan class=\"p\"\u003e([]\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003eworkConsume\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// エンキュー用の接続\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//auto* loop = EV_DEFAULT;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"nc\"\u003eev_loop\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003eloop\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eEV_DEFAULT\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eAMQP\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eLibEvHandler\u003c/span\u003e \u003cspan class=\"n\"\u003ehandler\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003eloop\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eAMQP\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eTcpConnection\u003c/span\u003e \u003cspan class=\"n\"\u003econnection\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003ehandler\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eADDRESS\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eAMQP\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eTcpChannel\u003c/span\u003e \u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003econnection\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// 無限ループ\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(;;)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003erotationBuffer\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003egetMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\"\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// 末尾に daze を付ける。\u003c/span\u003e\n            \u003cspan class=\"n\"\u003emessage\u003c/span\u003e \u003cspan class=\"o\"\u003e+=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"daze\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// エンキューする\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eenqueue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eloop\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003econnection\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ethis_thread\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003esleep_for\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003echrono\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003emilliseconds\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e20\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// このプログラムは、自分では接続を切らない。\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// th1 スレッドの終了を待つ\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eth1\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ejoin\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれを改造することにする。\u003c/p\u003e\n\n\u003cp\u003e現状\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eデキューを別スレッドにする\u003c/li\u003e\n\u003cli\u003eエンキューの無限ループを回す\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eにしているが、次のように変える。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eエンキューを別スレッドにする\u003c/li\u003e\n\u003cli\u003eデキューの ev_loop を置いておくに任せる\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e何が違うのか、という気はする。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"名前は-tamesi35a2_cppcpp-にする\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%90%8D%E5%89%8D%E3%81%AF-tamesi35a2_cppcpp-%E3%81%AB%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e名前は tamesi35a2_cpp.cpp にする\u003c/h1\u003e\n\n\u003cp\u003eちょっと待て。\u003c/p\u003e\n\n\u003cp\u003e無限ループの外で接続して、無限ループの中で切断してないか？\u003cbr\u003e\nこれでは　接続と切断の１対１対応が　崩れている。\u003c/p\u003e\n\n\u003cp\u003eいったん、tamesi33a2_cpp.cpp のこの部分を直そう。\u003c/p\u003e\n\n\u003cp\u003etamesi35a2_cpp.cpp\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cpp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// OS      : Windows10 : // このプログラムは動かない\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// OS      : Ubuntu 16.04\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// Library : libev\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//         : Install   : Command  : sudo apt-get update\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//                                : sudo apt-get install libev-dev\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// Service : RabbitMQ\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//         : Reference : Web site : Top page http://www.rabbitmq.com/\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//         : Install   : Web site : Installing on Debian / Ubuntu http://www.rabbitmq.com/install-debian.html\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//         : Manual    : Command  : man rabbitmqctl\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//         : Start     : Command  : rabbitmq-server\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//         : Stop      : Command  : rabbitmqctl stop\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//         : Check     : Command  : rabbitmqctl status\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//         :           : Command  : rabbitmqctl list_queues\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// Library : AMQP-CPP\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//         : Reference : Web site : AMQP-CPP README.md https://github.com/CopernicaMarketingSoftware/AMQP-CPP\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//         : Reference : Web site : QueueDeclare http://docs.spring.io/spring-amqp-net/docs/1.0.x/api/html/Spring.Messaging.Amqp.Rabbit~Spring.Messaging.Amqp.Rabbit.Connection.CachedModel~QueueDeclare(String,Boolean,Boolean,Boolean,Boolean,Boolean,IDictionary).html\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//         : Reference : Web site : EventingBasicConsumer https://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v1.4.0/rabbitmq-dotnet-client-1.4.0-net-2.0-htmldoc/type-RabbitMQ.Client.Events.EventingBasicConsumer.html\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//         : Reference : Web site : BasicConsume https://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v1.4.0/rabbitmq-dotnet-client-1.4.0-net-2.0-htmldoc/type-RabbitMQ.Client.IModel.html#method-M:RabbitMQ.Client.IModel.BasicConsume(System.UInt16,System.String,System.Boolean,System.Collections.IDictionary,RabbitMQ.Client.IBasicConsumer)\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//         : Reference : Web site : C#でconstな配列を実現する (もっとクールにプログラミング) http://pgnote.net/?p=885\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//         : Reference : Web site : AMQP-CPP (docsforge.com) http://docsforge.com/11/AMQP-CPP/docs/latest/namespace-AMQP/class-TcpConnection/\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// Program : this\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//         : Compile   : Command  : g++ -std=c++11 tamesi35a2_cpp.cpp -o tamesi35a2_cpp.exe -lev -lamqpcpp -pthread\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//         : Execute   : Command  : // バックグラウンドで実行\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//                                : ./tamesi35a2_cpp.exe --msgqueue 1117 durable 1116 durable 2\u0026gt; ./tamesi35a2_cpp.err.log \u0026amp;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//         : Stop      : Typing   : [Ctrl]+[C]\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// メッセージの末尾に daze を付けます。\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// デキューは「1112」、エンキューは「1113」キューに向けて行います。\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 標準入出力は、キーボード、画面には接続しないようにします。\u003c/span\u003e\n\n\u003cspan class=\"cp\"\u003e#include \u0026lt;string\u0026gt; // std::string\n#include \u0026lt;iostream\u0026gt; // std::cout\n#include \u0026lt;sstream\u0026gt; // std::ostringstream\n#include \u0026lt;chrono\u0026gt;\n#include \u0026lt;thread\u0026gt; // sleep_for\n#include \u0026lt;future\u0026gt; // thread\n\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// プロセス間通信用\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#include \u0026lt;ev.h\u0026gt;\n#include \u0026lt;amqpcpp.h\u0026gt;\n#include \u0026lt;amqpcpp/libev.h\u0026gt;\n\u003c/span\u003e\n\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eAMQP\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eAddress\u003c/span\u003e \u003cspan class=\"n\"\u003eADDRESS\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"s\"\u003e\"amqp://localhost:5672\"\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 0 : enqueue用設定\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 1 : dequeue用設定\u003c/span\u003e\n\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eENQUEUE_INDEX\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eDEQUEUE_INDEX\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eNUM_INDEX\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ename_queues\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"s\"\u003e\"1117\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"1116\"\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan_queues\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"s\"\u003e\"durable\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"durable\"\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// 回転式バッファー。\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// これはメイン・スレッドに置く。\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// デキューのスレッドでエンキューすることはできない。\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// デキュー処理は、回転式バッファーを仲介にしてエンキュー処理にメッセージを渡す。\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"n\"\u003erotationBuffer\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ebufferSize\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e100\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ebufferSize\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{};\u003c/span\u003e\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n    \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ePUT_INDEX\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eGET_INDEX\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003emutex\u003c/span\u003e \u003cspan class=\"n\"\u003e_mutex\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"n\"\u003eputMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eunique_lock\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003emutex\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003elock\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e_mutex\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ePUT_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e]]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ePUT_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ePUT_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003ebufferSize\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ePUT_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003egetMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eunique_lock\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003emutex\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003elock\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e_mutex\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\"\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eGET_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e]])\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eGET_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e]];\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eGET_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e]]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eGET_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eGET_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003ebufferSize\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eGET_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"s\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// メッセージキューにエンキュー\u003c/span\u003e\n\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eenqueue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// エンキュー用の接続\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//auto* loop = EV_DEFAULT;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"nc\"\u003eev_loop\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003eloop\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eEV_DEFAULT\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eAMQP\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eLibEvHandler\u003c/span\u003e \u003cspan class=\"n\"\u003ehandler\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003eloop\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eAMQP\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eTcpConnection\u003c/span\u003e \u003cspan class=\"n\"\u003econnection\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003ehandler\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eADDRESS\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eAMQP\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eTcpChannel\u003c/span\u003e \u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003econnection\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eexchange_name\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"myexchange\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003erouting_key\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan_queues\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eENQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"durable\"\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eAMQP\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003edurable\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"autodelete\"\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eAMQP\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eautodelete\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"passive\"\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eAMQP\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003epassive\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"exclusive\"\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eAMQP\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eexclusive\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ecerr\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"s\"\u003e\"未対応のキュー寿命が指定されました。[\"\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\"]\"\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eendl\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eexit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edeclareQueue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ename_queues\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eENQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eonError\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e](\u003c/span\u003e\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003echar\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003eerrMsg\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ecerr\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"s\"\u003e\"error declaring queue: \"\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003eerrMsg\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"s\"\u003e\" lifeSpan=[\"\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"s\"\u003e\"]\"\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ebindQueue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eexchange_name\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ename_queues\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eENQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003erouting_key\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eonSuccess\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003econnection\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003eexchange_name\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003erouting_key\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e]()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epublish\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eexchange_name\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003erouting_key\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ec_str\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esize\u003c/span\u003e\u003cspan class=\"p\"\u003e()))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ecerr\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"s\"\u003e\"failed to publish?\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// break in ev loop.\u003c/span\u003e\n        \u003cspan class=\"n\"\u003econnection\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eclose\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// このループは、パブリッシュ後に抜ける\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eev_run\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eloop\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// 受信できたときに割り込んでくる処理\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// startConsume() しておくこと。\u003c/span\u003e\n\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003estring\u003c/span\u003e \u003cspan class=\"nf\"\u003edequeue\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003ewhile\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\"\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003emessage\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003erotationBuffer\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003egetMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e//// メッセージ・キューの送信を担当\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//static void workProduce()\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//{\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//}\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// メッセージ・キューの監視を開始\u003c/span\u003e\n\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eworkConsume\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// Connect to the AMQP service.\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eauto\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eloop\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eEV_DEFAULT\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eAMQP\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eLibEvHandler\u003c/span\u003e \u003cspan class=\"n\"\u003ehandler\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eloop\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eAMQP\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eTcpConnection\u003c/span\u003e \u003cspan class=\"n\"\u003econnection\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003ehandler\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eADDRESS\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eAMQP\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eTcpChannel\u003c/span\u003e \u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003econnection\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// I will go to the front of the box named \"1111\".\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan_queues\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eDEQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"durable\"\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eAMQP\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003edurable\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"autodelete\"\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eAMQP\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eautodelete\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"passive\"\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eAMQP\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003epassive\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"exclusive\"\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eAMQP\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eexclusive\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ecerr\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"s\"\u003e\"未対応のキュー寿命が指定されました。[\"\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\"]\"\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eendl\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eexit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edeclareQueue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ename_queues\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eDEQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// I look inside the box.\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eauto\u003c/span\u003e \u003cspan class=\"n\"\u003eerrorCb\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e](\u003c/span\u003e\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eerrMsg\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ecerr\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"s\"\u003e\"My ID watching failed [\"\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003eerrMsg\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"s\"\u003e\"] lifeSpan=[\"\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"s\"\u003e\"]\"\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eendl\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eauto\u003c/span\u003e \u003cspan class=\"n\"\u003emessageCb\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e](\u003c/span\u003e\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003eAMQP\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eMessage\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003euint64_t\u003c/span\u003e \u003cspan class=\"n\"\u003edeliveryTag\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eredelivered\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003emyString\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ebody\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ebodySize\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n        \u003cspan class=\"n\"\u003erotationBuffer\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eputMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emyString\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eack\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edeliveryTag\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n    \u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econsume\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ename_queues\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eDEQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eonReceived\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emessageCb\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eonError\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eerrorCb\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// I will keep on forever.\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eev_run\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eloop\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// I will not come here.\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"nf\"\u003emain\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eargc\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003echar\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003eargv\u003c/span\u003e\u003cspan class=\"p\"\u003e[])\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ecmdArg\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// プログラム名を省き、コマンドライン引数だけをつなげる。\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003eargc\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecmdArg\u003c/span\u003e \u003cspan class=\"o\"\u003e+=\u003c/span\u003e \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eargv\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\" \"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eistringstream\u003c/span\u003e \u003cspan class=\"n\"\u003essCmd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecmdArg\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// 半角スペース区切りの最初の1トークンを拾う\u003c/span\u003e\n    \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003etoken\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003essCmd\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003etoken\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etoken\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e\"--msgqueue\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// ex.) --msgqueue 1115 durable 1114 durable\u003c/span\u003e\n        \u003cspan class=\"n\"\u003essCmd\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ename_queues\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eENQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n        \u003cspan class=\"n\"\u003essCmd\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan_queues\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eENQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n        \u003cspan class=\"n\"\u003essCmd\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ename_queues\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eDEQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n        \u003cspan class=\"n\"\u003essCmd\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan_queues\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eDEQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// デキューの常時監視をスタート\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eauto\u003c/span\u003e \u003cspan class=\"n\"\u003eth1\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"kr\"\u003ethread\u003c/span\u003e\u003cspan class=\"p\"\u003e([]\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003eworkConsume\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// 無限ループ\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(;;)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003erotationBuffer\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003egetMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\"\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// 末尾に daze を付ける。\u003c/span\u003e\n            \u003cspan class=\"n\"\u003emessage\u003c/span\u003e \u003cspan class=\"o\"\u003e+=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"daze\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// エンキューする\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eenqueue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ethis_thread\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003esleep_for\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003echrono\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003emilliseconds\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e20\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// このプログラムは、自分では接続を切らない。\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// th1 スレッドの終了を待つ\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eth1\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ejoin\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e# g++ -std=c++11 tamesi35a2_cpp.cpp -o tamesi35a2_cpp.exe -lev -lamqpcpp -pthread\n# ./tamesi35a2_cpp.exe --msgqueue 1117 durable 1116 durable 2\u0026gt; ./tamesi35a2_cpp.err.log \u0026amp;\n[1] 20175\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e# ./tamesi33a2_cpp.exe --msgqueue 1117 durable 1116 durable \u0026amp;\n[2] 20225\nMy ID watching failed [Channel is in error state] lifeSpan=[durable]\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eうーむ。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e# ps aux | grep .exe\nroot      1743  3.5  0.0 126580    52 ?        Sl   Mar11 153:59 /usr/bin/cli ./loop28_cs.exe\nroot      1820  0.0  0.0   4216    12 ?        S    Mar11   0:24 ./loop28_cpp.exe\nroot      3554  0.2  0.4 179196  4916 ?        Sl   Mar13   2:11 ./tamesi33a2_cpp.exe\nroot      7457  0.2  0.2 244736  2904 ?        Sl   Mar13   1:49 ./tamesi33a2_cpp.exe --msgqueue 1117 durable 1116 durable\nroot     11288  0.2  0.4 341724  4428 ?        Sl   Mar11   9:53 /usr/bin/cli ./tamesi33a2_cs.exe\nroot     20175  0.2  0.3 170872  3156 pts/6    Sl   07:28   0:00 ./tamesi35a2_cpp.exe --msgqueue 1117 durable 1116 durable\nroot     20225  0.2  0.2 244736  2876 pts/6    Sl   07:31   0:00 ./tamesi33a2_cpp.exe --msgqueue 1117 durable 1116 durable\nroot     20240  0.2  0.2 179200  2984 pts/6    Sl   07:32   0:00 ./tamesi33a2_cpp.exe --msgqueue 1117 durable 1116 durable\nroot     20259  0.0  0.0  12936   988 pts/6    S+   07:33   0:00 grep --color=auto .exe\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eなんか　いっぱい動いてるな。止めるか。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e# kill 1743\n# kill 1820\n# kill 3554\n# kill 7457\n# kill 11288\n# kill 20175\n# kill 20225\n[1]   Terminated              ./tamesi35a2_cpp.exe --msgqueue 1117 durable 1116 durable 2\u0026gt; ./tamesi35a2_cpp.err.log\n# kill 20240\n[2]-  Terminated              ./tamesi33a2_cpp.exe --msgqueue 1117 durable 1116 durable\n# ps aux | grep .exe\nroot     20296  0.0  0.0  12936   984 pts/6    S+   07:35   0:00 grep --color=auto .exe\n[3]+  Terminated              ./tamesi33a2_cpp.exe --msgqueue 1117 durable 1116 durable\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e起動するプログラム番号も間違えてるし。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e# ./tamesi35a2_cpp.exe --msgqueue 1117 durable 1116 durable \u0026amp;\n[1] 20308\nMy ID watching failed [Channel is in error state] lifeSpan=[durable]\n# ./tamesi35a2_cpp.exe --msgqueue 1117 durable 1116 durable \u0026amp;\n[2] 20324\nMy ID watching failed [Channel is in error state] lifeSpan=[durable]\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eうーむ。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e# ./tamesi35a2_cpp.exe --msgqueue 1117 durable 1116 durable 2\u0026gt; ./tamesi35a2_cpp.err.log \u0026amp;\n[3] 20489\nWelcome! AMQP::durable=[1] AMQP::autodelete=[2] AMQP::passive=[8] AMQP::exclusive=[512]\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eためしに値を出力したら　うまくいったぞ？\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e# ./tamesi34_cs.exe\n削除したいキューがあれば名前を、無ければ空文字列を入れろだぜ☆（＾～＾）\nキュー名を入力    : キューを削除します\n空文字列で[Enter] : 次のステップへ進む\nName or empty ? \u0026gt;\nエンキュー先のメッセージ・キューの名前を入れろだぜ☆（＾～＾）\nQueue name? \u0026gt; 1116\nエンキュー先のメッセージ・キューの寿命を、足し算して答えろだぜ☆（＾～＾）\n(1) durable    : RabbitMQが止まってもキューを残す\n(2) autodelete : コンシューマーが１人も接続していなかったら消す\n(4) passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ\n(8) exclusive  : この接続でだけ使える。この接続が切れたら消す\nNumber ? \u0026gt; 1\nデキュー先のメッセージ・キューの名前を入れろだぜ☆（＾～＾）\nQueue name? \u0026gt; 1117\nデキュー先のメッセージ・キューの寿命を、足し算して答えろだぜ☆（＾～＾）\n(1) durable    : RabbitMQが止まってもキューを残す\n(2) autodelete : コンシューマーが１人も接続していなかったら消す\n(4) passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ\n(8) exclusive  : この接続でだけ使える。この接続が切れたら消す\nNumber ? \u0026gt; 1\nGetChannel index = [1]\n    QUEUE_NAMES[index] = [1117]\n    passive_lifeSpans[index] = [False]\n    durable_lifeSpans[index] = [True]\n    exclusive_lifeSpans[index] = [False]\n    autodelete_lifeSpans[index] = [False]\n    nowait は仮に false 固定\n    arguments は仮に null 固定\n終了するときは[Ctrl]+[C]キーを押せだぜ☆（＾～＾）\nエンキューするときはメッセージを打ち込んで[Enter]キーを押せだぜ☆(＾◇＾)\nEnqueue? \u0026gt; usi\nGetChannel index = [0]\n    QUEUE_NAMES[index] = [1116]\n    passive_lifeSpans[index] = [False]\n    durable_lifeSpans[index] = [True]\n    exclusive_lifeSpans[index] = [False]\n    autodelete_lifeSpans[index] = [False]\n    nowait は仮に false 固定\n    arguments は仮に null 固定\n\nUnhandled Exception:\nRabbitMQ.Client.Exceptions.OperationInterruptedException: The AMQP operation was interrupted: AMQP close-reason, initiated by Peer, code=406, text=\"PRECONDITION_FAILED - inequivalent arg 'durable' for queue '1116' in vhost '/': received 'true' but current is 'false'\", classId=50, methodId=10, cause=\n  at RabbitMQ.Client.Impl.SimpleBlockingRpcContinuation.GetReply () \u0026lt;0x41a50410 + 0x00107\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at RabbitMQ.Client.Impl.ModelBase.ModelRpc (RabbitMQ.Client.Impl.MethodBase method, RabbitMQ.Client.Impl.ContentHeaderBase header, System.Byte[] body) \u0026lt;0x41a4e290 + 0x000fd\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at RabbitMQ.Client.Framing.Impl.v0_8.Model.QueueDeclare (System.String queue, Boolean passive, Boolean durable, Boolean exclusive, Boolean autoDelete, Boolean nowait, IDictionary arguments) \u0026lt;0x41a526b0 + 0x00113\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at UsagiMQ.Program.GetChannel (Int32 index) \u0026lt;0x41a13d20 + 0x00436\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at UsagiMQ.Program.Enqueue (System.String message) \u0026lt;0x41a537c0 + 0x00013\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at UsagiMQ.Program.Main (System.String[] args) \u0026lt;0x41a0ed50 + 0x0099f\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n[ERROR] FATAL UNHANDLED EXCEPTION: RabbitMQ.Client.Exceptions.OperationInterruptedException: The AMQP operation was interrupted: AMQP close-reason, initiated by Peer, code=406, text=\"PRECONDITION_FAILED - inequivalent arg 'durable' for queue '1116' in vhost '/': received 'true' but current is 'false'\", classId=50, methodId=10, cause=\n  at RabbitMQ.Client.Impl.SimpleBlockingRpcContinuation.GetReply () \u0026lt;0x41a50410 + 0x00107\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at RabbitMQ.Client.Impl.ModelBase.ModelRpc (RabbitMQ.Client.Impl.MethodBase method, RabbitMQ.Client.Impl.ContentHeaderBase header, System.Byte[] body) \u0026lt;0x41a4e290 + 0x000fd\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at RabbitMQ.Client.Framing.Impl.v0_8.Model.QueueDeclare (System.String queue, Boolean passive, Boolean durable, Boolean exclusive, Boolean autoDelete, Boolean nowait, IDictionary arguments) \u0026lt;0x41a526b0 + 0x00113\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at UsagiMQ.Program.GetChannel (Int32 index) \u0026lt;0x41a13d20 + 0x00436\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at UsagiMQ.Program.Enqueue (System.String message) \u0026lt;0x41a537c0 + 0x00013\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at UsagiMQ.Program.Main (System.String[] args) \u0026lt;0x41a0ed50 + 0x0099f\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこのエラーも分からずじまい。\u003c/p\u003e\n\n\u003cp\u003e接続部分を直そう。\u003c/p\u003e\n\n\u003cp\u003eあれっ、直してこれか。\u003c/p\u003e\n\n\u003cp\u003eじゃあ、C++ と C# で送受信テストしてみよう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e# ps aux | grep exe\nroot     20308  0.2  0.3 170872  3156 pts/6    Sl   07:35   0:02 ./tamesi35a2_cpp.exe --msgqueue 1117 durable 1116 durable\nroot     20324  0.2  0.5 170872  5188 pts/6    Sl   07:36   0:01 ./tamesi35a2_cpp.exe --msgqueue 1117 durable 1116 durable\nroot     20489  0.2  0.3 170872  3136 pts/6    Sl   07:42   0:00 ./tamesi35a2_cpp.exe --msgqueue 1117 durable 1116 durable\nroot     20587  0.0  0.0  12936   988 pts/6    S+   07:48   0:00 grep --color=auto exe\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eなんで　こんなにプロセス立ってるんだろな。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"c-ではシングルトンでやってた\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#c-%E3%81%A7%E3%81%AF%E3%82%B7%E3%83%B3%E3%82%B0%E3%83%AB%E3%83%88%E3%83%B3%E3%81%A7%E3%82%84%E3%81%A3%E3%81%A6%E3%81%9F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eC# ではシングルトンでやってた\u003c/h1\u003e\n\n\u003cp\u003etamesi33a2_cs.cs\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// OS  : Windows 10\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// IDE : Visual Studio 2015\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//       Install : NuGet   : Install-Package RabbitMQ.Client -Version 4.1.1\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// OS  : Ubuntu 16.04\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//       Compile : Command : mcs /r:RabbitMQ.Client.dll -define:UBUNTU tamesi33a2_cs.cs\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//               : Command : chmod 755 tamesi33a2_cs.cs\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//       Execute : Command : // バックグラウンドで実行する\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//                         : nohup ./tamesi33a2_cs.exe \u0026gt; ./tamesi33a2_cs.out.log 2\u0026gt; ./tamesi33a2_cs.err.log \u0026lt; /dev/null \u0026amp;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//       Check   :         : // tamesi33a1_cs.exe を使う\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//--------------------------------------------------------------------------------\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// tamesi33a2_cs.cs\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// Ubuntu の RabbitMQ はソースのバージョンが古いのか、API が異なった。\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// #define UBUNTU\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eRabbitMQ.Client\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eRabbitMQ.Client.Events\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Collections.ObjectModel\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Text\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Threading\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eUsagiMQ\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// メッセージの末尾に daze を付けます。\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// デキューは「1112」、エンキューは「1113」キューに向けて行います。\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// 標準入出力は、キーボード、画面には接続しないようにします。\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// 参照 : QueueDeclare http://docs.spring.io/spring-amqp-net/docs/1.0.x/api/html/Spring.Messaging.Amqp.Rabbit~Spring.Messaging.Amqp.Rabbit.Connection.CachedModel~QueueDeclare(String,Boolean,Boolean,Boolean,Boolean,Boolean,IDictionary).html\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// 参照 : EventingBasicConsumer https://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v1.4.0/rabbitmq-dotnet-client-1.4.0-net-2.0-htmldoc/type-RabbitMQ.Client.Events.EventingBasicConsumer.html\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// 参照 : BasicConsume https://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v1.4.0/rabbitmq-dotnet-client-1.4.0-net-2.0-htmldoc/type-RabbitMQ.Client.IModel.html#method-M:RabbitMQ.Client.IModel.BasicConsume(System.UInt16,System.String,System.Boolean,System.Collections.IDictionary,RabbitMQ.Client.IBasicConsumer)\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// 参照 : C#でconstな配列を実現する (もっとクールにプログラミング) http://pgnote.net/?p=885\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eProgram\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eHOST_NAME\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"localhost\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eReadOnlyCollection\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eQUEUE_NAMES\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eArray\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAsReadOnly\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"s\"\u003e\"1113\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"1112\"\u003c/span\u003e \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eENQUEUE_INDEX\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eDEQUEUE_INDEX\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// 回転式バッファー\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eRotationBuffer\u003c/span\u003e \u003cspan class=\"n\"\u003erollingBuffer\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eRotationBuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eConnectionFactory\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetFactory\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003em_factory_\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003em_factory_\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eConnectionFactory\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003eHostName\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eHOST_NAME\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003em_factory_\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eConnectionFactory\u003c/span\u003e \u003cspan class=\"n\"\u003em_factory_\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eIConnection\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetConnection\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003em_connection_\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003em_connection_\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetFactory\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateConnection\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003em_connection_\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eIConnection\u003c/span\u003e \u003cspan class=\"n\"\u003em_connection_\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"nf\"\u003eIsConnected\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003em_connection_\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003em_connection_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIsOpen\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eIModel\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetChannel\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003em_channels_\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003em_channels_\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetConnection\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateModel\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#if UBUNTU\n\u003c/span\u003e                \u003cspan class=\"c1\"\u003e// Ubuntuでは何故か Spring.Messaging.Amqp.Rabbit の引数 7 つのやつになっている。\u003c/span\u003e\n                \u003cspan class=\"n\"\u003em_channels_\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nf\"\u003eQueueDeclare\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eQUEUE_NAMES\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#else\n\u003c/span\u003e                \u003cspan class=\"n\"\u003em_channels_\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nf\"\u003eQueueDeclare\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eQUEUE_NAMES\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#endif\n\u003c/span\u003e            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003em_channels_\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eIModel\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003em_channels_\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eIModel\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eEventingBasicConsumer\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetConsumer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003em_consumers_\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#if UBUNTU\n\u003c/span\u003e                \u003cspan class=\"c1\"\u003e// Ubuntuでは何故か v1.4.0 の引数が 0 個のやつになっている。調べたが引数が1個～6個のものは無かった。\u003c/span\u003e\n                \u003cspan class=\"n\"\u003em_consumers_\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eEventingBasicConsumer\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#else\n\u003c/span\u003e                \u003cspan class=\"n\"\u003em_consumers_\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eEventingBasicConsumer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetChannel\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#endif\n\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003em_consumers_\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eEventingBasicConsumer\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003em_consumers_\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eEventingBasicConsumer\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// 受信できたときに割り込んでくる処理\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#if UBUNTU\n\u003c/span\u003e        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eBasicDeliverEventHandler\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetReceiveHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#else\n\u003c/span\u003e        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eEventHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eBasicDeliverEventArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetReceiveHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#endif\n\u003c/span\u003e        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003em_eventHandler_\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#if UBUNTU\n\u003c/span\u003e                \u003cspan class=\"n\"\u003em_eventHandler_\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eBasicDeliverEventHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003emodel\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eea\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#else\n\u003c/span\u003e                \u003cspan class=\"n\"\u003em_eventHandler_\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eEventHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eBasicDeliverEventArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;((\u003c/span\u003e\u003cspan class=\"n\"\u003emodel\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eea\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#endif\n\u003c/span\u003e                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003ebody\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eea\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBody\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                    \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eEncoding\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUTF8\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetString\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebody\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n                    \u003cspan class=\"c1\"\u003e// 末尾に daze を付ける。\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003emessage\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"daze\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n                    \u003cspan class=\"c1\"\u003e// 回転式バッファーに入れる\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003erollingBuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ePutMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003em_eventHandler_\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"cp\"\u003e#if UBUNTU\n\u003c/span\u003e        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eBasicDeliverEventHandler\u003c/span\u003e \u003cspan class=\"n\"\u003em_eventHandler_\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#else\n\u003c/span\u003e        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eEventHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eBasicDeliverEventArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003em_eventHandler_\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#endif\n\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// 対応するオープンは無いけれど、開けたら閉める、を完璧に対応する必要がある。\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eCloseChannel\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003em_channels_\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003em_channels_\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nf\"\u003eClose\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n                \u003cspan class=\"n\"\u003em_channels_\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eMain\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// 常時監視をスタート\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eStartDequeue\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// 無限ループ\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ewhile\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nf\"\u003eIsConnected\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003erollingBuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"c1\"\u003e// エンキューする\u003c/span\u003e\n                    \u003cspan class=\"nf\"\u003eEnqueue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eThread\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSleep\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e20\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// このプログラムは、自分では接続を切らない。\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eEnqueue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eIModel\u003c/span\u003e \u003cspan class=\"n\"\u003echannel\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetChannel\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eENQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003ebody\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eEncoding\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUTF8\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetBytes\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eBasicPublish\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eQUEUE_NAMES\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eENQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ebody\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// 対応するオープンは無いが、ちゃんと閉じないと、レシーブしてくれない。\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eCloseChannel\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eENQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eStartDequeue\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eIModel\u003c/span\u003e \u003cspan class=\"n\"\u003echannel\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetChannel\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDEQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eEventingBasicConsumer\u003c/span\u003e \u003cspan class=\"n\"\u003econsumer\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetConsumer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDEQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// 受信できたときに割り込んでくる処理\u003c/span\u003e\n            \u003cspan class=\"n\"\u003econsumer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eReceived\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetReceiveHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n\u003cspan class=\"cp\"\u003e#if UBUNTU\n\u003c/span\u003e            \u003cspan class=\"c1\"\u003e// Ubuntuでは何故か引数が 5 個のやつになっている。\u003c/span\u003e\n            \u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eBasicConsume\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003eQUEUE_NAMES\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eDEQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003econsumer\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#else\n\u003c/span\u003e            \u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eBasicConsume\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003eQUEUE_NAMES\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eDEQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003econsumer\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#endif\n\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// 割込み処理の削除\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// consumer.Received -= GetReceiveHandler();\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// 対応するオープンは無いが、ちゃんと閉じないと、レシーブしてくれない。\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// CloseChannel(DEQUEUE_INDEX);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// 回転式バッファー。\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// これはメイン・スレッドに置く。\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// デキューのスレッドでエンキューすることはできない。\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// デキュー処理は、回転式バッファーを仲介にしてエンキュー処理にメッセージを渡す。\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eRotationBuffer\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ebufferSize\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e100\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ebufferSize\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ePUT_INDEX\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eGET_INDEX\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003ePutMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ePUT_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e]]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ePUT_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e]++;\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(!(\u003c/span\u003e\u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ePUT_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003ebufferSize\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ePUT_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eGET_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e]])\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eGET_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e]];\u003c/span\u003e\n                \u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eGET_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e]]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eGET_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e]++;\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(!(\u003c/span\u003e\u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eGET_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003ebufferSize\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eGET_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"番号を合わせて-tamesi35a2_cscs-に変えてみる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%95%AA%E5%8F%B7%E3%82%92%E5%90%88%E3%82%8F%E3%81%9B%E3%81%A6-tamesi35a2_cscs-%E3%81%AB%E5%A4%89%E3%81%88%E3%81%A6%E3%81%BF%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e番号を合わせて tamesi35a2_cs.cs に変えてみる\u003c/h2\u003e\n\n\u003cp\u003eキュー名も選べるように改造しよう。 tamesi34_cs.cs ではそういう機能を入れていた。\u003c/p\u003e\n\n\u003cp\u003etamesi34_cs.cs\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// OS  : Windows 10\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// IDE : Visual Studio 2015\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//       Install : NuGet   : Install-Package RabbitMQ.Client -Version 4.1.1\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// OS  : Ubuntu 16.04\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//       Compile : Command : mcs /r:RabbitMQ.Client.dll -define:UBUNTU tamesi34_cs.cs\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//               : Command : // chmod 755 tamesi34_cs.cs\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//       Execute : Command : // フォアグラウンドで実行する\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//                         : ./tamesi34_cs.exe 2\u0026gt; ./tamesi34_cs.err.log\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//       Check   : Command : // キューの中身の数を調べる\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//                         : rabbitmqctl list_queues\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// Library : RabbitMQ\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//           Refference : Website : RabbitMQ http://www.rabbitmq.com/\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//                      : Website : RabbitMQ管理コマンド（rabbitmqctl）使い方 (Qiita) http://qiita.com/tamikura@github/items/5293cda4c0026b2d7022\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//                      : Website : amqpを使ってRabbitMQのキューを操作する (Qiita) http://qiita.com/tamikura@github/items/a268afa51c5537ca4fe6\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//--------------------------------------------------------------------------------\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// tamesi34_cs.cs\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// Ubuntu の RabbitMQ はソースのバージョンが古いのか、API が異なった。\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// #define UBUNTU\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eRabbitMQ.Client\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eRabbitMQ.Client.Events\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Text\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"nn\"\u003eUsagiMQ\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eenum\u003c/span\u003e \u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// RabbitMQが止まってもキューを残す\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eDurable\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// コンシューマーが１人も接続していなかったら消す\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eAutodelete\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x1\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// キューが存在するかどうかチェックするだけ。中身見ない時これ\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ePassive\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x1\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// この接続でだけ使える。この接続が切れたら消す\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eExclusive\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x1\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"m\"\u003e3\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// メッセージを　エンキューします。\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// キューの名前は指定してください。\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// デキューは割込みを受け付けます。\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// 参照 : QueueDeclare (v1.0) http://docs.spring.io/spring-amqp-net/docs/1.0.x/api/html/Spring.Messaging.Amqp.Rabbit~Spring.Messaging.Amqp.Rabbit.Connection.CachedModel~QueueDeclare(String,Boolean,Boolean,Boolean,Boolean,Boolean,IDictionary).html\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// 参照 : EventingBasicConsumer https://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v1.4.0/rabbitmq-dotnet-client-1.4.0-net-2.0-htmldoc/type-RabbitMQ.Client.Events.EventingBasicConsumer.html\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// 参照 : QueueDelete (v1.4) https://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v1.4.0/rabbitmq-dotnet-client-1.4.0-net-2.0-htmldoc/type-RabbitMQ.Client.IModel.html#method-M:RabbitMQ.Client.IModel.QueueDelete(System.UInt16,System.String,System.Boolean,System.Boolean,System.Boolean)\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// 参照 : BasicConsume https://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v1.4.0/rabbitmq-dotnet-client-1.4.0-net-2.0-htmldoc/type-RabbitMQ.Client.IModel.html#method-M:RabbitMQ.Client.IModel.BasicConsume(System.UInt16,System.String,System.Boolean,System.Collections.IDictionary,RabbitMQ.Client.IBasicConsumer)\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// 参照 : C#でconstな配列を実現する (もっとクールにプログラミング) http://pgnote.net/?p=885\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eProgram\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eENQUEUE_INDEX\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eDEQUEUE_INDEX\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eDELETEQUEUE_INDEX\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eNUM_INDEX\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eHOST_NAME\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"localhost\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003eQUEUE_NAMES\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eNUM_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// キューの寿命（複合可能）\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// durable    : RabbitMQが止まってもキューを残す\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// autodelete : コンシューマーが１人も接続していなかったら消す\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// exclusive  : この接続でだけ使える。この接続が切れたら消す\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpans_queue\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eNUM_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e\n            \u003cspan class=\"n\"\u003edurable_lifeSpans\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eNUM_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eautodelete_lifeSpans\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eNUM_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n            \u003cspan class=\"n\"\u003epassive_lifeSpans\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eNUM_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eexclusive_lifeSpans\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eNUM_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;param name=\"index_queue\"\u0026gt;\u0026lt;/param\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;param name=\"name_queue\"\u0026gt;\u0026lt;/param\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;param name=\"lifeSpan\"\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// (0) durable\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// (1) autodelete\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// (2) passive\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// (3) exclusive\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;/param\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eSetLifeSpan\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eindex_queue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ename_queue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eQUEUE_NAMES\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex_queue\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ename_queue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003elifeSpans_queue\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex_queue\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// 一旦クリアー\u003c/span\u003e\n            \u003cspan class=\"n\"\u003edurable_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex_queue\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eautodelete_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex_queue\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003epassive_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex_queue\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eexclusive_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex_queue\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// durable\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(((\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003elifeSpan\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDurable\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDurable\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003edurable_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex_queue\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// autodelete\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(((\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003elifeSpan\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAutodelete\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAutodelete\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003eautodelete_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex_queue\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// passive\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(((\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003elifeSpan\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePassive\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePassive\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003epassive_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex_queue\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// exclusive\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(((\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003elifeSpan\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eExclusive\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eExclusive\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003eexclusive_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex_queue\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eConnectionFactory\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetFactory\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003em_factory_\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003em_factory_\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eConnectionFactory\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003eHostName\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eHOST_NAME\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003em_factory_\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eConnectionFactory\u003c/span\u003e \u003cspan class=\"n\"\u003em_factory_\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eIConnection\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetConnection\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003em_connection_\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003em_connection_\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetFactory\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateConnection\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003em_connection_\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eIConnection\u003c/span\u003e \u003cspan class=\"n\"\u003em_connection_\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eIModel\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetChannel\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003em_channels_\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003em_channels_\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetConnection\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateModel\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n                \u003cspan class=\"c1\"\u003e// 引数が7つの QueueDeclare でエラーを吐くことがあるので、情報を出力しておく。\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eError\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"GetChannel index = [\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\"]\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eError\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"    QUEUE_NAMES[index] = [\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eQUEUE_NAMES\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\"]\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eError\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"    passive_lifeSpans[index] = [\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003epassive_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\"]\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eError\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"    durable_lifeSpans[index] = [\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003edurable_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\"]\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eError\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"    exclusive_lifeSpans[index] = [\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eexclusive_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\"]\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eError\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"    autodelete_lifeSpans[index] = [\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eautodelete_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\"]\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eError\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"    nowait は仮に false 固定\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eError\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"    arguments は仮に null 固定\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"cp\"\u003e#if UBUNTU\n\u003c/span\u003e                \u003cspan class=\"c1\"\u003e// Ubuntuでは何故か Spring.Messaging.Amqp.Rabbit の引数 7 つのやつになっている。\u003c/span\u003e\n                \u003cspan class=\"n\"\u003em_channels_\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nf\"\u003eQueueDeclare\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eQUEUE_NAMES\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003epassive_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003edurable_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003eexclusive_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003eautodelete_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#else\n\u003c/span\u003e                \u003cspan class=\"n\"\u003em_channels_\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nf\"\u003eQueueDeclare\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eQUEUE_NAMES\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003edurable_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003eexclusive_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003eautodelete_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#endif\n\u003c/span\u003e            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003em_channels_\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eIModel\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003em_channels_\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eIModel\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eNUM_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eEventingBasicConsumer\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetConsumer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003em_consumers_\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#if UBUNTU\n\u003c/span\u003e                \u003cspan class=\"c1\"\u003e// Ubuntuでは何故か v1.4.0 の引数が 0 個のやつになっている。調べたが引数が1個～6個のものは無かった。\u003c/span\u003e\n                \u003cspan class=\"n\"\u003em_consumers_\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eEventingBasicConsumer\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#else\n\u003c/span\u003e                \u003cspan class=\"n\"\u003em_consumers_\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eEventingBasicConsumer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetChannel\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#endif\n\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003em_consumers_\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eEventingBasicConsumer\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003em_consumers_\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eEventingBasicConsumer\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eNUM_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// 受信できたときに割り込んでくる処理\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#if UBUNTU\n\u003c/span\u003e        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eBasicDeliverEventHandler\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetDequeueHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#else\n\u003c/span\u003e        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eEventHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eBasicDeliverEventArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetDequeueHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#endif\n\u003c/span\u003e        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003em_dequeueHandler_\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#if UBUNTU\n\u003c/span\u003e                \u003cspan class=\"n\"\u003em_dequeueHandler_\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eBasicDeliverEventHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003emodel\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eea\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#else\n\u003c/span\u003e                \u003cspan class=\"n\"\u003em_dequeueHandler_\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eEventHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eBasicDeliverEventArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;((\u003c/span\u003e\u003cspan class=\"n\"\u003emodel\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eea\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#endif\n\u003c/span\u003e                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003ebody\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eea\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBody\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                    \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eEncoding\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUTF8\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetString\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebody\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u0026lt;---- [interrupt!] Dequeue(^q^) {0}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003em_dequeueHandler_\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"cp\"\u003e#if UBUNTU\n\u003c/span\u003e        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eBasicDeliverEventHandler\u003c/span\u003e \u003cspan class=\"n\"\u003em_dequeueHandler_\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#else\n\u003c/span\u003e        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eEventHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eBasicDeliverEventArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003em_dequeueHandler_\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#endif\n\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// 対応するオープンは無いけれど、開けたら閉める、を完璧に対応する必要がある。\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eCloseConnection\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003em_connection_\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003em_connection_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eClose\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n                \u003cspan class=\"n\"\u003em_connection_\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// 対応するオープンは無いけれど、開けたら閉める、を完璧に対応する必要がある。\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eCloseChannel\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003em_channels_\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003em_channels_\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nf\"\u003eClose\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n                \u003cspan class=\"n\"\u003em_channels_\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eMain\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e//----------------------------------------\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// Delete\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e//----------------------------------------\u003c/span\u003e\n            \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(;;)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e@\"削除したいキューがあれば名前を、無ければ空文字列を入れろだぜ☆（＾～＾）\nキュー名を入力    : キューを削除します\n空文字列で[Enter] : 次のステップへ進む\nName or empty ? \u0026gt; \"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003equeueName_delete\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReadLine\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003equeueName_delete\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\n                \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e@\"削除するメッセージ・キューの寿命を、足し算して答えろだぜ☆（＾～＾）\n(\"\u003c/span\u003e\u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDurable\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e@\") durable    : RabbitMQが止まってもキューを残す\n(\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAutodelete\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e@\") autodelete : コンシューマーが１人も接続していなかったら消す\n(\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePassive\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e@\") passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ\n(\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eExclusive\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e@\") exclusive  : この接続でだけ使える。この接続が切れたら消す\nNumber ? \u0026gt; \"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan_delete\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eParse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReadLine\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n                \u003cspan class=\"nf\"\u003eSetLifeSpan\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDELETEQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003equeueName_delete\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan_delete\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"kt\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003eresult\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eDeleteQueue\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e@\"[\"\u003c/span\u003e\u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003equeueName_delete\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\"]キューを削除したはずだぜ☆（＾～＾） result=[\"\u003c/span\u003e\u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eresult\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\"]\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e//----------------------------------------\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// Enqueue settings\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e//----------------------------------------\u003c/span\u003e\n            \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(;;)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e@\"エンキュー先のメッセージ・キューの名前を入れろだぜ☆（＾～＾）\nQueue name? \u0026gt; \"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003equeueName_enqueue\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReadLine\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n                \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e@\"エンキュー先のメッセージ・キューの寿命を、足し算して答えろだぜ☆（＾～＾）\n(\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDurable\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e@\") durable    : RabbitMQが止まってもキューを残す\n(\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAutodelete\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e@\") autodelete : コンシューマーが１人も接続していなかったら消す\n(\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePassive\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e@\") passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ\n(\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eExclusive\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e@\") exclusive  : この接続でだけ使える。この接続が切れたら消す\nNumber ? \u0026gt; \"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan_enqueue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eTryParse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReadLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e\u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan_enqueue\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"nf\"\u003eSetLifeSpan\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eENQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003equeueName_enqueue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003elifeSpan_enqueue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e//----------------------------------------\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// Enqueue settings\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e//----------------------------------------\u003c/span\u003e\n            \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(;;)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e@\"デキュー先のメッセージ・キューの名前を入れろだぜ☆（＾～＾）\nQueue name? \u0026gt; \"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003equeueName_dequeue\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReadLine\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n                \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e@\"デキュー先のメッセージ・キューの寿命を、足し算して答えろだぜ☆（＾～＾）\n(\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDurable\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e@\") durable    : RabbitMQが止まってもキューを残す\n(\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAutodelete\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e@\") autodelete : コンシューマーが１人も接続していなかったら消す\n(\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePassive\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e@\") passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ\n(\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eExclusive\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e@\") exclusive  : この接続でだけ使える。この接続が切れたら消す\nNumber ? \u0026gt; \"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan_dequeue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eTryParse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReadLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e\u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan_dequeue\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"nf\"\u003eStartConsume\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003equeueName_dequeue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003elifeSpan_dequeue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n            \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e@\"終了するときは[Ctrl]+[C]キーを押せだぜ☆（＾～＾）\nエンキューするときはメッセージを打ち込んで[Enter]キーを押せだぜ☆(＾◇＾)\nEnqueue? \u0026gt; \"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(;;)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// \"Hello World!\" などを入力\u003c/span\u003e\n                \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eline\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReadLine\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n                \u003cspan class=\"nf\"\u003eEnqueue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eline\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e@\"Enqueue? \u0026gt; \"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// ここには来ない\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// CloseConnection();\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003euint\u003c/span\u003e \u003cspan class=\"nf\"\u003eDeleteQueue\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eIModel\u003c/span\u003e \u003cspan class=\"n\"\u003echannel\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetChannel\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDELETEQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"cp\"\u003e#if UBUNTU\n\u003c/span\u003e            \u003cspan class=\"c1\"\u003e// Ubuntuでは何故か 昔の .Net 用の引数 5 つのやつの変則版になっている。\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// uint QueueDelete(ushort ticket, string queue, bool ifUnused, bool ifEmpty, bool nowait)\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003eresult\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eQueueDelete\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003eQUEUE_NAMES\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eDELETEQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#else\n\u003c/span\u003e            \u003cspan class=\"kt\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003eresult\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eQueueDelete\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eQUEUE_NAMES\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eDELETEQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#endif\n\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// 対応するオープンは無いが、ちゃんと閉じないと、レシーブしてくれない。\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eCloseChannel\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDELETEQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eresult\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eEnqueue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eIModel\u003c/span\u003e \u003cspan class=\"n\"\u003echannel\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetChannel\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eENQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003ebody\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eEncoding\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUTF8\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetBytes\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eBasicPublish\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eQUEUE_NAMES\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eENQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ebody\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\" Enqueue(^q^) {0}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// 対応するオープンは無いが、ちゃんと閉じないと、レシーブしてくれない。\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eCloseChannel\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eENQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;param name=\"name_queue\"\u0026gt;メッセージ・キューの名前\u0026lt;/param\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;param name=\"lifeSpan_queue\"\u0026gt;既存のメッセージ・キューの場合、メッセージ・キューの設定は合わせる必要がある。\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// durable    : RabbitMQが止まってもキューを残す\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// autodelete : コンシューマーが１人も接続していなかったら消す\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// passive    : キューが存在するかどうかチェックするだけで、中身を見ない時はこれ\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// exclusive  : この接続でだけ使える。この接続が切れたら消す\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e/// \u0026lt;/param\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eStartConsume\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ename_queue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan_queue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eSetLifeSpan\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDEQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ename_queue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan_queue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"n\"\u003eIModel\u003c/span\u003e \u003cspan class=\"n\"\u003echannel\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetChannel\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDEQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eEventingBasicConsumer\u003c/span\u003e \u003cspan class=\"n\"\u003econsumer\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetConsumer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDEQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// 受信できたときに割り込んでくる処理\u003c/span\u003e\n            \u003cspan class=\"n\"\u003econsumer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eReceived\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetDequeueHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n\u003cspan class=\"cp\"\u003e#if UBUNTU\n\u003c/span\u003e            \u003cspan class=\"c1\"\u003e// Ubuntuでは何故か引数が 5 個のやつになっている。\u003c/span\u003e\n            \u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eBasicConsume\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003eQUEUE_NAMES\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eDEQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003econsumer\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#else\n\u003c/span\u003e            \u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eBasicConsume\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003eQUEUE_NAMES\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eDEQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003econsumer\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#endif\n\u003c/span\u003e            \u003cspan class=\"c1\"\u003e// 終了はさせない\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// consumer.Received -= GetReceiveHandler();\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// CloseChannel(DEQUEUE_INDEX);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eQueryDeclare の引数は false の方が良かったんだろうか？\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e#if UBUNTU\n            // Ubuntuでは何故か Spring.Messaging.Amqp.Rabbit の引数 7 つのやつになっている。\n            // m_channels_[index].QueueDeclare(QUEUE_NAMES[index], false, false, false, false, false, null);\n            m_channels_[index].QueueDeclare(QUEUE_NAMES[index], passive_lifeSpans[index], durable_lifeSpans[index], exclusive_lifeSpans[index], autodelete_lifeSpans[index], false, null);\n#else\n            //m_channels_[index].QueueDeclare(QUEUE_NAMES[index], false, false, false, null);\n            m_channels_[index].QueueDeclare(QUEUE_NAMES[index], durable_lifeSpans[index], exclusive_lifeSpans[index], autodelete_lifeSpans[index], null);\n#endif\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこんなコードでいいんだろうか？\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e//--------------------------------------------------------------------------------\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// tamesi35a2_cs.cs\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// メッセージの末尾に daze を付けます。\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 標準入出力は、キーボード、画面には接続しないようにします。\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// キューの名前は指定してください。\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// デキューは割込みを受け付けます。\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//--------------------------------------------------------------------------------\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// OS  : Windows 10\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// IDE : Visual Studio 2015\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//       Install : NuGet   : Install-Package RabbitMQ.Client -Version 4.1.1\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// OS  : Ubuntu 16.04\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//       Compile : Command : mcs /r:RabbitMQ.Client.dll -define:UBUNTU tamesi35a2_cs.cs\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//               : Command : // chmod 755 tamesi35a2_cs.cs\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//       Execute : Command : // バックグラウンドで実行する\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//                         : nohup ./tamesi35a2_cs.exe \u0026gt; ./tamesi35a2_cs.out.log 2\u0026gt; ./tamesi35a2_cs.err.log \u0026lt; /dev/null \u0026amp;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//       Check   :         : // tamesi33a1_cs.exe を使う\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//--------------------------------------------------------------------------------\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// Ubuntu の RabbitMQ はソースのバージョンが古いのか、API が異なった。\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// #define UBUNTU\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eRabbitMQ.Client\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eRabbitMQ.Client.Events\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Text\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Threading\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// このプログラム内だけで使われる数字。AMQP-CPPでの実装とは異なる。\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// AMQP-CPPでの実装 : AMQP::durable=[1] AMQP::autodelete=[2] AMQP::passive=[8] AMQP::exclusive=[512]\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003cspan class=\"k\"\u003eenum\u003c/span\u003e \u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// RabbitMQが止まってもキューを残す\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eDurable\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// コンシューマーが１人も接続していなかったら消す\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eAutodelete\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x1\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// キューが存在するかどうかチェックするだけ。中身見ない時これ\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ePassive\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x1\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// この接続でだけ使える。この接続が切れたら消す\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eExclusive\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x1\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"m\"\u003e3\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// 参照 : QueueDeclare http://docs.spring.io/spring-amqp-net/docs/1.0.x/api/html/Spring.Messaging.Amqp.Rabbit~Spring.Messaging.Amqp.Rabbit.Connection.CachedModel~QueueDeclare(String,Boolean,Boolean,Boolean,Boolean,Boolean,IDictionary).html\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// 参照 : EventingBasicConsumer https://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v1.4.0/rabbitmq-dotnet-client-1.4.0-net-2.0-htmldoc/type-RabbitMQ.Client.Events.EventingBasicConsumer.html\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// 参照 : BasicConsume https://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v1.4.0/rabbitmq-dotnet-client-1.4.0-net-2.0-htmldoc/type-RabbitMQ.Client.IModel.html#method-M:RabbitMQ.Client.IModel.BasicConsume(System.UInt16,System.String,System.Boolean,System.Collections.IDictionary,RabbitMQ.Client.IBasicConsumer)\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// 参照 : C#でconstな配列を実現する (もっとクールにプログラミング) http://pgnote.net/?p=885\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eProgram\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eENQUEUE_INDEX\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eDEQUEUE_INDEX\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eDELETEQUEUE_INDEX\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eNUM_INDEX\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eHOST_NAME\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"localhost\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003eQUEUE_NAMES\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eNUM_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// キューの寿命（複合可能）\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// durable    : RabbitMQが止まってもキューを残す\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// autodelete : コンシューマーが１人も接続していなかったら消す\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// exclusive  : この接続でだけ使える。この接続が切れたら消す\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpans_queue\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eNUM_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e\n        \u003cspan class=\"n\"\u003edurable_lifeSpans\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eNUM_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eautodelete_lifeSpans\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eNUM_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n        \u003cspan class=\"n\"\u003epassive_lifeSpans\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eNUM_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eexclusive_lifeSpans\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eNUM_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eSetLifeSpan\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eindex_queue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ename_queue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eQUEUE_NAMES\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex_queue\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ename_queue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003elifeSpans_queue\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex_queue\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// 一旦クリアー\u003c/span\u003e\n        \u003cspan class=\"n\"\u003edurable_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex_queue\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eautodelete_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex_queue\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003epassive_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex_queue\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eexclusive_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex_queue\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// durable\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(((\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003elifeSpan\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDurable\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDurable\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003edurable_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex_queue\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// autodelete\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(((\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003elifeSpan\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAutodelete\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAutodelete\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003eautodelete_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex_queue\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// passive\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(((\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003elifeSpan\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePassive\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePassive\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003epassive_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex_queue\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// exclusive\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(((\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003elifeSpan\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eExclusive\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eExclusive\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003eexclusive_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex_queue\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// 回転式バッファー\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eRotationBuffer\u003c/span\u003e \u003cspan class=\"n\"\u003erollingBuffer\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eRotationBuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eConnectionFactory\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetFactory\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003em_factory_\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003em_factory_\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eConnectionFactory\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003eHostName\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eHOST_NAME\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003em_factory_\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eConnectionFactory\u003c/span\u003e \u003cspan class=\"n\"\u003em_factory_\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eIConnection\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetConnection\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003em_connection_\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003em_connection_\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetFactory\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateConnection\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003em_connection_\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eIConnection\u003c/span\u003e \u003cspan class=\"n\"\u003em_connection_\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"nf\"\u003eIsConnected\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003em_connection_\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003em_connection_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIsOpen\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eIModel\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetChannel\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003em_channels_\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003em_channels_\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetConnection\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateModel\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// 引数が7つの QueueDeclare でエラーを吐くことがあるので、情報を出力しておく。\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eError\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"GetChannel index = [\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\"]\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eError\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"    QUEUE_NAMES[index] = [\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eQUEUE_NAMES\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\"]\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eError\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"    passive_lifeSpans[index] = [\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003epassive_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\"]\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eError\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"    durable_lifeSpans[index] = [\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003edurable_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\"]\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eError\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"    exclusive_lifeSpans[index] = [\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eexclusive_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\"]\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eError\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"    autodelete_lifeSpans[index] = [\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eautodelete_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\"]\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eError\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"    nowait は仮に false 固定\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eError\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"    arguments は仮に null 固定\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"cp\"\u003e#if UBUNTU\n\u003c/span\u003e            \u003cspan class=\"c1\"\u003e// Ubuntuでは何故か Spring.Messaging.Amqp.Rabbit の引数 7 つのやつになっている。\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// m_channels_[index].QueueDeclare(QUEUE_NAMES[index], false, false, false, false, false, null);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003em_channels_\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nf\"\u003eQueueDeclare\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eQUEUE_NAMES\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003epassive_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003edurable_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003eexclusive_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003eautodelete_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#else\n\u003c/span\u003e            \u003cspan class=\"c1\"\u003e//m_channels_[index].QueueDeclare(QUEUE_NAMES[index], false, false, false, null);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003em_channels_\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nf\"\u003eQueueDeclare\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eQUEUE_NAMES\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003edurable_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003eexclusive_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003eautodelete_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#endif\n\u003c/span\u003e        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003em_channels_\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eIModel\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003em_channels_\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eIModel\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eEventingBasicConsumer\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetConsumer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003em_consumers_\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#if UBUNTU\n\u003c/span\u003e            \u003cspan class=\"c1\"\u003e// Ubuntuでは何故か v1.4.0 の引数が 0 個のやつになっている。調べたが引数が1個～6個のものは無かった。\u003c/span\u003e\n            \u003cspan class=\"n\"\u003em_consumers_\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eEventingBasicConsumer\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#else\n\u003c/span\u003e            \u003cspan class=\"n\"\u003em_consumers_\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eEventingBasicConsumer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetChannel\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#endif\n\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003em_consumers_\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eEventingBasicConsumer\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003em_consumers_\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eEventingBasicConsumer\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// 受信できたときに割り込んでくる処理\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#if UBUNTU\n\u003c/span\u003e    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eBasicDeliverEventHandler\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetDequeueHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#else\n\u003c/span\u003e    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eEventHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eBasicDeliverEventArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetDequeueHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#endif\n\u003c/span\u003e    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003em_dequeueHandler_\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#if UBUNTU\n\u003c/span\u003e            \u003cspan class=\"n\"\u003em_dequeueHandler_\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eBasicDeliverEventHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003emodel\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eea\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#else\n\u003c/span\u003e            \u003cspan class=\"n\"\u003em_dequeueHandler_\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eEventHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eBasicDeliverEventArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;((\u003c/span\u003e\u003cspan class=\"n\"\u003emodel\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eea\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#endif\n\u003c/span\u003e            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003ebody\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eea\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBody\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eEncoding\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUTF8\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetString\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebody\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n                \u003cspan class=\"c1\"\u003e// 回転式バッファーに入れる\u003c/span\u003e\n                \u003cspan class=\"n\"\u003erollingBuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ePutMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003em_dequeueHandler_\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"cp\"\u003e#if UBUNTU\n\u003c/span\u003e    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eBasicDeliverEventHandler\u003c/span\u003e \u003cspan class=\"n\"\u003em_dequeueHandler_\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#else\n\u003c/span\u003e    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eEventHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eBasicDeliverEventArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003em_dequeueHandler_\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#endif\n\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// 対応するオープンは無いけれど、開けたら閉める、を完璧に対応する必要がある。\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eCloseChannel\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003em_channels_\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003em_channels_\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nf\"\u003eClose\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003em_channels_\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003euint\u003c/span\u003e \u003cspan class=\"nf\"\u003eDeleteQueue\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eIModel\u003c/span\u003e \u003cspan class=\"n\"\u003echannel\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetChannel\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDELETEQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"cp\"\u003e#if UBUNTU\n\u003c/span\u003e            \u003cspan class=\"c1\"\u003e// Ubuntuでは何故か 昔の .Net 用の引数 5 つのやつの変則版になっている。\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// uint QueueDelete(ushort ticket, string queue, bool ifUnused, bool ifEmpty, bool nowait)\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003eresult\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eQueueDelete\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003eQUEUE_NAMES\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eDELETEQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#else\n\u003c/span\u003e        \u003cspan class=\"kt\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003eresult\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eQueueDelete\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eQUEUE_NAMES\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eDELETEQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#endif\n\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 対応するオープンは無いが、ちゃんと閉じないと、レシーブしてくれない。\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eCloseChannel\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDELETEQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eresult\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eEnqueue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 末尾に daze を付ける。\u003c/span\u003e\n        \u003cspan class=\"n\"\u003emessage\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"daze\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003eIModel\u003c/span\u003e \u003cspan class=\"n\"\u003echannel\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetChannel\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eENQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003ebody\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eEncoding\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUTF8\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetBytes\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eBasicPublish\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eQUEUE_NAMES\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eENQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ebody\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// 対応するオープンは無いが、ちゃんと閉じないと、レシーブしてくれない。\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eCloseChannel\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eENQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eStartConsume\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eIModel\u003c/span\u003e \u003cspan class=\"n\"\u003echannel\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetChannel\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDEQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eEventingBasicConsumer\u003c/span\u003e \u003cspan class=\"n\"\u003econsumer\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetConsumer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDEQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 受信できたときに割り込んでくる処理\u003c/span\u003e\n        \u003cspan class=\"n\"\u003econsumer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eReceived\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetDequeueHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n\u003cspan class=\"cp\"\u003e#if UBUNTU\n\u003c/span\u003e        \u003cspan class=\"c1\"\u003e// Ubuntuでは何故か引数が 5 個のやつになっている。\u003c/span\u003e\n        \u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eBasicConsume\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003eQUEUE_NAMES\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eDEQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003econsumer\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#else\n\u003c/span\u003e        \u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eBasicConsume\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eQUEUE_NAMES\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eDEQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003econsumer\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#endif\n\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 終了はさせない\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// consumer.Received -= GetReceiveHandler();\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// CloseChannel(DEQUEUE_INDEX);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eMain\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//----------------------------------------\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// Delete\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//----------------------------------------\u003c/span\u003e\n        \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(;;)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e@\"削除したいキューがあれば名前を、無ければ空文字列を入れろだぜ☆（＾～＾）\nキュー名を入力    : キューを削除します\n空文字列で[Enter] : 次のステップへ進む\nName or empty ? \u0026gt; \"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003equeueName_delete\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReadLine\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\"\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003equeueName_delete\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\n            \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e@\"削除するメッセージ・キューの寿命を、足し算して答えろだぜ☆（＾～＾）\n(\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDurable\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e@\") durable    : RabbitMQが止まってもキューを残す\n(\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAutodelete\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e@\") autodelete : コンシューマーが１人も接続していなかったら消す\n(\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePassive\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e@\") passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ\n(\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eExclusive\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e@\") exclusive  : この接続でだけ使える。この接続が切れたら消す\nNumber ? \u0026gt; \"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan_delete\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eParse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReadLine\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eSetLifeSpan\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDELETEQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003equeueName_delete\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan_delete\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003euint\u003c/span\u003e \u003cspan class=\"n\"\u003eresult\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eDeleteQueue\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e@\"[\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003equeueName_delete\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\"]キューを削除したはずだぜ☆（＾～＾） result=[\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eresult\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\"]\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e//----------------------------------------\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// Enqueue settings\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//----------------------------------------\u003c/span\u003e\n        \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(;;)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e@\"エンキュー先のメッセージ・キューの名前を入れろだぜ☆（＾～＾）\nQueue name? \u0026gt; \"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003equeueName_enqueue\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReadLine\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n            \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e@\"エンキュー先のメッセージ・キューの寿命を、足し算して答えろだぜ☆（＾～＾）\n(\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDurable\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e@\") durable    : RabbitMQが止まってもキューを残す\n(\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAutodelete\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e@\") autodelete : コンシューマーが１人も接続していなかったら消す\n(\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePassive\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e@\") passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ\n(\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eExclusive\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e@\") exclusive  : この接続でだけ使える。この接続が切れたら消す\nNumber ? \u0026gt; \"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan_enqueue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eTryParse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReadLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan_enqueue\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"nf\"\u003eSetLifeSpan\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eENQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003equeueName_enqueue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003elifeSpan_enqueue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e//----------------------------------------\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// Enqueue settings\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//----------------------------------------\u003c/span\u003e\n        \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(;;)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e@\"デキュー先のメッセージ・キューの名前を入れろだぜ☆（＾～＾）\nQueue name? \u0026gt; \"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003equeueName_dequeue\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReadLine\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n            \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e@\"デキュー先のメッセージ・キューの寿命を、足し算して答えろだぜ☆（＾～＾）\n(\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDurable\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e@\") durable    : RabbitMQが止まってもキューを残す\n(\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAutodelete\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e@\") autodelete : コンシューマーが１人も接続していなかったら消す\n(\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePassive\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e@\") passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ\n(\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eExclusive\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e@\") exclusive  : この接続でだけ使える。この接続が切れたら消す\nNumber ? \u0026gt; \"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan_dequeue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eTryParse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReadLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan_dequeue\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"nf\"\u003eSetLifeSpan\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDEQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003equeueName_dequeue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003elifeSpan_dequeue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n                \u003cspan class=\"nf\"\u003eStartConsume\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// 常時監視をスタート\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eStartConsume\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// 無限ループ\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ewhile\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nf\"\u003eIsConnected\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003erollingBuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// エンキューする\u003c/span\u003e\n                \u003cspan class=\"nf\"\u003eEnqueue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eThread\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSleep\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e20\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// このプログラムは、自分では接続を切らない。\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// 回転式バッファー。\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// これはメイン・スレッドに置く。\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// デキューのスレッドでエンキューすることはできない。\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// デキュー処理は、回転式バッファーを仲介にしてエンキュー処理にメッセージを渡す。\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eRotationBuffer\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ebufferSize\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e100\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ebufferSize\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ePUT_INDEX\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eGET_INDEX\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003ePutMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ePUT_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e]]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ePUT_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e]++;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(!(\u003c/span\u003e\u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ePUT_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003ebufferSize\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ePUT_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eGET_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e]])\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eGET_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e]];\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eGET_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e]]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eGET_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e]++;\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(!(\u003c/span\u003e\u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eGET_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003ebufferSize\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eGET_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e改造し終わってから気づいたんだが、バックグラウンドで動かすプログラムでは　標準入出力で設定なんかできない。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"tamesi35a2_cscs-コマンドライン引数指定版\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#tamesi35a2_cscs-%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%83%A9%E3%82%A4%E3%83%B3%E5%BC%95%E6%95%B0%E6%8C%87%E5%AE%9A%E7%89%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003etamesi35a2_cs.cs コマンドライン引数指定版\u003c/h1\u003e\n\n\u003cp\u003eこんなんでいいんだろうか？\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e//--------------------------------------------------------------------------------\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// tamesi35a2_cs.cs\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// メッセージの末尾に daze を付けます。\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 標準入出力は、キーボード、画面には接続しないようにします。\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// キューの名前はコマンドライン引数で指定してください。\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// デキューは割込みを受け付けます。\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//--------------------------------------------------------------------------------\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// OS  : Windows 10\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// IDE : Visual Studio 2015\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//       Install : NuGet   : Install-Package RabbitMQ.Client -Version 4.1.1\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// OS  : Ubuntu 16.04\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//       Compile : Command : mcs /r:RabbitMQ.Client.dll -define:UBUNTU tamesi35a2_cs.cs\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//       Execute : Command : // バックグラウンドで実行する\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//                         : nohup ./tamesi35a2_cs.exe --msgqueue 1117 durable 1116 durable \u0026gt; ./tamesi35a2_cs.out.log 2\u0026gt; ./tamesi35a2_cs.err.log \u0026lt; /dev/null \u0026amp;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//       Check   :         : // tamesi33a1_cs.exe を使う\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//--------------------------------------------------------------------------------\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// Ubuntu の RabbitMQ はソースのバージョンが古いのか、API が異なった。\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// #define UBUNTU\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eRabbitMQ.Client\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eRabbitMQ.Client.Events\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Text\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Threading\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// このプログラム内だけで使われる数字。AMQP-CPPでの実装とは異なる。\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// AMQP-CPPでの実装 : AMQP::durable=[1] AMQP::autodelete=[2] AMQP::passive=[8] AMQP::exclusive=[512]\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003cspan class=\"k\"\u003eenum\u003c/span\u003e \u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// RabbitMQが止まってもキューを残す\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eDurable\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// コンシューマーが１人も接続していなかったら消す\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eAutodelete\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x1\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// キューが存在するかどうかチェックするだけ。中身見ない時これ\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ePassive\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x1\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// この接続でだけ使える。この接続が切れたら消す\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eExclusive\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x1\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"m\"\u003e3\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// 参照 : QueueDeclare http://docs.spring.io/spring-amqp-net/docs/1.0.x/api/html/Spring.Messaging.Amqp.Rabbit~Spring.Messaging.Amqp.Rabbit.Connection.CachedModel~QueueDeclare(String,Boolean,Boolean,Boolean,Boolean,Boolean,IDictionary).html\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// 参照 : EventingBasicConsumer https://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v1.4.0/rabbitmq-dotnet-client-1.4.0-net-2.0-htmldoc/type-RabbitMQ.Client.Events.EventingBasicConsumer.html\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// 参照 : BasicConsume https://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v1.4.0/rabbitmq-dotnet-client-1.4.0-net-2.0-htmldoc/type-RabbitMQ.Client.IModel.html#method-M:RabbitMQ.Client.IModel.BasicConsume(System.UInt16,System.String,System.Boolean,System.Collections.IDictionary,RabbitMQ.Client.IBasicConsumer)\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// 参照 : C#でconstな配列を実現する (もっとクールにプログラミング) http://pgnote.net/?p=885\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eProgram\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eENQUEUE_INDEX\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eDEQUEUE_INDEX\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eNUM_INDEX\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eHOST_NAME\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"localhost\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003ename_queues\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eNUM_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// キューの寿命（複合可能）\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// durable    : RabbitMQが止まってもキューを残す\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// autodelete : コンシューマーが１人も接続していなかったら消す\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// exclusive  : この接続でだけ使える。この接続が切れたら消す\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan_queues\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eNUM_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e \u003cspan class=\"nf\"\u003eLifeSpanString_To_Enum\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eswitch\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elifeSpan\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e\"durable\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDurable\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e\"autodelete\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAutodelete\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e\"passive\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePassive\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e\"exclusive\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eExclusive\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"k\"\u003edefault\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eException\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"未対応のlifeSpan [\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\"]\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e\n        \u003cspan class=\"n\"\u003edurable_lifeSpans\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eNUM_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eautodelete_lifeSpans\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eNUM_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n        \u003cspan class=\"n\"\u003epassive_lifeSpans\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eNUM_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eexclusive_lifeSpans\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eNUM_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eSetLifeSpan\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eindex_queue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ename_queue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ename_queues\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex_queue\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ename_queue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003elifeSpan_queues\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex_queue\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// 一旦クリアー\u003c/span\u003e\n        \u003cspan class=\"n\"\u003edurable_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex_queue\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eautodelete_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex_queue\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003epassive_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex_queue\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eexclusive_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex_queue\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// durable\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(((\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003elifeSpan\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDurable\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDurable\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003edurable_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex_queue\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// autodelete\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(((\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003elifeSpan\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAutodelete\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAutodelete\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003eautodelete_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex_queue\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// passive\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(((\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003elifeSpan\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePassive\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePassive\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003epassive_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex_queue\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// exclusive\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(((\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003elifeSpan\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eExclusive\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eExclusive\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003eexclusive_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex_queue\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// 回転式バッファー\u003c/span\u003e\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eRotationBuffer\u003c/span\u003e \u003cspan class=\"n\"\u003erollingBuffer\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eRotationBuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eConnectionFactory\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetFactory\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003em_factory_\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003em_factory_\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eConnectionFactory\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003eHostName\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eHOST_NAME\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003em_factory_\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eConnectionFactory\u003c/span\u003e \u003cspan class=\"n\"\u003em_factory_\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eIConnection\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetConnection\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003em_connection_\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003em_connection_\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetFactory\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateConnection\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003em_connection_\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eIConnection\u003c/span\u003e \u003cspan class=\"n\"\u003em_connection_\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"nf\"\u003eIsConnected\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003em_connection_\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003em_connection_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIsOpen\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eIModel\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetChannel\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003em_channels_\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003em_channels_\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetConnection\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateModel\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// 引数が7つの QueueDeclare でエラーを吐くことがあるので、情報を出力しておく。\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eError\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"GetChannel index = [\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\"]\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eError\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"    QUEUE_NAMES[index] = [\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003ename_queues\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\"]\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eError\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"    passive_lifeSpans[index] = [\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003epassive_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\"]\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eError\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"    durable_lifeSpans[index] = [\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003edurable_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\"]\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eError\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"    exclusive_lifeSpans[index] = [\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eexclusive_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\"]\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eError\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"    autodelete_lifeSpans[index] = [\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eautodelete_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\"]\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eError\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"    nowait は仮に false 固定\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eError\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"    arguments は仮に null 固定\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"cp\"\u003e#if UBUNTU\n\u003c/span\u003e            \u003cspan class=\"c1\"\u003e// Ubuntuでは何故か Spring.Messaging.Amqp.Rabbit の引数 7 つのやつになっている。\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// m_channels_[index].QueueDeclare(QUEUE_NAMES[index], false, false, false, false, false, null);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003em_channels_\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nf\"\u003eQueueDeclare\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eQUEUE_NAMES\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003epassive_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003edurable_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003eexclusive_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003eautodelete_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#else\n\u003c/span\u003e            \u003cspan class=\"c1\"\u003e//m_channels_[index].QueueDeclare(QUEUE_NAMES[index], false, false, false, null);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003em_channels_\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nf\"\u003eQueueDeclare\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ename_queues\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003edurable_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003eexclusive_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003eautodelete_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#endif\n\u003c/span\u003e        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003em_channels_\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eIModel\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003em_channels_\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eIModel\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eEventingBasicConsumer\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetConsumer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003em_consumers_\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#if UBUNTU\n\u003c/span\u003e            \u003cspan class=\"c1\"\u003e// Ubuntuでは何故か v1.4.0 の引数が 0 個のやつになっている。調べたが引数が1個～6個のものは無かった。\u003c/span\u003e\n            \u003cspan class=\"n\"\u003em_consumers_\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eEventingBasicConsumer\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#else\n\u003c/span\u003e            \u003cspan class=\"n\"\u003em_consumers_\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eEventingBasicConsumer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetChannel\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#endif\n\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003em_consumers_\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eEventingBasicConsumer\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003em_consumers_\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eEventingBasicConsumer\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// 受信できたときに割り込んでくる処理\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#if UBUNTU\n\u003c/span\u003e    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eBasicDeliverEventHandler\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetDequeueHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#else\n\u003c/span\u003e    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eEventHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eBasicDeliverEventArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetDequeueHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#endif\n\u003c/span\u003e    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003em_dequeueHandler_\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#if UBUNTU\n\u003c/span\u003e            \u003cspan class=\"n\"\u003em_dequeueHandler_\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eBasicDeliverEventHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003emodel\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eea\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#else\n\u003c/span\u003e            \u003cspan class=\"n\"\u003em_dequeueHandler_\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eEventHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eBasicDeliverEventArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;((\u003c/span\u003e\u003cspan class=\"n\"\u003emodel\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eea\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#endif\n\u003c/span\u003e            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003ebody\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eea\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBody\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eEncoding\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUTF8\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetString\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebody\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n                \u003cspan class=\"c1\"\u003e// 回転式バッファーに入れる\u003c/span\u003e\n                \u003cspan class=\"n\"\u003erollingBuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ePutMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003em_dequeueHandler_\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"cp\"\u003e#if UBUNTU\n\u003c/span\u003e    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eBasicDeliverEventHandler\u003c/span\u003e \u003cspan class=\"n\"\u003em_dequeueHandler_\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#else\n\u003c/span\u003e    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eEventHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eBasicDeliverEventArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003em_dequeueHandler_\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#endif\n\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// 対応するオープンは無いけれど、開けたら閉める、を完璧に対応する必要がある。\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eCloseChannel\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003em_channels_\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003em_channels_\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nf\"\u003eClose\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003em_channels_\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eEnqueue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 末尾に daze を付ける。\u003c/span\u003e\n        \u003cspan class=\"n\"\u003emessage\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"daze\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003eIModel\u003c/span\u003e \u003cspan class=\"n\"\u003echannel\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetChannel\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eENQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003ebody\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eEncoding\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUTF8\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetBytes\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eBasicPublish\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ename_queues\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eENQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ebody\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// 対応するオープンは無いが、ちゃんと閉じないと、レシーブしてくれない。\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eCloseChannel\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eENQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eStartConsume\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eIModel\u003c/span\u003e \u003cspan class=\"n\"\u003echannel\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetChannel\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDEQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eEventingBasicConsumer\u003c/span\u003e \u003cspan class=\"n\"\u003econsumer\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetConsumer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDEQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 受信できたときに割り込んでくる処理\u003c/span\u003e\n        \u003cspan class=\"n\"\u003econsumer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eReceived\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetDequeueHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n\u003cspan class=\"cp\"\u003e#if UBUNTU\n\u003c/span\u003e        \u003cspan class=\"c1\"\u003e// Ubuntuでは何故か引数が 5 個のやつになっている。\u003c/span\u003e\n        \u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eBasicConsume\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003eQUEUE_NAMES\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eDEQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003econsumer\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#else\n\u003c/span\u003e        \u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eBasicConsume\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ename_queues\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eDEQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003econsumer\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#endif\n\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 終了はさせない\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// consumer.Received -= GetReceiveHandler();\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// CloseChannel(DEQUEUE_INDEX);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eMain\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003egoto\u003c/span\u003e \u003cspan class=\"n\"\u003egt_Error1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// 引数の解析\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// 与件\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// 「--msgqueue 1117 durable 1116 durable」という引数は「--msgqueue」「1117」「durable」「1116」「durable」に分解される。\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// 受け皿\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// 0:enqueue 1:dequeue\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// 記憶\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003em0\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// カーソル相当\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// 解析器\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003em0\u003c/span\u003e\u003cspan class=\"p\"\u003e==\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003eswitch\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                        \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e\"--msgqueue\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003em0\u003c/span\u003e\u003cspan class=\"p\"\u003e++;\u003c/span\u003e \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                        \u003cspan class=\"k\"\u003edefault\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003egoto\u003c/span\u003e \u003cspan class=\"n\"\u003egt_Error1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"c1\"\u003e//--msgqueue 内容\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003eswitch\u003c/span\u003e \u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003em0\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 引数名の分1引いている\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                        \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003ename_queues\u003c/span\u003e\u003cspan class=\"p\"\u003e[(\u003c/span\u003e\u003cspan class=\"n\"\u003em0\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e/\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003em0\u003c/span\u003e\u003cspan class=\"p\"\u003e++;\u003c/span\u003e \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                        \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan_queues\u003c/span\u003e\u003cspan class=\"p\"\u003e[(\u003c/span\u003e\u003cspan class=\"n\"\u003em0\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e/\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eLifeSpanString_To_Enum\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"n\"\u003em0\u003c/span\u003e\u003cspan class=\"p\"\u003e++;\u003c/span\u003e \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// 結果\u003c/span\u003e\n            \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"nf\"\u003eSetLifeSpan\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ename_queues\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan_queues\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// 常時監視をスタート\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eStartConsume\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// 無限ループ\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ewhile\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nf\"\u003eIsConnected\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003erollingBuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// エンキューする\u003c/span\u003e\n                \u003cspan class=\"nf\"\u003eEnqueue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eThread\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSleep\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e20\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// このプログラムは、自分では接続を切らない。\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003egt_Error1\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eException\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e@\"コマンドライン引数に「--msgqueue キュー名 寿命 キュー名 寿命」を指定しろだぜ☆（＾～＾）\nエンキュー先、デキュー先の順番な☆（＾▽＾）\n寿命は durable, autodelete, passive, exclusive のいずれかで、\n複合指定にはまだ対応していないぜ☆（＞＿＜）\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// 回転式バッファー。\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// これはメイン・スレッドに置く。\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// デキューのスレッドでエンキューすることはできない。\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// デキュー処理は、回転式バッファーを仲介にしてエンキュー処理にメッセージを渡す。\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eRotationBuffer\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ebufferSize\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e100\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ebufferSize\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ePUT_INDEX\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eGET_INDEX\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003ePutMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ePUT_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e]]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ePUT_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e]++;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(!(\u003c/span\u003e\u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ePUT_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003ebufferSize\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ePUT_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eGET_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e]])\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eGET_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e]];\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eGET_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e]]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eGET_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e]++;\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(!(\u003c/span\u003e\u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eGET_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003ebufferSize\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eGET_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eそういえば今まで標準入力を捨ててなかった気がするな。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e./tamesi35a2_cs.exe --msgqueue 1117 durable 1116 durable \u0026gt; ./tamesi35a2_cs.out.log 2\u0026gt; ./tamesi35a2_cs.err.log \u0026lt; /dev/null \u0026amp;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e# ./tamesi34_cs.exe\n削除したいキューがあれば名前を、無ければ空文字列を入れろだぜ☆（＾～＾）\nキュー名を入力    : キューを削除します\n空文字列で[Enter] : 次のステップへ進む\nName or empty ? \u0026gt;\nエンキュー先のメッセージ・キューの名前を入れろだぜ☆（＾～＾）\nQueue name? \u0026gt; 1116\nエンキュー先のメッセージ・キューの寿命を、足し算して答えろだぜ☆（＾～＾）\n(1) durable    : RabbitMQが止まってもキューを残す\n(2) autodelete : コンシューマーが１人も接続していなかったら消す\n(4) passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ\n(8) exclusive  : この接続でだけ使える。この接続が切れたら消す\nNumber ? \u0026gt; 0\nデキュー先のメッセージ・キューの名前を入れろだぜ☆（＾～＾）\nQueue name? \u0026gt; 1117\nデキュー先のメッセージ・キューの寿命を、足し算して答えろだぜ☆（＾～＾）\n(1) durable    : RabbitMQが止まってもキューを残す\n(2) autodelete : コンシューマーが１人も接続していなかったら消す\n(4) passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ\n(8) exclusive  : この接続でだけ使える。この接続が切れたら消す\nNumber ? \u0026gt; 0\nGetChannel index = [1]\n    QUEUE_NAMES[index] = [1117]\n    passive_lifeSpans[index] = [False]\n    durable_lifeSpans[index] = [False]\n    exclusive_lifeSpans[index] = [False]\n    autodelete_lifeSpans[index] = [False]\n    nowait は仮に false 固定\n    arguments は仮に null 固定\n\nUnhandled Exception:\nRabbitMQ.Client.Exceptions.OperationInterruptedException: The AMQP operation was interrupted: AMQP close-reason, initiated by Peer, code=406, text=\"PRECONDITION_FAILED - inequivalent arg 'durable' for queue '1117' in vhost '/': received 'false' but current is 'true'\", classId=50, methodId=10, cause=\n  at RabbitMQ.Client.Impl.SimpleBlockingRpcContinuation.GetReply () \u0026lt;0x4013c420 + 0x00107\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at RabbitMQ.Client.Impl.ModelBase.ModelRpc (RabbitMQ.Client.Impl.MethodBase method, RabbitMQ.Client.Impl.ContentHeaderBase header, System.Byte[] body) \u0026lt;0x4013a290 + 0x000fd\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at RabbitMQ.Client.Framing.Impl.v0_8.Model.QueueDeclare (System.String queue, Boolean passive, Boolean durable, Boolean exclusive, Boolean autoDelete, Boolean nowait, IDictionary arguments) \u0026lt;0x4013e6d0 + 0x00113\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at UsagiMQ.Program.GetChannel (Int32 index) \u0026lt;0x400ffd20 + 0x00436\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at UsagiMQ.Program.StartConsume (System.String name_queue, LifeSpanType lifeSpan_queue) \u0026lt;0x400ffc40 + 0x0002b\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at UsagiMQ.Program.Main (System.String[] args) \u0026lt;0x400fad50 + 0x0096b\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n[ERROR] FATAL UNHANDLED EXCEPTION: RabbitMQ.Client.Exceptions.OperationInterruptedException: The AMQP operation was interrupted: AMQP close-reason, initiated by Peer, code=406, text=\"PRECONDITION_FAILED - inequivalent arg 'durable' for queue '1117' in vhost '/': received 'false' but current is 'true'\", classId=50, methodId=10, cause=\n  at RabbitMQ.Client.Impl.SimpleBlockingRpcContinuation.GetReply () \u0026lt;0x4013c420 + 0x00107\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at RabbitMQ.Client.Impl.ModelBase.ModelRpc (RabbitMQ.Client.Impl.MethodBase method, RabbitMQ.Client.Impl.ContentHeaderBase header, System.Byte[] body) \u0026lt;0x4013a290 + 0x000fd\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at RabbitMQ.Client.Framing.Impl.v0_8.Model.QueueDeclare (System.String queue, Boolean passive, Boolean durable, Boolean exclusive, Boolean autoDelete, Boolean nowait, IDictionary arguments) \u0026lt;0x4013e6d0 + 0x00113\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at UsagiMQ.Program.GetChannel (Int32 index) \u0026lt;0x400ffd20 + 0x00436\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at UsagiMQ.Program.StartConsume (System.String name_queue, LifeSpanType lifeSpan_queue) \u0026lt;0x400ffc40 + 0x0002b\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at UsagiMQ.Program.Main (System.String[] args) \u0026lt;0x400fad50 + 0x0096b\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eチャンネル宣言の引数が４つfalse なのもおかしい。もっと情報を出そう。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"visual-studio-2015-で-tamesi34_cscs-を動かしてみた\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#visual-studio-2015-%E3%81%A7-tamesi34_cscs-%E3%82%92%E5%8B%95%E3%81%8B%E3%81%97%E3%81%A6%E3%81%BF%E3%81%9F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eVisual Studio 2015 で tamesi34_cs.cs を動かしてみた\u003c/h1\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e削除したいキューがあれば名前を、無ければ空文字列を入れろだぜ☆（＾～＾）\nキュー名を入力    : キューを削除します\n空文字列で[Enter] : 次のステップへ進む\nName or empty ? \u0026gt;\nエンキュー先のメッセージ・キューの名前を入れろだぜ☆（＾～＾）\nQueue name? \u0026gt; 1117\nエンキュー先のメッセージ・キューの寿命を、足し算して答えろだぜ☆（＾～＾）\n(1) durable    : RabbitMQが止まってもキューを残す\n(2) autodelete : コンシューマーが１人も接続していなかったら消す\n(4) passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ\n(8) exclusive  : この接続でだけ使える。この接続が切れたら消す\nNumber ? \u0026gt; 0\nデキュー先のメッセージ・キューの名前を入れろだぜ☆（＾～＾）\nQueue name? \u0026gt; 1116\nデキュー先のメッセージ・キューの寿命を、足し算して答えろだぜ☆（＾～＾）\n(1) durable    : RabbitMQが止まってもキューを残す\n(2) autodelete : コンシューマーが１人も接続していなかったら消す\n(4) passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ\n(8) exclusive  : この接続でだけ使える。この接続が切れたら消す\nNumber ? \u0026gt; 0\ntamesi34_cs.cs Dump\n    name_queues         [ENQUEUE_INDEX]    =[1117]\n    lifeSpan_queues     [ENQUEUE_INDEX]    =[0]\n    durable_lifeSpans   [ENQUEUE_INDEX]    =[False]\n    autodelete_lifeSpans[ENQUEUE_INDEX]    =[False]\n    passive_lifeSpans   [ENQUEUE_INDEX]    =[False]\n    exclusive_lifeSpans [ENQUEUE_INDEX]    =[False]\n    ----\n    name_queues         [DEQUEUE_INDEX]    =[1116]\n    lifeSpan_queues     [DEQUEUE_INDEX]    =[0]\n    durable_lifeSpans   [DEQUEUE_INDEX]    =[False]\n    autodelete_lifeSpans[DEQUEUE_INDEX]    =[False]\n    passive_lifeSpans   [DEQUEUE_INDEX]    =[False]\n    exclusive_lifeSpans [DEQUEUE_INDEX]    =[False]\n    ----\n    name_queues         [DELETEQUEUE_INDEX]=[]\n    lifeSpan_queues     [DELETEQUEUE_INDEX]=[0]\n    durable_lifeSpans   [DELETEQUEUE_INDEX]=[False]\n    autodelete_lifeSpans[DELETEQUEUE_INDEX]=[False]\n    passive_lifeSpans   [DELETEQUEUE_INDEX]=[False]\n    exclusive_lifeSpans [DELETEQUEUE_INDEX]=[False]\n    ----\n\n(tamesi34_cs.cs?) GetChannel index = [1]\n    name_queues[index] = [1116]\n    passive_lifeSpans[index] = [False]\n    durable_lifeSpans[index] = [False]\n    exclusive_lifeSpans[index] = [False]\n    autodelete_lifeSpans[index] = [False]\n    nowait は仮に false 固定\n    arguments は仮に null 固定\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eおかしいじゃないか。false が４つ入っている。\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eあっ！\u003c/strong\u003e durable、0スタートじゃなくて 1スタートに変えたんだった！\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e削除したいキューがあれば名前を、無ければ空文字列を入れろだぜ☆（＾～＾）\nキュー名を入力    : キューを削除します\n空文字列で[Enter] : 次のステップへ進む\nName or empty ? \u0026gt;\nエンキュー先のメッセージ・キューの名前を入れろだぜ☆（＾～＾）\nQueue name? \u0026gt; 1117\nエンキュー先のメッセージ・キューの寿命を、足し算して答えろだぜ☆（＾～＾）\n(1) durable    : RabbitMQが止まってもキューを残す\n(2) autodelete : コンシューマーが１人も接続していなかったら消す\n(4) passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ\n(8) exclusive  : この接続でだけ使える。この接続が切れたら消す\nNumber ? \u0026gt; 1\nデキュー先のメッセージ・キューの名前を入れろだぜ☆（＾～＾）\nQueue name? \u0026gt; 1116\nデキュー先のメッセージ・キューの寿命を、足し算して答えろだぜ☆（＾～＾）\n(1) durable    : RabbitMQが止まってもキューを残す\n(2) autodelete : コンシューマーが１人も接続していなかったら消す\n(4) passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ\n(8) exclusive  : この接続でだけ使える。この接続が切れたら消す\nNumber ? \u0026gt; 1\ntamesi34_cs.cs Dump\n    name_queues         [ENQUEUE_INDEX]    =[1117]\n    lifeSpan_queues     [ENQUEUE_INDEX]    =[Durable]\n    durable_lifeSpans   [ENQUEUE_INDEX]    =[True]\n    autodelete_lifeSpans[ENQUEUE_INDEX]    =[False]\n    passive_lifeSpans   [ENQUEUE_INDEX]    =[False]\n    exclusive_lifeSpans [ENQUEUE_INDEX]    =[False]\n    ----\n    name_queues         [DEQUEUE_INDEX]    =[1116]\n    lifeSpan_queues     [DEQUEUE_INDEX]    =[Durable]\n    durable_lifeSpans   [DEQUEUE_INDEX]    =[True]\n    autodelete_lifeSpans[DEQUEUE_INDEX]    =[False]\n    passive_lifeSpans   [DEQUEUE_INDEX]    =[False]\n    exclusive_lifeSpans [DEQUEUE_INDEX]    =[False]\n    ----\n    name_queues         [DELETEQUEUE_INDEX]=[]\n    lifeSpan_queues     [DELETEQUEUE_INDEX]=[0]\n    durable_lifeSpans   [DELETEQUEUE_INDEX]=[False]\n    autodelete_lifeSpans[DELETEQUEUE_INDEX]=[False]\n    passive_lifeSpans   [DELETEQUEUE_INDEX]=[False]\n    exclusive_lifeSpans [DELETEQUEUE_INDEX]=[False]\n    ----\n\n(tamesi34_cs.cs?) GetChannel index = [1]\n    name_queues[index] = [1116]\n    passive_lifeSpans[index] = [False]\n    durable_lifeSpans[index] = [True]\n    exclusive_lifeSpans[index] = [False]\n    autodelete_lifeSpans[index] = [False]\n    nowait は仮に false 固定\n    arguments は仮に null 固定\n終了するときは[Ctrl]+[C]キーを押せだぜ☆（＾～＾）\nエンキューするときはメッセージを打ち込んで[Enter]キーを押せだぜ☆(＾◇＾)\nEnqueue? \u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eここまでは　おっけー。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e# ./tamesi35a2_cs.exe --msgqueue 1117 durable 1116 durable \u0026gt; ./tamesi35a2_cs.out.log 2\u0026gt; ./tamesi35a2_cs.err.log \u0026lt; /dev/null \u0026amp;\n[1] 24403\n# ./tamesi34_cs.exe\n削除したいキューがあれば名前を、無ければ空文字列を入れろだぜ☆（＾～＾）\nキュー名を入力    : キューを削除します\n空文字列で[Enter] : 次のステップへ進む\nName or empty ? \u0026gt;\nエンキュー先のメッセージ・キューの名前を入れろだぜ☆（＾～＾）\nQueue name? \u0026gt; 1116\nエンキュー先のメッセージ・キューの寿命を、足し算して答えろだぜ☆（＾～＾）\n(1) durable    : RabbitMQが止まってもキューを残す\n(2) autodelete : コンシューマーが１人も接続していなかったら消す\n(4) passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ\n(8) exclusive  : この接続でだけ使える。この接続が切れたら消す\nNumber ? \u0026gt; 1\nデキュー先のメッセージ・キューの名前を入れろだぜ☆（＾～＾）\nQueue name? \u0026gt; 1117\nデキュー先のメッセージ・キューの寿命を、足し算して答えろだぜ☆（＾～＾）\n(1) durable    : RabbitMQが止まってもキューを残す\n(2) autodelete : コンシューマーが１人も接続していなかったら消す\n(4) passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ\n(8) exclusive  : この接続でだけ使える。この接続が切れたら消す\nNumber ? \u0026gt; 1\nGetChannel index = [1]\n    QUEUE_NAMES[index] = [1117]\n    passive_lifeSpans[index] = [False]\n    durable_lifeSpans[index] = [True]\n    exclusive_lifeSpans[index] = [False]\n    autodelete_lifeSpans[index] = [False]\n    nowait は仮に false 固定\n    arguments は仮に null 固定\n終了するときは[Ctrl]+[C]キーを押せだぜ☆（＾～＾）\nエンキューするときはメッセージを打ち込んで[Enter]キーを押せだぜ☆(＾◇＾)\nEnqueue? \u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e1 にしたら、動いてるじゃないか。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eEnqueue? \u0026gt; kame\nGetChannel index = [0]\n    QUEUE_NAMES[index] = [1116]\n    passive_lifeSpans[index] = [False]\n    durable_lifeSpans[index] = [True]\n    exclusive_lifeSpans[index] = [False]\n    autodelete_lifeSpans[index] = [False]\n    nowait は仮に false 固定\n    arguments は仮に null 固定\n\nUnhandled Exception:\nRabbitMQ.Client.Exceptions.OperationInterruptedException: The AMQP operation was interrupted: AMQP close-reason, initiated by Peer, code=406, text=\"PRECONDITION_FAILED - inequivalent arg 'durable' for queue '1116' in vhost '/': received 'true' but current is 'false'\", classId=50, methodId=10, cause=\n  at RabbitMQ.Client.Impl.SimpleBlockingRpcContinuation.GetReply () \u0026lt;0x42014f00 + 0x00103\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at RabbitMQ.Client.Impl.ModelBase.ModelRpc (RabbitMQ.Client.Impl.MethodBase method, RabbitMQ.Client.Impl.ContentHeaderBase header, System.Byte[] body) \u0026lt;0x42012d90 + 0x000f9\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at RabbitMQ.Client.Framing.Impl.v0_8.Model.QueueDeclare (System.String queue, Boolean passive, Boolean durable, Boolean exclusive, Boolean autoDelete, Boolean nowait, IDictionary arguments) \u0026lt;0x420171d0 + 0x00113\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at UsagiMQ.Program.GetChannel (Int32 index) \u0026lt;0x41fd88d0 + 0x00436\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at UsagiMQ.Program.Enqueue (System.String message) \u0026lt;0x420182e0 + 0x00013\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at UsagiMQ.Program.Main (System.String[] args) \u0026lt;0x41fd3d50 + 0x0099f\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n[ERROR] FATAL UNHANDLED EXCEPTION: RabbitMQ.Client.Exceptions.OperationInterruptedException: The AMQP operation was interrupted: AMQP close-reason, initiated by Peer, code=406, text=\"PRECONDITION_FAILED - inequivalent arg 'durable' for queue '1116' in vhost '/': received 'true' but current is 'false'\", classId=50, methodId=10, cause=\n  at RabbitMQ.Client.Impl.SimpleBlockingRpcContinuation.GetReply () \u0026lt;0x42014f00 + 0x00103\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at RabbitMQ.Client.Impl.ModelBase.ModelRpc (RabbitMQ.Client.Impl.MethodBase method, RabbitMQ.Client.Impl.ContentHeaderBase header, System.Byte[] body) \u0026lt;0x42012d90 + 0x000f9\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at RabbitMQ.Client.Framing.Impl.v0_8.Model.QueueDeclare (System.String queue, Boolean passive, Boolean durable, Boolean exclusive, Boolean autoDelete, Boolean nowait, IDictionary arguments) \u0026lt;0x420171d0 + 0x00113\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at UsagiMQ.Program.GetChannel (Int32 index) \u0026lt;0x41fd88d0 + 0x00436\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at UsagiMQ.Program.Enqueue (System.String message) \u0026lt;0x420182e0 + 0x00013\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at UsagiMQ.Program.Main (System.String[] args) \u0026lt;0x41fd3d50 + 0x0099f\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n[1]+  Exit 1                  ./tamesi35a2_cs.exe --msgqueue 1117 durable 1116 durable \u0026gt; ./tamesi35a2_cs.out.log 2\u0026gt; ./tamesi35a2_cs.err.log \u0026lt; /dev/null\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e動いてないぜ。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ePRECONDITION_FAILED - inequivalent arg 'durable' for queue '1116' in vhost '/': received 'true' but current is 'false'\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこういうエラーなんだろうけど。\u003c/p\u003e\n\n\u003cp\u003eじゃあ false にしたらいいのか？\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"あるいはエンキューを別スレッドにするのがまだ残っている\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%82%E3%82%8B%E3%81%84%E3%81%AF%E3%82%A8%E3%83%B3%E3%82%AD%E3%83%A5%E3%83%BC%E3%82%92%E5%88%A5%E3%82%B9%E3%83%AC%E3%83%83%E3%83%89%E3%81%AB%E3%81%99%E3%82%8B%E3%81%AE%E3%81%8C%E3%81%BE%E3%81%A0%E6%AE%8B%E3%81%A3%E3%81%A6%E3%81%84%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003cstrong\u003eあるいは　エンキューを別スレッドにするのが　まだ残っている\u003c/strong\u003e\n\u003c/h1\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"その前に-visual-studio-2015-でやったら\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%9D%E3%81%AE%E5%89%8D%E3%81%AB-visual-studio-2015-%E3%81%A7%E3%82%84%E3%81%A3%E3%81%9F%E3%82%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eその前に Visual Studio 2015 でやったら\u003c/h1\u003e\n\n\u003cp\u003etamesi34_cs.exe\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e削除したいキューがあれば名前を、無ければ空文字列を入れろだぜ☆（＾～＾）\nキュー名を入力    : キューを削除します\n空文字列で[Enter] : 次のステップへ進む\nName or empty ? \u0026gt;\nエンキュー先のメッセージ・キューの名前を入れろだぜ☆（＾～＾）\nQueue name? \u0026gt; 1116\nエンキュー先のメッセージ・キューの寿命を、足し算して答えろだぜ☆（＾～＾）\n(1) durable    : RabbitMQが止まってもキューを残す\n(2) autodelete : コンシューマーが１人も接続していなかったら消す\n(4) passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ\n(8) exclusive  : この接続でだけ使える。この接続が切れたら消す\nNumber ? \u0026gt; 1\nデキュー先のメッセージ・キューの名前を入れろだぜ☆（＾～＾）\nQueue name? \u0026gt; 1117\nデキュー先のメッセージ・キューの寿命を、足し算して答えろだぜ☆（＾～＾）\n(1) durable    : RabbitMQが止まってもキューを残す\n(2) autodelete : コンシューマーが１人も接続していなかったら消す\n(4) passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ\n(8) exclusive  : この接続でだけ使える。この接続が切れたら消す\nNumber ? \u0026gt; 1\ntamesi34_cs.cs Dump\n    name_queues         [ENQUEUE_INDEX]    =[1116]\n    lifeSpan_queues     [ENQUEUE_INDEX]    =[Durable]\n    durable_lifeSpans   [ENQUEUE_INDEX]    =[True]\n    autodelete_lifeSpans[ENQUEUE_INDEX]    =[False]\n    passive_lifeSpans   [ENQUEUE_INDEX]    =[False]\n    exclusive_lifeSpans [ENQUEUE_INDEX]    =[False]\n    ----\n    name_queues         [DEQUEUE_INDEX]    =[1117]\n    lifeSpan_queues     [DEQUEUE_INDEX]    =[Durable]\n    durable_lifeSpans   [DEQUEUE_INDEX]    =[True]\n    autodelete_lifeSpans[DEQUEUE_INDEX]    =[False]\n    passive_lifeSpans   [DEQUEUE_INDEX]    =[False]\n    exclusive_lifeSpans [DEQUEUE_INDEX]    =[False]\n    ----\n    name_queues         [DELETEQUEUE_INDEX]=[]\n    lifeSpan_queues     [DELETEQUEUE_INDEX]=[0]\n    durable_lifeSpans   [DELETEQUEUE_INDEX]=[False]\n    autodelete_lifeSpans[DELETEQUEUE_INDEX]=[False]\n    passive_lifeSpans   [DELETEQUEUE_INDEX]=[False]\n    exclusive_lifeSpans [DELETEQUEUE_INDEX]=[False]\n    ----\n\n(tamesi34_cs.cs?) GetChannel index = [1]\n    name_queues[index] = [1117]\n    passive_lifeSpans[index] = [False]\n    durable_lifeSpans[index] = [True]\n    exclusive_lifeSpans[index] = [False]\n    autodelete_lifeSpans[index] = [False]\n    nowait は仮に false 固定\n    arguments は仮に null 固定\n終了するときは[Ctrl]+[C]キーを押せだぜ☆（＾～＾）\nエンキューするときはメッセージを打ち込んで[Enter]キーを押せだぜ☆(＾◇＾)\nEnqueue? \u0026gt; usi\ntamesi34_cs.cs Dump\n    name_queues         [ENQUEUE_INDEX]    =[1116]\n    lifeSpan_queues     [ENQUEUE_INDEX]    =[Durable]\n    durable_lifeSpans   [ENQUEUE_INDEX]    =[True]\n    autodelete_lifeSpans[ENQUEUE_INDEX]    =[False]\n    passive_lifeSpans   [ENQUEUE_INDEX]    =[False]\n    exclusive_lifeSpans [ENQUEUE_INDEX]    =[False]\n    ----\n    name_queues         [DEQUEUE_INDEX]    =[1117]\n    lifeSpan_queues     [DEQUEUE_INDEX]    =[Durable]\n    durable_lifeSpans   [DEQUEUE_INDEX]    =[True]\n    autodelete_lifeSpans[DEQUEUE_INDEX]    =[False]\n    passive_lifeSpans   [DEQUEUE_INDEX]    =[False]\n    exclusive_lifeSpans [DEQUEUE_INDEX]    =[False]\n    ----\n    name_queues         [DELETEQUEUE_INDEX]=[]\n    lifeSpan_queues     [DELETEQUEUE_INDEX]=[0]\n    durable_lifeSpans   [DELETEQUEUE_INDEX]=[False]\n    autodelete_lifeSpans[DELETEQUEUE_INDEX]=[False]\n    passive_lifeSpans   [DELETEQUEUE_INDEX]=[False]\n    exclusive_lifeSpans [DELETEQUEUE_INDEX]=[False]\n    ----\n\n(tamesi34_cs.cs?) GetChannel index = [0]\n    name_queues[index] = [1116]\n    passive_lifeSpans[index] = [False]\n    durable_lifeSpans[index] = [True]\n    exclusive_lifeSpans[index] = [False]\n    autodelete_lifeSpans[index] = [False]\n    nowait は仮に false 固定\n    arguments は仮に null 固定\n Enqueue(^q^) usi\nEnqueue? \u0026gt; \u0026lt;---- [interrupt!] Dequeue(^q^) usidaze\nneko\ntamesi34_cs.cs Dump\n    name_queues         [ENQUEUE_INDEX]    =[1116]\n    lifeSpan_queues     [ENQUEUE_INDEX]    =[Durable]\n    durable_lifeSpans   [ENQUEUE_INDEX]    =[True]\n    autodelete_lifeSpans[ENQUEUE_INDEX]    =[False]\n    passive_lifeSpans   [ENQUEUE_INDEX]    =[False]\n    exclusive_lifeSpans [ENQUEUE_INDEX]    =[False]\n    ----\n    name_queues         [DEQUEUE_INDEX]    =[1117]\n    lifeSpan_queues     [DEQUEUE_INDEX]    =[Durable]\n    durable_lifeSpans   [DEQUEUE_INDEX]    =[True]\n    autodelete_lifeSpans[DEQUEUE_INDEX]    =[False]\n    passive_lifeSpans   [DEQUEUE_INDEX]    =[False]\n    exclusive_lifeSpans [DEQUEUE_INDEX]    =[False]\n    ----\n    name_queues         [DELETEQUEUE_INDEX]=[]\n    lifeSpan_queues     [DELETEQUEUE_INDEX]=[0]\n    durable_lifeSpans   [DELETEQUEUE_INDEX]=[False]\n    autodelete_lifeSpans[DELETEQUEUE_INDEX]=[False]\n    passive_lifeSpans   [DELETEQUEUE_INDEX]=[False]\n    exclusive_lifeSpans [DELETEQUEUE_INDEX]=[False]\n    ----\n\n(tamesi34_cs.cs?) GetChannel index = [0]\n    name_queues[index] = [1116]\n    passive_lifeSpans[index] = [False]\n    durable_lifeSpans[index] = [True]\n    exclusive_lifeSpans[index] = [False]\n    autodelete_lifeSpans[index] = [False]\n    nowait は仮に false 固定\n    arguments は仮に null 固定\n Enqueue(^q^) neko\nEnqueue? \u0026gt; \u0026lt;---- [interrupt!] Dequeue(^q^) nekodaze\nzou\ntamesi34_cs.cs Dump\n    name_queues         [ENQUEUE_INDEX]    =[1116]\n    lifeSpan_queues     [ENQUEUE_INDEX]    =[Durable]\n    durable_lifeSpans   [ENQUEUE_INDEX]    =[True]\n    autodelete_lifeSpans[ENQUEUE_INDEX]    =[False]\n    passive_lifeSpans   [ENQUEUE_INDEX]    =[False]\n    exclusive_lifeSpans [ENQUEUE_INDEX]    =[False]\n    ----\n    name_queues         [DEQUEUE_INDEX]    =[1117]\n    lifeSpan_queues     [DEQUEUE_INDEX]    =[Durable]\n    durable_lifeSpans   [DEQUEUE_INDEX]    =[True]\n    autodelete_lifeSpans[DEQUEUE_INDEX]    =[False]\n    passive_lifeSpans   [DEQUEUE_INDEX]    =[False]\n    exclusive_lifeSpans [DEQUEUE_INDEX]    =[False]\n    ----\n    name_queues         [DELETEQUEUE_INDEX]=[]\n    lifeSpan_queues     [DELETEQUEUE_INDEX]=[0]\n    durable_lifeSpans   [DELETEQUEUE_INDEX]=[False]\n    autodelete_lifeSpans[DELETEQUEUE_INDEX]=[False]\n    passive_lifeSpans   [DELETEQUEUE_INDEX]=[False]\n    exclusive_lifeSpans [DELETEQUEUE_INDEX]=[False]\n    ----\n\n(tamesi34_cs.cs?) GetChannel index = [0]\n    name_queues[index] = [1116]\n    passive_lifeSpans[index] = [False]\n    durable_lifeSpans[index] = [True]\n    exclusive_lifeSpans[index] = [False]\n    autodelete_lifeSpans[index] = [False]\n    nowait は仮に false 固定\n    arguments は仮に null 固定\n Enqueue(^q^) zou\nEnqueue? \u0026gt; \u0026lt;---- [interrupt!] Dequeue(^q^) zoudaze\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003etamesi35a2_cs.exe\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e(0) name=[1117] lifeSpan=[Durable]\n(1) name=[1116] lifeSpan=[Durable]\n(tamesi35a2_cs.cs?) GetChannel index = [1]\n    name_queues[index] = [1116]\n    passive_lifeSpans[index] = [False]\n    durable_lifeSpans[index] = [True]\n    exclusive_lifeSpans[index] = [False]\n    autodelete_lifeSpans[index] = [False]\n    nowait は仮に false 固定\n    arguments は仮に null 固定\n(tamesi35a2_cs.cs?) GetChannel index = [0]\n    name_queues[index] = [1117]\n    passive_lifeSpans[index] = [False]\n    durable_lifeSpans[index] = [True]\n    exclusive_lifeSpans[index] = [False]\n    autodelete_lifeSpans[index] = [False]\n    nowait は仮に false 固定\n    arguments は仮に null 固定\n(tamesi35a2_cs.cs?) GetChannel index = [0]\n    name_queues[index] = [1117]\n    passive_lifeSpans[index] = [False]\n    durable_lifeSpans[index] = [True]\n    exclusive_lifeSpans[index] = [False]\n    autodelete_lifeSpans[index] = [False]\n    nowait は仮に false 固定\n    arguments は仮に null 固定\n(tamesi35a2_cs.cs?) GetChannel index = [0]\n    name_queues[index] = [1117]\n    passive_lifeSpans[index] = [False]\n    durable_lifeSpans[index] = [True]\n    exclusive_lifeSpans[index] = [False]\n    autodelete_lifeSpans[index] = [False]\n    nowait は仮に false 固定\n    arguments は仮に null 固定\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eWindows10 なら動いてるのにな。\u003c/p\u003e\n\n\u003cp\u003eこれを Ubuntu16.04 で実行すると\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eroot@tk2-217-18401:/home/★user/shogi/csharp_service# rm tamesi34_cs.cs\nroot@tk2-217-18401:/home/★user/shogi/csharp_service# nano tamesi34_cs.cs\nroot@tk2-217-18401:/home/★user/shogi/csharp_service# rm tamesi35a2_cs.cs\nroot@tk2-217-18401:/home/★user/shogi/csharp_service# nano tamesi35a2_cs.cs\nroot@tk2-217-18401:/home/★user/shogi/csharp_service# mcs /r:RabbitMQ.Client.dll -define:UBUNTU tamesi34_cs.cs\nroot@tk2-217-18401:/home/★user/shogi/csharp_service# mcs /r:RabbitMQ.Client.dll -define:UBUNTU tamesi35a2_cs.cs\nroot@tk2-217-18401:/home/★user/shogi/csharp_service# ./tamesi35a2_cs.exe --msgqueue 1117 durable 1116 durable \u0026gt; ./tamesi35a2_cs.out.log 2\u0026gt; ./tamesi35a2_cs.err.log \u0026lt; /dev/null \u0026amp;\n[1] 31008\nroot@tk2-217-18401:/home/★user/shogi/csharp_service# ./tamesi34_cs.exe 2\u0026gt; ./tamesi34_cs.err.log\n削除したいキューがあれば名前を、無ければ空文字列を入れろだぜ☆（＾～＾）\nキュー名を入力    : キューを削除します\n空文字列で[Enter] : 次のステップへ進む\nName or empty ? \u0026gt;\nエンキュー先のメッセージ・キューの名前を入れろだぜ☆（＾～＾）\nQueue name? \u0026gt; 1116\nエンキュー先のメッセージ・キューの寿命を、足し算して答えろだぜ☆（＾～＾）\n(1) durable    : RabbitMQが止まってもキューを残す\n(2) autodelete : コンシューマーが１人も接続していなかったら消す\n(4) passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ\n(8) exclusive  : この接続でだけ使える。この接続が切れたら消す\nNumber ? \u0026gt; 1\nデキュー先のメッセージ・キューの名前を入れろだぜ☆（＾～＾）\nQueue name? \u0026gt; 1117\nデキュー先のメッセージ・キューの寿命を、足し算して答えろだぜ☆（＾～＾）\n(1) durable    : RabbitMQが止まってもキューを残す\n(2) autodelete : コンシューマーが１人も接続していなかったら消す\n(4) passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ\n(8) exclusive  : この接続でだけ使える。この接続が切れたら消す\nNumber ? \u0026gt; 1\ntamesi34_cs.cs Dump\n    name_queues         [ENQUEUE_INDEX]    =[1116]\n    lifeSpan_queues     [ENQUEUE_INDEX]    =[Durable]\n    durable_lifeSpans   [ENQUEUE_INDEX]    =[True]\n    autodelete_lifeSpans[ENQUEUE_INDEX]    =[False]\n    passive_lifeSpans   [ENQUEUE_INDEX]    =[False]\n    exclusive_lifeSpans [ENQUEUE_INDEX]    =[False]\n    ----\n    name_queues         [DEQUEUE_INDEX]    =[1117]\n    lifeSpan_queues     [DEQUEUE_INDEX]    =[Durable]\n    durable_lifeSpans   [DEQUEUE_INDEX]    =[True]\n    autodelete_lifeSpans[DEQUEUE_INDEX]    =[False]\n    passive_lifeSpans   [DEQUEUE_INDEX]    =[False]\n    exclusive_lifeSpans [DEQUEUE_INDEX]    =[False]\n    ----\n    name_queues         [DELETEQUEUE_INDEX]=[]\n    lifeSpan_queues     [DELETEQUEUE_INDEX]=[0]\n    durable_lifeSpans   [DELETEQUEUE_INDEX]=[False]\n    autodelete_lifeSpans[DELETEQUEUE_INDEX]=[False]\n    passive_lifeSpans   [DELETEQUEUE_INDEX]=[False]\n    exclusive_lifeSpans [DELETEQUEUE_INDEX]=[False]\n    ----\n\n(tamesi34_cs.cs?) GetChannel index = [1]\n    name_queues[index] = [1117]\n    passive_lifeSpans[index] = [False]\n    durable_lifeSpans[index] = [True]\n    exclusive_lifeSpans[index] = [False]\n    autodelete_lifeSpans[index] = [False]\n    nowait は仮に false 固定\n    arguments は仮に null 固定\n終了するときは[Ctrl]+[C]キーを押せだぜ☆（＾～＾）\nエンキューするときはメッセージを打ち込んで[Enter]キーを押せだぜ☆(＾◇＾)\nEnqueue? \u0026gt; usi\ntamesi34_cs.cs Dump\n    name_queues         [ENQUEUE_INDEX]    =[1116]\n    lifeSpan_queues     [ENQUEUE_INDEX]    =[Durable]\n    durable_lifeSpans   [ENQUEUE_INDEX]    =[True]\n    autodelete_lifeSpans[ENQUEUE_INDEX]    =[False]\n    passive_lifeSpans   [ENQUEUE_INDEX]    =[False]\n    exclusive_lifeSpans [ENQUEUE_INDEX]    =[False]\n    ----\n    name_queues         [DEQUEUE_INDEX]    =[1117]\n    lifeSpan_queues     [DEQUEUE_INDEX]    =[Durable]\n    durable_lifeSpans   [DEQUEUE_INDEX]    =[True]\n    autodelete_lifeSpans[DEQUEUE_INDEX]    =[False]\n    passive_lifeSpans   [DEQUEUE_INDEX]    =[False]\n    exclusive_lifeSpans [DEQUEUE_INDEX]    =[False]\n    ----\n    name_queues         [DELETEQUEUE_INDEX]=[]\n    lifeSpan_queues     [DELETEQUEUE_INDEX]=[0]\n    durable_lifeSpans   [DELETEQUEUE_INDEX]=[False]\n    autodelete_lifeSpans[DELETEQUEUE_INDEX]=[False]\n    passive_lifeSpans   [DELETEQUEUE_INDEX]=[False]\n    exclusive_lifeSpans [DELETEQUEUE_INDEX]=[False]\n    ----\n\n(tamesi34_cs.cs?) GetChannel index = [0]\n    name_queues[index] = [1116]\n    passive_lifeSpans[index] = [False]\n    durable_lifeSpans[index] = [True]\n    exclusive_lifeSpans[index] = [False]\n    autodelete_lifeSpans[index] = [False]\n    nowait は仮に false 固定\n    arguments は仮に null 固定\n[1]+  Exit 1                  ./tamesi35a2_cs.exe --msgqueue 1117 durable 1116 durable \u0026gt; ./tamesi35a2_cs.out.log 2\u0026gt; ./tamesi35a2_cs.err.log \u0026lt; /dev/null\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003cstrong\u003eプログラム以外の理由で落ちてるのか？\u003c/strong\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e# rabbitmq-server\nERROR: node with name \"rabbit\" already running on \"tk2-217-18401\"\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e# nano tamesi34_cs.err.log\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eUnhandled Exception:\nRabbitMQ.Client.Exceptions.OperationInterruptedException: The AMQP operation was interrupted: AMQP close-reason, initiated by Peer, code=406, text=\"PRECONDITION_FAILED - inequivalent arg 'durable' for queue '1116' in vhost '/': receiv$\n  at RabbitMQ.Client.Impl.SimpleBlockingRpcContinuation.GetReply () \u0026lt;0x40d35fd0 + 0x00103\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at RabbitMQ.Client.Impl.ModelBase.ModelRpc (RabbitMQ.Client.Impl.MethodBase method, RabbitMQ.Client.Impl.ContentHeaderBase header, System.Byte[] body) \u0026lt;0x40d33da0 + 0x000f9\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at RabbitMQ.Client.Framing.Impl.v0_8.Model.QueueDeclare (System.String queue, Boolean passive, Boolean durable, Boolean exclusive, Boolean autoDelete, Boolean nowait, IDictionary arguments) \u0026lt;0x40d38f30 + 0x00113\u0026gt; in \u0026lt;filename unknow$\n  at UsagiMQ.Program.GetChannel (Int32 index) \u0026lt;0x40cf98c0 + 0x0045c\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at UsagiMQ.Program.Enqueue (System.String message) \u0026lt;0x40d3a030 + 0x00013\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at UsagiMQ.Program.Main (System.String[] args) \u0026lt;0x40cf4d50 + 0x009a7\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n[ERROR] FATAL UNHANDLED EXCEPTION: RabbitMQ.Client.Exceptions.OperationInterruptedException: The AMQP operation was interrupted: AMQP close-reason, initiated by Peer, code=406, text=\"PRECONDITION_FAILED - inequivalent arg 'durable' fo$\n  at RabbitMQ.Client.Impl.SimpleBlockingRpcContinuation.GetReply () \u0026lt;0x40d35fd0 + 0x00103\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at RabbitMQ.Client.Impl.ModelBase.ModelRpc (RabbitMQ.Client.Impl.MethodBase method, RabbitMQ.Client.Impl.ContentHeaderBase header, System.Byte[] body) \u0026lt;0x40d33da0 + 0x000f9\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at RabbitMQ.Client.Framing.Impl.v0_8.Model.QueueDeclare (System.String queue, Boolean passive, Boolean durable, Boolean exclusive, Boolean autoDelete, Boolean nowait, IDictionary arguments) \u0026lt;0x40d38f30 + 0x00113\u0026gt; in \u0026lt;filename unknow$\n  at UsagiMQ.Program.GetChannel (Int32 index) \u0026lt;0x40cf98c0 + 0x0045c\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at UsagiMQ.Program.Enqueue (System.String message) \u0026lt;0x40d3a030 + 0x00013\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at UsagiMQ.Program.Main (System.String[] args) \u0026lt;0x40cf4d50 + 0x009a7\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e# nano tamesi35a2_cs.err.log\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e(tamesi35a2_cs.cs?) GetChannel index = [1]\n    name_queues[index] = [1116]\n    passive_lifeSpans[index] = [False]\n    durable_lifeSpans[index] = [True]\n    exclusive_lifeSpans[index] = [False]\n    autodelete_lifeSpans[index] = [False]\n    nowait は仮に false 固定\n    arguments は仮に null 固定\n\nUnhandled Exception:\nRabbitMQ.Client.Exceptions.OperationInterruptedException: The AMQP operation was interrupted: AMQP close-reason, initiated by Peer, code=406, text=\"PRECONDITION_FAILED - inequivalent arg 'durable' for queue '1116' in vhost '/': received 'true' but current is 'f$\n  at RabbitMQ.Client.Impl.SimpleBlockingRpcContinuation.GetReply () \u0026lt;0x41f435b0 + 0x00107\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at RabbitMQ.Client.Impl.ModelBase.ModelRpc (RabbitMQ.Client.Impl.MethodBase method, RabbitMQ.Client.Impl.ContentHeaderBase header, System.Byte[] body) \u0026lt;0x41f413f0 + 0x00101\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at RabbitMQ.Client.Framing.Impl.v0_8.Model.QueueDeclare (System.String queue, Boolean passive, Boolean durable, Boolean exclusive, Boolean autoDelete, Boolean nowait, IDictionary arguments) \u0026lt;0x41f45790 + 0x00113\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at Program.GetChannel (Int32 index) \u0026lt;0x41f05890 + 0x00436\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at Program.StartConsume () \u0026lt;0x41f057d0 + 0x0000f\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at Program.Main (System.String[] args) \u0026lt;0x41f03270 + 0x0037b\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n[ERROR] FATAL UNHANDLED EXCEPTION: RabbitMQ.Client.Exceptions.OperationInterruptedException: The AMQP operation was interrupted: AMQP close-reason, initiated by Peer, code=406, text=\"PRECONDITION_FAILED - inequivalent arg 'durable' for queue '1116' in vhost '/'$\n  at RabbitMQ.Client.Impl.SimpleBlockingRpcContinuation.GetReply () \u0026lt;0x41f435b0 + 0x00107\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at RabbitMQ.Client.Impl.ModelBase.ModelRpc (RabbitMQ.Client.Impl.MethodBase method, RabbitMQ.Client.Impl.ContentHeaderBase header, System.Byte[] body) \u0026lt;0x41f413f0 + 0x00101\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at RabbitMQ.Client.Framing.Impl.v0_8.Model.QueueDeclare (System.String queue, Boolean passive, Boolean durable, Boolean exclusive, Boolean autoDelete, Boolean nowait, IDictionary arguments) \u0026lt;0x41f45790 + 0x00113\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at Program.GetChannel (Int32 index) \u0026lt;0x41f05890 + 0x00436\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at Program.StartConsume () \u0026lt;0x41f057d0 + 0x0000f\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at Program.Main (System.String[] args) \u0026lt;0x41f03270 + 0x0037b\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e# nano tamesi35a2_cs.out.log\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e(0) name=[1117] lifeSpan=[Durable]\n(1) name=[1116] lifeSpan=[Durable]\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eうーむ、\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eRabbitMQ.Client.Framing.Impl.v0_8.Model.QueueDeclare (System.String queue, Boolean passive, Boolean durable, Boolean exclusive, Boolean autoDelete, Boolean nowait, IDictionary arguments)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこの引数の順序はあってるんだろうか？\u003c/p\u003e\n\n\u003cp\u003e順序はあってるし、どうも UBUNTU だと false と言ってくる。 UBUNTU のときだけ全部 false にしてみるか？\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"ubuntuのときだけ引数をfalse-にするとどうか\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#ubuntu%E3%81%AE%E3%81%A8%E3%81%8D%E3%81%A0%E3%81%91%E5%BC%95%E6%95%B0%E3%82%92false-%E3%81%AB%E3%81%99%E3%82%8B%E3%81%A8%E3%81%A9%E3%81%86%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eUBUNTUのときだけ引数をfalse にするとどうか？\u003c/h1\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eroot@tk2-217-18401:/home/★user/shogi/csharp_service# ./tamesi35a2_cs.exe --msgqueue 1117 durable 1116 durable \u0026gt; ./tamesi35a2_cs.out.log 2\u0026gt; ./tamesi35a2_cs.err.log \u0026lt; /dev/null \u0026amp;\n[3] 31371\nroot@tk2-217-18401:/home/★user/shogi/csharp_service# ./tamesi34_cs.exe 2\u0026gt; ./tamesi34_cs.err.log\n削除したいキューがあれば名前を、無ければ空文字列を入れろだぜ☆（＾～＾）\nキュー名を入力    : キューを削除します\n空文字列で[Enter] : 次のステップへ進む\nName or empty ? \u0026gt;\nエンキュー先のメッセージ・キューの名前を入れろだぜ☆（＾～＾）\nQueue name? \u0026gt; 1116\nエンキュー先のメッセージ・キューの寿命を、足し算して答えろだぜ☆（＾～＾）\n(1) durable    : RabbitMQが止まってもキューを残す\n(2) autodelete : コンシューマーが１人も接続していなかったら消す\n(4) passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ\n(8) exclusive  : この接続でだけ使える。この接続が切れたら消す\nNumber ? \u0026gt; 1\nデキュー先のメッセージ・キューの名前を入れろだぜ☆（＾～＾）\nQueue name? \u0026gt; 1117\nデキュー先のメッセージ・キューの寿命を、足し算して答えろだぜ☆（＾～＾）\n(1) durable    : RabbitMQが止まってもキューを残す\n(2) autodelete : コンシューマーが１人も接続していなかったら消す\n(4) passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ\n(8) exclusive  : この接続でだけ使える。この接続が切れたら消す\nNumber ? \u0026gt; 1\ntamesi34_cs.cs Dump\n    name_queues         [ENQUEUE_INDEX]    =[1116]\n    lifeSpan_queues     [ENQUEUE_INDEX]    =[Durable]\n    durable_lifeSpans   [ENQUEUE_INDEX]    =[True]\n    autodelete_lifeSpans[ENQUEUE_INDEX]    =[False]\n    passive_lifeSpans   [ENQUEUE_INDEX]    =[False]\n    exclusive_lifeSpans [ENQUEUE_INDEX]    =[False]\n    ----\n    name_queues         [DEQUEUE_INDEX]    =[1117]\n    lifeSpan_queues     [DEQUEUE_INDEX]    =[Durable]\n    durable_lifeSpans   [DEQUEUE_INDEX]    =[True]\n    autodelete_lifeSpans[DEQUEUE_INDEX]    =[False]\n    passive_lifeSpans   [DEQUEUE_INDEX]    =[False]\n    exclusive_lifeSpans [DEQUEUE_INDEX]    =[False]\n    ----\n    name_queues         [DELETEQUEUE_INDEX]=[]\n    lifeSpan_queues     [DELETEQUEUE_INDEX]=[0]\n    durable_lifeSpans   [DELETEQUEUE_INDEX]=[False]\n    autodelete_lifeSpans[DELETEQUEUE_INDEX]=[False]\n    passive_lifeSpans   [DELETEQUEUE_INDEX]=[False]\n    exclusive_lifeSpans [DELETEQUEUE_INDEX]=[False]\n    ----\n\n(tamesi34_cs.cs?) GetChannel index = [1]\n    name_queues[index] = [1117]\n    passive_lifeSpans[index] = [False]\n    durable_lifeSpans[index] = [True]\n    exclusive_lifeSpans[index] = [False]\n    autodelete_lifeSpans[index] = [False]\n    nowait は仮に false 固定\n    arguments は仮に null 固定\n終了するときは[Ctrl]+[C]キーを押せだぜ☆（＾～＾）\nエンキューするときはメッセージを打ち込んで[Enter]キーを押せだぜ☆(＾◇＾)\nEnqueue? \u0026gt; usi\ntamesi34_cs.cs Dump\n    name_queues         [ENQUEUE_INDEX]    =[1116]\n    lifeSpan_queues     [ENQUEUE_INDEX]    =[Durable]\n    durable_lifeSpans   [ENQUEUE_INDEX]    =[True]\n    autodelete_lifeSpans[ENQUEUE_INDEX]    =[False]\n    passive_lifeSpans   [ENQUEUE_INDEX]    =[False]\n    exclusive_lifeSpans [ENQUEUE_INDEX]    =[False]\n    ----\n    name_queues         [DEQUEUE_INDEX]    =[1117]\n    lifeSpan_queues     [DEQUEUE_INDEX]    =[Durable]\n    durable_lifeSpans   [DEQUEUE_INDEX]    =[True]\n    autodelete_lifeSpans[DEQUEUE_INDEX]    =[False]\n    passive_lifeSpans   [DEQUEUE_INDEX]    =[False]\n    exclusive_lifeSpans [DEQUEUE_INDEX]    =[False]\n    ----\n    name_queues         [DELETEQUEUE_INDEX]=[]\n    lifeSpan_queues     [DELETEQUEUE_INDEX]=[0]\n    durable_lifeSpans   [DELETEQUEUE_INDEX]=[False]\n    autodelete_lifeSpans[DELETEQUEUE_INDEX]=[False]\n    passive_lifeSpans   [DELETEQUEUE_INDEX]=[False]\n    exclusive_lifeSpans [DELETEQUEUE_INDEX]=[False]\n    ----\n\n(tamesi34_cs.cs?) GetChannel index = [0]\n    name_queues[index] = [1116]\n    passive_lifeSpans[index] = [False]\n    durable_lifeSpans[index] = [True]\n    exclusive_lifeSpans[index] = [False]\n    autodelete_lifeSpans[index] = [False]\n    nowait は仮に false 固定\n    arguments は仮に null 固定\n[3]   Exit 1                  ./tamesi35a2_cs.exe --msgqueue 1117 durable 1116 durable \u0026gt; ./tamesi35a2_cs.out.log 2\u0026gt; ./tamesi35a2_cs.err.log \u0026lt; /dev/null\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e落ちているようだ。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e(tamesi35a2_cs.cs?) GetChannel index = [1]\n    name_queues[index] = [1116]\n    passive_lifeSpans[index] = [False]\n    durable_lifeSpans[index] = [True]\n    exclusive_lifeSpans[index] = [False]\n    autodelete_lifeSpans[index] = [False]\n    nowait は仮に false 固定\n    arguments は仮に null 固定\n\nUnhandled Exception:\nRabbitMQ.Client.Exceptions.OperationInterruptedException: The AMQP operation was interrupted: AMQP close-reason, initiated by Peer, code=406, text=\"PRECONDITION_FAILED - inequivalent arg 'durable' for queue '1116' in vhost '/': re$\n  at RabbitMQ.Client.Impl.SimpleBlockingRpcContinuation.GetReply () \u0026lt;0x403416a0 + 0x00107\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at RabbitMQ.Client.Impl.ModelBase.ModelRpc (RabbitMQ.Client.Impl.MethodBase method, RabbitMQ.Client.Impl.ContentHeaderBase header, System.Byte[] body) \u0026lt;0x4033f520 + 0x000fd\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at RabbitMQ.Client.Framing.Impl.v0_8.Model.QueueDeclare (System.String queue, Boolean passive, Boolean durable, Boolean exclusive, Boolean autoDelete, Boolean nowait, IDictionary arguments) \u0026lt;0x40343880 + 0x00113\u0026gt; in \u0026lt;filename un$\n  at Program.GetChannel (Int32 index) \u0026lt;0x40303890 + 0x00436\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at Program.StartConsume () \u0026lt;0x403037d0 + 0x0000f\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at Program.Main (System.String[] args) \u0026lt;0x40301270 + 0x0037b\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n[ERROR] FATAL UNHANDLED EXCEPTION: RabbitMQ.Client.Exceptions.OperationInterruptedException: The AMQP operation was interrupted: AMQP close-reason, initiated by Peer, code=406, text=\"PRECONDITION_FAILED - inequivalent arg 'durable$\n  at RabbitMQ.Client.Impl.SimpleBlockingRpcContinuation.GetReply () \u0026lt;0x403416a0 + 0x00107\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at RabbitMQ.Client.Impl.ModelBase.ModelRpc (RabbitMQ.Client.Impl.MethodBase method, RabbitMQ.Client.Impl.ContentHeaderBase header, System.Byte[] body) \u0026lt;0x4033f520 + 0x000fd\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at RabbitMQ.Client.Framing.Impl.v0_8.Model.QueueDeclare (System.String queue, Boolean passive, Boolean durable, Boolean exclusive, Boolean autoDelete, Boolean nowait, IDictionary arguments) \u0026lt;0x40343880 + 0x00113\u0026gt; in \u0026lt;filename un$\n  at Program.GetChannel (Int32 index) \u0026lt;0x40303890 + 0x00436\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at Program.StartConsume () \u0026lt;0x403037d0 + 0x0000f\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at Program.Main (System.String[] args) \u0026lt;0x40301270 + 0x0037b\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eRabbitMQ.Client.Exceptions.OperationInterruptedException\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eというのは、どういうエラーなのか？\u003c/p\u003e\n\n\u003cp\u003e（public class OperationInterruptedException）「www.rabbitmq.com」\u003cbr\u003e\n\u003ca href=\"https://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v2.8.6/rabbitmq-dotnet-client-2.8.6-client-htmldoc/html/type-RabbitMQ.Client.Exceptions.OperationInterruptedException.html\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v2.8.6/rabbitmq-dotnet-client-2.8.6-client-htmldoc/html/type-RabbitMQ.Client.Exceptions.OperationInterruptedException.html\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eUbuntu16.04 だと、TCP接続がなぜ切れるのか？\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eConsole.WriteLine( \"(\"+i+\") name=[\"+ name_queues[i] + \"] lifeSpan=[\"+ lifeSpan_queues[i] + \"]\");\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこういうテスト用の標準出力を全部　コメントアウトしてみよう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e終了するときは[Ctrl]+[C]キーを押せだぜ☆（＾～＾）\nエンキューするときはメッセージを打ち込んで[Enter]キーを押せだぜ☆(＾◇＾)\nEnqueue? \u0026gt; usi\ntamesi34_cs.cs Dump\n    name_queues         [ENQUEUE_INDEX]    =[1116]\n    lifeSpan_queues     [ENQUEUE_INDEX]    =[Durable]\n    durable_lifeSpans   [ENQUEUE_INDEX]    =[True]\n    autodelete_lifeSpans[ENQUEUE_INDEX]    =[False]\n    passive_lifeSpans   [ENQUEUE_INDEX]    =[False]\n    exclusive_lifeSpans [ENQUEUE_INDEX]    =[False]\n    ----\n    name_queues         [DEQUEUE_INDEX]    =[1117]\n    lifeSpan_queues     [DEQUEUE_INDEX]    =[Durable]\n    durable_lifeSpans   [DEQUEUE_INDEX]    =[True]\n    autodelete_lifeSpans[DEQUEUE_INDEX]    =[False]\n    passive_lifeSpans   [DEQUEUE_INDEX]    =[False]\n    exclusive_lifeSpans [DEQUEUE_INDEX]    =[False]\n    ----\n    name_queues         [DELETEQUEUE_INDEX]=[]\n    lifeSpan_queues     [DELETEQUEUE_INDEX]=[0]\n    durable_lifeSpans   [DELETEQUEUE_INDEX]=[False]\n    autodelete_lifeSpans[DELETEQUEUE_INDEX]=[False]\n    passive_lifeSpans   [DELETEQUEUE_INDEX]=[False]\n    exclusive_lifeSpans [DELETEQUEUE_INDEX]=[False]\n    ----\n\n(tamesi34_cs.cs?) GetChannel index = [0]\n    name_queues[index] = [1116]\n    passive_lifeSpans[index] = [False]\n    durable_lifeSpans[index] = [True]\n    exclusive_lifeSpans[index] = [False]\n    autodelete_lifeSpans[index] = [False]\n    nowait は仮に false 固定\n    arguments は仮に null 固定\n[3]   Exit 1                  ./tamesi35a2_cs.exe --msgqueue 1117 durable 1116 durable \u0026gt; ./tamesi35a2_cs.out.log 2\u0026gt; ./tamesi35a2_cs.err.log \u0026lt; /dev/null\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eそれでもダメ。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ereceived 'true' but current is 'false'\", classId=50, methodId=10, cause=\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ereceived 'true' but current is 'false'\", classId=50, methodId=10, cause=\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eうーむ。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"ググろう\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B0%E3%82%B0%E3%82%8D%E3%81%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eググろう\u003c/h1\u003e\n\n\u003cp\u003e「PRECONDITION_FAILED - inequivalent arg 'durable' for queue #370」（MassTransit/MassTransit）\u003cbr\u003e\n\u003ca href=\"https://github.com/MassTransit/MassTransit/issues/370\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/MassTransit/MassTransit/issues/370\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e「Issue in establishing connection with Rabbit MQ」（stack overflow）\u003cbr\u003e\n\u003ca href=\"http://stackoverflow.com/questions/31762563/issue-in-establishing-connection-with-rabbit-mq\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://stackoverflow.com/questions/31762563/issue-in-establishing-connection-with-rabbit-mq\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e「Correct config using rabbitmq as celery backend」（stack overflow）\u003cbr\u003e\n\u003ca href=\"http://stackoverflow.com/questions/27623940/correct-config-using-rabbitmq-as-celery-backend\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://stackoverflow.com/questions/27623940/correct-config-using-rabbitmq-as-celery-backend\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"複数指定したい\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A4%87%E6%95%B0%E6%8C%87%E5%AE%9A%E3%81%97%E3%81%9F%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e複数指定したい\u003c/h1\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e--msgqueue 1117 durable 1116 durable\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれを、\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e--enqueue durable autodelete --dequeue durable autodelete\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eみたいに、複数指定できるようにしたい。\u003c/p\u003e\n\n\u003cp\u003eこんな感じだろうか。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e//--------------------------------------------------------------------------------\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// tamesi35a2_cs.cs\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// メッセージの末尾に daze を付けます。\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 標準入出力は、キーボード、画面には接続しないようにします。\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// キューの名前はコマンドライン引数で指定してください。\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// デキューは割込みを受け付けます。\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//--------------------------------------------------------------------------------\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// OS  : Windows 10\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// IDE : Visual Studio 2015\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//       Install : NuGet   : Install-Package RabbitMQ.Client -Version 4.1.1\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//       Execute : Command : ./tamesi35a2_cs.exe --enqueue 1117 durable --dequeue 1116 durable\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// OS  : Ubuntu 16.04\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//       Compile : Command : mcs /r:RabbitMQ.Client.dll -define:UBUNTU tamesi35a2_cs.cs\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//       Execute : Command : // バックグラウンドで実行する\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//                         : nohup ./tamesi35a2_cs.exe --enqueue 1117 durable autodelete --dequeue 1116 durable autodelete \u0026gt; ./tamesi35a2_cs.out.log 2\u0026gt; ./tamesi35a2_cs.err.log \u0026lt; /dev/null \u0026amp;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//       Check   :         : // tamesi33a1_cs.exe を使う\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//--------------------------------------------------------------------------------\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// Ubuntu の RabbitMQ はソースのバージョンが古いのか、API が異なった。\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// #define UBUNTU\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eRabbitMQ.Client\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eRabbitMQ.Client.Events\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Text\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Threading\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// このプログラム内だけで使われる数字。AMQP-CPPでの実装とは異なる。\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// AMQP-CPPでの実装 : AMQP::durable=[1] AMQP::autodelete=[2] AMQP::passive=[8] AMQP::exclusive=[512]\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003cspan class=\"k\"\u003eenum\u003c/span\u003e \u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// RabbitMQが止まってもキューを残す\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eDurable\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// コンシューマーが１人も接続していなかったら消す\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eAutodelete\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x1\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// キューが存在するかどうかチェックするだけ。中身見ない時これ\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ePassive\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x1\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// この接続でだけ使える。この接続が切れたら消す\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eExclusive\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0x1\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"m\"\u003e3\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// 参照 : QueueDeclare http://docs.spring.io/spring-amqp-net/docs/1.0.x/api/html/Spring.Messaging.Amqp.Rabbit~Spring.Messaging.Amqp.Rabbit.Connection.CachedModel~QueueDeclare(String,Boolean,Boolean,Boolean,Boolean,Boolean,IDictionary).html\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// 参照 : EventingBasicConsumer https://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v1.4.0/rabbitmq-dotnet-client-1.4.0-net-2.0-htmldoc/type-RabbitMQ.Client.Events.EventingBasicConsumer.html\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// 参照 : BasicConsume https://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v1.4.0/rabbitmq-dotnet-client-1.4.0-net-2.0-htmldoc/type-RabbitMQ.Client.IModel.html#method-M:RabbitMQ.Client.IModel.BasicConsume(System.UInt16,System.String,System.Boolean,System.Collections.IDictionary,RabbitMQ.Client.IBasicConsumer)\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// 参照 : C#でconstな配列を実現する (もっとクールにプログラミング) http://pgnote.net/?p=885\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eProgram\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eENQUEUE_INDEX\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eDEQUEUE_INDEX\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eNUM_INDEX\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eHOST_NAME\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"localhost\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003ename_queues\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eNUM_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// キューの寿命（複合可能）\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// durable    : RabbitMQが止まってもキューを残す\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// autodelete : コンシューマーが１人も接続していなかったら消す\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// exclusive  : この接続でだけ使える。この接続が切れたら消す\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan_queues\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eNUM_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e \u003cspan class=\"nf\"\u003eLifeSpanString_To_Enum\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eswitch\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elifeSpan\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e\"durable\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDurable\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e\"autodelete\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAutodelete\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e\"passive\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePassive\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e\"exclusive\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eExclusive\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"k\"\u003edefault\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eException\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"未対応のlifeSpan [\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\"]\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e\n        \u003cspan class=\"n\"\u003edurable_lifeSpans\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eNUM_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eautodelete_lifeSpans\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eNUM_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n        \u003cspan class=\"n\"\u003epassive_lifeSpans\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eNUM_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eexclusive_lifeSpans\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eNUM_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eSetLifeSpan\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eindex_queue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ename_queue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 一旦クリアー\u003c/span\u003e\n        \u003cspan class=\"n\"\u003edurable_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex_queue\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eautodelete_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex_queue\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003epassive_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex_queue\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eexclusive_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex_queue\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// durable\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(((\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003elifeSpan\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDurable\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDurable\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003edurable_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex_queue\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// autodelete\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(((\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003elifeSpan\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAutodelete\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAutodelete\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003eautodelete_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex_queue\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// passive\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(((\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003elifeSpan\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePassive\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePassive\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003epassive_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex_queue\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// exclusive\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(((\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003elifeSpan\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eExclusive\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeSpanType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eExclusive\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003eexclusive_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex_queue\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// 回転式バッファー\u003c/span\u003e\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eRotationBuffer\u003c/span\u003e \u003cspan class=\"n\"\u003erollingBuffer\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eRotationBuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eConnectionFactory\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetFactory\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003em_factory_\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003em_factory_\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eConnectionFactory\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003eHostName\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eHOST_NAME\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003em_factory_\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eConnectionFactory\u003c/span\u003e \u003cspan class=\"n\"\u003em_factory_\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eIConnection\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetConnection\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003em_connection_\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003em_connection_\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetFactory\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateConnection\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003em_connection_\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eIConnection\u003c/span\u003e \u003cspan class=\"n\"\u003em_connection_\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"nf\"\u003eIsConnected\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003em_connection_\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003em_connection_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIsOpen\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eIModel\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetChannel\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003em_channels_\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003em_channels_\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetConnection\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateModel\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// 引数が7つの QueueDeclare でエラーを吐くことがあるので、情報を出力しておく。\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eError\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"(tamesi35a2_cs.cs?) GetChannel index = [\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\"]\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eError\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"    name_queues[index] = [\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003ename_queues\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\"]\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eError\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"    passive_lifeSpans[index] = [\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003epassive_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\"]\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eError\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"    durable_lifeSpans[index] = [\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003edurable_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\"]\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eError\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"    exclusive_lifeSpans[index] = [\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eexclusive_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\"]\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eError\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"    autodelete_lifeSpans[index] = [\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eautodelete_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\"]\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eError\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"    nowait は仮に false 固定\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eError\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"    arguments は仮に null 固定\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"cp\"\u003e#if UBUNTU\n\u003c/span\u003e            \u003cspan class=\"c1\"\u003e// Ubuntuでは何故か Spring.Messaging.Amqp.Rabbit の引数 7 つのやつになっている。\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// m_channels_[index].QueueDeclare(name_queues[index], false, false, false, false, false, null);\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// そして false になっているようだ。\u003c/span\u003e\n            \u003cspan class=\"n\"\u003em_channels_\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nf\"\u003eQueueDeclare\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ename_queues\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003epassive_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003edurable_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003eexclusive_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003eautodelete_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e//m_channels_[index].QueueDeclare(name_queues[index], false, false, false, false, false, null);\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#else\n\u003c/span\u003e            \u003cspan class=\"c1\"\u003e//m_channels_[index].QueueDeclare(name_queues[index], false, false, false, null);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003em_channels_\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nf\"\u003eQueueDeclare\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ename_queues\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003edurable_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003eexclusive_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003eautodelete_lifeSpans\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#endif\n\u003c/span\u003e        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003em_channels_\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eIModel\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003em_channels_\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eIModel\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eEventingBasicConsumer\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetConsumer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003em_consumers_\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#if UBUNTU\n\u003c/span\u003e            \u003cspan class=\"c1\"\u003e// Ubuntuでは何故か v1.4.0 の引数が 0 個のやつになっている。調べたが引数が1個～6個のものは無かった。\u003c/span\u003e\n            \u003cspan class=\"n\"\u003em_consumers_\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eEventingBasicConsumer\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#else\n\u003c/span\u003e            \u003cspan class=\"n\"\u003em_consumers_\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eEventingBasicConsumer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetChannel\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#endif\n\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003em_consumers_\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eEventingBasicConsumer\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003em_consumers_\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eEventingBasicConsumer\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// 受信できたときに割り込んでくる処理\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#if UBUNTU\n\u003c/span\u003e    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eBasicDeliverEventHandler\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetDequeueHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#else\n\u003c/span\u003e    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eEventHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eBasicDeliverEventArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetDequeueHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#endif\n\u003c/span\u003e    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003em_dequeueHandler_\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#if UBUNTU\n\u003c/span\u003e            \u003cspan class=\"n\"\u003em_dequeueHandler_\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eBasicDeliverEventHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003emodel\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eea\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#else\n\u003c/span\u003e            \u003cspan class=\"n\"\u003em_dequeueHandler_\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eEventHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eBasicDeliverEventArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;((\u003c/span\u003e\u003cspan class=\"n\"\u003emodel\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eea\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#endif\n\u003c/span\u003e            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003ebody\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eea\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBody\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eEncoding\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUTF8\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetString\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebody\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n                \u003cspan class=\"c1\"\u003e// 回転式バッファーに入れる\u003c/span\u003e\n                \u003cspan class=\"n\"\u003erollingBuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ePutMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003em_dequeueHandler_\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"cp\"\u003e#if UBUNTU\n\u003c/span\u003e    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eBasicDeliverEventHandler\u003c/span\u003e \u003cspan class=\"n\"\u003em_dequeueHandler_\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#else\n\u003c/span\u003e    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eEventHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eBasicDeliverEventArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003em_dequeueHandler_\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#endif\n\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// 対応するオープンは無いけれど、開けたら閉める、を完璧に対応する必要がある。\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eCloseChannel\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003em_channels_\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003em_channels_\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nf\"\u003eClose\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003em_channels_\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eEnqueue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 末尾に daze を付ける。\u003c/span\u003e\n        \u003cspan class=\"n\"\u003emessage\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"daze\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003eIModel\u003c/span\u003e \u003cspan class=\"n\"\u003echannel\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetChannel\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eENQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003ebody\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eEncoding\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUTF8\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetBytes\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eBasicPublish\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ename_queues\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eENQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ebody\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// 対応するオープンは無いが、ちゃんと閉じないと、レシーブしてくれない。\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eCloseChannel\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eENQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eStartConsume\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eIModel\u003c/span\u003e \u003cspan class=\"n\"\u003echannel\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetChannel\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDEQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eEventingBasicConsumer\u003c/span\u003e \u003cspan class=\"n\"\u003econsumer\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetConsumer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDEQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 受信できたときに割り込んでくる処理\u003c/span\u003e\n        \u003cspan class=\"n\"\u003econsumer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eReceived\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetDequeueHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n\u003cspan class=\"cp\"\u003e#if UBUNTU\n\u003c/span\u003e        \u003cspan class=\"c1\"\u003e// Ubuntuでは何故か引数が 5 個のやつになっている。\u003c/span\u003e\n        \u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eBasicConsume\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003ename_queues\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eDEQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003econsumer\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#else\n\u003c/span\u003e        \u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eBasicConsume\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003ename_queues\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eDEQUEUE_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003econsumer\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#endif\n\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 終了はさせない\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// consumer.Received -= GetReceiveHandler();\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// CloseChannel(DEQUEUE_INDEX);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eStartProduce\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 無限ループ\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ewhile\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nf\"\u003eIsConnected\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003erollingBuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e// エンキューする\u003c/span\u003e\n                \u003cspan class=\"nf\"\u003eEnqueue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eThread\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSleep\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e20\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eMain\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003egoto\u003c/span\u003e \u003cspan class=\"n\"\u003egt_Error1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// 引数の解析\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// 与件\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// 「--enqueue 1117 durable autodelete --dequeue 1116 durable autodelete」\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// 寿命は可変個数設定可能「durable」「autodelete」「passive」「exclusive」\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// 受け皿\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// 0:enqueue 1:dequeue\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// 記憶\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003em0\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 0:ニュートラル 1:enqueue 2:dequeue\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003em1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 0:寿命カーソル\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// 解析器\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eStartsWith\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"--\"\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003eswitch\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                        \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e\"--enqueue\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003em0\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003em1\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                        \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e\"--dequeue\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003em0\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003em1\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                        \u003cspan class=\"k\"\u003edefault\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003egoto\u003c/span\u003e \u003cspan class=\"n\"\u003egt_Error1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003em1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003ename_queues\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003em0\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003em1\u003c/span\u003e\u003cspan class=\"p\"\u003e++;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan_queues\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003em0\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e|=\u003c/span\u003e \u003cspan class=\"nf\"\u003eLifeSpanString_To_Enum\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"n\"\u003em1\u003c/span\u003e\u003cspan class=\"p\"\u003e++;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// 結果\u003c/span\u003e\n            \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"s\"\u003e\"(\"\u003c/span\u003e\u003cspan class=\"p\"\u003e+\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e+\u003c/span\u003e\u003cspan class=\"s\"\u003e\") name=[\"\u003c/span\u003e\u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003ename_queues\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\"] lifeSpan=[\"\u003c/span\u003e\u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan_queues\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\"]\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"nf\"\u003eSetLifeSpan\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ename_queues\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003elifeSpan_queues\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// 常時監視をスタート\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eStartConsume\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n        \u003cspan class=\"nf\"\u003eStartProduce\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// このプログラムは、自分では接続を切らない。\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003egt_Error1\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eException\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e@\"コマンドライン引数に「--msgqueue キュー名 寿命 キュー名 寿命」を指定しろだぜ☆（＾～＾）\nエンキュー先、デキュー先の順番な☆（＾▽＾）\n寿命は durable, autodelete, passive, exclusive のいずれかで、\n複合指定にはまだ対応していないぜ☆（＞＿＜）\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// 回転式バッファー。\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// これはメイン・スレッドに置く。\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// デキューのスレッドでエンキューすることはできない。\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// デキュー処理は、回転式バッファーを仲介にしてエンキュー処理にメッセージを渡す。\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eRotationBuffer\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ebufferSize\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e100\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ebufferSize\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ePUT_INDEX\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eGET_INDEX\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003ePutMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ePUT_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e]]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ePUT_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e]++;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(!(\u003c/span\u003e\u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ePUT_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003ebufferSize\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ePUT_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eGET_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e]])\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eGET_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e]];\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eGET_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e]]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eGET_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e]++;\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(!(\u003c/span\u003e\u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eGET_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003ebufferSize\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003ebufferCursors\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eGET_INDEX\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eroot@tk2-217-18401:/home/★user/shogi/csharp_service# rm tamesi35a2_cs.cs\nroot@tk2-217-18401:/home/★user/shogi/csharp_service# nano tamesi35a2_cs.cs\nroot@tk2-217-18401:/home/★user/shogi/csharp_service# mcs /r:RabbitMQ.Client.dll -define:UBUNTU tamesi35a2_cs.cs\nroot@tk2-217-18401:/home/★user/shogi/csharp_service# ./tamesi35a2_cs.exe --enqueue 1117 durable autodelete --dequeue 1116 durable autodelete \u0026gt; ./tamesi35a2_cs.out.log 2\u0026gt; ./tamesi35a2_cs.err.log \u0026lt; /dev/null \u0026amp;\n[4] 470\nroot@tk2-217-18401:/home/★user/shogi/csharp_service# ./tamesi34_cs.exe 2\u0026gt; ./tamesi34_cs.err.log\n削除したいキューがあれば名前を、無ければ空文字列を入れろだぜ☆（＾～＾）\nキュー名を入力    : キューを削除します\n空文字列で[Enter] : 次のステップへ進む\nName or empty ? \u0026gt;\nエンキュー先のメッセージ・キューの名前を入れろだぜ☆（＾～＾）\nQueue name? \u0026gt; 1116\nエンキュー先のメッセージ・キューの寿命を、足し算して答えろだぜ☆（＾～＾）\n(1) durable    : RabbitMQが止まってもキューを残す\n(2) autodelete : コンシューマーが１人も接続していなかったら消す\n(4) passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ\n(8) exclusive  : この接続でだけ使える。この接続が切れたら消す\nNumber ? \u0026gt; 3\nデキュー先のメッセージ・キューの名前を入れろだぜ☆（＾～＾）\nQueue name? \u0026gt; 1117\nデキュー先のメッセージ・キューの寿命を、足し算して答えろだぜ☆（＾～＾）\n(1) durable    : RabbitMQが止まってもキューを残す\n(2) autodelete : コンシューマーが１人も接続していなかったら消す\n(4) passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ\n(8) exclusive  : この接続でだけ使える。この接続が切れたら消す\nNumber ? \u0026gt; 3\ntamesi34_cs.cs Dump\n    name_queues         [ENQUEUE_INDEX]    =[1116]\n    lifeSpan_queues     [ENQUEUE_INDEX]    =[Durable, Autodelete]\n    durable_lifeSpans   [ENQUEUE_INDEX]    =[True]\n    autodelete_lifeSpans[ENQUEUE_INDEX]    =[True]\n    passive_lifeSpans   [ENQUEUE_INDEX]    =[False]\n    exclusive_lifeSpans [ENQUEUE_INDEX]    =[False]\n    ----\n    name_queues         [DEQUEUE_INDEX]    =[1117]\n    lifeSpan_queues     [DEQUEUE_INDEX]    =[Durable, Autodelete]\n    durable_lifeSpans   [DEQUEUE_INDEX]    =[True]\n    autodelete_lifeSpans[DEQUEUE_INDEX]    =[True]\n    passive_lifeSpans   [DEQUEUE_INDEX]    =[False]\n    exclusive_lifeSpans [DEQUEUE_INDEX]    =[False]\n    ----\n    name_queues         [DELETEQUEUE_INDEX]=[]\n    lifeSpan_queues     [DELETEQUEUE_INDEX]=[0]\n    durable_lifeSpans   [DELETEQUEUE_INDEX]=[False]\n    autodelete_lifeSpans[DELETEQUEUE_INDEX]=[False]\n    passive_lifeSpans   [DELETEQUEUE_INDEX]=[False]\n    exclusive_lifeSpans [DELETEQUEUE_INDEX]=[False]\n    ----\n\n(tamesi34_cs.cs?) GetChannel index = [1]\n    name_queues[index] = [1117]\n    passive_lifeSpans[index] = [False]\n    durable_lifeSpans[index] = [True]\n    exclusive_lifeSpans[index] = [False]\n    autodelete_lifeSpans[index] = [True]\n    nowait は仮に false 固定\n    arguments は仮に null 固定\n[4]   Exit 1                  ./tamesi35a2_cs.exe --enqueue 1117 durable autodelete --dequeue 1116 durable autodelete \u0026gt; ./tamesi35a2_cs.out.log 2\u0026gt; ./tamesi35a2_cs.err.log \u0026lt; /dev/null\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e(tamesi35a2_cs.cs?) GetChannel index = [1]\n    name_queues[index] = [1116]\n    passive_lifeSpans[index] = [False]\n    durable_lifeSpans[index] = [True]\n    exclusive_lifeSpans[index] = [False]\n    autodelete_lifeSpans[index] = [True]\n    nowait は仮に false 固定\n    arguments は仮に null 固定\n\nUnhandled Exception:\nRabbitMQ.Client.Exceptions.OperationInterruptedException: The AMQP operation was interrupted: AMQP close-reason, initiated by Peer, code=406, text=\"PRECONDITION_FAILED - inequivalent arg 'durable' for queue '1116' in vhost '/': recei$\n  at RabbitMQ.Client.Impl.SimpleBlockingRpcContinuation.GetReply () \u0026lt;0x40044590 + 0x00103\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at RabbitMQ.Client.Impl.ModelBase.ModelRpc (RabbitMQ.Client.Impl.MethodBase method, RabbitMQ.Client.Impl.ContentHeaderBase header, System.Byte[] body) \u0026lt;0x40042520 + 0x000f9\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at RabbitMQ.Client.Framing.Impl.v0_8.Model.QueueDeclare (System.String queue, Boolean passive, Boolean durable, Boolean exclusive, Boolean autoDelete, Boolean nowait, IDictionary arguments) \u0026lt;0x400467d0 + 0x00113\u0026gt; in \u0026lt;filename unkno$\n  at Program.GetChannel (Int32 index) \u0026lt;0x400078d0 + 0x00436\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at Program.StartConsume () \u0026lt;0x40007810 + 0x0000f\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at Program.Main (System.String[] args) \u0026lt;0x40004270 + 0x003cb\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n[ERROR] FATAL UNHANDLED EXCEPTION: RabbitMQ.Client.Exceptions.OperationInterruptedException: The AMQP operation was interrupted: AMQP close-reason, initiated by Peer, code=406, text=\"PRECONDITION_FAILED - inequivalent arg 'durable' f$\n  at RabbitMQ.Client.Impl.SimpleBlockingRpcContinuation.GetReply () \u0026lt;0x40044590 + 0x00103\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at RabbitMQ.Client.Impl.ModelBase.ModelRpc (RabbitMQ.Client.Impl.MethodBase method, RabbitMQ.Client.Impl.ContentHeaderBase header, System.Byte[] body) \u0026lt;0x40042520 + 0x000f9\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at RabbitMQ.Client.Framing.Impl.v0_8.Model.QueueDeclare (System.String queue, Boolean passive, Boolean durable, Boolean exclusive, Boolean autoDelete, Boolean nowait, IDictionary arguments) \u0026lt;0x400467d0 + 0x00113\u0026gt; in \u0026lt;filename unkno$\n  at Program.GetChannel (Int32 index) \u0026lt;0x400078d0 + 0x00436\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at Program.StartConsume () \u0026lt;0x40007810 + 0x0000f\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n  at Program.Main (System.String[] args) \u0026lt;0x40004270 + 0x003cb\u0026gt; in \u0026lt;filename unknown\u0026gt;:0\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eうーむ。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eroot@tk2-217-18401:/home/csg10/shogi/csharp_service# ./tamesi34_cs.exe 2\u0026gt; ./tamesi34_cs.err.log\n削除したいキューがあれば名前を、無ければ空文字列を入れろだぜ☆（＾～＾）\nキュー名を入力    : キューを削除します\n空文字列で[Enter] : 次のステップへ進む\nName or empty ? \u0026gt;\nエンキュー先のメッセージ・キューの名前を入れろだぜ☆（＾～＾）\nQueue name? \u0026gt; 1116\nエンキュー先のメッセージ・キューの寿命を、足し算して答えろだぜ☆（＾～＾）\n(1) durable    : RabbitMQが止まってもキューを残す\n(2) autodelete : コンシューマーが１人も接続していなかったら消す\n(4) passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ\n(8) exclusive  : この接続でだけ使える。この接続が切れたら消す\nNumber ? \u0026gt; 3\nデキュー先のメッセージ・キューの名前を入れろだぜ☆（＾～＾）\nQueue name? \u0026gt; 1117\nデキュー先のメッセージ・キューの寿命を、足し算して答えろだぜ☆（＾～＾）\n(1) durable    : RabbitMQが止まってもキューを残す\n(2) autodelete : コンシューマーが１人も接続していなかったら消す\n(4) passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ\n(8) exclusive  : この接続でだけ使える。この接続が切れたら消す\nNumber ? \u0026gt; 3\ntamesi34_cs.cs Dump\n    name_queues         [ENQUEUE_INDEX]    =[1116]\n    lifeSpan_queues     [ENQUEUE_INDEX]    =[Durable, Autodelete]\n    durable_lifeSpans   [ENQUEUE_INDEX]    =[True]\n    autodelete_lifeSpans[ENQUEUE_INDEX]    =[True]\n    passive_lifeSpans   [ENQUEUE_INDEX]    =[False]\n    exclusive_lifeSpans [ENQUEUE_INDEX]    =[False]\n    ----\n    name_queues         [DEQUEUE_INDEX]    =[1117]\n    lifeSpan_queues     [DEQUEUE_INDEX]    =[Durable, Autodelete]\n    durable_lifeSpans   [DEQUEUE_INDEX]    =[True]\n    autodelete_lifeSpans[DEQUEUE_INDEX]    =[True]\n    passive_lifeSpans   [DEQUEUE_INDEX]    =[False]\n    exclusive_lifeSpans [DEQUEUE_INDEX]    =[False]\n    ----\n    name_queues         [DELETEQUEUE_INDEX]=[]\n    lifeSpan_queues     [DELETEQUEUE_INDEX]=[0]\n    durable_lifeSpans   [DELETEQUEUE_INDEX]=[False]\n    autodelete_lifeSpans[DELETEQUEUE_INDEX]=[False]\n    passive_lifeSpans   [DELETEQUEUE_INDEX]=[False]\n    exclusive_lifeSpans [DELETEQUEUE_INDEX]=[False]\n    ----\n\n(tamesi34_cs.cs?) GetChannel index = [1]\n    name_queues[index] = [1117]\n    passive_lifeSpans[index] = [False]\n    durable_lifeSpans[index] = [True]\n    exclusive_lifeSpans[index] = [False]\n    autodelete_lifeSpans[index] = [True]\n    nowait は仮に false 固定\n    arguments は仮に null 固定\n[3]   Exit 1                  ./tamesi35a2_cs.exe --enqueue 1117 durable autodelete --dequeue 1116 durable autodelete \u0026gt; ./tamesi35a2_cs.out.log 2\u0026gt; ./tamesi35a2_cs.err.log \u0026lt; /dev/null\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれでもダメか。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"ググろう-1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B0%E3%82%B0%E3%82%8D%E3%81%86-1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eググろう\u003c/h1\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ePRECONDITION_FAILED - inequivalent arg 'durable\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"キューを削除しよう\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%AD%E3%83%A5%E3%83%BC%E3%82%92%E5%89%8A%E9%99%A4%E3%81%97%E3%82%88%E3%81%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eキューを削除しよう\u003c/h1\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eroot@tk2-217-18401:/home/csg10/shogi/csharp_service# rabbitmqctl list_queues\nListing queues ...\n1117    0\n1118    0\nmyqueue 0\n1115    0\n1114    0\n1119    0\nroot@tk2-217-18401:/home/csg10/shogi/csharp_service# ./tamesi34_cs.exe 2\u0026gt; ./tamesi34_cs.err.log\n削除したいキューがあれば名前を、無ければ空文字列を入れろだぜ☆（＾～＾）\nキュー名を入力    : キューを削除します\n空文字列で[Enter] : 次のステップへ進む\nName or empty ? \u0026gt; myqueue\n削除するメッセージ・キューの寿命を、足し算して答えろだぜ☆（＾～＾）\n(1) durable    : RabbitMQが止まってもキューを残す\n(2) autodelete : コンシューマーが１人も接続していなかったら消す\n(4) passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ\n(8) exclusive  : この接続でだけ使える。この接続が切れたら消す\nNumber ? \u0026gt; 1\ntamesi34_cs.cs Dump\n    name_queues         [ENQUEUE_INDEX]    =[]\n    lifeSpan_queues     [ENQUEUE_INDEX]    =[0]\n    durable_lifeSpans   [ENQUEUE_INDEX]    =[False]\n    autodelete_lifeSpans[ENQUEUE_INDEX]    =[False]\n    passive_lifeSpans   [ENQUEUE_INDEX]    =[False]\n    exclusive_lifeSpans [ENQUEUE_INDEX]    =[False]\n    ----\n    name_queues         [DEQUEUE_INDEX]    =[]\n    lifeSpan_queues     [DEQUEUE_INDEX]    =[0]\n    durable_lifeSpans   [DEQUEUE_INDEX]    =[False]\n    autodelete_lifeSpans[DEQUEUE_INDEX]    =[False]\n    passive_lifeSpans   [DEQUEUE_INDEX]    =[False]\n    exclusive_lifeSpans [DEQUEUE_INDEX]    =[False]\n    ----\n    name_queues         [DELETEQUEUE_INDEX]=[myqueue]\n    lifeSpan_queues     [DELETEQUEUE_INDEX]=[Durable]\n    durable_lifeSpans   [DELETEQUEUE_INDEX]=[True]\n    autodelete_lifeSpans[DELETEQUEUE_INDEX]=[False]\n    passive_lifeSpans   [DELETEQUEUE_INDEX]=[False]\n    exclusive_lifeSpans [DELETEQUEUE_INDEX]=[False]\n    ----\n\n(tamesi34_cs.cs?) GetChannel index = [2]\n    name_queues[index] = [myqueue]\n    passive_lifeSpans[index] = [False]\n    durable_lifeSpans[index] = [True]\n    exclusive_lifeSpans[index] = [False]\n    autodelete_lifeSpans[index] = [False]\n    nowait は仮に false 固定\n    arguments は仮に null 固定\n[myqueue]キューを削除したはずだぜ☆（＾～＾） result=[4294967295]\n削除したいキューがあれば名前を、無ければ空文字列を入れろだぜ☆（＾～＾）\nキュー名を入力    : キューを削除します\n空文字列で[Enter] : 次のステップへ進む\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e# rabbitmqctl list_queues\nListing queues ...\n1117    0\n1118    0\n1115    0\n1114    0\n1119    0\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e# ./tamesi34_cs.exe 2\u0026gt; ./tamesi34_cs.err.log\n削除したいキューがあれば名前を、無ければ空文字列を入れろだぜ☆（＾～＾）\nキュー名を入力    : キューを削除します\n空文字列で[Enter] : 次のステップへ進む\nName or empty ? \u0026gt; 1114\n削除するメッセージ・キューの寿命を、足し算して答えろだぜ☆（＾～＾）\n(1) durable    : RabbitMQが止まってもキューを残す\n(2) autodelete : コンシューマーが１人も接続していなかったら消す\n(4) passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ\n(8) exclusive  : この接続でだけ使える。この接続が切れたら消す\nNumber ? \u0026gt; 1\ntamesi34_cs.cs Dump\n    name_queues         [ENQUEUE_INDEX]    =[]\n    lifeSpan_queues     [ENQUEUE_INDEX]    =[0]\n    durable_lifeSpans   [ENQUEUE_INDEX]    =[False]\n    autodelete_lifeSpans[ENQUEUE_INDEX]    =[False]\n    passive_lifeSpans   [ENQUEUE_INDEX]    =[False]\n    exclusive_lifeSpans [ENQUEUE_INDEX]    =[False]\n    ----\n    name_queues         [DEQUEUE_INDEX]    =[]\n    lifeSpan_queues     [DEQUEUE_INDEX]    =[0]\n    durable_lifeSpans   [DEQUEUE_INDEX]    =[False]\n    autodelete_lifeSpans[DEQUEUE_INDEX]    =[False]\n    passive_lifeSpans   [DEQUEUE_INDEX]    =[False]\n    exclusive_lifeSpans [DEQUEUE_INDEX]    =[False]\n    ----\n    name_queues         [DELETEQUEUE_INDEX]=[1114]\n    lifeSpan_queues     [DELETEQUEUE_INDEX]=[Durable]\n    durable_lifeSpans   [DELETEQUEUE_INDEX]=[True]\n    autodelete_lifeSpans[DELETEQUEUE_INDEX]=[False]\n    passive_lifeSpans   [DELETEQUEUE_INDEX]=[False]\n    exclusive_lifeSpans [DELETEQUEUE_INDEX]=[False]\n    ----\n\n(tamesi34_cs.cs?) GetChannel index = [2]\n    name_queues[index] = [1114]\n    passive_lifeSpans[index] = [False]\n    durable_lifeSpans[index] = [True]\n    exclusive_lifeSpans[index] = [False]\n    autodelete_lifeSpans[index] = [False]\n    nowait は仮に false 固定\n    arguments は仮に null 固定\n[1114]キューを削除したはずだぜ☆（＾～＾） result=[4294967295]\n削除したいキューがあれば名前を、無ければ空文字列を入れろだぜ☆（＾～＾）\nキュー名を入力    : キューを削除します\n空文字列で[Enter] : 次のステップへ進む\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e# rabbitmqctl list_queues\nListing queues ...\n1117    0\n1118    0\n1115    0\n1119    0\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e# ./tamesi34_cs.exe 2\u0026gt; ./tamesi34_cs.err.log\n削除したいキューがあれば名前を、無ければ空文字列を入れろだぜ☆（＾～＾）\nキュー名を入力    : キューを削除します\n空文字列で[Enter] : 次のステップへ進む\nName or empty ? \u0026gt; 1115\n削除するメッセージ・キューの寿命を、足し算して答えろだぜ☆（＾～＾）\n(1) durable    : RabbitMQが止まってもキューを残す\n(2) autodelete : コンシューマーが１人も接続していなかったら消す\n(4) passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ\n(8) exclusive  : この接続でだけ使える。この接続が切れたら消す\nNumber ? \u0026gt; 1\ntamesi34_cs.cs Dump\n    name_queues         [ENQUEUE_INDEX]    =[]\n    lifeSpan_queues     [ENQUEUE_INDEX]    =[0]\n    durable_lifeSpans   [ENQUEUE_INDEX]    =[False]\n    autodelete_lifeSpans[ENQUEUE_INDEX]    =[False]\n    passive_lifeSpans   [ENQUEUE_INDEX]    =[False]\n    exclusive_lifeSpans [ENQUEUE_INDEX]    =[False]\n    ----\n    name_queues         [DEQUEUE_INDEX]    =[]\n    lifeSpan_queues     [DEQUEUE_INDEX]    =[0]\n    durable_lifeSpans   [DEQUEUE_INDEX]    =[False]\n    autodelete_lifeSpans[DEQUEUE_INDEX]    =[False]\n    passive_lifeSpans   [DEQUEUE_INDEX]    =[False]\n    exclusive_lifeSpans [DEQUEUE_INDEX]    =[False]\n    ----\n    name_queues         [DELETEQUEUE_INDEX]=[1115]\n    lifeSpan_queues     [DELETEQUEUE_INDEX]=[Durable]\n    durable_lifeSpans   [DELETEQUEUE_INDEX]=[True]\n    autodelete_lifeSpans[DELETEQUEUE_INDEX]=[False]\n    passive_lifeSpans   [DELETEQUEUE_INDEX]=[False]\n    exclusive_lifeSpans [DELETEQUEUE_INDEX]=[False]\n    ----\n\n(tamesi34_cs.cs?) GetChannel index = [2]\n    name_queues[index] = [1115]\n    passive_lifeSpans[index] = [False]\n    durable_lifeSpans[index] = [True]\n    exclusive_lifeSpans[index] = [False]\n    autodelete_lifeSpans[index] = [False]\n    nowait は仮に false 固定\n    arguments は仮に null 固定\n[1115]キューを削除したはずだぜ☆（＾～＾） result=[4294967295]\n削除したいキューがあれば名前を、無ければ空文字列を入れろだぜ☆（＾～＾）\nキュー名を入力    : キューを削除します\n空文字列で[Enter] : 次のステップへ進む\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e# rabbitmqctl list_queues\nListing queues ...\n1117    0\n1118    0\n1119    0\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eなんかキューは durable だけ指定すれば全部消せた。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"キューを全部消してdurableautodelete-で行けた\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%AD%E3%83%A5%E3%83%BC%E3%82%92%E5%85%A8%E9%83%A8%E6%B6%88%E3%81%97%E3%81%A6durableautodelete-%E3%81%A7%E8%A1%8C%E3%81%91%E3%81%9F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eキューを全部消して、durable+autodelete で行けた？\u003c/h1\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e# ./tamesi35a2_cs.exe --enqueue 1113 durable autodelete --dequeue 1112 durable autodelete \u0026gt; ./tamesi35a2_cs.out.log 2\u0026gt; ./tamesi35a2_cs.err.log \u0026lt; /dev/null \u0026amp;\n[3] 2613\nroot@tk2-217-18401:/home/csg10/shogi/csharp_service# ./tamesi34_cs.exe\n削除したいキューがあれば名前を、無ければ空文字列を入れろだぜ☆（＾～＾）\nキュー名を入力    : キューを削除します\n空文字列で[Enter] : 次のステップへ進む\nName or empty ? \u0026gt;\nエンキュー先のメッセージ・キューの名前を入れろだぜ☆（＾～＾）\nQueue name? \u0026gt; 1112\nエンキュー先のメッセージ・キューの寿命を、足し算して答えろだぜ☆（＾～＾）\n(1) durable    : RabbitMQが止まってもキューを残す\n(2) autodelete : コンシューマーが１人も接続していなかったら消す\n(4) passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ\n(8) exclusive  : この接続でだけ使える。この接続が切れたら消す\nNumber ? \u0026gt; 3\nデキュー先のメッセージ・キューの名前を入れろだぜ☆（＾～＾）\nQueue name? \u0026gt; 1113\nデキュー先のメッセージ・キューの寿命を、足し算して答えろだぜ☆（＾～＾）\n(1) durable    : RabbitMQが止まってもキューを残す\n(2) autodelete : コンシューマーが１人も接続していなかったら消す\n(4) passive    : キューが存在するかどうかチェックするだけ。中身見ない時これ\n(8) exclusive  : この接続でだけ使える。この接続が切れたら消す\nNumber ? \u0026gt; 3\ntamesi34_cs.cs Dump\n    name_queues         [ENQUEUE_INDEX]    =[1112]\n    lifeSpan_queues     [ENQUEUE_INDEX]    =[Durable, Autodelete]\n    durable_lifeSpans   [ENQUEUE_INDEX]    =[True]\n    autodelete_lifeSpans[ENQUEUE_INDEX]    =[True]\n    passive_lifeSpans   [ENQUEUE_INDEX]    =[False]\n    exclusive_lifeSpans [ENQUEUE_INDEX]    =[False]\n    ----\n    name_queues         [DEQUEUE_INDEX]    =[1113]\n    lifeSpan_queues     [DEQUEUE_INDEX]    =[Durable, Autodelete]\n    durable_lifeSpans   [DEQUEUE_INDEX]    =[True]\n    autodelete_lifeSpans[DEQUEUE_INDEX]    =[True]\n    passive_lifeSpans   [DEQUEUE_INDEX]    =[False]\n    exclusive_lifeSpans [DEQUEUE_INDEX]    =[False]\n    ----\n    name_queues         [DELETEQUEUE_INDEX]=[]\n    lifeSpan_queues     [DELETEQUEUE_INDEX]=[0]\n    durable_lifeSpans   [DELETEQUEUE_INDEX]=[False]\n    autodelete_lifeSpans[DELETEQUEUE_INDEX]=[False]\n    passive_lifeSpans   [DELETEQUEUE_INDEX]=[False]\n    exclusive_lifeSpans [DELETEQUEUE_INDEX]=[False]\n    ----\n\n(tamesi34_cs.cs?) GetChannel index = [1]\n    name_queues[index] = [1113]\n    passive_lifeSpans[index] = [False]\n    durable_lifeSpans[index] = [True]\n    exclusive_lifeSpans[index] = [False]\n    autodelete_lifeSpans[index] = [True]\n    nowait は仮に false 固定\n    arguments は仮に null 固定\n終了するときは[Ctrl]+[C]キーを押せだぜ☆（＾～＾）\nエンキューするときはメッセージを打ち込んで[Enter]キーを押せだぜ☆(＾◇＾)\nEnqueue? \u0026gt; usi\ntamesi34_cs.cs Dump\n    name_queues         [ENQUEUE_INDEX]    =[1112]\n    lifeSpan_queues     [ENQUEUE_INDEX]    =[Durable, Autodelete]\n    durable_lifeSpans   [ENQUEUE_INDEX]    =[True]\n    autodelete_lifeSpans[ENQUEUE_INDEX]    =[True]\n    passive_lifeSpans   [ENQUEUE_INDEX]    =[False]\n    exclusive_lifeSpans [ENQUEUE_INDEX]    =[False]\n    ----\n    name_queues         [DEQUEUE_INDEX]    =[1113]\n    lifeSpan_queues     [DEQUEUE_INDEX]    =[Durable, Autodelete]\n    durable_lifeSpans   [DEQUEUE_INDEX]    =[True]\n    autodelete_lifeSpans[DEQUEUE_INDEX]    =[True]\n    passive_lifeSpans   [DEQUEUE_INDEX]    =[False]\n    exclusive_lifeSpans [DEQUEUE_INDEX]    =[False]\n    ----\n    name_queues         [DELETEQUEUE_INDEX]=[]\n    lifeSpan_queues     [DELETEQUEUE_INDEX]=[0]\n    durable_lifeSpans   [DELETEQUEUE_INDEX]=[False]\n    autodelete_lifeSpans[DELETEQUEUE_INDEX]=[False]\n    passive_lifeSpans   [DELETEQUEUE_INDEX]=[False]\n    exclusive_lifeSpans [DELETEQUEUE_INDEX]=[False]\n    ----\n\n(tamesi34_cs.cs?) GetChannel index = [0]\n    name_queues[index] = [1112]\n    passive_lifeSpans[index] = [False]\n    durable_lifeSpans[index] = [True]\n    exclusive_lifeSpans[index] = [False]\n    autodelete_lifeSpans[index] = [True]\n    nowait は仮に false 固定\n    arguments は仮に null 固定\n Enqueue(^q^) usi\nEnqueue? \u0026gt; \u0026lt;---- [interrupt!] Dequeue(^q^) usidaze\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eusidaze が返ってきている。Ｃ＃では成功か？\u003c/p\u003e\n\n\u003cp\u003eじゃあ\u003c/p\u003e\n\n\u003cp\u003e-Windows10 ではデフォルトで durable\u003cbr\u003e\n-Ubuntu ではデフォルトで durable+autodelete\u003c/p\u003e\n\n\u003cp\u003eか。\u003cstrong\u003eそんなん分からんなあ。\u003c/strong\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"cでもテストしたいが\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#c%E3%81%A7%E3%82%82%E3%83%86%E3%82%B9%E3%83%88%E3%81%97%E3%81%9F%E3%81%84%E3%81%8C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eC++でもテストしたいが\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eroot@tk2-217-18401:/home/★user/shogi/csharp_service# jobs\n[1]-  Stopped                 nano tamesi34_cs.err.log\n[2]+  Stopped                 nano tamesi35a2_cs.out.log\n[3]   Running                 ./tamesi35a2_cs.exe --enqueue 1113 durable autodelete --dequeue 1112 durable autodelete \u0026gt; ./tamesi35a2_cs.out.log 2\u0026gt; ./tamesi35a2_cs.err.log \u0026lt; /dev/null \u0026amp;\nroot@tk2-217-18401:/home/★user/shogi/csharp_service# kill %3\nroot@tk2-217-18401:/home/★user/shogi/csharp_service# jobs\n[1]-  Stopped                 nano tamesi34_cs.err.log\n[2]+  Stopped                 nano tamesi35a2_cs.out.log\n[3]   Terminated              ./tamesi35a2_cs.exe --enqueue 1113 durable autodelete --dequeue 1112 durable autodelete \u0026gt; ./tamesi35a2_cs.out.log 2\u0026gt; ./tamesi35a2_cs.err.log \u0026lt; /dev/null\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eジョブを止めておく。\u003c/p\u003e\n\n\u003cp\u003etamesi35a2.cpp をバックグラウンドで動かそう。標準入出力は捨てることが重要。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e./tamesi35a2_cs.exe --enqueue 1113 durable autodelete --dequeue 1112 durable autodelete \u0026gt; ./tamesi35a2_cs.out.log 2\u0026gt; ./tamesi35a2_cs.err.log \u0026lt; /dev/null \u0026amp;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eroot@tk2-217-18401:~# ./tamesi35a2_cs.exe --enqueue 1113 durable autodelete --dequeue 1112 durable autodelete \u0026gt; ./tamesi35a2_cs.out.log 2\u0026gt; ./tamesi35a2_cs.err.log \u0026lt; /dev/null \u0026amp;\n[1] 12555\nroot@tk2-217-18401:~# jobs\n[1]+  Exit 127                ./tamesi35a2_cs.exe --enqueue 1113 durable autodelete --dequeue 1112 durable autodelete \u0026gt; ./tamesi35a2_cs.out.log 2\u0026gt; ./tamesi35a2_cs.err.log \u0026lt; /dev/null\nroot@tk2-217-18401:~# jobs\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003cstrong\u003eあれっ？\u003c/strong\u003e これ、_cs だぜ。そして　カレント・ディレクトリが違う。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eroot@tk2-217-18401:~# cd /home/★user/shogi/cpp_service\nroot@tk2-217-18401:/home/★user/shogi/cpp_service# ls\nconsume.cpp               tamesi29a11_enqueueTcp.cpp\nconsume.exe               tamesi29a11_enqueueTcp.exe\nloop28_cpp.cpp            tamesi29a7_main.cpp\nloop28_cpp.exe            tamesi29a7_main.exe\npublish.cpp               tamesi29a8_example_consume.cpp\npublish.exe               tamesi29a9_main.cpp\ntamesi28.d                tamesi29a9_main.exe\ntamesi29a10_main.cpp      tamesi33a2_cpp.cpp\ntamesi29a10_main.exe      tamesi33a2_cpp.err.log\ntamesi29a11_enqueueA.cpp  tamesi33a2_cpp.exe\ntamesi29a11_enqueueA.exe  tamesi35a2_cpp.cpp\ntamesi29a11_enqueueC.cpp  tamesi35a2_cpp.err.log\ntamesi29a11_enqueueC.exe  tamesi35a2_cpp.exe\ntamesi29a11_enqueue.exe\nroot@tk2-217-18401:/home/★user/shogi/cpp_service# ./tamesi35a2_cpp.exe --msgqueue 1117 durable 1116 durable 2\u0026gt; ./tamesi35a2_cpp.err.log \u0026amp;\n[1] 12608\nroot@tk2-217-18401:/home/★user/shogi/cpp_service# Welcome! AMQP::durable=[1] AMQP::autodelete=[2] AMQP::passive=[8] AMQP::exclusive=[512]\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eプロンプトが返ってきてしまった。困るぜ。[Entery]キーを押してみる。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e# jobs\n[1]+  Running                 ./tamesi35a2_cpp.exe --msgqueue 1117 durable 1116 durable 2\u0026gt; ./tamesi35a2_cpp.err.log \u0026amp;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e動いているようだ。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"記事が長くなってきたので次へ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A8%98%E4%BA%8B%E3%81%8C%E9%95%B7%E3%81%8F%E3%81%AA%E3%81%A3%E3%81%A6%E3%81%8D%E3%81%9F%E3%81%AE%E3%81%A7%E6%AC%A1%E3%81%B8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e記事が長くなってきたので次へ。\u003c/h1\u003e\n","createdAt":"2017-03-13T21:52:56Z","elapsedYearsFromLastModifiedAt":4,"encryptedId":"y2iKEXLRyJz3O7hBGp+V/64AK5ZaaR0C--2y/uFvJJeoZbVw4O--D5wFvD73N6pXe080oZIGjA==","isBanned":false,"isDeprecated":true,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2017-03-14T22:24:24Z","likesCount":0,"linkUrl":"https://qiita.com/muzudho1/items/3d292bafc4a8fa54eb43","organization":null,"originalId":476194,"stockedCount":1,"title":"コンピュータ将棋ソフトとの対局サーバーを立てよう＜その１１＞","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%90%E3%82%B0%E3%81%AE%E5%8E%9F%E5%9B%A0%E3%82%92%E8%AA%BF%E3%81%B9%E3%82%88%E3%81%86\"\u003eバグの原因を調べよう\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%90%8D%E5%89%8D%E3%81%AF-tamesi35a2_cppcpp-%E3%81%AB%E3%81%99%E3%82%8B\"\u003e名前は tamesi35a2_cpp.cpp にする\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#c-%E3%81%A7%E3%81%AF%E3%82%B7%E3%83%B3%E3%82%B0%E3%83%AB%E3%83%88%E3%83%B3%E3%81%A7%E3%82%84%E3%81%A3%E3%81%A6%E3%81%9F\"\u003eC# ではシングルトンでやってた\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%95%AA%E5%8F%B7%E3%82%92%E5%90%88%E3%82%8F%E3%81%9B%E3%81%A6-tamesi35a2_cscs-%E3%81%AB%E5%A4%89%E3%81%88%E3%81%A6%E3%81%BF%E3%82%8B\"\u003e番号を合わせて tamesi35a2_cs.cs に変えてみる\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#tamesi35a2_cscs-%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%83%A9%E3%82%A4%E3%83%B3%E5%BC%95%E6%95%B0%E6%8C%87%E5%AE%9A%E7%89%88\"\u003etamesi35a2_cs.cs コマンドライン引数指定版\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#visual-studio-2015-%E3%81%A7-tamesi34_cscs-%E3%82%92%E5%8B%95%E3%81%8B%E3%81%97%E3%81%A6%E3%81%BF%E3%81%9F\"\u003eVisual Studio 2015 で tamesi34_cs.cs を動かしてみた\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%82%E3%82%8B%E3%81%84%E3%81%AF%E3%82%A8%E3%83%B3%E3%82%AD%E3%83%A5%E3%83%BC%E3%82%92%E5%88%A5%E3%82%B9%E3%83%AC%E3%83%83%E3%83%89%E3%81%AB%E3%81%99%E3%82%8B%E3%81%AE%E3%81%8C%E3%81%BE%E3%81%A0%E6%AE%8B%E3%81%A3%E3%81%A6%E3%81%84%E3%82%8B\"\u003eあるいは　エンキューを別スレッドにするのが　まだ残っている\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%9D%E3%81%AE%E5%89%8D%E3%81%AB-visual-studio-2015-%E3%81%A7%E3%82%84%E3%81%A3%E3%81%9F%E3%82%89\"\u003eその前に Visual Studio 2015 でやったら\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#ubuntu%E3%81%AE%E3%81%A8%E3%81%8D%E3%81%A0%E3%81%91%E5%BC%95%E6%95%B0%E3%82%92false-%E3%81%AB%E3%81%99%E3%82%8B%E3%81%A8%E3%81%A9%E3%81%86%E3%81%8B\"\u003eUBUNTUのときだけ引数をfalse にするとどうか？\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B0%E3%82%B0%E3%82%8D%E3%81%86\"\u003eググろう\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E8%A4%87%E6%95%B0%E6%8C%87%E5%AE%9A%E3%81%97%E3%81%9F%E3%81%84\"\u003e複数指定したい\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B0%E3%82%B0%E3%82%8D%E3%81%86-1\"\u003eググろう\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%AD%E3%83%A5%E3%83%BC%E3%82%92%E5%89%8A%E9%99%A4%E3%81%97%E3%82%88%E3%81%86\"\u003eキューを削除しよう\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%AD%E3%83%A5%E3%83%BC%E3%82%92%E5%85%A8%E9%83%A8%E6%B6%88%E3%81%97%E3%81%A6durableautodelete-%E3%81%A7%E8%A1%8C%E3%81%91%E3%81%9F\"\u003eキューを全部消して、durable+autodelete で行けた？\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#c%E3%81%A7%E3%82%82%E3%83%86%E3%82%B9%E3%83%88%E3%81%97%E3%81%9F%E3%81%84%E3%81%8C\"\u003eC++でもテストしたいが\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E8%A8%98%E4%BA%8B%E3%81%8C%E9%95%B7%E3%81%8F%E3%81%AA%E3%81%A3%E3%81%A6%E3%81%8D%E3%81%9F%E3%81%AE%E3%81%A7%E6%AC%A1%E3%81%B8\"\u003e記事が長くなってきたので次へ。\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":1315,"uuid":"3d292bafc4a8fa54eb43","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"xgH/H9xTOrNp8zMVAt7XzGQpi31E--Y9FtLr+N2l/IZRKW--uFZrje+7Zwhhy2m0gvx3dA==","originalId":159417,"description":"（＾～＾）","facebookUrl":null,"githubUrl":"https://github.com/muzudho","isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"むずでょ","profileImageUrl":"https://pbs.twimg.com/profile_images/378800000224959199/109762cc48c6e63fad3fbe01065cf862_normal.png","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fpbs.twimg.com%2Fprofile_images%2F378800000224959199%2F109762cc48c6e63fad3fbe01065cf862_normal.png?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=ac753dd2bb5cdc1f7b4a59405a8d431d","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fpbs.twimg.com%2Fprofile_images%2F378800000224959199%2F109762cc48c6e63fad3fbe01065cf862_normal.png?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=3ed9df1f72e7b42b01bc26234820b49f","urlName":"muzudho1","websiteUrl":"http://kifuwarabe.warabenture.com/","twitterUrl":"https://twitter.com/muzudho1","twitterUrlName":"muzudho1","revealedOrganizations":{"edges":[]}},"tags":[{"name":"C++","urlName":"cpp"},{"name":"C#","urlName":"csharp"},{"name":"コンピュータ将棋","urlName":"%e3%82%b3%e3%83%b3%e3%83%94%e3%83%a5%e3%83%bc%e3%82%bf%e5%b0%86%e6%a3%8b"},{"name":"libev","urlName":"libev"},{"name":"AMQP-CPP","urlName":"amqp-cpp"}],"followingLikers":{"edges":[]},"comments":{"totalCount":0}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

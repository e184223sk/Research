通常は、ボタンのクリックや、テキストボックスを参照するときは、ことがほとんどですが、時にはマスタデータや設定ファイルの内容に応じて、動的にコントロールを柔軟に設置したいこともあるし、例えばユーザーとなるお客さんに応じて、ある業界共通のプログラムを使う際に、必要な機能とそうでない機能が出てくるとは思います。けどプログラムをカスタマイズするということは、カスタマイズに必要な工数が発生するということで、大企業に限ればカスタマイズは最小限でしょうけど、りらぽ♥︎は全国的大企業だけにC#の恩恵を受ける前提でいる思想は全くなく、地元大企業や中小企業・個人商店にもC#の恩恵を受けるためにも、数多くのお客さん向けにC#プログラムを提供できることを前提としてQiitaを使っているわけなので、そうなれば当然、相手する顧客数は圧倒的に増えます。そうなってくると、ものすごい数に対するお客さんに毎回プログラムをカスタマイズとなると、日が暮れてしまいます。。。(⑉•̆ ·̭ •⑉)それだからこそ、マスタファイルや設定ファイルなどで、C#のソースコードをいじることなく動的にコントロールを追加して、それを使えないか？？というのを、まずはどのように実装したらいいのかのレベルで調べてみたんです(˶ ･ᴗ･ )੭⚐⚑今回はデータベースや設定ファイルはまだ使いませんが、実装すべき基盤をどう記述すればいいのかだけは載せておきますという方法で、フォームデザインを使わずに、ソースコードを記述して動的にコントロールを追加することができます。ただ単に追加するという意味ではフォームデザイン使った方が手っ取り早いですが。。。動的にコントロールを追加しようと思うなら、単にコントロールを追加しただけでは当然使い物はならないので、クリックイベントといった動作も動的に追加する必要があるものの…だからといってソースコードではまた手動でメソッドを指定してあげなければならないので、いっぺんに試そうとしても混乱してくるので、最初はコントロールをどのようにしてソースから動的追加していくかを試す
とりあえずフォームにボタン「formCallButton」というボタンだけを設置して、追加したボタンにクリックイベントを設定し、そのクリックイベント処理の中に、フォーム左に動的にボタンを追加する、ということをやってみました。まずはフォームの中に、動的に作るボタンを配列でメンバ変数として用意します。続いて、動的に作るボタンは配列なので、配列そのものと各要素のボタンのインスタンスを作る必要があります。ここまではオブジェクト指向で共通です。次に、そのボタンのインスタンスに、Nameや配置などのプロパティを設定していきます。そして、このコードでフォームへ表示されます(˶ ･ᴗ･ )੭ちゃんと表示されました！！(*˘꒳˘*)ボタンの動的な作成が終わったので、次はそのボタンにイベントを付与してみます！
お次は、フォーム右下に「listBox1」という、動的に追加したボタンをクリックした結果を追記するためのリストボックスを追加します。ボタン画像は少し気が変わって変えました( ˶˙ᵕ˙˶ )ここでは、ボタンButtonの継承のKazumi75Buttonというボタンクラスを作成しています。なぜなら、ボタンクリック時に、ボタンごとが用意する文字列を、ボタンクリックイベントで利用するからです。さらに、ボタン本体は結果を表示させるためのlistBox1を参照できるようにするため、その参照すべきリストボックスを受け持つ必要があるからです。かなり言い方が難しいですが…(੭ु˙꒳˙)੭ु Form1.csのほうにクリックイベントを付けたほうがよかったかな？？判断がちょっと難しいところ。。。これはまずWindowsフォームのボタンを継承したKazumi75Buttonの配列を5個定義。今は5個ボタンを動的に作成して、それらにクリックイベントを付与していきますここでインスタンスを作成し、それ以降はButtonのようにプロパティ設定(listBox1への参照も忘れずに)とフォームへの配置を行っています。そこで、今回のポイントですが！！まずインスタンスを作成する前の配列代入の処理これは「this.manyButtons[i].buttonMsg = msgs[i]」でボタンごとの文字列をセットするときに使う文字列で、現在はプログラムのソースの中ですが、そこの箇所は今後データベースや設定ファイルで置き換える想定でいます。これらの文字列は、ボタンクリックのイベントの中で使います。次に、動的に定義したボタンに、クリックイベントを追加して、クリックすると結果を表示するlistBox1へボタンごとの文字列を追加するという箇所。多少ややこしいやりとりになってきましたが。。。(*´꒳`*;)申し訳ないです実行結果は、ボタンごとに受け持つ文字列がちゃんと右下のフォームに追加されている(˶ ･ᴗ･ )੭⚐今回はプログラム上ですが、今度は要素数を5から8に増やして、数を増やしても動的にボタンが増えて、イベントも反応してくれるかチェック「城ヶ島」「七里ガ浜」「馬堀」が追加した分なので、これもちゃんと表示してくれましたボタンは一通り動的追加できたので、テキストボックスを動的に追加して、それらを動的に参照する方法を検証してみます♡



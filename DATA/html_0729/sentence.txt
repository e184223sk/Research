以前KudanARライブラリを使用したKudanARアプリをリリースしました。
Xamarin.FormsでKudan ARを試してみるそのアプリのテスト環境として使用していたAndroid8.0では発生しなかったが、Android9.0だと発生するエラーがありました。
少し調査したので軽くまとめたいと思います。Contextの実体にはApplication Context、Activity Contextがあります。
実体を把握した上で使用しよう。まずは、下記が確認できたエラーメッセージの内容です。どうやら下記のStartActivity実行時にエラーが発生していることがわかりました。Contextと一言に言っても、実体が異なる場合があることを把握しないまま使用したことが原因です。KudanARライブラリを使用すると、エミュレータで動作確認ができなくなる仕様があります。
また、私が持っている一番新しいAndroidバージョンは8.0です。
よって、他のAndroidバージョンでの挙動を確認できなかったため、リリース後に気づいた次第です。
言い訳終了。Xamarinのテンプレートソリューションから、空のActivityを呼び出すだけのアプリを作成し、動作を確認しました。
対処方法にはいくつかあるようです。下記の記事が参考になりました。
Androidの勉強：Contextについてフラグ設定処理を追加して行数を増やすのは避けたかったので、対処方法の2番目に挙げた方法で実装しました。Contextの実体にはApplication Context、Activity Contextがあるので、実体を把握した上で使用しよう。
Contextの取得には、Plugin.CurrentActivityを使用するのが安定。



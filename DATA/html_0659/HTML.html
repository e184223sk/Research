<!DOCTYPE html><html><head><meta charset="utf-8" /><title>サイゼリヤの間違い探しをOpenCVで解いてみた - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/uechan16/items/3e382245444c0a6a960c" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="BztKXyHAyO0p9vYaeJ/P+oViMkSZww2yQ6J+sKA4t9cTsHFZx8U1pJiqy7z4dS5pZZYg8xKiOVFFDBWS6TsR9Q==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta property="og:type" content="article"><meta property="og:title" content="サイゼリヤの間違い探しをOpenCVで解いてみた - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND00NEsxNDRLazQ0Szg0NE9xNDRPazQ0R3U2WmFUNllHVjQ0R0U1bzZpNDRHWDQ0S1NUM0JsYmtOVzQ0R242S2VqNDRHRTQ0R200NEdfNDRHZiZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTU0JnR4dC1jbGlwPWVsbGlwc2lzJnR4dC1hbGlnbj1jZW50ZXIlMkNtaWRkbGUmcz1kNWY0M2MwMGQ3NjZjNjJmYzJhMTAyM2M4ZTBiZjk5Ng&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RSFZsWTJoaGJqRTImdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT00NSZ0eHQtYWxpZ249cmlnaHQlMkNib3R0b20mcz1iODdkMDRjYjlhYzM5MmJjOWM0NTNlN2I4NGY2NzlkZA&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=a4d955ce9347a2213aec657bd35c4ac9"><meta property="og:description" content="初投稿になります
C#信者のQAエンジニアです
以後お見知りおきを…

さてさて学生の味方ともいえるサイゼリヤ
自分も学生の頃は部活の打ち上げやテスト勉強にてドリンクバーとドリアで何時間も粘ったものです

そんな時一度は見たことのある..."><meta content="https://qiita.com/uechan16/items/3e382245444c0a6a960c" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#,画像処理,OpenCV,サイゼリヤ" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-f5373945-24f3-4124-99fd-a526e7373f54"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Fuechan16%2Fitems%2F3e382245444c0a6a960c">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Fuechan16%2Fitems%2F3e382245444c0a6a960c">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-f5373945-24f3-4124-99fd-a526e7373f54">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2020-10-05T00:28:23.000+09:00","dateModified":"2020-10-05T00:29:12.000+09:00","headline":"サイゼリヤの間違い探しをOpenCVで解いてみた","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND00NEsxNDRLazQ0Szg0NE9xNDRPazQ0R3U2WmFUNllHVjQ0R0U1bzZpNDRHWDQ0S1NUM0JsYmtOVzQ0R242S2VqNDRHRTQ0R200NEdfNDRHZiZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTU0JnR4dC1jbGlwPWVsbGlwc2lzJnR4dC1hbGlnbj1jZW50ZXIlMkNtaWRkbGUmcz1kNWY0M2MwMGQ3NjZjNjJmYzJhMTAyM2M4ZTBiZjk5Ng\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RSFZsWTJoaGJqRTImdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT00NSZ0eHQtYWxpZ249cmlnaHQlMkNib3R0b20mcz1iODdkMDRjYjlhYzM5MmJjOWM0NTNlN2I4NGY2NzlkZA\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=a4d955ce9347a2213aec657bd35c4ac9","mainEntityOfPage":"https://qiita.com/uechan16/items/3e382245444c0a6a960c","author":{"@type":"Person","address":"","email":null,"identifier":"uechan16","name":"uechan16","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fs3-ap-northeast-1.amazonaws.com%2Fqiita-image-store%2F0%2F705249%2Ff906ca41475a96c685fe86f4aadd5b53edf19586%2Fx_large.png%3F1601817662?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=edb8dd6014926c0ff44789253b78e6c5","url":"https://qiita.com/uechan16","description":"本職はQAエンジニアですがC#とかWebシステムとかもいじったりしてます","memberOf":[]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://increments.connpass.com/event/211948/">Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催</a><a target="_blank" id="header_text_message_2" href="https://increments.connpass.com/event/211948/">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"uechan16","type":"items","id":"3e382245444c0a6a960c"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"uechan16","type":"items","id":"3e382245444c0a6a960c"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_1","message":"Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"uechan16","type":"items","id":"3e382245444c0a6a960c"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_2","message":"Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/uechan16/items/3e382245444c0a6a960c","location":"/uechan16/items/3e382245444c0a6a960c","scheme":"https","host":"qiita.com","port":null,"pathname":"/uechan16/items/3e382245444c0a6a960c","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"TYARO4pFFZKoI+xhJw0R9gfmP8sHmxrUDgYwGoba2tJZCyo9bEDo2xl/0cen5/Bl5xItfIz6LjcIqFs4z9l88A==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-4c25a573-2b9b-4686-95ec-b529a28e11c7"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/uechan16/items/3e382245444c0a6a960c/likers" class="css-1iupg5d">13</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">6</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/3e382245444c0a6a960c/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/uechan16/items/3e382245444c0a6a960c/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/uechan16/items/3e382245444c0a6a960c/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/uechan16/items/3e382245444c0a6a960c/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/uechan16/items/3e382245444c0a6a960c.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/uechan16"><img class="css-100alwu eyfquo10" src="https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/705249/f906ca41475a96c685fe86f4aadd5b53edf19586/x_large.png?1601817662" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/uechan16" class="css-10ougpm">@<!-- -->uechan16</a><div class="css-1ay9vb9"><span><meta content="2020-10-04T15:28:23Z"/><time dateTime="2020-10-04T15:29:12Z" class="css-m19uds">updated at 2020-10-04</time></span></div></div></div></div></div><h1 class="css-cgzq40">サイゼリヤの間違い探しをOpenCVで解いてみた</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/%e7%94%bb%e5%83%8f%e5%87%a6%e7%90%86" class="css-4czcte">画像処理</a><a href="/tags/opencv" class="css-4czcte">OpenCV</a><a href="/tags/%e3%82%b5%e3%82%a4%e3%82%bc%e3%83%aa%e3%83%a4" class="css-4czcte">サイゼリヤ</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div><p>初投稿になります<br>
C#信者のQAエンジニアです<br>
以後お見知りおきを…</p>

<p>さてさて学生の味方ともいえるサイゼリヤ<br>
自分も学生の頃は部活の打ち上げやテスト勉強にてドリンクバーとドリアで何時間も粘ったものです</p>

<p>そんな時一度は見たことのある間違い探し</p>

<p>今回はこれを自動で解くアプリをC#で作成してみようと思います</p>

<h1>
<span id="実現したいこと" class="fragment"></span><a href="#%E5%AE%9F%E7%8F%BE%E3%81%97%E3%81%9F%E3%81%84%E3%81%93%E3%81%A8"><i class="fa fa-link"></i></a>実現したいこと</h1>

<p>C#とOpenCVSharpを使用し<br>
サイゼリアの間違い探しを右の画像と左の画像として撮影<br>
その差分を画像としてわかりやすく出力する</p>

<p>プログラムの流れとしては<br>
・画像の変換(撮影することを考慮して左右の画像のサイズを合わせる)<br>
・画像の差分抽出(R,G,Bごとに差分を出す)<br>
・差分と元画像を合成して表示</p>

<h1>
<span id="今回使う画像" class="fragment"></span><a href="#%E4%BB%8A%E5%9B%9E%E4%BD%BF%E3%81%86%E7%94%BB%E5%83%8F"><i class="fa fa-link"></i></a>今回使う画像</h1>

<p>テスト用にサイゼリヤ公式サイトの画像を変形させたものを用意<br>
<a href="https://camo.qiitausercontent.com/7fbc64ad8e981957e68f698d3d9d30afe77d9e45/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3730353234392f39623838636535612d633939352d643961652d656666652d3461383136656636383861662e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2F9b88ce5a-c995-d9ae-effe-4a816ef688af.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=2b379daa9989e8ba5b4e8212434a5f76" width="40%" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/705249/9b88ce5a-c995-d9ae-effe-4a816ef688af.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2F9b88ce5a-c995-d9ae-effe-4a816ef688af.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=7182bf0673b44cea116bbd01b0fc4d73 1x" loading="lazy"></a><a href="https://camo.qiitausercontent.com/9dd6f6e3703f316eebfb6c27ee1f0a354f9bc39c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3730353234392f63383435643530372d376333312d376531302d313132622d6139373537653339336164372e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2Fc845d507-7c31-7e10-112b-a9757e393ad7.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=849e0a9bdb5da5927d5429cbb11d66af" width="40%" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/705249/c845d507-7c31-7e10-112b-a9757e393ad7.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2Fc845d507-7c31-7e10-112b-a9757e393ad7.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=fd79bc67504818365b5c4eae6e736bd4 1x" loading="lazy"></a></p>

<h1>
<span id="実行結果" class="fragment"></span><a href="#%E5%AE%9F%E8%A1%8C%E7%B5%90%E6%9E%9C"><i class="fa fa-link"></i></a>実行結果</h1>

<p>アプリ画面<br>
<a href="https://camo.qiitausercontent.com/33cd814e7ac1e8cd6f8ae1a705061bc556f0a7b0/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3730353234392f62303664313138642d363638312d373463612d393431652d3561373438343532343731362e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2Fb06d118d-6681-74ca-941e-5a7484524716.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=677f9036c0695546d1b5086fc1df22fe" width="100%" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/705249/b06d118d-6681-74ca-941e-5a7484524716.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2Fb06d118d-6681-74ca-941e-5a7484524716.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=a76bb2620a5f1656699e89c59923f7d3 1x" loading="lazy"></a><br>
最終生成画像(result.jpg)<br>
<a href="https://camo.qiitausercontent.com/879fa317231a257467e4ee1833957a7b1042e47a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3730353234392f38313566326439662d383839342d356131652d616238322d6539646334353236636363352e6a706567" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2F815f2d9f-8894-5a1e-ab82-e9dc4526ccc5.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=bbe76fb760f66013a966be2e99471cf7" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/705249/815f2d9f-8894-5a1e-ab82-e9dc4526ccc5.jpeg" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2F815f2d9f-8894-5a1e-ab82-e9dc4526ccc5.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=8daab3196d4c20d5a5d3aab7525c5ae6 1x" loading="lazy"></a><br>
取り除ききれなかったごま塩ノイズが少しありますが多めに見てください…<br>
ちなみに変形していない画像を使うと<br>
<a href="https://camo.qiitausercontent.com/9738f9c5d4cbd3d378d695061bbaa5558061926d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3730353234392f34383336336562652d336232332d643965372d363261342d6666303439373765613039632e6a706567" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2F48363ebe-3b23-d9e7-62a4-ff04977ea09c.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=9a44b2592c12e66793025b7d450790dc" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/705249/48363ebe-3b23-d9e7-62a4-ff04977ea09c.jpeg" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2F48363ebe-3b23-d9e7-62a4-ff04977ea09c.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=664b513f289e6a0d926393ba6299a5a8 1x" loading="lazy"></a><br>
きれいに取れますね<br>
（変換によるビットの抜け？が原因でごま塩になっているものと思われます）</p>

<h1>
<span id="実行環境" class="fragment"></span><a href="#%E5%AE%9F%E8%A1%8C%E7%92%B0%E5%A2%83"><i class="fa fa-link"></i></a>実行環境</h1>

<p>C#<br>
.Net Framework 4.7.2<br>
OpenCvSharp3-AnyCPU Ver4.0.0</p>

<p>Windows 10 Home 64Bit<br>
Intel Core i7 9700<br>
RAM 16GB<br>
GPU NVIDIA GeForce GTX 1660</p>

<h1>
<span id="アルゴリズムの詳細" class="fragment"></span><a href="#%E3%82%A2%E3%83%AB%E3%82%B4%E3%83%AA%E3%82%BA%E3%83%A0%E3%81%AE%E8%A9%B3%E7%B4%B0"><i class="fa fa-link"></i></a>アルゴリズムの詳細</h1>

<p>以下に大まかな流れを紹介していきます<br>
GitHubにソース類をおいてあるので参考にしてみてください<br>
<a href="https://github.com/uechan16/SaizeriyaMachigaisagashi" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/uechan16/SaizeriyaMachigaisagashi</a></p>

<h3>
<span id="画像の変換" class="fragment"></span><a href="#%E7%94%BB%E5%83%8F%E3%81%AE%E5%A4%89%E6%8F%9B"><i class="fa fa-link"></i></a>画像の変換</h3>

<p>画像は机にあるサイゼリアのメニューを撮影することを考えると上からとっても多少のゆがみが発生すると思います<br>
そんなゆがみを射影変換である程度同じ角度、大きさに整えていきます</p>

<p>変換の手法は特徴点マッチングです<br>
画像の特徴を割り出し、その特徴同士を比較する方法です</p>

<div class="code-frame" data-lang="C#">
<div class="code-lang"><span class="bold">Form.cs</span></div>
<div class="highlight"><pre class="with-code"><code>            <span class="n">AKAZE</span> <span class="n">akaze</span> <span class="p">=</span> <span class="n">AKAZE</span><span class="p">.</span><span class="nf">Create</span><span class="p">();</span>
            <span class="n">KeyPoint</span><span class="p">[]</span> <span class="n">keyPointsLeft</span><span class="p">;</span>
            <span class="n">KeyPoint</span><span class="p">[]</span> <span class="n">keyPointsRight</span><span class="p">;</span>

            <span class="n">Mat</span> <span class="n">descriptorLeft</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Mat</span><span class="p">();</span>  
            <span class="n">Mat</span> <span class="n">descriptorRight</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Mat</span><span class="p">();</span>

            <span class="n">DescriptorMatcher</span> <span class="n">matcher</span><span class="p">;</span> <span class="c1">//マッチング方法</span>
            <span class="n">DMatch</span><span class="p">[]</span> <span class="n">matches</span><span class="p">;</span> <span class="c1">//特徴量ベクトル同士のマッチング結果を格納する配列</span>

            <span class="c1">//画像をグレースケールとして読み込む </span>
            <span class="n">Mat</span> <span class="n">Lsrc</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Mat</span><span class="p">(</span><span class="n">sLeftPictureFile</span><span class="p">,</span> <span class="n">ImreadModes</span><span class="p">.</span><span class="n">Color</span><span class="p">);</span>

            <span class="c1">//画像をグレースケールとして読み込む</span>
            <span class="n">Mat</span> <span class="n">Rsrc</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Mat</span><span class="p">(</span><span class="n">sRightPictureFile</span><span class="p">,</span> <span class="n">ImreadModes</span><span class="p">.</span><span class="n">Color</span><span class="p">);</span>

            <span class="c1">//特徴量の検出と特徴量ベクトルの計算</span>
            <span class="n">akaze</span><span class="p">.</span><span class="nf">DetectAndCompute</span><span class="p">(</span><span class="n">Lsrc</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">out</span> <span class="n">keyPointsLeft</span><span class="p">,</span> <span class="n">descriptorLeft</span><span class="p">);</span>
            <span class="n">akaze</span><span class="p">.</span><span class="nf">DetectAndCompute</span><span class="p">(</span><span class="n">Rsrc</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">out</span> <span class="n">keyPointsRight</span><span class="p">,</span> <span class="n">descriptorRight</span><span class="p">);</span>

            <span class="c1">//画像1の特徴点をoutput1に出力</span>
            <span class="n">Cv2</span><span class="p">.</span><span class="nf">DrawKeypoints</span><span class="p">(</span><span class="n">Lsrc</span><span class="p">,</span> <span class="n">keyPointsLeft</span><span class="p">,</span> <span class="n">tokuLeft</span><span class="p">);</span>
            <span class="n">Image</span> <span class="n">imageLeftToku</span> <span class="p">=</span> <span class="n">BitmapConverter</span><span class="p">.</span><span class="nf">ToBitmap</span><span class="p">(</span><span class="n">tokuLeft</span><span class="p">);</span>
            <span class="n">pictureBox3</span><span class="p">.</span><span class="n">SizeMode</span> <span class="p">=</span> <span class="n">PictureBoxSizeMode</span><span class="p">.</span><span class="n">Zoom</span><span class="p">;</span>
            <span class="n">pictureBox3</span><span class="p">.</span><span class="n">Image</span> <span class="p">=</span> <span class="n">imageLeftToku</span><span class="p">;</span>

            <span class="c1">//画像2の特徴点をoutput1に出力</span>
            <span class="n">Cv2</span><span class="p">.</span><span class="nf">DrawKeypoints</span><span class="p">(</span><span class="n">Rsrc</span><span class="p">,</span> <span class="n">keyPointsRight</span><span class="p">,</span> <span class="n">tokuRight</span><span class="p">);</span>
            <span class="n">Image</span> <span class="n">imageRightToku</span> <span class="p">=</span> <span class="n">BitmapConverter</span><span class="p">.</span><span class="nf">ToBitmap</span><span class="p">(</span><span class="n">tokuRight</span><span class="p">);</span>
            <span class="n">pictureBox4</span><span class="p">.</span><span class="n">SizeMode</span> <span class="p">=</span> <span class="n">PictureBoxSizeMode</span><span class="p">.</span><span class="n">Zoom</span><span class="p">;</span>
            <span class="n">pictureBox4</span><span class="p">.</span><span class="n">Image</span> <span class="p">=</span> <span class="n">imageRightToku</span><span class="p">;</span>

</code></pre></div>
</div>

<p>この辺は特徴量マッチングで調べるとよく出てくるコード丸パクリです<br>
こうして出てくる画像がこちら<br>
LeftToku.jpg<br>
<a href="https://camo.qiitausercontent.com/0b96e176e7cc0a6219be3c01f90d92b926ded3fa/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3730353234392f34613135366266632d326464342d373734612d626162372d3865363430323939643137652e6a706567" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2F4a156bfc-2dd4-774a-bab7-8e640299d17e.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=625a8df40c8ba5476e0a71a22cf1304c" width="60%" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/705249/4a156bfc-2dd4-774a-bab7-8e640299d17e.jpeg" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2F4a156bfc-2dd4-774a-bab7-8e640299d17e.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=3fa0a5c2b7b2bfb187f301ee307fcc62 1x" loading="lazy"></a><br>
RightToku.jpg<br>
<a href="https://camo.qiitausercontent.com/4457b38d9290199688df552c2a6cff6812e31180/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3730353234392f30613239343365642d623434652d333139622d623863372d6437306464666434616165612e6a706567" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2F0a2943ed-b44e-319b-b8c7-d70ddfd4aaea.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=6c0c63e41611c18be26e3e3a2179b2cd" width="60%" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/705249/0a2943ed-b44e-319b-b8c7-d70ddfd4aaea.jpeg" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2F0a2943ed-b44e-319b-b8c7-d70ddfd4aaea.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=cbb865298c71f087fedf3eade79c432a 1x" loading="lazy"></a><br>
丸がついているところが画像の特徴を表しています</p>

<p>そしてこの特徴同士をマッチング</p>

<div class="code-frame" data-lang="C#">
<div class="code-lang"><span class="bold">Form.cs</span></div>
<div class="highlight"><pre class="with-code"><code>           <span class="c1">//総当たりでマッチング</span>
            <span class="n">matcher</span> <span class="p">=</span> <span class="n">DescriptorMatcher</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="s">"BruteForce"</span><span class="p">);</span>
            <span class="n">matches</span> <span class="p">=</span> <span class="n">matcher</span><span class="p">.</span><span class="nf">Match</span><span class="p">(</span><span class="n">descriptorLeft</span><span class="p">,</span> <span class="n">descriptorRight</span><span class="p">);</span>
            <span class="n">Cv2</span><span class="p">.</span><span class="nf">DrawMatches</span><span class="p">(</span><span class="n">Lsrc</span><span class="p">,</span> <span class="n">keyPointsLeft</span><span class="p">,</span> <span class="n">Rsrc</span><span class="p">,</span> <span class="n">keyPointsRight</span><span class="p">,</span> <span class="n">matches</span><span class="p">,</span> <span class="n">output</span><span class="p">);</span>
</code></pre></div>
</div>

<p>output.jpg<br>
<a href="https://camo.qiitausercontent.com/4bb5b93ed7d83db7d19e197d9a459388c2290f54/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3730353234392f64633462643461342d306363652d383930352d396165362d3330613331323062363332622e6a706567" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2Fdc4bd4a4-0cce-8905-9ae6-30a3120b632b.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=e4d37f7162396604264d82988d7d1aed" width="60%" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/705249/dc4bd4a4-0cce-8905-9ae6-30a3120b632b.jpeg" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2Fdc4bd4a4-0cce-8905-9ae6-30a3120b632b.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=fa00bfb4585d35523125277dfac82690 1x" loading="lazy"></a><br>
線で結ばれているところがマッチした特徴です</p>

<p>これらの情報をもとに変形</p>

<div class="code-frame" data-lang="C#">
<div class="code-lang"><span class="bold">form1.cs</span></div>
<div class="highlight"><pre class="with-code"><code>            <span class="kt">int</span> <span class="n">size</span> <span class="p">=</span> <span class="n">matches</span><span class="p">.</span><span class="nf">Count</span><span class="p">();</span>
            <span class="kt">var</span> <span class="n">getPtsSrc</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vec2f</span><span class="p">[</span><span class="n">size</span><span class="p">];</span>
            <span class="kt">var</span> <span class="n">getPtsTarget</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vec2f</span><span class="p">[</span><span class="n">size</span><span class="p">];</span>

            <span class="kt">int</span> <span class="n">count</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">item</span> <span class="k">in</span> <span class="n">matches</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">ptSrc</span> <span class="p">=</span> <span class="n">keyPointsLeft</span><span class="p">[</span><span class="n">item</span><span class="p">.</span><span class="n">QueryIdx</span><span class="p">].</span><span class="n">Pt</span><span class="p">;</span>
                <span class="kt">var</span> <span class="n">ptTarget</span> <span class="p">=</span> <span class="n">keyPointsRight</span><span class="p">[</span><span class="n">item</span><span class="p">.</span><span class="n">TrainIdx</span><span class="p">].</span><span class="n">Pt</span><span class="p">;</span>
                <span class="n">getPtsSrc</span><span class="p">[</span><span class="n">count</span><span class="p">][</span><span class="m">0</span><span class="p">]</span> <span class="p">=</span> <span class="n">ptSrc</span><span class="p">.</span><span class="n">X</span><span class="p">;</span>
                <span class="n">getPtsSrc</span><span class="p">[</span><span class="n">count</span><span class="p">][</span><span class="m">1</span><span class="p">]</span> <span class="p">=</span> <span class="n">ptSrc</span><span class="p">.</span><span class="n">Y</span><span class="p">;</span>
                <span class="n">getPtsTarget</span><span class="p">[</span><span class="n">count</span><span class="p">][</span><span class="m">0</span><span class="p">]</span> <span class="p">=</span> <span class="n">ptTarget</span><span class="p">.</span><span class="n">X</span><span class="p">;</span>
                <span class="n">getPtsTarget</span><span class="p">[</span><span class="n">count</span><span class="p">][</span><span class="m">1</span><span class="p">]</span> <span class="p">=</span> <span class="n">ptTarget</span><span class="p">.</span><span class="n">Y</span><span class="p">;</span>
                <span class="n">count</span><span class="p">++;</span>
            <span class="p">}</span>

            <span class="c1">// SrcをTargetにあわせこむ変換行列homを取得する。ロバスト推定法はRANZAC。</span>
            <span class="kt">var</span> <span class="n">hom</span> <span class="p">=</span> <span class="n">Cv2</span><span class="p">.</span><span class="nf">FindHomography</span><span class="p">(</span>
                <span class="n">InputArray</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="n">getPtsSrc</span><span class="p">),</span>
                <span class="n">InputArray</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="n">getPtsTarget</span><span class="p">),</span>
                <span class="n">HomographyMethods</span><span class="p">.</span><span class="n">Ransac</span><span class="p">);</span>

            <span class="c1">// 行列homを用いてSrcに射影変換を適用する。</span>
            <span class="n">Mat</span> <span class="n">WarpedSrcMat</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Mat</span><span class="p">();</span>
            <span class="n">Cv2</span><span class="p">.</span><span class="nf">WarpPerspective</span><span class="p">(</span>
                <span class="n">Lsrc</span><span class="p">,</span> <span class="n">WarpedSrcMat</span><span class="p">,</span> <span class="n">hom</span><span class="p">,</span>
                <span class="k">new</span> <span class="n">OpenCvSharp</span><span class="p">.</span><span class="nf">Size</span><span class="p">(</span><span class="n">Rsrc</span><span class="p">.</span><span class="n">Width</span><span class="p">,</span> <span class="n">Rsrc</span><span class="p">.</span><span class="n">Height</span><span class="p">));</span>
</code></pre></div>
</div>

<p>WarpedSrcMat.jpg<br>
<a href="https://camo.qiitausercontent.com/e1688bd473dca2bd59613e70aa6387d48ae2364d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3730353234392f62363361336461302d656666622d333162342d626362362d3063336638623838373361342e6a706567" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2Fb63a3da0-effb-31b4-bcb6-0c3f8b8873a4.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=8dce4993f21a54b6bc5b1f03668c5bac" alt="Warap.jpg" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/705249/b63a3da0-effb-31b4-bcb6-0c3f8b8873a4.jpeg" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2Fb63a3da0-effb-31b4-bcb6-0c3f8b8873a4.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=29ea445477c07176353064586b208e30 1x" loading="lazy"></a><br>
綺麗に変形できました<br>
この時点で射影変換した画像はだいぶ画質が劣化しているのがわかります<br>
これが前述のごま塩ノイズの原因です</p>

<h3>
<span id="画像の差分抽出" class="fragment"></span><a href="#%E7%94%BB%E5%83%8F%E3%81%AE%E5%B7%AE%E5%88%86%E6%8A%BD%E5%87%BA"><i class="fa fa-link"></i></a>画像の差分抽出</h3>

<p>今回はMatのデータをRGBごとに抽出してそれぞれのチャンネルごとに差分を出し、<br>
どこか一つのチャンネルでも差分があった部分は差分ありとしてマークするようにしました</p>

<div class="code-frame" data-lang="C#">
<div class="code-lang"><span class="bold">form1.cs</span></div>
<div class="highlight"><pre class="with-code"><code>            <span class="c1">// 左右両方の画像を各チャンネルごとに分割</span>
            <span class="n">Mat</span> <span class="n">LmatFloat</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Mat</span><span class="p">();</span>
            <span class="n">WarpedSrcMat</span><span class="p">.</span><span class="nf">ConvertTo</span><span class="p">(</span><span class="n">LmatFloat</span><span class="p">,</span> <span class="n">MatType</span><span class="p">.</span><span class="n">CV_16SC3</span><span class="p">);</span>
            <span class="n">Mat</span><span class="p">[]</span> <span class="n">LmatPlanes</span> <span class="p">=</span> <span class="n">LmatFloat</span><span class="p">.</span><span class="nf">Split</span><span class="p">();</span>

            <span class="n">Mat</span> <span class="n">RmatFloat</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Mat</span><span class="p">();</span>
            <span class="n">Rsrc</span><span class="p">.</span><span class="nf">ConvertTo</span><span class="p">(</span><span class="n">RmatFloat</span><span class="p">,</span> <span class="n">MatType</span><span class="p">.</span><span class="n">CV_16SC3</span><span class="p">);</span>
            <span class="n">Mat</span><span class="p">[]</span> <span class="n">RmatPlanes</span> <span class="p">=</span> <span class="n">RmatFloat</span><span class="p">.</span><span class="nf">Split</span><span class="p">();</span>

            <span class="n">Mat</span> <span class="n">diff0</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Mat</span><span class="p">();</span>
            <span class="n">Mat</span> <span class="n">diff1</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Mat</span><span class="p">();</span>
            <span class="n">Mat</span> <span class="n">diff2</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Mat</span><span class="p">();</span>

            <span class="c1">// 分割したチャンネルごとに差分を出す</span>
            <span class="n">Cv2</span><span class="p">.</span><span class="nf">Absdiff</span><span class="p">(</span><span class="n">LmatPlanes</span><span class="p">[</span><span class="m">0</span><span class="p">],</span> <span class="n">RmatPlanes</span><span class="p">[</span><span class="m">0</span><span class="p">],</span> <span class="n">diff0</span><span class="p">);</span>
            <span class="n">Cv2</span><span class="p">.</span><span class="nf">Absdiff</span><span class="p">(</span><span class="n">LmatPlanes</span><span class="p">[</span><span class="m">1</span><span class="p">],</span> <span class="n">RmatPlanes</span><span class="p">[</span><span class="m">1</span><span class="p">],</span> <span class="n">diff1</span><span class="p">);</span>
            <span class="n">Cv2</span><span class="p">.</span><span class="nf">Absdiff</span><span class="p">(</span><span class="n">LmatPlanes</span><span class="p">[</span><span class="m">2</span><span class="p">],</span> <span class="n">RmatPlanes</span><span class="p">[</span><span class="m">2</span><span class="p">],</span> <span class="n">diff2</span><span class="p">);</span>

            <span class="c1">// ブラーでノイズ除去</span>
            <span class="n">Cv2</span><span class="p">.</span><span class="nf">MedianBlur</span><span class="p">(</span><span class="n">diff0</span><span class="p">,</span> <span class="n">diff0</span><span class="p">,</span> <span class="m">5</span><span class="p">);</span>
            <span class="n">Cv2</span><span class="p">.</span><span class="nf">MedianBlur</span><span class="p">(</span><span class="n">diff1</span><span class="p">,</span> <span class="n">diff1</span><span class="p">,</span> <span class="m">5</span><span class="p">);</span>
            <span class="n">Cv2</span><span class="p">.</span><span class="nf">MedianBlur</span><span class="p">(</span><span class="n">diff2</span><span class="p">,</span> <span class="n">diff2</span><span class="p">,</span> <span class="m">5</span><span class="p">);</span>
</code></pre></div>
</div>

<p><a href="https://camo.qiitausercontent.com/5b50257e29463449c9dd44307f0695fdf089a147/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3730353234392f36383764646431632d313238372d313034302d386139302d6138616337613062323137382e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2F687ddd1c-1287-1040-8a90-a8ac7a0b2178.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=8c179b6f582404887093e430c6b3c705" alt="diffs.PNG" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/705249/687ddd1c-1287-1040-8a90-a8ac7a0b2178.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2F687ddd1c-1287-1040-8a90-a8ac7a0b2178.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=15fc44d2e9a3c7c22320fddf62c12e69 1x" loading="lazy"></a><br>
射影変換した画像の劣化によりだいぶ関係ない部分も白くなっていますが<br>
これは別の工程で緩和していきます</p>

<p>各チャンネルを統合し、どこかのチャンネルで差分がある場所は<br>
すべて差分ありとしてCv2.BitwiseOr()でマスク画像を生成します</p>

<div class="code-frame" data-lang="C#">
<div class="code-lang"><span class="bold">Form1.cs</span></div>
<div class="highlight"><pre class="with-code"><code>            <span class="n">Mat</span> <span class="n">wiseMat</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Mat</span><span class="p">();</span>
            <span class="n">Cv2</span><span class="p">.</span><span class="nf">BitwiseOr</span><span class="p">(</span><span class="n">diff0</span><span class="p">,</span> <span class="n">diff1</span><span class="p">,</span> <span class="n">wiseMat</span><span class="p">);</span>
            <span class="n">Cv2</span><span class="p">.</span><span class="nf">BitwiseOr</span><span class="p">(</span><span class="n">wiseMat</span><span class="p">,</span> <span class="n">diff2</span><span class="p">,</span> <span class="n">wiseMat</span><span class="p">);</span>
</code></pre></div>
</div>

<p>wiseMat.jpg<br>
<a href="https://camo.qiitausercontent.com/e26babe9132fad28a8d9048dee9d7f3e0459581a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3730353234392f66313436303830372d373163652d343536342d343733372d3934626666663065333834372e6a706567" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2Ff1460807-71ce-4564-4737-94bfff0e3847.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=0523b763f68451e7b7ef93be84f46b4a" alt="wiseMat.jpg" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/705249/f1460807-71ce-4564-4737-94bfff0e3847.jpeg" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2Ff1460807-71ce-4564-4737-94bfff0e3847.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=957aed75f00b82aa0fae283901e20073 1x" loading="lazy"></a><br>
だいぶ汚いですね</p>

<p>ここから汚いノイズを緩和していきます</p>

<div class="code-frame" data-lang="C#">
<div class="code-lang"><span class="bold">Form1.cs</span></div>
<div class="highlight"><pre class="with-code"><code>            <span class="c1">//オープニング処理でノイズ緩和</span>
            <span class="n">Mat</span> <span class="n">openingMat</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Mat</span><span class="p">();</span>
            <span class="n">Cv2</span><span class="p">.</span><span class="nf">MorphologyEx</span><span class="p">(</span><span class="n">wiseMat</span><span class="p">,</span> <span class="n">openingMat</span><span class="p">,</span> <span class="n">MorphTypes</span><span class="p">.</span><span class="n">Open</span><span class="p">,</span><span class="k">new</span> <span class="nf">Mat</span><span class="p">());</span>

            <span class="c1">// スレッショルドで差分をきれいにくっきりと</span>
            <span class="n">Mat</span> <span class="n">dilationMat</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Mat</span><span class="p">();</span>
            <span class="n">Cv2</span><span class="p">.</span><span class="nf">Dilate</span><span class="p">(</span><span class="n">openingMat</span><span class="p">,</span> <span class="n">dilationMat</span><span class="p">,</span> <span class="k">new</span> <span class="nf">Mat</span><span class="p">());</span>
            <span class="n">Cv2</span><span class="p">.</span><span class="nf">Threshold</span><span class="p">(</span><span class="n">dilationMat</span><span class="p">,</span> <span class="n">dilationMat</span><span class="p">,</span> <span class="m">100</span><span class="p">,</span> <span class="m">255</span><span class="p">,</span> <span class="n">ThresholdTypes</span><span class="p">.</span><span class="n">Binary</span><span class="p">);</span>
</code></pre></div>
</div>

<p>オープニング処理と二値化処理にて画像の汚い部分を消していきます<br>
dilationMat.jpg<br>
<a href="https://camo.qiitausercontent.com/6b7352d9429e2c5786018a0169607db78722bf33/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3730353234392f32636335323437322d663037392d373164382d356338382d3039653665613663336662652e6a706567" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2F2cc52472-f079-71d8-5c88-09e6ea6c3fbe.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=3172e8f84dfdfc7a70ae0d4d26eb39fe" alt="dilationMat.jpg" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/705249/2cc52472-f079-71d8-5c88-09e6ea6c3fbe.jpeg" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2F2cc52472-f079-71d8-5c88-09e6ea6c3fbe.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=eb5a70db9216a9ba584ab7546f203894 1x" loading="lazy"></a></p>

<h3>
<span id="差分と元画像を合成して表示" class="fragment"></span><a href="#%E5%B7%AE%E5%88%86%E3%81%A8%E5%85%83%E7%94%BB%E5%83%8F%E3%82%92%E5%90%88%E6%88%90%E3%81%97%E3%81%A6%E8%A1%A8%E7%A4%BA"><i class="fa fa-link"></i></a>差分と元画像を合成して表示</h3>

<p>ここからは画像の合成に入ります</p>

<div class="code-frame" data-lang="C#">
<div class="code-lang"><span class="bold">Form1.cs</span></div>
<div class="highlight"><pre class="with-code"><code>            <span class="c1">// dilationMatはグレースケールなので合成先のMatと同じ色空間に変換する</span>
            <span class="n">Mat</span> <span class="n">dilationScaleMat</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Mat</span><span class="p">();</span>
            <span class="n">Mat</span> <span class="n">dilationColorMat</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Mat</span><span class="p">();</span>
            <span class="n">Cv2</span><span class="p">.</span><span class="nf">ConvertScaleAbs</span><span class="p">(</span><span class="n">dilationMat</span><span class="p">,</span> <span class="n">dilationScaleMat</span><span class="p">);</span>
            <span class="n">Cv2</span><span class="p">.</span><span class="nf">CvtColor</span><span class="p">(</span><span class="n">dilationScaleMat</span><span class="p">,</span> <span class="n">dilationColorMat</span><span class="p">,</span> <span class="n">ColorConversionCodes</span><span class="p">.</span><span class="n">GRAY2RGB</span><span class="p">);</span>

            <span class="c1">// 元画像 3:差分画像 7 で合成</span>
            <span class="n">Cv2</span><span class="p">.</span><span class="nf">AddWeighted</span><span class="p">(</span><span class="n">WarpedSrcMat</span><span class="p">,</span> <span class="m">0.3</span><span class="p">,</span> <span class="n">dilationColorMat</span><span class="p">,</span> <span class="m">0.7</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">LaddMat</span><span class="p">);</span>
            <span class="n">Cv2</span><span class="p">.</span><span class="nf">AddWeighted</span><span class="p">(</span><span class="n">Rsrc</span><span class="p">,</span> <span class="m">0.3</span><span class="p">,</span> <span class="n">dilationColorMat</span><span class="p">,</span> <span class="m">0.7</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">RaddMat</span><span class="p">);</span>
</code></pre></div>
</div>

<p>Cv2.AddWeighted()を使えば合成する画像の割合を変えることができるので便利です<br>
今回は差分画像を多めに加算することで差分をわかりやすくしました</p>

<h3>
<span id="完成" class="fragment"></span><a href="#%E5%AE%8C%E6%88%90"><i class="fa fa-link"></i></a>完成！</h3>

<p><a href="https://camo.qiitausercontent.com/ab23564de95375cef75a813fde0f2fc0f81117e8/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3730353234392f34636631656336322d396135332d616435362d346233642d3236613832356531353661642e6a706567" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2F4cf1ec62-9a53-ad56-4b3d-26a825e156ad.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=9b00aa18beab4b035bd5d78c27b1a4a1" alt="Result.jpg" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/705249/4cf1ec62-9a53-ad56-4b3d-26a825e156ad.jpeg" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2F4cf1ec62-9a53-ad56-4b3d-26a825e156ad.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=1c3db14402ab90ad5dccf1ee1fcda1c8 1x" loading="lazy"></a></p>

<h1>
<span id="いざサイゼリヤへ" class="fragment"></span><a href="#%E3%81%84%E3%81%96%E3%82%B5%E3%82%A4%E3%82%BC%E3%83%AA%E3%83%A4%E3%81%B8"><i class="fa fa-link"></i></a>いざ、サイゼリヤへ</h1>

<p>実際に行って画像を撮影してきました<br>
左の画像<br>
<a href="https://camo.qiitausercontent.com/1da829aa7613d6e84c55e59b7ba7f249044e19fc/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3730353234392f64666264303934622d333362332d386265662d643763312d3930366439376138613931662e6a706567" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2Fdfbd094b-33b3-8bef-d7c1-906d97a8a91f.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=a79485aa468538c03bdc5365f5e81ed0" width="40%" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/705249/dfbd094b-33b3-8bef-d7c1-906d97a8a91f.jpeg" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2Fdfbd094b-33b3-8bef-d7c1-906d97a8a91f.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=4044b3908614d28ce70dbb16a7d95e37 1x" loading="lazy"></a><br>
右の画像<br>
<a href="https://camo.qiitausercontent.com/4d3070aea857af82559f69dfa3867512196d0ccd/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3730353234392f65643932323664322d306561312d333466612d353766372d6235313064633263633934372e6a706567" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2Fed9226d2-0ea1-34fa-57f7-b510dc2cc947.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=a91ec03b13bd0bc64d1bfae806e47c3b" width="46%" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/705249/ed9226d2-0ea1-34fa-57f7-b510dc2cc947.jpeg" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2Fed9226d2-0ea1-34fa-57f7-b510dc2cc947.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=b0367bd257fc730f896717e94bd2f241 1x" loading="lazy"></a></p>

<h3>
<span id="ジャン" class="fragment"></span><a href="#%E3%82%B8%E3%83%A3%E3%83%B3"><i class="fa fa-link"></i></a>ジャン！！！！</h3>

<p><a href="https://camo.qiitausercontent.com/2136c42b0bb2f19d7d3e23244e205c0fbb2d9d63/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3730353234392f39633062623530652d323739662d393665392d313534352d3065313866646363353135312e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2F9c0bb50e-279f-96e9-1545-0e18fdcc5151.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=7d2508253e726952c921e0404f7368ae" alt="キャプチャ_honban.PNG" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/705249/9c0bb50e-279f-96e9-1545-0e18fdcc5151.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2F9c0bb50e-279f-96e9-1545-0e18fdcc5151.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=a23a5eee186b1c440cbe54f5ce4c2a64 1x" loading="lazy"></a></p>

<p>ん～～～～～～～～～？？</p>

<p><a href="https://camo.qiitausercontent.com/4cb58d4be26c82f58834637f67032dc82f0d3745/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3730353234392f34333936346332322d636232612d313933322d633030312d3730393433656239346363392e6a706567" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2F43964c22-cb2a-1932-c001-70943eb94cc9.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=6ee2b2d704506d6715c9334207894429" alt="Result.jpg" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/705249/43964c22-cb2a-1932-c001-70943eb94cc9.jpeg" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2F43964c22-cb2a-1932-c001-70943eb94cc9.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=bac7b9139697dfe05501d35c4ccae85e 1x" loading="lazy"></a><br>
ダメっすね</p>

<h3>
<span id="今回の敗因" class="fragment"></span><a href="#%E4%BB%8A%E5%9B%9E%E3%81%AE%E6%95%97%E5%9B%A0"><i class="fa fa-link"></i></a>今回の敗因</h3>

<p>以下のことが失敗のようです<br>
(先人たちと同じ過ちをしてしまいました)<br>
・3次元のゆがみ(紙のそり)を変換できていない<br>
<a href="https://camo.qiitausercontent.com/7f3b5c36e316f0a77e52ebf43d002ef22e4bf691/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3730353234392f64636563303161622d363462322d396131362d306138352d3436303832633735613532622e6a706567" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2Fdcec01ab-64b2-9a16-0a85-46082c75a52b.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=17b6ac40052a879b03c5c3409ab596da" alt="Result_2.jpg" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/705249/dcec01ab-64b2-9a16-0a85-46082c75a52b.jpeg" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2Fdcec01ab-64b2-9a16-0a85-46082c75a52b.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=d2222fe35dc35aba4358ee1c3be61584 1x" loading="lazy"></a><br>
赤枠で囲った部分が顕著に歪んでいますね</p>

<p>この辺のゆがみが2次元ワープやら弾性マッチングが有効みたいですが計算量が果てしないみたいですね</p>

<p>ちなみに今回のアプリ。<br>
最後の撮影データを使った実験では体感で10秒ほど処理に時間がかかっていました<br>
一番時間がかかっていたのは射影変換ですね<br>
特徴量を総当たりするので<br>
画素数が多くなる<br>
↓<br>
特徴も多くなる<br>
↓<br>
総当たりする計算量も多くなる<br>
なので当たり前ですが…</p>

<h1>
<span id="最後に" class="fragment"></span><a href="#%E6%9C%80%E5%BE%8C%E3%81%AB"><i class="fa fa-link"></i></a>最後に</h1>

<p>今回はサイゼリヤの間違い探しをOpenCVを使って解いてみました<br>
仕事でOpenCVを使う機会があったのでその知識を応用＆コピペな部分が多いですが<br>
皆さんの参考になると嬉しいです</p>

<h1>
<span id="参考にしたサイト" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E3%81%AB%E3%81%97%E3%81%9F%E3%82%B5%E3%82%A4%E3%83%88"><i class="fa fa-link"></i></a>参考にしたサイト</h1>

<p>とても参考にしました<br>
本当にありがとうございます</p>

<p><a href="https://qiita.com/ika_kk/items/32c4986825c86ad92f36" id="reference-527c02dd132138a8128b">サイゼリヤの間違い探しをロバストな画像処理で解く</a><br>
<a href="https://qiita.com/y_a_m_a/items/0bb193b57b162925d1bb" id="reference-5d42b8326649552c6f7b">サイゼリヤの間違い探しを解く（ヒントになる）プログラムを作ってみた</a></p>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Fuechan16%2Fitems%2F3e382245444c0a6a960c&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Fuechan16%2Fitems%2F3e382245444c0a6a960c&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/uechan16/items/3e382245444c0a6a960c/likers" class="css-1iupg5d">13</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">6</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/3e382245444c0a6a960c/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/uechan16/items/3e382245444c0a6a960c/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/uechan16/items/3e382245444c0a6a960c/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/uechan16/items/3e382245444c0a6a960c/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/uechan16/items/3e382245444c0a6a960c.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-4c25a573-2b9b-4686-95ec-b529a28e11c7">{"authorAnalyticsTrackingId":null,"organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-d91adec6-c355-4c07-8aa2-38f8964d50fe"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-d91adec6-c355-4c07-8aa2-38f8964d50fe">{}</script>
      
<div id="LoginModal-react-component-f8a1137c-a31f-4fc8-ab6f-c9e794c9631b"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-f8a1137c-a31f-4fc8-ab6f-c9e794c9631b">{}</script>
      
<div id="StockModal-react-component-6a8edc1d-9974-4f79-b3df-d24036d3b287"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-6a8edc1d-9974-4f79-b3df-d24036d3b287">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;58xc98W5nXJly1e8FTIXkTClrG5oydLxyI3Ll6xO/0nzR2fxI7xgO9SXahqV2PYC0FG+2eOo5hLOI6C15U1Zaw==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\u003cp\u003e初投稿になります\u003cbr\u003e\nC#信者のQAエンジニアです\u003cbr\u003e\n以後お見知りおきを…\u003c/p\u003e\n\n\u003cp\u003eさてさて学生の味方ともいえるサイゼリヤ\u003cbr\u003e\n自分も学生の頃は部活の打ち上げやテスト勉強にてドリンクバーとドリアで何時間も粘ったものです\u003c/p\u003e\n\n\u003cp\u003eそんな時一度は見たことのある間違い探し\u003c/p\u003e\n\n\u003cp\u003e今回はこれを自動で解くアプリをC#で作成してみようと思います\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"実現したいこと\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%9F%E7%8F%BE%E3%81%97%E3%81%9F%E3%81%84%E3%81%93%E3%81%A8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e実現したいこと\u003c/h1\u003e\n\n\u003cp\u003eC#とOpenCVSharpを使用し\u003cbr\u003e\nサイゼリアの間違い探しを右の画像と左の画像として撮影\u003cbr\u003e\nその差分を画像としてわかりやすく出力する\u003c/p\u003e\n\n\u003cp\u003eプログラムの流れとしては\u003cbr\u003e\n・画像の変換(撮影することを考慮して左右の画像のサイズを合わせる)\u003cbr\u003e\n・画像の差分抽出(R,G,Bごとに差分を出す)\u003cbr\u003e\n・差分と元画像を合成して表示\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"今回使う画像\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BB%8A%E5%9B%9E%E4%BD%BF%E3%81%86%E7%94%BB%E5%83%8F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e今回使う画像\u003c/h1\u003e\n\n\u003cp\u003eテスト用にサイゼリヤ公式サイトの画像を変形させたものを用意\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/7fbc64ad8e981957e68f698d3d9d30afe77d9e45/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3730353234392f39623838636535612d633939352d643961652d656666652d3461383136656636383861662e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2F9b88ce5a-c995-d9ae-effe-4a816ef688af.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=2b379daa9989e8ba5b4e8212434a5f76\" width=\"40%\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/705249/9b88ce5a-c995-d9ae-effe-4a816ef688af.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2F9b88ce5a-c995-d9ae-effe-4a816ef688af.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=7182bf0673b44cea116bbd01b0fc4d73 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003ca href=\"https://camo.qiitausercontent.com/9dd6f6e3703f316eebfb6c27ee1f0a354f9bc39c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3730353234392f63383435643530372d376333312d376531302d313132622d6139373537653339336164372e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2Fc845d507-7c31-7e10-112b-a9757e393ad7.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=849e0a9bdb5da5927d5429cbb11d66af\" width=\"40%\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/705249/c845d507-7c31-7e10-112b-a9757e393ad7.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2Fc845d507-7c31-7e10-112b-a9757e393ad7.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=fd79bc67504818365b5c4eae6e736bd4 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"実行結果\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%9F%E8%A1%8C%E7%B5%90%E6%9E%9C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e実行結果\u003c/h1\u003e\n\n\u003cp\u003eアプリ画面\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/33cd814e7ac1e8cd6f8ae1a705061bc556f0a7b0/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3730353234392f62303664313138642d363638312d373463612d393431652d3561373438343532343731362e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2Fb06d118d-6681-74ca-941e-5a7484524716.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=677f9036c0695546d1b5086fc1df22fe\" width=\"100%\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/705249/b06d118d-6681-74ca-941e-5a7484524716.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2Fb06d118d-6681-74ca-941e-5a7484524716.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=a76bb2620a5f1656699e89c59923f7d3 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n最終生成画像(result.jpg)\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/879fa317231a257467e4ee1833957a7b1042e47a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3730353234392f38313566326439662d383839342d356131652d616238322d6539646334353236636363352e6a706567\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2F815f2d9f-8894-5a1e-ab82-e9dc4526ccc5.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=bbe76fb760f66013a966be2e99471cf7\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/705249/815f2d9f-8894-5a1e-ab82-e9dc4526ccc5.jpeg\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2F815f2d9f-8894-5a1e-ab82-e9dc4526ccc5.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=8daab3196d4c20d5a5d3aab7525c5ae6 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n取り除ききれなかったごま塩ノイズが少しありますが多めに見てください…\u003cbr\u003e\nちなみに変形していない画像を使うと\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/9738f9c5d4cbd3d378d695061bbaa5558061926d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3730353234392f34383336336562652d336232332d643965372d363261342d6666303439373765613039632e6a706567\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2F48363ebe-3b23-d9e7-62a4-ff04977ea09c.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=9a44b2592c12e66793025b7d450790dc\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/705249/48363ebe-3b23-d9e7-62a4-ff04977ea09c.jpeg\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2F48363ebe-3b23-d9e7-62a4-ff04977ea09c.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=664b513f289e6a0d926393ba6299a5a8 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\nきれいに取れますね\u003cbr\u003e\n（変換によるビットの抜け？が原因でごま塩になっているものと思われます）\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"実行環境\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%9F%E8%A1%8C%E7%92%B0%E5%A2%83\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e実行環境\u003c/h1\u003e\n\n\u003cp\u003eC#\u003cbr\u003e\n.Net Framework 4.7.2\u003cbr\u003e\nOpenCvSharp3-AnyCPU Ver4.0.0\u003c/p\u003e\n\n\u003cp\u003eWindows 10 Home 64Bit\u003cbr\u003e\nIntel Core i7 9700\u003cbr\u003e\nRAM 16GB\u003cbr\u003e\nGPU NVIDIA GeForce GTX 1660\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"アルゴリズムの詳細\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%A2%E3%83%AB%E3%82%B4%E3%83%AA%E3%82%BA%E3%83%A0%E3%81%AE%E8%A9%B3%E7%B4%B0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eアルゴリズムの詳細\u003c/h1\u003e\n\n\u003cp\u003e以下に大まかな流れを紹介していきます\u003cbr\u003e\nGitHubにソース類をおいてあるので参考にしてみてください\u003cbr\u003e\n\u003ca href=\"https://github.com/uechan16/SaizeriyaMachigaisagashi\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/uechan16/SaizeriyaMachigaisagashi\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"画像の変換\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%94%BB%E5%83%8F%E3%81%AE%E5%A4%89%E6%8F%9B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e画像の変換\u003c/h3\u003e\n\n\u003cp\u003e画像は机にあるサイゼリアのメニューを撮影することを考えると上からとっても多少のゆがみが発生すると思います\u003cbr\u003e\nそんなゆがみを射影変換である程度同じ角度、大きさに整えていきます\u003c/p\u003e\n\n\u003cp\u003e変換の手法は特徴点マッチングです\u003cbr\u003e\n画像の特徴を割り出し、その特徴同士を比較する方法です\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eForm.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e            \u003cspan class=\"n\"\u003eAKAZE\u003c/span\u003e \u003cspan class=\"n\"\u003eakaze\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eAKAZE\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreate\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eKeyPoint\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003ekeyPointsLeft\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eKeyPoint\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003ekeyPointsRight\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n            \u003cspan class=\"n\"\u003eMat\u003c/span\u003e \u003cspan class=\"n\"\u003edescriptorLeft\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMat\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e  \n            \u003cspan class=\"n\"\u003eMat\u003c/span\u003e \u003cspan class=\"n\"\u003edescriptorRight\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMat\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n            \u003cspan class=\"n\"\u003eDescriptorMatcher\u003c/span\u003e \u003cspan class=\"n\"\u003ematcher\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e//マッチング方法\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eDMatch\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003ematches\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e//特徴量ベクトル同士のマッチング結果を格納する配列\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e//画像をグレースケールとして読み込む \u003c/span\u003e\n            \u003cspan class=\"n\"\u003eMat\u003c/span\u003e \u003cspan class=\"n\"\u003eLsrc\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esLeftPictureFile\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eImreadModes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eColor\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e//画像をグレースケールとして読み込む\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eMat\u003c/span\u003e \u003cspan class=\"n\"\u003eRsrc\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esRightPictureFile\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eImreadModes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eColor\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e//特徴量の検出と特徴量ベクトルの計算\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eakaze\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDetectAndCompute\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLsrc\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003ekeyPointsLeft\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edescriptorLeft\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eakaze\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDetectAndCompute\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eRsrc\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003ekeyPointsRight\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edescriptorRight\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e//画像1の特徴点をoutput1に出力\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eCv2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDrawKeypoints\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLsrc\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ekeyPointsLeft\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etokuLeft\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eImage\u003c/span\u003e \u003cspan class=\"n\"\u003eimageLeftToku\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eBitmapConverter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToBitmap\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etokuLeft\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003epictureBox3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSizeMode\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ePictureBoxSizeMode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eZoom\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003epictureBox3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eImage\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eimageLeftToku\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e//画像2の特徴点をoutput1に出力\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eCv2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDrawKeypoints\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eRsrc\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ekeyPointsRight\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etokuRight\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eImage\u003c/span\u003e \u003cspan class=\"n\"\u003eimageRightToku\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eBitmapConverter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToBitmap\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etokuRight\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003epictureBox4\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSizeMode\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ePictureBoxSizeMode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eZoom\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003epictureBox4\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eImage\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eimageRightToku\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eこの辺は特徴量マッチングで調べるとよく出てくるコード丸パクリです\u003cbr\u003e\nこうして出てくる画像がこちら\u003cbr\u003e\nLeftToku.jpg\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/0b96e176e7cc0a6219be3c01f90d92b926ded3fa/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3730353234392f34613135366266632d326464342d373734612d626162372d3865363430323939643137652e6a706567\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2F4a156bfc-2dd4-774a-bab7-8e640299d17e.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=625a8df40c8ba5476e0a71a22cf1304c\" width=\"60%\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/705249/4a156bfc-2dd4-774a-bab7-8e640299d17e.jpeg\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2F4a156bfc-2dd4-774a-bab7-8e640299d17e.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=3fa0a5c2b7b2bfb187f301ee307fcc62 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\nRightToku.jpg\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/4457b38d9290199688df552c2a6cff6812e31180/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3730353234392f30613239343365642d623434652d333139622d623863372d6437306464666434616165612e6a706567\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2F0a2943ed-b44e-319b-b8c7-d70ddfd4aaea.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=6c0c63e41611c18be26e3e3a2179b2cd\" width=\"60%\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/705249/0a2943ed-b44e-319b-b8c7-d70ddfd4aaea.jpeg\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2F0a2943ed-b44e-319b-b8c7-d70ddfd4aaea.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=cbb865298c71f087fedf3eade79c432a 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n丸がついているところが画像の特徴を表しています\u003c/p\u003e\n\n\u003cp\u003eそしてこの特徴同士をマッチング\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eForm.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e           \u003cspan class=\"c1\"\u003e//総当たりでマッチング\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ematcher\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eDescriptorMatcher\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"BruteForce\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ematches\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ematcher\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eMatch\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edescriptorLeft\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edescriptorRight\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eCv2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDrawMatches\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLsrc\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ekeyPointsLeft\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eRsrc\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ekeyPointsRight\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ematches\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eoutput\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eoutput.jpg\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/4bb5b93ed7d83db7d19e197d9a459388c2290f54/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3730353234392f64633462643461342d306363652d383930352d396165362d3330613331323062363332622e6a706567\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2Fdc4bd4a4-0cce-8905-9ae6-30a3120b632b.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=e4d37f7162396604264d82988d7d1aed\" width=\"60%\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/705249/dc4bd4a4-0cce-8905-9ae6-30a3120b632b.jpeg\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2Fdc4bd4a4-0cce-8905-9ae6-30a3120b632b.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=fa00bfb4585d35523125277dfac82690 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n線で結ばれているところがマッチした特徴です\u003c/p\u003e\n\n\u003cp\u003eこれらの情報をもとに変形\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eform1.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e            \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003esize\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ematches\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCount\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003egetPtsSrc\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eVec2f\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003esize\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003egetPtsTarget\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eVec2f\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003esize\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\n            \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ecount\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eitem\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003ematches\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eptSrc\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ekeyPointsLeft\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eQueryIdx\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003ePt\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eptTarget\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ekeyPointsRight\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTrainIdx\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003ePt\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"n\"\u003egetPtsSrc\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ecount\u003c/span\u003e\u003cspan class=\"p\"\u003e][\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eptSrc\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eX\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"n\"\u003egetPtsSrc\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ecount\u003c/span\u003e\u003cspan class=\"p\"\u003e][\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eptSrc\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eY\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"n\"\u003egetPtsTarget\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ecount\u003c/span\u003e\u003cspan class=\"p\"\u003e][\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eptTarget\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eX\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"n\"\u003egetPtsTarget\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ecount\u003c/span\u003e\u003cspan class=\"p\"\u003e][\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eptTarget\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eY\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"n\"\u003ecount\u003c/span\u003e\u003cspan class=\"p\"\u003e++;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// SrcをTargetにあわせこむ変換行列homを取得する。ロバスト推定法はRANZAC。\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ehom\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eCv2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFindHomography\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eInputArray\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003egetPtsSrc\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eInputArray\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003egetPtsTarget\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eHomographyMethods\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRansac\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// 行列homを用いてSrcに射影変換を適用する。\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eMat\u003c/span\u003e \u003cspan class=\"n\"\u003eWarpedSrcMat\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMat\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eCv2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWarpPerspective\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eLsrc\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eWarpedSrcMat\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ehom\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eOpenCvSharp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSize\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eRsrc\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWidth\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eRsrc\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eHeight\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eWarpedSrcMat.jpg\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/e1688bd473dca2bd59613e70aa6387d48ae2364d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3730353234392f62363361336461302d656666622d333162342d626362362d3063336638623838373361342e6a706567\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2Fb63a3da0-effb-31b4-bcb6-0c3f8b8873a4.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=8dce4993f21a54b6bc5b1f03668c5bac\" alt=\"Warap.jpg\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/705249/b63a3da0-effb-31b4-bcb6-0c3f8b8873a4.jpeg\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2Fb63a3da0-effb-31b4-bcb6-0c3f8b8873a4.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=29ea445477c07176353064586b208e30 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n綺麗に変形できました\u003cbr\u003e\nこの時点で射影変換した画像はだいぶ画質が劣化しているのがわかります\u003cbr\u003e\nこれが前述のごま塩ノイズの原因です\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"画像の差分抽出\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%94%BB%E5%83%8F%E3%81%AE%E5%B7%AE%E5%88%86%E6%8A%BD%E5%87%BA\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e画像の差分抽出\u003c/h3\u003e\n\n\u003cp\u003e今回はMatのデータをRGBごとに抽出してそれぞれのチャンネルごとに差分を出し、\u003cbr\u003e\nどこか一つのチャンネルでも差分があった部分は差分ありとしてマークするようにしました\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eform1.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e            \u003cspan class=\"c1\"\u003e// 左右両方の画像を各チャンネルごとに分割\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eMat\u003c/span\u003e \u003cspan class=\"n\"\u003eLmatFloat\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMat\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eWarpedSrcMat\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eConvertTo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLmatFloat\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eMatType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCV_16SC3\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eMat\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003eLmatPlanes\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eLmatFloat\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSplit\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n            \u003cspan class=\"n\"\u003eMat\u003c/span\u003e \u003cspan class=\"n\"\u003eRmatFloat\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMat\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eRsrc\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eConvertTo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eRmatFloat\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eMatType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCV_16SC3\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eMat\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003eRmatPlanes\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eRmatFloat\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSplit\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n            \u003cspan class=\"n\"\u003eMat\u003c/span\u003e \u003cspan class=\"n\"\u003ediff0\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMat\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eMat\u003c/span\u003e \u003cspan class=\"n\"\u003ediff1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMat\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eMat\u003c/span\u003e \u003cspan class=\"n\"\u003ediff2\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMat\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// 分割したチャンネルごとに差分を出す\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eCv2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAbsdiff\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLmatPlanes\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003eRmatPlanes\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003ediff0\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eCv2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAbsdiff\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLmatPlanes\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003eRmatPlanes\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003ediff1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eCv2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAbsdiff\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLmatPlanes\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003eRmatPlanes\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003ediff2\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// ブラーでノイズ除去\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eCv2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eMedianBlur\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ediff0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ediff0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e5\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eCv2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eMedianBlur\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ediff1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ediff1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e5\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eCv2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eMedianBlur\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ediff2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ediff2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e5\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/5b50257e29463449c9dd44307f0695fdf089a147/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3730353234392f36383764646431632d313238372d313034302d386139302d6138616337613062323137382e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2F687ddd1c-1287-1040-8a90-a8ac7a0b2178.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=8c179b6f582404887093e430c6b3c705\" alt=\"diffs.PNG\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/705249/687ddd1c-1287-1040-8a90-a8ac7a0b2178.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2F687ddd1c-1287-1040-8a90-a8ac7a0b2178.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=15fc44d2e9a3c7c22320fddf62c12e69 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n射影変換した画像の劣化によりだいぶ関係ない部分も白くなっていますが\u003cbr\u003e\nこれは別の工程で緩和していきます\u003c/p\u003e\n\n\u003cp\u003e各チャンネルを統合し、どこかのチャンネルで差分がある場所は\u003cbr\u003e\nすべて差分ありとしてCv2.BitwiseOr()でマスク画像を生成します\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eForm1.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e            \u003cspan class=\"n\"\u003eMat\u003c/span\u003e \u003cspan class=\"n\"\u003ewiseMat\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMat\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eCv2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eBitwiseOr\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ediff0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ediff1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ewiseMat\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eCv2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eBitwiseOr\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ewiseMat\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ediff2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ewiseMat\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003ewiseMat.jpg\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/e26babe9132fad28a8d9048dee9d7f3e0459581a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3730353234392f66313436303830372d373163652d343536342d343733372d3934626666663065333834372e6a706567\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2Ff1460807-71ce-4564-4737-94bfff0e3847.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=0523b763f68451e7b7ef93be84f46b4a\" alt=\"wiseMat.jpg\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/705249/f1460807-71ce-4564-4737-94bfff0e3847.jpeg\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2Ff1460807-71ce-4564-4737-94bfff0e3847.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=957aed75f00b82aa0fae283901e20073 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\nだいぶ汚いですね\u003c/p\u003e\n\n\u003cp\u003eここから汚いノイズを緩和していきます\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eForm1.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e            \u003cspan class=\"c1\"\u003e//オープニング処理でノイズ緩和\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eMat\u003c/span\u003e \u003cspan class=\"n\"\u003eopeningMat\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMat\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eCv2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eMorphologyEx\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ewiseMat\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eopeningMat\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eMorphTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eOpen\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMat\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// スレッショルドで差分をきれいにくっきりと\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eMat\u003c/span\u003e \u003cspan class=\"n\"\u003edilationMat\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMat\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eCv2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDilate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eopeningMat\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edilationMat\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMat\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eCv2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eThreshold\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edilationMat\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edilationMat\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e100\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e255\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eThresholdTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBinary\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eオープニング処理と二値化処理にて画像の汚い部分を消していきます\u003cbr\u003e\ndilationMat.jpg\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/6b7352d9429e2c5786018a0169607db78722bf33/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3730353234392f32636335323437322d663037392d373164382d356338382d3039653665613663336662652e6a706567\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2F2cc52472-f079-71d8-5c88-09e6ea6c3fbe.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=3172e8f84dfdfc7a70ae0d4d26eb39fe\" alt=\"dilationMat.jpg\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/705249/2cc52472-f079-71d8-5c88-09e6ea6c3fbe.jpeg\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2F2cc52472-f079-71d8-5c88-09e6ea6c3fbe.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=eb5a70db9216a9ba584ab7546f203894 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"差分と元画像を合成して表示\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%B7%AE%E5%88%86%E3%81%A8%E5%85%83%E7%94%BB%E5%83%8F%E3%82%92%E5%90%88%E6%88%90%E3%81%97%E3%81%A6%E8%A1%A8%E7%A4%BA\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e差分と元画像を合成して表示\u003c/h3\u003e\n\n\u003cp\u003eここからは画像の合成に入ります\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"C#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eForm1.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e            \u003cspan class=\"c1\"\u003e// dilationMatはグレースケールなので合成先のMatと同じ色空間に変換する\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eMat\u003c/span\u003e \u003cspan class=\"n\"\u003edilationScaleMat\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMat\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eMat\u003c/span\u003e \u003cspan class=\"n\"\u003edilationColorMat\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMat\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eCv2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eConvertScaleAbs\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edilationMat\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edilationScaleMat\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eCv2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCvtColor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edilationScaleMat\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edilationColorMat\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eColorConversionCodes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGRAY2RGB\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// 元画像 3:差分画像 7 で合成\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eCv2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAddWeighted\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eWarpedSrcMat\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0.3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edilationColorMat\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0.7\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eLaddMat\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eCv2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAddWeighted\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eRsrc\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0.3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edilationColorMat\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0.7\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eRaddMat\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eCv2.AddWeighted()を使えば合成する画像の割合を変えることができるので便利です\u003cbr\u003e\n今回は差分画像を多めに加算することで差分をわかりやすくしました\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"完成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%8C%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e完成！\u003c/h3\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/ab23564de95375cef75a813fde0f2fc0f81117e8/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3730353234392f34636631656336322d396135332d616435362d346233642d3236613832356531353661642e6a706567\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2F4cf1ec62-9a53-ad56-4b3d-26a825e156ad.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=9b00aa18beab4b035bd5d78c27b1a4a1\" alt=\"Result.jpg\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/705249/4cf1ec62-9a53-ad56-4b3d-26a825e156ad.jpeg\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2F4cf1ec62-9a53-ad56-4b3d-26a825e156ad.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=1c3db14402ab90ad5dccf1ee1fcda1c8 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"いざサイゼリヤへ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%84%E3%81%96%E3%82%B5%E3%82%A4%E3%82%BC%E3%83%AA%E3%83%A4%E3%81%B8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eいざ、サイゼリヤへ\u003c/h1\u003e\n\n\u003cp\u003e実際に行って画像を撮影してきました\u003cbr\u003e\n左の画像\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/1da829aa7613d6e84c55e59b7ba7f249044e19fc/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3730353234392f64666264303934622d333362332d386265662d643763312d3930366439376138613931662e6a706567\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2Fdfbd094b-33b3-8bef-d7c1-906d97a8a91f.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=a79485aa468538c03bdc5365f5e81ed0\" width=\"40%\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/705249/dfbd094b-33b3-8bef-d7c1-906d97a8a91f.jpeg\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2Fdfbd094b-33b3-8bef-d7c1-906d97a8a91f.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=4044b3908614d28ce70dbb16a7d95e37 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n右の画像\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/4d3070aea857af82559f69dfa3867512196d0ccd/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3730353234392f65643932323664322d306561312d333466612d353766372d6235313064633263633934372e6a706567\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2Fed9226d2-0ea1-34fa-57f7-b510dc2cc947.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=a91ec03b13bd0bc64d1bfae806e47c3b\" width=\"46%\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/705249/ed9226d2-0ea1-34fa-57f7-b510dc2cc947.jpeg\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2Fed9226d2-0ea1-34fa-57f7-b510dc2cc947.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=b0367bd257fc730f896717e94bd2f241 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"ジャン\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B8%E3%83%A3%E3%83%B3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eジャン！！！！\u003c/h3\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/2136c42b0bb2f19d7d3e23244e205c0fbb2d9d63/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3730353234392f39633062623530652d323739662d393665392d313534352d3065313866646363353135312e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2F9c0bb50e-279f-96e9-1545-0e18fdcc5151.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=7d2508253e726952c921e0404f7368ae\" alt=\"キャプチャ_honban.PNG\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/705249/9c0bb50e-279f-96e9-1545-0e18fdcc5151.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2F9c0bb50e-279f-96e9-1545-0e18fdcc5151.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=a23a5eee186b1c440cbe54f5ce4c2a64 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eん～～～～～～～～～？？\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/4cb58d4be26c82f58834637f67032dc82f0d3745/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3730353234392f34333936346332322d636232612d313933322d633030312d3730393433656239346363392e6a706567\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2F43964c22-cb2a-1932-c001-70943eb94cc9.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=6ee2b2d704506d6715c9334207894429\" alt=\"Result.jpg\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/705249/43964c22-cb2a-1932-c001-70943eb94cc9.jpeg\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2F43964c22-cb2a-1932-c001-70943eb94cc9.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=bac7b9139697dfe05501d35c4ccae85e 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\nダメっすね\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"今回の敗因\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BB%8A%E5%9B%9E%E3%81%AE%E6%95%97%E5%9B%A0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e今回の敗因\u003c/h3\u003e\n\n\u003cp\u003e以下のことが失敗のようです\u003cbr\u003e\n(先人たちと同じ過ちをしてしまいました)\u003cbr\u003e\n・3次元のゆがみ(紙のそり)を変換できていない\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/7f3b5c36e316f0a77e52ebf43d002ef22e4bf691/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3730353234392f64636563303161622d363462322d396131362d306138352d3436303832633735613532622e6a706567\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2Fdcec01ab-64b2-9a16-0a85-46082c75a52b.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=17b6ac40052a879b03c5c3409ab596da\" alt=\"Result_2.jpg\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/705249/dcec01ab-64b2-9a16-0a85-46082c75a52b.jpeg\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F705249%2Fdcec01ab-64b2-9a16-0a85-46082c75a52b.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=d2222fe35dc35aba4358ee1c3be61584 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n赤枠で囲った部分が顕著に歪んでいますね\u003c/p\u003e\n\n\u003cp\u003eこの辺のゆがみが2次元ワープやら弾性マッチングが有効みたいですが計算量が果てしないみたいですね\u003c/p\u003e\n\n\u003cp\u003eちなみに今回のアプリ。\u003cbr\u003e\n最後の撮影データを使った実験では体感で10秒ほど処理に時間がかかっていました\u003cbr\u003e\n一番時間がかかっていたのは射影変換ですね\u003cbr\u003e\n特徴量を総当たりするので\u003cbr\u003e\n画素数が多くなる\u003cbr\u003e\n↓\u003cbr\u003e\n特徴も多くなる\u003cbr\u003e\n↓\u003cbr\u003e\n総当たりする計算量も多くなる\u003cbr\u003e\nなので当たり前ですが…\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"最後に\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%9C%80%E5%BE%8C%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e最後に\u003c/h1\u003e\n\n\u003cp\u003e今回はサイゼリヤの間違い探しをOpenCVを使って解いてみました\u003cbr\u003e\n仕事でOpenCVを使う機会があったのでその知識を応用＆コピペな部分が多いですが\u003cbr\u003e\n皆さんの参考になると嬉しいです\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"参考にしたサイト\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8F%82%E8%80%83%E3%81%AB%E3%81%97%E3%81%9F%E3%82%B5%E3%82%A4%E3%83%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e参考にしたサイト\u003c/h1\u003e\n\n\u003cp\u003eとても参考にしました\u003cbr\u003e\n本当にありがとうございます\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita.com/ika_kk/items/32c4986825c86ad92f36\" id=\"reference-527c02dd132138a8128b\"\u003eサイゼリヤの間違い探しをロバストな画像処理で解く\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://qiita.com/y_a_m_a/items/0bb193b57b162925d1bb\" id=\"reference-5d42b8326649552c6f7b\"\u003eサイゼリヤの間違い探しを解く（ヒントになる）プログラムを作ってみた\u003c/a\u003e\u003c/p\u003e\n","createdAt":"2020-10-04T15:28:23Z","elapsedYearsFromLastModifiedAt":0,"encryptedId":"Qpgkdo227oGRhuP4l+9UHHrBzyRd6vxSYg==--mwcfdqhlNzYq83iw--riAR+BBWMhILXMSA1lJn1Q==","isBanned":false,"isDeprecated":false,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2020-10-04T15:29:12Z","likesCount":13,"linkUrl":"https://qiita.com/uechan16/items/3e382245444c0a6a960c","organization":null,"originalId":1314043,"stockedCount":6,"title":"サイゼリヤの間違い探しをOpenCVで解いてみた","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%AE%9F%E7%8F%BE%E3%81%97%E3%81%9F%E3%81%84%E3%81%93%E3%81%A8\"\u003e実現したいこと\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%BB%8A%E5%9B%9E%E4%BD%BF%E3%81%86%E7%94%BB%E5%83%8F\"\u003e今回使う画像\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%AE%9F%E8%A1%8C%E7%B5%90%E6%9E%9C\"\u003e実行結果\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%AE%9F%E8%A1%8C%E7%92%B0%E5%A2%83\"\u003e実行環境\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%A2%E3%83%AB%E3%82%B4%E3%83%AA%E3%82%BA%E3%83%A0%E3%81%AE%E8%A9%B3%E7%B4%B0\"\u003eアルゴリズムの詳細\u003c/a\u003e\n\u003cul\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%94%BB%E5%83%8F%E3%81%AE%E5%A4%89%E6%8F%9B\"\u003e画像の変換\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%94%BB%E5%83%8F%E3%81%AE%E5%B7%AE%E5%88%86%E6%8A%BD%E5%87%BA\"\u003e画像の差分抽出\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%B7%AE%E5%88%86%E3%81%A8%E5%85%83%E7%94%BB%E5%83%8F%E3%82%92%E5%90%88%E6%88%90%E3%81%97%E3%81%A6%E8%A1%A8%E7%A4%BA\"\u003e差分と元画像を合成して表示\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%AE%8C%E6%88%90\"\u003e完成！\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cli\u003e\n\u003ca href=\"#%E3%81%84%E3%81%96%E3%82%B5%E3%82%A4%E3%82%BC%E3%83%AA%E3%83%A4%E3%81%B8\"\u003eいざ、サイゼリヤへ\u003c/a\u003e\n\u003cul\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B8%E3%83%A3%E3%83%B3\"\u003eジャン！！！！\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%BB%8A%E5%9B%9E%E3%81%AE%E6%95%97%E5%9B%A0\"\u003e今回の敗因\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\n\n\u003cli\u003e\n\u003ca href=\"#%E6%9C%80%E5%BE%8C%E3%81%AB\"\u003e最後に\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%8F%82%E8%80%83%E3%81%AB%E3%81%97%E3%81%9F%E3%82%B5%E3%82%A4%E3%83%88\"\u003e参考にしたサイト\u003c/a\u003e\n\u003c/li\u003e\n\n","totalPv":2268,"uuid":"3e382245444c0a6a960c","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"K/4i6ZB7gPmjypu+d0ldCeTQqKTY--e96q8a5sKKITWGmu--24X8v7Irm501WoTF6xr09Q==","originalId":705249,"description":"本職はQAエンジニアですがC#とかWebシステムとかもいじったりしてます","facebookUrl":null,"githubUrl":"https://github.com/uechan16","isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"","profileImageUrl":"https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/705249/f906ca41475a96c685fe86f4aadd5b53edf19586/x_large.png?1601817662","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fs3-ap-northeast-1.amazonaws.com%2Fqiita-image-store%2F0%2F705249%2Ff906ca41475a96c685fe86f4aadd5b53edf19586%2Fx_large.png%3F1601817662?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=ccef73754412d53a4f8f4414e8babc9a","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fs3-ap-northeast-1.amazonaws.com%2Fqiita-image-store%2F0%2F705249%2Ff906ca41475a96c685fe86f4aadd5b53edf19586%2Fx_large.png%3F1601817662?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=edb8dd6014926c0ff44789253b78e6c5","urlName":"uechan16","websiteUrl":"","twitterUrl":null,"twitterUrlName":null,"revealedOrganizations":{"edges":[]}},"tags":[{"name":"C#","urlName":"csharp"},{"name":"画像処理","urlName":"%e7%94%bb%e5%83%8f%e5%87%a6%e7%90%86"},{"name":"OpenCV","urlName":"opencv"},{"name":"サイゼリヤ","urlName":"%e3%82%b5%e3%82%a4%e3%82%bc%e3%83%aa%e3%83%a4"}],"followingLikers":{"edges":[]},"comments":{"totalCount":0}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

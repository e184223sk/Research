More than 3 years have passed since last update.C#のSystem.Net.Http.HttpClientで自己署名証明書で適当に作ったサーバーに接続したらエラーになったのでこれを回避する方法を探してみた。
古い情報だと、WebRequestとか使ってるときにServicePointManager.ServerCertificateValidationCallbackを指定すればいいみたいな記事が多いんだけど、System.Net.Http.HttpClientを使ってるとこの手は使えないみたい。
で、よくよく調べてみると別の方法で回避するようなので残しておきます。要はHttpClient作成時にHttpClientHandlerを渡すんですが、そのときにコールバックを設定しておくということ。いくつか参考になったサイトはあったけど、コールバックで単純にtrueを返している例が多いので、もうちょっとちゃんとエラーを見て、その他のエラーはハンドルしないようにしてみました。ちなみに、通常のサーバーに接続するときはちゃんと名前をチェックして無視しない方が安全です。ホスト名が変わったりするときなどにやむを得ず回避する場合に限って使いましょう。(追記：2018/7/9)
sslPolicyErrorsはフラグなので、上記サンプルではエラーが組み合わせになった場合正しくハンドルできません。なので、そこはそこできちんと実装してくださいな。



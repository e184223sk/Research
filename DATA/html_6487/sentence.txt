More than 3 years have passed since last update.この記事は、SkyrimというゲームソフトのModファイルのバリナリ解析とそれを利用してModを生成するC#のコードについて記載していくシリーズ物です。
ファイルフォーマットについての詳しい情報は以下のサイトがあります。(以降UESP)
Tes5Mod:Mod File Format - The Unofficial Elder Scrolls Pages (UESP)前回はグループについて扱いましたので、今回はレコードについてです。前回、グループ、レコード、フィールドの最初にはヘッダー情報があることを記載しました。
ヘッダーには何の情報を扱うかの4文字の記号、全体のデータサイズなどが記載されています。
ヘッダーは24byteあり次のようになっています。※項目名はSSEEditでの表示名称を使用では、ヘッダー情報を扱うクラスを作成します。コンストラクターでファイルリーダーを受け取り、順次読み込んで行きます。
各項目は必ず順番通りにファイル出力用のOutputItemsに格納するようにします。続いて、レコードクラスを作成します。とりあえずまだ、フィールドデータは丸ごと読込む形とします。前回、グループクラスは丸ごとデータを読込んでいましたが、レコードを扱うように修正を加えます。
基本的な処理方法は、ファイルをDataSizeに合わせて順次読込んでいく形です。（このため、どこかで読込み間違えると大変なことになります）
これまでの内容で、どこにDataSizeの情報があるかわかっていますので、ファイルリーダーで、グループやレコードを一つの単位で扱えるようにします。続いて、グループクラスです。※前回グループクラスの内容にはOutputItemsへの追加を記載し忘れていましたファイルリーダーのGetGroupで1グループ分の読み取り範囲のファイルリーダーをTesGroupのコンストラクターに渡し、ヘッダー情報を読込み後、読み取り範囲が終了するまで、繰り返しレコードクラスを作成します。以上、今回はここまでです。



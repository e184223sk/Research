<!DOCTYPE html><html><head><meta charset="utf-8" /><title>ギガバイトクラスのJSONをデシリアライズするのにUtf8Jsonを使ってみる - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/koshian2/items/c7e0fe65a27326edf8d0" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="my7KnaWCdMwyOerkAoOKmhXJi9zAgCl1hHXbe1D732/7TaNKvY4bxOJvibh4WahXdsP2IZeNBlR8B+1YU6xf0w==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta content="@koshian2" name="twitter:creator" /><meta property="og:type" content="article"><meta property="og:title" content="ギガバイトクラスのJSONをデシリアライズするのにUtf8Jsonを使ってみる - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND00NEt1NDRLczQ0T1E0NEtrNDRPSTQ0S3Y0NE9wNDRLNTQ0R3VTbE5QVHVPQ2t1T0RoLU9DdC1PRHF1T0NvdU9EcWVPQ3BPT0N1dU9CbWVPQ2ktT0JydU9CcTFWMFpqaEtjMjl1NDRLUzVMMl80NEdqNDRHbTQ0R180NEtMJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NTQmdHh0LWNsaXA9ZWxsaXBzaXMmdHh0LWFsaWduPWNlbnRlciUyQ21pZGRsZSZzPWM2OWNlZGZkZjQ1OTRlNGRkNjMzNjk4MzgyZDYxYWFh&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RR3R2YzJocFlXNHkmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT00NSZ0eHQtYWxpZ249cmlnaHQlMkNib3R0b20mcz03ODE4YmRmMzdhNTRkOWNiMzBlZGM5NDlkOTExNWFhYQ&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=647e31865fe72d0f3a62f592dca01022"><meta property="og:description" content="linq.jsやZeroFormatterなどステッキーなライブラリを作っているneuecc先生の新作JSONシリアライザーのUtf8Jsonを試してみました。

Utf8Json - Fast JSON Serializer for..."><meta content="https://qiita.com/koshian2/items/c7e0fe65a27326edf8d0" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#,JSON,ビッグデータ,Jil,Utf8Json" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 1nzh4zz 38fzdi helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-1nzh4zz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:16px 32px;background-color:#FBE69E;color:rgba(0,0,0,0.87);line-height:1.5;font-weight:600;}@media (max-width:770px){.css-1nzh4zz{padding:16px;}}.css-38fzdi{color:#CA832A;margin-right:4px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-229c7977-bda0-4ace-99be-10f897ac9711"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Fkoshian2%2Fitems%2Fc7e0fe65a27326edf8d0">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Fkoshian2%2Fitems%2Fc7e0fe65a27326edf8d0">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-229c7977-bda0-4ace-99be-10f897ac9711">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2018-01-27T17:01:37.000+09:00","dateModified":"2018-02-02T04:57:58.000+09:00","headline":"ギガバイトクラスのJSONをデシリアライズするのにUtf8Jsonを使ってみる","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND00NEt1NDRLczQ0T1E0NEtrNDRPSTQ0S3Y0NE9wNDRLNTQ0R3VTbE5QVHVPQ2t1T0RoLU9DdC1PRHF1T0NvdU9EcWVPQ3BPT0N1dU9CbWVPQ2ktT0JydU9CcTFWMFpqaEtjMjl1NDRLUzVMMl80NEdqNDRHbTQ0R180NEtMJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NTQmdHh0LWNsaXA9ZWxsaXBzaXMmdHh0LWFsaWduPWNlbnRlciUyQ21pZGRsZSZzPWM2OWNlZGZkZjQ1OTRlNGRkNjMzNjk4MzgyZDYxYWFh\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RR3R2YzJocFlXNHkmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT00NSZ0eHQtYWxpZ249cmlnaHQlMkNib3R0b20mcz03ODE4YmRmMzdhNTRkOWNiMzBlZGM5NDlkOTExNWFhYQ\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=647e31865fe72d0f3a62f592dca01022","mainEntityOfPage":"https://qiita.com/koshian2/items/c7e0fe65a27326edf8d0","author":{"@type":"Person","address":"","email":null,"identifier":"koshian2","name":"koshian2","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fs3-ap-northeast-1.amazonaws.com%2Fqiita-image-store%2F0%2F232088%2Fbfc82ef2b35f67a9938d0c0b8e47b7f8b31cfd0f%2Fx_large.png%3F1601448873?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=1bb883886dc4d0acc43421d9cae720cb","url":"https://qiita.com/koshian2","description":"C#使ってましたがPythonに浮気してます。IoTでビッグデータをディープラーニングする闇の魔術の趣味をはじめました。 \r\n新刊通販（NumPy本）　https://koshian2.booth.pm/items/2462894  \r\n通販（GAN本）　https://koshian2.booth.pm/items/1835219  \r\n","memberOf":[]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://increments.connpass.com/event/211948/">Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催</a><a target="_blank" id="header_text_message_2" href="https://increments.connpass.com/event/211948/">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"koshian2","type":"items","id":"c7e0fe65a27326edf8d0"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"koshian2","type":"items","id":"c7e0fe65a27326edf8d0"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_1","message":"Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"koshian2","type":"items","id":"c7e0fe65a27326edf8d0"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":1,"pos_id":"header_text_message_2","message":"Qiita創業者海野氏登壇！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/koshian2/items/c7e0fe65a27326edf8d0","location":"/koshian2/items/c7e0fe65a27326edf8d0","scheme":"https","host":"qiita.com","port":null,"pathname":"/koshian2/items/c7e0fe65a27326edf8d0","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"RpJlYTwmhxhVEr2Q8/vsseYhVbfp0oRuvufdjloKVAEm8Qy2JCroEIVE3syJIc58hSsoSr7fq09GleutWV3UvQ==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-87ed1b38-ceee-424d-af35-f528496b8001"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/koshian2/items/c7e0fe65a27326edf8d0/likers" class="css-1iupg5d">53</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">39</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/c7e0fe65a27326edf8d0/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/koshian2/items/c7e0fe65a27326edf8d0/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/koshian2/items/c7e0fe65a27326edf8d0/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/koshian2/items/c7e0fe65a27326edf8d0/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/koshian2/items/c7e0fe65a27326edf8d0.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-1nzh4zz"><span class="fa fa-fw fa-warning css-38fzdi"></span><p>More than 3 years have passed since last update.</p></div><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/koshian2"><img class="css-100alwu eyfquo10" src="https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/232088/bfc82ef2b35f67a9938d0c0b8e47b7f8b31cfd0f/x_large.png?1601448873" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/koshian2" class="css-10ougpm">@<!-- -->koshian2</a><div class="css-1ay9vb9"><span><meta content="2018-01-27T08:01:37Z"/><time dateTime="2018-02-01T19:57:58Z" class="css-m19uds">updated at 2018-02-01</time></span></div></div></div></div></div><h1 class="css-cgzq40">ギガバイトクラスのJSONをデシリアライズするのにUtf8Jsonを使ってみる</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/json" class="css-4czcte">JSON</a><a href="/tags/%e3%83%93%e3%83%83%e3%82%b0%e3%83%87%e3%83%bc%e3%82%bf" class="css-4czcte">ビッグデータ</a><a href="/tags/jil" class="css-4czcte">Jil</a><a href="/tags/utf8json" class="css-4czcte">Utf8Json</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div><p>linq.jsやZeroFormatterなどステッキーなライブラリを作っているneuecc先生の新作JSONシリアライザーのUtf8Jsonを試してみました。</p>

<p><strong>Utf8Json - Fast JSON Serializer for C#</strong><br>
<a href="https://github.com/neuecc/Utf8Json" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/neuecc/Utf8Json</a></p>

<p>”Definitely Fastest”（明らかに最速）とのことなので、最速の恩恵を受けそうな例で実践します。拙作で恐縮ですが、<a href="https://qiita.com/koshian2/items/872e2ee601be2bce7b9c" id="reference-15ab12879390dbbf2a77">C#で仮想通貨取引所のリアルタイムレートを記録するプログラムを作ってみた</a>を1週間実行したところ、合計1GBを軽く超えるJSONファイルが生成できました。それをデシリアライズするプログラムを作ります。そして、既存のJSONシリアライザーとの比較を行います。</p>

<p>環境：VisualStudio2017 Community / .NET 4.6.0</p>

<p>ライブラリのバージョン</p>

<ul>
<li>DataContractJsonSerializer : System.Runtime.Serialization 4.0.0.0</li>
<li>Json.NET : v10.0.3 (2017/6/8)</li>
<li>ServiceStack.Text : v5.0.2 (2018/1/2)</li>
<li>Jil : v2.15.4 (2017/8/24)</li>
<li>DynamicJson : v1.2.0 (2011/9/22)</li>
<li>Utf8Json : v1.3.6.1 (2018/1/23)</li>
</ul>

<p>関連記事：<br>
.NETのJSONシリアライザの速度比較<br>
<a href="https://qiita.com/t_takahari/items/6855dfe78071bb5eaef6" class="autolink" id="reference-ed62c4af18a5ac9adb50">https://qiita.com/t_takahari/items/6855dfe78071bb5eaef6</a></p>

<h2>
<span id="対象データ" class="fragment"></span><a href="#%E5%AF%BE%E8%B1%A1%E3%83%87%E3%83%BC%E3%82%BF"><i class="fa fa-link"></i></a>対象データ</h2>

<p>仮想通貨取引所のストリーミングAPIから配信される、ビットコイン円（btc-jpy）の取引（板情報＋トランザクションデータ）。おおよそ1秒に1回～2回以下のようなJSONが送られてきます。<a href="http://jsonviewer.codeplex.com/" rel="nofollow noopener" target="_blank">JSON Viewer</a>で見ると、次のような構造であることがわかります。<br>
<a href="https://camo.qiitausercontent.com/8668e2fb2f64456c4ae9bbd6bd653087e232c923/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3233323038382f36353537336562652d333937652d343036642d386363342d3030343365616433313533662e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F232088%2F65573ebe-397e-406d-8cc4-0043ead3153f.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=03c5052032ae77189a030df245b5c974" alt="utf8json1.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/232088/65573ebe-397e-406d-8cc4-0043ead3153f.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F232088%2F65573ebe-397e-406d-8cc4-0043ead3153f.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=b2012c0fa69145afdc25b29fc4324e41 1x" loading="lazy"></a><br>
1つのJSONを1つのテキストファイルとして保存します。1つのテキストファイルはおよそ4KBです。</p>

<p>last_price.priceとtimestampを抽出するプログラムを作ります。これらのテキストファイルは一定時間（設定では1分、5分）で1つのZipアーカイブに保存されています。途中でこの設定値変えてしまったので1日あたりのアーカイブ数はいい加減です。<strong>1/18～1/23の6日分</strong>のデータ用意します。エクスプローラーで見ると次のようになります。<br>
<a href="https://camo.qiitausercontent.com/6fc332ce2562971f722a00ccaabd4293422ab0fa/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3233323038382f39303238363564372d646434352d656432312d393635392d3762623365636136316535362e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F232088%2F902865d7-dd45-ed21-9659-7bb3eca61e56.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=44ff93e333cc83c186ce5807c4eff809" alt="utf8json2.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/232088/902865d7-dd45-ed21-9659-7bb3eca61e56.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F232088%2F902865d7-dd45-ed21-9659-7bb3eca61e56.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=f7e40e1cb0f1e9180eae506ad12b8b81 1x" loading="lazy"></a></p>

<p>Zipをすべて展開たところ、次のようになりました。<br>
<a href="https://camo.qiitausercontent.com/1a962ea8578c42336d5e7ac952fa54274d38bac7/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3233323038382f37646535373638352d303438392d366239352d373430652d6564326565643532353466342e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F232088%2F7de57685-0489-6b95-740e-ed2eed5254f4.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=4be0b210bc3001144373a64b7627af88" alt="utf8json3.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/232088/7de57685-0489-6b95-740e-ed2eed5254f4.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F232088%2F7de57685-0489-6b95-740e-ed2eed5254f4.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=1a500faa59ff5014e3fca243f10735f5 1x" loading="lazy"></a></p>

<p>35.5万個のJSONが無圧縮で1.43GB（ディスク上は2.70GB）です。32bitプロセスのメモリ制限があるので、まずこれをList&lt;string&gt;としてすべてメモリに落とし込んでみます</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">Zip→txtList</span></div>
<div class="highlight"><pre class="with-code"><code>        <span class="kt">var</span> <span class="n">txtList</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;();</span>

        <span class="kt">var</span> <span class="n">zips</span> <span class="p">=</span> <span class="n">Enumerable</span><span class="p">.</span><span class="nf">Range</span><span class="p">(</span><span class="m">18</span><span class="p">,</span> <span class="m">6</span><span class="p">).</span><span class="nf">Select</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="s">"btc_jpy\\2018\\201801"</span> <span class="p">+</span> <span class="n">x</span><span class="p">)</span>
            <span class="p">.</span><span class="nf">SelectMany</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">Directory</span><span class="p">.</span><span class="nf">GetFileSystemEntries</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s">"*.zip"</span><span class="p">,</span> <span class="n">SearchOption</span><span class="p">.</span><span class="n">AllDirectories</span><span class="p">));</span>
        <span class="kt">var</span> <span class="n">sw</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Stopwatch</span><span class="p">();</span>
        <span class="n">sw</span><span class="p">.</span><span class="nf">Start</span><span class="p">();</span>
        <span class="k">foreach</span><span class="p">(</span><span class="kt">var</span> <span class="n">z</span> <span class="k">in</span> <span class="n">zips</span><span class="p">)</span>
        <span class="p">{</span>

            <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">archive</span> <span class="p">=</span> <span class="n">ZipFile</span><span class="p">.</span><span class="nf">OpenRead</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">entry</span> <span class="k">in</span> <span class="n">archive</span><span class="p">.</span><span class="n">Entries</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">sr</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StreamReader</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="nf">Open</span><span class="p">()))</span>
                    <span class="p">{</span>
                        <span class="n">txtList</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">sr</span><span class="p">.</span><span class="nf">ReadToEnd</span><span class="p">());</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="n">sw</span><span class="p">.</span><span class="nf">Stop</span><span class="p">();</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Zip load : "</span> <span class="p">+</span> <span class="n">sw</span><span class="p">.</span><span class="n">Elapsed</span><span class="p">);</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Memory : "</span> <span class="p">+</span> <span class="n">Environment</span><span class="p">.</span><span class="n">WorkingSet</span><span class="p">.</span><span class="nf">ToString</span><span class="p">(</span><span class="s">"N0"</span><span class="p">)</span> <span class="p">+</span> <span class="s">"bytes"</span><span class="p">);</span>
</code></pre></div>
</div>

<p>展開後のtxtファイルではなく、展開前のZipから直接読ませていますが、こっちのほうが速いからです（後述）。実行結果は次のようになります。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>Zip load : 00:00:49.7493200
Memory : 3,179,085,824bytes
</code></pre></div></div>

<p>メモリ使用量は3.0GBです。<strong>6日ではなく、7日分読み込ませると「System.OutOfMemoryException」が出ます</strong>。なので、これが32bitプロセスの限界とみなしてもよいと思います。64bitでビルドすればほぼ際限なくいけますが、JSONデシリアライズのパフォーマンスを図るには32bitのMAXで十分でしょう。たかだか1～2GBでビッグデータと言い張る気は毛頭ないですが、ビッグデータに片足の親指の爪先ぐらい突っ込んだぐらいのサイズはあります。</p>

<p>また、一気にtxtListに読み込ませるのではなく、Zipアーカイブ単位で読み込ませ、その都度デシリアライズしていくと（実践的にはこちらを使います）、メモリ効率はいいですが、Zipの展開やファイルの読み込みにかかる処理時間と、JSONをパースするのにかかる処理時間を切り離しできなくなるので、ここでは一気にメモリを読ませる方法を使います。<br>
txtListから読み込ませても、正確には、txtListから文字列を読み込ませる処理時間を切り離していないのですが、同じメモリ内での操作なので無視できるぐらい小さいとします。</p>

<p>Zip→txtListではなく、Zip→Txt→txtListと読み込ませると、Zip→Txtの処理を事前に行っておいてもZip→txtListの場合より遅くなります。試してみます。decompressフォルダにはbtc_jpyフォルダ以下のZipアーカイブがそのままの形で展開されているものとします。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">Txt→txtList</span></div>
<div class="highlight"><pre class="with-code"><code>        <span class="kt">var</span> <span class="n">txtList</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;();</span>

        <span class="kt">var</span> <span class="n">sw</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Stopwatch</span><span class="p">();</span>
        <span class="kt">var</span> <span class="n">dirs</span> <span class="p">=</span> <span class="n">Enumerable</span><span class="p">.</span><span class="nf">Range</span><span class="p">(</span><span class="m">18</span><span class="p">,</span> <span class="m">6</span><span class="p">).</span><span class="nf">Select</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="s">"decompress\\2018\\201801"</span> <span class="p">+</span> <span class="n">x</span><span class="p">);</span>

        <span class="n">sw</span><span class="p">.</span><span class="nf">Start</span><span class="p">();</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">d</span> <span class="k">in</span> <span class="n">dirs</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">foreach</span><span class="p">(</span><span class="kt">var</span> <span class="n">txt</span> <span class="k">in</span> <span class="n">Directory</span><span class="p">.</span><span class="nf">GetFileSystemEntries</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="s">"*.txt"</span><span class="p">,</span> <span class="n">SearchOption</span><span class="p">.</span><span class="n">AllDirectories</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="k">using</span><span class="p">(</span><span class="kt">var</span> <span class="n">fs</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StreamReader</span><span class="p">(</span><span class="n">txt</span><span class="p">))</span>
                <span class="n">txtList</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">fs</span><span class="p">.</span><span class="nf">ReadToEnd</span><span class="p">());</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="n">sw</span><span class="p">.</span><span class="nf">Stop</span><span class="p">();</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Text load : "</span> <span class="p">+</span> <span class="n">sw</span><span class="p">.</span><span class="n">Elapsed</span><span class="p">);</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Memory : "</span> <span class="p">+</span> <span class="n">Environment</span><span class="p">.</span><span class="n">WorkingSet</span><span class="p">.</span><span class="nf">ToString</span><span class="p">(</span><span class="s">"N0"</span><span class="p">)</span> <span class="p">+</span> <span class="s">"bytes"</span><span class="p">);</span>
</code></pre></div>
</div>

<p>50秒対26分で、明らかに遅いです。CPUパワーは全然使わないんですけどね。ファイルのオーバーヘッドぱない。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>Text load : 00:26:46.2992704
Memory : 3,190,595,584bytes
</code></pre></div></div>

<p>とりあえずZipを使いましたが、この手の使い方をする場合、圧縮はパワー要しても解凍が軽いタイプの圧縮アルゴリズムを選ぶとよさそうな気がします。</p>

<h2>
<span id="jsonシリアライザー一覧" class="fragment"></span><a href="#json%E3%82%B7%E3%83%AA%E3%82%A2%E3%83%A9%E3%82%A4%E3%82%B6%E3%83%BC%E4%B8%80%E8%A6%A7"><i class="fa fa-link"></i></a>JSONシリアライザー一覧</h2>

<p>以下のJSONシリアライザーを比較します。</p>

<ol>
<li>
<a href="https://msdn.microsoft.com/ja-jp/library/system.runtime.serialization.json.datacontractjsonserializer(v=vs.110).aspx" rel="nofollow noopener" target="_blank">DataContractJsonSerializer</a>（.NET標準）</li>
<li>
<a href="https://www.newtonsoft.com/json" rel="nofollow noopener" target="_blank">Json.NET</a>（MIT）</li>
<li>
<a href="https://github.com/ServiceStack/ServiceStack.Text" rel="nofollow noopener" target="_blank">ServiceStack.Text</a>（<a href="https://github.com/ServiceStack/ServiceStack.Text/blob/master/license.txt" rel="nofollow noopener" target="_blank">AGPLv3 FOSS License Exception</a>）</li>
<li>
<a href="https://github.com/kevin-montrose/Jil" rel="nofollow noopener" target="_blank">Jil</a>（MIT）</li>
<li>
<a href="http://dynamicjson.codeplex.com" rel="nofollow noopener" target="_blank">DynamicJSON</a>（Utf8Jsonと作者同じ / <a href="http://dynamicjson.codeplex.com/license" rel="nofollow noopener" target="_blank">Ms-PL</a>）</li>
<li>
<a href="https://github.com/neuecc/Utf8Json" rel="nofollow noopener" target="_blank">Utf8Json</a>（New!! / MIT）</li>
</ol>

<p>1番目以外はdynamic型が使えるので、型を指定する場合、型を指定せずdynamicでデシリアライズする場合をそれぞれを見ます。<br>
dynamicの場合、型を指定する場合と同様の返し方をすると少し不公平なので（キャストが多い分当然遅くなる）、必要なtimestampとlast_price.priceのみに絞ってTupleで返すようにします。今回の例では、dynamicでデシリアライズする変数の数が、型を指定する場合とそこまで変わらないので、基本的に型を指定したほうが速いです。ただし、文字と数字が混在した配列など不定形なJSONをデシリアライズする場合は、dynamicを使ったほうが都合がいいことがあるので、必要に応じて使い分けるのがいいかと思います。</p>

<p>型を指定する場合のクラスをDataとして次のようにします。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">Data.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">Data</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="n">LastPrice</span> <span class="n">last_price</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">timestamp</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">LastPrice</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">action</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">double</span> <span class="n">price</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>ライブラリの数が多いので、ライブラリごとに型を指定する場合、dynamicの場合とラッパーメソッドを作ります（普段はこんなことしなくていいです）。</p>

<h3>
<span id="1datacontractjsonserializer" class="fragment"></span><a href="#1datacontractjsonserializer"><i class="fa fa-link"></i></a>1.DataContractJsonSerializer</h3>

<p>typeofで指定してStreamからしか読めないというのはちょっとなーという感</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">System.IO</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Runtime.Serialization.Json</span><span class="p">;</span>

<span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">DataContractJsonSerialize</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">Data</span> <span class="nf">Deserialize</span><span class="p">(</span><span class="kt">string</span> <span class="n">jsonStr</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">serializer</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">DataContractJsonSerializer</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">Data</span><span class="p">));</span>
        <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">ms</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MemoryStream</span><span class="p">(</span><span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="n">jsonStr</span><span class="p">)))</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">Data</span><span class="p">)</span><span class="n">serializer</span><span class="p">.</span><span class="nf">ReadObject</span><span class="p">(</span><span class="n">ms</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3>
<span id="2jsonnet" class="fragment"></span><a href="#2jsonnet"><i class="fa fa-link"></i></a>2.Json.NET</h3>

<p>一番有名なライブラリ。dynamicの場合が面白い書き方</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">Newtonsoft.Json</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Newtonsoft.Json.Linq</span><span class="p">;</span>

<span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">JsonNet</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">Data</span> <span class="nf">Deserialize</span><span class="p">(</span><span class="kt">string</span> <span class="n">jsonStr</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">JsonConvert</span><span class="p">.</span><span class="n">DeserializeObject</span><span class="p">&lt;</span><span class="n">Data</span><span class="p">&gt;(</span><span class="n">jsonStr</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">static</span> <span class="p">(</span><span class="kt">string</span><span class="p">,</span> <span class="kt">double</span><span class="p">)</span> <span class="nf">DeserializeDynamic</span><span class="p">(</span><span class="kt">string</span> <span class="n">jsonStr</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">dynamic</span> <span class="n">dyn</span> <span class="p">=</span> <span class="n">JObject</span><span class="p">.</span><span class="nf">Parse</span><span class="p">(</span><span class="n">jsonStr</span><span class="p">);</span><span class="c1">//Newtonsoft.Json.Linq</span>
        <span class="k">return</span> <span class="p">((</span><span class="kt">string</span><span class="p">)</span><span class="n">dyn</span><span class="p">.</span><span class="n">timestamp</span><span class="p">,</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">dyn</span><span class="p">.</span><span class="n">last_price</span><span class="p">.</span><span class="n">price</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3>
<span id="3servicestacktext" class="fragment"></span><a href="#3servicestacktext"><i class="fa fa-link"></i></a>3.ServiceStack.Text</h3>

<p>dynamicの場合、内部で文字列になるのが少しトリッキー。(double)とかキャストすると例外になる。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">ServiceStack</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">ServiceStack.Text</span><span class="p">;</span>

<span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">ServiceStackJson</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">Data</span> <span class="nf">Deserialize</span><span class="p">(</span><span class="kt">string</span> <span class="n">jsonStr</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">JsonSerializer</span><span class="p">.</span><span class="n">DeserializeFromString</span><span class="p">&lt;</span><span class="n">Data</span><span class="p">&gt;(</span><span class="n">jsonStr</span><span class="p">);</span><span class="c1">//ServiceStack.Text.JsonSerializer</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">static</span> <span class="p">(</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">)</span> <span class="nf">DeserializeDynamic</span><span class="p">(</span><span class="kt">string</span> <span class="n">jsonStr</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">dyn</span> <span class="p">=</span> <span class="n">DynamicJson</span><span class="p">.</span><span class="nf">Deserialize</span><span class="p">(</span><span class="n">jsonStr</span><span class="p">);</span><span class="c1">//ServiceStack.DynamicJson</span>
        <span class="k">return</span> <span class="p">((</span><span class="kt">string</span><span class="p">)</span><span class="n">dyn</span><span class="p">.</span><span class="n">timestamp</span><span class="p">,</span> <span class="p">(</span><span class="kt">string</span><span class="p">)</span><span class="n">dyn</span><span class="p">.</span><span class="n">last_price</span><span class="p">.</span><span class="n">price</span><span class="p">);</span><span class="c1">//小数でも文字列として記録される</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3>
<span id="4jil" class="fragment"></span><a href="#4jil"><i class="fa fa-link"></i></a>4.Jil</h3>

<p>直感的でわかりやすい</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">Jil</span><span class="p">;</span>

<span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">JilJson</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">Data</span> <span class="nf">Deserialize</span><span class="p">(</span><span class="kt">string</span> <span class="n">jsonStr</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">JSON</span><span class="p">.</span><span class="n">Deserialize</span><span class="p">&lt;</span><span class="n">Data</span><span class="p">&gt;(</span><span class="n">jsonStr</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">static</span> <span class="p">(</span><span class="kt">string</span><span class="p">,</span> <span class="kt">double</span><span class="p">)</span> <span class="nf">DeserializeDynamic</span><span class="p">(</span><span class="kt">string</span> <span class="n">jsonStr</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">dyn</span> <span class="p">=</span> <span class="n">JSON</span><span class="p">.</span><span class="nf">DeserializeDynamic</span><span class="p">(</span><span class="n">jsonStr</span><span class="p">);</span>
        <span class="k">return</span> <span class="p">((</span><span class="kt">string</span><span class="p">)</span><span class="n">dyn</span><span class="p">.</span><span class="n">timestamp</span><span class="p">,</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">dyn</span><span class="p">.</span><span class="n">last_price</span><span class="p">.</span><span class="n">price</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3>
<span id="5dynamicjson" class="fragment"></span><a href="#5dynamicjson"><i class="fa fa-link"></i></a>5.DynamicJSON</h3>

<p>"Dynamic"JSONなので、型指定の場合はdynamicの変数をキャストしてデシリアライズするというピーキーな仕様。プロジェクトにDynamicJSON.csが追加されるのが特徴。個人的には昔だいぶお世話になりました。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">Codeplex.Data</span><span class="p">;</span>

<span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">DynamicJsonDeserialize</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">Data</span> <span class="nf">Deserialize</span><span class="p">(</span><span class="kt">string</span> <span class="n">jsonStr</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">Data</span><span class="p">)</span><span class="n">DynamicJson</span><span class="p">.</span><span class="nf">Parse</span><span class="p">(</span><span class="n">jsonStr</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">static</span> <span class="p">(</span><span class="kt">string</span><span class="p">,</span> <span class="kt">double</span><span class="p">)</span> <span class="nf">DeserializeDynamic</span><span class="p">(</span><span class="kt">string</span> <span class="n">jsonStr</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">dyn</span> <span class="p">=</span> <span class="n">DynamicJson</span><span class="p">.</span><span class="nf">Parse</span><span class="p">(</span><span class="n">jsonStr</span><span class="p">);</span>
        <span class="k">return</span> <span class="p">((</span><span class="kt">string</span><span class="p">)</span><span class="n">dyn</span><span class="p">.</span><span class="n">timestamp</span><span class="p">,</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">dyn</span><span class="p">.</span><span class="n">last_price</span><span class="p">.</span><span class="n">price</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3>
<span id="6utf8json" class="fragment"></span><a href="#6utf8json"><i class="fa fa-link"></i></a>6.Utf8Json</h3>

<p>dynamicの場合はインデクサを使います（.変数名は例外発生）。今後のアップデートで変わるかもしれません。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">using</span> <span class="nn">Utf8Json</span><span class="p">;</span>

<span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">Utf8Json</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">Data</span> <span class="nf">Deserialize</span><span class="p">(</span><span class="kt">string</span> <span class="n">strJson</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">JsonSerializer</span><span class="p">.</span><span class="n">Deserialize</span><span class="p">&lt;</span><span class="n">Data</span><span class="p">&gt;(</span><span class="n">strJson</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">static</span> <span class="p">(</span><span class="kt">string</span><span class="p">,</span> <span class="kt">double</span><span class="p">)</span> <span class="nf">DeserializeDynamic</span><span class="p">(</span><span class="kt">string</span> <span class="n">strJson</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">dyn</span> <span class="p">=</span> <span class="n">JsonSerializer</span><span class="p">.</span><span class="n">Deserialize</span><span class="p">&lt;</span><span class="kt">dynamic</span><span class="p">&gt;(</span><span class="n">strJson</span><span class="p">);</span>
        <span class="k">return</span> <span class="p">((</span><span class="kt">string</span><span class="p">)</span><span class="n">dyn</span><span class="p">[</span><span class="s">"timestamp"</span><span class="p">],</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">dyn</span><span class="p">[</span><span class="s">"last_price"</span><span class="p">][</span><span class="s">"price"</span><span class="p">]);</span><span class="c1">//インデクサを使う</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2>
<span id="デシリアライズ時間の比較" class="fragment"></span><a href="#%E3%83%87%E3%82%B7%E3%83%AA%E3%82%A2%E3%83%A9%E3%82%A4%E3%82%BA%E6%99%82%E9%96%93%E3%81%AE%E6%AF%94%E8%BC%83"><i class="fa fa-link"></i></a>デシリアライズ時間の比較</h2>

<h3>
<span id="1逐次処理" class="fragment"></span><a href="#1%E9%80%90%E6%AC%A1%E5%87%A6%E7%90%86"><i class="fa fa-link"></i></a>1.逐次処理</h3>

<p>以下のコードで比較します。Zip→txtListの続きからです。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code>        <span class="c1">//DataContractJsonSerializer</span>
        <span class="n">sw</span><span class="p">.</span><span class="nf">Restart</span><span class="p">();</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">str</span> <span class="k">in</span> <span class="n">txtList</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">DataContractJsonSerialize</span><span class="p">.</span><span class="nf">Deserialize</span><span class="p">(</span><span class="n">str</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">sw</span><span class="p">.</span><span class="nf">Stop</span><span class="p">();</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"DataContractJsonSerializer\t"</span> <span class="p">+</span> <span class="n">sw</span><span class="p">.</span><span class="n">Elapsed</span><span class="p">);</span>

        <span class="c1">//JsonNet</span>
        <span class="n">sw</span><span class="p">.</span><span class="nf">Restart</span><span class="p">();</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">str</span> <span class="k">in</span> <span class="n">txtList</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">JsonNet</span><span class="p">.</span><span class="nf">Deserialize</span><span class="p">(</span><span class="n">str</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">sw</span><span class="p">.</span><span class="nf">Stop</span><span class="p">();</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"JsonNet\t"</span> <span class="p">+</span> <span class="n">sw</span><span class="p">.</span><span class="n">Elapsed</span><span class="p">);</span>
        <span class="n">sw</span><span class="p">.</span><span class="nf">Restart</span><span class="p">();</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">str</span> <span class="k">in</span> <span class="n">txtList</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">JsonNet</span><span class="p">.</span><span class="nf">DeserializeDynamic</span><span class="p">(</span><span class="n">str</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">sw</span><span class="p">.</span><span class="nf">Stop</span><span class="p">();</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"JsonNet(dynamic)\t"</span> <span class="p">+</span> <span class="n">sw</span><span class="p">.</span><span class="n">Elapsed</span><span class="p">);</span>

        <span class="c1">//ServiceStack.Text</span>
        <span class="n">sw</span><span class="p">.</span><span class="nf">Restart</span><span class="p">();</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">str</span> <span class="k">in</span> <span class="n">txtList</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">ServiceStackJson</span><span class="p">.</span><span class="nf">Deserialize</span><span class="p">(</span><span class="n">str</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">sw</span><span class="p">.</span><span class="nf">Stop</span><span class="p">();</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"ServiceStack.Text\t"</span> <span class="p">+</span> <span class="n">sw</span><span class="p">.</span><span class="n">Elapsed</span><span class="p">);</span>
        <span class="n">sw</span><span class="p">.</span><span class="nf">Restart</span><span class="p">();</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">str</span> <span class="k">in</span> <span class="n">txtList</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">ServiceStackJson</span><span class="p">.</span><span class="nf">DeserializeDynamic</span><span class="p">(</span><span class="n">str</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">sw</span><span class="p">.</span><span class="nf">Stop</span><span class="p">();</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"ServiceStack.Text(dynamic)\t"</span> <span class="p">+</span> <span class="n">sw</span><span class="p">.</span><span class="n">Elapsed</span><span class="p">);</span>

        <span class="c1">//Jil</span>
        <span class="n">sw</span><span class="p">.</span><span class="nf">Restart</span><span class="p">();</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">str</span> <span class="k">in</span> <span class="n">txtList</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">JilJson</span><span class="p">.</span><span class="nf">Deserialize</span><span class="p">(</span><span class="n">str</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">sw</span><span class="p">.</span><span class="nf">Stop</span><span class="p">();</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Jil\t"</span> <span class="p">+</span> <span class="n">sw</span><span class="p">.</span><span class="n">Elapsed</span><span class="p">);</span>
        <span class="n">sw</span><span class="p">.</span><span class="nf">Restart</span><span class="p">();</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">str</span> <span class="k">in</span> <span class="n">txtList</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">JilJson</span><span class="p">.</span><span class="nf">DeserializeDynamic</span><span class="p">(</span><span class="n">str</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">sw</span><span class="p">.</span><span class="nf">Stop</span><span class="p">();</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Jil(dynamic)\t"</span> <span class="p">+</span> <span class="n">sw</span><span class="p">.</span><span class="n">Elapsed</span><span class="p">);</span>

        <span class="c1">//DynamicJSON</span>
        <span class="n">sw</span><span class="p">.</span><span class="nf">Restart</span><span class="p">();</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">str</span> <span class="k">in</span> <span class="n">txtList</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">DynamicJsonDeserialize</span><span class="p">.</span><span class="nf">Deserialize</span><span class="p">(</span><span class="n">str</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">sw</span><span class="p">.</span><span class="nf">Stop</span><span class="p">();</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"DynamicJSON\t"</span> <span class="p">+</span> <span class="n">sw</span><span class="p">.</span><span class="n">Elapsed</span><span class="p">);</span>
        <span class="n">sw</span><span class="p">.</span><span class="nf">Restart</span><span class="p">();</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">str</span> <span class="k">in</span> <span class="n">txtList</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">DynamicJsonDeserialize</span><span class="p">.</span><span class="nf">DeserializeDynamic</span><span class="p">(</span><span class="n">str</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">sw</span><span class="p">.</span><span class="nf">Stop</span><span class="p">();</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"DynamicJSON(dynamic)\t"</span> <span class="p">+</span> <span class="n">sw</span><span class="p">.</span><span class="n">Elapsed</span><span class="p">);</span>


        <span class="c1">//Utf8Json</span>
        <span class="n">sw</span><span class="p">.</span><span class="nf">Restart</span><span class="p">();</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">str</span> <span class="k">in</span> <span class="n">txtList</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Utf8Json</span><span class="p">.</span><span class="nf">Deserialize</span><span class="p">(</span><span class="n">str</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">sw</span><span class="p">.</span><span class="nf">Stop</span><span class="p">();</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Utf8Json\t"</span> <span class="p">+</span> <span class="n">sw</span><span class="p">.</span><span class="n">Elapsed</span><span class="p">);</span>
        <span class="n">sw</span><span class="p">.</span><span class="nf">Restart</span><span class="p">();</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">str</span> <span class="k">in</span> <span class="n">txtList</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Utf8Json</span><span class="p">.</span><span class="nf">DeserializeDynamic</span><span class="p">(</span><span class="n">str</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">sw</span><span class="p">.</span><span class="nf">Stop</span><span class="p">();</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Utf8Json(dynamic)\t"</span> <span class="p">+</span> <span class="n">sw</span><span class="p">.</span><span class="n">Elapsed</span><span class="p">);</span>
</code></pre></div></div>

<p>本当はtimestampとlast_priceを記録するはずでしたが、純粋にパフォーマンスを見たかったので端折っています。これを5回繰り返します。結果は次の通り。</p>

<table>
<thead>
<tr>
<th style="text-align: center">逐次処理</th>
<th style="text-align: center">1回目</th>
<th style="text-align: center">2回目</th>
<th style="text-align: center">3回目</th>
<th style="text-align: center">4回目</th>
<th style="text-align: center">5回目</th>
<th style="text-align: center">平均</th>
<th style="text-align: center">最大</th>
<th style="text-align: center">最小</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center">Zip load</td>
<td style="text-align: center">00:50.981</td>
<td style="text-align: center">00:50.870</td>
<td style="text-align: center">00:50.253</td>
<td style="text-align: center">00:50.896</td>
<td style="text-align: center">00:50.770</td>
<td style="text-align: center">00:50.754</td>
<td style="text-align: center">00:50.981</td>
<td style="text-align: center">00:50.253</td>
</tr>
<tr>
<td style="text-align: center"></td>
<td style="text-align: center"></td>
<td style="text-align: center"></td>
<td style="text-align: center"></td>
<td style="text-align: center"></td>
<td style="text-align: center"></td>
<td style="text-align: center"></td>
<td style="text-align: center"></td>
<td style="text-align: center"></td>
</tr>
<tr>
<td style="text-align: center">DataContractJsonSerializer</td>
<td style="text-align: center">01:13.843</td>
<td style="text-align: center">01:15.788</td>
<td style="text-align: center">01:13.863</td>
<td style="text-align: center">01:13.945</td>
<td style="text-align: center">01:12.715</td>
<td style="text-align: center">01:14.031</td>
<td style="text-align: center">01:15.788</td>
<td style="text-align: center">01:12.715</td>
</tr>
<tr>
<td style="text-align: center">JsonNet</td>
<td style="text-align: center">00:43.019</td>
<td style="text-align: center">00:43.401</td>
<td style="text-align: center">00:42.688</td>
<td style="text-align: center">00:43.640</td>
<td style="text-align: center">00:42.800</td>
<td style="text-align: center">00:43.110</td>
<td style="text-align: center">00:43.640</td>
<td style="text-align: center">00:42.688</td>
</tr>
<tr>
<td style="text-align: center">ServiceStack.Text</td>
<td style="text-align: center">00:06.125</td>
<td style="text-align: center">00:05.928</td>
<td style="text-align: center">00:05.883</td>
<td style="text-align: center">00:06.037</td>
<td style="text-align: center">00:05.946</td>
<td style="text-align: center">00:05.984</td>
<td style="text-align: center">00:06.125</td>
<td style="text-align: center">00:05.883</td>
</tr>
<tr>
<td style="text-align: center">Jil</td>
<td style="text-align: center">00:06.825</td>
<td style="text-align: center">00:06.749</td>
<td style="text-align: center">00:07.059</td>
<td style="text-align: center">00:06.951</td>
<td style="text-align: center">00:06.858</td>
<td style="text-align: center">00:06.888</td>
<td style="text-align: center">00:07.059</td>
<td style="text-align: center">00:06.749</td>
</tr>
<tr>
<td style="text-align: center">DynamicJSON</td>
<td style="text-align: center">02:21.014</td>
<td style="text-align: center">02:20.810</td>
<td style="text-align: center">02:21.179</td>
<td style="text-align: center">02:20.486</td>
<td style="text-align: center">02:17.193</td>
<td style="text-align: center">02:20.136</td>
<td style="text-align: center">02:21.179</td>
<td style="text-align: center">02:17.193</td>
</tr>
<tr>
<td style="text-align: center">Utf8Json</td>
<td style="text-align: center">00:13.312</td>
<td style="text-align: center">00:13.498</td>
<td style="text-align: center">00:13.459</td>
<td style="text-align: center">00:13.685</td>
<td style="text-align: center">00:14.240</td>
<td style="text-align: center">00:13.639</td>
<td style="text-align: center">00:14.240</td>
<td style="text-align: center">00:13.312</td>
</tr>
<tr>
<td style="text-align: center"></td>
<td style="text-align: center"></td>
<td style="text-align: center"></td>
<td style="text-align: center"></td>
<td style="text-align: center"></td>
<td style="text-align: center"></td>
<td style="text-align: center"></td>
<td style="text-align: center"></td>
<td style="text-align: center"></td>
</tr>
<tr>
<td style="text-align: center">JsonNet(dynamic)</td>
<td style="text-align: center">01:40.964</td>
<td style="text-align: center">01:41.524</td>
<td style="text-align: center">01:40.885</td>
<td style="text-align: center">01:41.389</td>
<td style="text-align: center">01:44.052</td>
<td style="text-align: center">01:41.763</td>
<td style="text-align: center">01:44.052</td>
<td style="text-align: center">01:40.885</td>
</tr>
<tr>
<td style="text-align: center">ServiceStack.Text(dynamic)</td>
<td style="text-align: center">00:15.938</td>
<td style="text-align: center">00:15.915</td>
<td style="text-align: center">00:15.838</td>
<td style="text-align: center">00:15.799</td>
<td style="text-align: center">00:15.865</td>
<td style="text-align: center">00:15.871</td>
<td style="text-align: center">00:15.938</td>
<td style="text-align: center">00:15.799</td>
</tr>
<tr>
<td style="text-align: center">Jil(dynamic)</td>
<td style="text-align: center">01:03.895</td>
<td style="text-align: center">01:03.903</td>
<td style="text-align: center">01:03.662</td>
<td style="text-align: center">01:05.012</td>
<td style="text-align: center">01:03.606</td>
<td style="text-align: center">01:04.016</td>
<td style="text-align: center">01:05.012</td>
<td style="text-align: center">01:03.606</td>
</tr>
<tr>
<td style="text-align: center">DynamicJSON(dynamic)</td>
<td style="text-align: center">02:14.418</td>
<td style="text-align: center">02:18.594</td>
<td style="text-align: center">02:18.907</td>
<td style="text-align: center">02:15.051</td>
<td style="text-align: center">02:16.810</td>
<td style="text-align: center">02:16.756</td>
<td style="text-align: center">02:18.907</td>
<td style="text-align: center">02:14.418</td>
</tr>
<tr>
<td style="text-align: center">Utf8Json(dynamic)</td>
<td style="text-align: center">00:53.832</td>
<td style="text-align: center">00:54.887</td>
<td style="text-align: center">00:54.959</td>
<td style="text-align: center">00:55.590</td>
<td style="text-align: center">00:53.505</td>
<td style="text-align: center">00:54.555</td>
<td style="text-align: center">00:55.590</td>
<td style="text-align: center">00:53.505</td>
</tr>
</tbody>
</table>

<p><strong>この例ではUtf8Jsonが最速にはなりませんでした</strong>。<strong>型を指定した場合、ServiceStackが6秒弱で最速</strong>、Jilも同じくらい速く7秒弱、そこから倍の6秒程度遅れてUtf8Jsonが13.6秒、そこから30秒程度とだいぶ遅れてJson.Netが43秒。.Net標準のDataContractJsonSerializerはJson.Netからさらに30秒程度遅れて1分14秒。DynamicJSONは一番遅く、2分オーバー。ただ、他のライブラリがdynamicでデシリアライズしたときに軒並み遅くなっているのに対し（おそらく全部のパラメーターを内部で一度パースしているのかと）、DynamicJSONはほぼ変わらないどころか、dynamicのほうが速いまでもあるので、型指定のクラス側で全部パースする場合はそこまで見劣りしないのかと思われます。<br>
比較用にZipの読み込み時間を置いておきましたが、<strong>JSONシリアライザーの選択によってZipの読み込み1倍～2倍分の処理時間の差が出ます</strong>。本当はZip部分を高速化したかったけどそれはまた別な投稿で。<br>
※追記：いろいろ試してみましたが、<a href="https://github.com/neuecc/MessagePack-CSharp" rel="nofollow noopener" target="_blank">MessagePack C#</a>を使うのが良さそうです。気力があれば書きます。</p>

<p>dynamicの場合はServiceStackの15秒以外はだいたい1分オーバー。かろうじてUtf8Jsonが55秒と1分割っているぐらいです。こう見るとServiceStack一強のように見えますが、ServiceStackの場合はdynamicの場合doubleが文字列で記録されているので、キャストに苦労するかもしれません。ServiceStackがdynamicの場合に明らかに速いのは、利便性を犠牲にして高速化しているからかもしれません。</p>

<p>この例の場合は<a href="https://social.msdn.microsoft.com/Forums/sqlserver/ja-JP/e6015eef-f4a0-45ae-bf26-e186d4c2435d?forum=netfxgeneralja" rel="nofollow noopener" target="_blank">Stringの内部エンコードがUTF-16である</a>ため、Stringのまま読み込ませているとUTF-8へ余計なエンコード変換が入るのがUtf8Jsonにとっていけないのかもしれません。そこでUtf8Jsonの場合のみ、stringではなくbyte[]を読ませるように改良してみます。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">Byte[]で記録</span></div>
<div class="highlight"><pre class="with-code"><code>        <span class="kt">var</span> <span class="n">byteList</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">byte</span><span class="p">[</span><span class="k">]&gt;</span><span class="p">();</span>
        <span class="kt">var</span> <span class="n">sw</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Stopwatch</span><span class="p">();</span>
        <span class="n">sw</span><span class="p">.</span><span class="nf">Start</span><span class="p">();</span>
        <span class="k">foreach</span><span class="p">(</span><span class="kt">var</span> <span class="n">z</span> <span class="k">in</span> <span class="n">zips</span><span class="p">)</span>
        <span class="p">{</span>

            <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">archive</span> <span class="p">=</span> <span class="n">ZipFile</span><span class="p">.</span><span class="nf">OpenRead</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">entry</span> <span class="k">in</span> <span class="n">archive</span><span class="p">.</span><span class="n">Entries</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">sr</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StreamReader</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="nf">Open</span><span class="p">()))</span>
                    <span class="p">{</span>
                        <span class="c1">//txtList.Add(sr.ReadToEnd());</span>
                        <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">ms</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MemoryStream</span><span class="p">())</span>
                        <span class="p">{</span>
                            <span class="n">sr</span><span class="p">.</span><span class="n">BaseStream</span><span class="p">.</span><span class="nf">CopyTo</span><span class="p">(</span><span class="n">ms</span><span class="p">);</span>
                            <span class="n">byteList</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">ms</span><span class="p">.</span><span class="nf">ToArray</span><span class="p">());</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="n">sw</span><span class="p">.</span><span class="nf">Stop</span><span class="p">();</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Zip load\t"</span> <span class="p">+</span> <span class="n">sw</span><span class="p">.</span><span class="n">Elapsed</span><span class="p">);</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Memory : "</span> <span class="p">+</span> <span class="n">Environment</span><span class="p">.</span><span class="n">WorkingSet</span><span class="p">.</span><span class="nf">ToString</span><span class="p">(</span><span class="s">"N0"</span><span class="p">)</span> <span class="p">+</span> <span class="s">"bytes"</span><span class="p">);</span>

        <span class="n">sw</span><span class="p">.</span><span class="nf">Restart</span><span class="p">();</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">bytes</span> <span class="k">in</span> <span class="n">byteList</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">x</span> <span class="p">=</span> <span class="n">Utf8Json</span><span class="p">.</span><span class="nf">DeserializeBytes</span><span class="p">(</span><span class="n">bytes</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">sw</span><span class="p">.</span><span class="nf">Stop</span><span class="p">();</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Utf8Json(Bytes)\t"</span> <span class="p">+</span> <span class="n">sw</span><span class="p">.</span><span class="n">Elapsed</span><span class="p">);</span>
</code></pre></div>
</div>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">Utf8Json</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">Data</span> <span class="nf">DeserializeBytes</span><span class="p">(</span><span class="kt">byte</span><span class="p">[]</span> <span class="n">byteJson</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">JsonSerializer</span><span class="p">.</span><span class="n">Deserialize</span><span class="p">&lt;</span><span class="n">Data</span><span class="p">&gt;(</span><span class="n">byteJson</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>これを3回ほど実行してみました。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>Zip load        00:00:37.8030819
Memory : 1,605,480,448bytes
Utf8Json(Bytes) 00:00:08.7113992

Zip load        00:00:37.7465432
Memory : 1,606,115,328bytes
Utf8Json(Bytes) 00:00:08.6711459

Zip load        00:00:38.4523601
Memory : 1,606,238,208bytes
Utf8Json(Bytes) 00:00:08.7258462
</code></pre></div></div>

<p>キャッシュ方式をstring→byte[]に変えたところ、<strong>Zipの展開時間が50秒→38秒と12秒ほど短縮され（24%減）、メモリ使用量が3.19Gbytes→1.61Gbytesと半分になり、Utf8Jsonのデシリアライズ時間が13.6秒→8.7秒と5秒ほど短縮され（36%減）ました</strong>。これでもまだ、stringの場合のServiceStackとJilのケースを抜くことができなかったのですが、特にメモリ減少の効果が大きそうです。JSONだとUTF-16までエンコードを拡大するメリットが無い（JSONの規則上エスケープされる）ので、<strong>UTF-8 byte[]で読み込んでしまうという作戦はかなり有用かも</strong>しれません。<br>
ちなみにJilもServiceStackもTextReaderやStreamを引数として渡すことはできるものの、byte[]を直接渡すことができるのはざっと見たところUtf8Jsonだけでした。細かいチューニングを気にする場合、トータルで見たときにUtf8Jsonが優位に立てる可能性は十分にあります。</p>

<h3>
<span id="2並列処理" class="fragment"></span><a href="#2%E4%B8%A6%E5%88%97%E5%87%A6%E7%90%86"><i class="fa fa-link"></i></a>2.並列処理</h3>

<p>1.のstringの例を並列化してみます。Parallel.ForEachを使うだけです。ただし、並列化する場合は読み込む順番の保証がされなくなるので、結果が時系列で欲しい場合は最終的にソートする、スレッドセーフなコレクションを使って記録するなどの工夫が必要になります。Utf8Jsonの場合はこうします（他も同様なので省略します）。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">並列処理</span></div>
<div class="highlight"><pre class="with-code"><code>        <span class="kt">var</span> <span class="n">option</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ParallelOptions</span> <span class="p">{</span> <span class="n">MaxDegreeOfParallelism</span> <span class="p">=</span> <span class="m">4</span> <span class="p">};</span>
        <span class="n">Parallel</span><span class="p">.</span><span class="nf">ForEach</span><span class="p">(</span><span class="n">txtList</span><span class="p">,</span> <span class="n">option</span><span class="p">,</span> <span class="n">str</span> <span class="p">=&gt;</span>
        <span class="p">{</span>
            <span class="n">Utf8Json</span><span class="p">.</span><span class="nf">Deserialize</span><span class="p">(</span><span class="n">str</span><span class="p">);</span>
        <span class="p">});</span>
</code></pre></div>
</div>

<p>MaxDegreeOfParallelismを指定しないときりがなく並列していって死ぬので、スレッド数は4に制限しました。結果は次のようになりました。</p>

<table>
<thead>
<tr>
<th style="text-align: center">並列処理</th>
<th style="text-align: center">1回目</th>
<th style="text-align: center">2回目</th>
<th style="text-align: center">3回目</th>
<th style="text-align: center">4回目</th>
<th style="text-align: center">5回目</th>
<th style="text-align: center">平均</th>
<th style="text-align: center">最大</th>
<th style="text-align: center">最小</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center">DataContractJsonSerializer</td>
<td style="text-align: center">00:28.103</td>
<td style="text-align: center">00:26.502</td>
<td style="text-align: center">00:27.138</td>
<td style="text-align: center">00:28.102</td>
<td style="text-align: center">00:27.326</td>
<td style="text-align: center">00:27.434</td>
<td style="text-align: center">00:28.103</td>
<td style="text-align: center">00:26.502</td>
</tr>
<tr>
<td style="text-align: center">JsonNet</td>
<td style="text-align: center">00:15.382</td>
<td style="text-align: center">00:15.428</td>
<td style="text-align: center">00:15.336</td>
<td style="text-align: center">00:16.527</td>
<td style="text-align: center">00:16.030</td>
<td style="text-align: center">00:15.741</td>
<td style="text-align: center">00:16.527</td>
<td style="text-align: center">00:15.336</td>
</tr>
<tr>
<td style="text-align: center">ServiceStack.Text</td>
<td style="text-align: center">00:02.466</td>
<td style="text-align: center">00:02.779</td>
<td style="text-align: center">00:02.317</td>
<td style="text-align: center">00:02.115</td>
<td style="text-align: center">00:02.460</td>
<td style="text-align: center">00:02.427</td>
<td style="text-align: center">00:02.779</td>
<td style="text-align: center">00:02.115</td>
</tr>
<tr>
<td style="text-align: center">Jil</td>
<td style="text-align: center">00:02.474</td>
<td style="text-align: center">00:02.395</td>
<td style="text-align: center">00:02.661</td>
<td style="text-align: center">00:02.825</td>
<td style="text-align: center">00:02.686</td>
<td style="text-align: center">00:02.608</td>
<td style="text-align: center">00:02.825</td>
<td style="text-align: center">00:02.395</td>
</tr>
<tr>
<td style="text-align: center">DynamicJSON</td>
<td style="text-align: center">00:49.005</td>
<td style="text-align: center">00:50.380</td>
<td style="text-align: center">00:47.114</td>
<td style="text-align: center">00:52.129</td>
<td style="text-align: center">00:48.747</td>
<td style="text-align: center">00:49.475</td>
<td style="text-align: center">00:52.129</td>
<td style="text-align: center">00:47.114</td>
</tr>
<tr>
<td style="text-align: center">Utf8Json</td>
<td style="text-align: center">00:05.365</td>
<td style="text-align: center">00:05.307</td>
<td style="text-align: center">00:04.810</td>
<td style="text-align: center">00:05.250</td>
<td style="text-align: center">00:05.298</td>
<td style="text-align: center">00:05.206</td>
<td style="text-align: center">00:05.365</td>
<td style="text-align: center">00:04.810</td>
</tr>
<tr>
<td style="text-align: center"></td>
<td style="text-align: center"></td>
<td style="text-align: center"></td>
<td style="text-align: center"></td>
<td style="text-align: center"></td>
<td style="text-align: center"></td>
<td style="text-align: center"></td>
<td style="text-align: center"></td>
<td style="text-align: center"></td>
</tr>
<tr>
<td style="text-align: center">JsonNet(dynamic)</td>
<td style="text-align: center">00:35.265</td>
<td style="text-align: center">00:34.807</td>
<td style="text-align: center">00:35.518</td>
<td style="text-align: center">00:38.748</td>
<td style="text-align: center">00:35.058</td>
<td style="text-align: center">00:35.879</td>
<td style="text-align: center">00:38.748</td>
<td style="text-align: center">00:34.807</td>
</tr>
<tr>
<td style="text-align: center">ServiceStack.Text(dynamic)</td>
<td style="text-align: center">00:05.630</td>
<td style="text-align: center">00:05.543</td>
<td style="text-align: center">00:05.617</td>
<td style="text-align: center">00:05.714</td>
<td style="text-align: center">00:05.582</td>
<td style="text-align: center">00:05.617</td>
<td style="text-align: center">00:05.714</td>
<td style="text-align: center">00:05.543</td>
</tr>
<tr>
<td style="text-align: center">Jil(dynamic)</td>
<td style="text-align: center">00:21.534</td>
<td style="text-align: center">00:21.296</td>
<td style="text-align: center">00:21.354</td>
<td style="text-align: center">00:23.030</td>
<td style="text-align: center">00:20.929</td>
<td style="text-align: center">00:21.629</td>
<td style="text-align: center">00:23.030</td>
<td style="text-align: center">00:20.929</td>
</tr>
<tr>
<td style="text-align: center">DynamicJSON(dynamic)</td>
<td style="text-align: center">00:47.160</td>
<td style="text-align: center">00:49.797</td>
<td style="text-align: center">00:46.207</td>
<td style="text-align: center">00:46.603</td>
<td style="text-align: center">00:46.825</td>
<td style="text-align: center">00:47.318</td>
<td style="text-align: center">00:49.797</td>
<td style="text-align: center">00:46.207</td>
</tr>
<tr>
<td style="text-align: center">Utf8Json(dynamic)</td>
<td style="text-align: center">00:20.059</td>
<td style="text-align: center">00:19.494</td>
<td style="text-align: center">00:19.764</td>
<td style="text-align: center">00:19.649</td>
<td style="text-align: center">00:20.118</td>
<td style="text-align: center">00:19.817</td>
<td style="text-align: center">00:20.118</td>
<td style="text-align: center">00:19.494</td>
</tr>
</tbody>
</table>

<p>試行間でそこまでぶれがないので、逐次処理の平均と並列処理の平均を比較してみます。</p>

<table>
<thead>
<tr>
<th style="text-align: center">ライブラリ</th>
<th style="text-align: center">逐次平均</th>
<th style="text-align: center">並列平均</th>
<th style="text-align: center">逐次÷並列</th>
<th style="text-align: center">逐次－並列</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center">DataContractJsonSerializer</td>
<td style="text-align: center">01:14.031</td>
<td style="text-align: center">00:27.434</td>
<td style="text-align: center">2.698</td>
<td style="text-align: center">00:46.597</td>
</tr>
<tr>
<td style="text-align: center">JsonNet</td>
<td style="text-align: center">00:43.110</td>
<td style="text-align: center">00:15.741</td>
<td style="text-align: center">2.739</td>
<td style="text-align: center">00:27.369</td>
</tr>
<tr>
<td style="text-align: center">ServiceStack.Text</td>
<td style="text-align: center">00:05.984</td>
<td style="text-align: center">00:02.427</td>
<td style="text-align: center">2.465</td>
<td style="text-align: center">00:03.556</td>
</tr>
<tr>
<td style="text-align: center">Jil</td>
<td style="text-align: center">00:06.888</td>
<td style="text-align: center">00:02.608</td>
<td style="text-align: center">2.641</td>
<td style="text-align: center">00:04.280</td>
</tr>
<tr>
<td style="text-align: center">DynamicJSON</td>
<td style="text-align: center">02:20.136</td>
<td style="text-align: center">00:49.475</td>
<td style="text-align: center">2.832</td>
<td style="text-align: center">01:30.661</td>
</tr>
<tr>
<td style="text-align: center">Utf8Json</td>
<td style="text-align: center">00:13.639</td>
<td style="text-align: center">00:05.206</td>
<td style="text-align: center">2.620</td>
<td style="text-align: center">00:08.433</td>
</tr>
<tr>
<td style="text-align: center"></td>
<td style="text-align: center"></td>
<td style="text-align: center"></td>
<td style="text-align: center"></td>
<td style="text-align: center"></td>
</tr>
<tr>
<td style="text-align: center">JsonNet(dynamic)</td>
<td style="text-align: center">01:41.763</td>
<td style="text-align: center">00:35.879</td>
<td style="text-align: center">2.836</td>
<td style="text-align: center">01:05.884</td>
</tr>
<tr>
<td style="text-align: center">ServiceStack.Text(dynamic)</td>
<td style="text-align: center">00:15.871</td>
<td style="text-align: center">00:05.617</td>
<td style="text-align: center">2.825</td>
<td style="text-align: center">00:10.254</td>
</tr>
<tr>
<td style="text-align: center">Jil(dynamic)</td>
<td style="text-align: center">01:04.016</td>
<td style="text-align: center">00:21.629</td>
<td style="text-align: center">2.960</td>
<td style="text-align: center">00:42.387</td>
</tr>
<tr>
<td style="text-align: center">DynamicJSON(dynamic)</td>
<td style="text-align: center">02:16.756</td>
<td style="text-align: center">00:47.318</td>
<td style="text-align: center">2.890</td>
<td style="text-align: center">01:29.438</td>
</tr>
<tr>
<td style="text-align: center">Utf8Json(dynamic)</td>
<td style="text-align: center">00:54.555</td>
<td style="text-align: center">00:19.817</td>
<td style="text-align: center">2.753</td>
<td style="text-align: center">00:34.738</td>
</tr>
</tbody>
</table>

<p>逐次÷並列を時間比、逐次－並列を時間差とします。比のほうは2.45～3.0の範囲内です。4並列にしても額面通り速度が4倍になることはないので、妥当といえるでしょう。差が大きいケースほど比も大きくなることが多く、これは極端に速いケースでは、JSONデシリアライズ以外の関係ない処理（foreachや文字列の読み込み）が全体に占めるウェイトが高くなるからだと思われます。逆に差が大きいのに比でそこまで伸びていないケースは、もともとの計算負荷が高いゆえに並列化してもCPUリソース食い尽くしやすく、あまり好ましくないと言えるかもしれません。<br>
<a href="https://camo.qiitausercontent.com/3dd9fa9b11405a5481408a7d50b52d01d8880b7f/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3233323038382f33326539633731622d373638322d363162302d363830302d6365613666346530343438392e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F232088%2F32e9c71b-7682-61b0-6800-cea6f4e04489.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=62d7d28d05d962dcf557d3d51c150338" alt="utf8json4.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/232088/32e9c71b-7682-61b0-6800-cea6f4e04489.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F232088%2F32e9c71b-7682-61b0-6800-cea6f4e04489.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=2e091eefc812e71c579b5635b224bf90 1x" loading="lazy"></a><br>
ここで回帰直線から大きく上に飛び出いている例は、DataContractJsonSerializerの2例と、DynamicJSONの2例です。この2つは単純に処理時間を見ても選びづらいです。</p>

<h3>
<span id="3逐次処理streamを引数にする" class="fragment"></span><a href="#3%E9%80%90%E6%AC%A1%E5%87%A6%E7%90%86stream%E3%82%92%E5%BC%95%E6%95%B0%E3%81%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>3.逐次処理＋Streamを引数にする</h3>

<p>今までデシリアライズの際にstringやbyte[]を引数として渡していましたが、Zipアーカイブの各エントリーのStreamを渡す場合を考えます。したがってtxtListは必要なくなり、エントリーからダイレクトにデシリアライズするので、メモリ効率は遥かに良くなります。より実践的な方法です。これまで特に良好だった、ServiceStack, Jil, Utf8Jsonの3つについて比較をします。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code>        <span class="kt">var</span> <span class="n">sw</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Stopwatch</span><span class="p">();</span>
        <span class="n">sw</span><span class="p">.</span><span class="nf">Start</span><span class="p">();</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">z</span> <span class="k">in</span> <span class="n">zips</span><span class="p">)</span>
        <span class="p">{</span>

            <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">archive</span> <span class="p">=</span> <span class="n">ZipFile</span><span class="p">.</span><span class="nf">OpenRead</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">entry</span> <span class="k">in</span> <span class="n">archive</span><span class="p">.</span><span class="n">Entries</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">sr</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StreamReader</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="nf">Open</span><span class="p">()))</span>
                    <span class="p">{</span>
                        <span class="n">ServiceStack</span><span class="p">.</span><span class="n">Text</span><span class="p">.</span><span class="n">JsonSerializer</span><span class="p">.</span><span class="n">DeserializeFromStream</span><span class="p">&lt;</span><span class="n">Data</span><span class="p">&gt;(</span><span class="n">sr</span><span class="p">.</span><span class="n">BaseStream</span><span class="p">);</span><span class="c1">//ServiceStackの場合</span>
                        <span class="c1">//Jil.JSON.Deserialize&lt;Data&gt;(sr);//Jilの場合</span>
                        <span class="c1">//Utf8Json.JsonSerializer.Deserialize&lt;Data&gt;(sr.BaseStream);//Utf8Jsonの場合</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="n">sw</span><span class="p">.</span><span class="nf">Stop</span><span class="p">();</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"ServiceStack(stream)\t"</span> <span class="p">+</span> <span class="n">sw</span><span class="p">.</span><span class="n">Elapsed</span><span class="p">);</span>
</code></pre></div></div>

<p>各5回やった場合の結果は以下の通りです。</p>

<table>
<thead>
<tr>
<th style="text-align: center">逐次 / stream</th>
<th style="text-align: center">1回目</th>
<th style="text-align: center">2回目</th>
<th style="text-align: center">3回目</th>
<th style="text-align: center">4回目</th>
<th style="text-align: center">5回目</th>
<th style="text-align: center">平均</th>
<th style="text-align: center">最大</th>
<th style="text-align: center">最小</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center">ServiceStack(stream)</td>
<td style="text-align: center">00:40.706</td>
<td style="text-align: center">00:41.131</td>
<td style="text-align: center">00:40.793</td>
<td style="text-align: center">00:40.724</td>
<td style="text-align: center">00:40.230</td>
<td style="text-align: center">00:40.717</td>
<td style="text-align: center">00:41.131</td>
<td style="text-align: center">00:40.230</td>
</tr>
<tr>
<td style="text-align: center">Jil(stream)</td>
<td style="text-align: center">00:49.434</td>
<td style="text-align: center">00:49.169</td>
<td style="text-align: center">00:49.786</td>
<td style="text-align: center">00:49.728</td>
<td style="text-align: center">00:49.609</td>
<td style="text-align: center">00:49.545</td>
<td style="text-align: center">00:49.786</td>
<td style="text-align: center">00:49.169</td>
</tr>
<tr>
<td style="text-align: center">Utf8Json(stream)</td>
<td style="text-align: center">00:38.752</td>
<td style="text-align: center">00:39.733</td>
<td style="text-align: center">00:39.731</td>
<td style="text-align: center">00:39.715</td>
<td style="text-align: center">00:39.449</td>
<td style="text-align: center">00:39.476</td>
<td style="text-align: center">00:39.733</td>
<td style="text-align: center">00:38.752</td>
</tr>
</tbody>
</table>

<p><strong>この例では、Utf8Jsonが（無事？）最速になりました</strong>。ほとんど処理時間にブレがないので、引数をstringにする場合とstreamにする場合で処理時間の平均値を比較します。</p>

<table>
<thead>
<tr>
<th style="text-align: center">逐次処理</th>
<th style="text-align: center">平均(stream)</th>
<th style="text-align: center">平均(string)</th>
<th style="text-align: center">zip load + string - stream</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center">ServiceStack</td>
<td style="text-align: center">00:40.717</td>
<td style="text-align: center">00:05.984</td>
<td style="text-align: center">00:16.021</td>
</tr>
<tr>
<td style="text-align: center">Jil</td>
<td style="text-align: center">00:49.545</td>
<td style="text-align: center">00:06.888</td>
<td style="text-align: center">00:08.097</td>
</tr>
<tr>
<td style="text-align: center">Utf8Json</td>
<td style="text-align: center">00:39.476</td>
<td style="text-align: center">00:13.639</td>
<td style="text-align: center">00:24.917</td>
</tr>
</tbody>
</table>

<p>「zip load」はStringとしてZipを読み込んだ場合のZipをすべて読み込む時間の平均値50.754秒を足しています。「zip load + string - stream」はこれにstringを引数にJSONをデシリアライズしたときの平均処理時間を足し、streamを引数にJSONをデシリアライズした平均処理時間を引いたものです。ここでの処理の差はstream→stringの変換をするかどうか、txtListにstringを格納するかどうか（zip load, stringの場合は格納しているが、streamを直接渡した場合は格納する必要がない）、txtListをforeachで回すかどうか、とすべて定数項で表されそうな処理ですが、ライブラリによってこの差が一定ではないので、引数がstringの場合、streamの場合でそれぞれデシリアライズに最適化が入っていると思われます。Jilはstringに強く、Utf8Jsonはstreamに強いことがわかります。ServiceStackは傾向としてはUtf8Jsonに近そうです。</p>

<p><strong>※追記（2/2）</strong><br>
entry.Open()で直接Stream読ませればいいところをStreamReaderをかませるという間抜けをしてしまったので、ダイレクトにEntryから読み込ませて再実験しました。JilについてはTextReader（StreamReaderが継承している抽象クラス）が引数なので除外し、ServiceStackとUtf8Jsonの比較を行います。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code>        <span class="n">sw</span><span class="p">.</span><span class="nf">Start</span><span class="p">();</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">z</span> <span class="k">in</span> <span class="n">zips</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">archive</span> <span class="p">=</span> <span class="n">ZipFile</span><span class="p">.</span><span class="nf">OpenRead</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">entry</span> <span class="k">in</span> <span class="n">archive</span><span class="p">.</span><span class="n">Entries</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">ServiceStack</span><span class="p">.</span><span class="n">Text</span><span class="p">.</span><span class="n">JsonSerializer</span><span class="p">.</span><span class="n">DeserializeFromStream</span><span class="p">&lt;</span><span class="n">Data</span><span class="p">&gt;(</span><span class="n">entry</span><span class="p">.</span><span class="nf">Open</span><span class="p">());</span>
                    <span class="c1">//Utf8Json.JsonSerializer.Deserialize&lt;Data&gt;(entry.Open());                    </span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="n">sw</span><span class="p">.</span><span class="nf">Stop</span><span class="p">();</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"ServiceStack(Direct)"</span> <span class="p">+</span> <span class="n">sw</span><span class="p">.</span><span class="n">Elapsed</span><span class="p">);</span>

        <span class="n">sw</span><span class="p">.</span><span class="nf">Restart</span><span class="p">();</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">z</span> <span class="k">in</span> <span class="n">zips</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">archive</span> <span class="p">=</span> <span class="n">ZipFile</span><span class="p">.</span><span class="nf">OpenRead</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">entry</span> <span class="k">in</span> <span class="n">archive</span><span class="p">.</span><span class="n">Entries</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">sr</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StreamReader</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="nf">Open</span><span class="p">()))</span>
                    <span class="p">{</span>
                        <span class="n">ServiceStack</span><span class="p">.</span><span class="n">Text</span><span class="p">.</span><span class="n">JsonSerializer</span><span class="p">.</span><span class="n">DeserializeFromStream</span><span class="p">&lt;</span><span class="n">Data</span><span class="p">&gt;(</span><span class="n">sr</span><span class="p">.</span><span class="n">BaseStream</span><span class="p">);</span> 
                        <span class="c1">//Utf8Json.JsonSerializer.Deserialize&lt;Data&gt;(sr.BaseStream);                                                                                                                               //Utf8Json.JsonSerializer.Deserialize&lt;Data&gt;(sr.BaseStream);//Utf8Jsonの場合</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="n">sw</span><span class="p">.</span><span class="nf">Stop</span><span class="p">();</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"ServiceStack(StreamReader)"</span> <span class="p">+</span> <span class="n">sw</span><span class="p">.</span><span class="n">Elapsed</span><span class="p">);</span>
</code></pre></div></div>

<table>
<thead>
<tr>
<th style="text-align: center">Direct vs StreamReader</th>
<th style="text-align: center">平均</th>
<th style="text-align: center">最大</th>
<th style="text-align: center">最小</th>
<th style="text-align: center">1回目</th>
<th style="text-align: center">2回目</th>
<th style="text-align: center">3回目</th>
<th style="text-align: center">4回目</th>
<th style="text-align: center">5回目</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center">ServiceStack(Direct)</td>
<td style="text-align: center">00:37.564</td>
<td style="text-align: center">00:38.108</td>
<td style="text-align: center">00:36.921</td>
<td style="text-align: center">00:38.108</td>
<td style="text-align: center">00:36.921</td>
<td style="text-align: center">00:37.532</td>
<td style="text-align: center">00:38.093</td>
<td style="text-align: center">00:37.166</td>
</tr>
<tr>
<td style="text-align: center">ServiceStack(StreamReader)</td>
<td style="text-align: center">00:37.714</td>
<td style="text-align: center">00:38.675</td>
<td style="text-align: center">00:36.956</td>
<td style="text-align: center">00:38.675</td>
<td style="text-align: center">00:36.956</td>
<td style="text-align: center">00:37.402</td>
<td style="text-align: center">00:37.501</td>
<td style="text-align: center">00:38.037</td>
</tr>
<tr>
<td style="text-align: center">Utf8Json(Direct)</td>
<td style="text-align: center">00:36.915</td>
<td style="text-align: center">00:37.461</td>
<td style="text-align: center">00:36.234</td>
<td style="text-align: center">00:37.189</td>
<td style="text-align: center">00:36.234</td>
<td style="text-align: center">00:36.773</td>
<td style="text-align: center">00:36.919</td>
<td style="text-align: center">00:37.461</td>
</tr>
<tr>
<td style="text-align: center">Utf8Json(StreamReader)</td>
<td style="text-align: center">00:36.590</td>
<td style="text-align: center">00:37.017</td>
<td style="text-align: center">00:36.231</td>
<td style="text-align: center">00:36.231</td>
<td style="text-align: center">00:36.253</td>
<td style="text-align: center">00:36.846</td>
<td style="text-align: center">00:36.603</td>
<td style="text-align: center">00:37.017</td>
</tr>
</tbody>
</table>

<p>初回にライブラリのロードが入ってるので、逆に遅くなっているかもしれません。基本的にStreamReaderを噛ませたほうが速くなるということはないはずです。この場合は0.1～0.5秒程度、entry.Open()したほうが速いといえるでしょう。（byte[]を変数で取る目的でもなく、StreamReader噛ませてたのがタダの間抜けなだけ）</p>

<p>コメントで指摘してくださった方、ありがとうございました。</p>

<h2>
<span id="まとめ" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>まとめ</h2>

<p>以上、ギガバイトクラスのJSONを読み込んでデシリアライズのパフォーマンスを計測しました。この例ではUtf8Jsonがぶっちぎりで強いという結論にはなりませんでしたが、特定の状況下では最速になりました。次のような結論になります。</p>

<ul>
<li>
<strong>Jil, Utf8Json, ServiceStack.Text</strong>→どれも優秀。型を指定する場合はServiceStackが最速だが、指定しない場合は型のキャストでハマる可能性はある。Jilは安定して強く、stringからデシリアライズするときに最速。Utf8Jsonはstreamやbyte[]から読み込ませる場合は最速。stringからデシリアライズするのが無駄というのが理解できれば最も性能を引き出せるかもしれない。</li>
<li>Json.Net→良くも悪くも普通</li>
<li>DataContractJsonSerializer→配布用バイナリに余計なDLLが同梱されないメリットはあるが使いづらい</li>
<li>DynamicJSON→7年前のライブラリだしそっとしておいてUtf8Jsonを使ってあげてください</li>
</ul>

<p>今後のアップデートで大きく変わる可能性があるので、期待しましょう。</p>

<p>すっかり忘れていましたが、これが作りたかったビットコインの2018/1/18～1/24の6日分のティックチャートです。csvで出力してExcelでグラフ化しました。<br>
<a href="https://camo.qiitausercontent.com/1b42e3117b223b453a09be6423cae739d9fa43d4/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3233323038382f65326232373132312d303633332d323033362d656430652d3864303935383936616262372e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F232088%2Fe2b27121-0633-2036-ed0e-8d095896abb7.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=dd83d35c8a2a8500c55e22f73fe5b41a" alt="utf8json5.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/232088/e2b27121-0633-2036-ed0e-8d095896abb7.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F232088%2Fe2b27121-0633-2036-ed0e-8d095896abb7.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=15322ef79ee664e878f0977a8075ec69 1x" loading="lazy"></a></p>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Fkoshian2%2Fitems%2Fc7e0fe65a27326edf8d0&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Fkoshian2%2Fitems%2Fc7e0fe65a27326edf8d0&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/koshian2/items/c7e0fe65a27326edf8d0/likers" class="css-1iupg5d">53</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">39</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/c7e0fe65a27326edf8d0/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/koshian2/items/c7e0fe65a27326edf8d0/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/koshian2/items/c7e0fe65a27326edf8d0/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/koshian2/items/c7e0fe65a27326edf8d0/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/koshian2/items/c7e0fe65a27326edf8d0.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-87ed1b38-ceee-424d-af35-f528496b8001">{"authorAnalyticsTrackingId":"UA-110383409-3","organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-0996ac53-2154-43ed-b7ef-3fd8771a65b0"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-0996ac53-2154-43ed-b7ef-3fd8771a65b0">{}</script>
      
<div id="LoginModal-react-component-95bbbe1c-c536-4514-860b-6061cfee86b8"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-95bbbe1c-c536-4514-860b-6061cfee86b8">{}</script>
      
<div id="StockModal-react-component-3d2edec7-b4da-4e8e-be0a-24a18a66db1b"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-3d2edec7-b4da-4e8e-be0a-24a18a66db1b">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;0US9H8JMtlJfn4PjpdH/6/VJwnO1NpJfGfSstCz9WRGxJ9TI2kDZWo/J4L/fC90mlkO/juI7vX7hhpqXL6rZrQ==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\u003cp\u003elinq.jsやZeroFormatterなどステッキーなライブラリを作っているneuecc先生の新作JSONシリアライザーのUtf8Jsonを試してみました。\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eUtf8Json - Fast JSON Serializer for C#\u003c/strong\u003e\u003cbr\u003e\n\u003ca href=\"https://github.com/neuecc/Utf8Json\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/neuecc/Utf8Json\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e”Definitely Fastest”（明らかに最速）とのことなので、最速の恩恵を受けそうな例で実践します。拙作で恐縮ですが、\u003ca href=\"https://qiita.com/koshian2/items/872e2ee601be2bce7b9c\" id=\"reference-15ab12879390dbbf2a77\"\u003eC#で仮想通貨取引所のリアルタイムレートを記録するプログラムを作ってみた\u003c/a\u003eを1週間実行したところ、合計1GBを軽く超えるJSONファイルが生成できました。それをデシリアライズするプログラムを作ります。そして、既存のJSONシリアライザーとの比較を行います。\u003c/p\u003e\n\n\u003cp\u003e環境：VisualStudio2017 Community / .NET 4.6.0\u003c/p\u003e\n\n\u003cp\u003eライブラリのバージョン\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eDataContractJsonSerializer : System.Runtime.Serialization 4.0.0.0\u003c/li\u003e\n\u003cli\u003eJson.NET : v10.0.3 (2017/6/8)\u003c/li\u003e\n\u003cli\u003eServiceStack.Text : v5.0.2 (2018/1/2)\u003c/li\u003e\n\u003cli\u003eJil : v2.15.4 (2017/8/24)\u003c/li\u003e\n\u003cli\u003eDynamicJson : v1.2.0 (2011/9/22)\u003c/li\u003e\n\u003cli\u003eUtf8Json : v1.3.6.1 (2018/1/23)\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e関連記事：\u003cbr\u003e\n.NETのJSONシリアライザの速度比較\u003cbr\u003e\n\u003ca href=\"https://qiita.com/t_takahari/items/6855dfe78071bb5eaef6\" class=\"autolink\" id=\"reference-ed62c4af18a5ac9adb50\"\u003ehttps://qiita.com/t_takahari/items/6855dfe78071bb5eaef6\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"対象データ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AF%BE%E8%B1%A1%E3%83%87%E3%83%BC%E3%82%BF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e対象データ\u003c/h2\u003e\n\n\u003cp\u003e仮想通貨取引所のストリーミングAPIから配信される、ビットコイン円（btc-jpy）の取引（板情報＋トランザクションデータ）。おおよそ1秒に1回～2回以下のようなJSONが送られてきます。\u003ca href=\"http://jsonviewer.codeplex.com/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eJSON Viewer\u003c/a\u003eで見ると、次のような構造であることがわかります。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/8668e2fb2f64456c4ae9bbd6bd653087e232c923/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3233323038382f36353537336562652d333937652d343036642d386363342d3030343365616433313533662e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F232088%2F65573ebe-397e-406d-8cc4-0043ead3153f.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=03c5052032ae77189a030df245b5c974\" alt=\"utf8json1.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/232088/65573ebe-397e-406d-8cc4-0043ead3153f.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F232088%2F65573ebe-397e-406d-8cc4-0043ead3153f.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=b2012c0fa69145afdc25b29fc4324e41 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n1つのJSONを1つのテキストファイルとして保存します。1つのテキストファイルはおよそ4KBです。\u003c/p\u003e\n\n\u003cp\u003elast_price.priceとtimestampを抽出するプログラムを作ります。これらのテキストファイルは一定時間（設定では1分、5分）で1つのZipアーカイブに保存されています。途中でこの設定値変えてしまったので1日あたりのアーカイブ数はいい加減です。\u003cstrong\u003e1/18～1/23の6日分\u003c/strong\u003eのデータ用意します。エクスプローラーで見ると次のようになります。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/6fc332ce2562971f722a00ccaabd4293422ab0fa/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3233323038382f39303238363564372d646434352d656432312d393635392d3762623365636136316535362e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F232088%2F902865d7-dd45-ed21-9659-7bb3eca61e56.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=44ff93e333cc83c186ce5807c4eff809\" alt=\"utf8json2.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/232088/902865d7-dd45-ed21-9659-7bb3eca61e56.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F232088%2F902865d7-dd45-ed21-9659-7bb3eca61e56.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=f7e40e1cb0f1e9180eae506ad12b8b81 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eZipをすべて展開たところ、次のようになりました。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/1a962ea8578c42336d5e7ac952fa54274d38bac7/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3233323038382f37646535373638352d303438392d366239352d373430652d6564326565643532353466342e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F232088%2F7de57685-0489-6b95-740e-ed2eed5254f4.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=4be0b210bc3001144373a64b7627af88\" alt=\"utf8json3.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/232088/7de57685-0489-6b95-740e-ed2eed5254f4.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F232088%2F7de57685-0489-6b95-740e-ed2eed5254f4.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=1a500faa59ff5014e3fca243f10735f5 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e35.5万個のJSONが無圧縮で1.43GB（ディスク上は2.70GB）です。32bitプロセスのメモリ制限があるので、まずこれをList\u0026lt;string\u0026gt;としてすべてメモリに落とし込んでみます\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eZip→txtList\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003etxtList\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ezips\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e18\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e6\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eSelect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s\"\u003e\"btc_jpy\\\\2018\\\\201801\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSelectMany\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eDirectory\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetFileSystemEntries\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"*.zip\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eSearchOption\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAllDirectories\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003esw\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eStopwatch\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"n\"\u003esw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eStart\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ez\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003ezips\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\n            \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003earchive\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eZipFile\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eOpenRead\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ez\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eentry\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003earchive\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEntries\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003esr\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eStreamReader\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eentry\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eOpen\u003c/span\u003e\u003cspan class=\"p\"\u003e()))\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003etxtList\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReadToEnd\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"n\"\u003esw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eStop\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Zip load : \"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003esw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eElapsed\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Memory : \"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eEnvironment\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWorkingSet\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToString\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"N0\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\"bytes\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e展開後のtxtファイルではなく、展開前のZipから直接読ませていますが、こっちのほうが速いからです（後述）。実行結果は次のようになります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003eZip load : 00:00:49.7493200\nMemory : 3,179,085,824bytes\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eメモリ使用量は3.0GBです。\u003cstrong\u003e6日ではなく、7日分読み込ませると「System.OutOfMemoryException」が出ます\u003c/strong\u003e。なので、これが32bitプロセスの限界とみなしてもよいと思います。64bitでビルドすればほぼ際限なくいけますが、JSONデシリアライズのパフォーマンスを図るには32bitのMAXで十分でしょう。たかだか1～2GBでビッグデータと言い張る気は毛頭ないですが、ビッグデータに片足の親指の爪先ぐらい突っ込んだぐらいのサイズはあります。\u003c/p\u003e\n\n\u003cp\u003eまた、一気にtxtListに読み込ませるのではなく、Zipアーカイブ単位で読み込ませ、その都度デシリアライズしていくと（実践的にはこちらを使います）、メモリ効率はいいですが、Zipの展開やファイルの読み込みにかかる処理時間と、JSONをパースするのにかかる処理時間を切り離しできなくなるので、ここでは一気にメモリを読ませる方法を使います。\u003cbr\u003e\ntxtListから読み込ませても、正確には、txtListから文字列を読み込ませる処理時間を切り離していないのですが、同じメモリ内での操作なので無視できるぐらい小さいとします。\u003c/p\u003e\n\n\u003cp\u003eZip→txtListではなく、Zip→Txt→txtListと読み込ませると、Zip→Txtの処理を事前に行っておいてもZip→txtListの場合より遅くなります。試してみます。decompressフォルダにはbtc_jpyフォルダ以下のZipアーカイブがそのままの形で展開されているものとします。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eTxt→txtList\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003etxtList\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003esw\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eStopwatch\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003edirs\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e18\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e6\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eSelect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s\"\u003e\"decompress\\\\2018\\\\201801\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003esw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eStart\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ed\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003edirs\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003etxt\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003eDirectory\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetFileSystemEntries\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ed\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"*.txt\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eSearchOption\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAllDirectories\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eusing\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003efs\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eStreamReader\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etxt\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n                \u003cspan class=\"n\"\u003etxtList\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReadToEnd\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"n\"\u003esw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eStop\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Text load : \"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003esw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eElapsed\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Memory : \"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eEnvironment\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWorkingSet\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToString\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"N0\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\"bytes\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e50秒対26分で、明らかに遅いです。CPUパワーは全然使わないんですけどね。ファイルのオーバーヘッドぱない。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003eText load : 00:26:46.2992704\nMemory : 3,190,595,584bytes\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eとりあえずZipを使いましたが、この手の使い方をする場合、圧縮はパワー要しても解凍が軽いタイプの圧縮アルゴリズムを選ぶとよさそうな気がします。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"jsonシリアライザー一覧\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#json%E3%82%B7%E3%83%AA%E3%82%A2%E3%83%A9%E3%82%A4%E3%82%B6%E3%83%BC%E4%B8%80%E8%A6%A7\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eJSONシリアライザー一覧\u003c/h2\u003e\n\n\u003cp\u003e以下のJSONシリアライザーを比較します。\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e\n\u003ca href=\"https://msdn.microsoft.com/ja-jp/library/system.runtime.serialization.json.datacontractjsonserializer(v=vs.110).aspx\" rel=\"nofollow noopener\" target=\"_blank\"\u003eDataContractJsonSerializer\u003c/a\u003e（.NET標準）\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://www.newtonsoft.com/json\" rel=\"nofollow noopener\" target=\"_blank\"\u003eJson.NET\u003c/a\u003e（MIT）\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://github.com/ServiceStack/ServiceStack.Text\" rel=\"nofollow noopener\" target=\"_blank\"\u003eServiceStack.Text\u003c/a\u003e（\u003ca href=\"https://github.com/ServiceStack/ServiceStack.Text/blob/master/license.txt\" rel=\"nofollow noopener\" target=\"_blank\"\u003eAGPLv3 FOSS License Exception\u003c/a\u003e）\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://github.com/kevin-montrose/Jil\" rel=\"nofollow noopener\" target=\"_blank\"\u003eJil\u003c/a\u003e（MIT）\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"http://dynamicjson.codeplex.com\" rel=\"nofollow noopener\" target=\"_blank\"\u003eDynamicJSON\u003c/a\u003e（Utf8Jsonと作者同じ / \u003ca href=\"http://dynamicjson.codeplex.com/license\" rel=\"nofollow noopener\" target=\"_blank\"\u003eMs-PL\u003c/a\u003e）\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://github.com/neuecc/Utf8Json\" rel=\"nofollow noopener\" target=\"_blank\"\u003eUtf8Json\u003c/a\u003e（New!! / MIT）\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003e1番目以外はdynamic型が使えるので、型を指定する場合、型を指定せずdynamicでデシリアライズする場合をそれぞれを見ます。\u003cbr\u003e\ndynamicの場合、型を指定する場合と同様の返し方をすると少し不公平なので（キャストが多い分当然遅くなる）、必要なtimestampとlast_price.priceのみに絞ってTupleで返すようにします。今回の例では、dynamicでデシリアライズする変数の数が、型を指定する場合とそこまで変わらないので、基本的に型を指定したほうが速いです。ただし、文字と数字が混在した配列など不定形なJSONをデシリアライズする場合は、dynamicを使ったほうが都合がいいことがあるので、必要に応じて使い分けるのがいいかと思います。\u003c/p\u003e\n\n\u003cp\u003e型を指定する場合のクラスをDataとして次のようにします。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eData.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eData\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eLastPrice\u003c/span\u003e \u003cspan class=\"n\"\u003elast_price\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003etimestamp\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eLastPrice\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eaction\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003edouble\u003c/span\u003e \u003cspan class=\"n\"\u003eprice\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eライブラリの数が多いので、ライブラリごとに型を指定する場合、dynamicの場合とラッパーメソッドを作ります（普段はこんなことしなくていいです）。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"1datacontractjsonserializer\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#1datacontractjsonserializer\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e1.DataContractJsonSerializer\u003c/h3\u003e\n\n\u003cp\u003etypeofで指定してStreamからしか読めないというのはちょっとなーという感\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.IO\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Runtime.Serialization.Json\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eDataContractJsonSerialize\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eData\u003c/span\u003e \u003cspan class=\"nf\"\u003eDeserialize\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ejsonStr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eserializer\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eDataContractJsonSerializer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eData\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ems\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMemoryStream\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eEncoding\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUTF8\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetBytes\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ejsonStr\u003c/span\u003e\u003cspan class=\"p\"\u003e)))\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eData\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eserializer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReadObject\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ems\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"2jsonnet\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#2jsonnet\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2.Json.NET\u003c/h3\u003e\n\n\u003cp\u003e一番有名なライブラリ。dynamicの場合が面白い書き方\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eNewtonsoft.Json\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eNewtonsoft.Json.Linq\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eJsonNet\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eData\u003c/span\u003e \u003cspan class=\"nf\"\u003eDeserialize\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ejsonStr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eJsonConvert\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDeserializeObject\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eData\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"n\"\u003ejsonStr\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003edouble\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"nf\"\u003eDeserializeDynamic\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ejsonStr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003edynamic\u003c/span\u003e \u003cspan class=\"n\"\u003edyn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eJObject\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eParse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ejsonStr\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\u003cspan class=\"c1\"\u003e//Newtonsoft.Json.Linq\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003edyn\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etimestamp\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003edouble\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003edyn\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elast_price\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eprice\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"3servicestacktext\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#3servicestacktext\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e3.ServiceStack.Text\u003c/h3\u003e\n\n\u003cp\u003edynamicの場合、内部で文字列になるのが少しトリッキー。(double)とかキャストすると例外になる。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eServiceStack\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eServiceStack.Text\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eServiceStackJson\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eData\u003c/span\u003e \u003cspan class=\"nf\"\u003eDeserialize\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ejsonStr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eJsonSerializer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDeserializeFromString\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eData\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"n\"\u003ejsonStr\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\u003cspan class=\"c1\"\u003e//ServiceStack.Text.JsonSerializer\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"nf\"\u003eDeserializeDynamic\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ejsonStr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003edyn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eDynamicJson\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDeserialize\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ejsonStr\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\u003cspan class=\"c1\"\u003e//ServiceStack.DynamicJson\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003edyn\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etimestamp\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003edyn\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elast_price\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eprice\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\u003cspan class=\"c1\"\u003e//小数でも文字列として記録される\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"4jil\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#4jil\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e4.Jil\u003c/h3\u003e\n\n\u003cp\u003e直感的でわかりやすい\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eJil\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eJilJson\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eData\u003c/span\u003e \u003cspan class=\"nf\"\u003eDeserialize\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ejsonStr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eJSON\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDeserialize\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eData\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"n\"\u003ejsonStr\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003edouble\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"nf\"\u003eDeserializeDynamic\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ejsonStr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003edyn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eJSON\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDeserializeDynamic\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ejsonStr\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003edyn\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etimestamp\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003edouble\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003edyn\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elast_price\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eprice\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"5dynamicjson\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#5dynamicjson\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e5.DynamicJSON\u003c/h3\u003e\n\n\u003cp\u003e\"Dynamic\"JSONなので、型指定の場合はdynamicの変数をキャストしてデシリアライズするというピーキーな仕様。プロジェクトにDynamicJSON.csが追加されるのが特徴。個人的には昔だいぶお世話になりました。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eCodeplex.Data\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eDynamicJsonDeserialize\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eData\u003c/span\u003e \u003cspan class=\"nf\"\u003eDeserialize\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ejsonStr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eData\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eDynamicJson\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eParse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ejsonStr\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003edouble\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"nf\"\u003eDeserializeDynamic\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ejsonStr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003edyn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eDynamicJson\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eParse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ejsonStr\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003edyn\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etimestamp\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003edouble\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003edyn\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elast_price\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eprice\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"6utf8json\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#6utf8json\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e6.Utf8Json\u003c/h3\u003e\n\n\u003cp\u003edynamicの場合はインデクサを使います（.変数名は例外発生）。今後のアップデートで変わるかもしれません。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eUtf8Json\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eUtf8Json\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eData\u003c/span\u003e \u003cspan class=\"nf\"\u003eDeserialize\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003estrJson\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eJsonSerializer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDeserialize\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eData\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"n\"\u003estrJson\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003edouble\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"nf\"\u003eDeserializeDynamic\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003estrJson\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003edyn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eJsonSerializer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDeserialize\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003edynamic\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"n\"\u003estrJson\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003edyn\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"timestamp\"\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003edouble\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003edyn\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"last_price\"\u003c/span\u003e\u003cspan class=\"p\"\u003e][\u003c/span\u003e\u003cspan class=\"s\"\u003e\"price\"\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\u003cspan class=\"c1\"\u003e//インデクサを使う\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"デシリアライズ時間の比較\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%87%E3%82%B7%E3%83%AA%E3%82%A2%E3%83%A9%E3%82%A4%E3%82%BA%E6%99%82%E9%96%93%E3%81%AE%E6%AF%94%E8%BC%83\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eデシリアライズ時間の比較\u003c/h2\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"1逐次処理\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#1%E9%80%90%E6%AC%A1%E5%87%A6%E7%90%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e1.逐次処理\u003c/h3\u003e\n\n\u003cp\u003e以下のコードで比較します。Zip→txtListの続きからです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e        \u003cspan class=\"c1\"\u003e//DataContractJsonSerializer\u003c/span\u003e\n        \u003cspan class=\"n\"\u003esw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRestart\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003estr\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003etxtList\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eDataContractJsonSerialize\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDeserialize\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"n\"\u003esw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eStop\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"DataContractJsonSerializer\\t\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003esw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eElapsed\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e//JsonNet\u003c/span\u003e\n        \u003cspan class=\"n\"\u003esw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRestart\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003estr\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003etxtList\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eJsonNet\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDeserialize\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"n\"\u003esw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eStop\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"JsonNet\\t\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003esw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eElapsed\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003esw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRestart\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003estr\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003etxtList\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eJsonNet\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDeserializeDynamic\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"n\"\u003esw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eStop\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"JsonNet(dynamic)\\t\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003esw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eElapsed\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e//ServiceStack.Text\u003c/span\u003e\n        \u003cspan class=\"n\"\u003esw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRestart\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003estr\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003etxtList\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eServiceStackJson\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDeserialize\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"n\"\u003esw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eStop\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"ServiceStack.Text\\t\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003esw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eElapsed\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003esw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRestart\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003estr\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003etxtList\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eServiceStackJson\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDeserializeDynamic\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"n\"\u003esw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eStop\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"ServiceStack.Text(dynamic)\\t\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003esw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eElapsed\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e//Jil\u003c/span\u003e\n        \u003cspan class=\"n\"\u003esw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRestart\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003estr\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003etxtList\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eJilJson\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDeserialize\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"n\"\u003esw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eStop\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Jil\\t\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003esw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eElapsed\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003esw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRestart\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003estr\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003etxtList\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eJilJson\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDeserializeDynamic\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"n\"\u003esw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eStop\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Jil(dynamic)\\t\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003esw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eElapsed\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e//DynamicJSON\u003c/span\u003e\n        \u003cspan class=\"n\"\u003esw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRestart\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003estr\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003etxtList\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eDynamicJsonDeserialize\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDeserialize\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"n\"\u003esw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eStop\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"DynamicJSON\\t\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003esw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eElapsed\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003esw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRestart\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003estr\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003etxtList\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eDynamicJsonDeserialize\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDeserializeDynamic\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"n\"\u003esw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eStop\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"DynamicJSON(dynamic)\\t\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003esw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eElapsed\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\n        \u003cspan class=\"c1\"\u003e//Utf8Json\u003c/span\u003e\n        \u003cspan class=\"n\"\u003esw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRestart\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003estr\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003etxtList\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eUtf8Json\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDeserialize\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"n\"\u003esw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eStop\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Utf8Json\\t\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003esw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eElapsed\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003esw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRestart\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003estr\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003etxtList\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eUtf8Json\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDeserializeDynamic\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"n\"\u003esw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eStop\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Utf8Json(dynamic)\\t\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003esw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eElapsed\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e本当はtimestampとlast_priceを記録するはずでしたが、純粋にパフォーマンスを見たかったので端折っています。これを5回繰り返します。結果は次の通り。\u003c/p\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align: center\"\u003e逐次処理\u003c/th\u003e\n\u003cth style=\"text-align: center\"\u003e1回目\u003c/th\u003e\n\u003cth style=\"text-align: center\"\u003e2回目\u003c/th\u003e\n\u003cth style=\"text-align: center\"\u003e3回目\u003c/th\u003e\n\u003cth style=\"text-align: center\"\u003e4回目\u003c/th\u003e\n\u003cth style=\"text-align: center\"\u003e5回目\u003c/th\u003e\n\u003cth style=\"text-align: center\"\u003e平均\u003c/th\u003e\n\u003cth style=\"text-align: center\"\u003e最大\u003c/th\u003e\n\u003cth style=\"text-align: center\"\u003e最小\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003eZip load\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:50.981\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:50.870\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:50.253\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:50.896\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:50.770\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:50.754\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:50.981\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:50.253\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003e\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003eDataContractJsonSerializer\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e01:13.843\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e01:15.788\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e01:13.863\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e01:13.945\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e01:12.715\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e01:14.031\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e01:15.788\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e01:12.715\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003eJsonNet\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:43.019\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:43.401\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:42.688\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:43.640\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:42.800\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:43.110\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:43.640\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:42.688\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003eServiceStack.Text\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:06.125\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:05.928\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:05.883\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:06.037\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:05.946\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:05.984\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:06.125\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:05.883\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003eJil\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:06.825\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:06.749\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:07.059\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:06.951\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:06.858\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:06.888\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:07.059\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:06.749\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003eDynamicJSON\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e02:21.014\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e02:20.810\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e02:21.179\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e02:20.486\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e02:17.193\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e02:20.136\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e02:21.179\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e02:17.193\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003eUtf8Json\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:13.312\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:13.498\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:13.459\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:13.685\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:14.240\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:13.639\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:14.240\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:13.312\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003e\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003eJsonNet(dynamic)\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e01:40.964\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e01:41.524\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e01:40.885\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e01:41.389\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e01:44.052\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e01:41.763\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e01:44.052\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e01:40.885\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003eServiceStack.Text(dynamic)\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:15.938\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:15.915\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:15.838\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:15.799\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:15.865\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:15.871\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:15.938\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:15.799\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003eJil(dynamic)\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e01:03.895\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e01:03.903\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e01:03.662\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e01:05.012\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e01:03.606\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e01:04.016\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e01:05.012\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e01:03.606\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003eDynamicJSON(dynamic)\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e02:14.418\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e02:18.594\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e02:18.907\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e02:15.051\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e02:16.810\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e02:16.756\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e02:18.907\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e02:14.418\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003eUtf8Json(dynamic)\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:53.832\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:54.887\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:54.959\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:55.590\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:53.505\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:54.555\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:55.590\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:53.505\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003cp\u003e\u003cstrong\u003eこの例ではUtf8Jsonが最速にはなりませんでした\u003c/strong\u003e。\u003cstrong\u003e型を指定した場合、ServiceStackが6秒弱で最速\u003c/strong\u003e、Jilも同じくらい速く7秒弱、そこから倍の6秒程度遅れてUtf8Jsonが13.6秒、そこから30秒程度とだいぶ遅れてJson.Netが43秒。.Net標準のDataContractJsonSerializerはJson.Netからさらに30秒程度遅れて1分14秒。DynamicJSONは一番遅く、2分オーバー。ただ、他のライブラリがdynamicでデシリアライズしたときに軒並み遅くなっているのに対し（おそらく全部のパラメーターを内部で一度パースしているのかと）、DynamicJSONはほぼ変わらないどころか、dynamicのほうが速いまでもあるので、型指定のクラス側で全部パースする場合はそこまで見劣りしないのかと思われます。\u003cbr\u003e\n比較用にZipの読み込み時間を置いておきましたが、\u003cstrong\u003eJSONシリアライザーの選択によってZipの読み込み1倍～2倍分の処理時間の差が出ます\u003c/strong\u003e。本当はZip部分を高速化したかったけどそれはまた別な投稿で。\u003cbr\u003e\n※追記：いろいろ試してみましたが、\u003ca href=\"https://github.com/neuecc/MessagePack-CSharp\" rel=\"nofollow noopener\" target=\"_blank\"\u003eMessagePack C#\u003c/a\u003eを使うのが良さそうです。気力があれば書きます。\u003c/p\u003e\n\n\u003cp\u003edynamicの場合はServiceStackの15秒以外はだいたい1分オーバー。かろうじてUtf8Jsonが55秒と1分割っているぐらいです。こう見るとServiceStack一強のように見えますが、ServiceStackの場合はdynamicの場合doubleが文字列で記録されているので、キャストに苦労するかもしれません。ServiceStackがdynamicの場合に明らかに速いのは、利便性を犠牲にして高速化しているからかもしれません。\u003c/p\u003e\n\n\u003cp\u003eこの例の場合は\u003ca href=\"https://social.msdn.microsoft.com/Forums/sqlserver/ja-JP/e6015eef-f4a0-45ae-bf26-e186d4c2435d?forum=netfxgeneralja\" rel=\"nofollow noopener\" target=\"_blank\"\u003eStringの内部エンコードがUTF-16である\u003c/a\u003eため、Stringのまま読み込ませているとUTF-8へ余計なエンコード変換が入るのがUtf8Jsonにとっていけないのかもしれません。そこでUtf8Jsonの場合のみ、stringではなくbyte[]を読ませるように改良してみます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eByte[]で記録\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ebyteList\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"k\"\u003e]\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003esw\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eStopwatch\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"n\"\u003esw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eStart\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ez\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003ezips\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\n            \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003earchive\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eZipFile\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eOpenRead\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ez\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eentry\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003earchive\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEntries\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003esr\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eStreamReader\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eentry\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eOpen\u003c/span\u003e\u003cspan class=\"p\"\u003e()))\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                        \u003cspan class=\"c1\"\u003e//txtList.Add(sr.ReadToEnd());\u003c/span\u003e\n                        \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ems\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMemoryStream\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n                        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                            \u003cspan class=\"n\"\u003esr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBaseStream\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCopyTo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ems\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                            \u003cspan class=\"n\"\u003ebyteList\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ems\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToArray\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n                        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"n\"\u003esw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eStop\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Zip load\\t\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003esw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eElapsed\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Memory : \"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eEnvironment\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWorkingSet\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToString\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"N0\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\"bytes\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003esw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRestart\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ebytes\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003ebyteList\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eUtf8Json\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDeserializeBytes\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebytes\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"n\"\u003esw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eStop\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Utf8Json(Bytes)\\t\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003esw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eElapsed\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eUtf8Json\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003eData\u003c/span\u003e \u003cspan class=\"nf\"\u003eDeserializeBytes\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003ebyteJson\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eJsonSerializer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDeserialize\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eData\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"n\"\u003ebyteJson\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれを3回ほど実行してみました。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003eZip load        00:00:37.8030819\nMemory : 1,605,480,448bytes\nUtf8Json(Bytes) 00:00:08.7113992\n\nZip load        00:00:37.7465432\nMemory : 1,606,115,328bytes\nUtf8Json(Bytes) 00:00:08.6711459\n\nZip load        00:00:38.4523601\nMemory : 1,606,238,208bytes\nUtf8Json(Bytes) 00:00:08.7258462\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eキャッシュ方式をstring→byte[]に変えたところ、\u003cstrong\u003eZipの展開時間が50秒→38秒と12秒ほど短縮され（24%減）、メモリ使用量が3.19Gbytes→1.61Gbytesと半分になり、Utf8Jsonのデシリアライズ時間が13.6秒→8.7秒と5秒ほど短縮され（36%減）ました\u003c/strong\u003e。これでもまだ、stringの場合のServiceStackとJilのケースを抜くことができなかったのですが、特にメモリ減少の効果が大きそうです。JSONだとUTF-16までエンコードを拡大するメリットが無い（JSONの規則上エスケープされる）ので、\u003cstrong\u003eUTF-8 byte[]で読み込んでしまうという作戦はかなり有用かも\u003c/strong\u003eしれません。\u003cbr\u003e\nちなみにJilもServiceStackもTextReaderやStreamを引数として渡すことはできるものの、byte[]を直接渡すことができるのはざっと見たところUtf8Jsonだけでした。細かいチューニングを気にする場合、トータルで見たときにUtf8Jsonが優位に立てる可能性は十分にあります。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"2並列処理\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#2%E4%B8%A6%E5%88%97%E5%87%A6%E7%90%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2.並列処理\u003c/h3\u003e\n\n\u003cp\u003e1.のstringの例を並列化してみます。Parallel.ForEachを使うだけです。ただし、並列化する場合は読み込む順番の保証がされなくなるので、結果が時系列で欲しい場合は最終的にソートする、スレッドセーフなコレクションを使って記録するなどの工夫が必要になります。Utf8Jsonの場合はこうします（他も同様なので省略します）。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e並列処理\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eoption\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eParallelOptions\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003eMaxDegreeOfParallelism\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e4\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eParallel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eForEach\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etxtList\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eoption\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003estr\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eUtf8Json\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDeserialize\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eMaxDegreeOfParallelismを指定しないときりがなく並列していって死ぬので、スレッド数は4に制限しました。結果は次のようになりました。\u003c/p\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align: center\"\u003e並列処理\u003c/th\u003e\n\u003cth style=\"text-align: center\"\u003e1回目\u003c/th\u003e\n\u003cth style=\"text-align: center\"\u003e2回目\u003c/th\u003e\n\u003cth style=\"text-align: center\"\u003e3回目\u003c/th\u003e\n\u003cth style=\"text-align: center\"\u003e4回目\u003c/th\u003e\n\u003cth style=\"text-align: center\"\u003e5回目\u003c/th\u003e\n\u003cth style=\"text-align: center\"\u003e平均\u003c/th\u003e\n\u003cth style=\"text-align: center\"\u003e最大\u003c/th\u003e\n\u003cth style=\"text-align: center\"\u003e最小\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003eDataContractJsonSerializer\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:28.103\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:26.502\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:27.138\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:28.102\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:27.326\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:27.434\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:28.103\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:26.502\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003eJsonNet\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:15.382\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:15.428\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:15.336\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:16.527\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:16.030\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:15.741\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:16.527\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:15.336\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003eServiceStack.Text\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:02.466\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:02.779\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:02.317\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:02.115\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:02.460\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:02.427\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:02.779\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:02.115\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003eJil\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:02.474\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:02.395\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:02.661\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:02.825\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:02.686\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:02.608\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:02.825\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:02.395\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003eDynamicJSON\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:49.005\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:50.380\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:47.114\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:52.129\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:48.747\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:49.475\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:52.129\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:47.114\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003eUtf8Json\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:05.365\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:05.307\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:04.810\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:05.250\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:05.298\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:05.206\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:05.365\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:04.810\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003e\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003eJsonNet(dynamic)\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:35.265\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:34.807\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:35.518\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:38.748\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:35.058\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:35.879\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:38.748\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:34.807\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003eServiceStack.Text(dynamic)\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:05.630\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:05.543\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:05.617\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:05.714\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:05.582\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:05.617\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:05.714\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:05.543\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003eJil(dynamic)\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:21.534\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:21.296\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:21.354\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:23.030\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:20.929\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:21.629\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:23.030\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:20.929\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003eDynamicJSON(dynamic)\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:47.160\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:49.797\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:46.207\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:46.603\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:46.825\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:47.318\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:49.797\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:46.207\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003eUtf8Json(dynamic)\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:20.059\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:19.494\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:19.764\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:19.649\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:20.118\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:19.817\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:20.118\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:19.494\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003cp\u003e試行間でそこまでぶれがないので、逐次処理の平均と並列処理の平均を比較してみます。\u003c/p\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align: center\"\u003eライブラリ\u003c/th\u003e\n\u003cth style=\"text-align: center\"\u003e逐次平均\u003c/th\u003e\n\u003cth style=\"text-align: center\"\u003e並列平均\u003c/th\u003e\n\u003cth style=\"text-align: center\"\u003e逐次÷並列\u003c/th\u003e\n\u003cth style=\"text-align: center\"\u003e逐次－並列\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003eDataContractJsonSerializer\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e01:14.031\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:27.434\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e2.698\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:46.597\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003eJsonNet\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:43.110\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:15.741\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e2.739\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:27.369\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003eServiceStack.Text\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:05.984\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:02.427\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e2.465\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:03.556\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003eJil\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:06.888\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:02.608\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e2.641\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:04.280\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003eDynamicJSON\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e02:20.136\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:49.475\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e2.832\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e01:30.661\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003eUtf8Json\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:13.639\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:05.206\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e2.620\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:08.433\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003e\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003eJsonNet(dynamic)\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e01:41.763\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:35.879\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e2.836\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e01:05.884\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003eServiceStack.Text(dynamic)\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:15.871\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:05.617\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e2.825\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:10.254\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003eJil(dynamic)\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e01:04.016\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:21.629\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e2.960\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:42.387\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003eDynamicJSON(dynamic)\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e02:16.756\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:47.318\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e2.890\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e01:29.438\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003eUtf8Json(dynamic)\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:54.555\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:19.817\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e2.753\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:34.738\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003cp\u003e逐次÷並列を時間比、逐次－並列を時間差とします。比のほうは2.45～3.0の範囲内です。4並列にしても額面通り速度が4倍になることはないので、妥当といえるでしょう。差が大きいケースほど比も大きくなることが多く、これは極端に速いケースでは、JSONデシリアライズ以外の関係ない処理（foreachや文字列の読み込み）が全体に占めるウェイトが高くなるからだと思われます。逆に差が大きいのに比でそこまで伸びていないケースは、もともとの計算負荷が高いゆえに並列化してもCPUリソース食い尽くしやすく、あまり好ましくないと言えるかもしれません。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/3dd9fa9b11405a5481408a7d50b52d01d8880b7f/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3233323038382f33326539633731622d373638322d363162302d363830302d6365613666346530343438392e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F232088%2F32e9c71b-7682-61b0-6800-cea6f4e04489.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=62d7d28d05d962dcf557d3d51c150338\" alt=\"utf8json4.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/232088/32e9c71b-7682-61b0-6800-cea6f4e04489.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F232088%2F32e9c71b-7682-61b0-6800-cea6f4e04489.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=2e091eefc812e71c579b5635b224bf90 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\nここで回帰直線から大きく上に飛び出いている例は、DataContractJsonSerializerの2例と、DynamicJSONの2例です。この2つは単純に処理時間を見ても選びづらいです。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"3逐次処理streamを引数にする\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#3%E9%80%90%E6%AC%A1%E5%87%A6%E7%90%86stream%E3%82%92%E5%BC%95%E6%95%B0%E3%81%AB%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e3.逐次処理＋Streamを引数にする\u003c/h3\u003e\n\n\u003cp\u003e今までデシリアライズの際にstringやbyte[]を引数として渡していましたが、Zipアーカイブの各エントリーのStreamを渡す場合を考えます。したがってtxtListは必要なくなり、エントリーからダイレクトにデシリアライズするので、メモリ効率は遥かに良くなります。より実践的な方法です。これまで特に良好だった、ServiceStack, Jil, Utf8Jsonの3つについて比較をします。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003esw\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eStopwatch\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"n\"\u003esw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eStart\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ez\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003ezips\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\n            \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003earchive\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eZipFile\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eOpenRead\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ez\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eentry\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003earchive\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEntries\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003esr\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eStreamReader\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eentry\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eOpen\u003c/span\u003e\u003cspan class=\"p\"\u003e()))\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003eServiceStack\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eText\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eJsonSerializer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDeserializeFromStream\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eData\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"n\"\u003esr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBaseStream\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\u003cspan class=\"c1\"\u003e//ServiceStackの場合\u003c/span\u003e\n                        \u003cspan class=\"c1\"\u003e//Jil.JSON.Deserialize\u0026lt;Data\u0026gt;(sr);//Jilの場合\u003c/span\u003e\n                        \u003cspan class=\"c1\"\u003e//Utf8Json.JsonSerializer.Deserialize\u0026lt;Data\u0026gt;(sr.BaseStream);//Utf8Jsonの場合\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"n\"\u003esw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eStop\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"ServiceStack(stream)\\t\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003esw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eElapsed\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e各5回やった場合の結果は以下の通りです。\u003c/p\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align: center\"\u003e逐次 / stream\u003c/th\u003e\n\u003cth style=\"text-align: center\"\u003e1回目\u003c/th\u003e\n\u003cth style=\"text-align: center\"\u003e2回目\u003c/th\u003e\n\u003cth style=\"text-align: center\"\u003e3回目\u003c/th\u003e\n\u003cth style=\"text-align: center\"\u003e4回目\u003c/th\u003e\n\u003cth style=\"text-align: center\"\u003e5回目\u003c/th\u003e\n\u003cth style=\"text-align: center\"\u003e平均\u003c/th\u003e\n\u003cth style=\"text-align: center\"\u003e最大\u003c/th\u003e\n\u003cth style=\"text-align: center\"\u003e最小\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003eServiceStack(stream)\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:40.706\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:41.131\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:40.793\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:40.724\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:40.230\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:40.717\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:41.131\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:40.230\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003eJil(stream)\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:49.434\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:49.169\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:49.786\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:49.728\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:49.609\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:49.545\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:49.786\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:49.169\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003eUtf8Json(stream)\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:38.752\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:39.733\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:39.731\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:39.715\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:39.449\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:39.476\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:39.733\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:38.752\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003cp\u003e\u003cstrong\u003eこの例では、Utf8Jsonが（無事？）最速になりました\u003c/strong\u003e。ほとんど処理時間にブレがないので、引数をstringにする場合とstreamにする場合で処理時間の平均値を比較します。\u003c/p\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align: center\"\u003e逐次処理\u003c/th\u003e\n\u003cth style=\"text-align: center\"\u003e平均(stream)\u003c/th\u003e\n\u003cth style=\"text-align: center\"\u003e平均(string)\u003c/th\u003e\n\u003cth style=\"text-align: center\"\u003ezip load + string - stream\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003eServiceStack\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:40.717\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:05.984\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:16.021\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003eJil\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:49.545\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:06.888\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:08.097\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003eUtf8Json\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:39.476\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:13.639\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:24.917\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003cp\u003e「zip load」はStringとしてZipを読み込んだ場合のZipをすべて読み込む時間の平均値50.754秒を足しています。「zip load + string - stream」はこれにstringを引数にJSONをデシリアライズしたときの平均処理時間を足し、streamを引数にJSONをデシリアライズした平均処理時間を引いたものです。ここでの処理の差はstream→stringの変換をするかどうか、txtListにstringを格納するかどうか（zip load, stringの場合は格納しているが、streamを直接渡した場合は格納する必要がない）、txtListをforeachで回すかどうか、とすべて定数項で表されそうな処理ですが、ライブラリによってこの差が一定ではないので、引数がstringの場合、streamの場合でそれぞれデシリアライズに最適化が入っていると思われます。Jilはstringに強く、Utf8Jsonはstreamに強いことがわかります。ServiceStackは傾向としてはUtf8Jsonに近そうです。\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003e※追記（2/2）\u003c/strong\u003e\u003cbr\u003e\nentry.Open()で直接Stream読ませればいいところをStreamReaderをかませるという間抜けをしてしまったので、ダイレクトにEntryから読み込ませて再実験しました。JilについてはTextReader（StreamReaderが継承している抽象クラス）が引数なので除外し、ServiceStackとUtf8Jsonの比較を行います。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e        \u003cspan class=\"n\"\u003esw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eStart\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ez\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003ezips\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003earchive\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eZipFile\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eOpenRead\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ez\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eentry\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003earchive\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEntries\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003eServiceStack\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eText\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eJsonSerializer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDeserializeFromStream\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eData\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"n\"\u003eentry\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eOpen\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n                    \u003cspan class=\"c1\"\u003e//Utf8Json.JsonSerializer.Deserialize\u0026lt;Data\u0026gt;(entry.Open());                    \u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"n\"\u003esw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eStop\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"ServiceStack(Direct)\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003esw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eElapsed\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003esw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRestart\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ez\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003ezips\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003earchive\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eZipFile\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eOpenRead\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ez\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eentry\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003earchive\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEntries\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003esr\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eStreamReader\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eentry\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eOpen\u003c/span\u003e\u003cspan class=\"p\"\u003e()))\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003eServiceStack\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eText\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eJsonSerializer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDeserializeFromStream\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eData\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"n\"\u003esr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBaseStream\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \n                        \u003cspan class=\"c1\"\u003e//Utf8Json.JsonSerializer.Deserialize\u0026lt;Data\u0026gt;(sr.BaseStream);                                                                                                                               //Utf8Json.JsonSerializer.Deserialize\u0026lt;Data\u0026gt;(sr.BaseStream);//Utf8Jsonの場合\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"n\"\u003esw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eStop\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eConsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"ServiceStack(StreamReader)\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003esw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eElapsed\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align: center\"\u003eDirect vs StreamReader\u003c/th\u003e\n\u003cth style=\"text-align: center\"\u003e平均\u003c/th\u003e\n\u003cth style=\"text-align: center\"\u003e最大\u003c/th\u003e\n\u003cth style=\"text-align: center\"\u003e最小\u003c/th\u003e\n\u003cth style=\"text-align: center\"\u003e1回目\u003c/th\u003e\n\u003cth style=\"text-align: center\"\u003e2回目\u003c/th\u003e\n\u003cth style=\"text-align: center\"\u003e3回目\u003c/th\u003e\n\u003cth style=\"text-align: center\"\u003e4回目\u003c/th\u003e\n\u003cth style=\"text-align: center\"\u003e5回目\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003eServiceStack(Direct)\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:37.564\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:38.108\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:36.921\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:38.108\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:36.921\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:37.532\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:38.093\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:37.166\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003eServiceStack(StreamReader)\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:37.714\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:38.675\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:36.956\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:38.675\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:36.956\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:37.402\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:37.501\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:38.037\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003eUtf8Json(Direct)\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:36.915\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:37.461\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:36.234\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:37.189\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:36.234\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:36.773\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:36.919\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:37.461\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003eUtf8Json(StreamReader)\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:36.590\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:37.017\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:36.231\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:36.231\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:36.253\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:36.846\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:36.603\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e00:37.017\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003cp\u003e初回にライブラリのロードが入ってるので、逆に遅くなっているかもしれません。基本的にStreamReaderを噛ませたほうが速くなるということはないはずです。この場合は0.1～0.5秒程度、entry.Open()したほうが速いといえるでしょう。（byte[]を変数で取る目的でもなく、StreamReader噛ませてたのがタダの間抜けなだけ）\u003c/p\u003e\n\n\u003cp\u003eコメントで指摘してくださった方、ありがとうございました。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"まとめ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eまとめ\u003c/h2\u003e\n\n\u003cp\u003e以上、ギガバイトクラスのJSONを読み込んでデシリアライズのパフォーマンスを計測しました。この例ではUtf8Jsonがぶっちぎりで強いという結論にはなりませんでしたが、特定の状況下では最速になりました。次のような結論になります。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003cstrong\u003eJil, Utf8Json, ServiceStack.Text\u003c/strong\u003e→どれも優秀。型を指定する場合はServiceStackが最速だが、指定しない場合は型のキャストでハマる可能性はある。Jilは安定して強く、stringからデシリアライズするときに最速。Utf8Jsonはstreamやbyte[]から読み込ませる場合は最速。stringからデシリアライズするのが無駄というのが理解できれば最も性能を引き出せるかもしれない。\u003c/li\u003e\n\u003cli\u003eJson.Net→良くも悪くも普通\u003c/li\u003e\n\u003cli\u003eDataContractJsonSerializer→配布用バイナリに余計なDLLが同梱されないメリットはあるが使いづらい\u003c/li\u003e\n\u003cli\u003eDynamicJSON→7年前のライブラリだしそっとしておいてUtf8Jsonを使ってあげてください\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e今後のアップデートで大きく変わる可能性があるので、期待しましょう。\u003c/p\u003e\n\n\u003cp\u003eすっかり忘れていましたが、これが作りたかったビットコインの2018/1/18～1/24の6日分のティックチャートです。csvで出力してExcelでグラフ化しました。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/1b42e3117b223b453a09be6423cae739d9fa43d4/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3233323038382f65326232373132312d303633332d323033362d656430652d3864303935383936616262372e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F232088%2Fe2b27121-0633-2036-ed0e-8d095896abb7.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=dd83d35c8a2a8500c55e22f73fe5b41a\" alt=\"utf8json5.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/232088/e2b27121-0633-2036-ed0e-8d095896abb7.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F232088%2Fe2b27121-0633-2036-ed0e-8d095896abb7.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=15322ef79ee664e878f0977a8075ec69 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n","createdAt":"2018-01-27T08:01:37Z","elapsedYearsFromLastModifiedAt":3,"encryptedId":"izgcWXyz+Amlzr9HuxKow82Wly1d02+t--h+ecUWn9NO77FXuU--Itk9iIPnSVOLSt46wuA3Qw==","isBanned":false,"isDeprecated":true,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2018-02-01T19:57:58Z","likesCount":53,"linkUrl":"https://qiita.com/koshian2/items/c7e0fe65a27326edf8d0","organization":null,"originalId":603914,"stockedCount":39,"title":"ギガバイトクラスのJSONをデシリアライズするのにUtf8Jsonを使ってみる","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%AF%BE%E8%B1%A1%E3%83%87%E3%83%BC%E3%82%BF\"\u003e対象データ\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#json%E3%82%B7%E3%83%AA%E3%82%A2%E3%83%A9%E3%82%A4%E3%82%B6%E3%83%BC%E4%B8%80%E8%A6%A7\"\u003eJSONシリアライザー一覧\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#1datacontractjsonserializer\"\u003e1.DataContractJsonSerializer\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#2jsonnet\"\u003e2.Json.NET\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#3servicestacktext\"\u003e3.ServiceStack.Text\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#4jil\"\u003e4.Jil\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#5dynamicjson\"\u003e5.DynamicJSON\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#6utf8json\"\u003e6.Utf8Json\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%87%E3%82%B7%E3%83%AA%E3%82%A2%E3%83%A9%E3%82%A4%E3%82%BA%E6%99%82%E9%96%93%E3%81%AE%E6%AF%94%E8%BC%83\"\u003eデシリアライズ時間の比較\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#1%E9%80%90%E6%AC%A1%E5%87%A6%E7%90%86\"\u003e1.逐次処理\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#2%E4%B8%A6%E5%88%97%E5%87%A6%E7%90%86\"\u003e2.並列処理\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#3%E9%80%90%E6%AC%A1%E5%87%A6%E7%90%86stream%E3%82%92%E5%BC%95%E6%95%B0%E3%81%AB%E3%81%99%E3%82%8B\"\u003e3.逐次処理＋Streamを引数にする\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"\u003eまとめ\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":12663,"uuid":"c7e0fe65a27326edf8d0","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"sbv14frZMzQiWW9UMr/9zZaMCGqL--OpGqwxwtgYoqEDEl--rvf3NaWuA9V/sK2Jl6fm5w==","originalId":232088,"description":"C#使ってましたがPythonに浮気してます。IoTでビッグデータをディープラーニングする闇の魔術の趣味をはじめました。 \r\n新刊通販（NumPy本）　https://koshian2.booth.pm/items/2462894  \r\n通販（GAN本）　https://koshian2.booth.pm/items/1835219  \r\n","facebookUrl":null,"githubUrl":"https://github.com/koshian2","isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"koshian2 ＠新刊通販中","profileImageUrl":"https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/232088/bfc82ef2b35f67a9938d0c0b8e47b7f8b31cfd0f/x_large.png?1601448873","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fs3-ap-northeast-1.amazonaws.com%2Fqiita-image-store%2F0%2F232088%2Fbfc82ef2b35f67a9938d0c0b8e47b7f8b31cfd0f%2Fx_large.png%3F1601448873?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=c98698abdf0851b3c66f218d8e9427ba","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fs3-ap-northeast-1.amazonaws.com%2Fqiita-image-store%2F0%2F232088%2Fbfc82ef2b35f67a9938d0c0b8e47b7f8b31cfd0f%2Fx_large.png%3F1601448873?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=1bb883886dc4d0acc43421d9cae720cb","urlName":"koshian2","websiteUrl":"https://blog.shikoan.com","twitterUrl":"https://twitter.com/koshian2","twitterUrlName":"koshian2","revealedOrganizations":{"edges":[]}},"tags":[{"name":"C#","urlName":"csharp"},{"name":"JSON","urlName":"json"},{"name":"ビッグデータ","urlName":"%e3%83%93%e3%83%83%e3%82%b0%e3%83%87%e3%83%bc%e3%82%bf"},{"name":"Jil","urlName":"jil"},{"name":"Utf8Json","urlName":"utf8json"}],"followingLikers":{"edges":[]},"comments":{"totalCount":2}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

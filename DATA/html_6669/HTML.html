<!DOCTYPE html><html><head><meta charset="utf-8" /><title>[C#] イベント入門 - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/laughter/items/e9cf666e0430acc39e95" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="i5E0Z9S/3A7CpfJ6DizJpFUADQSzsxXja4Da55Ay4S9JcooJrqJ4p2P++SK2Q5oPwcdFwHQlvFR2fftrjV6DsA==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta property="og:type" content="article"><meta property="og:title" content="[C#] イベント入門 - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1XME1qWFNEamdxVGpnNW5qZzdQamc0amxoYVhwbG9BJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NTQmdHh0LWNsaXA9ZWxsaXBzaXMmdHh0LWFsaWduPWNlbnRlciUyQ21pZGRsZSZzPWFlN2EwNTQ1ZTBmZWViYWIzOTk5ZDZhOGMxZDkwZThj&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RR3hoZFdkb2RHVnkmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT00NSZ0eHQtYWxpZ249cmlnaHQlMkNib3R0b20mcz0zYzQyZThhNzM5MTFlYmZjMDhlOWQyZThmZTY3YmZmYg&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=26f873f987bfc0462e8e78505b5be6b4"><meta property="og:description" content="

本稿について

この投稿は、C#についてあまり経験のない方がイベントの使い方について理解することを目的としている。
説明の範囲は、


イベントを使用したプログラミングのメリットを理解する
イベントを使用したクラスを実現できる
そ..."><meta content="https://qiita.com/laughter/items/e9cf666e0430acc39e95" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#,初心者向け" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 1nzh4zz 38fzdi helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-1nzh4zz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:16px 32px;background-color:#FBE69E;color:rgba(0,0,0,0.87);line-height:1.5;font-weight:600;}@media (max-width:770px){.css-1nzh4zz{padding:16px;}}.css-38fzdi{color:#CA832A;margin-right:4px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-dfa13824-da8a-4041-be80-7cfabc39486a"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Flaughter%2Fitems%2Fe9cf666e0430acc39e95">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Flaughter%2Fitems%2Fe9cf666e0430acc39e95">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-dfa13824-da8a-4041-be80-7cfabc39486a">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2017-01-18T18:09:04.000+09:00","dateModified":"2020-03-13T14:30:33.000+09:00","headline":"[C#] イベント入門","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1XME1qWFNEamdxVGpnNW5qZzdQamc0amxoYVhwbG9BJnR4dC1jb2xvcj0lMjMzMzMmdHh0LWZvbnQ9SGlyYWdpbm8lMjBTYW5zJTIwVzYmdHh0LXNpemU9NTQmdHh0LWNsaXA9ZWxsaXBzaXMmdHh0LWFsaWduPWNlbnRlciUyQ21pZGRsZSZzPWFlN2EwNTQ1ZTBmZWViYWIzOTk5ZDZhOGMxZDkwZThj\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RR3hoZFdkb2RHVnkmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT00NSZ0eHQtYWxpZ249cmlnaHQlMkNib3R0b20mcz0zYzQyZThhNzM5MTFlYmZjMDhlOWQyZThmZTY3YmZmYg\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=26f873f987bfc0462e8e78505b5be6b4","mainEntityOfPage":"https://qiita.com/laughter/items/e9cf666e0430acc39e95","author":{"@type":"Person","address":"Hamamatsu City, Shizuoka Pref, Japan","email":null,"identifier":"laughter","name":"laughter","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F72443%2Fprofile-images%2F1473699153?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=6e8237d63526abbcb3d6db58e67ba1ef","url":"https://qiita.com/laughter","description":".NETやC#界隈でひっそりと生息しているプログラマ。\r\n薄暗く涼しい場所に生息し、おいしいたべものを与えるとよろこぶ。\r\n春菊は苦手。","memberOf":[]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://zine.qiita.com/interview/202107-hitachi-3/?utm_source=qiita&amp;utm_medium=header-banner">日立の研究者が、2年間ドイツ人工知能研究センターで学んだこと</a><a target="_blank" id="header_text_message_2" href="https://zine.qiita.com/interview/202107-hitachi-3/?utm_source=qiita&amp;utm_medium=header-banner">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"laughter","type":"items","id":"e9cf666e0430acc39e95"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"日立の研究者が、2年間ドイツ人工知能研究センターで学んだこと","url":"https://zine.qiita.com/interview/202107-hitachi-3/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"laughter","type":"items","id":"e9cf666e0430acc39e95"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":0,"pos_id":"header_text_message_1","message":"日立の研究者が、2年間ドイツ人工知能研究センターで学んだこと","url":"https://zine.qiita.com/interview/202107-hitachi-3/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"laughter","type":"items","id":"e9cf666e0430acc39e95"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":0,"pos_id":"header_text_message_2","message":"日立の研究者が、2年間ドイツ人工知能研究センターで学んだこと","url":"https://zine.qiita.com/interview/202107-hitachi-3/?utm_source=qiita\u0026utm_medium=header-banner","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/laughter/items/e9cf666e0430acc39e95","location":"/laughter/items/e9cf666e0430acc39e95","scheme":"https","host":"qiita.com","port":null,"pathname":"/laughter/items/e9cf666e0430acc39e95","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"vESEP2oId8bLCBGJs/PIxZfFOqV/F0m99mR1C/8xBCB+pzpREBXTb2pTGtELnJtuAwJyYbiB4ArrmVSH4l1mvw==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-35461018-3a87-411f-9818-f3d328f14c61"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/laughter/items/e9cf666e0430acc39e95/likers" class="css-1iupg5d">118</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">151</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/e9cf666e0430acc39e95/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/laughter/items/e9cf666e0430acc39e95/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/laughter/items/e9cf666e0430acc39e95/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/laughter/items/e9cf666e0430acc39e95/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/laughter/items/e9cf666e0430acc39e95.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-1nzh4zz"><span class="fa fa-fw fa-warning css-38fzdi"></span><p>More than 1 year has passed since last update.</p></div><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/laughter"><img class="css-100alwu eyfquo10" src="https://qiita-image-store.s3.amazonaws.com/0/72443/profile-images/1473699153" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/laughter" class="css-10ougpm">@<!-- -->laughter</a><div class="css-1ay9vb9"><span><meta content="2017-01-18T09:09:04Z"/><time dateTime="2020-03-13T05:30:33Z" class="css-m19uds">updated at 2020-03-13</time></span></div></div></div></div></div><h1 class="css-cgzq40">[C#] イベント入門</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/%e5%88%9d%e5%bf%83%e8%80%85%e5%90%91%e3%81%91" class="css-4czcte">初心者向け</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div>
<h1>
<span id="本稿について" class="fragment"></span><a href="#%E6%9C%AC%E7%A8%BF%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>本稿について</h1>

<p>この投稿は、C#についてあまり経験のない方がイベントの使い方について理解することを目的としている。<br>
説明の範囲は、</p>

<ul>
<li>イベントを使用したプログラミングのメリットを理解する</li>
<li>イベントを使用したクラスを実現できる</li>
<li>その際、安全性や拡張性に留意できる</li>
</ul>

<p>ようになることにある。以下については、説明の対象外になる。</p>

<ul>
<li>イベントのアクセサを自分で定義する</li>
<li>イベントハンドラとしてラムダ式を使用する</li>
</ul>

<p>また、前提として、</p>

<ul>
<li>ジェネリックプログラミング</li>
</ul>

<p>の知識があるものとしている。</p>

<h1>
<span id="イベントとは" class="fragment"></span><a href="#%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E3%81%A8%E3%81%AF"><i class="fa fa-link"></i></a>イベントとは</h1>

<p>C#におけるイベントとは、一言で言えば、<br>
「デリゲートによるコールバックメカニズムに、安全な購読と購読解除機能を追加するための文法」<br>
ということになるだろう。<br>
そのため、イベントを理解するには、まず、デリゲートやコールバックについておさえておく必要がある。</p>

<h1>
<span id="コールバックとデリゲート" class="fragment"></span><a href="#%E3%82%B3%E3%83%BC%E3%83%AB%E3%83%90%E3%83%83%E3%82%AF%E3%81%A8%E3%83%87%E3%83%AA%E3%82%B2%E3%83%BC%E3%83%88"><i class="fa fa-link"></i></a>コールバックとデリゲート</h1>

<p>ある処理に対し、処理そのものを渡したいことがある。</p>

<p><code>int</code>型の配列を持っているオブジェクトがあるとしよう。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">hoge.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">class</span> <span class="nc">Hoge</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="n">IList</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">_list</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;();</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>この<code>_list</code>の中には、何かの要素が含まれている。<br>
そして、この<code>_list</code>内の要素のうち、奇数の要素を取り出す処理を考える。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">hoge.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">class</span> <span class="nc">Hoge</span>
<span class="p">{</span>
    <span class="p">...</span>

    <span class="k">public</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="nf">GetOdds</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">n</span> <span class="k">in</span> <span class="n">_list</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="p">%</span> <span class="m">2</span> <span class="p">==</span> <span class="m">1</span><span class="p">)</span>
                <span class="k">yield</span> <span class="k">return</span> <span class="n">n</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>できた。<br>
つづいて、3で割って余りが1になる数だけを取り出す処理を考える。<br>
できたら、次は4で割って余りが1になる数、そしたら、5で割って、6で、7で…………</p>

<p>こうした無限にわきでる要望を、ひとつひとつ別のメソッドを作成して満たすのは不可能である。<br>
そこで、「要素を取り出すかどうかを判定する処理そのもの」を渡すことにしよう。</p>

<p>この「要素を取り出すかどうかを判定する処理」は、<code>int</code>型の引数を取り、<code>bool</code>型を返すメソッドになるだろう。<br>
この型のメソッドを渡すには、<code>Func&lt;int, bool&gt;</code>型の引数を使う。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">hoge.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">class</span> <span class="nc">Hoge</span>
<span class="p">{</span>
    <span class="p">...</span>

    <span class="c1">// Use LINQ, Luke.</span>
    <span class="k">public</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="nf">GetNumbers</span><span class="p">(</span><span class="n">Func</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">bool</span><span class="p">&gt;</span> <span class="n">pred</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">n</span> <span class="k">in</span> <span class="n">_list</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="nf">pred</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
                <span class="k">yield</span> <span class="k">return</span> <span class="n">n</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">Xxx</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="kt">bool</span> <span class="nf">Mod3Equals1</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">n</span> <span class="p">%</span> <span class="m">3</span> <span class="p">==</span> <span class="m">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">var</span> <span class="n">hoge</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Hoge</span><span class="p">();</span>
    <span class="p">...</span>
    <span class="kt">var</span> <span class="n">enm</span> <span class="p">=</span> <span class="n">hoge</span><span class="p">.</span><span class="nf">GetNumbers</span><span class="p">(</span><span class="n">Mod3Equals1</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>さあ、これがコールバックだ。<br>
コールバックとは、ある処理(この例では<code>GetNumbers</code>)に対し、そこから呼び出してほしい処理(この例では<code>Mod3Equals1</code>)を渡すことだ。</p>

<p><code>GetNumbers</code>は<code>_list</code>の内部を先頭から順に取り出し、その要素ごとに与えられた引数である<code>Mod3Equals1</code>を呼び出す。<br>
これがtrueを返した場合のみ、その値を戻り値の一部として返すという動作をする。</p>

<p>こうした、大きな処理に対して、その一部になる小さな処理を渡す場合もあるし、「ある処理がおこなわれたという通知処理」を渡す場合もある。<br>
ほとんどのイベントが後者の形を実現するために用いられる。また、前者の形をイベントで実現することも可能だ。</p>

<p>話が飛んでしまった。<br>
C#において、こうした「処理を渡す」際に使用する、メソッドへの参照のことをデリゲートと呼ぶ。<br>
C言語の関数ポインタなどと同様、C#のデリゲートもコールバックを実現するための機能になる。<br>
ただ、C#の場合は、オブジェクト指向言語なので、<br>
「静的メソッドなのか、インスタンスメソッドなのか。インスタンスメソッドだとすれば、どのオブジェクトのそれを呼び出すべきなのか」<br>
という情報まで内部で渡している。</p>

<p>デリゲートには、メソッドであれば何でも渡せるわけではなく、引数の数や型、戻り値の型が一致していなければならない。<br>
前の例では、<br>
「<code>int</code>型の引数を取り、<code>bool</code>型を返す」<br>
という処理を渡すために<code>Func&lt;int, bool&gt;</code>という型を使用した。</p>

<h2>
<span id="定義済みのデリゲートの型" class="fragment"></span><a href="#%E5%AE%9A%E7%BE%A9%E6%B8%88%E3%81%BF%E3%81%AE%E3%83%87%E3%83%AA%E3%82%B2%E3%83%BC%E3%83%88%E3%81%AE%E5%9E%8B"><i class="fa fa-link"></i></a>定義済みのデリゲートの型</h2>

<p>デリゲートには型があり、渡したい処理の引数の数や型、戻り値の組み合わせごとに別々の型として扱わなければならない。<br>
そして、プログラマがその型を定義できるよう、<code>delegate</code>構文が用意されている。</p>

<p>しかし、.NET Frameworkにはデリゲートの型が既にいくつも定義されている。<br>
どんなものがあるかは、以下を参考にして欲しい。<br>
<a href="http://www.atmarkit.co.jp/fdotnet/dotnettips/730dlgttype/dlgttype.html" class="autolink" rel="nofollow noopener" target="_blank">http://www.atmarkit.co.jp/fdotnet/dotnettips/730dlgttype/dlgttype.html</a></p>

<p>この情報の<br>
<code>void Action&lt;T&gt;(T obj)</code><br>
という形式は<br>
「<code>Action&lt;T&gt;</code>型というデリゲートの型は、<code>T</code>型の引数ひとつを取り、戻り値がない」<br>
という意味になる。<br>
こうした型がいくつも用意されているおかげで、プログラマがデリゲートの型を新たに定義する必要は少なくなっている。<br>
なるべく標準で用意されているデリゲートの型を使用しよう。</p>

<h1>
<span id="デリゲートによる通知の実現" class="fragment"></span><a href="#%E3%83%87%E3%83%AA%E3%82%B2%E3%83%BC%E3%83%88%E3%81%AB%E3%82%88%E3%82%8B%E9%80%9A%E7%9F%A5%E3%81%AE%E5%AE%9F%E7%8F%BE"><i class="fa fa-link"></i></a>デリゲートによる通知の実現</h1>

<p>運がいいと労働したときに昇給してもらえる<code>Programmer</code>クラスを考える。この<code>Programmer</code>は昇給するとその情報をうっかり外へ通知する。<br>
通常は、昇給イベントを用意するのだが、今回はデリゲートだけを使用して、昇給を通知することを考えよう。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">Programmer.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">class</span> <span class="nc">Programmer</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="n">Action</span> <span class="n">GetPayRise</span><span class="p">;</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="n">System</span><span class="p">.</span><span class="n">Random</span> <span class="n">_Random</span> <span class="p">=</span> <span class="k">new</span> <span class="n">System</span><span class="p">.</span><span class="nf">Random</span><span class="p">();</span>

    <span class="k">public</span> <span class="nf">Programmer</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="nf">Work</span><span class="p">(</span><span class="kt">int</span> <span class="n">quantity</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="p">...</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">_Random</span><span class="p">.</span><span class="nf">Next</span><span class="p">(</span><span class="m">1000</span><span class="p">)</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">GetPayRise</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
                <span class="nf">GetPayRise</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p><code>Action</code>は、引数なし、戻り値なしの処理を渡すためのデリゲートの型だ。<br>
ここでは、この型の変数(<code>GetPayRise</code>フィールド)を公開することで、他のクラスからその参照を登録することを可能にしている。<br>
そして、この<code>GetPayRise</code>に<code>()</code>をつけることで、登録された処理を呼び出すことができる。事前にnullチェックしているのは、未登録の場合はこの値はnullになって処理の呼び出しが例外を引き起こすからだ。<br>
これで、「とても高い確率」で昇給し、このとき、<code>GetPayRise</code>に登録されているデリゲートを呼び出す仕組みができた。</p>

<p>では、昇給が通知されたときに呼び出される処理を追加してみよう。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">Leader.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">class</span> <span class="nc">Leader</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="n">Programmer</span> <span class="n">_Programmer101</span> <span class="p">=</span> <span class="n">MyCompany</span><span class="p">.</span><span class="nf">GetProgrammer</span><span class="p">(</span><span class="m">101</span><span class="p">);</span>
    <span class="k">private</span> <span class="kt">int</span> <span class="n">_WorkQuantityForProgrammer101</span> <span class="p">=</span> <span class="m">10</span><span class="p">;</span>

    <span class="k">void</span> <span class="nf">Programmer101_GetPayRise</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">_WorkQuantityForProgrammer101</span><span class="p">++;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="nf">Leader</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">_Programmer101</span><span class="p">.</span><span class="n">GetPayRise</span> <span class="p">=</span> <span class="n">Programmer101_GetPayRise</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="nf">DailyProcess</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">_Programmer101</span><span class="p">.</span><span class="nf">Work</span><span class="p">(</span><span class="n">_WorkQuantityForProgrammer101</span><span class="p">);</span>
        <span class="nf">ReadNewsPaper</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>この<code>Leader</code>は、昇給を通知されると、彼への仕事量を増やす処理をおこなう。<br>
コンストラクタの中で<code>_Programmer101</code>の<code>GetPayRise</code>変数に自分の処理(<code>Programmer101_GetPayRise</code>)を登録している。<br>
これで、<code>Programmer101</code>の<code>Work</code>を呼び出せば、ごく稀に昇給が通知され、彼への仕事量を増やすことができるようになった。</p>

<p>こうしたプログラミングスタイルの一番のメリットは、<code>Programmer</code>が<code>Leader</code>の存在にまったく左右されない点だ。<br>
<code>Leader</code>がいても、いなくても、いや、昇給を監視しているオブジェクトが何であっても、まったくいなくても、それを気にかける必要がない。<br>
この結果、<code>Programmer</code>クラスの再利用性は向上する。</p>

<p>次に、<code>Newbie</code>を考える。<br>
<code>Newbie</code>は、<code>Programmer</code>の<code>GetPayRise</code>の通知を受け取ったら、彼を食事に誘う処理をおこなう。もちろんお祝いをするためだ。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">Newbie.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">class</span> <span class="nc">Newbie</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="n">Programmer</span> <span class="n">_Programmer101</span> <span class="p">=</span> <span class="n">MyCompany</span><span class="p">.</span><span class="nf">GetProgrammer</span><span class="p">(</span><span class="m">101</span><span class="p">);</span>

    <span class="k">void</span> <span class="nf">Programmer101_GetPayRise</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nf">InviteToDinner</span><span class="p">(</span><span class="n">_Programmer101</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="nf">Newbie</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">_Programmer101</span><span class="p">.</span><span class="n">GetPayRise</span> <span class="p">+=</span> <span class="n">Programmer101_GetPayRise</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>この<code>Newbie</code>は、<code>_Programmer101</code>の<code>GetPayRise</code>変数に自分の処理を「追加」している。<br>
デリゲートには、マルチキャストデリゲートという機能があって、すでに登録されている処理(<code>Leader</code>の<code>Programmer101_GetPayRise</code>)とあわせて、自分の処理(<code>Newbie</code>の<code>Programmer101_GetPayRise</code>)も呼び出すように追加できるのだ。<br>
呼び出し側(<code>Programmer</code>クラス)は、処理がいくつ登録されているか気にかける必要がない。<br>
そして、追加のためには、<code>+=</code>演算子を用いる。</p>

<p>そう、「追加」だ。<br>
この<code>Newbie</code>のメソッドを「追加」するには、その前に何かが登録済みでなければならない。<br>
そうなると、<code>Leader</code>が<code>_Programmer101</code>にメソッドを登録してから、<code>Newbie</code>のメソッドが登録されなければならないことになってしまう。</p>

<p><code>Newbie</code>だけ見れば、</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">Newbie.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">if</span> <span class="p">(</span><span class="n">_Programmer101</span><span class="p">.</span><span class="n">GetPayRise</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
    <span class="n">_Programmer101</span><span class="p">.</span><span class="n">GetPayRise</span> <span class="p">=</span> <span class="n">Programmer101_GetPayRise</span><span class="p">;</span>
<span class="k">else</span>
    <span class="n">_Programmer101</span><span class="p">.</span><span class="n">GetPayRise</span> <span class="p">+=</span> <span class="n">Programmer101_GetPayRise</span><span class="p">;</span>
</code></pre></div>
</div>

<p>とすることでこの問題を回避できる。<br>
ところが、今度は<code>Leader</code>が<code>_Programmer101.GetPayRise = Programmer101_GetPayRise</code>としているところが問題になる。<br>
これはまったく新しい代入になるので、これ以前に<code>Newbie</code>のメソッドが登録されていても、それが消去されてしまうのだ。</p>

<p>ここでの本当の問題は、<br>
「<code>Programmer101</code>に登録されているデリゲートを、外部から初期化できてしまうこと」<br>
であり、こうした抜け穴は塞がなければならない。<br>
抜け穴と言えば、この形では、<code>Leader</code>や<code>Newbie</code>が、<code>Programmer</code>に登録されているデリゲートを呼び出せてしまう点も問題だ。</p>

<p>こうした、デリゲートの変数を公開することによる問題を解決するための機能。<br>
これがイベントの存在理由だ。</p>

<h1>
<span id="イベントによる通知の実現---sender" class="fragment"></span><a href="#%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E3%81%AB%E3%82%88%E3%82%8B%E9%80%9A%E7%9F%A5%E3%81%AE%E5%AE%9F%E7%8F%BE---sender"><i class="fa fa-link"></i></a>イベントによる通知の実現 - Sender</h1>

<p>今までのポイントをまとめよう。</p>

<ul>
<li>メソッドをデリゲート経由で渡すことによる「通知」の仕組みには、クラス間の依存関係を少なくするメリットがある</li>
<li>マルチキャストデリゲートという機能により、複数のメソッドをひとつの変数に登録することが可能である</li>
<li>ところが、デリゲートの変数を直接公開してしまうのには安全性に問題がある</li>
<li>こうした問題を解決するのがイベントである</li>
</ul>

<p>ここで、語句を定義する。</p>

<ul>
<li>メソッドをデリゲート経由で渡して登録することを「subscribe」</li>
<li>渡したメソッドの登録を解除することを「unsubscribe」</li>
<li>メソッドを受け取り、条件によってその登録されているメソッドを呼び出すオブジェクトを「Sender」</li>
<li>メソッドを登録し、デリゲート経由で機能を呼び出されるオブジェクトを「Receiver」</li>
</ul>

<p>いろいろな流儀があるが、この投稿の中では、この語句を使うことにする。<br>
この投稿外で使っても、支障のない語句を選択したつもりだ。</p>

<p><code>Programmer</code>の例では、<code>Programmer</code>クラスがSender役であり、Receiver役は<code>Leader</code>, <code>Newbie</code>クラスだ。</p>

<p>さて、イベントを使ったとき、<code>Programmer</code>の例がどうなるか見てみよう。<br>
まず、Sender役のクラスはどうなるか。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">Programmer.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">class</span> <span class="nc">Programmer</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">event</span> <span class="n">EventHandler</span> <span class="n">GetPayRise</span><span class="p">;</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="n">System</span><span class="p">.</span><span class="n">Random</span> <span class="n">_Random</span> <span class="p">=</span> <span class="k">new</span> <span class="n">System</span><span class="p">.</span><span class="nf">Random</span><span class="p">();</span>

    <span class="k">public</span> <span class="nf">Programmer</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>

    <span class="k">public</span> <span class="k">virtual</span> <span class="k">void</span> <span class="nf">Work</span><span class="p">(</span><span class="kt">int</span> <span class="n">quantity</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="p">...</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">_Random</span><span class="p">.</span><span class="nf">Next</span><span class="p">(</span><span class="m">1000</span><span class="p">)</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>
            <span class="nf">OnGetPayRise</span><span class="p">(</span><span class="n">EventArgs</span><span class="p">.</span><span class="n">Empty</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">protected</span> <span class="k">virtual</span> <span class="k">void</span> <span class="nf">OnGetPayRise</span><span class="p">(</span><span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">GetPayRise</span><span class="p">?.</span><span class="nf">Invoke</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">e</span><span class="p">);</span>  <span class="c1">// C#6.0以上でのみ可能</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<h2>
<span id="イベントの定義" class="fragment"></span><a href="#%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E3%81%AE%E5%AE%9A%E7%BE%A9"><i class="fa fa-link"></i></a>イベントの定義</h2>

<p>まず、イベントを定義している。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">event</span> <span class="n">EventHandler</span> <span class="n">GetPayRise</span><span class="p">;</span>
</code></pre></div></div>

<p>これは、</p>

<ul>
<li>イベントのsubscribe、unsubscribeはどこからでも可能である</li>
<li>登録するメソッドは、<code>EventHandler</code>と型が一致していなければならない</li>
<li>このイベントの名前は<code>GetPayRise</code>である</li>
</ul>

<p>ということの宣言である。<br>
<code>EventHandler</code>というデリゲート型は、.NET Frameworkに定義済みの型であり、</p>

<ul>
<li>ひとつめの引数が<code>Object</code>型、ふたつめの引数が<code>EventArgs</code>型</li>
<li>戻り値はない</li>
</ul>

<p>という意味になる。<br>
これにより、登録できるメソッドは<code>void Xxxxx(object, EventArgs)</code>という形で宣言されているものに限定される。</p>

<h2>
<span id="デリゲートを呼び出すメソッドの定義" class="fragment"></span><a href="#%E3%83%87%E3%83%AA%E3%82%B2%E3%83%BC%E3%83%88%E3%82%92%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%99%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%AE%E5%AE%9A%E7%BE%A9"><i class="fa fa-link"></i></a>デリゲートを呼び出すメソッドの定義</h2>

<p>そして、登録されているデリゲートを呼び出すメソッドを定義する。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">protected</span> <span class="k">virtual</span> <span class="k">void</span> <span class="nf">OnGetPayRise</span><span class="p">(</span><span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
</code></pre></div></div>

<ul>
<li>メソッドの名前は、<code>On</code> + イベントの名前</li>
<li>仮想メソッド</li>
<li>可視性は<code>protected</code>
</li>
<li>引数は<code>EventArgs</code>型</li>
</ul>

<p>であることに注意して欲しい。<br>
メソッドにこうした名前を付けるのは.NET Frameworkの慣例だ。<br>
可視性と引数については、こうしなければならない理由を後述する。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="n">GetPayRise</span><span class="p">?.</span><span class="nf">Invoke</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">e</span><span class="p">);</span>
</code></pre></div></div>

<p>その内部の処理では、イベントと同名の変数として暗黙的に宣言されている<code>GetPayRise</code>を使用する。<br>
この変数はデリゲート型の値として扱うことができるので、nullでない場合にのみ、デリゲートを呼び出すようにする。<br>
呼び出す際は、ひとつめの引数にはthis、ふたつめの引数には受け取った引数を渡す。<br>
C#6.0以前には<code>?.</code>演算子がないので、</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">protected</span> <span class="k">virtual</span> <span class="k">void</span> <span class="nf">OnGetPayRise</span><span class="p">(</span><span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">GetPayRise</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
        <span class="nf">GetPayRise</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">e</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>という形になる。<br>
スレッド安全性に注意する必要があるのならば、以下のようにする必要があって少々面倒だ。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">protected</span> <span class="k">virtual</span> <span class="k">void</span> <span class="nf">OnGetPayRise</span><span class="p">(</span><span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">getPayRise</span> <span class="p">=</span> <span class="n">GetPayRise</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">getPayRise</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
        <span class="nf">getPayRise</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">e</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>イベントを通知したい箇所(この例では、<code>Programmer</code>の<code>Work</code>メソッドの内部になる)では、この<code>OnGetPayRise</code>メソッドを呼び出すようにする。</p>

<p><code>OnGetPayRise</code>を呼び出すとき、毎回、<code>new EventArgs()</code>としてインスタンスを生成してもいいのだが、このクラスには<code>Empty</code>という静的フィールドが用意されており、これをインスタンスの生成の代わりに用いることができる。<br>
毎回インスタンスを生成するよりも、ほんの少しだけ早くなるかもしれない。</p>

<h2>
<span id="sender側にはsubscribeの記述をしてはいけない" class="fragment"></span><a href="#sender%E5%81%B4%E3%81%AB%E3%81%AFsubscribe%E3%81%AE%E8%A8%98%E8%BF%B0%E3%82%92%E3%81%97%E3%81%A6%E3%81%AF%E3%81%84%E3%81%91%E3%81%AA%E3%81%84"><i class="fa fa-link"></i></a>Sender側にはsubscribeの記述をしてはいけない</h2>

<p>重要なのは、Sender役のクラスにはsubscribeの記述は一切しないことだ。<br>
なんらかの方法でReceiverをSenderに渡し、ここでsubscribeすることもできるのだが、これをしてしまうと前述のメリット、「クラス間の依存関係を少なくする」が完全に失われてしまう。<br>
subscribeの記述はReceiver役のクラスにしよう。</p>

<h2>
<span id="イベントの定義の補足" class="fragment"></span><a href="#%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E3%81%AE%E5%AE%9A%E7%BE%A9%E3%81%AE%E8%A3%9C%E8%B6%B3"><i class="fa fa-link"></i></a>イベントの定義の補足</h2>

<p>イベントの可視性とは、あくまで、subscribeとunsubscribeについてだけのものになる。<br>
これがどんな可視性で定義されていようとも、登録されているデリゲートの呼び出し自体は、自分自身か、あるいはその内部クラスからのみ可能であることに注意してほしい。<br>
外部からはもちろん、<code>Programmer</code>の派生クラスからも、直接、デリゲートを呼び出すことはできない。</p>

<p>また、イベントの名前は動詞や動詞句にしよう。<br>
イベント間で前後関係がある場合は、前のものにingをつけて進行形に、後のものは過去形にする。<br>
例えば、ClosingとClosedのように。</p>

<h2>
<span id="デリゲートを呼び出すメソッドの補足" class="fragment"></span><a href="#%E3%83%87%E3%83%AA%E3%82%B2%E3%83%BC%E3%83%88%E3%82%92%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%99%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%AE%E8%A3%9C%E8%B6%B3"><i class="fa fa-link"></i></a>デリゲートを呼び出すメソッドの補足</h2>

<blockquote>
<p>登録されているデリゲートの呼び出し自体は、自分自身か、あるいはその内部クラスからのみ可能</p>
</blockquote>

<p>と述べた。これこそが、<code>OnGetPayRise</code>というメソッドが必要な理由になる。</p>

<p><code>Programmer</code>を継承した<code>SuperProgrammer</code>クラスを考える。<br>
<code>SuperProgrammer</code>は技術が高いので、もう少し、昇給の確率を向上させたい。<br>
ところが、<code>SuperProgrammer</code>からは<code>GetPayRise</code>変数からデリゲートを呼び出せない。もし、<code>protected</code>な<code>OnGetPayRise</code>メソッドがなければ、<code>SuperProgrammer</code>クラスには、<code>GetPayRise</code>に登録されているデリゲートを呼び出す方法が一切ないことになる。<br>
<code>OnGetPayRise</code>が<code>protected</code>として宣言されなければならないのは、こうした理由だ。</p>

<div class="code-frame" data-lang="c#">
<div class="code-lang"><span class="bold">SuperProgrammer.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">class</span> <span class="nc">SuperProgrammer</span> <span class="p">:</span> <span class="n">Programmer</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">Work</span><span class="p">(</span><span class="kt">int</span> <span class="n">quantity</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="p">...</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">_Random</span><span class="p">.</span><span class="nf">Next</span><span class="p">(</span><span class="m">1000</span><span class="p">)</span> <span class="p">&lt;=</span> <span class="m">10</span><span class="p">)</span>
            <span class="c1">// Compile Error!</span>
            <span class="n">GetPayRise</span><span class="p">?.</span><span class="nf">Invoke</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">EventArgs</span><span class="p">.</span><span class="n">Empty</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>また、<code>EventArgs</code>型にはまったく情報が含まれていないので、<code>OnGetPayRise</code>メソッドを呼び出すたびに<code>EventArgs.Empty</code>を使用する代わりに、<code>OnGetPayRise</code>から引数を消しさりたくなる衝動にかられるだろう。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">NG.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="c1">// Bad knowhow</span>
<span class="k">protected</span> <span class="k">virtual</span> <span class="k">void</span> <span class="nf">OnGetPayRise</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">GetPayRise</span><span class="p">?.</span><span class="nf">Invoke</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">EventArgs</span><span class="p">.</span><span class="n">Empty</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>こうした衝動にはあらがわなければならない。<br>
なぜなら、このクラスを継承した<code>SuperProgrammer</code>では、新たな給料の額を持たせた<code>EventArgs</code>の派生クラスのオブジェクトを通知に使用したくなるかもしれないからだ。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">SuperProgrammer.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">class</span> <span class="nc">SuperProgrammer</span> <span class="p">:</span> <span class="n">Programmer</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">Work</span><span class="p">(</span><span class="kt">int</span> <span class="n">quantity</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="p">...</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">_Random</span><span class="p">.</span><span class="nf">Next</span><span class="p">(</span><span class="m">1000</span><span class="p">)</span> <span class="p">&lt;=</span> <span class="m">10</span><span class="p">)</span>
            <span class="nf">OnGetPayRise</span><span class="p">(</span><span class="k">new</span> <span class="nf">SalaryEventArgs</span><span class="p">(</span><span class="n">_CurrentSalary</span> <span class="p">+</span> <span class="m">10000</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="p">...</span>

<span class="k">class</span> <span class="nc">SalaryEventArgs</span> <span class="p">:</span> <span class="n">EventArgs</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nf">SalaryEventArgs</span><span class="p">(</span><span class="kt">int</span> <span class="n">salary</span><span class="p">)</span> <span class="p">:</span> <span class="k">base</span><span class="p">()</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p><code>OnGetPayRise</code>メソッドに引数がなければ、こうした拡張の芽をつんでしまうことになる。<br>
引数がないメソッドを作りたければ別に定義し、その内部で引数がある方のメソッドを呼び出すようにしよう。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">OK.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">protected</span> <span class="k">virtual</span> <span class="k">void</span> <span class="nf">OnGetPayRise</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nf">OnGetPayRise</span><span class="p">(</span><span class="n">EventArgs</span><span class="p">.</span><span class="n">Empty</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>なお、Sender役のクラスが<code>sealed</code>として定義されている場合、このクラスを継承することはできないのだから、こうした気遣いは不要になる。</p>

<h1>
<span id="イベントによる通知の実現---receiver" class="fragment"></span><a href="#%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E3%81%AB%E3%82%88%E3%82%8B%E9%80%9A%E7%9F%A5%E3%81%AE%E5%AE%9F%E7%8F%BE---receiver"><i class="fa fa-link"></i></a>イベントによる通知の実現 - Receiver</h1>

<p>Receiver役のクラスには、イベントのsubscribeとunsubscribe、そして呼び出してほしい処理を記述することになる。<br>
<code>Leader</code>クラスの例で説明しよう。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">Leader.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">class</span> <span class="nc">Leader</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="n">Programmer</span> <span class="n">_Programmer101</span> <span class="p">=</span> <span class="n">MyCompany</span><span class="p">.</span><span class="nf">GetProgrammer</span><span class="p">(</span><span class="m">101</span><span class="p">);</span>
    <span class="k">private</span> <span class="kt">int</span> <span class="n">WorkQuantityForProgrammer101</span> <span class="p">=</span> <span class="m">10</span><span class="p">;</span>

    <span class="k">void</span> <span class="nf">Programmer101_GetPayRise</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">WorkQuantityForProgrammer101</span><span class="p">++;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="nf">Leader</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">_Programmer101</span><span class="p">.</span><span class="n">GetPayRise</span> <span class="p">+=</span> <span class="n">Programmer101_GetPayRise</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p><code>_Programmer101.GetPayRise</code>はもはやデリゲートの変数ではない。<br>
そのため、Receiver側から登録されているデリゲートを呼び出せてしまうという安全上の問題は解消されている。<br>
デリゲートの変数ではないにもかかわらず、マルチキャストデリゲートにある、複数のメソッドを登録できるというメリットは保ったままなので、いくらでもsubscribeできる。</p>

<p>subscribeは</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>senderオブジェクト.イベント名 += 登録したいメソッド名;
</code></pre></div></div>

<p>unsubscribeは</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>senderオブジェクト.イベント名 -= 登録解除したいメソッド名;
</code></pre></div></div>

<p>と記述する。<br>
他のメソッドへの参照が登録されているかどうかを気にかける必要はないし、既に登録されているデリゲートの初期化もできないようになっている。</p>

<p>ところで、<code>Programmer101_GetPayRise</code>のような、イベント用にデリゲートとして渡されるメソッドのことを「イベントハンドラ」と呼ぶ。<br>
イベントの定義時に使用した<code>EventHandler</code>というデリゲートの型は、まさにこれが理由で名付けられている。</p>

<h2>
<span id="メモリリークに注意する" class="fragment"></span><a href="#%E3%83%A1%E3%83%A2%E3%83%AA%E3%83%AA%E3%83%BC%E3%82%AF%E3%81%AB%E6%B3%A8%E6%84%8F%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>メモリリークに注意する</h2>

<p>Receiverの寿命が、Senderとさして変わらず、イベントを常に通知して欲しいのであれば、unsubscribeは不要である。<br>
しかし、Receiverの方が寿命が短い場合はちがう。<br>
Senderは、subscribeしている間、Receiverへの参照を持ちづづける。<br>
そのため、Recevierは不要なったとしても、ガベージコレクタがいつまでたってもReceiverをメモリから削除してくれない。<br>
おまけに、不要なデリゲート呼び出しが積み重なる結果になる。<br>
こうした場合、Receiverが不要になったらきちんとunsubscribeしよう。</p>

<h2>
<span id="今となっては古い情報" class="fragment"></span><a href="#%E4%BB%8A%E3%81%A8%E3%81%AA%E3%81%A3%E3%81%A6%E3%81%AF%E5%8F%A4%E3%81%84%E6%83%85%E5%A0%B1"><i class="fa fa-link"></i></a>今となっては古い情報</h2>

<p>イベントのsubscribe, unsubscribeのとき、</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="n">_Programmer101</span><span class="p">.</span><span class="n">GetPayRise</span> <span class="p">+=</span> <span class="k">new</span> <span class="nf">EventHandler</span><span class="p">(</span><span class="n">Programmer101_GetPayRise</span><span class="p">);</span>
</code></pre></div></div>

<p>というように、<code>new EventHandler()</code>が必要だ、としている情報がある。<br>
しかし、C#3.0からはこれは不要になった。もう付けなくてかまわない。</p>

<h1>
<span id="イベント引数に情報を持たせたイベント通知" class="fragment"></span><a href="#%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E5%BC%95%E6%95%B0%E3%81%AB%E6%83%85%E5%A0%B1%E3%82%92%E6%8C%81%E3%81%9F%E3%81%9B%E3%81%9F%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E9%80%9A%E7%9F%A5"><i class="fa fa-link"></i></a>イベント引数に情報を持たせたイベント通知</h1>

<p>プログラマも人間である。人間であるからには休みが欲しい。<br>
そこで、プログラマは労働すると、ある確率で休暇を申請し、それを通知することにしよう。<br>
休暇の申請には、「いつ休むか」の情報が必要だ。</p>

<h2>
<span id="新しいイベント引数型の定義" class="fragment"></span><a href="#%E6%96%B0%E3%81%97%E3%81%84%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E5%BC%95%E6%95%B0%E5%9E%8B%E3%81%AE%E5%AE%9A%E7%BE%A9"><i class="fa fa-link"></i></a>新しいイベント引数型の定義</h2>

<p>まず、「いつ休むか」の情報を含んだイベント引数の型を宣言する。<br>
これは、<code>EventArgs</code>クラスの派生クラスとしなければならない。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">VacationEventArgs.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">class</span> <span class="nc">VacationEventArgs</span> <span class="p">:</span> <span class="n">EventArgs</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nf">VacationEventArgs</span><span class="p">(</span><span class="n">DateTime</span> <span class="n">date</span><span class="p">)</span>
        <span class="p">:</span> <span class="k">base</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">VacationDate</span> <span class="p">=</span> <span class="n">date</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="n">DateTime</span> <span class="n">VacationDate</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p><code>EventArgs</code>を継承したクラスの名前の後ろには<code>EventArgs</code>をつけて、イベント引数のための型であることを強調するとよい。<br>
ここでは、休暇情報ということで、<code>VacationEventArgs</code>クラスとした。</p>

<h2>
<span id="sender役のクラス" class="fragment"></span><a href="#sender%E5%BD%B9%E3%81%AE%E3%82%AF%E3%83%A9%E3%82%B9"><i class="fa fa-link"></i></a>Sender役のクラス</h2>

<p>次はプログラマだ。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">Programmer.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">class</span> <span class="nc">Programmer</span>
<span class="p">{</span>
    <span class="p">...</span>
    <span class="k">public</span> <span class="k">event</span> <span class="n">EventHandler</span><span class="p">&lt;</span><span class="n">VacationEventArgs</span><span class="p">&gt;</span> <span class="n">ApplyVacation</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">virtual</span> <span class="k">void</span> <span class="nf">Work</span><span class="p">(</span><span class="kt">int</span> <span class="n">quantity</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="p">...</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">_Random</span><span class="p">.</span><span class="nf">Next</span><span class="p">(</span><span class="m">20</span><span class="p">)</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>
            <span class="nf">OnApplyVacation</span><span class="p">(</span><span class="k">new</span> <span class="nf">VacationEventArgs</span><span class="p">(</span><span class="n">DateTime</span><span class="p">.</span><span class="n">Today</span><span class="p">.</span><span class="nf">AddMonths</span><span class="p">(</span><span class="m">1</span><span class="p">)));</span>
    <span class="p">}</span>

    <span class="k">protected</span> <span class="k">virtual</span> <span class="k">void</span> <span class="nf">OnApplyVacation</span><span class="p">(</span><span class="n">VacationEventArgs</span> <span class="n">e</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">ApplyVacation</span><span class="p">?.</span><span class="nf">Invoke</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">e</span><span class="p">);</span>  <span class="c1">// C#6.0以上でのみ可能</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>注意するべき点は、以下の点ぐらいだろうか。</p>

<ol>
<li>イベントの定義中、デリゲートの型が<code>EventHanlder&lt;VacationEventArgs&gt;</code>になっている</li>
<li>デリゲートを呼び出すメソッドの引数が、<code>VacationEventArgs</code>になっている</li>
</ol>

<p>.NET Frameworkに定義されているデリゲートの型である<code>EventHandler&lt;TEventArgs&gt;</code>は、</p>

<ul>
<li>ひとつめの引数が<code>Object</code>型、ふたつめの引数が<code>TEventArgs</code>型</li>
<li>戻り値はない</li>
</ul>

<p>という意味になる。<br>
そして、<code>TEventArgs</code>に与える型は、<code>EventArgs</code>か、その派生クラスでなければならない。<br>
これが、<code>VacationEventArgs</code>を<code>EventArgs</code>を継承して実装した理由だ。</p>

<p>ところで、「変更可能なオブジェクトの参照を漏らさない」という鉄則がある。<br>
これは主にプロパティやメソッドの戻り値として言われがちなルールであるが、イベント引数にもあてはまる金言だ。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">NG.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">class</span> <span class="nc">ExVacationEventArgs</span> <span class="p">:</span> <span class="n">VacationEventArgs</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nf">ExVacationEventArgs</span> <span class="p">(</span><span class="n">DateTime</span> <span class="n">date</span><span class="p">,</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">DateTime</span><span class="p">&gt;</span> <span class="n">vacationHistory</span><span class="p">)</span>
        <span class="p">:</span> <span class="k">base</span><span class="p">(</span><span class="n">date</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">VacationHistory</span> <span class="p">=</span> <span class="n">vacationHistory</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">DateTime</span><span class="p">&gt;</span> <span class="n">VacationHistory</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">Programmer</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">event</span> <span class="n">EventHandler</span><span class="p">&lt;</span><span class="n">ExVacationEventArgs</span><span class="p">&gt;</span> <span class="n">ExApplyVacation</span><span class="p">;</span>
    <span class="k">private</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">DateTime</span><span class="p">&gt;</span> <span class="n">_VacationHistory</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">virtual</span> <span class="k">void</span> <span class="nf">Work</span><span class="p">(</span><span class="kt">int</span> <span class="n">quantity</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="p">...</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">_Random</span><span class="p">.</span><span class="nf">Next</span><span class="p">(</span><span class="m">20</span><span class="p">)</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>
            <span class="c1">// Bad!</span>
            <span class="nf">OnExApplyVacation</span><span class="p">(</span><span class="k">new</span> <span class="nf">ExVacationEventArgs</span><span class="p">(</span><span class="n">DateTime</span><span class="p">.</span><span class="n">Today</span><span class="p">.</span><span class="nf">AddMonths</span><span class="p">(</span><span class="m">1</span><span class="p">),</span> <span class="n">_VacationHistory</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>上記のコードでは、Receiverから<code>Programmer</code>の<code>_VacationHistory</code>の値を操作することが可能になっている。<br>
<code>ExVacationEventArgs</code>が保持しているのは<code>IEnumerable&lt;DateTime&gt;</code>だから直接値を操作することはできないと言えばできないのだが、Receiverがキャストしてしまえば操作し放題になってしまう。<br>
これでは、悪意のあるReceiverから、取得した覚えのない休暇が追加されてしまう恐れがある。<br>
悪い上司から身をまもるために、イベント引数には<code>_VacationHistory</code>のコピーやReadOnlyのコレクションを渡そう。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">OK.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">virtual</span> <span class="k">void</span> <span class="nf">Work</span><span class="p">(</span><span class="kt">int</span> <span class="n">quantity</span><span class="p">)</span>
<span class="p">{</span>
    <span class="p">...</span>
    <span class="kt">var</span> <span class="n">e</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ExVacationEventArgs</span><span class="p">(</span>
        <span class="n">DateTime</span><span class="p">.</span><span class="n">Today</span><span class="p">.</span><span class="nf">AddMonth</span><span class="p">(</span><span class="m">1</span><span class="p">),</span>
        <span class="n">_VacationHistory</span><span class="p">.</span><span class="nf">ToArray</span><span class="p">());</span>
    <span class="nf">OnExApplyVacation</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</div>

<h2>
<span id="receiver役のクラス" class="fragment"></span><a href="#receiver%E5%BD%B9%E3%81%AE%E3%82%AF%E3%83%A9%E3%82%B9"><i class="fa fa-link"></i></a>Receiver役のクラス</h2>

<p>さて、Receiver側だ。<br>
<code>Leader</code>は<code>Programmer</code>が休暇を申請すると、スケジュールの調整をしなくてはならない。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">Leader.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">class</span> <span class="nc">Leader</span>
<span class="p">{</span>
    <span class="p">...</span>

    <span class="k">void</span> <span class="nf">AdjustSchedule</span><span class="p">(</span><span class="n">Programmer</span> <span class="n">programmer</span><span class="p">,</span> <span class="n">DateTime</span> <span class="n">vacation</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="p">...</span>
    <span class="p">}</span>

    <span class="k">void</span> <span class="nf">Programmer101_ApplyVacation</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">VacationEventArgs</span> <span class="n">e</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nf">AdjustSchedule</span><span class="p">(</span><span class="n">sender</span> <span class="k">as</span> <span class="n">Programmer</span><span class="p">,</span> <span class="n">e</span><span class="p">.</span><span class="n">Date</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="nf">Leader</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="p">...</span>
        <span class="n">_Programmer101</span><span class="p">.</span><span class="n">ApplyVacation</span> <span class="p">+=</span> <span class="n">Programmer101_ApplyVacation</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>このイベントハンドラ(<code>Programmer101_ApplyVacataion</code>)のふたつめの引数が<code>VacationEventArgs</code>になっている。<br>
イベントが通知されると、つまり、<code>Programmer101_ApplyVacation</code>が呼び出されると、</p>

<ul>
<li>ひとつめの引数には、イベントを発生したオブジェクト、つまりSender。この例では<code>_Programmer101</code>
</li>
<li>ふたつめの引数には、Senderが生成したイベント引数</li>
</ul>

<p>が渡される。(もちろん、そうなるようにSenderを実装したからだ)<br>
<code>Programmer101_ApplyVacation</code>の内部では、この渡された情報を利用して、自分自身の<code>AdjustSchedule</code>メソッドを呼び出している。</p>

<p>次に、<code>Newbie</code>に再登場してもらおう。<br>
<code>Newbie</code>は、<code>Programmer</code>が休暇を申請すると、何をするわけでもないが、ただうらやましがる。<br>
彼はまだ有給休暇を取得していないので、自分も休むだとか、休んだ上で<code>Programmer</code>を遊びに誘うといったことはできないのだ。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">Newbie.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">class</span> <span class="nc">Newbie</span>
<span class="p">{</span>
    <span class="p">...</span>

    <span class="k">void</span> <span class="nf">Programmer101_ApplyVacation</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nf">Envy</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="nf">Newbie</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="p">...</span>
        <span class="n">_Programmer101</span><span class="p">.</span><span class="n">ApplyVacation</span> <span class="p">+=</span> <span class="n">Programmer101_ApplyVacation</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p><code>Programmer101_ApplyVacation</code>のふたつめの引数の型が<code>EventArgs</code>になっているところに注意して欲しい。<br>
実のところ、このイベントハンドラのふたつめの引数の型は<code>VacationEventArgs</code>かその基底クラスでさえあれば、どんな型でもかまわない。<code>Object</code>にしてもよいのだ。<br>
<code>Newbie</code>の場合、うらやましがるのにはなんの情報も必要ないため、<code>EventArgs</code>として通知を受け取っている。</p>

<h2>
<span id="今となっては古い情報-1" class="fragment"></span><a href="#%E4%BB%8A%E3%81%A8%E3%81%AA%E3%81%A3%E3%81%A6%E3%81%AF%E5%8F%A4%E3%81%84%E6%83%85%E5%A0%B1-1"><i class="fa fa-link"></i></a>今となっては古い情報</h2>

<p>情報を渡すイベントを定義する場合は、</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>delegate void MyEventHandler(object sender, VacationEventArgs e);
</code></pre></div></div>

<p>というように、デリゲートを定義しよう、と書かれている情報がある。<br>
C#2.0以降では、<code>EventHandler&lt;TEventArgs&gt;</code>がすでに定義されているので、こうした定義は不要になった。</p>

<h1>
<span id="まとめ" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>まとめ</h1>

<ul>
<li>イベントは、デリゲートによるコールバックメカニズムに、安全なsubscribe/unsubscribe機能を追加する</li>
<li>イベントを用いると、クラス間の依存関係を少なくすることができる</li>
<li>デリゲートの型は、自分で定義するよりも定義済みのものを選択しよう</li>
<li>デリゲートを呼び出すメソッドを定義するときは、そのクラスを継承する場合について考慮しよう</li>
<li>Sender役のクラスには、subscribeの記述をしてはいけない</li>
<li>Receiverの寿命がSenderよりも短い場合、unsubscribeしてメモリリークを防ごう</li>
<li>情報を渡すイベントのために、<code>EventArgs</code>を継承したクラスを定義し、イベントのデリゲートの型に<code>EventHandler&lt;TEventArgs&gt;</code>を使用しよう</li>
<li>
<code>EventArgs</code>の派生クラスのインスタンス作成の際、変更可能なオブジェクトの参照を漏らさないようにしよう</li>
</ul>

<h1>
<span id="後書き" class="fragment"></span><a href="#%E5%BE%8C%E6%9B%B8%E3%81%8D"><i class="fa fa-link"></i></a>後書き</h1>

<p>以前、イベントについてまとめた投稿について、<br>
「混乱があるように見えるのだが、(何かの目的があって)わざとやっているのではないか」<br>
というコメントをして、いたく投稿者の気分を害してしまったことがあった。<br>
<a href="http://qiita.com/hibara/items/9fd56a5d594c000a5df0" class="autolink" id="reference-363de6211f11ae9875e0">http://qiita.com/hibara/items/9fd56a5d594c000a5df0</a></p>

<p>罪滅ぼしというわけでもないのだが、これでイベントについてスムーズな理解をしてもらえたらと思う。</p>

<h1>
<span id="参考情報" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E6%83%85%E5%A0%B1"><i class="fa fa-link"></i></a>参考情報</h1>

<p>C#6.0時代のイベント実装方法<br>
<a href="http://qiita.com/zakuro9715/items/107b9aa60b114beb206a" class="autolink" id="reference-e354008ea323b2d0ed78">http://qiita.com/zakuro9715/items/107b9aa60b114beb206a</a></p>

<p>++C++; // 未確認飛行C<br>
<a href="http://ufcpp.net/" class="autolink" rel="nofollow noopener" target="_blank">http://ufcpp.net/</a></p>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Flaughter%2Fitems%2Fe9cf666e0430acc39e95&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Flaughter%2Fitems%2Fe9cf666e0430acc39e95&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/laughter/items/e9cf666e0430acc39e95/likers" class="css-1iupg5d">118</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">151</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/e9cf666e0430acc39e95/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/laughter/items/e9cf666e0430acc39e95/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/laughter/items/e9cf666e0430acc39e95/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/laughter/items/e9cf666e0430acc39e95/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/laughter/items/e9cf666e0430acc39e95.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-35461018-3a87-411f-9818-f3d328f14c61">{"authorAnalyticsTrackingId":null,"organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-c1822d6e-a0bd-4c47-9588-cc9c3e1bb472"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-c1822d6e-a0bd-4c47-9588-cc9c3e1bb472">{}</script>
      
<div id="LoginModal-react-component-d7d0d7d0-0ce5-4318-a42d-5777725dd240"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-d7d0d7d0-0ce5-4318-a42d-5777725dd240">{}</script>
      
<div id="StockModal-react-component-1081ff21-2386-478a-a73a-39edf23d2ef8"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-1081ff21-2386-478a-a73a-39edf23d2ef8">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;xlKZTysB/ae6rnVz7A5t5JPkrSAtpXYB+LXufSVaISIEsSchURxZDhv1fitUYT5PByPl5Ooz37blSM/xODZDvQ==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\n\u003ch1\u003e\n\u003cspan id=\"本稿について\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%9C%AC%E7%A8%BF%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e本稿について\u003c/h1\u003e\n\n\u003cp\u003eこの投稿は、C#についてあまり経験のない方がイベントの使い方について理解することを目的としている。\u003cbr\u003e\n説明の範囲は、\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eイベントを使用したプログラミングのメリットを理解する\u003c/li\u003e\n\u003cli\u003eイベントを使用したクラスを実現できる\u003c/li\u003e\n\u003cli\u003eその際、安全性や拡張性に留意できる\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eようになることにある。以下については、説明の対象外になる。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eイベントのアクセサを自分で定義する\u003c/li\u003e\n\u003cli\u003eイベントハンドラとしてラムダ式を使用する\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eまた、前提として、\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eジェネリックプログラミング\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eの知識があるものとしている。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"イベントとは\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E3%81%A8%E3%81%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eイベントとは\u003c/h1\u003e\n\n\u003cp\u003eC#におけるイベントとは、一言で言えば、\u003cbr\u003e\n「デリゲートによるコールバックメカニズムに、安全な購読と購読解除機能を追加するための文法」\u003cbr\u003e\nということになるだろう。\u003cbr\u003e\nそのため、イベントを理解するには、まず、デリゲートやコールバックについておさえておく必要がある。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"コールバックとデリゲート\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B3%E3%83%BC%E3%83%AB%E3%83%90%E3%83%83%E3%82%AF%E3%81%A8%E3%83%87%E3%83%AA%E3%82%B2%E3%83%BC%E3%83%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eコールバックとデリゲート\u003c/h1\u003e\n\n\u003cp\u003eある処理に対し、処理そのものを渡したいことがある。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eint\u003c/code\u003e型の配列を持っているオブジェクトがあるとしよう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ehoge.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eHoge\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eIList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003e_list\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eこの\u003ccode\u003e_list\u003c/code\u003eの中には、何かの要素が含まれている。\u003cbr\u003e\nそして、この\u003ccode\u003e_list\u003c/code\u003e内の要素のうち、奇数の要素を取り出す処理を考える。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ehoge.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eHoge\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e...\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eIEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetOdds\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003e_list\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eyield\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eできた。\u003cbr\u003e\nつづいて、3で割って余りが1になる数だけを取り出す処理を考える。\u003cbr\u003e\nできたら、次は4で割って余りが1になる数、そしたら、5で割って、6で、7で…………\u003c/p\u003e\n\n\u003cp\u003eこうした無限にわきでる要望を、ひとつひとつ別のメソッドを作成して満たすのは不可能である。\u003cbr\u003e\nそこで、「要素を取り出すかどうかを判定する処理そのもの」を渡すことにしよう。\u003c/p\u003e\n\n\u003cp\u003eこの「要素を取り出すかどうかを判定する処理」は、\u003ccode\u003eint\u003c/code\u003e型の引数を取り、\u003ccode\u003ebool\u003c/code\u003e型を返すメソッドになるだろう。\u003cbr\u003e\nこの型のメソッドを渡すには、\u003ccode\u003eFunc\u0026lt;int, bool\u0026gt;\u003c/code\u003e型の引数を使う。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ehoge.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eHoge\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e...\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// Use LINQ, Luke.\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eIEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetNumbers\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eFunc\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003epred\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003e_list\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nf\"\u003epred\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003en\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eyield\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eXxx\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"nf\"\u003eMod3Equals1\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"m\"\u003e3\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ehoge\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eHoge\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e...\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eenm\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ehoge\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetNumbers\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eMod3Equals1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eさあ、これがコールバックだ。\u003cbr\u003e\nコールバックとは、ある処理(この例では\u003ccode\u003eGetNumbers\u003c/code\u003e)に対し、そこから呼び出してほしい処理(この例では\u003ccode\u003eMod3Equals1\u003c/code\u003e)を渡すことだ。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eGetNumbers\u003c/code\u003eは\u003ccode\u003e_list\u003c/code\u003eの内部を先頭から順に取り出し、その要素ごとに与えられた引数である\u003ccode\u003eMod3Equals1\u003c/code\u003eを呼び出す。\u003cbr\u003e\nこれがtrueを返した場合のみ、その値を戻り値の一部として返すという動作をする。\u003c/p\u003e\n\n\u003cp\u003eこうした、大きな処理に対して、その一部になる小さな処理を渡す場合もあるし、「ある処理がおこなわれたという通知処理」を渡す場合もある。\u003cbr\u003e\nほとんどのイベントが後者の形を実現するために用いられる。また、前者の形をイベントで実現することも可能だ。\u003c/p\u003e\n\n\u003cp\u003e話が飛んでしまった。\u003cbr\u003e\nC#において、こうした「処理を渡す」際に使用する、メソッドへの参照のことをデリゲートと呼ぶ。\u003cbr\u003e\nC言語の関数ポインタなどと同様、C#のデリゲートもコールバックを実現するための機能になる。\u003cbr\u003e\nただ、C#の場合は、オブジェクト指向言語なので、\u003cbr\u003e\n「静的メソッドなのか、インスタンスメソッドなのか。インスタンスメソッドだとすれば、どのオブジェクトのそれを呼び出すべきなのか」\u003cbr\u003e\nという情報まで内部で渡している。\u003c/p\u003e\n\n\u003cp\u003eデリゲートには、メソッドであれば何でも渡せるわけではなく、引数の数や型、戻り値の型が一致していなければならない。\u003cbr\u003e\n前の例では、\u003cbr\u003e\n「\u003ccode\u003eint\u003c/code\u003e型の引数を取り、\u003ccode\u003ebool\u003c/code\u003e型を返す」\u003cbr\u003e\nという処理を渡すために\u003ccode\u003eFunc\u0026lt;int, bool\u0026gt;\u003c/code\u003eという型を使用した。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"定義済みのデリゲートの型\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%9A%E7%BE%A9%E6%B8%88%E3%81%BF%E3%81%AE%E3%83%87%E3%83%AA%E3%82%B2%E3%83%BC%E3%83%88%E3%81%AE%E5%9E%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e定義済みのデリゲートの型\u003c/h2\u003e\n\n\u003cp\u003eデリゲートには型があり、渡したい処理の引数の数や型、戻り値の組み合わせごとに別々の型として扱わなければならない。\u003cbr\u003e\nそして、プログラマがその型を定義できるよう、\u003ccode\u003edelegate\u003c/code\u003e構文が用意されている。\u003c/p\u003e\n\n\u003cp\u003eしかし、.NET Frameworkにはデリゲートの型が既にいくつも定義されている。\u003cbr\u003e\nどんなものがあるかは、以下を参考にして欲しい。\u003cbr\u003e\n\u003ca href=\"http://www.atmarkit.co.jp/fdotnet/dotnettips/730dlgttype/dlgttype.html\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://www.atmarkit.co.jp/fdotnet/dotnettips/730dlgttype/dlgttype.html\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eこの情報の\u003cbr\u003e\n\u003ccode\u003evoid Action\u0026lt;T\u0026gt;(T obj)\u003c/code\u003e\u003cbr\u003e\nという形式は\u003cbr\u003e\n「\u003ccode\u003eAction\u0026lt;T\u0026gt;\u003c/code\u003e型というデリゲートの型は、\u003ccode\u003eT\u003c/code\u003e型の引数ひとつを取り、戻り値がない」\u003cbr\u003e\nという意味になる。\u003cbr\u003e\nこうした型がいくつも用意されているおかげで、プログラマがデリゲートの型を新たに定義する必要は少なくなっている。\u003cbr\u003e\nなるべく標準で用意されているデリゲートの型を使用しよう。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"デリゲートによる通知の実現\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%87%E3%83%AA%E3%82%B2%E3%83%BC%E3%83%88%E3%81%AB%E3%82%88%E3%82%8B%E9%80%9A%E7%9F%A5%E3%81%AE%E5%AE%9F%E7%8F%BE\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eデリゲートによる通知の実現\u003c/h1\u003e\n\n\u003cp\u003e運がいいと労働したときに昇給してもらえる\u003ccode\u003eProgrammer\u003c/code\u003eクラスを考える。この\u003ccode\u003eProgrammer\u003c/code\u003eは昇給するとその情報をうっかり外へ通知する。\u003cbr\u003e\n通常は、昇給イベントを用意するのだが、今回はデリゲートだけを使用して、昇給を通知することを考えよう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eProgrammer.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eProgrammer\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eAction\u003c/span\u003e \u003cspan class=\"n\"\u003eGetPayRise\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRandom\u003c/span\u003e \u003cspan class=\"n\"\u003e_Random\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRandom\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eProgrammer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eid\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e...\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eWork\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003equantity\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e...\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e_Random\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eNext\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1000\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eGetPayRise\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"nf\"\u003eGetPayRise\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003eAction\u003c/code\u003eは、引数なし、戻り値なしの処理を渡すためのデリゲートの型だ。\u003cbr\u003e\nここでは、この型の変数(\u003ccode\u003eGetPayRise\u003c/code\u003eフィールド)を公開することで、他のクラスからその参照を登録することを可能にしている。\u003cbr\u003e\nそして、この\u003ccode\u003eGetPayRise\u003c/code\u003eに\u003ccode\u003e()\u003c/code\u003eをつけることで、登録された処理を呼び出すことができる。事前にnullチェックしているのは、未登録の場合はこの値はnullになって処理の呼び出しが例外を引き起こすからだ。\u003cbr\u003e\nこれで、「とても高い確率」で昇給し、このとき、\u003ccode\u003eGetPayRise\u003c/code\u003eに登録されているデリゲートを呼び出す仕組みができた。\u003c/p\u003e\n\n\u003cp\u003eでは、昇給が通知されたときに呼び出される処理を追加してみよう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eLeader.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eLeader\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eProgrammer\u003c/span\u003e \u003cspan class=\"n\"\u003e_Programmer101\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eMyCompany\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetProgrammer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e101\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003e_WorkQuantityForProgrammer101\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eProgrammer101_GetPayRise\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003e_WorkQuantityForProgrammer101\u003c/span\u003e\u003cspan class=\"p\"\u003e++;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eLeader\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003e_Programmer101\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGetPayRise\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eProgrammer101_GetPayRise\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eDailyProcess\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003e_Programmer101\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWork\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e_WorkQuantityForProgrammer101\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eReadNewsPaper\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eこの\u003ccode\u003eLeader\u003c/code\u003eは、昇給を通知されると、彼への仕事量を増やす処理をおこなう。\u003cbr\u003e\nコンストラクタの中で\u003ccode\u003e_Programmer101\u003c/code\u003eの\u003ccode\u003eGetPayRise\u003c/code\u003e変数に自分の処理(\u003ccode\u003eProgrammer101_GetPayRise\u003c/code\u003e)を登録している。\u003cbr\u003e\nこれで、\u003ccode\u003eProgrammer101\u003c/code\u003eの\u003ccode\u003eWork\u003c/code\u003eを呼び出せば、ごく稀に昇給が通知され、彼への仕事量を増やすことができるようになった。\u003c/p\u003e\n\n\u003cp\u003eこうしたプログラミングスタイルの一番のメリットは、\u003ccode\u003eProgrammer\u003c/code\u003eが\u003ccode\u003eLeader\u003c/code\u003eの存在にまったく左右されない点だ。\u003cbr\u003e\n\u003ccode\u003eLeader\u003c/code\u003eがいても、いなくても、いや、昇給を監視しているオブジェクトが何であっても、まったくいなくても、それを気にかける必要がない。\u003cbr\u003e\nこの結果、\u003ccode\u003eProgrammer\u003c/code\u003eクラスの再利用性は向上する。\u003c/p\u003e\n\n\u003cp\u003e次に、\u003ccode\u003eNewbie\u003c/code\u003eを考える。\u003cbr\u003e\n\u003ccode\u003eNewbie\u003c/code\u003eは、\u003ccode\u003eProgrammer\u003c/code\u003eの\u003ccode\u003eGetPayRise\u003c/code\u003eの通知を受け取ったら、彼を食事に誘う処理をおこなう。もちろんお祝いをするためだ。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eNewbie.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eNewbie\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eProgrammer\u003c/span\u003e \u003cspan class=\"n\"\u003e_Programmer101\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eMyCompany\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetProgrammer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e101\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eProgrammer101_GetPayRise\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eInviteToDinner\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e_Programmer101\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eNewbie\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003e_Programmer101\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGetPayRise\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"n\"\u003eProgrammer101_GetPayRise\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eこの\u003ccode\u003eNewbie\u003c/code\u003eは、\u003ccode\u003e_Programmer101\u003c/code\u003eの\u003ccode\u003eGetPayRise\u003c/code\u003e変数に自分の処理を「追加」している。\u003cbr\u003e\nデリゲートには、マルチキャストデリゲートという機能があって、すでに登録されている処理(\u003ccode\u003eLeader\u003c/code\u003eの\u003ccode\u003eProgrammer101_GetPayRise\u003c/code\u003e)とあわせて、自分の処理(\u003ccode\u003eNewbie\u003c/code\u003eの\u003ccode\u003eProgrammer101_GetPayRise\u003c/code\u003e)も呼び出すように追加できるのだ。\u003cbr\u003e\n呼び出し側(\u003ccode\u003eProgrammer\u003c/code\u003eクラス)は、処理がいくつ登録されているか気にかける必要がない。\u003cbr\u003e\nそして、追加のためには、\u003ccode\u003e+=\u003c/code\u003e演算子を用いる。\u003c/p\u003e\n\n\u003cp\u003eそう、「追加」だ。\u003cbr\u003e\nこの\u003ccode\u003eNewbie\u003c/code\u003eのメソッドを「追加」するには、その前に何かが登録済みでなければならない。\u003cbr\u003e\nそうなると、\u003ccode\u003eLeader\u003c/code\u003eが\u003ccode\u003e_Programmer101\u003c/code\u003eにメソッドを登録してから、\u003ccode\u003eNewbie\u003c/code\u003eのメソッドが登録されなければならないことになってしまう。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eNewbie\u003c/code\u003eだけ見れば、\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eNewbie.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e_Programmer101\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGetPayRise\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003e_Programmer101\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGetPayRise\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eProgrammer101_GetPayRise\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n    \u003cspan class=\"n\"\u003e_Programmer101\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGetPayRise\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"n\"\u003eProgrammer101_GetPayRise\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eとすることでこの問題を回避できる。\u003cbr\u003e\nところが、今度は\u003ccode\u003eLeader\u003c/code\u003eが\u003ccode\u003e_Programmer101.GetPayRise = Programmer101_GetPayRise\u003c/code\u003eとしているところが問題になる。\u003cbr\u003e\nこれはまったく新しい代入になるので、これ以前に\u003ccode\u003eNewbie\u003c/code\u003eのメソッドが登録されていても、それが消去されてしまうのだ。\u003c/p\u003e\n\n\u003cp\u003eここでの本当の問題は、\u003cbr\u003e\n「\u003ccode\u003eProgrammer101\u003c/code\u003eに登録されているデリゲートを、外部から初期化できてしまうこと」\u003cbr\u003e\nであり、こうした抜け穴は塞がなければならない。\u003cbr\u003e\n抜け穴と言えば、この形では、\u003ccode\u003eLeader\u003c/code\u003eや\u003ccode\u003eNewbie\u003c/code\u003eが、\u003ccode\u003eProgrammer\u003c/code\u003eに登録されているデリゲートを呼び出せてしまう点も問題だ。\u003c/p\u003e\n\n\u003cp\u003eこうした、デリゲートの変数を公開することによる問題を解決するための機能。\u003cbr\u003e\nこれがイベントの存在理由だ。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"イベントによる通知の実現---sender\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E3%81%AB%E3%82%88%E3%82%8B%E9%80%9A%E7%9F%A5%E3%81%AE%E5%AE%9F%E7%8F%BE---sender\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eイベントによる通知の実現 - Sender\u003c/h1\u003e\n\n\u003cp\u003e今までのポイントをまとめよう。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eメソッドをデリゲート経由で渡すことによる「通知」の仕組みには、クラス間の依存関係を少なくするメリットがある\u003c/li\u003e\n\u003cli\u003eマルチキャストデリゲートという機能により、複数のメソッドをひとつの変数に登録することが可能である\u003c/li\u003e\n\u003cli\u003eところが、デリゲートの変数を直接公開してしまうのには安全性に問題がある\u003c/li\u003e\n\u003cli\u003eこうした問題を解決するのがイベントである\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eここで、語句を定義する。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eメソッドをデリゲート経由で渡して登録することを「subscribe」\u003c/li\u003e\n\u003cli\u003e渡したメソッドの登録を解除することを「unsubscribe」\u003c/li\u003e\n\u003cli\u003eメソッドを受け取り、条件によってその登録されているメソッドを呼び出すオブジェクトを「Sender」\u003c/li\u003e\n\u003cli\u003eメソッドを登録し、デリゲート経由で機能を呼び出されるオブジェクトを「Receiver」\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eいろいろな流儀があるが、この投稿の中では、この語句を使うことにする。\u003cbr\u003e\nこの投稿外で使っても、支障のない語句を選択したつもりだ。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eProgrammer\u003c/code\u003eの例では、\u003ccode\u003eProgrammer\u003c/code\u003eクラスがSender役であり、Receiver役は\u003ccode\u003eLeader\u003c/code\u003e, \u003ccode\u003eNewbie\u003c/code\u003eクラスだ。\u003c/p\u003e\n\n\u003cp\u003eさて、イベントを使ったとき、\u003ccode\u003eProgrammer\u003c/code\u003eの例がどうなるか見てみよう。\u003cbr\u003e\nまず、Sender役のクラスはどうなるか。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eProgrammer.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eProgrammer\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eevent\u003c/span\u003e \u003cspan class=\"n\"\u003eEventHandler\u003c/span\u003e \u003cspan class=\"n\"\u003eGetPayRise\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRandom\u003c/span\u003e \u003cspan class=\"n\"\u003e_Random\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRandom\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eProgrammer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eid\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e...\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evirtual\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eWork\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003equantity\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e...\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e_Random\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eNext\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1000\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eOnGetPayRise\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eEventArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEmpty\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eprotected\u003c/span\u003e \u003cspan class=\"k\"\u003evirtual\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnGetPayRise\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eEventArgs\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eGetPayRise\u003c/span\u003e\u003cspan class=\"p\"\u003e?.\u003c/span\u003e\u003cspan class=\"nf\"\u003eInvoke\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e  \u003cspan class=\"c1\"\u003e// C#6.0以上でのみ可能\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"イベントの定義\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E3%81%AE%E5%AE%9A%E7%BE%A9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eイベントの定義\u003c/h2\u003e\n\n\u003cp\u003eまず、イベントを定義している。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eevent\u003c/span\u003e \u003cspan class=\"n\"\u003eEventHandler\u003c/span\u003e \u003cspan class=\"n\"\u003eGetPayRise\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれは、\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eイベントのsubscribe、unsubscribeはどこからでも可能である\u003c/li\u003e\n\u003cli\u003e登録するメソッドは、\u003ccode\u003eEventHandler\u003c/code\u003eと型が一致していなければならない\u003c/li\u003e\n\u003cli\u003eこのイベントの名前は\u003ccode\u003eGetPayRise\u003c/code\u003eである\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eということの宣言である。\u003cbr\u003e\n\u003ccode\u003eEventHandler\u003c/code\u003eというデリゲート型は、.NET Frameworkに定義済みの型であり、\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eひとつめの引数が\u003ccode\u003eObject\u003c/code\u003e型、ふたつめの引数が\u003ccode\u003eEventArgs\u003c/code\u003e型\u003c/li\u003e\n\u003cli\u003e戻り値はない\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eという意味になる。\u003cbr\u003e\nこれにより、登録できるメソッドは\u003ccode\u003evoid Xxxxx(object, EventArgs)\u003c/code\u003eという形で宣言されているものに限定される。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"デリゲートを呼び出すメソッドの定義\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%87%E3%83%AA%E3%82%B2%E3%83%BC%E3%83%88%E3%82%92%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%99%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%AE%E5%AE%9A%E7%BE%A9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eデリゲートを呼び出すメソッドの定義\u003c/h2\u003e\n\n\u003cp\u003eそして、登録されているデリゲートを呼び出すメソッドを定義する。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eprotected\u003c/span\u003e \u003cspan class=\"k\"\u003evirtual\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnGetPayRise\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eEventArgs\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e...\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cul\u003e\n\u003cli\u003eメソッドの名前は、\u003ccode\u003eOn\u003c/code\u003e + イベントの名前\u003c/li\u003e\n\u003cli\u003e仮想メソッド\u003c/li\u003e\n\u003cli\u003e可視性は\u003ccode\u003eprotected\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003e引数は\u003ccode\u003eEventArgs\u003c/code\u003e型\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eであることに注意して欲しい。\u003cbr\u003e\nメソッドにこうした名前を付けるのは.NET Frameworkの慣例だ。\u003cbr\u003e\n可視性と引数については、こうしなければならない理由を後述する。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eGetPayRise\u003c/span\u003e\u003cspan class=\"p\"\u003e?.\u003c/span\u003e\u003cspan class=\"nf\"\u003eInvoke\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eその内部の処理では、イベントと同名の変数として暗黙的に宣言されている\u003ccode\u003eGetPayRise\u003c/code\u003eを使用する。\u003cbr\u003e\nこの変数はデリゲート型の値として扱うことができるので、nullでない場合にのみ、デリゲートを呼び出すようにする。\u003cbr\u003e\n呼び出す際は、ひとつめの引数にはthis、ふたつめの引数には受け取った引数を渡す。\u003cbr\u003e\nC#6.0以前には\u003ccode\u003e?.\u003c/code\u003e演算子がないので、\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eprotected\u003c/span\u003e \u003cspan class=\"k\"\u003evirtual\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnGetPayRise\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eEventArgs\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eGetPayRise\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eGetPayRise\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eという形になる。\u003cbr\u003e\nスレッド安全性に注意する必要があるのならば、以下のようにする必要があって少々面倒だ。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eprotected\u003c/span\u003e \u003cspan class=\"k\"\u003evirtual\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnGetPayRise\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eEventArgs\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003egetPayRise\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eGetPayRise\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003egetPayRise\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003egetPayRise\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eイベントを通知したい箇所(この例では、\u003ccode\u003eProgrammer\u003c/code\u003eの\u003ccode\u003eWork\u003c/code\u003eメソッドの内部になる)では、この\u003ccode\u003eOnGetPayRise\u003c/code\u003eメソッドを呼び出すようにする。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eOnGetPayRise\u003c/code\u003eを呼び出すとき、毎回、\u003ccode\u003enew EventArgs()\u003c/code\u003eとしてインスタンスを生成してもいいのだが、このクラスには\u003ccode\u003eEmpty\u003c/code\u003eという静的フィールドが用意されており、これをインスタンスの生成の代わりに用いることができる。\u003cbr\u003e\n毎回インスタンスを生成するよりも、ほんの少しだけ早くなるかもしれない。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"sender側にはsubscribeの記述をしてはいけない\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#sender%E5%81%B4%E3%81%AB%E3%81%AFsubscribe%E3%81%AE%E8%A8%98%E8%BF%B0%E3%82%92%E3%81%97%E3%81%A6%E3%81%AF%E3%81%84%E3%81%91%E3%81%AA%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eSender側にはsubscribeの記述をしてはいけない\u003c/h2\u003e\n\n\u003cp\u003e重要なのは、Sender役のクラスにはsubscribeの記述は一切しないことだ。\u003cbr\u003e\nなんらかの方法でReceiverをSenderに渡し、ここでsubscribeすることもできるのだが、これをしてしまうと前述のメリット、「クラス間の依存関係を少なくする」が完全に失われてしまう。\u003cbr\u003e\nsubscribeの記述はReceiver役のクラスにしよう。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"イベントの定義の補足\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E3%81%AE%E5%AE%9A%E7%BE%A9%E3%81%AE%E8%A3%9C%E8%B6%B3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eイベントの定義の補足\u003c/h2\u003e\n\n\u003cp\u003eイベントの可視性とは、あくまで、subscribeとunsubscribeについてだけのものになる。\u003cbr\u003e\nこれがどんな可視性で定義されていようとも、登録されているデリゲートの呼び出し自体は、自分自身か、あるいはその内部クラスからのみ可能であることに注意してほしい。\u003cbr\u003e\n外部からはもちろん、\u003ccode\u003eProgrammer\u003c/code\u003eの派生クラスからも、直接、デリゲートを呼び出すことはできない。\u003c/p\u003e\n\n\u003cp\u003eまた、イベントの名前は動詞や動詞句にしよう。\u003cbr\u003e\nイベント間で前後関係がある場合は、前のものにingをつけて進行形に、後のものは過去形にする。\u003cbr\u003e\n例えば、ClosingとClosedのように。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"デリゲートを呼び出すメソッドの補足\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%87%E3%83%AA%E3%82%B2%E3%83%BC%E3%83%88%E3%82%92%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%99%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%AE%E8%A3%9C%E8%B6%B3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eデリゲートを呼び出すメソッドの補足\u003c/h2\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e登録されているデリゲートの呼び出し自体は、自分自身か、あるいはその内部クラスからのみ可能\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eと述べた。これこそが、\u003ccode\u003eOnGetPayRise\u003c/code\u003eというメソッドが必要な理由になる。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eProgrammer\u003c/code\u003eを継承した\u003ccode\u003eSuperProgrammer\u003c/code\u003eクラスを考える。\u003cbr\u003e\n\u003ccode\u003eSuperProgrammer\u003c/code\u003eは技術が高いので、もう少し、昇給の確率を向上させたい。\u003cbr\u003e\nところが、\u003ccode\u003eSuperProgrammer\u003c/code\u003eからは\u003ccode\u003eGetPayRise\u003c/code\u003e変数からデリゲートを呼び出せない。もし、\u003ccode\u003eprotected\u003c/code\u003eな\u003ccode\u003eOnGetPayRise\u003c/code\u003eメソッドがなければ、\u003ccode\u003eSuperProgrammer\u003c/code\u003eクラスには、\u003ccode\u003eGetPayRise\u003c/code\u003eに登録されているデリゲートを呼び出す方法が一切ないことになる。\u003cbr\u003e\n\u003ccode\u003eOnGetPayRise\u003c/code\u003eが\u003ccode\u003eprotected\u003c/code\u003eとして宣言されなければならないのは、こうした理由だ。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c#\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eSuperProgrammer.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eSuperProgrammer\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eProgrammer\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eoverride\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eWork\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003equantity\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e...\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e_Random\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eNext\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1000\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;=\u003c/span\u003e \u003cspan class=\"m\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// Compile Error!\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eGetPayRise\u003c/span\u003e\u003cspan class=\"p\"\u003e?.\u003c/span\u003e\u003cspan class=\"nf\"\u003eInvoke\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eEventArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEmpty\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eまた、\u003ccode\u003eEventArgs\u003c/code\u003e型にはまったく情報が含まれていないので、\u003ccode\u003eOnGetPayRise\u003c/code\u003eメソッドを呼び出すたびに\u003ccode\u003eEventArgs.Empty\u003c/code\u003eを使用する代わりに、\u003ccode\u003eOnGetPayRise\u003c/code\u003eから引数を消しさりたくなる衝動にかられるだろう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eNG.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// Bad knowhow\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprotected\u003c/span\u003e \u003cspan class=\"k\"\u003evirtual\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnGetPayRise\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eGetPayRise\u003c/span\u003e\u003cspan class=\"p\"\u003e?.\u003c/span\u003e\u003cspan class=\"nf\"\u003eInvoke\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eEventArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEmpty\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eこうした衝動にはあらがわなければならない。\u003cbr\u003e\nなぜなら、このクラスを継承した\u003ccode\u003eSuperProgrammer\u003c/code\u003eでは、新たな給料の額を持たせた\u003ccode\u003eEventArgs\u003c/code\u003eの派生クラスのオブジェクトを通知に使用したくなるかもしれないからだ。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eSuperProgrammer.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eSuperProgrammer\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eProgrammer\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eoverride\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eWork\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003equantity\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e...\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e_Random\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eNext\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1000\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;=\u003c/span\u003e \u003cspan class=\"m\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eOnGetPayRise\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eSalaryEventArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e_CurrentSalary\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"m\"\u003e10000\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"p\"\u003e...\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eSalaryEventArgs\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eEventArgs\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eSalaryEventArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003esalary\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003ebase\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e...\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003eOnGetPayRise\u003c/code\u003eメソッドに引数がなければ、こうした拡張の芽をつんでしまうことになる。\u003cbr\u003e\n引数がないメソッドを作りたければ別に定義し、その内部で引数がある方のメソッドを呼び出すようにしよう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eOK.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eprotected\u003c/span\u003e \u003cspan class=\"k\"\u003evirtual\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnGetPayRise\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eOnGetPayRise\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eEventArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEmpty\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eなお、Sender役のクラスが\u003ccode\u003esealed\u003c/code\u003eとして定義されている場合、このクラスを継承することはできないのだから、こうした気遣いは不要になる。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"イベントによる通知の実現---receiver\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E3%81%AB%E3%82%88%E3%82%8B%E9%80%9A%E7%9F%A5%E3%81%AE%E5%AE%9F%E7%8F%BE---receiver\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eイベントによる通知の実現 - Receiver\u003c/h1\u003e\n\n\u003cp\u003eReceiver役のクラスには、イベントのsubscribeとunsubscribe、そして呼び出してほしい処理を記述することになる。\u003cbr\u003e\n\u003ccode\u003eLeader\u003c/code\u003eクラスの例で説明しよう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eLeader.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eLeader\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eProgrammer\u003c/span\u003e \u003cspan class=\"n\"\u003e_Programmer101\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eMyCompany\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetProgrammer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e101\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eWorkQuantityForProgrammer101\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eProgrammer101_GetPayRise\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eobject\u003c/span\u003e \u003cspan class=\"n\"\u003esender\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eEventArgs\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eWorkQuantityForProgrammer101\u003c/span\u003e\u003cspan class=\"p\"\u003e++;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eLeader\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003e_Programmer101\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGetPayRise\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"n\"\u003eProgrammer101_GetPayRise\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003e_Programmer101.GetPayRise\u003c/code\u003eはもはやデリゲートの変数ではない。\u003cbr\u003e\nそのため、Receiver側から登録されているデリゲートを呼び出せてしまうという安全上の問題は解消されている。\u003cbr\u003e\nデリゲートの変数ではないにもかかわらず、マルチキャストデリゲートにある、複数のメソッドを登録できるというメリットは保ったままなので、いくらでもsubscribeできる。\u003c/p\u003e\n\n\u003cp\u003esubscribeは\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003esenderオブジェクト.イベント名 += 登録したいメソッド名;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eunsubscribeは\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003esenderオブジェクト.イベント名 -= 登録解除したいメソッド名;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eと記述する。\u003cbr\u003e\n他のメソッドへの参照が登録されているかどうかを気にかける必要はないし、既に登録されているデリゲートの初期化もできないようになっている。\u003c/p\u003e\n\n\u003cp\u003eところで、\u003ccode\u003eProgrammer101_GetPayRise\u003c/code\u003eのような、イベント用にデリゲートとして渡されるメソッドのことを「イベントハンドラ」と呼ぶ。\u003cbr\u003e\nイベントの定義時に使用した\u003ccode\u003eEventHandler\u003c/code\u003eというデリゲートの型は、まさにこれが理由で名付けられている。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"メモリリークに注意する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%A1%E3%83%A2%E3%83%AA%E3%83%AA%E3%83%BC%E3%82%AF%E3%81%AB%E6%B3%A8%E6%84%8F%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eメモリリークに注意する\u003c/h2\u003e\n\n\u003cp\u003eReceiverの寿命が、Senderとさして変わらず、イベントを常に通知して欲しいのであれば、unsubscribeは不要である。\u003cbr\u003e\nしかし、Receiverの方が寿命が短い場合はちがう。\u003cbr\u003e\nSenderは、subscribeしている間、Receiverへの参照を持ちづづける。\u003cbr\u003e\nそのため、Recevierは不要なったとしても、ガベージコレクタがいつまでたってもReceiverをメモリから削除してくれない。\u003cbr\u003e\nおまけに、不要なデリゲート呼び出しが積み重なる結果になる。\u003cbr\u003e\nこうした場合、Receiverが不要になったらきちんとunsubscribeしよう。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"今となっては古い情報\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BB%8A%E3%81%A8%E3%81%AA%E3%81%A3%E3%81%A6%E3%81%AF%E5%8F%A4%E3%81%84%E6%83%85%E5%A0%B1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e今となっては古い情報\u003c/h2\u003e\n\n\u003cp\u003eイベントのsubscribe, unsubscribeのとき、\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003e_Programmer101\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGetPayRise\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eEventHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eProgrammer101_GetPayRise\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eというように、\u003ccode\u003enew EventHandler()\u003c/code\u003eが必要だ、としている情報がある。\u003cbr\u003e\nしかし、C#3.0からはこれは不要になった。もう付けなくてかまわない。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"イベント引数に情報を持たせたイベント通知\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E5%BC%95%E6%95%B0%E3%81%AB%E6%83%85%E5%A0%B1%E3%82%92%E6%8C%81%E3%81%9F%E3%81%9B%E3%81%9F%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E9%80%9A%E7%9F%A5\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eイベント引数に情報を持たせたイベント通知\u003c/h1\u003e\n\n\u003cp\u003eプログラマも人間である。人間であるからには休みが欲しい。\u003cbr\u003e\nそこで、プログラマは労働すると、ある確率で休暇を申請し、それを通知することにしよう。\u003cbr\u003e\n休暇の申請には、「いつ休むか」の情報が必要だ。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"新しいイベント引数型の定義\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%96%B0%E3%81%97%E3%81%84%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E5%BC%95%E6%95%B0%E5%9E%8B%E3%81%AE%E5%AE%9A%E7%BE%A9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e新しいイベント引数型の定義\u003c/h2\u003e\n\n\u003cp\u003eまず、「いつ休むか」の情報を含んだイベント引数の型を宣言する。\u003cbr\u003e\nこれは、\u003ccode\u003eEventArgs\u003c/code\u003eクラスの派生クラスとしなければならない。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eVacationEventArgs.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eVacationEventArgs\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eEventArgs\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eVacationEventArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDateTime\u003c/span\u003e \u003cspan class=\"n\"\u003edate\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003ebase\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eVacationDate\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edate\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eDateTime\u003c/span\u003e \u003cspan class=\"n\"\u003eVacationDate\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003eEventArgs\u003c/code\u003eを継承したクラスの名前の後ろには\u003ccode\u003eEventArgs\u003c/code\u003eをつけて、イベント引数のための型であることを強調するとよい。\u003cbr\u003e\nここでは、休暇情報ということで、\u003ccode\u003eVacationEventArgs\u003c/code\u003eクラスとした。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"sender役のクラス\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#sender%E5%BD%B9%E3%81%AE%E3%82%AF%E3%83%A9%E3%82%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eSender役のクラス\u003c/h2\u003e\n\n\u003cp\u003e次はプログラマだ。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eProgrammer.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eProgrammer\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e...\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eevent\u003c/span\u003e \u003cspan class=\"n\"\u003eEventHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eVacationEventArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eApplyVacation\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evirtual\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eWork\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003equantity\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e...\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e_Random\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eNext\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e20\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eOnApplyVacation\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eVacationEventArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDateTime\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eToday\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAddMonths\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)));\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eprotected\u003c/span\u003e \u003cspan class=\"k\"\u003evirtual\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnApplyVacation\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eVacationEventArgs\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eApplyVacation\u003c/span\u003e\u003cspan class=\"p\"\u003e?.\u003c/span\u003e\u003cspan class=\"nf\"\u003eInvoke\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e  \u003cspan class=\"c1\"\u003e// C#6.0以上でのみ可能\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e注意するべき点は、以下の点ぐらいだろうか。\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eイベントの定義中、デリゲートの型が\u003ccode\u003eEventHanlder\u0026lt;VacationEventArgs\u0026gt;\u003c/code\u003eになっている\u003c/li\u003e\n\u003cli\u003eデリゲートを呼び出すメソッドの引数が、\u003ccode\u003eVacationEventArgs\u003c/code\u003eになっている\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003e.NET Frameworkに定義されているデリゲートの型である\u003ccode\u003eEventHandler\u0026lt;TEventArgs\u0026gt;\u003c/code\u003eは、\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eひとつめの引数が\u003ccode\u003eObject\u003c/code\u003e型、ふたつめの引数が\u003ccode\u003eTEventArgs\u003c/code\u003e型\u003c/li\u003e\n\u003cli\u003e戻り値はない\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eという意味になる。\u003cbr\u003e\nそして、\u003ccode\u003eTEventArgs\u003c/code\u003eに与える型は、\u003ccode\u003eEventArgs\u003c/code\u003eか、その派生クラスでなければならない。\u003cbr\u003e\nこれが、\u003ccode\u003eVacationEventArgs\u003c/code\u003eを\u003ccode\u003eEventArgs\u003c/code\u003eを継承して実装した理由だ。\u003c/p\u003e\n\n\u003cp\u003eところで、「変更可能なオブジェクトの参照を漏らさない」という鉄則がある。\u003cbr\u003e\nこれは主にプロパティやメソッドの戻り値として言われがちなルールであるが、イベント引数にもあてはまる金言だ。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eNG.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eExVacationEventArgs\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eVacationEventArgs\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eExVacationEventArgs\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDateTime\u003c/span\u003e \u003cspan class=\"n\"\u003edate\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eDateTime\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003evacationHistory\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003ebase\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edate\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eVacationHistory\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003evacationHistory\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eIEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eDateTime\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eVacationHistory\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eProgrammer\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eevent\u003c/span\u003e \u003cspan class=\"n\"\u003eEventHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eExVacationEventArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eExApplyVacation\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eDateTime\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003e_VacationHistory\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evirtual\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eWork\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003equantity\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e...\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e_Random\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eNext\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e20\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// Bad!\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eOnExApplyVacation\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eExVacationEventArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDateTime\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eToday\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAddMonths\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003e_VacationHistory\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e上記のコードでは、Receiverから\u003ccode\u003eProgrammer\u003c/code\u003eの\u003ccode\u003e_VacationHistory\u003c/code\u003eの値を操作することが可能になっている。\u003cbr\u003e\n\u003ccode\u003eExVacationEventArgs\u003c/code\u003eが保持しているのは\u003ccode\u003eIEnumerable\u0026lt;DateTime\u0026gt;\u003c/code\u003eだから直接値を操作することはできないと言えばできないのだが、Receiverがキャストしてしまえば操作し放題になってしまう。\u003cbr\u003e\nこれでは、悪意のあるReceiverから、取得した覚えのない休暇が追加されてしまう恐れがある。\u003cbr\u003e\n悪い上司から身をまもるために、イベント引数には\u003ccode\u003e_VacationHistory\u003c/code\u003eのコピーやReadOnlyのコレクションを渡そう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eOK.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evirtual\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eWork\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003equantity\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e...\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eExVacationEventArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eDateTime\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eToday\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAddMonth\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n        \u003cspan class=\"n\"\u003e_VacationHistory\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToArray\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eOnExApplyVacation\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"receiver役のクラス\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#receiver%E5%BD%B9%E3%81%AE%E3%82%AF%E3%83%A9%E3%82%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eReceiver役のクラス\u003c/h2\u003e\n\n\u003cp\u003eさて、Receiver側だ。\u003cbr\u003e\n\u003ccode\u003eLeader\u003c/code\u003eは\u003ccode\u003eProgrammer\u003c/code\u003eが休暇を申請すると、スケジュールの調整をしなくてはならない。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eLeader.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eLeader\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e...\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eAdjustSchedule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eProgrammer\u003c/span\u003e \u003cspan class=\"n\"\u003eprogrammer\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eDateTime\u003c/span\u003e \u003cspan class=\"n\"\u003evacation\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e...\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eProgrammer101_ApplyVacation\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eobject\u003c/span\u003e \u003cspan class=\"n\"\u003esender\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eVacationEventArgs\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eAdjustSchedule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esender\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eProgrammer\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDate\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eLeader\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e...\u003c/span\u003e\n        \u003cspan class=\"n\"\u003e_Programmer101\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eApplyVacation\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"n\"\u003eProgrammer101_ApplyVacation\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eこのイベントハンドラ(\u003ccode\u003eProgrammer101_ApplyVacataion\u003c/code\u003e)のふたつめの引数が\u003ccode\u003eVacationEventArgs\u003c/code\u003eになっている。\u003cbr\u003e\nイベントが通知されると、つまり、\u003ccode\u003eProgrammer101_ApplyVacation\u003c/code\u003eが呼び出されると、\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eひとつめの引数には、イベントを発生したオブジェクト、つまりSender。この例では\u003ccode\u003e_Programmer101\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003eふたつめの引数には、Senderが生成したイベント引数\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eが渡される。(もちろん、そうなるようにSenderを実装したからだ)\u003cbr\u003e\n\u003ccode\u003eProgrammer101_ApplyVacation\u003c/code\u003eの内部では、この渡された情報を利用して、自分自身の\u003ccode\u003eAdjustSchedule\u003c/code\u003eメソッドを呼び出している。\u003c/p\u003e\n\n\u003cp\u003e次に、\u003ccode\u003eNewbie\u003c/code\u003eに再登場してもらおう。\u003cbr\u003e\n\u003ccode\u003eNewbie\u003c/code\u003eは、\u003ccode\u003eProgrammer\u003c/code\u003eが休暇を申請すると、何をするわけでもないが、ただうらやましがる。\u003cbr\u003e\n彼はまだ有給休暇を取得していないので、自分も休むだとか、休んだ上で\u003ccode\u003eProgrammer\u003c/code\u003eを遊びに誘うといったことはできないのだ。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eNewbie.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eNewbie\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e...\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eProgrammer101_ApplyVacation\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eobject\u003c/span\u003e \u003cspan class=\"n\"\u003esender\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eEventArgs\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eEnvy\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eNewbie\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e...\u003c/span\u003e\n        \u003cspan class=\"n\"\u003e_Programmer101\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eApplyVacation\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"n\"\u003eProgrammer101_ApplyVacation\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003eProgrammer101_ApplyVacation\u003c/code\u003eのふたつめの引数の型が\u003ccode\u003eEventArgs\u003c/code\u003eになっているところに注意して欲しい。\u003cbr\u003e\n実のところ、このイベントハンドラのふたつめの引数の型は\u003ccode\u003eVacationEventArgs\u003c/code\u003eかその基底クラスでさえあれば、どんな型でもかまわない。\u003ccode\u003eObject\u003c/code\u003eにしてもよいのだ。\u003cbr\u003e\n\u003ccode\u003eNewbie\u003c/code\u003eの場合、うらやましがるのにはなんの情報も必要ないため、\u003ccode\u003eEventArgs\u003c/code\u003eとして通知を受け取っている。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"今となっては古い情報-1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BB%8A%E3%81%A8%E3%81%AA%E3%81%A3%E3%81%A6%E3%81%AF%E5%8F%A4%E3%81%84%E6%83%85%E5%A0%B1-1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e今となっては古い情報\u003c/h2\u003e\n\n\u003cp\u003e情報を渡すイベントを定義する場合は、\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003edelegate void MyEventHandler(object sender, VacationEventArgs e);\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eというように、デリゲートを定義しよう、と書かれている情報がある。\u003cbr\u003e\nC#2.0以降では、\u003ccode\u003eEventHandler\u0026lt;TEventArgs\u0026gt;\u003c/code\u003eがすでに定義されているので、こうした定義は不要になった。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"まとめ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eまとめ\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003eイベントは、デリゲートによるコールバックメカニズムに、安全なsubscribe/unsubscribe機能を追加する\u003c/li\u003e\n\u003cli\u003eイベントを用いると、クラス間の依存関係を少なくすることができる\u003c/li\u003e\n\u003cli\u003eデリゲートの型は、自分で定義するよりも定義済みのものを選択しよう\u003c/li\u003e\n\u003cli\u003eデリゲートを呼び出すメソッドを定義するときは、そのクラスを継承する場合について考慮しよう\u003c/li\u003e\n\u003cli\u003eSender役のクラスには、subscribeの記述をしてはいけない\u003c/li\u003e\n\u003cli\u003eReceiverの寿命がSenderよりも短い場合、unsubscribeしてメモリリークを防ごう\u003c/li\u003e\n\u003cli\u003e情報を渡すイベントのために、\u003ccode\u003eEventArgs\u003c/code\u003eを継承したクラスを定義し、イベントのデリゲートの型に\u003ccode\u003eEventHandler\u0026lt;TEventArgs\u0026gt;\u003c/code\u003eを使用しよう\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eEventArgs\u003c/code\u003eの派生クラスのインスタンス作成の際、変更可能なオブジェクトの参照を漏らさないようにしよう\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"後書き\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%BE%8C%E6%9B%B8%E3%81%8D\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e後書き\u003c/h1\u003e\n\n\u003cp\u003e以前、イベントについてまとめた投稿について、\u003cbr\u003e\n「混乱があるように見えるのだが、(何かの目的があって)わざとやっているのではないか」\u003cbr\u003e\nというコメントをして、いたく投稿者の気分を害してしまったことがあった。\u003cbr\u003e\n\u003ca href=\"http://qiita.com/hibara/items/9fd56a5d594c000a5df0\" class=\"autolink\" id=\"reference-363de6211f11ae9875e0\"\u003ehttp://qiita.com/hibara/items/9fd56a5d594c000a5df0\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e罪滅ぼしというわけでもないのだが、これでイベントについてスムーズな理解をしてもらえたらと思う。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"参考情報\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8F%82%E8%80%83%E6%83%85%E5%A0%B1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e参考情報\u003c/h1\u003e\n\n\u003cp\u003eC#6.0時代のイベント実装方法\u003cbr\u003e\n\u003ca href=\"http://qiita.com/zakuro9715/items/107b9aa60b114beb206a\" class=\"autolink\" id=\"reference-e354008ea323b2d0ed78\"\u003ehttp://qiita.com/zakuro9715/items/107b9aa60b114beb206a\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e++C++; // 未確認飛行C\u003cbr\u003e\n\u003ca href=\"http://ufcpp.net/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://ufcpp.net/\u003c/a\u003e\u003c/p\u003e\n","createdAt":"2017-01-18T09:09:04Z","elapsedYearsFromLastModifiedAt":1,"encryptedId":"tSRQGYZzkt4PgTLdUr0zMjRTNi2omIVi--ZGImbeUCvFk+dhdw--cB5I0oPNpCoEvy8p2FyVrg==","isBanned":false,"isDeprecated":true,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2020-03-13T05:30:33Z","likesCount":118,"linkUrl":"https://qiita.com/laughter/items/e9cf666e0430acc39e95","organization":null,"originalId":461257,"stockedCount":151,"title":"[C#] イベント入門","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%9C%AC%E7%A8%BF%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\"\u003e本稿について\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E3%81%A8%E3%81%AF\"\u003eイベントとは\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B3%E3%83%BC%E3%83%AB%E3%83%90%E3%83%83%E3%82%AF%E3%81%A8%E3%83%87%E3%83%AA%E3%82%B2%E3%83%BC%E3%83%88\"\u003eコールバックとデリゲート\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%AE%9A%E7%BE%A9%E6%B8%88%E3%81%BF%E3%81%AE%E3%83%87%E3%83%AA%E3%82%B2%E3%83%BC%E3%83%88%E3%81%AE%E5%9E%8B\"\u003e定義済みのデリゲートの型\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%87%E3%83%AA%E3%82%B2%E3%83%BC%E3%83%88%E3%81%AB%E3%82%88%E3%82%8B%E9%80%9A%E7%9F%A5%E3%81%AE%E5%AE%9F%E7%8F%BE\"\u003eデリゲートによる通知の実現\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E3%81%AB%E3%82%88%E3%82%8B%E9%80%9A%E7%9F%A5%E3%81%AE%E5%AE%9F%E7%8F%BE---sender\"\u003eイベントによる通知の実現 - Sender\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E3%81%AE%E5%AE%9A%E7%BE%A9\"\u003eイベントの定義\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%87%E3%83%AA%E3%82%B2%E3%83%BC%E3%83%88%E3%82%92%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%99%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%AE%E5%AE%9A%E7%BE%A9\"\u003eデリゲートを呼び出すメソッドの定義\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#sender%E5%81%B4%E3%81%AB%E3%81%AFsubscribe%E3%81%AE%E8%A8%98%E8%BF%B0%E3%82%92%E3%81%97%E3%81%A6%E3%81%AF%E3%81%84%E3%81%91%E3%81%AA%E3%81%84\"\u003eSender側にはsubscribeの記述をしてはいけない\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E3%81%AE%E5%AE%9A%E7%BE%A9%E3%81%AE%E8%A3%9C%E8%B6%B3\"\u003eイベントの定義の補足\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%87%E3%83%AA%E3%82%B2%E3%83%BC%E3%83%88%E3%82%92%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%99%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%AE%E8%A3%9C%E8%B6%B3\"\u003eデリゲートを呼び出すメソッドの補足\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E3%81%AB%E3%82%88%E3%82%8B%E9%80%9A%E7%9F%A5%E3%81%AE%E5%AE%9F%E7%8F%BE---receiver\"\u003eイベントによる通知の実現 - Receiver\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%A1%E3%83%A2%E3%83%AA%E3%83%AA%E3%83%BC%E3%82%AF%E3%81%AB%E6%B3%A8%E6%84%8F%E3%81%99%E3%82%8B\"\u003eメモリリークに注意する\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%BB%8A%E3%81%A8%E3%81%AA%E3%81%A3%E3%81%A6%E3%81%AF%E5%8F%A4%E3%81%84%E6%83%85%E5%A0%B1\"\u003e今となっては古い情報\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E5%BC%95%E6%95%B0%E3%81%AB%E6%83%85%E5%A0%B1%E3%82%92%E6%8C%81%E3%81%9F%E3%81%9B%E3%81%9F%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E9%80%9A%E7%9F%A5\"\u003eイベント引数に情報を持たせたイベント通知\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%96%B0%E3%81%97%E3%81%84%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E5%BC%95%E6%95%B0%E5%9E%8B%E3%81%AE%E5%AE%9A%E7%BE%A9\"\u003e新しいイベント引数型の定義\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#sender%E5%BD%B9%E3%81%AE%E3%82%AF%E3%83%A9%E3%82%B9\"\u003eSender役のクラス\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#receiver%E5%BD%B9%E3%81%AE%E3%82%AF%E3%83%A9%E3%82%B9\"\u003eReceiver役のクラス\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%BB%8A%E3%81%A8%E3%81%AA%E3%81%A3%E3%81%A6%E3%81%AF%E5%8F%A4%E3%81%84%E6%83%85%E5%A0%B1-1\"\u003e今となっては古い情報\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"\u003eまとめ\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%BE%8C%E6%9B%B8%E3%81%8D\"\u003e後書き\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%8F%82%E8%80%83%E6%83%85%E5%A0%B1\"\u003e参考情報\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":72237,"uuid":"e9cf666e0430acc39e95","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"dqX944yB6eo7Jol/M10svHbANuU=--rwbY6UylZEPXqFxi--kst6Tqzzmn/uua3Ltqus+g==","originalId":72443,"description":".NETやC#界隈でひっそりと生息しているプログラマ。\r\n薄暗く涼しい場所に生息し、おいしいたべものを与えるとよろこぶ。\r\n春菊は苦手。","facebookUrl":null,"githubUrl":null,"isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"","profileImageUrl":"https://qiita-image-store.s3.amazonaws.com/0/72443/profile-images/1473699153","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F72443%2Fprofile-images%2F1473699153?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=cfcbafbdaf0b84e140f06c2d15bc2c8c","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F72443%2Fprofile-images%2F1473699153?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=6e8237d63526abbcb3d6db58e67ba1ef","urlName":"laughter","websiteUrl":"","twitterUrl":null,"twitterUrlName":null,"revealedOrganizations":{"edges":[]}},"tags":[{"name":"C#","urlName":"csharp"},{"name":"初心者向け","urlName":"%e5%88%9d%e5%bf%83%e8%80%85%e5%90%91%e3%81%91"}],"followingLikers":{"edges":[]},"comments":{"totalCount":6}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

C# 9.0 がリリースされるまで秒読みになりましたね！前に C# 8.0 風書き方アレコレを書いてみましたが、9.0 になってしまうと、また新機能が追加されてより良い言語になっていきます。C# 小ネタ：C# 8.0 風の書き方アレコレC# 9.0 は .NET 5.0 で使えるので LTS 版じゃないので仕事で本格的に使える人は少ないかもしれませんが LTS の .NET 6.0 に計画的に移行するように考えて使うというのはありかなぁと思います。
まぁ、そこらへんは置いといて新しいものがでたら趣味では試したい！！ということでやってみましょう。多分、今回追加された中で個人的に一番使いそうな機能です。
イミュータブルなクラスを定義するのが凄く簡単になります。X と Y というプロパティを持った Point 型は以下のように定義できます。ちょっと使ってみましょう。実行するとこんな感じに表示されます。特徴の 1 つはプロパティは読み取り専用で書き換え不可能な点です。一部分だけ値を書き換えたいときは with 式という、これもまた新しい機能で一部分だけ書き換えたコピーを簡単に作れます。他にも分解や比較も出来ます。レコード型は自分でプロパティを定義したりメソッドも定義できます。プロパティに set のかわりに init をつけることでオブジェクト初期化子だけで設定可能なプロパティも指定できます。これはレコードだけじゃなくてクラスや構造体でもいけます。継承も OKレコードはいいですね。いい。これはコンソールアプリとかの Main メソッドを定義しなくてもいい感じにやってくれる奴。こいつもいいやつ。
これを使うとハローワールドがこうなる。最高ASP.NET Core のハローワールド返すだけの Web アプリのコードとかもこんなにすっきりします。シンプルだけど可読性という点ではいい。is not null って書ける。これは、もしかしたら賛否ありそう。でも、予備知識なしだと新しい書き方のほうが読みやすいだろうなぁ。慣れてる人はそうでもないかも。@albireo さんがコメントで以下のコード例を書いてくれました。確かに…！新しい大なり小なりは、比較対象が長い名前や深いプロパティ階層になってしまうときにありがたみが実感できそうです。日本語の正しい訳がわからない…けど型が明らかな時には new 演算子で型名を省略できる便利機能。例えば…C# 9.0 の新機能をまとめた公式ドキュメントは以下のページにあります。C# 9.0 の新機能まだ、新しいページなので機械翻訳だから残念な部分もあるので読める人は英語で目を通すことをお勧めします。そのうち人による翻訳になるといいなぁ…公式じゃないところだと安定の岩永さんのサイトもお勧め。まだ網羅はされてないみたいだけど、そのうち…？C# 言語自体の機能じゃないけどソースジェネレーターというソースコード生成の仕組みも入ったので、みんな大好き Excel VBA マクロでソースコード吐き出してる人は移行先としていいかも？？ということで、来週のリリースが楽しみですね！！



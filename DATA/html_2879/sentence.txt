More than 1 year has passed since last update.初学者やりがち。現在のコンテキストに 'now' という名前は存在しません。
現在のコンテキストに 'log' という名前は存在しません。はい。エラー。なぜなら、
$"a={変数名1},b={変数名2}" は string.Format("a={0},b={1}",変数名1,変数名2); にシンタックスシュガーとしてコンパイル前に変換されているから「string.Format で、 {17} とか書いて、引数の17番目に目的の変数置くとか大変でしょ？　もう何が何番目かわからないでしょ？　ほらほら。僕が変換しといてあげるから～」という親切機能でしかありません。
そのため、↑の例も内部的にはと、なってるんですね。　すると、このスコープではnow,logなんてものは無いわけで。そりゃエラーにもなりますわな。すなわち 実行時解決参照タイミングで展開されてその時のスコープの変数を展開するような仕組みではない わけです。1こうすればエラーは出なくなりますけどー。{now}&gt;{log}当然まんま出てきちゃいますね。じゃぁ、がんばって自分でReplaceする？ということで、変更2019/08/29 13:07:45&gt;なんやかんやはなんやかんやですよ！でるけど・・・。　出るけれどー。
もうちょっとなんとか・・・。やっていることは、先ほども書いたプリコンパイラがやってくれている$付きの文字列のシンタックスシュガーを、実行時に疑似的に解決しているだけです。拡張メソッドなので、.Formatメソッドがstringに対して生えます。(よしなにusingしてね）
引数に渡すのは object です。　今回のようにローカル変数の場合は匿名クラスにしてしまうと、プロパティ名がローカル変数名に設定されるので、らくちんです。匿名クラスじゃなくて、既存インスタンスを渡してもいいですが、Field/Property に外からアクセスすることになるので、publicである必要があるので要注意です。便利！　かな・・・？コメントなどで「なんでそんな面倒臭いことを！？、普通に指定すればいいのでは！？（要約）」等々という反応がありました。　確かにこの記事だけ見ると「で？」となるのもイタシカタガナイ。言葉足らずで申し訳ない。
この拡張メソッドの利用ケースは「外部設定データ（など）で画面などに表示する文言を変更したい」を想定していました。たとえば、エラーログのある1行これにはが出ています。それぞれと変数で定義されているとして、こうすれば、目的のLogがでます。よしよし。そんな中、しばらくそのアプリが動いた後、ふとログを見た偉い人がこう言います。
「pIDってなに？　あ、プロセスID?　じゃぁ、プロセスIDって書いておいてよ 」
あっはいー。しょうがないなぁ。なんでそんなどうでもいいことを・・・ﾌﾞﾂﾌﾞﾂ・・・。　修正してビルドビルドっと。そしてまたある日
「Excelにコピペしたいからさ、各項目Tab（orカンマ)で区切ってくれない？」ぐぬぬ・・・。みなさん、こんなやり取りをあと10回ほど繰り返しますよね？（ブラックでも、ちょっとまって。辞表を投げつけるのはちょっと早い。こんな時のために、 フォーマットはソースコードに書かずに、設定ファイルなどに置いておきたい そして
「あ、それ設定ファイルで変更できるので、お好きにどうぞ。」
と言いたい。（ことがしばしばあります。（よね？）（まぁ、大体言えない））なので、設定ファイル（別にDBのマスタデータでもよいです）にこんな感じに書きたい。こうやって書いても変数展開されないのは、前述したとおり。　あ、Replace4連発だ。これ。　と気付きます。ここで、ここで、ようやく作った拡張メソッドが役に立ちます。やったね！そもそも、よく見る解決方法としてはとして、 「{n} の箇所は置換されるよ！」 と決め打ちするパターン
設定ファイルはこんな感じにプログラムはこんな感じに（書いてて、「まぁ、これでもいいよね」という気にもなってきてしまっているが、負けない！）この、{0}とか{1}とか、超マジックナンバーが設定ファイルに横行するのを嫌がっているわけです。　どうでしょうか、そう考えるとこの拡張メソッドの価値も見えてきたりしませんでしょうか？え。　「プログラム中にどんな変数名で宣言しているか知らないと指定できないじゃないか」って？　そうですね。でも、{0}や{1}みたいにプログラム中のstring.Formatへの引数の順番を知らないと指定できないのと同じですし、だったらただの数字よりは人間にやさしくないですか？あ、はい。　「リファクタリングにめちゃ弱いじゃないか？」と。　ん・・はい・・・そうですね。変数名で探しに行き・・・ますもんね・・・。たしかに・。っ、は・はひっ・・。　「Reflection使ってまですることか。」と。　えぇ、はい。そうですね。・・・すみませんでした・・。そんなにいじめないで。辞表投げつけたくなっちゃう。http://neue.cc/2013/01/05_392.html
neuec神に感謝！「実行時解決はしている」とコメントを頂きました、確かに間違った用語を使ってしまっていたので修正させていただきました。ご指摘ありがとうございます。 ↩



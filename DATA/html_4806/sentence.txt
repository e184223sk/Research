More than 1 year has passed since last update.この記事はUnityゆるふわサマーアドベントカレンダー 2018の1日目です！
(まだ半分くらい埋まってないので、興味があったらぜひご参加くださいw)今回はOculusGoでコントローラーを使う開発をする際に手軽に使えるエミュレータを作ったので、その方法を紹介します。
(Oculus Touchでもエミュレートできるみたいですが、今回はAndroid端末を使った方法です)ソースコードはこちら
https://github.com/nkjzm/OVREmulator出来ることは以下の通りです。※トリガーの判定は対応するボタンがないため利用できません。動作確認をした環境は以下の通りですが特にバージョンに依存せず動くと思います。リフレクションで動的にメソッドを入れ替えています。
OVRInputをそのまま使えるので、少ない変更でエミュレータできるようになりました。タッチパット上の座標を取得するメソッドを例に説明します。Oculusではタッチパット上の座標を以下のように取得できますが、これをGoogleVRで上書きしていきます。まず定義を確認しておきます。上は引数は一つですが、第二引数にデフォルト引数が使われている点に注意です。入れ替えるためのメソッドを用意します。関数名は任意ですが、引数を揃えておきます。準備ができたので、リフレクションでメソッドを入れ替えます。
関数のポインタを入れ替えることで、呼び出し先を変更しています。参考： C#でメソッドを動的に入れ替える - Qiita[InitializeOnLoad]アトリビュートはエディタの起動直後やコンパイル後に自動的に呼ばれる関数です。明示的に呼び出す必要がないため便利です。あとはGoogleVRに含まれるGvrControllerMainを少し拡張したものをシーンに配置するだけで、エミュレータが使用できます。拡張といってもコントローラーの左右の設定をするだけなので、全然難しくないです。OculusのSDKの全てに対応しているわけではありませんが、基本的なデバッグ作業であれば毎回ビルドする必要はなくなるのではないでしょうか。オープンソースで公開しているので、ぜひ気軽に利用してください。プルリクもお待ちしております。
https://github.com/nkjzm/OVREmulator不明点等あれば @nkjzm までお願いします。



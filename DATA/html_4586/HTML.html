<!DOCTYPE html><html><head><meta charset="utf-8" /><title>【Unity】弾幕RTSゲームに対するEntity Component Systemを用いた実装の報告【Unity1Week】 - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/pCYSl5EDgo/items/5ff6fa92386bc046d949" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="if+B+VRL8qZvQ3D0vhK5PurQljBddtoKEq2Z+MBOwkM2b3KLqRXf4gJqngyEwuEvy1+oursw64bos159rqv57w==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta content="@pCYSl5EDgo" name="twitter:creator" /><meta property="og:type" content="article"><meta property="og:title" content="【Unity】弾幕RTSゲームに対するEntity Component Systemを用いた実装の報告【Unity1Week】 - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND00NENRVlc1cGRIbmpnSkhsdkw3bHVaVlNWRlBqZ3JMamc3empnNkRqZ2F2bHI3N2pnWm5qZ290RmJuUnBkSGtnUTI5dGNHOXVaVzUwSUZONWMzUmxiZU9Da3VlVXFPT0JoT09Cbi1XdW4taWpoZU9CcnVXZ3NlV1JpdU9Ba0ZWdWFYUjVNVmRsWld2amdKRSZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTU0JnR4dC1jbGlwPWVsbGlwc2lzJnR4dC1hbGlnbj1jZW50ZXIlMkNtaWRkbGUmcz0zNzI1M2NjZmJhNWU3MjdhMjYwZDdjYzRkZWI3ZmZhMA&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RSEJEV1ZOc05VVkVaMjgmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT00NSZ0eHQtYWxpZ249cmlnaHQlMkNib3R0b20mcz01YmYwNDcwNjQ5YzY4NDM0OWU3ZDUxNDM3ODg5MWUzNQ&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=40232d23cb4fc4a526f7770c3c9fad82"><meta property="og:description" content="この記事がEntity Component System入門者の助けとなることを願って初透光です。

ECSについて初歩的な知識を有していることが前提です。
わからないことがあれば入門記事を参照してください。
C#7.2でソースコード..."><meta content="https://qiita.com/pCYSl5EDgo/items/5ff6fa92386bc046d949" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#,Unity,入門,ECS,unity1week" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 1nzh4zz 38fzdi helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-1nzh4zz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:16px 32px;background-color:#FBE69E;color:rgba(0,0,0,0.87);line-height:1.5;font-weight:600;}@media (max-width:770px){.css-1nzh4zz{padding:16px;}}.css-38fzdi{color:#CA832A;margin-right:4px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-a0809fb1-3d68-4fa3-a683-dd8c12c6b85c"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2FpCYSl5EDgo%2Fitems%2F5ff6fa92386bc046d949">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2FpCYSl5EDgo%2Fitems%2F5ff6fa92386bc046d949">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-a0809fb1-3d68-4fa3-a683-dd8c12c6b85c">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2018-09-27T00:37:05.000+09:00","dateModified":"2018-10-14T21:45:06.000+09:00","headline":"【Unity】弾幕RTSゲームに対するEntity Component Systemを用いた実装の報告【Unity1Week】","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND00NENRVlc1cGRIbmpnSkhsdkw3bHVaVlNWRlBqZ3JMamc3empnNkRqZ2F2bHI3N2pnWm5qZ290RmJuUnBkSGtnUTI5dGNHOXVaVzUwSUZONWMzUmxiZU9Da3VlVXFPT0JoT09Cbi1XdW4taWpoZU9CcnVXZ3NlV1JpdU9Ba0ZWdWFYUjVNVmRsWld2amdKRSZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTU0JnR4dC1jbGlwPWVsbGlwc2lzJnR4dC1hbGlnbj1jZW50ZXIlMkNtaWRkbGUmcz0zNzI1M2NjZmJhNWU3MjdhMjYwZDdjYzRkZWI3ZmZhMA\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RSEJEV1ZOc05VVkVaMjgmdHh0LWNvbG9yPSUyMzMzMyZ0eHQtZm9udD1IaXJhZ2lubyUyMFNhbnMlMjBXNiZ0eHQtc2l6ZT00NSZ0eHQtYWxpZ249cmlnaHQlMkNib3R0b20mcz01YmYwNDcwNjQ5YzY4NDM0OWU3ZDUxNDM3ODg5MWUzNQ\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=40232d23cb4fc4a526f7770c3c9fad82","mainEntityOfPage":"https://qiita.com/pCYSl5EDgo/items/5ff6fa92386bc046d949","author":{"@type":"Person","address":"","email":"pcysl5edgo@yahoo.co.jp","identifier":"pCYSl5EDgo","name":"pCYSl5EDgo","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F256047%2Fprofile-images%2F1546351264?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=c5789bc76dd49b92c1ddc68bc158b06b","url":"https://qiita.com/pCYSl5EDgo","description":"C#!好き!!（語彙不足）\r\nUnityやヴァーレントゥーガ関連の投稿をしていく予定です。","memberOf":[]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://increments.connpass.com/event/211948/">「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催</a><a target="_blank" id="header_text_message_2" href="https://increments.connpass.com/event/211948/">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"pCYSl5EDgo","type":"items","id":"5ff6fa92386bc046d949"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"pCYSl5EDgo","type":"items","id":"5ff6fa92386bc046d949"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":0,"pos_id":"header_text_message_1","message":"「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"pCYSl5EDgo","type":"items","id":"5ff6fa92386bc046d949"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":0,"pos_id":"header_text_message_2","message":"「AirPods Pro」を抽選でプレゼント！Qiita エンジニアフェスタ 2021 Online Meetupを9/9(木)に開催","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/pCYSl5EDgo/items/5ff6fa92386bc046d949","location":"/pCYSl5EDgo/items/5ff6fa92386bc046d949","scheme":"https","host":"qiita.com","port":null,"pathname":"/pCYSl5EDgo/items/5ff6fa92386bc046d949","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"5QmWsjusNxRLhIT6j56gvX8Rf7VIijtzaWpEhShTOCRamWXAxvIaUCatagK1TvisXp5BP67MCv+TdIMARrYDiA==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-02b3cf90-7991-402c-b3f6-f30e135c459a"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/pCYSl5EDgo/items/5ff6fa92386bc046d949/likers" class="css-1iupg5d">19</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">15</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/5ff6fa92386bc046d949/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/pCYSl5EDgo/items/5ff6fa92386bc046d949/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/pCYSl5EDgo/items/5ff6fa92386bc046d949/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/pCYSl5EDgo/items/5ff6fa92386bc046d949/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/pCYSl5EDgo/items/5ff6fa92386bc046d949.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-1nzh4zz"><span class="fa fa-fw fa-warning css-38fzdi"></span><p>More than 1 year has passed since last update.</p></div><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/pCYSl5EDgo"><img class="css-100alwu eyfquo10" src="https://qiita-image-store.s3.amazonaws.com/0/256047/profile-images/1546351264" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/pCYSl5EDgo" class="css-10ougpm">@<!-- -->pCYSl5EDgo</a><div class="css-1ay9vb9"><span><meta content="2018-09-26T15:37:05Z"/><time dateTime="2018-10-14T12:45:06Z" class="css-m19uds">updated at 2018-10-14</time></span></div></div></div></div></div><h1 class="css-cgzq40">【Unity】弾幕RTSゲームに対するEntity Component Systemを用いた実装の報告【Unity1Week】</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/unity" class="css-4czcte">Unity</a><a href="/tags/%e5%85%a5%e9%96%80" class="css-4czcte">入門</a><a href="/tags/ecs" class="css-4czcte">ECS</a><a href="/tags/unity1week" class="css-4czcte">unity1week</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div><p>この記事がEntity Component System入門者の助けとなることを願って初透光です。</p>

<p>ECSについて初歩的な知識を有していることが前提です。<br>
わからないことがあれば<a href="https://qiita.com/pCYSl5EDgo/items/caac60ee41058cde085a" id="reference-7989d52d98cdc725d0ec">入門記事</a>を参照してください。<br>
C#7.2でソースコードを書いていますので、文法的な不明点がある場合は<a href="https://ufcpp.net/study/csharp/" rel="nofollow noopener" target="_blank">ufcpp</a>を参照してください。</p>

<h1>
<span id="執筆経緯" class="fragment"></span><a href="#%E5%9F%B7%E7%AD%86%E7%B5%8C%E7%B7%AF"><i class="fa fa-link"></i></a>執筆経緯</h1>

<p><a href="https://unityroom.com/unity1weeks" rel="nofollow noopener" target="_blank">Unity1週間ゲームジャム</a>に初参加してきました。<br>
これは月曜0時にお題が発表され、それに沿ったゲームを日曜20時までに投稿するという催しです。<br>
今回のお題は「あつい」でした。既に締切を過ぎて様々なゲームが発表されていますが、なかなか参加者の発想の幅が広くて楽しいゲームジャムでした。<br>
きゅうりをできる限り薄切りしていくゲームや、村をうっかり（確信犯）焼き尽くすゲームなど色々ありますので是非遊んでみてください。</p>

<p><del>あまり記事にするのが遅れるのもアレなので省ける解説は大分省いての投稿となりました。</del></p>

<p><a href="https://camo.qiitausercontent.com/70f3abd5edc2679a29bb81f41123ea9922b15800/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3235363034372f31663531633330642d323234662d333434622d653261392d6262363438366239356264342e676966" target="_blank" rel="nofollow noopener"><img src="https://qiita-image-store.s3.amazonaws.com/0/256047/1f51c30d-224f-344b-e2a9-bb6486b95bd4.gif" alt="Unity 2018.2.8f1 Personal (64bit) - [PREVIEW PACKAGES IN USE] - Title.unity - Unity1Week2 - WebGL _DX11 on DX9 GPU_ 2018_09_18 8_56_02-セグメント 1.gif" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/256047/1f51c30d-224f-344b-e2a9-bb6486b95bd4.gif" loading="lazy"></a></p>

<p>さて、私自身は <del>相変わらずヴァーレントゥーガ互換リアルタイムストラテジーを作る練習として</del> <a href="https://unityroom.com/games/p1145141919" rel="nofollow noopener" target="_blank">大量の敵に追いかけられながら敵を焼き殺すというゲーム</a>を作りました。<br>
１週間でどのぐらい自分が作れるのか自分でも全く把握していなかったので当初の予定より大幅に機能を削ぎ落としましたが、なんとか遊べる程度に完成できて良かったです。</p>

<p>Entity Component System（以下ECS）がWebGLに対応していないので<a href="https://qiita.com/pCYSl5EDgo/items/675290daee9a35b8f6d3" id="reference-badbb770fd03ceabc446">パッケージに手を加えて動かせるように自力でなんとかしました。</a><br>
いやぁ…… 一週間ゲームShamu開始前に動かないことに気付けてよかったです。丸1日がこの対応作業で潰れましたからね。</p>

<h1>
<span id="リポジトリ" class="fragment"></span><a href="#%E3%83%AA%E3%83%9D%E3%82%B8%E3%83%88%E3%83%AA"><i class="fa fa-link"></i></a>リポジトリ</h1>

<p><a href="https://github.com/pCYSl5EDgo/Unity1Week_P1145141919" rel="nofollow noopener" target="_blank">今回のゲームのリポジトリ</a><br>
<a href="https://unityroom.com/games/p1145141919" rel="nofollow noopener" target="_blank">今回のゲーム「晩夏の昼の挽歌」へのリンク</a></p>

<p>リポジトリをcloneしたらそのまま遊べます。</p>

<h1>
<span id="前提環境" class="fragment"></span><a href="#%E5%89%8D%E6%8F%90%E7%92%B0%E5%A2%83"><i class="fa fa-link"></i></a>前提環境</h1>

<ul>
<li>WebGL版

<ul>
<li>Unity 2018.2.8f1</li>
<li>ECS 0.0.12-preview.11 on WebGL</li>
<li>Job System不使用</li>
</ul>
</li>
</ul>

<h1>
<span id="設計" class="fragment"></span><a href="#%E8%A8%AD%E8%A8%88"><i class="fa fa-link"></i></a>設計</h1>

<p>ECSはUIやシーン管理、Audio周りに対して現在のところ残念ながら向いていません。その部分は伝統的なMonoBehaviour/Componentで実装しています。<br>
インゲームのコアなロジックに対してECSを使用しています。</p>

<h2>
<span id="シーン概説" class="fragment"></span><a href="#%E3%82%B7%E3%83%BC%E3%83%B3%E6%A6%82%E8%AA%AC"><i class="fa fa-link"></i></a>シーン概説</h2>

<p>シーン数は総計７つ</p>

<ul>
<li>Title

<ul>
<li>難易度や音量を設定するUIシーンを呼び出すボタンとゲーム開始ボタンがあるだけのシンプルなシーンです。当記事では非解説。</li>
</ul>
</li>
<li>MusicSetting

<ul>
<li>音量調節の方法を調べる時間がなかったのでBGM,SEのオンオフ切り替えのみできます。当記事では非解説。</li>
<li>Unity1週間ゲームジャムが終了してからUnity2018.3.0b1が来てNested Prefab使用できるようになったので、もうマルチシーンエディティング君は終わりですね……</li>
</ul>
</li>
<li>DifficultySetting

<ul>
<li>メインのゲームで登場する敵キャラの数を調整したり、戦場の広さを調節することができます。当記事では非解説。</li>
</ul>
</li>
<li>SCWR

<ul>
<li>~なぜSCWRという命名をしたのか正直覚えていません~</li>
<li>ECSが動作するガッツリインゲームな部分です。 #当記事で解説します#。</li>
<li>uGUIのキャンバス及びUI要素とカメラ2つ以外のGameObjectが存在しません。</li>
</ul>
</li>
<li>Ranking

<ul>
<li>GameClear, GameOverからのみ呼び出されて追加されるシーン。当記事では非解説。</li>
<li>詳しくは<a href="https://blog.naichilab.com/entry/webgl-simple-ranking" rel="nofollow noopener" target="_blank">【Unity、WebGL】なるべく簡単にオンラインランキング機能をつけるサンプル</a>を参照してください。</li>
<li>クリアする楽しみの他にハイスコアを狙うやりこみ要素もあるゲームですからランキング機能を付けました。</li>
</ul>
</li>
<li>GameOver
　 - SCWRに追加されます。ここでキルスコアと難易度設定から総合的なランクとスコアを計算し、表示しています。当記事では非解説
　 - 今から作り始めるならNested Prefabにし(ry</li>
<li>GameClear
　 - 上にほぼ同じです。当記事では非解説。
　 - 今ならNested(ry</li>
</ul>

<p><a href="https://camo.qiitausercontent.com/9adb9b359f27bbf971d193a78c1747c3d5f01906/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3235363034372f64336164616366302d373339662d343036652d626331622d3035633832616535393536612e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F256047%2Fd3adacf0-739f-406e-bc1b-05c82ae5956a.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=af39b58c436ffe8467b3cbbe7fa236e2" alt="Untitled Diagram.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/256047/d3adacf0-739f-406e-bc1b-05c82ae5956a.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F256047%2Fd3adacf0-739f-406e-bc1b-05c82ae5956a.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=3672a95f78b0c7480fce318cfc93b1ee 1x" loading="lazy"></a><br>
矢印はシーン遷移を表します。太い矢印はSingleシーン遷移、細い矢印はAdditiveなシーン追加を意味します。</p>

<p>シーン間での情報の共有はScriptableObjectを使用しています。<br>
具体的な方法は<a href="http://tsubakit1.hateblo.jp/entry/2017/06/19/233000" rel="nofollow noopener" target="_blank">安定のテラシュールブログ記事</a>を参照してください。<br>
エディターでプレイするとScriptableObjectが勝手に書き換わる問題は気合でなんとかしました。</p>

<h2>
<span id="中核シーン概説" class="fragment"></span><a href="#%E4%B8%AD%E6%A0%B8%E3%82%B7%E3%83%BC%E3%83%B3%E6%A6%82%E8%AA%AC"><i class="fa fa-link"></i></a>中核シーン概説</h2>

<ul>
<li>Main Camera

<ul>
<li>AudioListnerとAudioSource6つがついています。その中5つがSE用であり、1つがBGM用です。</li>
<li>Event Systemコンポーネントも付属しています。</li>
<li>このゲームのGO is GODクラスであるMangerクラスがAdd Componentされています。</li>
</ul>
</li>
<li>Root Canvas

<ul>
<li>体力ゲージ、機体温度表示UI、キルスコア表示UIを全て含有しています。</li>
<li>UI関連は他のゲームと変わらないであろうので非解説。</li>
</ul>
</li>
<li>UI Camera

<ul>
<li>Root Canvasに表示しているUIが大きすぎてプレイ上微妙に邪魔になったりするので、バックスペースキーで非表示にできるように、UIだけを写すカメラを用意しました。</li>
<li>このGameObjectをinactivateすれば非表示できます。</li>
</ul>
</li>
</ul>

<h3>
<span id="神managerクラス概説あるいはポエム" class="fragment"></span><a href="#%E7%A5%9Emanager%E3%82%AF%E3%83%A9%E3%82%B9%E6%A6%82%E8%AA%AC%E3%81%82%E3%82%8B%E3%81%84%E3%81%AF%E3%83%9D%E3%82%A8%E3%83%A0"><i class="fa fa-link"></i></a>神Managerクラス概説（あるいはポエム）</h3>

<p>Managerクラスはその名の短さが示すように最も中核で全ての依存を管理し、全てのパラメータを受付け、全てのゲーム進行を掌握していた。<br>
人は余りの神威故partialクラスとしてManagerを９つに裂き、その力を減じさせんとした。</p>

<ul>
<li>Manager.cs

<ul>
<li>[SerializeField]が29個もあるので紛うことなき神</li>
<li>Startマジックメソッドから各種設定をセットアップするのがお仕事。</li>
</ul>
</li>
<li>InitializeWorld.cs

<ul>
<li>Manager.csに定義されたSerializeFieldを適切にComponentSystemのコンストラクタに渡すだけの簡単なお仕事。</li>
<li>神は言った。「UNITY_DISABLE_AUTOMATIC_SYSTEM_BOOTSTRAPしない市民は歴史上に存在することを許されていません。」</li>
</ul>
</li>
<li>Update.cs

<ul>
<li>UI全体をUniRxを使用して管理する。</li>
</ul>
</li>
<li>AudioManger.cs

<ul>
<li>SE管理（管理できていると言ってない）を行う。</li>
</ul>
</li>
<li>InitializePlayer.cs

<ul>
<li>プレイヤーを表すEntityはシーン内に常に1つのみ存在し、CreateEntityされた後絶対にDestroyEntityされることはない。（これを保証するものはプログラマーの良心のみである。）</li>
<li>クリティカルな部分であるので神はECSに任せず手ずからプレイヤーの生成を行われたのである。</li>
</ul>
</li>
<li>Stage.cs

<ul>
<li>このゲームは敵を殺した数によって難易度が上昇する。</li>
<li>UniRxを使用してキルスコアに応じて難易度管理をするクラス。</li>
<li>具体的にはECSのコンポーネントシステムのEnabledをtrueにしたりfalseにしたりと切り替えることで難易度管理をしている。</li>
</ul>
</li>
<li>GameStage.cs

<ul>
<li>ネーミングがStage.csと被っていて分かり辛い（確信）</li>
<li>プレイヤーの体力とキルスコアをUniRxを使用して監視し、プレイヤーが死んだりクリアしたりしたら全てのコンポーネントシステムの動作を停止させる。</li>
<li>その後GameOverあるいはGameClearシーンをAdditiveにLoadSceneAsyncする。</li>
</ul>
</li>
<li>UniRx.cs

<ul>
<li>UniRxを活用して入力に対するFacadeクラスとせんとしたが、力及ばずごく一部の武器切り替え機能しか持たない無力なpartialクラス。</li>
</ul>
</li>
<li>LastBoss.cs

<ul>
<li>死産</li>
</ul>
</li>
</ul>

<h1>
<span id="managercsの基礎構造" class="fragment"></span><a href="#managercs%E3%81%AE%E5%9F%BA%E7%A4%8E%E6%A7%8B%E9%80%A0"><i class="fa fa-link"></i></a>Manager.csの基礎構造</h1>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">Manager.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="p">[</span><span class="nf">RequireComponent</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">Camera</span><span class="p">))]</span>
<span class="k">sealed</span> <span class="k">partial</span> <span class="k">class</span> <span class="nc">Manager</span> <span class="p">:</span> <span class="n">MonoBehaviour</span>
<span class="p">{</span>
    <span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span> <span class="n">ScriptableObjects</span><span class="p">.</span><span class="n">Map</span> <span class="n">mapTable</span><span class="p">;</span>
    <span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span> <span class="n">Material</span> <span class="n">unlit</span><span class="p">;</span>
    <span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span> <span class="n">ScriptableObjects</span><span class="p">.</span><span class="n">EnemyDisplay</span> <span class="n">enemyDisplay</span><span class="p">;</span>
    <span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span> <span class="n">ScriptableObjects</span><span class="p">.</span><span class="n">Speed</span> <span class="n">playerSpeeds</span><span class="p">;</span>
    <span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span> <span class="n">ScriptableObjects</span><span class="p">.</span><span class="n">Speed</span> <span class="n">enemySpeeds</span><span class="p">;</span>
    <span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span> <span class="n">AudioSource</span> <span class="n">BgmSource</span><span class="p">;</span>
    <span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span> <span class="n">AudioClip</span><span class="p">[]</span> <span class="n">BgmClips</span><span class="p">;</span>
    <span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span> <span class="kt">float</span> <span class="n">heatDamageRatio</span><span class="p">;</span>
    <span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span> <span class="kt">float</span> <span class="n">coolRatio</span><span class="p">;</span>
    <span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span> <span class="kt">float</span> <span class="n">rainCoolPower</span><span class="p">;</span>
    <span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span> <span class="kt">float</span> <span class="n">rainCoolTimeSpan</span><span class="p">;</span>
    <span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span> <span class="kt">float</span> <span class="n">rainCoolFrequency</span><span class="p">;</span>
    <span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span> <span class="n">ScriptableObjects</span><span class="p">.</span><span class="n">SkillSetting</span> <span class="n">snowSkillSetting</span><span class="p">;</span>
    <span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span> <span class="n">AudioClip</span> <span class="n">takenokoBulletShoot</span><span class="p">;</span>
    <span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span> <span class="n">AudioClip</span> <span class="n">takenokoBulletBurst</span><span class="p">;</span>
    <span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span> <span class="n">AudioClip</span> <span class="n">snowBurst</span><span class="p">;</span>
    <span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span> <span class="n">AudioSource</span><span class="p">[]</span> <span class="n">sources</span><span class="p">;</span>
    <span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span> <span class="n">Sprite</span> <span class="n">playerSprite</span><span class="p">;</span>
    <span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span> <span class="n">Material</span> <span class="n">playerMaterial</span><span class="p">;</span>
    <span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span> <span class="n">Sprite</span> <span class="n">kinokoHammer</span><span class="p">;</span>
    <span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span> <span class="n">Material</span> <span class="n">kinokoMaterial</span><span class="p">;</span>
    <span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span> <span class="n">GameObject</span> <span class="err">武器欄</span><span class="p">;</span>
    <span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span> <span class="n">ScriptableObjects</span><span class="p">.</span><span class="n">Speed</span> <span class="n">stage4EnemySpeed</span><span class="p">;</span>
    <span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span> <span class="n">GameObject</span> <span class="n">respawnDisplay</span><span class="p">;</span>
    <span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span> <span class="n">AudioSource</span> <span class="n">BGMSource</span><span class="p">;</span>
    <span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span> <span class="n">ScriptableObjects</span><span class="p">.</span><span class="n">TitleSettings</span> <span class="n">titleSettings</span><span class="p">;</span>
    <span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span> <span class="n">ScriptableObjects</span><span class="p">.</span><span class="n">Result</span> <span class="n">resultSettings</span><span class="p">;</span>
    <span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span> <span class="n">ScriptableObjects</span><span class="p">.</span><span class="n">SkillSetting</span><span class="p">[]</span> <span class="n">playerSkills</span><span class="p">;</span>
    <span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span> <span class="n">ScriptableObjects</span><span class="p">.</span><span class="n">SkillSetting</span> <span class="n">bombSkillEffect</span><span class="p">;</span>
    <span class="k">private</span> <span class="n">EntityManager</span> <span class="n">manager</span><span class="p">;</span>
    <span class="k">private</span> <span class="n">Camera</span> <span class="n">UICamera</span><span class="p">;</span>
    <span class="k">private</span> <span class="n">EnemyPlayerCollisionSystem</span> <span class="n">EnemyPlayerCollisionSystem</span><span class="p">;</span>
    <span class="k">private</span> <span class="n">RainSystem</span> <span class="n">RainSystem</span><span class="p">;</span>
    <span class="k">private</span> <span class="n">PlayerShootSystem</span> <span class="n">PlayerShootSystem</span><span class="p">;</span>

    <span class="k">void</span> <span class="nf">Start</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">mainCamera</span> <span class="p">=</span> <span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">Camera</span><span class="p">&gt;();</span>
        <span class="n">UICamera</span> <span class="p">=</span> <span class="n">GameObject</span><span class="p">.</span><span class="nf">Find</span><span class="p">(</span><span class="s">"UI Camera"</span><span class="p">).</span><span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">Camera</span><span class="p">&gt;();</span>
        <span class="n">sourceInfos</span> <span class="p">=</span> <span class="k">new</span> <span class="p">(</span><span class="kt">float</span><span class="p">,</span> <span class="kt">float</span><span class="p">,</span> <span class="n">AudioClip</span><span class="p">)[</span><span class="n">sources</span><span class="p">.</span><span class="n">Length</span><span class="p">];</span>
        <span class="kt">var</span> <span class="n">position</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">position</span><span class="p">;</span>
        <span class="n">position</span><span class="p">.</span><span class="n">x</span> <span class="p">=</span> <span class="n">titleSettings</span><span class="p">.</span><span class="n">Width</span> <span class="p">*</span> <span class="m">0.5f</span><span class="p">;</span>
        <span class="n">position</span><span class="p">.</span><span class="n">z</span> <span class="p">=</span> <span class="n">titleSettings</span><span class="p">.</span><span class="n">Height</span> <span class="p">*</span> <span class="m">0.5f</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">position</span> <span class="p">=</span> <span class="n">position</span><span class="p">;</span>
        <span class="err">#</span><span class="k">if</span> <span class="n">UNITY_EDITOR</span>
           <span class="nf">Validate</span><span class="p">();</span>
        <span class="err">#</span><span class="n">endif</span>
        <span class="nf">InitializeAudio</span><span class="p">();</span>
        <span class="nf">InitializeWorld</span><span class="p">();</span>
        <span class="nf">InitializeUGUI</span><span class="p">();</span>
        <span class="nf">InitializeBGM</span><span class="p">();</span>
        <span class="nf">InitializeUniRx</span><span class="p">();</span>
        <span class="nf">InitializeStageWatch</span><span class="p">();</span>
        <span class="nf">InitializeGameOverUI</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>ScriptableObjects名前空間は肥大化するSerializeFieldに抗うためにScriptableObjectを定義している空間です。<br>
ScriptableObjects.TitleSettings titleSettingsとScriptableObjects.Result resultSettingsの2つがシーン間で共有するScriptableObjectsです。<br>
他のScriptableObjectsはreadonlyとして扱うようプログラマーの良心に期待しています。<br>
titleSettingsに関してはManagerクラスの所属するSCWRシーン内でreadonlyとして扱うようプログラマーの(ry<br>
resultSettingsはSCWRシーン内からのみ書き込み可能であるという設定で良心あるプログラマーに扱(ry</p>

<p>ここら辺を厳密に良心や規約によらずコンパイラーに制限してもらう方法に心当たりはありますが、一週間ゲームジャムでやるには個人開発なので必要性が薄い＆時間が足りないのでやっていません。</p>

<h2>
<span id="シーン毎にアクセシビリティを変更する方法読み飛ばし可" class="fragment"></span><a href="#%E3%82%B7%E3%83%BC%E3%83%B3%E6%AF%8E%E3%81%AB%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B7%E3%83%93%E3%83%AA%E3%83%86%E3%82%A3%E3%82%92%E5%A4%89%E6%9B%B4%E3%81%99%E3%82%8B%E6%96%B9%E6%B3%95%E8%AA%AD%E3%81%BF%E9%A3%9B%E3%81%B0%E3%81%97%E5%8F%AF"><i class="fa fa-link"></i></a>シーン毎にアクセシビリティを変更する方法（読み飛ばし可）</h2>

<ul>
<li>Scriptsフォルダの下にシーンごとにフォルダを用意します。</li>
<li>各シーンフォルダにasmdefファイルを用意します。</li>
<li>readonlyやwriteonlyにしたいフィールドに対するpublicアクセサを書きましょう。

<ul>
<li>この時一般のクラスから見えないようにする部分にinternal修飾子を付与しましょう。</li>
</ul>
</li>
<li>シーンフォルダにAssemblyInfo.csを書きましょう。</li>
</ul>

<div class="code-frame" data-lang="cshap">
<div class="code-lang"><span class="bold">Scripts/CSWR/AssemblyInfo.cs</span></div>
<div class="highlight"><pre class="with-code"><code>using System.Runtime.CompilerServices;
[assembly: InternalsVisibleTo("Unity1Week.Title")]
</code></pre></div>
</div>

<p>こんな感じで書けばCSWRシーンのinternalメンバーにTitleシーンからのみアクセスできるようになります。</p>

<h2>
<span id="initializeworldcs" class="fragment"></span><a href="#initializeworldcs"><i class="fa fa-link"></i></a>InitializeWorld.cs</h2>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre class="with-code"><code><span class="k">private</span> <span class="k">void</span> <span class="nf">InitializeWorld</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">Mesh</span> <span class="n">enemyMesh</span> <span class="p">=</span> <span class="nf">RotateSprite</span><span class="p">(</span><span class="n">enemyDisplay</span><span class="p">.</span><span class="n">enemySprite</span><span class="p">);</span>
    <span class="kt">var</span> <span class="n">world</span> <span class="p">=</span> <span class="n">World</span><span class="p">.</span><span class="n">Active</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">World</span><span class="p">(</span><span class="s">"default"</span><span class="p">);</span>
    <span class="n">world</span><span class="p">.</span><span class="nf">SetDefaultCapacity</span><span class="p">(</span><span class="m">1</span> <span class="p">&lt;&lt;</span> <span class="m">18</span><span class="p">);</span>
    <span class="n">manager</span> <span class="p">=</span> <span class="n">world</span><span class="p">.</span><span class="n">CreateManager</span><span class="p">&lt;</span><span class="n">EntityManager</span><span class="p">&gt;();</span>
    <span class="kt">var</span> <span class="n">range</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Unity</span><span class="p">.</span><span class="n">Mathematics</span><span class="p">.</span><span class="nf">uint2</span><span class="p">(</span><span class="n">titleSettings</span><span class="p">.</span><span class="n">Width</span><span class="p">,</span> <span class="n">titleSettings</span><span class="p">.</span><span class="n">Height</span><span class="p">);</span>
    <span class="kt">var</span> <span class="n">decidePositionHashCodeSystem</span> <span class="p">=</span> <span class="n">world</span><span class="p">.</span><span class="n">CreateManager</span><span class="p">&lt;</span><span class="n">DecidePositionHashCodeSystem</span><span class="p">&gt;(</span><span class="n">range</span><span class="p">);</span>
    <span class="kt">var</span> <span class="n">enemyHashCodes</span> <span class="p">=</span> <span class="n">decidePositionHashCodeSystem</span><span class="p">.</span><span class="n">EnemyHashCodes</span><span class="p">;</span>
    <span class="kt">var</span> <span class="n">snowHashCodes</span> <span class="p">=</span> <span class="n">decidePositionHashCodeSystem</span><span class="p">.</span><span class="n">SnowBulletCodes</span><span class="p">;</span>
    <span class="kt">var</span> <span class="n">playerBulletHashCodes</span> <span class="p">=</span> <span class="n">decidePositionHashCodeSystem</span><span class="p">.</span><span class="n">PlayerBulletCodes</span><span class="p">;</span>
    <span class="kt">var</span> <span class="n">playerBulletPositionHashSet</span> <span class="p">=</span> <span class="n">decidePositionHashCodeSystem</span><span class="p">.</span><span class="n">PlayerBulletPositionHashCodeSet</span><span class="p">;</span>
    <span class="kt">var</span> <span class="n">snowBulletPositionHashSet</span> <span class="p">=</span> <span class="n">decidePositionHashCodeSystem</span><span class="p">.</span><span class="n">SnowBulletPositionHashCodeSet</span><span class="p">;</span>
    <span class="kt">var</span> <span class="n">chips</span> <span class="p">=</span> <span class="nf">InitializePlane</span><span class="p">(</span><span class="n">range</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">range</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
    <span class="nf">InitializePlayer</span><span class="p">(</span><span class="n">range</span><span class="p">,</span> <span class="m">100</span><span class="p">,</span> <span class="n">InitialTemperature</span><span class="p">,</span> <span class="n">ThermalDeathPoint</span><span class="p">);</span>
    <span class="n">world</span><span class="p">.</span><span class="nf">CreateManager</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">PlayerEnemyRenderSystem</span><span class="p">),</span> <span class="n">mainCamera</span><span class="p">,</span> <span class="n">playerSprite</span><span class="p">,</span> <span class="n">playerMaterial</span><span class="p">,</span> <span class="n">enemyMesh</span><span class="p">,</span> <span class="k">new</span> <span class="n">Material</span><span class="p">[]</span> <span class="p">{</span> <span class="n">enemyDisplay</span><span class="p">.</span><span class="n">bossMaterial</span><span class="p">,</span> <span class="n">enemyDisplay</span><span class="p">.</span><span class="n">leaderMaterial</span><span class="p">,</span> <span class="n">enemyDisplay</span><span class="p">.</span><span class="n">subordinateMaterial</span> <span class="p">});</span>
    <span class="n">world</span><span class="p">.</span><span class="nf">CreateManager</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">MoveSystem</span><span class="p">));</span>
    <span class="n">world</span><span class="p">.</span><span class="nf">CreateManager</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">EnemyBulletRenderSystem</span><span class="p">),</span> <span class="n">mainCamera</span><span class="p">,</span> <span class="n">snowSkillSetting</span><span class="p">.</span><span class="n">Sprites</span><span class="p">[</span><span class="m">0</span><span class="p">],</span> <span class="n">snowSkillSetting</span><span class="p">.</span><span class="n">Material</span><span class="p">);</span>
    <span class="n">world</span><span class="p">.</span><span class="nf">CreateManager</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">MoveEnemySystem</span><span class="p">),</span> <span class="n">player</span><span class="p">);</span>
    <span class="n">world</span><span class="p">.</span><span class="nf">CreateManager</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">EnemySnowShootSystem</span><span class="p">),</span> <span class="n">player</span><span class="p">,</span> <span class="m">4</span><span class="p">);</span>
    <span class="n">world</span><span class="p">.</span><span class="nf">CreateManager</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">ConfinePlayerPositionSystem</span><span class="p">),</span> <span class="n">player</span><span class="p">,</span> <span class="n">range</span><span class="p">,</span> <span class="n">mainCamera</span><span class="p">.</span><span class="n">transform</span><span class="p">);</span>
    <span class="n">world</span><span class="p">.</span><span class="nf">CreateManager</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">KinokoRenderSystem</span><span class="p">),</span> <span class="n">mainCamera</span><span class="p">,</span> <span class="n">kinokoHammer</span><span class="p">,</span> <span class="n">kinokoMaterial</span><span class="p">,</span> <span class="m">120</span> <span class="p">*</span> <span class="n">Math</span><span class="p">.</span><span class="n">PI</span> <span class="p">/</span> <span class="m">180</span><span class="p">,</span> <span class="m">1f</span><span class="p">);</span>
    <span class="n">PlayerShootSystem</span> <span class="p">=</span> <span class="n">world</span><span class="p">.</span><span class="n">CreateManager</span><span class="p">&lt;</span><span class="n">PlayerShootSystem</span><span class="p">&gt;(</span><span class="n">player</span><span class="p">,</span> <span class="n">mainCamera</span><span class="p">,</span> <span class="k">new</span> <span class="nf">Action</span><span class="p">(</span><span class="n">TryToPlayTakenokoShoot</span><span class="p">));</span>
    <span class="kt">var</span> <span class="n">SpawnEnemySystem</span> <span class="p">=</span> <span class="nf">InitializeSpawnEnemy</span><span class="p">(</span><span class="n">player</span><span class="p">,</span> <span class="n">enemyMesh</span><span class="p">,</span> <span class="n">world</span><span class="p">,</span> <span class="n">range</span><span class="p">,</span> <span class="n">titleSettings</span><span class="p">.</span><span class="n">LeaderCount</span><span class="p">);</span>
    <span class="n">deathCounter</span> <span class="p">=</span> <span class="n">SpawnEnemySystem</span><span class="p">.</span><span class="n">DeathCount</span><span class="p">;</span>
    <span class="n">nearToRespawn</span> <span class="p">=</span> <span class="n">SpawnEnemySystem</span><span class="p">.</span><span class="n">NearToRespawn</span><span class="p">;</span>
    <span class="n">world</span><span class="p">.</span><span class="nf">CreateManager</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">TakenokoEnemyHitCheckSystem</span><span class="p">),</span> <span class="m">0.16f</span><span class="p">,</span> <span class="n">enemyHashCodes</span><span class="p">,</span> <span class="n">playerBulletHashCodes</span><span class="p">,</span> <span class="n">playerBulletPositionHashSet</span><span class="p">,</span> <span class="k">new</span> <span class="nf">Action</span><span class="p">(</span><span class="n">TryToPlayTakenokoBurst</span><span class="p">));</span>
    <span class="n">world</span><span class="p">.</span><span class="nf">CreateManager</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">PlayerMoveSystem</span><span class="p">),</span> <span class="n">player</span><span class="p">,</span> <span class="n">mainCamera</span><span class="p">.</span><span class="n">transform</span><span class="p">);</span>
    <span class="nf">InitializeAnimationRenderSystem</span><span class="p">(</span><span class="n">world</span><span class="p">,</span> <span class="n">takenokoBulletBurst</span><span class="p">.</span><span class="n">length</span><span class="p">);</span>
    <span class="n">world</span><span class="p">.</span><span class="nf">CreateManager</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">DestroyEnemyOutOfBoundsSystem</span><span class="p">),</span> <span class="n">range</span><span class="p">);</span>
    <span class="n">world</span><span class="p">.</span><span class="nf">CreateManager</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">DecideMoveSpeedSystem</span><span class="p">),</span> <span class="n">range</span><span class="p">,</span> <span class="n">chips</span><span class="p">,</span> <span class="n">playerSpeeds</span><span class="p">.</span><span class="n">Speeds</span><span class="p">,</span> <span class="n">enemySpeeds</span><span class="p">.</span><span class="n">Speeds</span><span class="p">);</span>
    <span class="n">world</span><span class="p">.</span><span class="nf">CreateManager</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">UpdateCoolTimeSystem</span><span class="p">));</span>
    <span class="n">world</span><span class="p">.</span><span class="nf">CreateManager</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">TakenokoRenderSystem</span><span class="p">),</span> <span class="n">mainCamera</span><span class="p">,</span> <span class="n">playerSkills</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">Sprites</span><span class="p">[</span><span class="m">0</span><span class="p">],</span> <span class="n">playerSkills</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">Material</span><span class="p">);</span>
    <span class="n">world</span><span class="p">.</span><span class="nf">CreateManager</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">BombHitCheckSystem</span><span class="p">),</span> <span class="n">player</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="n">enemyHashCodes</span><span class="p">);</span>
    <span class="n">world</span><span class="p">.</span><span class="nf">CreateManager</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">ChipRenderSystem</span><span class="p">),</span> <span class="n">mainCamera</span><span class="p">,</span> <span class="n">range</span><span class="p">,</span> <span class="n">chips</span><span class="p">,</span> <span class="n">mapTable</span><span class="p">.</span><span class="n">chipTemperatures</span><span class="p">,</span> <span class="n">mapTable</span><span class="p">.</span><span class="n">map</span><span class="p">,</span> <span class="n">unlit</span><span class="p">);</span>
    <span class="n">world</span><span class="p">.</span><span class="nf">CreateManager</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">SnowPlayerHitCheckSystem</span><span class="p">),</span> <span class="n">player</span><span class="p">,</span> <span class="n">snowSkillSetting</span><span class="p">.</span><span class="n">UtilityNumber</span><span class="p">,</span> <span class="n">deathCounter</span><span class="p">,</span> <span class="m">0.5f</span><span class="p">,</span> <span class="n">snowHashCodes</span><span class="p">,</span> <span class="n">playerBulletHashCodes</span><span class="p">,</span> <span class="n">snowBulletPositionHashSet</span><span class="p">,</span> <span class="k">new</span> <span class="nf">Action</span><span class="p">(</span><span class="n">TryToPlaySnowBurst</span><span class="p">));</span>
    <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">RainSystem</span> <span class="p">=</span> <span class="n">world</span><span class="p">.</span><span class="n">CreateManager</span><span class="p">&lt;</span><span class="n">RainSystem</span><span class="p">&gt;(</span><span class="n">range</span><span class="p">,</span> <span class="n">rainCoolTimeSpan</span><span class="p">,</span> <span class="n">rainCoolPower</span><span class="p">,</span> <span class="n">rainCoolFrequency</span><span class="p">)).</span><span class="n">Enabled</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">EnemyPlayerCollisionSystem</span> <span class="p">=</span> <span class="n">world</span><span class="p">.</span><span class="n">CreateManager</span><span class="p">&lt;</span><span class="n">EnemyPlayerCollisionSystem</span><span class="p">&gt;(</span><span class="n">player</span><span class="p">,</span> <span class="n">enemyHashCodes</span><span class="p">,</span> <span class="m">0.16f</span><span class="p">,</span> <span class="n">deathCounter</span><span class="p">)).</span><span class="n">Enabled</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
    <span class="n">world</span><span class="p">.</span><span class="nf">CreateManager</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">PlayerTemperatureSystem</span><span class="p">),</span> <span class="n">player</span><span class="p">,</span> <span class="n">range</span><span class="p">,</span> <span class="n">chips</span><span class="p">,</span> <span class="n">heatDamageRatio</span><span class="p">,</span> <span class="n">coolRatio</span><span class="p">);</span>
    <span class="n">world</span><span class="p">.</span><span class="nf">CreateManager</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">UtusemiRenderSystem</span><span class="p">),</span> <span class="n">mainCamera</span><span class="p">,</span> <span class="n">playerSkills</span><span class="p">[</span><span class="m">1</span><span class="p">].</span><span class="n">Sprites</span><span class="p">[</span><span class="m">0</span><span class="p">],</span> <span class="n">playerSkills</span><span class="p">[</span><span class="m">1</span><span class="p">].</span><span class="n">Material</span><span class="p">,</span> <span class="m">15</span><span class="p">);</span>
    <span class="n">ScriptBehaviourUpdateOrder</span><span class="p">.</span><span class="nf">UpdatePlayerLoop</span><span class="p">(</span><span class="n">world</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>World.CreateManager(Type t, paramas object[] constructorArguments)は内部的にActivator.CreateInstanceを使用しています。<br>
よって、ComponentSystemに対する依存性注入は純粋にコンストラクタ経由で行えます。<br>
<del>ECS標準のMeshInstanceRendererSystemはActiveCameraというフィールドを外部に露出して書き込んでもらうことを前提とした設計ですが、それなんて前時代</del><br>
ComponentSystemから外部にフィールドを公開する場合もreadonlyフィールドなので勝手に書き換えられる心配をしなくてすみます。 <del>readonlyが使えないMonoBehaviourとは違うのだよ！</del></p>

<p>ちょっと残念なのは参照の依存関係上CreateManagerする順番が割と重要なことですね。大半のComponentSystemは他のComponentSystemに依存していないので初期化順番を気にしなくていいのですが……</p>

<p>24個もComponentSystemをCreateManagerしていますが、この規模のゲームとしてはどうなのでしょうかね？<br>
ComponentSystem個々の働きを確認してみましょう。</p>

<ul>
<li>描画系６つ

<ul>
<li>AnimationSkillRender</li>
<li>爆発のスプライトコマ落ちアニメーションを扱います。爆発以外のアニメーションスプライトも統一的に扱えるよう設計しましたが、他にアニメするエフェクトがなかったです<img alt=":innocent:" class="emoji" height="20" src="https://cdn.qiita.com/emoji/twemoji/unicode/1f607.png" title=":innocent:" width="20" loading="lazy">
</li>
<li>ChipRender</li>
<li>地面のマップチップを描画するシステムです。このゲームではプレイヤーの攻撃により地面の種類が変化しますし、マップも自動生成であるので事前にテクスチャをベイクするという手法を取れませんでした。そのためマップ描画専用のシステムを用意しました。</li>
<li>PlayerEnemyRender</li>
<li>敵とプレイヤーを描画します。MeshInstanceRendererSystemは内部動作が複雑で不必要に高機能なので使用しませんでした。</li>
<li>リポジトリを見れば十分わかると思うので当記事では解説しません。</li>
<li>EnemyBulletRender</li>
<li>アメイジングトレンチハンマーRender</li>
<li>ドウリルヴェルファーRender</li>
<li>空蝉Render</li>
<li>この4つのComponentSystemは攻撃を描画するためのものです。個々の攻撃の仕様が微妙に違うので専用のComponentSystemをそれぞれに用意しました。もうちょっと工夫すれば統一的に扱えたでしょう。</li>
<li>リポジトリを見れば十分わかると思うので当記事では解説しません。</li>
</ul>
</li>
<li>敵とプレイヤーの移動系６つ

<ul>
<li>DecideMoveSpeed</li>
<li>このゲームでは地形マス毎に移動力が設定されていますので、現在位置に応じて毎フレーム移動力を再計算しています。</li>
<li>リポジトリを見れば十分わかると思うので当記事では解説しません。</li>
<li>ConfinePlayerPosition</li>
<li>DestroyEnemyOutOfBounds</li>
<li>戦場の外にプレイヤーが出ることが出来ないように制限しています。</li>
<li>敵や弾丸は制限せず、外に出た場合その場でDestroyEntityしています。</li>
<li>生成と削除のコストが安いECSだからこそできることですね。</li>
<li>リポジトリを見れば十分わかると思うので当記事では解説しません。</li>
<li>HeadingEnemy</li>
<li>一定時間毎に敵は移動方向を変更します。</li>
<li>リポジトリを見れば十分わかると思うので当記事では解説しません。</li>
<li>Move</li>
<li>移動方向(Heading)と移動速度(MoveSpeed)を元にあらゆるEnityのPositionを更新します。</li>
<li>リポジトリを見れば十分わかると思うので当記事では解説しません。</li>
<li>PlayerMove</li>
<li>Playerの移動方向はInputから決定します。また、カメラが常にプレイヤーを中央に捉え続けるように設定しました。</li>
<li>リポジトリを見れば十分わかると思うので当記事では解説しません。</li>
</ul>
</li>
<li>当たり判定系４つ

<ul>
<li>BombHit</li>
<li>ドウリルヴェルファーが敵に当たった後発生する爆炎が敵やプレイヤーにダメージを与える処理をします。</li>
<li>爆炎とプレイヤー・敵の衝突判定を実行</li>
<li>EnemyPlayerCollision</li>
<li>敵とプレイヤーの衝突判定。プレイヤーの体力を削る処理を含む。</li>
<li>SnowPlayerHit</li>
<li>敵が放つ攻撃とプレイヤー・プレイヤーの放ったドウリルヴェルファーとの衝突判定。</li>
<li>TakenokoEnemyHit</li>
<li>ドウリルヴェルファーと敵の衝突判定</li>
<li><del><a href="/mao_" class="user-mention js-hovercard" title="mao_" data-hovercard-target-type="user" data-hovercard-target-name="mao_">@mao_</a> さんがいずれECSにおける衝突判定に関するまとめ記事を書かれるそうなので詳細な解説はしません。</del></li>
<li><a href="https://qiita.com/mao_/items/ad8a09a9c6403a2e84cf" id="reference-f8c03bbe0bbe5c61e455">解説記事が発表されました。</a></li>
<li>NativeMultiHashMap&lt;ulong,ValueTuple&lt;Entity,float2&gt;&gt;をforeachで回して格子内での衝突判定をしています。<a href="https://qiita.com/kodai100/items/d1ddb3f86ba5dccccf9f" id="reference-0de3656c7eceea98cf55">参考資料</a>
</li>
</ul>
</li>
<li>弾幕射出など攻撃系４つ

<ul>
<li>UpdateCoolTime</li>
<li>スキルクールタイムを採用しています。プレイヤーとスキルを使用する全ての敵のスキルのクールタイムを更新します。ただ、別にこのシステムよく考えたら不要なのですよね……</li>
<li>
<a href="https://www.slideshare.net/UnityTechnologiesJapan/unite-2018-tokyo" rel="nofollow noopener" target="_blank">【Unite Tokyo 2018】誘導ミサイル完全マスター</a>の116枚目あたりのテクニック使えばよかったです……</li>
<li>PlayerShoot</li>
<li>プレイヤーのスキルがクールタイムよりも長く使用されず、かつマウスの左ボタンが押されている場合にスキルを使用します。</li>
<li>EnemyShoot</li>
<li>上に同じ</li>
<li>LaserShoot</li>
<li>死産</li>
<li>リポジトリ読めば十分理解できます。</li>
</ul>
</li>
<li>その他４つ

<ul>
<li>Rain</li>
<li>時間経過による地形変更システム。リポジトリを読めば十分理解できるので当記事では非解説。</li>
<li>SpawnEnemy</li>
<li>敵が一定以下に減らされたりなど特定条件を満たした場合に大量の敵を発生させる。</li>
<li>PlayerTemperature</li>
<li>プレイヤーの機体温度を管理する。一定以上の機体温度ではプレイヤーにダメージを与える。</li>
</ul>
</li>
</ul>

<h1>
<span id="描画系解説" class="fragment"></span><a href="#%E6%8F%8F%E7%94%BB%E7%B3%BB%E8%A7%A3%E8%AA%AC"><i class="fa fa-link"></i></a>描画系解説</h1>

<p>このゲームはプレイヤー・敵、エフェクト等すべてをXW平面上に描画しています。<br>
それをY軸上に存在するカメラが上から眺めている形になります。<br>
<a href="https://camo.qiitausercontent.com/cd2cd3a5be9d058a786a0e512e07b0514567a5bf/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3235363034372f33353561363436362d306436392d343937382d636562612d3566626338373264656332642e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F256047%2F355a6466-0d69-4978-ceba-5fbc872dec2d.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=88feae6ed07a94778e7a59f56ef38f5e" alt="キャプチャ.PNG" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/256047/355a6466-0d69-4978-ceba-5fbc872dec2d.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F256047%2F355a6466-0d69-4978-ceba-5fbc872dec2d.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=1ddebbf7f6b009780a07bb8f6d3cc36a 1x" loading="lazy"></a></p>

<p>ECSにおける一般的な描画方法については<a href="https://qiita.com/mao_/items/c4a217b33a0a94d5d52f" id="reference-2e198e97487ec985768f">次の記事</a>を参照するとよいでしょう。</p>

<h2>
<span id="animationskillrendercs" class="fragment"></span><a href="#animationskillrendercs"><i class="fa fa-link"></i></a>AnimationSkillRender.cs</h2>

<p>一番工夫がわかりやすいシステムから解説しましょう。 <del>折角スケールするように設計しても対象が1つしかないので無駄とは言ってはいけない。</del><br>
<a href="https://docs.unity3d.com/ScriptReference/Graphics.DrawMeshInstancedIndirect.html" rel="nofollow noopener" target="_blank">Graphics.DrawMeshInstancedIndirect</a>が何故かWebGLで動かなかったので次善の策として<a href="https://docs.unity3d.com/ScriptReference/Graphics.DrawMeshInstanced.html" rel="nofollow noopener" target="_blank">Graphics.DrawMeshInstanced</a>を使用しています。<br>
<a href="https://docs.unity3d.com/ScriptReference/Graphics.DrawMeshInstancedIndirect.html" rel="nofollow noopener" target="_blank">Graphics.DrawMeshInstancedIndirect</a>関連は凡ミスが発生しやすい面倒なメソッドなので、何か私が気付かずにミスっているだけという可能性も高いですがね。<br>
<a href="https://docs.unity3d.com/ScriptReference/Graphics.DrawMeshInstanced.html" rel="nofollow noopener" target="_blank">Graphics.DrawMeshInstanced</a>は一度のBatchで描画できる対象数が1023個に制限されているため、数万個を描画しようとするとBatchCountがゴリゴリ増える欠点があります。</p>

<p>このシステムではスプライトをgifのようにアニメーションさせつつ大量に描画しています。<br>
<a href="https://camo.qiitausercontent.com/f88b8052a5b89c5888ac6fe20ef988ab4e1bda97/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3235363034372f37396537326162362d343930382d373263372d316139352d6437383230353062613234622e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F256047%2F79e72ab6-4908-72c7-1a95-d782050ba24b.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=223bd9ac201a61fe6215a24aab83519b" alt="pipo-btleffect022.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/256047/79e72ab6-4908-72c7-1a95-d782050ba24b.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F256047%2F79e72ab6-4908-72c7-1a95-d782050ba24b.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=8d24e17e3e802ca5c4f4da2819399b4c 1x" loading="lazy"></a><br>
今回ゲームで使用した素材（<a href="https://pipoya.net/sozai/%E6%9C%89%E6%96%99%E7%B4%A0%E6%9D%90-%E3%82%A8%E3%83%95%E3%82%A7%E3%82%AF%E3%83%88/" rel="nofollow noopener" target="_blank">ぴぽや様</a>より拝借しました）<br>
ご覧のように一枚のテクスチャに８つの爆発画像が含まれています。InspectorでSplite ModeをMultipleに設定して8つにスプライトを分割、各SpriteからMeshを取り出して配列に入れています。<br>
このMesh配列の要素を<a href="https://docs.unity3d.com/ScriptReference/Graphics.DrawMeshInstanced.html" rel="nofollow noopener" target="_blank">Graphics.DrawMeshInstanced</a>の引数に適切に渡してあげればアニメーションができるのです。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">AnimationSkillRender.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="k">public</span> <span class="k">sealed</span> <span class="k">class</span> <span class="nc">AnimationSkillRenderSystem</span> <span class="p">:</span> <span class="n">ComponentSystem</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="n">Camera</span> <span class="n">mainCamera</span><span class="p">;</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="n">Matrix4x4</span><span class="p">[][]</span> <span class="n">matrixArray</span><span class="p">;</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="kt">int</span><span class="p">[]</span> <span class="n">countArray</span><span class="p">;</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="kt">float</span><span class="p">[]</span> <span class="n">timeArray</span><span class="p">;</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="n">Mesh</span><span class="p">[][]</span> <span class="n">meshArray</span><span class="p">;</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="n">Material</span><span class="p">[]</span> <span class="n">materialArray</span><span class="p">;</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="n">EntityArchetypeQuery</span><span class="p">[]</span> <span class="n">queryArray</span><span class="p">;</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="n">NativeList</span><span class="p">&lt;</span><span class="n">EntityArchetype</span><span class="p">&gt;[]</span> <span class="n">foundArchetypeListArray</span><span class="p">;</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="n">HashSet</span><span class="p">&lt;</span><span class="n">Entity</span><span class="p">&gt;</span> <span class="n">toDestroy</span> <span class="p">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="p">&lt;</span><span class="n">Entity</span><span class="p">&gt;();</span>
    <span class="k">private</span> <span class="n">EntityManager</span> <span class="n">manager</span><span class="p">;</span>

    <span class="k">public</span> <span class="nf">AnimationSkillRenderSystem</span><span class="p">(</span><span class="n">Camera</span> <span class="n">mainCamera</span><span class="p">,</span> <span class="p">(</span><span class="n">EntityArchetypeQuery</span> <span class="n">query</span><span class="p">,</span> <span class="n">Sprite</span><span class="p">[]</span> <span class="n">sprites</span><span class="p">,</span> <span class="n">Material</span> <span class="n">material</span><span class="p">,</span> <span class="kt">float</span> <span class="n">time</span><span class="p">)[]</span> <span class="n">array</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">array</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="nf">ArgumentOutOfRangeException</span><span class="p">();</span>
        <span class="k">this</span><span class="p">.</span><span class="n">mainCamera</span> <span class="p">=</span> <span class="n">mainCamera</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">length</span> <span class="p">=</span> <span class="n">array</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="n">timeArray</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">float</span><span class="p">[</span><span class="n">length</span><span class="p">];</span>
        <span class="k">this</span><span class="p">.</span><span class="n">meshArray</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Mesh</span><span class="p">[</span><span class="n">length</span><span class="p">][];</span>
        <span class="k">this</span><span class="p">.</span><span class="n">materialArray</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Material</span><span class="p">[</span><span class="n">length</span><span class="p">];</span>
        <span class="k">this</span><span class="p">.</span><span class="n">queryArray</span> <span class="p">=</span> <span class="k">new</span> <span class="n">EntityArchetypeQuery</span><span class="p">[</span><span class="n">length</span><span class="p">];</span>
        <span class="k">this</span><span class="p">.</span><span class="n">foundArchetypeListArray</span> <span class="p">=</span> <span class="k">new</span> <span class="n">NativeList</span><span class="p">&lt;</span><span class="n">EntityArchetype</span><span class="p">&gt;[</span><span class="n">length</span><span class="p">];</span>
        <span class="kt">int</span> <span class="n">maxSpriteVariationCount</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">array</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
        <span class="p">{</span>
            <span class="k">ref</span> <span class="kt">var</span> <span class="n">element</span> <span class="p">=</span> <span class="k">ref</span> <span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">element</span><span class="p">.</span><span class="n">time</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="nf">ArgumentException</span><span class="p">();</span>
            <span class="k">this</span><span class="p">.</span><span class="n">timeArray</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">=</span> <span class="n">element</span><span class="p">.</span><span class="n">time</span><span class="p">;</span>
            <span class="k">ref</span> <span class="kt">var</span> <span class="n">meshes</span> <span class="p">=</span> <span class="k">ref</span> <span class="n">meshArray</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
            <span class="n">meshes</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Mesh</span><span class="p">[</span><span class="n">element</span><span class="p">.</span><span class="n">sprites</span><span class="p">.</span><span class="n">Length</span><span class="p">];</span>
            <span class="n">maxSpriteVariationCount</span> <span class="p">=</span> <span class="n">Math</span><span class="p">.</span><span class="nf">Max</span><span class="p">(</span><span class="n">element</span><span class="p">.</span><span class="n">sprites</span><span class="p">.</span><span class="n">Length</span><span class="p">,</span> <span class="n">maxSpriteVariationCount</span><span class="p">);</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">j</span> <span class="p">&lt;</span> <span class="n">meshes</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">j</span><span class="p">++)</span>
                <span class="n">meshes</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="p">=</span> <span class="n">element</span><span class="p">.</span><span class="n">sprites</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="nf">FromSprite</span><span class="p">(</span><span class="m">0.02f</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="n">materialArray</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">=</span> <span class="n">element</span><span class="p">.</span><span class="n">material</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="n">queryArray</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">=</span> <span class="n">element</span><span class="p">.</span><span class="n">query</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="n">foundArchetypeListArray</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">=</span> <span class="k">new</span> <span class="n">NativeList</span><span class="p">&lt;</span><span class="n">EntityArchetype</span><span class="p">&gt;(</span><span class="n">Allocator</span><span class="p">.</span><span class="n">Persistent</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="kt">var</span> <span class="n">identity</span> <span class="p">=</span> <span class="n">Matrix4x4</span><span class="p">.</span><span class="n">identity</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="n">matrixArray</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Matrix4x4</span><span class="p">[</span><span class="n">maxSpriteVariationCount</span><span class="p">][];</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="n">matrixArray</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
        <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="n">matrixArray</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Matrix4x4</span><span class="p">[</span><span class="m">1023</span><span class="p">];</span>
            <span class="k">unsafe</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">srcPtr</span> <span class="p">=</span> <span class="p">&amp;</span><span class="n">identity</span><span class="p">;</span>
                <span class="k">fixed</span> <span class="p">(</span><span class="n">Matrix4x4</span><span class="p">*</span> <span class="n">destPtr</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">matrixArray</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="p">{</span>
                    <span class="n">UnsafeUtility</span><span class="p">.</span><span class="nf">MemCpyReplicate</span><span class="p">(</span><span class="n">destPtr</span><span class="p">,</span> <span class="n">srcPtr</span><span class="p">,</span> <span class="m">64</span><span class="p">,</span> <span class="m">1023</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">this</span><span class="p">.</span><span class="n">countArray</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">int</span><span class="p">[</span><span class="n">maxSpriteVariationCount</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">OnCreateManager</span><span class="p">(</span><span class="kt">int</span> <span class="n">capacity</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="n">manager</span> <span class="p">=</span> <span class="n">EntityManager</span><span class="p">;</span>
    <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">OnDestroyManager</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">foundArchetypeListArray</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="n">foundArchetypeListArray</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="nf">Dispose</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">OnUpdate</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">toDestroy</span><span class="p">.</span><span class="nf">Clear</span><span class="p">();</span>
        <span class="kt">var</span> <span class="n">PositionTypeRO</span> <span class="p">=</span> <span class="n">manager</span><span class="p">.</span><span class="n">GetArchetypeChunkComponentType</span><span class="p">&lt;</span><span class="n">Position</span><span class="p">&gt;(</span><span class="k">true</span><span class="p">);</span>
        <span class="kt">var</span> <span class="n">Position2DTypeRO</span> <span class="p">=</span> <span class="n">manager</span><span class="p">.</span><span class="n">GetArchetypeChunkComponentType</span><span class="p">&lt;</span><span class="n">Position2D</span><span class="p">&gt;(</span><span class="k">true</span><span class="p">);</span>
        <span class="kt">var</span> <span class="n">LifeTimeTypeRO</span> <span class="p">=</span> <span class="n">manager</span><span class="p">.</span><span class="n">GetArchetypeChunkComponentType</span><span class="p">&lt;</span><span class="n">LifeTime</span><span class="p">&gt;(</span><span class="k">true</span><span class="p">);</span>
        <span class="kt">var</span> <span class="n">EntityType</span> <span class="p">=</span> <span class="n">manager</span><span class="p">.</span><span class="nf">GetArchetypeChunkEntityType</span><span class="p">();</span>
        <span class="kt">var</span> <span class="n">currentTime</span> <span class="p">=</span> <span class="n">Time</span><span class="p">.</span><span class="n">timeSinceLevelLoad</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">queryArray</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
        <span class="p">{</span>
            <span class="n">manager</span><span class="p">.</span><span class="nf">AddMatchingArchetypes</span><span class="p">(</span><span class="n">queryArray</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">foundArchetypeListArray</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
            <span class="k">unsafe</span>
            <span class="p">{</span>
                <span class="k">fixed</span> <span class="p">(</span><span class="kt">int</span><span class="p">*</span> <span class="n">ptr</span> <span class="p">=</span> <span class="n">countArray</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">UnsafeUtility</span><span class="p">.</span><span class="nf">MemClear</span><span class="p">(</span><span class="n">ptr</span><span class="p">,</span> <span class="n">countArray</span><span class="p">.</span><span class="n">LongLength</span> <span class="p">&lt;&lt;</span> <span class="m">2</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">chunks</span> <span class="p">=</span> <span class="n">manager</span><span class="p">.</span><span class="nf">CreateArchetypeChunkArray</span><span class="p">(</span><span class="n">foundArchetypeListArray</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">Allocator</span><span class="p">.</span><span class="n">Temp</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="k">ref</span> <span class="kt">var</span> <span class="n">material</span> <span class="p">=</span> <span class="k">ref</span> <span class="n">materialArray</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
                <span class="k">ref</span> <span class="kt">var</span> <span class="n">meshes</span> <span class="p">=</span> <span class="k">ref</span> <span class="n">meshArray</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
                <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">j</span> <span class="p">&lt;</span> <span class="n">chunks</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">j</span><span class="p">++)</span>
                <span class="p">{</span>
                    <span class="kt">var</span> <span class="n">lifeTimes</span> <span class="p">=</span> <span class="n">chunks</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="nf">GetNativeArray</span><span class="p">(</span><span class="n">LifeTimeTypeRO</span><span class="p">);</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">lifeTimes</span><span class="p">.</span><span class="n">Length</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
                    <span class="kt">var</span> <span class="n">entities</span> <span class="p">=</span> <span class="n">chunks</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="nf">GetNativeArray</span><span class="p">(</span><span class="n">EntityType</span><span class="p">);</span>
                    <span class="kt">var</span> <span class="n">positions2D</span> <span class="p">=</span> <span class="n">chunks</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="nf">GetNativeArray</span><span class="p">(</span><span class="n">Position2DTypeRO</span><span class="p">);</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">positions2D</span><span class="p">.</span><span class="n">Length</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="kt">var</span> <span class="n">positions3D</span> <span class="p">=</span> <span class="n">chunks</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="nf">GetNativeArray</span><span class="p">(</span><span class="n">PositionTypeRO</span><span class="p">);</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">positions3D</span><span class="p">.</span><span class="n">Length</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
                        <span class="nf">Execute3D</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">currentTime</span><span class="p">,</span> <span class="n">entities</span><span class="p">,</span> <span class="n">lifeTimes</span><span class="p">,</span> <span class="n">positions3D</span><span class="p">);</span>
                        <span class="k">continue</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="nf">Execute2D</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">currentTime</span><span class="p">,</span> <span class="n">entities</span><span class="p">,</span> <span class="n">lifeTimes</span><span class="p">,</span> <span class="n">positions2D</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="nf">CleanUp</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">entity</span> <span class="k">in</span> <span class="n">toDestroy</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">manager</span><span class="p">.</span><span class="nf">Exists</span><span class="p">(</span><span class="n">entity</span><span class="p">))</span>
                <span class="n">manager</span><span class="p">.</span><span class="nf">DestroyEntity</span><span class="p">(</span><span class="n">entity</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">void</span> <span class="nf">CleanUp</span><span class="p">(</span><span class="kt">int</span> <span class="n">index</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">meshes</span> <span class="p">=</span> <span class="n">meshArray</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
        <span class="kt">var</span> <span class="n">material</span> <span class="p">=</span> <span class="n">materialArray</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">meshes</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">countArray</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">!=</span> <span class="m">0</span><span class="p">)</span>
                <span class="n">Graphics</span><span class="p">.</span><span class="nf">DrawMeshInstanced</span><span class="p">(</span><span class="n">meshes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="m">0</span><span class="p">,</span> <span class="n">material</span><span class="p">,</span> <span class="n">matrixArray</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">countArray</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="k">null</span><span class="p">,</span> <span class="n">ShadowCastingMode</span><span class="p">.</span><span class="n">Off</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">mainCamera</span><span class="p">,</span> <span class="n">LightProbeUsage</span><span class="p">.</span><span class="n">Off</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">void</span> <span class="nf">Execute2D</span><span class="p">(</span><span class="kt">int</span> <span class="n">index</span><span class="p">,</span> <span class="kt">float</span> <span class="n">currentTime</span><span class="p">,</span> <span class="n">NativeArray</span><span class="p">&lt;</span><span class="n">Entity</span><span class="p">&gt;</span> <span class="n">entities</span><span class="p">,</span> <span class="n">NativeArray</span><span class="p">&lt;</span><span class="n">LifeTime</span><span class="p">&gt;</span> <span class="n">lifeTimes</span><span class="p">,</span> <span class="n">NativeArray</span><span class="p">&lt;</span><span class="n">Position2D</span><span class="p">&gt;</span> <span class="n">positions</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">deathTime</span> <span class="p">=</span> <span class="n">timeArray</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
        <span class="kt">var</span> <span class="n">meshes</span> <span class="p">=</span> <span class="n">meshArray</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
        <span class="kt">var</span> <span class="n">material</span> <span class="p">=</span> <span class="n">materialArray</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">lifeTimes</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">time</span> <span class="p">=</span> <span class="p">(</span><span class="n">currentTime</span> <span class="p">-</span> <span class="n">lifeTimes</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Value</span><span class="p">)</span> <span class="p">/</span> <span class="n">deathTime</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">time</span> <span class="p">&gt;=</span> <span class="m">1</span><span class="p">)</span> <span class="c1">// currentTime &gt;= lifeTimes[i].Value + deathTime</span>
            <span class="p">{</span>
                <span class="n">toDestroy</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">entities</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
                <span class="k">continue</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="kt">var</span> <span class="n">stage</span> <span class="p">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">meshes</span><span class="p">.</span><span class="n">Length</span> <span class="p">*</span> <span class="n">time</span><span class="p">);</span>
            <span class="kt">var</span> <span class="n">mesh</span> <span class="p">=</span> <span class="n">meshes</span><span class="p">[</span><span class="n">stage</span><span class="p">];</span>
            <span class="k">ref</span> <span class="kt">var</span> <span class="n">matrixes</span> <span class="p">=</span> <span class="k">ref</span> <span class="n">matrixArray</span><span class="p">[</span><span class="n">stage</span><span class="p">];</span>
            <span class="k">ref</span> <span class="kt">var</span> <span class="n">count</span> <span class="p">=</span> <span class="k">ref</span> <span class="n">countArray</span><span class="p">[</span><span class="n">stage</span><span class="p">];</span>
            <span class="k">ref</span> <span class="kt">var</span> <span class="n">matrix</span> <span class="p">=</span> <span class="k">ref</span> <span class="n">matrixes</span><span class="p">[</span><span class="n">count</span><span class="p">++];</span>
            <span class="n">matrix</span><span class="p">.</span><span class="n">m03</span> <span class="p">=</span> <span class="n">positions</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Value</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
            <span class="n">matrix</span><span class="p">.</span><span class="n">m23</span> <span class="p">=</span> <span class="n">positions</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Value</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">count</span> <span class="p">&lt;</span> <span class="m">1023</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
            <span class="n">Graphics</span><span class="p">.</span><span class="nf">DrawMeshInstanced</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">material</span><span class="p">,</span> <span class="n">matrixes</span><span class="p">,</span> <span class="m">1023</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="n">ShadowCastingMode</span><span class="p">.</span><span class="n">Off</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">mainCamera</span><span class="p">,</span> <span class="n">LightProbeUsage</span><span class="p">.</span><span class="n">Off</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span>
            <span class="n">count</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">void</span> <span class="nf">Execute3D</span><span class="p">(</span><span class="kt">int</span> <span class="n">index</span><span class="p">,</span> <span class="kt">float</span> <span class="n">currentTime</span><span class="p">,</span> <span class="n">NativeArray</span><span class="p">&lt;</span><span class="n">Entity</span><span class="p">&gt;</span> <span class="n">entities</span><span class="p">,</span> <span class="n">NativeArray</span><span class="p">&lt;</span><span class="n">LifeTime</span><span class="p">&gt;</span> <span class="n">lifeTimes</span><span class="p">,</span> <span class="n">NativeArray</span><span class="p">&lt;</span><span class="n">Position</span><span class="p">&gt;</span> <span class="n">positions</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">deathTime</span> <span class="p">=</span> <span class="n">timeArray</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
        <span class="kt">var</span> <span class="n">meshes</span> <span class="p">=</span> <span class="n">meshArray</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
        <span class="kt">var</span> <span class="n">material</span> <span class="p">=</span> <span class="n">materialArray</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">lifeTimes</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">time</span> <span class="p">=</span> <span class="p">(</span><span class="n">currentTime</span> <span class="p">-</span> <span class="n">lifeTimes</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Value</span><span class="p">)</span> <span class="p">/</span> <span class="n">deathTime</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">time</span> <span class="p">&gt;=</span> <span class="m">1</span><span class="p">)</span> <span class="c1">// currentTime &gt;= lifeTimes[i].Value + deathTime</span>
            <span class="p">{</span>
                <span class="n">toDestroy</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">entities</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
                <span class="k">continue</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="kt">var</span> <span class="n">stage</span> <span class="p">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">meshes</span><span class="p">.</span><span class="n">Length</span> <span class="p">*</span> <span class="n">time</span><span class="p">);</span>
            <span class="kt">var</span> <span class="n">mesh</span> <span class="p">=</span> <span class="n">meshes</span><span class="p">[</span><span class="n">stage</span><span class="p">];</span>
            <span class="k">ref</span> <span class="kt">var</span> <span class="n">matrixes</span> <span class="p">=</span> <span class="k">ref</span> <span class="n">matrixArray</span><span class="p">[</span><span class="n">stage</span><span class="p">];</span>
            <span class="k">ref</span> <span class="kt">var</span> <span class="n">count</span> <span class="p">=</span> <span class="k">ref</span> <span class="n">countArray</span><span class="p">[</span><span class="n">stage</span><span class="p">];</span>
            <span class="k">ref</span> <span class="kt">var</span> <span class="n">matrix</span> <span class="p">=</span> <span class="k">ref</span> <span class="n">matrixes</span><span class="p">[</span><span class="n">count</span><span class="p">++];</span>
            <span class="n">matrix</span><span class="p">.</span><span class="n">m03</span> <span class="p">=</span> <span class="n">positions</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Value</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
            <span class="n">matrix</span><span class="p">.</span><span class="n">m23</span> <span class="p">=</span> <span class="n">positions</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Value</span><span class="p">.</span><span class="n">z</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">count</span> <span class="p">&lt;</span> <span class="m">1023</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
            <span class="n">Graphics</span><span class="p">.</span><span class="nf">DrawMeshInstanced</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">material</span><span class="p">,</span> <span class="n">matrixes</span><span class="p">,</span> <span class="m">1023</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="n">ShadowCastingMode</span><span class="p">.</span><span class="n">Off</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">mainCamera</span><span class="p">,</span> <span class="n">LightProbeUsage</span><span class="p">.</span><span class="n">Off</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span>
            <span class="n">count</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>ECS 0.0.12-preview.11からの新機能としてChunk Iterationがあります。<br>
使用法はComponentGroupに比べたらやや複雑ですが十分簡単です。<br>
EntityArchetypeQuery型とNativeList&lt;EntityArchetype&gt;型のフィールドを用意します。<br>
毎フレームOnUpdate内部でEntityManager.AddMatchingArchetype(EntityArchetype, NativeList&lt;EntityArchetype&gt;)を呼び出してNativeList&lt;EntityArchetype&gt;を最新の情報にアップデートしてあげます。<br>
その後EntityManager.CreateArchetypeChunkArray(NativeList&lt;EntityArchetype&gt;, Allocator)を呼び出してNativeArray&lt;ArchetypeChunk&gt;を得ましょう。<br>
今回のプロジェクトは対象プラットフォームがWebGLで完全にシングルスレッドで実行されるのでAllocatorにAllocator.Tempを使用していますが、本来ECSはマルチスレッドで実行されますのでAllocator.Tempだとエラー吐かれますので、Allocator.TempJob以上にしましょう。</p>

<p>実際にEntityを処理する際はNativeArray&lt;ArchetypeChunk&gt;をfor文ぐるぐる回して処理します。<br>
各ArchetypeChunkからEntityやComponentDataを得るにはArchetypeChunk.GetNativeArray(ArchetypeChunkEntityType), ArchetypeChunk.GetNativeArray&lt;T&gt;(ArchetypeChunkComponentType&lt;T&gt;を使用します。<br>
引数に与えるArchetypeChunkComponentType&lt;T&gt;は毎フレームEntityManager.GetArchetypeChunkComponentType&lt;Position&gt;(bool isReadOnly)で生成します。<br>
気を付けて欲しいのですが、GetNativeArrayの戻り値であるNativeArrayをDisposeしてはいけません。これは実質Span&lt;T&gt;みたいなものですので、所有権をプログラマーは有していません。ECSが生成し、破棄まで管理しています。</p>

<p>さて、Chunk Iterationによりチャンク毎に効率的に処することができるようになりましたね。<br>
今回このシステムは「EntityArchetypeQuery毎にアニメーションするスプライトが全く異なる」という前提のもとに動いています。<br>
つまり、EntityArchetypeQuery, Mesh[], Materialがタプルとなっているわけです。そのためコンストラクタにはValueTuple&lt;EntityArchetypeQuery, Sprite[], Material, float&gt;を与えています。</p>

<p>工夫した点は1023要素のMatrix4x4[]をMax(アニメーションのコマ数)個最初に用意し、以後配列をnewしないようにしてアロケーションを最低限にしたことですね。また、TransformSystemを介在させず直接Matrix4x4[]に書き込むことで無駄なコピーコストをなくしています。</p>

<h1>
<span id="衝突判定" class="fragment"></span><a href="#%E8%A1%9D%E7%AA%81%E5%88%A4%E5%AE%9A"><i class="fa fa-link"></i></a>衝突判定</h1>

<h2>
<span id="bombhitcs" class="fragment"></span><a href="#bombhitcs"><i class="fa fa-link"></i></a>BombHit.cs</h2>

<p>実行順制御については<a href="http://tsubakit1.hateblo.jp/entry/2018/09/06/200000" rel="nofollow noopener" target="_blank">テラシュールブログの記事</a>が詳しいのでそちらを参照してください。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">Bomb.cs</span></div>
<div class="highlight"><pre class="with-code"><code><span class="p">[</span><span class="nf">UpdateAfter</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">DecidePositionHashCodeSystem</span><span class="p">))]</span>
<span class="p">[</span><span class="nf">UpdateBefore</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">BombRenderSystem</span><span class="p">))]</span>
<span class="k">public</span> <span class="k">sealed</span> <span class="k">class</span> <span class="nc">BombHitCheckSystem</span> <span class="p">:</span> <span class="n">ComponentSystem</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="kt">float</span> <span class="n">rangeSquared</span><span class="p">;</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="n">NativeMultiHashMap</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="n">DecidePositionHashCodeSystem</span><span class="p">.</span><span class="n">Tuple</span><span class="p">&gt;</span> <span class="n">enemyHashCodes</span><span class="p">;</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="n">Entity</span> <span class="n">player</span><span class="p">;</span>
    <span class="k">private</span> <span class="n">ComponentGroup</span> <span class="n">g</span><span class="p">;</span>
    <span class="k">private</span> <span class="n">EntityArchetype</span> <span class="n">deadMan</span><span class="p">;</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">)[]</span> <span class="n">diff</span><span class="p">;</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="n">HashSet</span><span class="p">&lt;</span><span class="n">Entity</span><span class="p">&gt;</span> <span class="n">toDestroy</span> <span class="p">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="p">&lt;</span><span class="n">Entity</span><span class="p">&gt;();</span>

    <span class="k">public</span> <span class="nf">BombHitCheckSystem</span><span class="p">(</span><span class="n">Entity</span> <span class="n">player</span><span class="p">,</span> <span class="kt">float</span> <span class="n">radius</span><span class="p">,</span> <span class="n">NativeMultiHashMap</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="n">DecidePositionHashCodeSystem</span><span class="p">.</span><span class="n">Tuple</span><span class="p">&gt;</span> <span class="n">enemyHashCodes</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="n">player</span> <span class="p">=</span> <span class="n">player</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="n">rangeSquared</span> <span class="p">=</span> <span class="n">radius</span> <span class="p">*</span> <span class="n">radius</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="n">enemyHashCodes</span> <span class="p">=</span> <span class="n">enemyHashCodes</span><span class="p">;</span>
        <span class="kt">var</span> <span class="n">ls</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">)&gt;((</span><span class="kt">int</span><span class="p">)</span><span class="n">rangeSquared</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">,</span> <span class="n">r</span> <span class="p">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">radius</span><span class="p">,</span> <span class="n">r2</span> <span class="p">=</span> <span class="n">r</span> <span class="p">*</span> <span class="n">r</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;=</span> <span class="n">r</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
        <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="p">=</span> <span class="m">0</span><span class="p">,</span> <span class="n">end</span> <span class="p">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">Math</span><span class="p">.</span><span class="nf">Sqrt</span><span class="p">(</span><span class="n">r2</span> <span class="p">-</span> <span class="n">i</span> <span class="p">*</span> <span class="n">i</span><span class="p">);</span> <span class="n">j</span> <span class="p">&lt;=</span> <span class="n">end</span><span class="p">;</span> <span class="n">j</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="n">ls</span><span class="p">.</span><span class="nf">Add</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">));</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="p">!=</span> <span class="m">0</span><span class="p">)</span>
                    <span class="n">ls</span><span class="p">.</span><span class="nf">Add</span><span class="p">((-</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">));</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">j</span> <span class="p">!=</span> <span class="m">0</span><span class="p">)</span>
                    <span class="n">ls</span><span class="p">.</span><span class="nf">Add</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="p">-</span><span class="n">j</span><span class="p">));</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="p">!=</span> <span class="m">0</span> <span class="p">&amp;&amp;</span> <span class="n">j</span> <span class="p">!=</span> <span class="m">0</span><span class="p">)</span>
                    <span class="n">ls</span><span class="p">.</span><span class="nf">Add</span><span class="p">((-</span><span class="n">i</span><span class="p">,</span> <span class="p">-</span><span class="n">j</span><span class="p">));</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">this</span><span class="p">.</span><span class="n">diff</span> <span class="p">=</span> <span class="n">ls</span><span class="p">.</span><span class="nf">ToArray</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">OnCreateManager</span><span class="p">(</span><span class="kt">int</span> <span class="n">capacity</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">g</span> <span class="p">=</span> <span class="nf">GetComponentGroup</span><span class="p">(</span><span class="n">ComponentType</span><span class="p">.</span><span class="n">ReadOnly</span><span class="p">&lt;</span><span class="n">Position2D</span><span class="p">&gt;(),</span> <span class="n">ComponentType</span><span class="p">.</span><span class="n">ReadOnly</span><span class="p">&lt;</span><span class="n">BombEffect</span><span class="p">&gt;());</span>
        <span class="n">deadMan</span> <span class="p">=</span> <span class="n">EntityManager</span><span class="p">.</span><span class="nf">CreateArchetype</span><span class="p">(</span><span class="n">ComponentType</span><span class="p">.</span><span class="n">Create</span><span class="p">&lt;</span><span class="n">DeadMan</span><span class="p">&gt;());</span>
    <span class="p">}</span>

    <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">OnUpdate</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">positions</span> <span class="p">=</span> <span class="n">g</span><span class="p">.</span><span class="n">GetComponentDataArray</span><span class="p">&lt;</span><span class="n">Position2D</span><span class="p">&gt;();</span>
        <span class="kt">var</span> <span class="n">manager</span> <span class="p">=</span> <span class="n">EntityManager</span><span class="p">;</span>
        <span class="kt">var</span> <span class="n">buf</span> <span class="p">=</span> <span class="n">PostUpdateCommands</span><span class="p">;</span>
        <span class="kt">var</span> <span class="n">playerPos</span> <span class="p">=</span> <span class="n">manager</span><span class="p">.</span><span class="n">GetComponentData</span><span class="p">&lt;</span><span class="n">Position</span><span class="p">&gt;(</span><span class="n">player</span><span class="p">).</span><span class="n">Value</span><span class="p">;</span>
        <span class="kt">var</span> <span class="n">deltaTime</span> <span class="p">=</span> <span class="n">Time</span><span class="p">.</span><span class="n">deltaTime</span><span class="p">;</span>
        <span class="n">toDestroy</span><span class="p">.</span><span class="nf">Clear</span><span class="p">();</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">consumed</span> <span class="p">=</span> <span class="m">0</span><span class="p">,</span> <span class="n">length</span> <span class="p">=</span> <span class="n">positions</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">consumed</span> <span class="p">&lt;</span> <span class="n">length</span><span class="p">;)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">posChunk</span> <span class="p">=</span> <span class="n">positions</span><span class="p">.</span><span class="nf">GetChunkArray</span><span class="p">(</span><span class="n">consumed</span><span class="p">,</span> <span class="n">length</span> <span class="p">-</span> <span class="n">consumed</span><span class="p">);</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">posChunk</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">x</span> <span class="p">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">posChunk</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Value</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
                <span class="kt">var</span> <span class="n">y</span> <span class="p">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">posChunk</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Value</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
                <span class="kt">float</span> <span class="n">plDistanceSquared</span><span class="p">;</span>
                <span class="p">{</span>
                    <span class="kt">var</span> <span class="n">diffX</span> <span class="p">=</span> <span class="n">playerPos</span><span class="p">.</span><span class="n">x</span> <span class="p">-</span> <span class="n">posChunk</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Value</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
                    <span class="kt">var</span> <span class="n">diffY</span> <span class="p">=</span> <span class="n">playerPos</span><span class="p">.</span><span class="n">z</span> <span class="p">-</span> <span class="n">posChunk</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Value</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
                    <span class="n">plDistanceSquared</span> <span class="p">=</span> <span class="n">diffX</span> <span class="p">*</span> <span class="n">diffX</span> <span class="p">+</span> <span class="n">diffY</span> <span class="p">*</span> <span class="n">diffY</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">plDistanceSquared</span> <span class="p">&lt;=</span> <span class="n">rangeSquared</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="kt">var</span> <span class="n">setting</span> <span class="p">=</span> <span class="n">manager</span><span class="p">.</span><span class="n">GetComponentData</span><span class="p">&lt;</span><span class="n">PlayerSettings</span><span class="p">&gt;(</span><span class="n">player</span><span class="p">);</span>
                    <span class="n">setting</span><span class="p">.</span><span class="n">Temperature</span> <span class="p">+=</span> <span class="m">300f</span> <span class="p">/</span> <span class="n">plDistanceSquared</span> <span class="p">*</span> <span class="n">deltaTime</span><span class="p">;</span>
                    <span class="n">manager</span><span class="p">.</span><span class="nf">SetComponentData</span><span class="p">(</span><span class="n">player</span><span class="p">,</span> <span class="n">setting</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">j</span> <span class="p">&lt;</span> <span class="n">diff</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">j</span><span class="p">++)</span>
                <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(!</span><span class="n">enemyHashCodes</span><span class="p">.</span><span class="nf">TryGetFirstValue</span><span class="p">(((</span><span class="n">diff</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">Item1</span> <span class="p">+</span> <span class="n">x</span><span class="p">)</span> <span class="p">&lt;&lt;</span> <span class="m">16</span><span class="p">)</span> <span class="p">|</span> <span class="p">(</span><span class="n">diff</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">Item2</span> <span class="p">+</span> <span class="n">y</span><span class="p">),</span> <span class="k">out</span> <span class="kt">var</span> <span class="n">item</span><span class="p">,</span> <span class="k">out</span> <span class="kt">var</span> <span class="n">it</span><span class="p">))</span>
                        <span class="k">continue</span><span class="p">;</span>
                    <span class="n">toDestroy</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="n">Entity</span><span class="p">);</span>
                    <span class="k">while</span> <span class="p">(</span><span class="n">enemyHashCodes</span><span class="p">.</span><span class="nf">TryGetNextValue</span><span class="p">(</span><span class="k">out</span> <span class="n">item</span><span class="p">,</span> <span class="k">ref</span> <span class="n">it</span><span class="p">))</span>
                        <span class="n">toDestroy</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="n">Entity</span><span class="p">);</span>
                    <span class="n">manager</span><span class="p">.</span><span class="nf">CreateEntity</span><span class="p">(</span><span class="n">deadMan</span><span class="p">);</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">item</span> <span class="k">in</span> <span class="n">toDestroy</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">manager</span><span class="p">.</span><span class="nf">Exists</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
                    <span class="n">manager</span><span class="p">.</span><span class="nf">DestroyEntity</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
            <span class="n">consumed</span> <span class="p">+=</span> <span class="n">posChunk</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>

<p>BombEffectは爆発を意味するComponentTypeです。<br>
爆発の所属するマス目とその上下左右についてハッシュ値を計算し、NativeMultiHashMapから所属するEntityとその座標を得て衝突判定を行っています。<br>
衝突する場合は破棄予定EntityとしてHashSet&lt;Entity&gt;にAddし、OnUpdateの最後の方にまとめてEntityManager.Existsで生存を確認しつつEntityManager.DestroyEntityしています。</p>

<p>Unity.Mathematics.mathという数学クラスがあるのにどうしてベタベタと汚くコードを書いているのか疑問に思うでしょう。<br>
それはUnity.Mathematics.mathのメソッドの大半がSystem.Mathのラッパーメソッドであるからです。しかもfloat&lt;=&gt;doubleの変換を一々伴うので効率が悪いです。<br>
SIMD演算化されて高速に動作するという触れ込みですが、それはBurstでコンパイルされた時に限定されるため、Job Systemを使えないWebGLでは一切使わないのが一番です。</p>

<h1>
<span id="参考文献" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE"><i class="fa fa-link"></i></a>参考文献</h1>

<ul>
<li>
<a href="https://qiita.com/mao_/items/6ad28fc20dda77364e39" id="reference-ecaa203acd1a18c60c66">【Unity】ECSで弾幕STGを作ってみたので技術周りについて解説</a>

<ul>
<li>更に古いバージョンを対象としていますが、ECSで作られたまともに実際遊べるゲームの解説記事です。</li>
</ul>
</li>
<li>
<a href="https://qiita.com/pCYSl5EDgo/items/caac60ee41058cde085a">【Unity】Entity Component System入門(その1)【2018.2】</a>

<ul>
<li>ゲームジャムに参加している間にバージョンが上がってしまったのでそのうち書き直します。</li>
<li>この記事の読み飛ばしてもよい解説を全て理解できたら「ECSなんもわからん」と胸を張って言えます。</li>
</ul>
</li>
<li>
<a href="https://qiita.com/mao_/items/c4a217b33a0a94d5d52f">【Unity】PureECSの描画周りについて解説してみる</a>

<ul>
<li><del>小ネタとは一体？</del></li>
<li>描画周りはこれ読めば基本を全部抑えられます。本当です。付け足すことないです。</li>
</ul>
</li>
<li>
<a href="https://www.slideshare.net/UnityTechnologiesJapan/unite-2018-tokyo" rel="nofollow noopener" target="_blank">【Unite Tokyo 2018】誘導ミサイル完全マスター</a>

<ul>
<li>WebGLではComputeShader一切使えませんが、かなり参考になります。</li>
</ul>
</li>
<li>
<a href="http://tsubakit1.hateblo.jp/entry/2018/09/23/041552" rel="nofollow noopener" target="_blank">【Unity】ECSで複数のWorldを運用する方法</a>

<ul>
<li>デフォルトワールドを殺した場合についてわかりやすい解説があります。</li>
</ul>
</li>
</ul>

<h1>
<span id="感想" class="fragment"></span><a href="#%E6%84%9F%E6%83%B3"><i class="fa fa-link"></i></a>感想</h1>

<p>弾幕とECSの相性は最高です。自然と大物量を扱うことになりますからね。<br>
WebGLがシングルスレッド強制してくるのとComputeShader使用不可の縛りがもの凄くキツかったですが、unityroomにおける最大物量ゲームの記録を更新できたのではないかと思います。</p>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2FpCYSl5EDgo%2Fitems%2F5ff6fa92386bc046d949&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2FpCYSl5EDgo%2Fitems%2F5ff6fa92386bc046d949&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/pCYSl5EDgo/items/5ff6fa92386bc046d949/likers" class="css-1iupg5d">19</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">15</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/5ff6fa92386bc046d949/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/pCYSl5EDgo/items/5ff6fa92386bc046d949/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/pCYSl5EDgo/items/5ff6fa92386bc046d949/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/pCYSl5EDgo/items/5ff6fa92386bc046d949/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/pCYSl5EDgo/items/5ff6fa92386bc046d949.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-02b3cf90-7991-402c-b3f6-f30e135c459a">{"authorAnalyticsTrackingId":null,"organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-552cef35-6e24-4107-bf44-00137e614dd3"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-552cef35-6e24-4107-bf44-00137e614dd3">{}</script>
      
<div id="LoginModal-react-component-495c9814-e937-408c-a0e4-85e8ec5487dd"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-495c9814-e937-408c-a0e4-85e8ec5487dd">{}</script>
      
<div id="StockModal-react-component-08cee097-6e0b-42e5-b23f-6d64ae3ee457"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-08cee097-6e0b-42e5-b23f-6d64ae3ee457">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;8WsniN26KGFTdkRKcgTsGBNhFLxuYO7KKSZzP1hNOBlO+9T6IOQFJT5fqrJI1LQJMu4qNogm30bTOLS6NqgDtQ==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\u003cp\u003eこの記事がEntity Component System入門者の助けとなることを願って初透光です。\u003c/p\u003e\n\n\u003cp\u003eECSについて初歩的な知識を有していることが前提です。\u003cbr\u003e\nわからないことがあれば\u003ca href=\"https://qiita.com/pCYSl5EDgo/items/caac60ee41058cde085a\" id=\"reference-7989d52d98cdc725d0ec\"\u003e入門記事\u003c/a\u003eを参照してください。\u003cbr\u003e\nC#7.2でソースコードを書いていますので、文法的な不明点がある場合は\u003ca href=\"https://ufcpp.net/study/csharp/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eufcpp\u003c/a\u003eを参照してください。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"執筆経緯\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%9F%B7%E7%AD%86%E7%B5%8C%E7%B7%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e執筆経緯\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"https://unityroom.com/unity1weeks\" rel=\"nofollow noopener\" target=\"_blank\"\u003eUnity1週間ゲームジャム\u003c/a\u003eに初参加してきました。\u003cbr\u003e\nこれは月曜0時にお題が発表され、それに沿ったゲームを日曜20時までに投稿するという催しです。\u003cbr\u003e\n今回のお題は「あつい」でした。既に締切を過ぎて様々なゲームが発表されていますが、なかなか参加者の発想の幅が広くて楽しいゲームジャムでした。\u003cbr\u003e\nきゅうりをできる限り薄切りしていくゲームや、村をうっかり（確信犯）焼き尽くすゲームなど色々ありますので是非遊んでみてください。\u003c/p\u003e\n\n\u003cp\u003e\u003cdel\u003eあまり記事にするのが遅れるのもアレなので省ける解説は大分省いての投稿となりました。\u003c/del\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/70f3abd5edc2679a29bb81f41123ea9922b15800/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3235363034372f31663531633330642d323234662d333434622d653261392d6262363438366239356264342e676966\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/256047/1f51c30d-224f-344b-e2a9-bb6486b95bd4.gif\" alt=\"Unity 2018.2.8f1 Personal (64bit) - [PREVIEW PACKAGES IN USE] - Title.unity - Unity1Week2 - WebGL _DX11 on DX9 GPU_ 2018_09_18 8_56_02-セグメント 1.gif\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/256047/1f51c30d-224f-344b-e2a9-bb6486b95bd4.gif\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eさて、私自身は \u003cdel\u003e相変わらずヴァーレントゥーガ互換リアルタイムストラテジーを作る練習として\u003c/del\u003e \u003ca href=\"https://unityroom.com/games/p1145141919\" rel=\"nofollow noopener\" target=\"_blank\"\u003e大量の敵に追いかけられながら敵を焼き殺すというゲーム\u003c/a\u003eを作りました。\u003cbr\u003e\n１週間でどのぐらい自分が作れるのか自分でも全く把握していなかったので当初の予定より大幅に機能を削ぎ落としましたが、なんとか遊べる程度に完成できて良かったです。\u003c/p\u003e\n\n\u003cp\u003eEntity Component System（以下ECS）がWebGLに対応していないので\u003ca href=\"https://qiita.com/pCYSl5EDgo/items/675290daee9a35b8f6d3\" id=\"reference-badbb770fd03ceabc446\"\u003eパッケージに手を加えて動かせるように自力でなんとかしました。\u003c/a\u003e\u003cbr\u003e\nいやぁ…… 一週間ゲームShamu開始前に動かないことに気付けてよかったです。丸1日がこの対応作業で潰れましたからね。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"リポジトリ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%AA%E3%83%9D%E3%82%B8%E3%83%88%E3%83%AA\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eリポジトリ\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"https://github.com/pCYSl5EDgo/Unity1Week_P1145141919\" rel=\"nofollow noopener\" target=\"_blank\"\u003e今回のゲームのリポジトリ\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://unityroom.com/games/p1145141919\" rel=\"nofollow noopener\" target=\"_blank\"\u003e今回のゲーム「晩夏の昼の挽歌」へのリンク\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eリポジトリをcloneしたらそのまま遊べます。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"前提環境\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%89%8D%E6%8F%90%E7%92%B0%E5%A2%83\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e前提環境\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003eWebGL版\n\n\u003cul\u003e\n\u003cli\u003eUnity 2018.2.8f1\u003c/li\u003e\n\u003cli\u003eECS 0.0.12-preview.11 on WebGL\u003c/li\u003e\n\u003cli\u003eJob System不使用\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"設計\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A8%AD%E8%A8%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e設計\u003c/h1\u003e\n\n\u003cp\u003eECSはUIやシーン管理、Audio周りに対して現在のところ残念ながら向いていません。その部分は伝統的なMonoBehaviour/Componentで実装しています。\u003cbr\u003e\nインゲームのコアなロジックに対してECSを使用しています。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"シーン概説\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B7%E3%83%BC%E3%83%B3%E6%A6%82%E8%AA%AC\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eシーン概説\u003c/h2\u003e\n\n\u003cp\u003eシーン数は総計７つ\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eTitle\n\n\u003cul\u003e\n\u003cli\u003e難易度や音量を設定するUIシーンを呼び出すボタンとゲーム開始ボタンがあるだけのシンプルなシーンです。当記事では非解説。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eMusicSetting\n\n\u003cul\u003e\n\u003cli\u003e音量調節の方法を調べる時間がなかったのでBGM,SEのオンオフ切り替えのみできます。当記事では非解説。\u003c/li\u003e\n\u003cli\u003eUnity1週間ゲームジャムが終了してからUnity2018.3.0b1が来てNested Prefab使用できるようになったので、もうマルチシーンエディティング君は終わりですね……\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eDifficultySetting\n\n\u003cul\u003e\n\u003cli\u003eメインのゲームで登場する敵キャラの数を調整したり、戦場の広さを調節することができます。当記事では非解説。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eSCWR\n\n\u003cul\u003e\n\u003cli\u003e~なぜSCWRという命名をしたのか正直覚えていません~\u003c/li\u003e\n\u003cli\u003eECSが動作するガッツリインゲームな部分です。 #当記事で解説します#。\u003c/li\u003e\n\u003cli\u003euGUIのキャンバス及びUI要素とカメラ2つ以外のGameObjectが存在しません。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eRanking\n\n\u003cul\u003e\n\u003cli\u003eGameClear, GameOverからのみ呼び出されて追加されるシーン。当記事では非解説。\u003c/li\u003e\n\u003cli\u003e詳しくは\u003ca href=\"https://blog.naichilab.com/entry/webgl-simple-ranking\" rel=\"nofollow noopener\" target=\"_blank\"\u003e【Unity、WebGL】なるべく簡単にオンラインランキング機能をつけるサンプル\u003c/a\u003eを参照してください。\u003c/li\u003e\n\u003cli\u003eクリアする楽しみの他にハイスコアを狙うやりこみ要素もあるゲームですからランキング機能を付けました。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eGameOver\n　 - SCWRに追加されます。ここでキルスコアと難易度設定から総合的なランクとスコアを計算し、表示しています。当記事では非解説\n　 - 今から作り始めるならNested Prefabにし(ry\u003c/li\u003e\n\u003cli\u003eGameClear\n　 - 上にほぼ同じです。当記事では非解説。\n　 - 今ならNested(ry\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/9adb9b359f27bbf971d193a78c1747c3d5f01906/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3235363034372f64336164616366302d373339662d343036652d626331622d3035633832616535393536612e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F256047%2Fd3adacf0-739f-406e-bc1b-05c82ae5956a.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=af39b58c436ffe8467b3cbbe7fa236e2\" alt=\"Untitled Diagram.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/256047/d3adacf0-739f-406e-bc1b-05c82ae5956a.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F256047%2Fd3adacf0-739f-406e-bc1b-05c82ae5956a.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=3672a95f78b0c7480fce318cfc93b1ee 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n矢印はシーン遷移を表します。太い矢印はSingleシーン遷移、細い矢印はAdditiveなシーン追加を意味します。\u003c/p\u003e\n\n\u003cp\u003eシーン間での情報の共有はScriptableObjectを使用しています。\u003cbr\u003e\n具体的な方法は\u003ca href=\"http://tsubakit1.hateblo.jp/entry/2017/06/19/233000\" rel=\"nofollow noopener\" target=\"_blank\"\u003e安定のテラシュールブログ記事\u003c/a\u003eを参照してください。\u003cbr\u003e\nエディターでプレイするとScriptableObjectが勝手に書き換わる問題は気合でなんとかしました。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"中核シーン概説\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%B8%AD%E6%A0%B8%E3%82%B7%E3%83%BC%E3%83%B3%E6%A6%82%E8%AA%AC\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e中核シーン概説\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003eMain Camera\n\n\u003cul\u003e\n\u003cli\u003eAudioListnerとAudioSource6つがついています。その中5つがSE用であり、1つがBGM用です。\u003c/li\u003e\n\u003cli\u003eEvent Systemコンポーネントも付属しています。\u003c/li\u003e\n\u003cli\u003eこのゲームのGO is GODクラスであるMangerクラスがAdd Componentされています。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eRoot Canvas\n\n\u003cul\u003e\n\u003cli\u003e体力ゲージ、機体温度表示UI、キルスコア表示UIを全て含有しています。\u003c/li\u003e\n\u003cli\u003eUI関連は他のゲームと変わらないであろうので非解説。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eUI Camera\n\n\u003cul\u003e\n\u003cli\u003eRoot Canvasに表示しているUIが大きすぎてプレイ上微妙に邪魔になったりするので、バックスペースキーで非表示にできるように、UIだけを写すカメラを用意しました。\u003c/li\u003e\n\u003cli\u003eこのGameObjectをinactivateすれば非表示できます。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"神managerクラス概説あるいはポエム\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%A5%9Emanager%E3%82%AF%E3%83%A9%E3%82%B9%E6%A6%82%E8%AA%AC%E3%81%82%E3%82%8B%E3%81%84%E3%81%AF%E3%83%9D%E3%82%A8%E3%83%A0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e神Managerクラス概説（あるいはポエム）\u003c/h3\u003e\n\n\u003cp\u003eManagerクラスはその名の短さが示すように最も中核で全ての依存を管理し、全てのパラメータを受付け、全てのゲーム進行を掌握していた。\u003cbr\u003e\n人は余りの神威故partialクラスとしてManagerを９つに裂き、その力を減じさせんとした。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eManager.cs\n\n\u003cul\u003e\n\u003cli\u003e[SerializeField]が29個もあるので紛うことなき神\u003c/li\u003e\n\u003cli\u003eStartマジックメソッドから各種設定をセットアップするのがお仕事。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eInitializeWorld.cs\n\n\u003cul\u003e\n\u003cli\u003eManager.csに定義されたSerializeFieldを適切にComponentSystemのコンストラクタに渡すだけの簡単なお仕事。\u003c/li\u003e\n\u003cli\u003e神は言った。「UNITY_DISABLE_AUTOMATIC_SYSTEM_BOOTSTRAPしない市民は歴史上に存在することを許されていません。」\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eUpdate.cs\n\n\u003cul\u003e\n\u003cli\u003eUI全体をUniRxを使用して管理する。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eAudioManger.cs\n\n\u003cul\u003e\n\u003cli\u003eSE管理（管理できていると言ってない）を行う。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eInitializePlayer.cs\n\n\u003cul\u003e\n\u003cli\u003eプレイヤーを表すEntityはシーン内に常に1つのみ存在し、CreateEntityされた後絶対にDestroyEntityされることはない。（これを保証するものはプログラマーの良心のみである。）\u003c/li\u003e\n\u003cli\u003eクリティカルな部分であるので神はECSに任せず手ずからプレイヤーの生成を行われたのである。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eStage.cs\n\n\u003cul\u003e\n\u003cli\u003eこのゲームは敵を殺した数によって難易度が上昇する。\u003c/li\u003e\n\u003cli\u003eUniRxを使用してキルスコアに応じて難易度管理をするクラス。\u003c/li\u003e\n\u003cli\u003e具体的にはECSのコンポーネントシステムのEnabledをtrueにしたりfalseにしたりと切り替えることで難易度管理をしている。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eGameStage.cs\n\n\u003cul\u003e\n\u003cli\u003eネーミングがStage.csと被っていて分かり辛い（確信）\u003c/li\u003e\n\u003cli\u003eプレイヤーの体力とキルスコアをUniRxを使用して監視し、プレイヤーが死んだりクリアしたりしたら全てのコンポーネントシステムの動作を停止させる。\u003c/li\u003e\n\u003cli\u003eその後GameOverあるいはGameClearシーンをAdditiveにLoadSceneAsyncする。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eUniRx.cs\n\n\u003cul\u003e\n\u003cli\u003eUniRxを活用して入力に対するFacadeクラスとせんとしたが、力及ばずごく一部の武器切り替え機能しか持たない無力なpartialクラス。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eLastBoss.cs\n\n\u003cul\u003e\n\u003cli\u003e死産\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"managercsの基礎構造\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#managercs%E3%81%AE%E5%9F%BA%E7%A4%8E%E6%A7%8B%E9%80%A0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eManager.csの基礎構造\u003c/h1\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eManager.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eRequireComponent\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eCamera\u003c/span\u003e\u003cspan class=\"p\"\u003e))]\u003c/span\u003e\n\u003cspan class=\"k\"\u003esealed\u003c/span\u003e \u003cspan class=\"k\"\u003epartial\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eManager\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eMonoBehaviour\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eSerializeField\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003eScriptableObjects\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMap\u003c/span\u003e \u003cspan class=\"n\"\u003emapTable\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eSerializeField\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003eMaterial\u003c/span\u003e \u003cspan class=\"n\"\u003eunlit\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eSerializeField\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003eScriptableObjects\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEnemyDisplay\u003c/span\u003e \u003cspan class=\"n\"\u003eenemyDisplay\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eSerializeField\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003eScriptableObjects\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSpeed\u003c/span\u003e \u003cspan class=\"n\"\u003eplayerSpeeds\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eSerializeField\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003eScriptableObjects\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSpeed\u003c/span\u003e \u003cspan class=\"n\"\u003eenemySpeeds\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eSerializeField\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003eAudioSource\u003c/span\u003e \u003cspan class=\"n\"\u003eBgmSource\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eSerializeField\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003eAudioClip\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003eBgmClips\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eSerializeField\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"n\"\u003eheatDamageRatio\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eSerializeField\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"n\"\u003ecoolRatio\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eSerializeField\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"n\"\u003erainCoolPower\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eSerializeField\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"n\"\u003erainCoolTimeSpan\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eSerializeField\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"n\"\u003erainCoolFrequency\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eSerializeField\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003eScriptableObjects\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSkillSetting\u003c/span\u003e \u003cspan class=\"n\"\u003esnowSkillSetting\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eSerializeField\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003eAudioClip\u003c/span\u003e \u003cspan class=\"n\"\u003etakenokoBulletShoot\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eSerializeField\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003eAudioClip\u003c/span\u003e \u003cspan class=\"n\"\u003etakenokoBulletBurst\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eSerializeField\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003eAudioClip\u003c/span\u003e \u003cspan class=\"n\"\u003esnowBurst\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eSerializeField\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003eAudioSource\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003esources\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eSerializeField\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003eSprite\u003c/span\u003e \u003cspan class=\"n\"\u003eplayerSprite\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eSerializeField\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003eMaterial\u003c/span\u003e \u003cspan class=\"n\"\u003eplayerMaterial\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eSerializeField\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003eSprite\u003c/span\u003e \u003cspan class=\"n\"\u003ekinokoHammer\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eSerializeField\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003eMaterial\u003c/span\u003e \u003cspan class=\"n\"\u003ekinokoMaterial\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eSerializeField\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003eGameObject\u003c/span\u003e \u003cspan class=\"err\"\u003e武器欄\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eSerializeField\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003eScriptableObjects\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSpeed\u003c/span\u003e \u003cspan class=\"n\"\u003estage4EnemySpeed\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eSerializeField\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003eGameObject\u003c/span\u003e \u003cspan class=\"n\"\u003erespawnDisplay\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eSerializeField\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003eAudioSource\u003c/span\u003e \u003cspan class=\"n\"\u003eBGMSource\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eSerializeField\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003eScriptableObjects\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTitleSettings\u003c/span\u003e \u003cspan class=\"n\"\u003etitleSettings\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eSerializeField\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003eScriptableObjects\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eResult\u003c/span\u003e \u003cspan class=\"n\"\u003eresultSettings\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eSerializeField\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003eScriptableObjects\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSkillSetting\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003eplayerSkills\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eSerializeField\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003eScriptableObjects\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSkillSetting\u003c/span\u003e \u003cspan class=\"n\"\u003ebombSkillEffect\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eEntityManager\u003c/span\u003e \u003cspan class=\"n\"\u003emanager\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eCamera\u003c/span\u003e \u003cspan class=\"n\"\u003eUICamera\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eEnemyPlayerCollisionSystem\u003c/span\u003e \u003cspan class=\"n\"\u003eEnemyPlayerCollisionSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eRainSystem\u003c/span\u003e \u003cspan class=\"n\"\u003eRainSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003ePlayerShootSystem\u003c/span\u003e \u003cspan class=\"n\"\u003ePlayerShootSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eStart\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003emainCamera\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eGetComponent\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eCamera\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eUICamera\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eGameObject\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFind\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"UI Camera\"\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003eGetComponent\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eCamera\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n        \u003cspan class=\"n\"\u003esourceInfos\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003efloat\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eAudioClip\u003c/span\u003e\u003cspan class=\"p\"\u003e)[\u003c/span\u003e\u003cspan class=\"n\"\u003esources\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eposition\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etransform\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eposition\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eposition\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etitleSettings\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWidth\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"m\"\u003e0.5f\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eposition\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ez\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etitleSettings\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eHeight\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"m\"\u003e0.5f\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etransform\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eposition\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eposition\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"err\"\u003e#\u003c/span\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003eUNITY_EDITOR\u003c/span\u003e\n           \u003cspan class=\"nf\"\u003eValidate\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"err\"\u003e#\u003c/span\u003e\u003cspan class=\"n\"\u003eendif\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eInitializeAudio\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eInitializeWorld\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eInitializeUGUI\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eInitializeBGM\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eInitializeUniRx\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eInitializeStageWatch\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eInitializeGameOverUI\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eScriptableObjects名前空間は肥大化するSerializeFieldに抗うためにScriptableObjectを定義している空間です。\u003cbr\u003e\nScriptableObjects.TitleSettings titleSettingsとScriptableObjects.Result resultSettingsの2つがシーン間で共有するScriptableObjectsです。\u003cbr\u003e\n他のScriptableObjectsはreadonlyとして扱うようプログラマーの良心に期待しています。\u003cbr\u003e\ntitleSettingsに関してはManagerクラスの所属するSCWRシーン内でreadonlyとして扱うようプログラマーの(ry\u003cbr\u003e\nresultSettingsはSCWRシーン内からのみ書き込み可能であるという設定で良心あるプログラマーに扱(ry\u003c/p\u003e\n\n\u003cp\u003eここら辺を厳密に良心や規約によらずコンパイラーに制限してもらう方法に心当たりはありますが、一週間ゲームジャムでやるには個人開発なので必要性が薄い＆時間が足りないのでやっていません。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"シーン毎にアクセシビリティを変更する方法読み飛ばし可\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B7%E3%83%BC%E3%83%B3%E6%AF%8E%E3%81%AB%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B7%E3%83%93%E3%83%AA%E3%83%86%E3%82%A3%E3%82%92%E5%A4%89%E6%9B%B4%E3%81%99%E3%82%8B%E6%96%B9%E6%B3%95%E8%AA%AD%E3%81%BF%E9%A3%9B%E3%81%B0%E3%81%97%E5%8F%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eシーン毎にアクセシビリティを変更する方法（読み飛ばし可）\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003eScriptsフォルダの下にシーンごとにフォルダを用意します。\u003c/li\u003e\n\u003cli\u003e各シーンフォルダにasmdefファイルを用意します。\u003c/li\u003e\n\u003cli\u003ereadonlyやwriteonlyにしたいフィールドに対するpublicアクセサを書きましょう。\n\n\u003cul\u003e\n\u003cli\u003eこの時一般のクラスから見えないようにする部分にinternal修飾子を付与しましょう。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eシーンフォルダにAssemblyInfo.csを書きましょう。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cshap\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eScripts/CSWR/AssemblyInfo.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003eusing System.Runtime.CompilerServices;\n[assembly: InternalsVisibleTo(\"Unity1Week.Title\")]\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eこんな感じで書けばCSWRシーンのinternalメンバーにTitleシーンからのみアクセスできるようになります。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"initializeworldcs\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#initializeworldcs\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eInitializeWorld.cs\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eInitializeWorld\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eMesh\u003c/span\u003e \u003cspan class=\"n\"\u003eenemyMesh\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eRotateSprite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eenemyDisplay\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eenemySprite\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eworld\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eWorld\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eActive\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eWorld\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"default\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eworld\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSetDefaultCapacity\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"m\"\u003e18\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003emanager\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eworld\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCreateManager\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eEntityManager\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003erange\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eUnity\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMathematics\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003euint2\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etitleSettings\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWidth\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etitleSettings\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eHeight\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003edecidePositionHashCodeSystem\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eworld\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCreateManager\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eDecidePositionHashCodeSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"n\"\u003erange\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eenemyHashCodes\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edecidePositionHashCodeSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEnemyHashCodes\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003esnowHashCodes\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edecidePositionHashCodeSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSnowBulletCodes\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eplayerBulletHashCodes\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edecidePositionHashCodeSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePlayerBulletCodes\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eplayerBulletPositionHashSet\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edecidePositionHashCodeSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePlayerBulletPositionHashCodeSet\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003esnowBulletPositionHashSet\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edecidePositionHashCodeSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSnowBulletPositionHashCodeSet\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003echips\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eInitializePlane\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erange\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003erange\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eInitializePlayer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erange\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e100\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eInitialTemperature\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eThermalDeathPoint\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eworld\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateManager\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ePlayerEnemyRenderSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003emainCamera\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eplayerSprite\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eplayerMaterial\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eenemyMesh\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eMaterial\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003eenemyDisplay\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ebossMaterial\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eenemyDisplay\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eleaderMaterial\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eenemyDisplay\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esubordinateMaterial\u003c/span\u003e \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eworld\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateManager\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eMoveSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eworld\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateManager\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eEnemyBulletRenderSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003emainCamera\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003esnowSkillSetting\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSprites\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003esnowSkillSetting\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMaterial\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eworld\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateManager\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eMoveEnemySystem\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003eplayer\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eworld\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateManager\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eEnemySnowShootSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003eplayer\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eworld\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateManager\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eConfinePlayerPositionSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003eplayer\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003erange\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emainCamera\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etransform\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eworld\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateManager\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eKinokoRenderSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003emainCamera\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ekinokoHammer\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ekinokoMaterial\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e120\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003eMath\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePI\u003c/span\u003e \u003cspan class=\"p\"\u003e/\u003c/span\u003e \u003cspan class=\"m\"\u003e180\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e1f\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ePlayerShootSystem\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eworld\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCreateManager\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ePlayerShootSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"n\"\u003eplayer\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emainCamera\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eAction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eTryToPlayTakenokoShoot\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eSpawnEnemySystem\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eInitializeSpawnEnemy\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eplayer\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eenemyMesh\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eworld\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003erange\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etitleSettings\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLeaderCount\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003edeathCounter\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eSpawnEnemySystem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDeathCount\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003enearToRespawn\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eSpawnEnemySystem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNearToRespawn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eworld\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateManager\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eTakenokoEnemyHitCheckSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"m\"\u003e0.16f\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eenemyHashCodes\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eplayerBulletHashCodes\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eplayerBulletPositionHashSet\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eAction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eTryToPlayTakenokoBurst\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eworld\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateManager\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ePlayerMoveSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003eplayer\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emainCamera\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etransform\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eInitializeAnimationRenderSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eworld\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etakenokoBulletBurst\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elength\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eworld\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateManager\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDestroyEnemyOutOfBoundsSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003erange\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eworld\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateManager\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDecideMoveSpeedSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003erange\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003echips\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eplayerSpeeds\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSpeeds\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eenemySpeeds\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSpeeds\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eworld\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateManager\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eUpdateCoolTimeSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eworld\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateManager\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eTakenokoRenderSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003emainCamera\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eplayerSkills\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eSprites\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003eplayerSkills\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eMaterial\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eworld\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateManager\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eBombHitCheckSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003eplayer\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eenemyHashCodes\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eworld\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateManager\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eChipRenderSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003emainCamera\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003erange\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003echips\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emapTable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003echipTemperatures\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emapTable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emap\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eunlit\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eworld\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateManager\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eSnowPlayerHitCheckSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003eplayer\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003esnowSkillSetting\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUtilityNumber\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edeathCounter\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0.5f\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003esnowHashCodes\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eplayerBulletHashCodes\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003esnowBulletPositionHashSet\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eAction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eTryToPlaySnowBurst\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRainSystem\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eworld\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCreateManager\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eRainSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"n\"\u003erange\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003erainCoolTimeSpan\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003erainCoolPower\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003erainCoolFrequency\u003c/span\u003e\u003cspan class=\"p\"\u003e)).\u003c/span\u003e\u003cspan class=\"n\"\u003eEnabled\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEnemyPlayerCollisionSystem\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eworld\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCreateManager\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eEnemyPlayerCollisionSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"n\"\u003eplayer\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eenemyHashCodes\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0.16f\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edeathCounter\u003c/span\u003e\u003cspan class=\"p\"\u003e)).\u003c/span\u003e\u003cspan class=\"n\"\u003eEnabled\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eworld\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateManager\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ePlayerTemperatureSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003eplayer\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003erange\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003echips\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eheatDamageRatio\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecoolRatio\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eworld\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateManager\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eUtusemiRenderSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003emainCamera\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eplayerSkills\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eSprites\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003eplayerSkills\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eMaterial\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e15\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eScriptBehaviourUpdateOrder\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eUpdatePlayerLoop\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eworld\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eWorld.CreateManager(Type t, paramas object[] constructorArguments)は内部的にActivator.CreateInstanceを使用しています。\u003cbr\u003e\nよって、ComponentSystemに対する依存性注入は純粋にコンストラクタ経由で行えます。\u003cbr\u003e\n\u003cdel\u003eECS標準のMeshInstanceRendererSystemはActiveCameraというフィールドを外部に露出して書き込んでもらうことを前提とした設計ですが、それなんて前時代\u003c/del\u003e\u003cbr\u003e\nComponentSystemから外部にフィールドを公開する場合もreadonlyフィールドなので勝手に書き換えられる心配をしなくてすみます。 \u003cdel\u003ereadonlyが使えないMonoBehaviourとは違うのだよ！\u003c/del\u003e\u003c/p\u003e\n\n\u003cp\u003eちょっと残念なのは参照の依存関係上CreateManagerする順番が割と重要なことですね。大半のComponentSystemは他のComponentSystemに依存していないので初期化順番を気にしなくていいのですが……\u003c/p\u003e\n\n\u003cp\u003e24個もComponentSystemをCreateManagerしていますが、この規模のゲームとしてはどうなのでしょうかね？\u003cbr\u003e\nComponentSystem個々の働きを確認してみましょう。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e描画系６つ\n\n\u003cul\u003e\n\u003cli\u003eAnimationSkillRender\u003c/li\u003e\n\u003cli\u003e爆発のスプライトコマ落ちアニメーションを扱います。爆発以外のアニメーションスプライトも統一的に扱えるよう設計しましたが、他にアニメするエフェクトがなかったです\u003cimg alt=\":innocent:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/1f607.png\" title=\":innocent:\" width=\"20\" loading=\"lazy\"\u003e\n\u003c/li\u003e\n\u003cli\u003eChipRender\u003c/li\u003e\n\u003cli\u003e地面のマップチップを描画するシステムです。このゲームではプレイヤーの攻撃により地面の種類が変化しますし、マップも自動生成であるので事前にテクスチャをベイクするという手法を取れませんでした。そのためマップ描画専用のシステムを用意しました。\u003c/li\u003e\n\u003cli\u003ePlayerEnemyRender\u003c/li\u003e\n\u003cli\u003e敵とプレイヤーを描画します。MeshInstanceRendererSystemは内部動作が複雑で不必要に高機能なので使用しませんでした。\u003c/li\u003e\n\u003cli\u003eリポジトリを見れば十分わかると思うので当記事では解説しません。\u003c/li\u003e\n\u003cli\u003eEnemyBulletRender\u003c/li\u003e\n\u003cli\u003eアメイジングトレンチハンマーRender\u003c/li\u003e\n\u003cli\u003eドウリルヴェルファーRender\u003c/li\u003e\n\u003cli\u003e空蝉Render\u003c/li\u003e\n\u003cli\u003eこの4つのComponentSystemは攻撃を描画するためのものです。個々の攻撃の仕様が微妙に違うので専用のComponentSystemをそれぞれに用意しました。もうちょっと工夫すれば統一的に扱えたでしょう。\u003c/li\u003e\n\u003cli\u003eリポジトリを見れば十分わかると思うので当記事では解説しません。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e敵とプレイヤーの移動系６つ\n\n\u003cul\u003e\n\u003cli\u003eDecideMoveSpeed\u003c/li\u003e\n\u003cli\u003eこのゲームでは地形マス毎に移動力が設定されていますので、現在位置に応じて毎フレーム移動力を再計算しています。\u003c/li\u003e\n\u003cli\u003eリポジトリを見れば十分わかると思うので当記事では解説しません。\u003c/li\u003e\n\u003cli\u003eConfinePlayerPosition\u003c/li\u003e\n\u003cli\u003eDestroyEnemyOutOfBounds\u003c/li\u003e\n\u003cli\u003e戦場の外にプレイヤーが出ることが出来ないように制限しています。\u003c/li\u003e\n\u003cli\u003e敵や弾丸は制限せず、外に出た場合その場でDestroyEntityしています。\u003c/li\u003e\n\u003cli\u003e生成と削除のコストが安いECSだからこそできることですね。\u003c/li\u003e\n\u003cli\u003eリポジトリを見れば十分わかると思うので当記事では解説しません。\u003c/li\u003e\n\u003cli\u003eHeadingEnemy\u003c/li\u003e\n\u003cli\u003e一定時間毎に敵は移動方向を変更します。\u003c/li\u003e\n\u003cli\u003eリポジトリを見れば十分わかると思うので当記事では解説しません。\u003c/li\u003e\n\u003cli\u003eMove\u003c/li\u003e\n\u003cli\u003e移動方向(Heading)と移動速度(MoveSpeed)を元にあらゆるEnityのPositionを更新します。\u003c/li\u003e\n\u003cli\u003eリポジトリを見れば十分わかると思うので当記事では解説しません。\u003c/li\u003e\n\u003cli\u003ePlayerMove\u003c/li\u003e\n\u003cli\u003ePlayerの移動方向はInputから決定します。また、カメラが常にプレイヤーを中央に捉え続けるように設定しました。\u003c/li\u003e\n\u003cli\u003eリポジトリを見れば十分わかると思うので当記事では解説しません。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e当たり判定系４つ\n\n\u003cul\u003e\n\u003cli\u003eBombHit\u003c/li\u003e\n\u003cli\u003eドウリルヴェルファーが敵に当たった後発生する爆炎が敵やプレイヤーにダメージを与える処理をします。\u003c/li\u003e\n\u003cli\u003e爆炎とプレイヤー・敵の衝突判定を実行\u003c/li\u003e\n\u003cli\u003eEnemyPlayerCollision\u003c/li\u003e\n\u003cli\u003e敵とプレイヤーの衝突判定。プレイヤーの体力を削る処理を含む。\u003c/li\u003e\n\u003cli\u003eSnowPlayerHit\u003c/li\u003e\n\u003cli\u003e敵が放つ攻撃とプレイヤー・プレイヤーの放ったドウリルヴェルファーとの衝突判定。\u003c/li\u003e\n\u003cli\u003eTakenokoEnemyHit\u003c/li\u003e\n\u003cli\u003eドウリルヴェルファーと敵の衝突判定\u003c/li\u003e\n\u003cli\u003e\u003cdel\u003e\u003ca href=\"/mao_\" class=\"user-mention js-hovercard\" title=\"mao_\" data-hovercard-target-type=\"user\" data-hovercard-target-name=\"mao_\"\u003e@mao_\u003c/a\u003e さんがいずれECSにおける衝突判定に関するまとめ記事を書かれるそうなので詳細な解説はしません。\u003c/del\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://qiita.com/mao_/items/ad8a09a9c6403a2e84cf\" id=\"reference-f8c03bbe0bbe5c61e455\"\u003e解説記事が発表されました。\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003eNativeMultiHashMap\u0026lt;ulong,ValueTuple\u0026lt;Entity,float2\u0026gt;\u0026gt;をforeachで回して格子内での衝突判定をしています。\u003ca href=\"https://qiita.com/kodai100/items/d1ddb3f86ba5dccccf9f\" id=\"reference-0de3656c7eceea98cf55\"\u003e参考資料\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e弾幕射出など攻撃系４つ\n\n\u003cul\u003e\n\u003cli\u003eUpdateCoolTime\u003c/li\u003e\n\u003cli\u003eスキルクールタイムを採用しています。プレイヤーとスキルを使用する全ての敵のスキルのクールタイムを更新します。ただ、別にこのシステムよく考えたら不要なのですよね……\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://www.slideshare.net/UnityTechnologiesJapan/unite-2018-tokyo\" rel=\"nofollow noopener\" target=\"_blank\"\u003e【Unite Tokyo 2018】誘導ミサイル完全マスター\u003c/a\u003eの116枚目あたりのテクニック使えばよかったです……\u003c/li\u003e\n\u003cli\u003ePlayerShoot\u003c/li\u003e\n\u003cli\u003eプレイヤーのスキルがクールタイムよりも長く使用されず、かつマウスの左ボタンが押されている場合にスキルを使用します。\u003c/li\u003e\n\u003cli\u003eEnemyShoot\u003c/li\u003e\n\u003cli\u003e上に同じ\u003c/li\u003e\n\u003cli\u003eLaserShoot\u003c/li\u003e\n\u003cli\u003e死産\u003c/li\u003e\n\u003cli\u003eリポジトリ読めば十分理解できます。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eその他４つ\n\n\u003cul\u003e\n\u003cli\u003eRain\u003c/li\u003e\n\u003cli\u003e時間経過による地形変更システム。リポジトリを読めば十分理解できるので当記事では非解説。\u003c/li\u003e\n\u003cli\u003eSpawnEnemy\u003c/li\u003e\n\u003cli\u003e敵が一定以下に減らされたりなど特定条件を満たした場合に大量の敵を発生させる。\u003c/li\u003e\n\u003cli\u003ePlayerTemperature\u003c/li\u003e\n\u003cli\u003eプレイヤーの機体温度を管理する。一定以上の機体温度ではプレイヤーにダメージを与える。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"描画系解説\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%8F%8F%E7%94%BB%E7%B3%BB%E8%A7%A3%E8%AA%AC\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e描画系解説\u003c/h1\u003e\n\n\u003cp\u003eこのゲームはプレイヤー・敵、エフェクト等すべてをXW平面上に描画しています。\u003cbr\u003e\nそれをY軸上に存在するカメラが上から眺めている形になります。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/cd2cd3a5be9d058a786a0e512e07b0514567a5bf/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3235363034372f33353561363436362d306436392d343937382d636562612d3566626338373264656332642e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F256047%2F355a6466-0d69-4978-ceba-5fbc872dec2d.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=88feae6ed07a94778e7a59f56ef38f5e\" alt=\"キャプチャ.PNG\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/256047/355a6466-0d69-4978-ceba-5fbc872dec2d.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F256047%2F355a6466-0d69-4978-ceba-5fbc872dec2d.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=1ddebbf7f6b009780a07bb8f6d3cc36a 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eECSにおける一般的な描画方法については\u003ca href=\"https://qiita.com/mao_/items/c4a217b33a0a94d5d52f\" id=\"reference-2e198e97487ec985768f\"\u003e次の記事\u003c/a\u003eを参照するとよいでしょう。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"animationskillrendercs\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#animationskillrendercs\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eAnimationSkillRender.cs\u003c/h2\u003e\n\n\u003cp\u003e一番工夫がわかりやすいシステムから解説しましょう。 \u003cdel\u003e折角スケールするように設計しても対象が1つしかないので無駄とは言ってはいけない。\u003c/del\u003e\u003cbr\u003e\n\u003ca href=\"https://docs.unity3d.com/ScriptReference/Graphics.DrawMeshInstancedIndirect.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eGraphics.DrawMeshInstancedIndirect\u003c/a\u003eが何故かWebGLで動かなかったので次善の策として\u003ca href=\"https://docs.unity3d.com/ScriptReference/Graphics.DrawMeshInstanced.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eGraphics.DrawMeshInstanced\u003c/a\u003eを使用しています。\u003cbr\u003e\n\u003ca href=\"https://docs.unity3d.com/ScriptReference/Graphics.DrawMeshInstancedIndirect.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eGraphics.DrawMeshInstancedIndirect\u003c/a\u003e関連は凡ミスが発生しやすい面倒なメソッドなので、何か私が気付かずにミスっているだけという可能性も高いですがね。\u003cbr\u003e\n\u003ca href=\"https://docs.unity3d.com/ScriptReference/Graphics.DrawMeshInstanced.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eGraphics.DrawMeshInstanced\u003c/a\u003eは一度のBatchで描画できる対象数が1023個に制限されているため、数万個を描画しようとするとBatchCountがゴリゴリ増える欠点があります。\u003c/p\u003e\n\n\u003cp\u003eこのシステムではスプライトをgifのようにアニメーションさせつつ大量に描画しています。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/f88b8052a5b89c5888ac6fe20ef988ab4e1bda97/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3235363034372f37396537326162362d343930382d373263372d316139352d6437383230353062613234622e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F256047%2F79e72ab6-4908-72c7-1a95-d782050ba24b.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=223bd9ac201a61fe6215a24aab83519b\" alt=\"pipo-btleffect022.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/256047/79e72ab6-4908-72c7-1a95-d782050ba24b.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F256047%2F79e72ab6-4908-72c7-1a95-d782050ba24b.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=8d24e17e3e802ca5c4f4da2819399b4c 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n今回ゲームで使用した素材（\u003ca href=\"https://pipoya.net/sozai/%E6%9C%89%E6%96%99%E7%B4%A0%E6%9D%90-%E3%82%A8%E3%83%95%E3%82%A7%E3%82%AF%E3%83%88/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eぴぽや様\u003c/a\u003eより拝借しました）\u003cbr\u003e\nご覧のように一枚のテクスチャに８つの爆発画像が含まれています。InspectorでSplite ModeをMultipleに設定して8つにスプライトを分割、各SpriteからMeshを取り出して配列に入れています。\u003cbr\u003e\nこのMesh配列の要素を\u003ca href=\"https://docs.unity3d.com/ScriptReference/Graphics.DrawMeshInstanced.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eGraphics.DrawMeshInstanced\u003c/a\u003eの引数に適切に渡してあげればアニメーションができるのです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eAnimationSkillRender.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003esealed\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eAnimationSkillRenderSystem\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eComponentSystem\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eCamera\u003c/span\u003e \u003cspan class=\"n\"\u003emainCamera\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eMatrix4x4\u003c/span\u003e\u003cspan class=\"p\"\u003e[][]\u003c/span\u003e \u003cspan class=\"n\"\u003ematrixArray\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003ecountArray\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003etimeArray\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eMesh\u003c/span\u003e\u003cspan class=\"p\"\u003e[][]\u003c/span\u003e \u003cspan class=\"n\"\u003emeshArray\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eMaterial\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003ematerialArray\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eEntityArchetypeQuery\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003equeryArray\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eNativeList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eEntityArchetype\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;[]\u003c/span\u003e \u003cspan class=\"n\"\u003efoundArchetypeListArray\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eHashSet\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eEntity\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003etoDestroy\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eHashSet\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eEntity\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eEntityManager\u003c/span\u003e \u003cspan class=\"n\"\u003emanager\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eAnimationSkillRenderSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eCamera\u003c/span\u003e \u003cspan class=\"n\"\u003emainCamera\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eEntityArchetypeQuery\u003c/span\u003e \u003cspan class=\"n\"\u003equery\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eSprite\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003esprites\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eMaterial\u003c/span\u003e \u003cspan class=\"n\"\u003ematerial\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"n\"\u003etime\u003c/span\u003e\u003cspan class=\"p\"\u003e)[]\u003c/span\u003e \u003cspan class=\"n\"\u003earray\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003earray\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eArgumentOutOfRangeException\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emainCamera\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emainCamera\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003elength\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003earray\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etimeArray\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003elength\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emeshArray\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eMesh\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003elength\u003c/span\u003e\u003cspan class=\"p\"\u003e][];\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ematerialArray\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eMaterial\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003elength\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003equeryArray\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eEntityArchetypeQuery\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003elength\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efoundArchetypeListArray\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eNativeList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eEntityArchetype\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;[\u003c/span\u003e\u003cspan class=\"n\"\u003elength\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003emaxSpriteVariationCount\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003earray\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eelement\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"n\"\u003earray\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eelement\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etime\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eArgumentException\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etimeArray\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eelement\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etime\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003emeshes\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"n\"\u003emeshArray\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n            \u003cspan class=\"n\"\u003emeshes\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eMesh\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eelement\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esprites\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n            \u003cspan class=\"n\"\u003emaxSpriteVariationCount\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eMath\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eMax\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eelement\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esprites\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emaxSpriteVariationCount\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ej\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ej\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003emeshes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ej\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e\n                \u003cspan class=\"n\"\u003emeshes\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ej\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eelement\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esprites\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ej\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nf\"\u003eFromSprite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e0.02f\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ematerialArray\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eelement\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ematerial\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003equeryArray\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eelement\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003equery\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efoundArchetypeListArray\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eNativeList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eEntityArchetype\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"n\"\u003eAllocator\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePersistent\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eidentity\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eMatrix4x4\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eidentity\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ematrixArray\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eMatrix4x4\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003emaxSpriteVariationCount\u003c/span\u003e\u003cspan class=\"p\"\u003e][];\u003c/span\u003e\n        \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ematrixArray\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ematrixArray\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eMatrix4x4\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1023\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eunsafe\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003esrcPtr\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003eidentity\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"k\"\u003efixed\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eMatrix4x4\u003c/span\u003e\u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003edestPtr\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ematrixArray\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003eUnsafeUtility\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eMemCpyReplicate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edestPtr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003esrcPtr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e64\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e1023\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecountArray\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003emaxSpriteVariationCount\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprotected\u003c/span\u003e \u003cspan class=\"k\"\u003eoverride\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnCreateManager\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ecapacity\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003emanager\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eEntityManager\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprotected\u003c/span\u003e \u003cspan class=\"k\"\u003eoverride\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnDestroyManager\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003efoundArchetypeListArray\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e\n            \u003cspan class=\"n\"\u003efoundArchetypeListArray\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nf\"\u003eDispose\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eprotected\u003c/span\u003e \u003cspan class=\"k\"\u003eoverride\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnUpdate\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003etoDestroy\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eClear\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ePositionTypeRO\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emanager\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGetArchetypeChunkComponentType\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ePosition\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ePosition2DTypeRO\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emanager\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGetArchetypeChunkComponentType\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ePosition2D\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eLifeTimeTypeRO\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emanager\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGetArchetypeChunkComponentType\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeTime\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eEntityType\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emanager\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetArchetypeChunkEntityType\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ecurrentTime\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eTime\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etimeSinceLevelLoad\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003equeryArray\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003emanager\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAddMatchingArchetypes\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003equeryArray\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003efoundArchetypeListArray\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eunsafe\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"k\"\u003efixed\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003eptr\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecountArray\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003eUnsafeUtility\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eMemClear\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eptr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecountArray\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLongLength\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003echunks\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emanager\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateArchetypeChunkArray\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efoundArchetypeListArray\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003eAllocator\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTemp\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ematerial\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"n\"\u003ematerialArray\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003emeshes\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"n\"\u003emeshArray\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n                \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ej\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ej\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003echunks\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ej\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003elifeTimes\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003echunks\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ej\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetNativeArray\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeTimeTypeRO\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elifeTimes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003econtinue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eentities\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003echunks\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ej\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetNativeArray\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eEntityType\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003epositions2D\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003echunks\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ej\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetNativeArray\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ePosition2DTypeRO\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epositions2D\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003epositions3D\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003echunks\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ej\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetNativeArray\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ePositionTypeRO\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epositions3D\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003econtinue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                        \u003cspan class=\"nf\"\u003eExecute3D\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecurrentTime\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eentities\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003elifeTimes\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003epositions3D\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                        \u003cspan class=\"k\"\u003econtinue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                    \u003cspan class=\"nf\"\u003eExecute2D\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecurrentTime\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eentities\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003elifeTimes\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003epositions2D\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                \u003cspan class=\"nf\"\u003eCleanUp\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eentity\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003etoDestroy\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emanager\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eExists\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eentity\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n                \u003cspan class=\"n\"\u003emanager\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDestroyEntity\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eentity\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eCleanUp\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003emeshes\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emeshArray\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ematerial\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ematerialArray\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n        \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003emeshes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecountArray\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eGraphics\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDrawMeshInstanced\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emeshes\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ematerial\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ematrixArray\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003ecountArray\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eShadowCastingMode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eOff\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emainCamera\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eLightProbeUsage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eOff\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eExecute2D\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"n\"\u003ecurrentTime\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eNativeArray\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eEntity\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eentities\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eNativeArray\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeTime\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003elifeTimes\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eNativeArray\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ePosition2D\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003epositions\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003edeathTime\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etimeArray\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003emeshes\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emeshArray\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ematerial\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ematerialArray\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n        \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003elifeTimes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003etime\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecurrentTime\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003elifeTimes\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e/\u003c/span\u003e \u003cspan class=\"n\"\u003edeathTime\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etime\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// currentTime \u0026gt;= lifeTimes[i].Value + deathTime\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003etoDestroy\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eentities\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n                \u003cspan class=\"k\"\u003econtinue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003estage\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)(\u003c/span\u003e\u003cspan class=\"n\"\u003emeshes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003etime\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003emesh\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emeshes\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003estage\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ematrixes\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"n\"\u003ematrixArray\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003estage\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ecount\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"n\"\u003ecountArray\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003estage\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ematrix\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"n\"\u003ematrixes\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ecount\u003c/span\u003e\u003cspan class=\"p\"\u003e++];\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ematrix\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003em03\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003epositions\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ematrix\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003em23\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003epositions\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecount\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"m\"\u003e1023\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003econtinue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eGraphics\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDrawMeshInstanced\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emesh\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ematerial\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ematrixes\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e1023\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eShadowCastingMode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eOff\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emainCamera\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eLightProbeUsage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eOff\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ecount\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eExecute3D\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"n\"\u003ecurrentTime\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eNativeArray\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eEntity\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eentities\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eNativeArray\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eLifeTime\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003elifeTimes\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eNativeArray\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ePosition\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003epositions\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003edeathTime\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etimeArray\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003emeshes\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emeshArray\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ematerial\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ematerialArray\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n        \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003elifeTimes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003etime\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecurrentTime\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003elifeTimes\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e/\u003c/span\u003e \u003cspan class=\"n\"\u003edeathTime\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etime\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// currentTime \u0026gt;= lifeTimes[i].Value + deathTime\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003etoDestroy\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eentities\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n                \u003cspan class=\"k\"\u003econtinue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003estage\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)(\u003c/span\u003e\u003cspan class=\"n\"\u003emeshes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003etime\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003emesh\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emeshes\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003estage\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ematrixes\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"n\"\u003ematrixArray\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003estage\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ecount\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"n\"\u003ecountArray\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003estage\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ematrix\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"n\"\u003ematrixes\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ecount\u003c/span\u003e\u003cspan class=\"p\"\u003e++];\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ematrix\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003em03\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003epositions\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ematrix\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003em23\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003epositions\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ez\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecount\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"m\"\u003e1023\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003econtinue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eGraphics\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDrawMeshInstanced\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emesh\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ematerial\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ematrixes\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e1023\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eShadowCastingMode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eOff\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emainCamera\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eLightProbeUsage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eOff\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ecount\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eECS 0.0.12-preview.11からの新機能としてChunk Iterationがあります。\u003cbr\u003e\n使用法はComponentGroupに比べたらやや複雑ですが十分簡単です。\u003cbr\u003e\nEntityArchetypeQuery型とNativeList\u0026lt;EntityArchetype\u0026gt;型のフィールドを用意します。\u003cbr\u003e\n毎フレームOnUpdate内部でEntityManager.AddMatchingArchetype(EntityArchetype, NativeList\u0026lt;EntityArchetype\u0026gt;)を呼び出してNativeList\u0026lt;EntityArchetype\u0026gt;を最新の情報にアップデートしてあげます。\u003cbr\u003e\nその後EntityManager.CreateArchetypeChunkArray(NativeList\u0026lt;EntityArchetype\u0026gt;, Allocator)を呼び出してNativeArray\u0026lt;ArchetypeChunk\u0026gt;を得ましょう。\u003cbr\u003e\n今回のプロジェクトは対象プラットフォームがWebGLで完全にシングルスレッドで実行されるのでAllocatorにAllocator.Tempを使用していますが、本来ECSはマルチスレッドで実行されますのでAllocator.Tempだとエラー吐かれますので、Allocator.TempJob以上にしましょう。\u003c/p\u003e\n\n\u003cp\u003e実際にEntityを処理する際はNativeArray\u0026lt;ArchetypeChunk\u0026gt;をfor文ぐるぐる回して処理します。\u003cbr\u003e\n各ArchetypeChunkからEntityやComponentDataを得るにはArchetypeChunk.GetNativeArray(ArchetypeChunkEntityType), ArchetypeChunk.GetNativeArray\u0026lt;T\u0026gt;(ArchetypeChunkComponentType\u0026lt;T\u0026gt;を使用します。\u003cbr\u003e\n引数に与えるArchetypeChunkComponentType\u0026lt;T\u0026gt;は毎フレームEntityManager.GetArchetypeChunkComponentType\u0026lt;Position\u0026gt;(bool isReadOnly)で生成します。\u003cbr\u003e\n気を付けて欲しいのですが、GetNativeArrayの戻り値であるNativeArrayをDisposeしてはいけません。これは実質Span\u0026lt;T\u0026gt;みたいなものですので、所有権をプログラマーは有していません。ECSが生成し、破棄まで管理しています。\u003c/p\u003e\n\n\u003cp\u003eさて、Chunk Iterationによりチャンク毎に効率的に処することができるようになりましたね。\u003cbr\u003e\n今回このシステムは「EntityArchetypeQuery毎にアニメーションするスプライトが全く異なる」という前提のもとに動いています。\u003cbr\u003e\nつまり、EntityArchetypeQuery, Mesh[], Materialがタプルとなっているわけです。そのためコンストラクタにはValueTuple\u0026lt;EntityArchetypeQuery, Sprite[], Material, float\u0026gt;を与えています。\u003c/p\u003e\n\n\u003cp\u003e工夫した点は1023要素のMatrix4x4[]をMax(アニメーションのコマ数)個最初に用意し、以後配列をnewしないようにしてアロケーションを最低限にしたことですね。また、TransformSystemを介在させず直接Matrix4x4[]に書き込むことで無駄なコピーコストをなくしています。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"衝突判定\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A1%9D%E7%AA%81%E5%88%A4%E5%AE%9A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e衝突判定\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"bombhitcs\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#bombhitcs\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eBombHit.cs\u003c/h2\u003e\n\n\u003cp\u003e実行順制御については\u003ca href=\"http://tsubakit1.hateblo.jp/entry/2018/09/06/200000\" rel=\"nofollow noopener\" target=\"_blank\"\u003eテラシュールブログの記事\u003c/a\u003eが詳しいのでそちらを参照してください。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eBomb.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"with-code\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eUpdateAfter\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDecidePositionHashCodeSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e))]\u003c/span\u003e\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nf\"\u003eUpdateBefore\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003etypeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eBombRenderSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e))]\u003c/span\u003e\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003esealed\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eBombHitCheckSystem\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eComponentSystem\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"n\"\u003erangeSquared\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eNativeMultiHashMap\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eDecidePositionHashCodeSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTuple\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eenemyHashCodes\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eEntity\u003c/span\u003e \u003cspan class=\"n\"\u003eplayer\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eComponentGroup\u003c/span\u003e \u003cspan class=\"n\"\u003eg\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eEntityArchetype\u003c/span\u003e \u003cspan class=\"n\"\u003edeadMan\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)[]\u003c/span\u003e \u003cspan class=\"n\"\u003ediff\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"n\"\u003eHashSet\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eEntity\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003etoDestroy\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eHashSet\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eEntity\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eBombHitCheckSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eEntity\u003c/span\u003e \u003cspan class=\"n\"\u003eplayer\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"n\"\u003eradius\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eNativeMultiHashMap\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eDecidePositionHashCodeSystem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTuple\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eenemyHashCodes\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eplayer\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eplayer\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003erangeSquared\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eradius\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003eradius\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eenemyHashCodes\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eenemyHashCodes\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003els\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u0026gt;((\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003erangeSquared\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eradius\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003er2\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;=\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ej\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eend\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eMath\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSqrt\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003er2\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"n\"\u003ej\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;=\u003c/span\u003e \u003cspan class=\"n\"\u003eend\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ej\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003els\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ej\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003els\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e((-\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ej\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ej\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003els\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003ej\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003ej\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003els\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e((-\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003ej\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ediff\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003els\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToArray\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eprotected\u003c/span\u003e \u003cspan class=\"k\"\u003eoverride\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnCreateManager\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ecapacity\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eg\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetComponentGroup\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eComponentType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eReadOnly\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ePosition2D\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(),\u003c/span\u003e \u003cspan class=\"n\"\u003eComponentType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eReadOnly\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eBombEffect\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;());\u003c/span\u003e\n        \u003cspan class=\"n\"\u003edeadMan\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eEntityManager\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateArchetype\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eComponentType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCreate\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eDeadMan\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;());\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eprotected\u003c/span\u003e \u003cspan class=\"k\"\u003eoverride\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnUpdate\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003epositions\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eg\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGetComponentDataArray\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ePosition2D\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003emanager\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eEntityManager\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ebuf\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ePostUpdateCommands\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eplayerPos\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emanager\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGetComponentData\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ePosition\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"n\"\u003eplayer\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003edeltaTime\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eTime\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edeltaTime\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003etoDestroy\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eClear\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003econsumed\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003elength\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003epositions\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003econsumed\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003elength\u003c/span\u003e\u003cspan class=\"p\"\u003e;)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eposChunk\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003epositions\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetChunkArray\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003econsumed\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003elength\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003econsumed\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003eposChunk\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eposChunk\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ey\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eposChunk\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"n\"\u003eplDistanceSquared\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ediffX\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eplayerPos\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003eposChunk\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ediffY\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eplayerPos\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ez\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003eposChunk\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003eplDistanceSquared\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ediffX\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003ediffX\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003ediffY\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003ediffY\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eplDistanceSquared\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;=\u003c/span\u003e \u003cspan class=\"n\"\u003erangeSquared\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003esetting\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emanager\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGetComponentData\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ePlayerSettings\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"n\"\u003eplayer\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003esetting\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTemperature\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"m\"\u003e300f\u003c/span\u003e \u003cspan class=\"p\"\u003e/\u003c/span\u003e \u003cspan class=\"n\"\u003eplDistanceSquared\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003edeltaTime\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003emanager\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSetComponentData\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eplayer\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003esetting\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ej\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ej\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003ediff\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ej\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(!\u003c/span\u003e\u003cspan class=\"n\"\u003eenemyHashCodes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eTryGetFirstValue\u003c/span\u003e\u003cspan class=\"p\"\u003e(((\u003c/span\u003e\u003cspan class=\"n\"\u003ediff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ej\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eItem1\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"m\"\u003e16\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ediff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ej\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eItem2\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003ey\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eit\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n                        \u003cspan class=\"k\"\u003econtinue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003etoDestroy\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEntity\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003ewhile\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eenemyHashCodes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eTryGetNextValue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eout\u003c/span\u003e \u003cspan class=\"n\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eref\u003c/span\u003e \u003cspan class=\"n\"\u003eit\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003etoDestroy\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEntity\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003emanager\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eCreateEntity\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edeadMan\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eitem\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003etoDestroy\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emanager\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eExists\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003emanager\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDestroyEntity\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003econsumed\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"n\"\u003eposChunk\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eBombEffectは爆発を意味するComponentTypeです。\u003cbr\u003e\n爆発の所属するマス目とその上下左右についてハッシュ値を計算し、NativeMultiHashMapから所属するEntityとその座標を得て衝突判定を行っています。\u003cbr\u003e\n衝突する場合は破棄予定EntityとしてHashSet\u0026lt;Entity\u0026gt;にAddし、OnUpdateの最後の方にまとめてEntityManager.Existsで生存を確認しつつEntityManager.DestroyEntityしています。\u003c/p\u003e\n\n\u003cp\u003eUnity.Mathematics.mathという数学クラスがあるのにどうしてベタベタと汚くコードを書いているのか疑問に思うでしょう。\u003cbr\u003e\nそれはUnity.Mathematics.mathのメソッドの大半がSystem.Mathのラッパーメソッドであるからです。しかもfloat\u0026lt;=\u0026gt;doubleの変換を一々伴うので効率が悪いです。\u003cbr\u003e\nSIMD演算化されて高速に動作するという触れ込みですが、それはBurstでコンパイルされた時に限定されるため、Job Systemを使えないWebGLでは一切使わないのが一番です。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"参考文献\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e参考文献\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"https://qiita.com/mao_/items/6ad28fc20dda77364e39\" id=\"reference-ecaa203acd1a18c60c66\"\u003e【Unity】ECSで弾幕STGを作ってみたので技術周りについて解説\u003c/a\u003e\n\n\u003cul\u003e\n\u003cli\u003e更に古いバージョンを対象としていますが、ECSで作られたまともに実際遊べるゲームの解説記事です。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://qiita.com/pCYSl5EDgo/items/caac60ee41058cde085a\"\u003e【Unity】Entity Component System入門(その1)【2018.2】\u003c/a\u003e\n\n\u003cul\u003e\n\u003cli\u003eゲームジャムに参加している間にバージョンが上がってしまったのでそのうち書き直します。\u003c/li\u003e\n\u003cli\u003eこの記事の読み飛ばしてもよい解説を全て理解できたら「ECSなんもわからん」と胸を張って言えます。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://qiita.com/mao_/items/c4a217b33a0a94d5d52f\"\u003e【Unity】PureECSの描画周りについて解説してみる\u003c/a\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003cdel\u003e小ネタとは一体？\u003c/del\u003e\u003c/li\u003e\n\u003cli\u003e描画周りはこれ読めば基本を全部抑えられます。本当です。付け足すことないです。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://www.slideshare.net/UnityTechnologiesJapan/unite-2018-tokyo\" rel=\"nofollow noopener\" target=\"_blank\"\u003e【Unite Tokyo 2018】誘導ミサイル完全マスター\u003c/a\u003e\n\n\u003cul\u003e\n\u003cli\u003eWebGLではComputeShader一切使えませんが、かなり参考になります。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"http://tsubakit1.hateblo.jp/entry/2018/09/23/041552\" rel=\"nofollow noopener\" target=\"_blank\"\u003e【Unity】ECSで複数のWorldを運用する方法\u003c/a\u003e\n\n\u003cul\u003e\n\u003cli\u003eデフォルトワールドを殺した場合についてわかりやすい解説があります。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"感想\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%84%9F%E6%83%B3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e感想\u003c/h1\u003e\n\n\u003cp\u003e弾幕とECSの相性は最高です。自然と大物量を扱うことになりますからね。\u003cbr\u003e\nWebGLがシングルスレッド強制してくるのとComputeShader使用不可の縛りがもの凄くキツかったですが、unityroomにおける最大物量ゲームの記録を更新できたのではないかと思います。\u003c/p\u003e\n","createdAt":"2018-09-26T15:37:05Z","elapsedYearsFromLastModifiedAt":2,"encryptedId":"ma+QPmY+55F/04cbAg/aJRQV8Y21p3LS--tCbBi4zcpngFV500--0C8V534PvO6I7A1T5XuLhw==","isBanned":false,"isDeprecated":true,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"lastModifiedAt":"2018-10-14T12:45:06Z","likesCount":19,"linkUrl":"https://qiita.com/pCYSl5EDgo/items/5ff6fa92386bc046d949","organization":null,"originalId":698539,"stockedCount":15,"title":"【Unity】弾幕RTSゲームに対するEntity Component Systemを用いた実装の報告【Unity1Week】","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%9F%B7%E7%AD%86%E7%B5%8C%E7%B7%AF\"\u003e執筆経緯\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%AA%E3%83%9D%E3%82%B8%E3%83%88%E3%83%AA\"\u003eリポジトリ\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%89%8D%E6%8F%90%E7%92%B0%E5%A2%83\"\u003e前提環境\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E8%A8%AD%E8%A8%88\"\u003e設計\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B7%E3%83%BC%E3%83%B3%E6%A6%82%E8%AA%AC\"\u003eシーン概説\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%B8%AD%E6%A0%B8%E3%82%B7%E3%83%BC%E3%83%B3%E6%A6%82%E8%AA%AC\"\u003e中核シーン概説\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%A5%9Emanager%E3%82%AF%E3%83%A9%E3%82%B9%E6%A6%82%E8%AA%AC%E3%81%82%E3%82%8B%E3%81%84%E3%81%AF%E3%83%9D%E3%82%A8%E3%83%A0\"\u003e神Managerクラス概説（あるいはポエム）\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#managercs%E3%81%AE%E5%9F%BA%E7%A4%8E%E6%A7%8B%E9%80%A0\"\u003eManager.csの基礎構造\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%B7%E3%83%BC%E3%83%B3%E6%AF%8E%E3%81%AB%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B7%E3%83%93%E3%83%AA%E3%83%86%E3%82%A3%E3%82%92%E5%A4%89%E6%9B%B4%E3%81%99%E3%82%8B%E6%96%B9%E6%B3%95%E8%AA%AD%E3%81%BF%E9%A3%9B%E3%81%B0%E3%81%97%E5%8F%AF\"\u003eシーン毎にアクセシビリティを変更する方法（読み飛ばし可）\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#initializeworldcs\"\u003eInitializeWorld.cs\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%8F%8F%E7%94%BB%E7%B3%BB%E8%A7%A3%E8%AA%AC\"\u003e描画系解説\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#animationskillrendercs\"\u003eAnimationSkillRender.cs\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E8%A1%9D%E7%AA%81%E5%88%A4%E5%AE%9A\"\u003e衝突判定\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#bombhitcs\"\u003eBombHit.cs\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE\"\u003e参考文献\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%84%9F%E6%83%B3\"\u003e感想\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":3387,"uuid":"5ff6fa92386bc046d949","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"XVdklvUVi6kQtNRg9mrj8WBd4ZyY--0tLu9OKmI23iyHW2--f8u+o1rsq7G/d4jh55r7YA==","originalId":256047,"description":"C#!好き!!（語彙不足）\r\nUnityやヴァーレントゥーガ関連の投稿をしていく予定です。","facebookUrl":null,"githubUrl":"https://github.com/pCYSl5EDgo","isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"自治区 スーギ・ノウコ","profileImageUrl":"https://qiita-image-store.s3.amazonaws.com/0/256047/profile-images/1546351264","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F256047%2Fprofile-images%2F1546351264?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=976dab58dc56a745da2171d56fec56a7","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F256047%2Fprofile-images%2F1546351264?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=c5789bc76dd49b92c1ddc68bc158b06b","urlName":"pCYSl5EDgo","websiteUrl":"","twitterUrl":"https://twitter.com/pCYSl5EDgo","twitterUrlName":"pCYSl5EDgo","revealedOrganizations":{"edges":[]}},"tags":[{"name":"C#","urlName":"csharp"},{"name":"Unity","urlName":"unity"},{"name":"入門","urlName":"%e5%85%a5%e9%96%80"},{"name":"ECS","urlName":"ecs"},{"name":"unity1week","urlName":"unity1week"}],"followingLikers":{"edges":[]},"comments":{"totalCount":0}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

More than 3 years have passed since last update.取り込みバッチ処理を外部プロセス(コンソールアプリケーション)で作成して、進捗状況を進捗ダイアログ画面のプログレスバーで表示するサンプルを作ることになりました。外部プロセスの進捗状況を確認するには、進捗状況を何かに出力してもらう必要があります。
コンソールアプリケーションなので標準出力に進捗状況を出力して、進捗ダイアログ画面で非同期で標準出力の内容を読み取りプログレスバーに進捗状況を表示することにしました。バックグラウンド処理にはBackgroundWorkerコンポーネントを使用しています。実行ボタンで進捗ダイアログ画面を表示する外部プロセス(コンソールアプリケーション)で、進捗状況をコンソールに出力します。
処理内容はサンプルなので適当です。SubProccess70()の戻り値を true -&gt; false に変更。最初に進捗状況のファイル出力して、ファイル監視(FileSystemWatcher)クラスの変更イベントでプログレスバーの更新しようとしたのですが、プロセス処理が終わってから変更イベントが動作するので、途中経過が表示できませんでした。
どうしたものかとネットで「c# 外部プログラム 非同期」で検索してみると、標準出力を非同期で内容を読み取れることが分かり、突破口は開けました。プログレスバーの更新にBackgroundWorkerコンポーネントを使わないで、Invokeメソッドで対応しようとしたんですがなんか出来なくて諦め、今後キャンセルも考慮してそのままBackgroundWorkerコンポーネントを使うことにしました。スレッド関連の理解がまだ足りてないようです。



今勤めてる会社でGoogleDriveのお世話になってるんですが、アップロードが結構地味に手間で。
手順的にはと、こんなかんじ... まぁめんどくさいこと。
ということで２〜７をまるっとボタン１発でできないか考え、アプリをつくってみました。そんなに難しいことはしてないんですが、ちょこちょこハマったところがあるので（あとC#での事例も少なそうだったので）ポイントを共有しておきます。リポジトリはこちら
https://github.com/ambleside138/GoogleDriveSenderこんなかんじで動かします
＃キャプチャはプライベートの個人アカウントで動かしたものです
という流れ。だいぶ手数が減りました！いろいろ方法があると思うんですが、な手段を検討しました。
軽くググった結果、Windowsの右クリックメニューに用意されている「送る」メニューが比較的カスタマイズしやすい仕様だったのでこちらを利用します。ここからアプリ起動する場合、右クリックメニューの対象となっているファイルパスが第一引数として渡されているようなのでそれを利用します。GoogleDriveではファイル名ではなく独自のIDをもとにファイルを識別しているため、同一ファイルで何度もCreateメソッドを呼んでアップロードしているとドライブ上に同一名称のファイルがいくつも表示されるようになってしまいます。
そこで、同一名称のファイルがアップロード済みであれば更新処理に切り替える仕様にしました。すでにアップロードされているかどうかはFiles.List APIにファイル名を検索条件に渡してファイルの有無で判定してます。アップロードしたファイルに対して、権限変更のリクエストを送る感じに実装すればOK。Files.Create APIの戻り値で取得できるWebViewLinkプロパティが使えました。そんなこんなで、アップロード部分のロジックは↓のようになってますひとつひとつの操作は大したことないんですけど、一日に何度もやってると地味にストレス溜まってたんですよね。思ってたよりは時間かからなかった（実質２日くらい？）ので、もっと早く作ってしまっとけばよかったなぁとちょっと後悔。テンプレ作業を何度も脳死状態でやりつづけるのはプログラマにとってけしからん状態なのでこれからもバシバシ効率化していきます！



More than 1 year has passed since last update.　自室のドアが開閉した際にスマホ/PCで通知を受け取れたら面白いのでは、と思い作ってみました。【必須】
・Arduino(要Wi-Fiモジュール)
・Discordアカウント
・リードスイッチ【任意】
・HTTPサーバーを用意できる((根気||知識)&amp;&amp;サーバー機)
　ログの保存/閲覧のためにわざわざ何かこしらえるのは面倒なので、既存のチャットツールへBotに投稿させその履歴をログとします。SlackやLINEなんかもBotがあるらしいんですが今回はDiscordで実装します。　HTTPサーバーはArduinoとDiscordの仲介を担います。Arduinoから直接Discordへ投げてもいいんですが、後々の拡張性を考えて間に自前サーバーを挟んでます。　今回はWi-FiモジュールとArduino互換機が合体した「ESP-12E」を使いました。ESP8266が搭載されています。
　画像ではUNOになってますがそのあたりは心の目で見てください。
　スイッチがアナログピンに繋がっているのは完全に気まぐれです。特にこれといった理由はありません。それからESP-12Eはボード上に書かれた番号とGPIOの番号が一致しないので使う場合はそのあたり気を付けましょう。　ググって出て来たコードを切り貼りして書き足したものです。　フルカラーLED楽しいです。
インジケータつけました pic.twitter.com/vxiABrwisl
最終的にはこんな感じで取り付けます。
　こちらの記事を参考にウェブフック用のURLを取得してください。POSTリクエストでJSON投げるだけでBotがテキストチャンネルにメッセージを投稿してくれるようになります。
　DiscordにWebhookでいろいろ投稿する　
　　C#で書きました。上記で取得したURLを使います。postToDiscord()メソッド内にコピペしましょう。こんな感じで動いてくれます。
【プロトタイプ】
ドアセンサー+ロガーのプロトタイプが完成しました pic.twitter.com/WkzDbU9Jdv
【完成品】
pic.twitter.com/soA7KLPDQi　サーバープログラム起動時にエラーが発生します。　サーバーが稼働しているのにリクエストがはじかれる場合はFWの設定を疑いましょう。　動いてたのに再起動したら動かなくなったぞ、とかいう場合はたぶんIPの不一致が原因です。　今回VS2019で初めて実行ファイルを生成しようとしたんですがVS2010とかと違って勝手に生えてこないんですね。泣きそうになりながら.exeを探してました。メニューの[ビルド]から発行とやらを選択する必要があるようで。いやぁ知らんかった。今回のきったねえ配線で最後を飾りたいと思います。お疲れ様でした。
#〆のグルーガン pic.twitter.com/DVvBFJLHJC



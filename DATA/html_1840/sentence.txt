More than 1 year has passed since last update.この記事では赤い部分を作成した。
いよいよボスの実装に入るそれぞれの敵キャラを強化したものをボスにする
画面の一番上にボスの体力バーを表示するこれを参考にして作ったので今回は説明を少し端折る
qiita/SliderでHPバーを作るヒエラルキーで右クリックして[UI]→[Slider]を選択する
SliderのHandle Slide Areaはsliderのつまみの部分なので消す
sliderオブジェクトのInteractableはバーの長さをユーザーが変更できてしまうのでチェックを外す
Fill AreaとFillのRect transformの値をすべて0にするこれによってSliderでボスのHPを設定して、ボスのOnOnTriggerEnter2D内でHpBar.valueの値を減らすことで体力が減ることを表す             ボスA 　                　　　　　　↓
       ボスB(ノーマルタイプのボス)
　　　　　　                                      ↓
         ボスC(テレポートのボス)
 
　　　　　　                                      ↓
         ボスD(分散攻撃のボス)
      
              ↓
             ラスボス 　
        すべてのボスの移動は画面上部をランダムに移動して、攻撃するときだけ止まる。
ボスはプレイヤーの弾を受けたら、攻撃をうけたことが分かるように点滅するようにするここのボスはまだ簡単な攻撃を行うようにする
[攻撃1]ランダムの方向に攻撃する
[攻撃2]正面に太いビームを撃つ[攻撃1]分身を出してそれぞれの分身は固定の位置で攻撃してくる
[攻撃2]追尾してくる弾を撃つ最初は攻撃が通らず、2つのオブジェクトを破壊しないと攻撃が通らない
オブジェクトが破壊されるまでは基本的に瞬間移動してからプレイヤーに向けた弾を撃つ
[攻撃1]瞬間移動した後にプレイヤーに向けた弾を撃つ(5回くらい)
[攻撃2]5回程度瞬間移動して弾を置いていき、移動し終わったらプレイヤー方向に弾を飛ばす
[攻撃3]瞬間移動で爆弾を置いていき爆弾が爆発すると3方向に弾が飛んでいく[攻撃1]分散攻撃を連続でやってくる
[攻撃2]全方位にいくつもの弾幕(らせん状 or 等間隔)をはる(言葉で説明しずらい)
[攻撃3]弾が2段階くらい分裂するラスボスに入る前にライフを全快にして画面が赤く点滅する
ボスAの攻撃を進化させた以下の攻撃と今までのボスの攻撃をいくつかやってくる
[攻撃1]正面にビームを撃つ &amp; ランダムの方向に攻撃する
[攻撃2]分身を出してそれぞれの分身は固定の位置で攻撃してくる
[攻撃3]瞬間移動で爆弾を置いていき爆弾が爆発すると3方向に弾が飛んでいく
[攻撃4]全方位の弾幕を2つ出す
[攻撃5]瞬間移動で弾を置いていき、移動し終わったらプレイヤーに向けた弾を撃ち、弾も途中で分裂する分散攻撃を利用する
分散の数を5にしてランダムでその5方向から1方向選んで発射するほとんど分散攻撃のプログラムと変わらない
引数に分散の数とボスのtransformをいれて、ランダムの方向を決めて発射する
やりたかった動作になってくれたビームのスプライトはないので自分で以下のように作成した。
ボスの撃つ弾から四角く切り抜いた
これをある程度伸ばしてビームのスプライトとしたあまり難しいことはなく、プレファブを出現させているだけちょっとしょぼいけどこれもちゃんと実装できてよかった(移動×3回　→　通常攻撃)　×　5回　→　乱数で攻撃1か攻撃2のどちらかを選択し攻撃するこれを繰り返す上がプログラムとなり、変数cによって分身を発生させる処理を1回だけ行うようにしてあとは分身は生成された場所で弾を撃ち続け、本体はランダムの方向に弾を撃つようにする発射してから1.0秒間だけプレイヤーに向けて進む弾
ボスからプレイヤーへのベクトル = ボスBのposition　- プレイヤーのposition
これを正規化したものを6倍することによって速度を保っている簡単によけられてしまうかもしれないけどできた！基本的にはボスAと同じ
(移動×3回　→　通常攻撃)　×　5回　→　乱数で攻撃1か攻撃2のどちらかを選択し攻撃するボスCの特徴として2つのシールドを破壊しないと本体には攻撃が通らないようになっている
シールドは2つ破壊されてから60秒経つと復活する瞬間移動はtransform.Translateで移動する
(瞬間移動　→　攻撃)　×5　→　0.5秒静止ここはあまりかからなかったこの動画だと瞬間移動しないけど本来ちゃんとする弾を置いたらプレイヤーの向きになるようにする瞬間移動は上の攻撃1と同じ
移動先に弾を設置して1.0秒経ったらそれぞれの弾がプレイヤーに向かって飛んでいく上は現在地からプレイヤーまでの向きを求めてその向きに進むスクリプト
Mathf.Atan2で現在地からプレイヤーの位置までの角度をラジアンで表している
Mathf.Rad2Degはラジアンから度に変換している
角度の表し方は右を0度として半時計周りに増えていく、追跡する弾は最初真下を向いているので90度プラスすることで基準の方向を0度の方向にする必要がある
ここの説明は以下を参照したほうが分かりやすい
Hatena Blog/あるオブジェクトを指定の方向に向けるrotationは度ではなくてQuaternionという構造で表されているのでVector3のeulerをQuaternion.Eulerで変換することで向きを変えるこのようになった瞬間移動と爆弾を置く操作は上の攻撃と同じ
置かれた爆弾は1.0秒後に3方向に分散する弾を出す(瞬間移動　→　通常攻撃)　×　(2つのオブジェクトが壊れるまで)　→　乱数で攻撃1か攻撃2か攻撃3のどちらかを選択し攻撃する　→　時間経過(60秒)したら2つのオブジェクトが復活してループ分散攻撃は以前のものを利用するが、分散の中央の弾がプレイヤーの方向になるようにする
分散の数はランダムで3か5になるようにした
この攻撃も分散攻撃を改良していく
分散数を300などにしてそれぞれの弾の間隔も小さくして、次の弾を発射するまでの待機時間を0.02秒にした
これを実装するためにこの攻撃は関数ではなくてコルーチンを用いたそれっぽくなって結構感動した
てか分散攻撃が汎用性高すぎて驚いてる弾を発射した後に少し時間経過したら分裂させたかったのでコルーチンを採用した
Instantiateで作成したインスタンスを変数として保持しておき、waitForSecondsで待機させた後に分裂させた
分裂先の方向も7方向からランダムにすることで分裂できる範囲を広くさせた(移動×3回　→　通常攻撃)　×　　→　乱数で攻撃1か攻撃2か攻撃3のどちらかを選択し攻撃する　今までのボスの攻撃を組み合わせたりして改良したものが多いので、説明を省くものが多いビームはボスAのビームを利用して、同時にランダムの方向への攻撃をするようにした
これは既存のものを組み合わせただけなので説明は省くこれもボスBの攻撃において分身の数を4体にしただけボスCの攻撃2を利用して画面の右側と左側に弾を設置して時間が経つと、それぞれの弾がプレイヤーの方向に向かっていき途中で分裂する
弾が分裂するのもボスDの攻撃3を用いて、発射された弾に対してそれぞれ適用したボスDのらせん状の弾幕を2つに増やしたボスCの攻撃3を利用して画面の左右に爆弾を置き、それぞれから弾を発射したときにその弾に対してボスDの攻撃3の弾が分裂する動作を適用したこれですべての実装が終わった
このゲームが最初に作ったゲームになるが、最初とはいえ2Dのゲームでもこんなに作るのが大変だとは思わなかった
次は3Dのゲームで何か作れればと思っている



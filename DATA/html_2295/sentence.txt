More than 1 year has passed since last update.最近関わったプロジェクトで出くわしたCSV処理について、備忘の意味も込めて書きます。
恐らく今時こんな書き方をしている箇所を見ることはないだろうけど、参考までに。内容はいたってシンプルで、システムの既存機能として存在しているCSV取り込みに手を加えるというもの。
具体的には、CSVのフォーマットが変わって、取り込むデータが1列増えたので対応する。
既存のCSVはA列、B列、C列、D列というフォーマットだが、今回はB列とC列の間にBα列を追加したいとのこと。メソッド名等々は適当にぼかしてあります。ぼく「うわぁ・・・、まじかよ・・・」見ての通り取り込むCSVのフォーマットに合わせてインデックスをハードコーディングしてあるので、先に書いた通りB列とC列の間にBα列を追加するとなると、C列はdatas[2]ではなくdatas[3]になり、D列は・・・
といった風に、Bα列以降のインデックスをインクリメントしないといけなくなってくる。
もっと言うと、合計列数は4から5になるので列数不正となる条件はif(cols != 4)からif(cols != 5)になる。
まだ元々のフォーマットが4列だったから良かったものの、もしこれが10数列もあったら・・・と考えるとゾッとする。というわけで、以下のようにCSVのインデックスをenumで持たせることにしました。そんでもって、各インデックスのハードコーディング箇所を以下のように修正これなら今後対象となるCSVのフォーマットが変わっても、enumの中身を変える(追加・削除する)だけで対応できます。
もしかしたらもっといいやり方があるのかもしれない(あったら教えてください)



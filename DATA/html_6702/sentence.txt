一定時間長押しをして発火するようなボタンを作りたいということがよくあります。
ここではWPFでReactiveExtensionsを用いて次の3種類のボタンを作ります。こんな感じの拡張メソッドを先に用意します。ボタン上でマウスダウンされたらタイマー開始、マウスアップがあったら中断ですね。使う時はこんな感じです。
LongPressという名前のボタンがあると思って下さい。
この例では2秒で発火しています。上ではシンプルなのを作りましたが、Progressが見えないといつまで押せばいいのか不安になりますね。
というわけでProgressがわかるようにしましょう。途中でボタンを押すのを止めたらProgressを戻して欲しい時もあります。
一瞬で0に戻ったらびっくりしますしね。
ただ100%完了してるのに戻られても困るからその辺りも何とかしましょう。もう少しスマートに書きたいですね。Tabキー等でフォーカスを失った際にもタイマーの進行を中止させたい場合は、LostFocusを監視しましょう。ボタン上からマウスが外れた時は単純にMouseLeaveを監視すればいい、というわけにはならないのが辛いですね。
ボタンがマウスキャプチャをリリースしている必要があったりします。



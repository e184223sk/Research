More than 3 years have passed since last update.GUIアプリケーションとして通常のフローで立ち上げることができる。
しかしターミナルなどから引数を与えて立ち上げたときはそのまま標準出力に結果を返して終了する。
そういうことをmacOSアプリでやりたくなったときに参考にしてください。
方法論としてXamarin特有というわけではありませんが，ここではXamarin.Macを使って解説します。エントリポイント Main.cs で分岐します。ここで作ったサンプルは GitHub:xamarin-mac-console-sample に公開してあります。Xamarin.Macプロジェクトを適当に作ります。詳しい手順は割愛しますが，ウィンドウが立ち上がるようにしておいてください。
Main.cs はたいてい次のようになっているはずです。NSApplication.Init を呼ぶと，NSNotificationCenter.DefaultCenterやら，NSFileManager.DefaultManagerなどNS*系の静的インスタンスが確保され使えるようになります。つまり呼ばないとNS*系のなにがしかは使えたり使えなかったりします。だいたい使えません。NSApplication.Main を呼ぶとアプリケーションの起動シーケンスに入り，AppDelegateへ制御が移っていきます。その前に引数をパースして処理を分岐するのが本稿の目的とするところです。ということで適当にコマンドラインパーサーをNuGet経由で入れるなり，自前でパースするなりしましょう。ここではdotnet-corefxlabリポジトリで提供されているSystem.CommandLineを使います。雑ですがおおよそ次のようになるでしょう。プロジェクトの設定から引数を指定してデバッグする，ターミナルから引数を与えて起動するなどで動作を確認できます。ターミナルから起動したい場合は app/Contents/MacOS/ にエントリポイントがあります。

当然ながら，何も引数を与えなければウィンドウが立ち上がり，通常のアプリとして振る舞います。Main.cs で起動前になんでもできることがわかりました。
ネイティブライブラリを読み込んでおいたり集約例外ハンドラを設置したりと，それなりのアプリケーションを作る際にはこの辺でいろいろ介入が必要になってくると思います。ぜひ覚えておいてください。



More than 1 year has passed since last update.Excel VBAからpost経由でGASに日本語を送りつけたい。
転送データは最終的にスプレッドシートに保存する。GASのREST APIを使ってpostできるが、英数字のみ送信可能。
BASE64とか使えよって話なんだけどね。Excel VBAから送る要件があったのと、GAS側であまり処理時間かけたくなかったので簡易的な実装を行った。
VBAから直接日本語を送ると、Shift-JISなのでGAS側で文字として扱えない。
そこでGAS(というよりもJSの内部表現の話)で使っているUTF-16に変換する必要がある。VBAでは.Netの処理がフルに使えないので、C#でサクっと作成。intにキャストするだけでコードユニットとれるって便利。
参考にした記事注意点は
・インターフェースを実装する事
・できたライブラリを64bitなのか32bitかで合わせてレジストリに登録する事登録したDLLを呼び出して使う。注意点は
postのパラメータ名(data=とか)の部分は変換しない。
GASで受け取れなくなるので。参考文献受け取ったコードユニットを4文字毎に切り出して、String.fromCharCode()を使う。日本語のやり取りはできるようになったけど、どうしても転送量が増えてしまう。
一回で済んでたところを、分割して送信せなあかん場合もある。
zipかなにかしてやりたい。
あとは、コードユニットに変換しただけでほぼ平文なので、重要な情報を扱う際には何かしら暗号化もしてあげればよいかなーと思う。



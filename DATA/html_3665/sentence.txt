More than 1 year has passed since last update.アプリのスクリーンショットをpngファイルにするマクロ。
事前にC#をビルドする必要あり。アプリのスクリーンショット画像をセルに書いてあるファイル名で保存したい。
「スクリーンショットを取ってExcelに貼り付ける」記事は調べると出てくる。が、ちょっと違う。コレジャナイ。Excelだけでクリップボードからpngファイル化する例はほとんど見つけられませんでした。
近いのは・・・ペイント(mspaint.exe), ADODB, SendKeysを駆使したです。C#でクリップボード→pngファイルを組んでしまったほうが安定するかな・・・と考えて, C#でコンソールぽく実装します(作り方はフォームアプリ)。最小化されている場合, AppActivateだけではアプリ画面が最前面化されないようです。そこで, Word Taskオブジェクトを使って, ウィンドウの状態を標準に戻してからアクティブにしています。よく考えると, objWord.Tasks()にActivateメソッドがあるんだった・・・以下でよかったかな。。。Windows10のアニメーション効果が有効だと, AppActivate後に少しWaitを入れないとダメなようです。
「アニメーション後」を取る方法がなさそうだったのでSleepでアクティブ待ちをしています。objWord.Tasks(APP_TITLE)は部分一致でいける一方でAppActivateは完全なタイトルバーの文字列(プロセスのフレンドリ名?)でないとダメなようです。objWord.Tasks(APP_TITLE).Nameで取得したものAppActivateに渡します。xlsmと同じフォルダに「get_clipboard_image.exe」が置かれることを決めうちした実装になっています。png出力先も「xlsmと同じフォルダ」の決めうちです。ファイル名だけ選択したセルからとってきています。を変更することでスクリーンショットを取るアプリを変更できます。この記事ではHTAで作成したダミーアプリをターゲットにしています。簡単化のため, マクロ呼び出しごとに各種オブジェクトを生成＋破棄してますが、 実際使うときはWorkBookを開いたときに生成してそれを使いまわす形がいいです。
※ 概要の動画gifのように特に最初のスクリーンショットが重くなる。objWord.Tasks(APP_TITLE)は部分一致で判定しているので, 似ているタイトルのアプリがいるとうまく動作しない可能性があります。objWord.Tasks(APP_TITLE)をFor Eachでまわして, フルネームを判定に使えばもう少しマシになると思います。コンソール画面が出ると気になるので「何もフォームを作らないフォームアプリ」を作成します。
プロジェクト作成時は「Windowsフォームアプリケーション」を指定し, プロジェクト名を「get_clipboard_image」とします。
ソリューションエクスプローラでProgram.csを開きます。
これを以下のコードで置き換えます。「Release」「Any CPU」でビルドすればget_clipboard_image.exeができます。
xlsmと同じフォルダにおいてください。ダミーのターゲットアプリ。
なんでもよかったので古の技術HTA
テキストエディタに貼り付けて「target.hta」で保存すれば終わりです。ダミーのターゲットアプリは、「&lt;html&gt;&lt;head&gt;&lt;title&gt;ターゲット&lt;/title&gt;&lt;/head&gt;&lt;/html&gt;」の一行だけでもいいですし, 「ターゲット.txt」をメモ帳で開いても代替できます。[C#] クリップボードからビットマップ形式のデータを拾って、連番でフォルダに保存する - Moonmile Solutions Blog画面をキャプチャする - moug モーグExcel シートにスクリーンショットを自動貼り付けするマクロ - Corredorエビデンス取得マクロツール(スクリーンショットキー押すだけ) - Qiita画面のスクリーンショットを，Excelブック内に自動的に保存するバッチ - 主に言語とシステム開発に関して.html画面をコマンドラインからキャプチャする方法　（WSHバッチでPrintScreen）- 主に言語とシステム開発に関してAppActivate ステートメント (VBA) - Microsoft DocsスクショをExcelに張り付けるのに役立つ4つのテクニック (2_3)：テストエビデンス取得自動化の秘技（後編）- ＠ITMicrosoft Office を使用した実際のスクリプト作成 - gallery.technet.microsoft.com第10回 HTAでフォームを利用したサンプルを作る - 日経 xTECHPython(pywin32)でWordを操作する[6] - 特定のタイトルが付いているウィンドウの操作



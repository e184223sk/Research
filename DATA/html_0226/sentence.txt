WindowsでC#を使いキーボードのフックする方法を記述します。キーボードの入力をPCに発信するものをキャッチし
それを無効にしたり別のキーに置き換えたりするなどの用途で使用します。 ここの発信をフックする。捨てたり、監視したり、別のものにしたりなど。以下のコードでキーボード入力をフックします。プログラム実行中、全てのキー入力が捨てられます。
フックしたキーはHookCallbackの第3引数、lParamで識別ができます。上記の1を戻すところを1以外にすると、そのまま入力がされます。
ということは、このコードだけだとただ監視するだけのプログラムになります。HookCallbackの第2引数、wParamで識別ができます。
大体は押した時で何か処理をさせることが多いでしょう。以下のプログラムを実行すると、キーボードを入力していないのにJキーを出力します。上記のようにキーを押していないのにプログラムでキーを出力すると物理的にはキーを離す
ということができません。
そのため、キーを離す出力をする必要があります。
以下でJキーを3秒間だけ押した時と同様の出力をします。組み合わせを行い、JキーをUキーとして入れ替えるような処理が以下になります。極力最小形でシンプルな記述にしましたがどうだったでしょうか。
この仕組みがわかれば、キーの入れ替え、マクロで自動化などができそうです。



<!DOCTYPE html><html><head><meta charset="utf-8" /><title>HoloLensでTranslator Speech APIを使ったリアルタイム翻訳 -その3 HoloLensでテロップ表示 - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><meta content="telephone=no" name="format-detection" /><link rel="canonical" href="https://qiita.com/miyaura/items/6f2570fe0dc0a8b0b7f1" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link as="script" href="https://www.googletagservices.com/tag/js/gpt.js" rel="preload" /><link href="https://securepubads.g.doubleclick.net" rel="preconnect" /><script async="" src="https://www.googletagservices.com/tag/js/gpt.js"></script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="A3rKuXfMqwU7mTglffSxJGV0QDy0KbsfKo7v43kwpdH+tShomk9vYx6YkOtWOWH+WRpbTcfMfuqxk88dXpvM2Q==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/article-2eaa7dbedc42a8ea65c722cda46d0ebb.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-article-bundle-63de2d91fef827269d3f6b958db2335b.min.js" defer="defer"></script><meta name="twitter:card" content="summary_large_image"><meta content="@Qiita" name="twitter:site" /><meta content="@takabrz1" name="twitter:creator" /><meta property="og:type" content="article"><meta property="og:title" content="HoloLensでTranslator Speech APIを使ったリアルタイム翻訳 -その3 HoloLensでテロップ表示 - Qiita"><meta property="og:image" content="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0&amp;w=1200&amp;mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1TRzlzYjB4bGJuUGpnYWRVY21GdWMyeGhkRzl5SUZOd1pXVmphQ0JCVUVuamdwTGt2Yl9qZ2FQamdaX2pnNnJqZ3FMamc2dmpncl9qZ3FUamc2RG52N3ZvcUxNZ0xlT0JuZU9CcmpNZ1NHOXNiMHhsYm5QamdhZmpnNGJqZzYzamc0UGpnNWZvb2FqbnBMbyZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTU0JnR4dC1jbGlwPWVsbGlwc2lzJnR4dC1hbGlnbj1jZW50ZXIlMkNtaWRkbGUmcz1iYzdhNTQxZDdiZGIwY2NjNTljNTRiNTNmZTYxOTJhMQ&amp;mark-align=center%2Cmiddle&amp;blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RRzFwZVdGMWNtRSZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTQ1JnR4dC1hbGlnbj1yaWdodCUyQ2JvdHRvbSZzPTI5NmRhNjQ5ZDFkMTEzYjZiZjI5NTdmNDlkNjcwMGI0&amp;blend-align=center%2Cmiddle&amp;blend-mode=normal&amp;s=194272150c39eff2af71159ce16b63da"><meta property="og:description" content="

HoloLensでリアルタイム翻訳

前回、前々回で紹介した方法を使い、HoloLensでリアルタイム翻訳を実施します。構築したアプリケーションとしては、以下の機能を有するものです。


翻訳したい言語、翻訳後の言語、合成音声出す..."><meta content="https://qiita.com/miyaura/items/6f2570fe0dc0a8b0b7f1" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="C#,VisualStudio2015,UWP,HoloLens" name="keywords" /><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '668972150489891');
fbq('track', 'PageView');</script><style data-emotion-css="17jxvjw 11t2ec1 1dvr2p8 18lkoru 1g4cku8 1iupg5d ijvq0v 15cocm3 12rp90f 115f4t 1b8uj5v 79elbk 16hhh7b fcbn8c 1gj7nt 154zy0m yikrym 1jqivyb 1ode1bp le4d8r 1hbd3g7 1nzh4zz 38fzdi helsa7 8qb8m4 2imjyh he5w1s 70qvj9 3ojehk 100alwu 1dtnjt5 10ougpm 1ay9vb9 m19uds cgzq40 1wa99t2 1l3zk9f 4czcte 1yzj1fm 1uv1qiv 109dbrr 5jpx49 mnxgyc 1vlpknv fsjkhv 1b17vb0 7i7f4d"}>.css-17jxvjw{display:grid;display:-ms-grid;grid-template-columns:80px minmax(0,1fr) 300px;-ms-grid-columns:80px minmax(0,1fr) 300px;grid-template-rows:minmax(270px,auto) 1fr;-ms-grid-rows:minmax(270px,auto) 1fr;max-width:1280px;margin-right:auto;margin-left:auto;padding-top:24px;padding-right:24px;padding-left:24px;}@media (max-width:1200px){.css-17jxvjw{padding-bottom:0;padding-left:0;padding-right:0;}}@media (max-width:992px){.css-17jxvjw{grid-template-columns:80px 452px 300px;-ms-grid-columns:80px 452px 300px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}}@media (max-width:770px){.css-17jxvjw{display:block;}}@media (max-width:480px){.css-17jxvjw{padding-top:0;}}.css-11t2ec1{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:5;position:-webkit-sticky;position:sticky;top:calc(56px + 24px + 16px + 32px - 16px);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:16px;width:80px;}.css-11t2ec1:after{content:'';display:table;}.css-11t2ec1:before{content:'';display:table;}@media (max-width:770px){.css-11t2ec1{display:none;}}.css-1dvr2p8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-18lkoru{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;background-color:#FFFFFF;}.css-1g4cku8{display:inline-block;vertical-align:middle;height:20px;width:20px;fill:#55C500;}.css-1iupg5d{color:#55C500;cursor:pointer;font-size:14px;font-weight:bold;}.css-ijvq0v{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;margin-bottom:16px;}.css-15cocm3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#FFFFFF;border:2px solid #6E6F70;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:2px 0px 0px;width:40px;}.css-12rp90f{display:inline-block;vertical-align:bottom;height:17.77777777777778px;width:16px;fill:#6E6F70;}.css-115f4t{color:#6E6F70;font-size:14px;font-weight:bold;}.css-1b8uj5v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;margin-bottom:16px;padding:0;}.css-79elbk{position:relative;}.css-16hhh7b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;font-size:20px;height:32px;outline:none;width:32px;padding:0;}.css-fcbn8c{display:none;bottom:initial;left:initial;right:initial;top:initial;left:100%;top:calc(-8px - (14px * 1.8) - 16px - 4px);}.css-1gj7nt{color:rgba(0,0,0,0.6);font-size:14px;font-weight:bold;line-height:1.8;padding:8px 16px;}.css-154zy0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.87);cursor:pointer;font-size:16px;font-weight:normal;line-height:1.8;padding:4px 16px;}.css-154zy0m:hover{-webkit-text-decoration:none;text-decoration:none;background-color:#F2F2F2;}.css-yikrym{width:20px;}.css-1jqivyb{color:rgba(0,0,0,0.6);font-size:13px;}.css-1ode1bp{background-color:rgba(0,0,0,0.12);height:1px;width:100%;margin:8px 0;}.css-le4d8r{display:inline-block;vertical-align:middle;height:13px;width:13px;fill:rgba(0,0,0,0.6);}.css-1hbd3g7{height:250px;}.css-1nzh4zz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:16px 32px;background-color:#FBE69E;color:rgba(0,0,0,0.87);line-height:1.5;font-weight:600;}@media (max-width:770px){.css-1nzh4zz{padding:16px;}}.css-38fzdi{color:#CA832A;margin-right:4px;}.css-helsa7{background-color:#FFFFFF;padding:32px;margin-bottom:24px;}@media (max-width:992px){.css-helsa7{margin:0 auto 40px;}}@media (max-width:480px){.css-helsa7{margin:0 0 40px;padding:32px 16px;}}.css-8qb8m4{margin-bottom:48px;}.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-he5w1s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;}@media (max-width:770px){.css-he5w1s{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-3ojehk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:4px;}.css-100alwu{display:inline-block;border-radius:50%;line-height:1;overflow:hidden;vertical-align:middle;}.css-1dtnjt5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-10ougpm{color:rgba(0,0,0,0.87);font-size:14px;font-weight:600;line-height:1.8;margin-right:4px;text-wrap:break-word;word-break:break-all;}.css-1ay9vb9{margin-right:16px;}.css-m19uds{color:rgba(0,0,0,0.6);font-size:14px;line-height:1.8;}.css-cgzq40{color:rgba(0,0,0,0.87);font-size:32px;font-weight:bold;line-height:1.4;margin-top:8px;text-wrap:break-word;word-break:break-all;}.css-1wa99t2{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(0,0,0,0.6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:8px;}.css-1l3zk9f{color:rgba(0,0,0,0.6);font-size:20px;margin-right:8px;}.css-4czcte{margin-right:4px;color:inherit;font-size:14px;line-height:1.8;}.css-4czcte:not(:last-child)::after{content:',';margin-right:4px;}.css-1yzj1fm{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:32px;}.css-1uv1qiv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:none;color:#6E6F70;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:20px;height:32px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-right:16px;outline:none;padding:0;width:32px;}.css-109dbrr{background-color:#F9F9F9;border-top:1px solid rgba(0,0,0,0.12);bottom:0;box-shadow:0px 1px 4px rgba(0,0,0,0.14);display:none;height:calc(env(safe-area-inset-bottom,0px) + 56px);-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-bottom:env(safe-area-inset-bottom);position:-webkit-sticky;position:sticky;width:100%;z-index:2000;}@media (max-width:770px){.css-109dbrr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-5jpx49{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;width:100%;}.css-mnxgyc{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1vlpknv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:2px solid #55C500;border-radius:50%;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:40px;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;padding:0;width:40px;margin-right:4px;background-color:#FFFFFF;}.css-fsjkhv{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-appearance:none;-moz-appearance:none;appearance:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;outline:none;}.css-1b17vb0{color:#6E6F70;font-size:14px;font-weight:bold;margin-left:4px;}.css-7i7f4d{display:none;bottom:initial;left:initial;right:initial;top:initial;bottom:32px;right:0;}</style></head><body><div class="allWrapper"><div><div id="GlobalHeader-react-component-d48fade6-ac18-4fbb-8957-7142414a4f33"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div class="st-Header_communitySelector" tabindex="0"><span class="fa fa-caret-down"></span></div><div class="st-Header_dropdown"><div class="st-Header_dropdownHeading">Qiita Teams that are logged in</div><div class="st-Header_dropdownItemNote">You are not logged in to any team</div><hr class="st-Header_dropdownDivider st-Header_dropdownDivider-shrink"/><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem"><span class="fa fa-fw fa-sign-in st-Header_dropdownItemIcon"></span><div>Log in to Qiita Team</div></a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Community</div><a href="/organizations" class="st-Header_dropdownItem">Organization</a><a href="/official-events/open" class="st-Header_dropdownItem">Event</a><a href="/advent-calendar" class="st-Header_dropdownItem">Advent Calendar</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank">Qiitadon (β)</a><div class="st-Header_dropdownDivider"></div><div class="st-Header_dropdownHeading">Service</div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Jobs</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Zine</a><a href="https://blog.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank">Qiita Blog</a></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search st-Header_searchIcon"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div><div class="st-Header_end"><div class="st-Header_searchButton"><span class="fa fa-search"></span></div><a class="st-Header_signupButton" href="/signup?redirect_to=%2Fmiyaura%2Fitems%2F6f2570fe0dc0a8b0b7f1">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Fmiyaura%2Fitems%2F6f2570fe0dc0a8b0b7f1">Login</a></div><div class="st-Header_overlay"></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-d48fade6-ac18-4fbb-8957-7142414a4f33">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/csharp","name":"C#"}}]}</script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","datePublished":"2017-05-19T12:37:59.000+09:00","dateModified":"2017-05-19T12:37:59.000+09:00","headline":"HoloLensでTranslator Speech APIを使ったリアルタイム翻訳 -その3 HoloLensでテロップ表示","image":"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-4.0.0\u0026w=1200\u0026mark64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTM4MCZ0eHQ2ND1TRzlzYjB4bGJuUGpnYWRVY21GdWMyeGhkRzl5SUZOd1pXVmphQ0JCVUVuamdwTGt2Yl9qZ2FQamdaX2pnNnJqZ3FMamc2dmpncl9qZ3FUamc2RG52N3ZvcUxNZ0xlT0JuZU9CcmpNZ1NHOXNiMHhsYm5QamdhZmpnNGJqZzYzamc0UGpnNWZvb2FqbnBMbyZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTU0JnR4dC1jbGlwPWVsbGlwc2lzJnR4dC1hbGlnbj1jZW50ZXIlMkNtaWRkbGUmcz1iYzdhNTQxZDdiZGIwY2NjNTljNTRiNTNmZTYxOTJhMQ\u0026mark-align=center%2Cmiddle\u0026blend64=aHR0cHM6Ly9xaWl0YS11c2VyLWNvbnRlbnRzLmltZ2l4Lm5ldC9-dGV4dD9peGxpYj1yYi00LjAuMCZ3PTg0MCZoPTUwMCZ0eHQ2ND1RRzFwZVdGMWNtRSZ0eHQtY29sb3I9JTIzMzMzJnR4dC1mb250PUhpcmFnaW5vJTIwU2FucyUyMFc2JnR4dC1zaXplPTQ1JnR4dC1hbGlnbj1yaWdodCUyQ2JvdHRvbSZzPTI5NmRhNjQ5ZDFkMTEzYjZiZjI5NTdmNDlkNjcwMGI0\u0026blend-align=center%2Cmiddle\u0026blend-mode=normal\u0026s=194272150c39eff2af71159ce16b63da","mainEntityOfPage":"https://qiita.com/miyaura/items/6f2570fe0dc0a8b0b7f1","author":{"@type":"Person","address":"Nara, Japan","email":null,"identifier":"miyaura","name":"miyaura","image":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F152548%2Fprofile-images%2F1616018241?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=61c4f9412b9ce18c58a30ab1b3cc989e","url":"https://qiita.com/miyaura","description":"C#ベース。現在はMR関連の技術に興味あり。\r\nMicrosoft MVP for Windows Development(2018-2022)","memberOf":[]},"publisher":{"@type":"Organization","name":"Qiita","logo":{"@type":"ImageObject","url":"//cdn.qiita.com/assets/public/qiita-logo-c39ded593afa388e2e1ba435b110554e.png"}}}</script><style type="text/css">.wb-CampaignLink {
  background-color: #333333;
  width: 100%;
}

.wb-CampaignLink_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  max-width: 1100px;
  margin: 0 auto;
  font-size: 13px;
  padding: 0.8em;
}
.wb-CampaignLink_container > a {
  color: #fff;
}

.wb-CampaignLink_container > a:hover {
  text-decoration: underline;
}</style><div class="wb-CampaignLink"><div class="wb-CampaignLink_container"><a target="_blank" id="header_text_message_1" href="https://increments.connpass.com/event/211948/">【9/9(木)開催】Qiitaの過去と未来についてお話しします！Qiita エンジニアフェスタ 2021 Online Meetup</a><a target="_blank" id="header_text_message_2" href="https://increments.connpass.com/event/211948/">詳しくはこちら</a></div><script>td.trackEvent(
  'front_events',
  {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"miyaura","type":"items","id":"6f2570fe0dc0a8b0b7f1"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Show","data":{"message":"【9/9(木)開催】Qiitaの過去と未来についてお話しします！Qiita エンジニアフェスタ 2021 Online Meetup","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
)</script><script>document.getElementById('header_text_message_1').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"miyaura","type":"items","id":"6f2570fe0dc0a8b0b7f1"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":2,"pos_id":"header_text_message_1","message":"【9/9(木)開催】Qiitaの過去と未来についてお話しします！Qiita エンジニアフェスタ 2021 Online Meetup","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script><script>document.getElementById('header_text_message_2').addEventListener('click', function() {
  td.trackEvent(
    'front_events',
    {"query_parameters":{},"path_parameters":{"controller":"public/items","action":"show","user_id":"miyaura","type":"items","id":"6f2570fe0dc0a8b0b7f1"},"user_id":null,"event_category":"Header Text Ads Banner","event_action":"Click","data":{"index":2,"pos_id":"header_text_message_2","message":"【9/9(木)開催】Qiitaの過去と未来についてお話しします！Qiita エンジニアフェスタ 2021 Online Meetup","url":"https://increments.connpass.com/event/211948/","sub_message":"詳しくはこちら"}}
  )
})</script></div><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/miyaura/items/6f2570fe0dc0a8b0b7f1","location":"/miyaura/items/6f2570fe0dc0a8b0b7f1","scheme":"https","host":"qiita.com","port":null,"pathname":"/miyaura/items/6f2570fe0dc0a8b0b7f1","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","assetsMap":{},"csrfToken":"ME9OLzhZfqqq+9Mc4kcEfbWUFtLCy1PjIMeLw6sb73vNgKz+1dq6zI/6e9LJitSnifoNo7Eulha72qs9jLCGcw==","locale":"en"},"currentUser":null,"isLoggedIn":false,"recaptchaSiteKey":"6LfNkiQTAAAAAM3UGnSquBy2akTITGNMO_QDxMw6","serverSide":false}</script>
<div id="PersonalArticlePage-react-component-6ee26546-8b2e-4059-8cce-170d2d6bcfdb"><div class="p-items_wrapper"><div class=" css-17jxvjw"><div class="css-11t2ec1"><div class="css-1dvr2p8"><button class=" css-18lkoru"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/miyaura/items/6f2570fe0dc0a8b0b7f1/likers" class="css-1iupg5d">4</a></div><div class="css-ijvq0v"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-115f4t">5</span></div><div class="css-1b8uj5v"><span class="fa fa-twitter"></span></div><div class="css-1b8uj5v"><span class="fa fa-facebook"></span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-fcbn8c"><div class="css-1gj7nt">Improve article</div><a href="/drafts/6f2570fe0dc0a8b0b7f1/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/miyaura/items/6f2570fe0dc0a8b0b7f1/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/miyaura/items/6f2570fe0dc0a8b0b7f1/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/miyaura/items/6f2570fe0dc0a8b0b7f1/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/miyaura/items/6f2570fe0dc0a8b0b7f1.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div><div class="p-items_options"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_toc"><div class="mt-2"><div class="css-1hbd3g7"></div></div></div><div class="p-items_main"><div class="css-1nzh4zz"><span class="fa fa-fw fa-warning css-38fzdi"></span><p>More than 3 years have passed since last update.</p></div><div class="css-helsa7"><div class="css-8qb8m4"><div class="css-2imjyh"><div class="css-he5w1s"><div class="css-70qvj9"><div class="css-3ojehk"><a href="/miyaura"><img class="css-100alwu eyfquo10" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/152548/profile-images/1616018241" width="24" height="24" loading="lazy"/></a></div><div class="css-1dtnjt5"><a href="/miyaura" class="css-10ougpm">@<!-- -->miyaura</a><div class="css-1ay9vb9"><time dateTime="2017-05-19T03:37:59Z" class="css-m19uds">posted at 2017-05-19</time></div></div></div></div></div><h1 class="css-cgzq40">HoloLensでTranslator Speech APIを使ったリアルタイム翻訳 -その3 HoloLensでテロップ表示</h1><div class="css-1wa99t2"><span class="fa fa-tags mr-1of2 css-1l3zk9f" aria-hidden="true"></span><a href="/tags/csharp" class="css-4czcte">C#</a><a href="/tags/visualstudio2015" class="css-4czcte">VisualStudio2015</a><a href="/tags/uwp" class="css-4czcte">UWP</a><a href="/tags/hololens" class="css-4czcte">HoloLens</a></div></div><section class="it-MdContent"><div id="personal-public-article-body"><div>
<h1>
<span id="hololensでリアルタイム翻訳" class="fragment"></span><a href="#hololens%E3%81%A7%E3%83%AA%E3%82%A2%E3%83%AB%E3%82%BF%E3%82%A4%E3%83%A0%E7%BF%BB%E8%A8%B3"><i class="fa fa-link"></i></a>HoloLensでリアルタイム翻訳</h1>

<p><a href="http://qiita.com/miyaura/items/e50183be18e3bf8f70e0" id="reference-a9f45e7152b49739475a">前回</a>、<a href="http://qiita.com/miyaura/items/febee8ca6f9050c9ff26" id="reference-a7b5521a5a6ad8f8cb6f">前々回</a>で紹介した方法を使い、HoloLensでリアルタイム翻訳を実施します。構築したアプリケーションとしては、以下の機能を有するものです。</p>

<ol>
<li>翻訳したい言語、翻訳後の言語、合成音声出すかをUIで設定</li>
<li>レコーディング開始を実行するとリアルタイム翻訳開始</li>
<li>レコーディングを止めるまでマイクの音声を集約する。</li>
<li>翻訳できたデータはHoloLens上でテロップ＆音声出力</li>
</ol>

<p>以上のような簡単なものです。ただ、実をいうと音声出力はよくないと思います。というのも、スピーカーから出すとマイクで集音されてしまうのでただの雑音になり精度を下げる要因になります。お試しで使う形になるかと思います。動作させるとこのような形で動きます。</p>

<blockquote class="" data-lang="ja">
<p>とりあえずの最終版のHoloLensリアルタイム翻訳アプリの動作状況。現状のTranslator Speech APIが使えると思われる設定だと音声品質の問題で認識率が落ちてる気がします。<a href="https://twitter.com/hashtag/HoloLensJP?src=hash" rel="nofollow noopener" target="_blank">#HoloLensJP</a> <a href="https://t.co/xBww80Ch6N" rel="nofollow noopener" target="_blank">pic.twitter.com/xBww80Ch6N</a></p>— takabrz (@takabrz1) <a href="https://twitter.com/takabrz1/status/864531865746554880" rel="nofollow noopener" target="_blank">2017年5月16日</a>
</blockquote>



<h2>
<span id="今回の環境" class="fragment"></span><a href="#%E4%BB%8A%E5%9B%9E%E3%81%AE%E7%92%B0%E5%A2%83"><i class="fa fa-link"></i></a>今回の環境</h2>

<p>環境については以下の通りです。</p>

<ul>
<li>IDE

<ul>
<li>Unity 5.5.0f3</li>
<li>Visual Studio 2015 update 3 Community Edition</li>
</ul>
</li>
<li>ライブラリ関連

<ul>
<li>HoloToolkit-Unity 1.5.5.0</li>
<li>Naudio 1.8.8.0(合成音声の再生のみで利用)</li>
</ul>
</li>
</ul>

<h2>
<span id="実装について" class="fragment"></span><a href="#%E5%AE%9F%E8%A3%85%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>実装について</h2>

<p><a href="http://qiita.com/miyaura/items/e50183be18e3bf8f70e0">前回</a>、<a href="http://qiita.com/miyaura/items/febee8ca6f9050c9ff26">前々回</a>でライブラリ化しているので、実態としてはそれをそのまま利用する形になります。ただ、音声については多少の加工を行っているのでそのあたりを紹介したいと思います。</p>

<ol>
<li>Unityでの実装(UI)</li>
<li>音声処理の実装</li>
<li>UWP側の実装(<a href="http://qiita.com/miyaura/items/febee8ca6f9050c9ff26">前々回</a>作成のライブラリを参照したアプリの実装）</li>
</ol>

<h3>
<span id="事前作業について" class="fragment"></span><a href="#%E4%BA%8B%E5%89%8D%E4%BD%9C%E6%A5%AD%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>事前作業について</h3>

<p>事前作業としてAzureのCognitive Serviceとして「Translator Speech API」の追加を行ってください。追加後SubscriptionKeyの控をお忘れなく。</p>

<h4>
<span id="1-unityでの実装ui" class="fragment"></span><a href="#1-unity%E3%81%A7%E3%81%AE%E5%AE%9F%E8%A3%85ui"><i class="fa fa-link"></i></a>1. Unityでの実装(UI)</h4>

<p>UnityのUIとしては3つのパラメータの設定、翻訳のスタート＆ストップです。<br>
パラメータについてはそれぞれ以下の情報を設定します。</p>

<table>
<thead>
<tr>
<th style="text-align: center">query</th>
<th style="text-align: center">設定値</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center">from</td>
<td style="text-align: center">入力する音声の言語</td>
</tr>
<tr>
<td style="text-align: center">to</td>
<td style="text-align: center">翻訳する言語</td>
</tr>
<tr>
<td style="text-align: center">voice</td>
<td style="text-align: center">合成音声のId</td>
</tr>
</tbody>
</table>

<p>合成音声を返さない場合は未設定とします。それぞれのパラメータは<a href="http://qiita.com/miyaura/items/febee8ca6f9050c9ff26#2-%E3%82%B5%E3%83%9D%E3%83%BC%E3%83%88%E8%A8%80%E8%AA%9E%E3%81%AE%E5%8F%96%E5%BE%97" id="reference-a7b5521a5a6ad8f8cb6f">前々回の「2. サポート言語の取得」</a>でえられるデータのIDに相当する値となります。<br>
今回は適当にこんなUIにしてみました。<br>
<a href="https://camo.qiitausercontent.com/24362178f966d0e64ea3031523f64c0f97d9c3d7/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3135323534382f63616537353266642d363766342d363231652d306334322d3066336564363533376663632e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F152548%2Fcae752fd-67f4-621e-0c42-0f3ed6537fcc.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=919b302a573ee961db5e9239f0660417" alt="image.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/152548/cae752fd-67f4-621e-0c42-0f3ed6537fcc.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F152548%2Fcae752fd-67f4-621e-0c42-0f3ed6537fcc.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=c2fade46396405040e498075d3c286d4 1x" loading="lazy"></a></p>

<p>また、翻訳結果をテロップ表示するためのテキストも用意します。のちに作るMicrophoneInput.csの中で利用するものでサンプルでは「TranslateText」としてprefabにしています。表示後少ししてから上に移動しながらフェードアウトするように処理を入れています。</p>

<p>上記はいずれもnGUIでつくりました。Canvasの設定については操作系はTagalongを利用しました。テロップはカメラ追従で実装しています。</p>

<h4>
<span id="2-音声処理の実装" class="fragment"></span><a href="#2-%E9%9F%B3%E5%A3%B0%E5%87%A6%E7%90%86%E3%81%AE%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>2. 音声処理の実装</h4>

<h5>
<span id="オブジェクトの設定" class="fragment"></span><a href="#%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>オブジェクトの設定</h5>

<p>次にマイクからの集音処理部分の実装です。<br>
UnityのHierarchyで「create」-「Audio」-「Audio Source」を選択し「Audio Source」を追加します。あと、Projectで「create」-「Audio Mixer」を選択し「Audio Mixer」も追加します。<br>
まず、「Audio Mixer」-「Master」を選択し、Inspectorの設定項目「Volume」を-80dbに設定します。<br>
<a href="https://camo.qiitausercontent.com/ae2c9833451249f08581af2d8a654fb72d6680d9/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3135323534382f34633439396166622d663733312d363239632d626134632d3631343939663261386638372e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F152548%2F4c499afb-f731-629c-ba4c-61499f2a8f87.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=81ebe2fe29c7224a0f97890eb0d205cf" alt="image.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/152548/4c499afb-f731-629c-ba4c-61499f2a8f87.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F152548%2F4c499afb-f731-629c-ba4c-61499f2a8f87.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=e6f7d1ad4fba6adb0e485a6d3a554fa9 1x" loading="lazy"></a></p>

<p>次にHierarchyで「Audio Source」を選択し、Inspectorの設定項目「output」に先ほどの「Master」をドラッグ＆ドロップします。これはスピーカーから自分のマイク音声を出力しないための設定です。なお「Audio Clip」については後でプログラム側で設定するのでそのままにしておきます。<br>
<a href="https://camo.qiitausercontent.com/f8b0f1cef858208af1e0d8c5e07fca5f89e7074a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3135323534382f66346430396366652d643662352d353136382d303961302d3136396133646434313633312e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F152548%2Ff4d09cfe-d6b5-5168-09a0-169a3dd41631.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=2f734f50b9fe6c5acf139c9a6d03c834" alt="image.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/152548/f4d09cfe-d6b5-5168-09a0-169a3dd41631.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F152548%2Ff4d09cfe-d6b5-5168-09a0-169a3dd41631.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=8a1c7d1cdbf7a7099e628f468baa81fb 1x" loading="lazy"></a></p>

<h5>
<span id="初期化処理" class="fragment"></span><a href="#%E5%88%9D%E6%9C%9F%E5%8C%96%E5%87%A6%E7%90%86"><i class="fa fa-link"></i></a>初期化処理</h5>

<p>次に「Audio Source」の処理を書きます。Project内にC#Scpirtを作成します。<br>
Startメソッドでは、<a href="http://qiita.com/miyaura/items/febee8ca6f9050c9ff26">前々回</a>のUWPのサンプルコードを参考にTranslator Speech APIのサービスへの接続処理を書きます。<br>
UWPで作ったプロジェクト（Com.Reseul.Apis.Services.CognitiveService.Translators.UWPプロジェクト）をそのまま利用するのが楽ですが、この場合一旦Unityでビルドを行いUWPに変換してから追記する必要があります。</p>

<h5>
<span id="翻訳結果の表示" class="fragment"></span><a href="#%E7%BF%BB%E8%A8%B3%E7%B5%90%E6%9E%9C%E3%81%AE%E8%A1%A8%E7%A4%BA"><i class="fa fa-link"></i></a>翻訳結果の表示</h5>

<p>翻訳結果の表示については<a href="http://qiita.com/miyaura/items/febee8ca6f9050c9ff26">前々回</a>のUWPのサンプルコードを参考にサービスの翻訳結果のうちJSONの内容を加工し「TranslateText」をインスタンス化して<br>
画面に表示します。</p>

<h5>
<span id="マイクの集音開始終了及びデータの送信" class="fragment"></span><a href="#%E3%83%9E%E3%82%A4%E3%82%AF%E3%81%AE%E9%9B%86%E9%9F%B3%E9%96%8B%E5%A7%8B%E7%B5%82%E4%BA%86%E5%8F%8A%E3%81%B3%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E9%80%81%E4%BF%A1"><i class="fa fa-link"></i></a>マイクの集音開始/終了及びデータの送信</h5>

<p>次にマイクからの集音開始と終了及びデータの送信部分を作成します。</p>

<h6>
<span id="マイクの集音開始" class="fragment"></span><a href="#%E3%83%9E%E3%82%A4%E3%82%AF%E3%81%AE%E9%9B%86%E9%9F%B3%E9%96%8B%E5%A7%8B"><i class="fa fa-link"></i></a>マイクの集音開始</h6>

<p>マイクの集音開始については以下のように実装します。このメソッドは先ほど作ったUIのStartボタンで呼び出されるように実装します。<br>
処理内容としては<a href="http://qiita.com/miyaura/items/e50183be18e3bf8f70e0">前回</a>と同じ実装内容になります。今回はHolotoolkit-Unityは使用せずにUnityのみで実現しています。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">MicrophoneInput.cs</span></div>
<div class="highlight"><pre><code><span class="c1">// Copyright(c) 2017 Takahiro Miyaura</span>
<span class="c1">// Released under the MIT license</span>
<span class="c1">// http://opensource.org/licenses/mit-license.php</span>

<span class="n">audio</span> <span class="p">=</span> <span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">AudioSource</span><span class="p">&gt;();</span>
<span class="n">audio</span><span class="p">.</span><span class="n">clip</span> <span class="p">=</span> <span class="n">Microphone</span><span class="p">.</span><span class="nf">Start</span><span class="p">(</span><span class="n">deviceName</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="m">999</span><span class="p">,</span> <span class="n">MicSampleRate</span><span class="p">);</span>
<span class="n">audio</span><span class="p">.</span><span class="n">loop</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
<span class="k">while</span> <span class="p">(!(</span><span class="n">Microphone</span><span class="p">.</span><span class="nf">GetPosition</span><span class="p">(</span><span class="n">deviceName</span><span class="p">)</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">))</span>
<span class="p">{</span>
<span class="p">}</span>

<span class="c1">//recording start.</span>
<span class="n">audio</span><span class="p">.</span><span class="nf">Play</span><span class="p">();</span>

</code></pre></div>
</div>

<h6>
<span id="マイクの集音終了" class="fragment"></span><a href="#%E3%83%9E%E3%82%A4%E3%82%AF%E3%81%AE%E9%9B%86%E9%9F%B3%E7%B5%82%E4%BA%86"><i class="fa fa-link"></i></a>マイクの集音終了</h6>

<p>マイクの集音終了はMicrophoneInput.ServiceStopメソッドで実装します。このメソッドは先ほど作ったUIのStopボタンで呼び出されるように実装しています。<br>
こちらの処理内容も<a href="http://qiita.com/miyaura/items/e50183be18e3bf8f70e0">前回</a>と同じ実装内容になります。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">MicrophoneInput.cs</span></div>
<div class="highlight"><pre><code><span class="c1">// Copyright(c) 2017 Takahiro Miyaura</span>
<span class="c1">// Released under the MIT license</span>
<span class="c1">// http://opensource.org/licenses/mit-license.php</span>

<span class="n">audio</span><span class="p">.</span><span class="nf">Stop</span><span class="p">();</span>
<span class="n">Microphone</span><span class="p">.</span><span class="nf">End</span><span class="p">(</span><span class="n">deviceName</span><span class="p">);</span>
</code></pre></div>
</div>

<h6>
<span id="集音データの送信" class="fragment"></span><a href="#%E9%9B%86%E9%9F%B3%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E9%80%81%E4%BF%A1"><i class="fa fa-link"></i></a>集音データの送信</h6>

<p>次に集音データの送信を行います。処理はMicrophoneInput.OnAudioFilterReadメソッドで実装します。こちらも基本的な部分は<a href="http://qiita.com/miyaura/items/e50183be18e3bf8f70e0">前回</a>と同じ実装内容になります。<br>
異なるのは、以下の２点です。</p>

<ol>
<li>Translator Speech APIへ送信するためのリサンプリング</li>
<li>Translator Speech APIサービスにデータを送信</li>
</ol>

<p>リサンプリングについては、HoloLensで集音すると48Khz,2chの品質でサンプリングされます。ですが、経験上（確認中ですが）Translator Speech APIは16Khz,1ch,16bitで送るのがよさそうなので、リサンプリングを行っています。リサンプリングは単純にデータを間引く対応を行っています。間引き方は単純で48/16*2=6個のデータ毎に平均をとって配列を再構成します。waveデータはfloatの配列で取得できるのですが、ステレオの場合、この配列の偶数が右チャネル、奇数が左チャネルとなります。今回はステレオからモノラルの変換も兼ねているので単純にまとめて処理しています。リサンプリングしたデータは16bitで量子化したうえでTranslator Speech APIに送信します。<br>
なお、この辺りの処理が単純すぎるので認識率の低下につながってる可能性もあります（データ劣化を起こしている）。</p>

<div class="code-frame" data-lang="csharp">
<div class="code-lang"><span class="bold">MicrophoneInput.cs</span></div>
<div class="highlight"><pre><code><span class="c1">// Copyright(c) 2017 Takahiro Miyaura</span>
<span class="c1">// Released under the MIT license</span>
<span class="c1">// http://opensource.org/licenses/mit-license.php</span>

<span class="c1">/// &lt;summary&gt;</span>
<span class="c1">///     Read sampling Data from Microphone.</span>
<span class="c1">/// &lt;/summary&gt;</span>
<span class="c1">/// &lt;param name="buffer"&gt;Sampling Data.&lt;/param&gt;</span>
<span class="c1">/// &lt;param name="numChannels"&gt;number of audio channels.&lt;/param&gt;</span>
<span class="k">private</span> <span class="k">void</span> <span class="nf">OnAudioFilterRead</span><span class="p">(</span><span class="kt">float</span><span class="p">[]</span> <span class="n">buffer</span><span class="p">,</span> <span class="kt">int</span> <span class="n">numChannels</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(!</span><span class="n">_isStart</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
    <span class="k">lock</span> <span class="p">(</span><span class="k">this</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">"samplingDataSize:"</span> <span class="p">+</span> <span class="n">buffer</span><span class="p">.</span><span class="n">Length</span><span class="p">);</span>
        <span class="k">lock</span> <span class="p">(</span><span class="n">lockObject</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// Resampling datas from microphone(ex:48000hz) to 16000hz.</span>
            <span class="kt">var</span> <span class="n">reduction</span> <span class="p">=</span> <span class="n">MicSampleRate</span> <span class="p">/</span> <span class="n">toSampleRate</span> <span class="p">*</span> <span class="n">numChannels</span><span class="p">;</span>

            <span class="kt">var</span> <span class="n">convBufSize</span> <span class="p">=</span> <span class="n">buffer</span><span class="p">.</span><span class="n">Length</span> <span class="p">/</span> <span class="n">reduction</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">buffer</span><span class="p">.</span><span class="n">Length</span> <span class="p">%</span> <span class="n">reduction</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span> <span class="n">convBufSize</span><span class="p">++;</span>
            <span class="kt">var</span> <span class="n">convBuf</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">short</span><span class="p">[</span><span class="n">convBufSize</span><span class="p">];</span>
            <span class="kt">var</span> <span class="n">count</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
            <span class="kt">float</span> <span class="n">ave</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">count</span> <span class="p">&lt;</span> <span class="n">convBufSize</span> <span class="p">-</span> <span class="m">1</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">ave</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
                <span class="k">for</span> <span class="p">(</span><span class="kt">var</span> <span class="n">j</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">j</span> <span class="p">&lt;</span> <span class="n">reduction</span><span class="p">;</span> <span class="n">j</span><span class="p">++)</span>
                    <span class="n">ave</span> <span class="p">+=</span> <span class="n">buffer</span><span class="p">[</span><span class="n">count</span> <span class="p">*</span> <span class="n">reduction</span> <span class="p">+</span> <span class="n">j</span><span class="p">];</span>
                <span class="n">ave</span> <span class="p">=</span> <span class="n">ave</span> <span class="p">/</span> <span class="n">reduction</span> <span class="p">*</span> <span class="m">20f</span><span class="p">;</span>
                <span class="n">convBuf</span><span class="p">[</span><span class="n">count</span><span class="p">]</span> <span class="p">=</span> <span class="nf">FloatToInt16</span><span class="p">(</span><span class="n">ave</span><span class="p">);</span>
                <span class="n">count</span><span class="p">++;</span>
            <span class="p">}</span>
            <span class="n">ave</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">var</span> <span class="n">j</span> <span class="p">=</span> <span class="n">count</span> <span class="p">*</span> <span class="n">reduction</span><span class="p">;</span> <span class="n">j</span> <span class="p">&lt;</span> <span class="n">buffer</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">j</span><span class="p">++)</span>
                <span class="n">ave</span> <span class="p">+=</span> <span class="n">buffer</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
            <span class="n">ave</span> <span class="p">=</span> <span class="n">ave</span> <span class="p">/</span> <span class="p">(</span><span class="n">buffer</span><span class="p">.</span><span class="n">Length</span> <span class="p">+</span> <span class="n">count</span> <span class="p">*</span> <span class="n">reduction</span> <span class="p">+</span> <span class="m">1</span><span class="p">);</span>
            <span class="n">convBuf</span><span class="p">[</span><span class="n">count</span><span class="p">]</span> <span class="p">=</span> <span class="nf">FloatToInt16</span><span class="p">(</span><span class="n">ave</span><span class="p">);</span>

            <span class="c1">//Write send datas to Translator Speech API.</span>

            <span class="n">convBuf</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div>
</div>

<h4>
<span id="3-uwp側の実装前々回作成のライブラリを参照したアプリの実装" class="fragment"></span><a href="#3-uwp%E5%81%B4%E3%81%AE%E5%AE%9F%E8%A3%85%E5%89%8D%E3%80%85%E5%9B%9E%E4%BD%9C%E6%88%90%E3%81%AE%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%82%92%E5%8F%82%E7%85%A7%E3%81%97%E3%81%9F%E3%82%A2%E3%83%97%E3%83%AA%E3%81%AE%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>3. UWP側の実装(<a href="http://qiita.com/miyaura/items/febee8ca6f9050c9ff26">前々回</a>作成のライブラリを参照したアプリの実装）</h4>

<p>全てUnity上でできれば丸く収まるのですが、今回作成したものはUWPのライブラリですので、<br>
UWP側で残りの実装を行います。</p>

<p><a href="http://qiita.com/miyaura/items/febee8ca6f9050c9ff26">前々回</a>のUWPのライブラリを利用した場合以下の６つの実装を行います。</p>

<ol>
<li>初期化処理を接続の開始</li>
<li>データの送信</li>
<li>合成音声可能な言語リストの取得(GetTtsInfoメソッド)</li>
<li>翻訳可能な言語リストの取得(GetTranslateLanguageInfoメソッド)</li>
<li>受信後(翻訳結果：テキスト)の処理(OnTextMessageメソッド)</li>
<li>受信後(翻訳結果：合成音声)の処理(OnVoiceMessageメソッド)</li>
</ol>

<h4>
<span id="1-初期化処理を接続の開始" class="fragment"></span><a href="#1-%E5%88%9D%E6%9C%9F%E5%8C%96%E5%87%A6%E7%90%86%E3%82%92%E6%8E%A5%E7%B6%9A%E3%81%AE%E9%96%8B%E5%A7%8B"><i class="fa fa-link"></i></a>1. 初期化処理を接続の開始</h4>

<p>ライブラリの初期化をTranslator Speech APIの接続を開始します。<br>
この処理は録音開始のボタンの押下時に実行するように実装します。<br>
ConnectメソッドにはUIで設定したfrom,to,Voiceを渡します。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre><code><span class="c1">// Copyright(c) 2017 Takahiro Miyaura</span>
<span class="c1">// Released under the MIT license</span>
<span class="c1">// http://opensource.org/licenses/mit-license.php</span>

<span class="n">service</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">CognitiveTranslatorService</span><span class="p">(</span><span class="n">subScriptionKey</span><span class="p">);</span>
<span class="n">service</span><span class="p">.</span><span class="n">OnTextMessage</span> <span class="p">+=</span> <span class="n">OnTextMessage</span><span class="p">;</span>
<span class="n">service</span><span class="p">.</span><span class="n">OnVoiceMessage</span> <span class="p">+=</span> <span class="n">OnVoiceMessage</span><span class="p">;</span>
<span class="n">service</span><span class="p">.</span><span class="nf">Connect</span><span class="p">(</span><span class="k">from</span><span class="p">,</span> <span class="n">to</span><span class="p">,</span> <span class="n">voice</span><span class="p">);</span>

</code></pre></div></div>

<p>コンストラクタの引数にはAzureのサブスクリプションキーを渡します。<br>
2,3行目は送信した翻訳データを受信した際に呼び出すメソッドを割り当てる処理となります。</p>

<h4>
<span id="2-データの送信" class="fragment"></span><a href="#2-%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E9%80%81%E4%BF%A1"><i class="fa fa-link"></i></a>2. データの送信</h4>

<p>接続の完了後音声データを送信する処理は以下の通りです。Unityの方で音声データを集音した際にはデータは16bitのサンプリングデータに変換します。サービスへの送信についてはこれをByteの配列に変換します。データはリトルエンディアンになりますので注意してください。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre><code><span class="c1">// Copyright(c) 2017 Takahiro Miyaura</span>
<span class="c1">// Released under the MIT license</span>
<span class="c1">// http://opensource.org/licenses/mit-license.php</span>

<span class="kt">var</span> <span class="n">convertBytes</span> <span class="p">=</span> <span class="nf">ConvertBytes</span><span class="p">(</span><span class="n">samplingData</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">buffer</span> <span class="p">=</span> <span class="n">convertBytes</span><span class="p">.</span><span class="nf">ToArray</span><span class="p">();</span>
<span class="n">service</span><span class="p">.</span><span class="nf">AddSamplingData</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">buffer</span><span class="p">.</span><span class="n">Length</span><span class="p">);</span>

</code></pre></div></div>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre><code><span class="c1">// Copyright(c) 2017 Takahiro Miyaura</span>
<span class="c1">// Released under the MIT license</span>
<span class="c1">// http://opensource.org/licenses/mit-license.php</span>

<span class="k">private</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="kt">byte</span><span class="p">&gt;</span> <span class="nf">ConvertBytes</span><span class="p">(</span><span class="kt">short</span><span class="p">[]</span> <span class="n">sampleData</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">s</span> <span class="k">in</span> <span class="n">sampleData</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">bytes</span> <span class="p">=</span> <span class="n">BitConverter</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
        <span class="k">yield</span> <span class="k">return</span> <span class="n">bytes</span><span class="p">[</span><span class="m">0</span><span class="p">];</span>
        <span class="k">yield</span> <span class="k">return</span> <span class="n">bytes</span><span class="p">[</span><span class="m">1</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<h4>
<span id="3-合成音声可能な言語リストの取得getttsinfoメソッド" class="fragment"></span><a href="#3-%E5%90%88%E6%88%90%E9%9F%B3%E5%A3%B0%E5%8F%AF%E8%83%BD%E3%81%AA%E8%A8%80%E8%AA%9E%E3%83%AA%E3%82%B9%E3%83%88%E3%81%AE%E5%8F%96%E5%BE%97getttsinfo%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89"><i class="fa fa-link"></i></a>3. 合成音声可能な言語リストの取得(GetTtsInfoメソッド)</h4>

<p>Translator Speech APIでサポートしている合成音声の情報を取得します。これはUnity上のUIで値を選択するための情報として利用します。ライブラリではメソッドを１つ呼ぶだけで実施可能です。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre><code><span class="c1">// Copyright(c) 2017 Takahiro Miyaura</span>
<span class="c1">// Released under the MIT license</span>
<span class="c1">// http://opensource.org/licenses/mit-license.php</span>

<span class="kt">var</span> <span class="n">speechTtsInfo</span> <span class="p">=</span> <span class="n">CognitiveTranslatorService</span><span class="p">.</span><span class="nf">GetSpeechTtsInfo</span><span class="p">();</span>
<span class="n">speechTtsInfo</span><span class="p">.</span><span class="nf">Wait</span><span class="p">();</span>
</code></pre></div></div>

<p>なお、ライブラリのGetSpeechTtsInfoは非同期のメソッドとして定義していますので、<br>
レスポンスを同期的に処理するためにはWaitメソッドを用いて待機します。</p>

<h4>
<span id="4-翻訳可能な言語リストの取得gettranslatelanguageinfoメソッド" class="fragment"></span><a href="#4-%E7%BF%BB%E8%A8%B3%E5%8F%AF%E8%83%BD%E3%81%AA%E8%A8%80%E8%AA%9E%E3%83%AA%E3%82%B9%E3%83%88%E3%81%AE%E5%8F%96%E5%BE%97gettranslatelanguageinfo%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89"><i class="fa fa-link"></i></a>4. 翻訳可能な言語リストの取得(GetTranslateLanguageInfoメソッド)</h4>

<p>Translator Speech APIでサポートしている言語の情報を取得します。これはUnity上のUIで値を選択するための情報として利用します。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre><code><span class="c1">// Copyright(c) 2017 Takahiro Miyaura</span>
<span class="c1">// Released under the MIT license</span>
<span class="c1">// http://opensource.org/licenses/mit-license.php</span>

<span class="kt">var</span> <span class="n">speechTtsInfo</span> <span class="p">=</span> <span class="n">CognitiveTranslatorService</span><span class="p">.</span><span class="nf">GetSpeechTextInfo</span><span class="p">();</span>
<span class="n">speechTtsInfo</span><span class="p">.</span><span class="nf">Wait</span><span class="p">();</span>
</code></pre></div></div>

<h4>
<span id="5-受信後翻訳結果テキストの処理ontextmessageメソッド" class="fragment"></span><a href="#5-%E5%8F%97%E4%BF%A1%E5%BE%8C%E7%BF%BB%E8%A8%B3%E7%B5%90%E6%9E%9C%E3%83%86%E3%82%AD%E3%82%B9%E3%83%88%E3%81%AE%E5%87%A6%E7%90%86ontextmessage%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89"><i class="fa fa-link"></i></a>5. 受信後(翻訳結果：テキスト)の処理(OnTextMessageメソッド)</h4>

<p>ここでは、翻訳後のデータが入ったJSONデータを解析してUnity側に描画します。JSONデータには音声から解析された原文と翻訳後の情報があります。今回は両方のデータを利用できるように文字列を加工しています。Unityへの描画についてはコメントの部分に記載を行います。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre><code><span class="c1">// Copyright(c) 2017 Takahiro Miyaura</span>
<span class="c1">// Released under the MIT license</span>
<span class="c1">// http://opensource.org/licenses/mit-license.php</span>

<span class="n">rivate</span> <span class="k">void</span> <span class="nf">OnTextMessage</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span>
    <span class="n">MessageWebSocketMessageReceivedEventArgs</span> <span class="n">messageWebSocketMessageReceivedEventArgs</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="s">""</span><span class="p">;</span>
    <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">reader</span> <span class="p">=</span> <span class="n">messageWebSocketMessageReceivedEventArgs</span><span class="p">.</span><span class="nf">GetDataStream</span><span class="p">())</span>
    <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">sr</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StreamReader</span><span class="p">(</span><span class="n">reader</span><span class="p">.</span><span class="nf">AsStreamForRead</span><span class="p">(),</span> <span class="n">Encoding</span><span class="p">.</span><span class="nf">GetEncoding</span><span class="p">(</span><span class="s">"UTF-8"</span><span class="p">)))</span>
    <span class="p">{</span>
        <span class="n">result</span> <span class="p">=</span> <span class="n">sr</span><span class="p">.</span><span class="nf">ReadToEnd</span><span class="p">();</span>

        <span class="kt">var</span> <span class="n">jsonObject</span> <span class="p">=</span> <span class="n">JsonObject</span><span class="p">.</span><span class="nf">Parse</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>
        <span class="kt">var</span> <span class="n">recognition</span> <span class="p">=</span> <span class="n">jsonObject</span><span class="p">[</span><span class="s">"recognition"</span><span class="p">].</span><span class="nf">GetString</span><span class="p">();</span>
        <span class="kt">var</span> <span class="n">translation</span> <span class="p">=</span> <span class="n">jsonObject</span><span class="p">[</span><span class="s">"translation"</span><span class="p">].</span><span class="nf">GetString</span><span class="p">();</span>

        <span class="c1">//(translation + "\n[" + recognition + "]")</span>
        <span class="c1">//ここでUnity側に値を表示するロジックを実装する。</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h4>
<span id="6-受信後翻訳結果合成音声の処理onvoicemessageメソッド" class="fragment"></span><a href="#6-%E5%8F%97%E4%BF%A1%E5%BE%8C%E7%BF%BB%E8%A8%B3%E7%B5%90%E6%9E%9C%E5%90%88%E6%88%90%E9%9F%B3%E5%A3%B0%E3%81%AE%E5%87%A6%E7%90%86onvoicemessage%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89"><i class="fa fa-link"></i></a>6. 受信後(翻訳結果：合成音声)の処理(OnVoiceMessageメソッド)</h4>

<p>ここでは、翻訳後の音声データとしてバイナリデータが送られた場合、スピーカーから発話します。音声周りはNAudioを利用して再生しています。<br>
なお、発話するとスピーカーからの音声をマイクが集音することで雑音が増える結果になります。</p>

<div class="code-frame" data-lang="csharp"><div class="highlight"><pre><code><span class="c1">// Copyright(c) 2017 Takahiro Miyaura</span>
<span class="c1">// Released under the MIT license</span>
<span class="c1">// http://opensource.org/licenses/mit-license.php</span>

<span class="k">private</span> <span class="k">void</span> <span class="nf">OnVoiceMessage</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span>
    <span class="n">MessageWebSocketMessageReceivedEventArgs</span> <span class="n">messageWebSocketMessageReceivedEventArgs</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">reader</span> <span class="p">=</span> <span class="n">messageWebSocketMessageReceivedEventArgs</span><span class="p">.</span><span class="nf">GetDataStream</span><span class="p">())</span>
    <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">stream</span> <span class="p">=</span> <span class="n">reader</span><span class="p">.</span><span class="nf">AsStreamForRead</span><span class="p">())</span>
    <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">mStream</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MemoryStream</span><span class="p">())</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">bufferSize</span> <span class="p">=</span> <span class="m">32000</span><span class="p">;</span>
        <span class="kt">var</span> <span class="n">bytes</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">byte</span><span class="p">&gt;();</span>
        <span class="kt">var</span> <span class="n">buf</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="p">[</span><span class="n">bufferSize</span><span class="p">];</span>
        <span class="kt">var</span> <span class="n">length</span> <span class="p">=</span> <span class="n">stream</span><span class="p">.</span><span class="nf">Read</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">buf</span><span class="p">.</span><span class="n">Length</span><span class="p">);</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">length</span> <span class="p">-</span> <span class="n">bufferSize</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">bytes</span><span class="p">.</span><span class="nf">AddRange</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
            <span class="n">length</span> <span class="p">=</span> <span class="n">stream</span><span class="p">.</span><span class="nf">Read</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">buf</span><span class="p">.</span><span class="n">Length</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">length</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
            <span class="n">bytes</span><span class="p">.</span><span class="nf">AddRange</span><span class="p">(</span><span class="n">buf</span><span class="p">.</span><span class="nf">Take</span><span class="p">(</span><span class="n">length</span><span class="p">).</span><span class="nf">ToArray</span><span class="p">());</span>

        <span class="kt">var</span> <span class="n">fullData</span> <span class="p">=</span> <span class="n">bytes</span><span class="p">.</span><span class="nf">ToArray</span><span class="p">();</span>
        <span class="n">mStream</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="n">fullData</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">fullData</span><span class="p">.</span><span class="n">Length</span><span class="p">);</span>
        <span class="n">mStream</span><span class="p">.</span><span class="n">Position</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
        <span class="kt">var</span> <span class="n">bitsPerSampleBytes</span> <span class="p">=</span> <span class="n">fullData</span><span class="p">.</span><span class="nf">Skip</span><span class="p">(</span><span class="m">34</span><span class="p">).</span><span class="nf">Take</span><span class="p">(</span><span class="m">2</span><span class="p">).</span><span class="nf">ToArray</span><span class="p">();</span>
        <span class="kt">var</span> <span class="n">channelBytes</span> <span class="p">=</span> <span class="n">fullData</span><span class="p">.</span><span class="nf">Skip</span><span class="p">(</span><span class="m">22</span><span class="p">).</span><span class="nf">Take</span><span class="p">(</span><span class="m">2</span><span class="p">).</span><span class="nf">ToArray</span><span class="p">();</span>
        <span class="kt">var</span> <span class="n">samplingBytes</span> <span class="p">=</span> <span class="n">fullData</span><span class="p">.</span><span class="nf">Skip</span><span class="p">(</span><span class="m">24</span><span class="p">).</span><span class="nf">Take</span><span class="p">(</span><span class="m">4</span><span class="p">).</span><span class="nf">ToArray</span><span class="p">();</span>
        <span class="kt">var</span> <span class="n">bitsPerSample</span> <span class="p">=</span> <span class="n">BitConverter</span><span class="p">.</span><span class="nf">ToInt16</span><span class="p">(</span><span class="n">bitsPerSampleBytes</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
        <span class="kt">var</span> <span class="n">channel</span> <span class="p">=</span> <span class="n">BitConverter</span><span class="p">.</span><span class="nf">ToInt16</span><span class="p">(</span><span class="n">channelBytes</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
        <span class="kt">var</span> <span class="n">samplingRate</span> <span class="p">=</span> <span class="n">BitConverter</span><span class="p">.</span><span class="nf">ToInt32</span><span class="p">(</span><span class="n">samplingBytes</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>

        <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">player</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">WasapiOutRT</span><span class="p">(</span><span class="n">AudioClientShareMode</span><span class="p">.</span><span class="n">Shared</span><span class="p">,</span> <span class="m">250</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">player</span><span class="p">.</span><span class="nf">Init</span><span class="p">(()</span> <span class="p">=&gt;</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">waveChannel32</span> <span class="p">=</span>
                    <span class="k">new</span> <span class="nf">WaveChannel32</span><span class="p">(</span><span class="k">new</span> <span class="nf">RawSourceWaveStream</span><span class="p">(</span><span class="n">mStream</span><span class="p">,</span>
                        <span class="k">new</span> <span class="nf">WaveFormat</span><span class="p">(</span><span class="n">samplingRate</span><span class="p">,</span> <span class="n">bitsPerSample</span><span class="p">,</span> <span class="n">channel</span><span class="p">)));</span>
                <span class="kt">var</span> <span class="n">mixer</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MixingSampleProvider</span><span class="p">(</span><span class="k">new</span><span class="p">[]</span> <span class="p">{</span><span class="n">waveChannel32</span><span class="p">.</span><span class="nf">ToSampleProvider</span><span class="p">()});</span>

                <span class="k">return</span> <span class="n">mixer</span><span class="p">.</span><span class="nf">ToWaveProvider16</span><span class="p">();</span>
            <span class="p">});</span>

            <span class="n">player</span><span class="p">.</span><span class="nf">Play</span><span class="p">();</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">player</span><span class="p">.</span><span class="n">PlaybackState</span> <span class="p">==</span> <span class="n">PlaybackState</span><span class="p">.</span><span class="n">Playing</span><span class="p">)</span>
            <span class="p">{</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2>
<span id="最後に" class="fragment"></span><a href="#%E6%9C%80%E5%BE%8C%E3%81%AB"><i class="fa fa-link"></i></a>最後に</h2>

<p>以上がHoloLensに組み込む際のポイントを残してみました。もう少しここはどうなってる？等ありましたら、コメントしていただければ返したいと思います。<br>
なお、2017年5月からTranslator Speech APIが大幅値下げされています。お試しで使うとしてもかなりお得感があるので色々試してください。<br>
私自身は、この翻訳アプリをDe:code 2017の基調講演で試行してみたいと思ってます。ただ、事前に映画見ながらも使っていたのですが「１．音声データの品質」「２．翻訳精度」の２つの問題から思ったようには翻訳されないことが多いです。かなり条件そろわないと難しい印象です。この辺り、他のTranslatorも少し使ってみようと思います。</p>
</div></div></section><div class="css-1yzj1fm"><div class="css-1uv1qiv"><span class="fa fa-twitter"></span></div><div class="css-1uv1qiv"><span class="fa fa-facebook"></span></div></div><div class="apm-Content"><div class="apm-Content_title">Why not register and get more from Qiita?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Fmiyaura%2Fitems%2F6f2570fe0dc0a8b0b7f1&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Fmiyaura%2Fitems%2F6f2570fe0dc0a8b0b7f1&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div><div class="css-helsa7"></div></div></div></div><div class="css-109dbrr"><div class="css-5jpx49"><div class="css-mnxgyc"><button class=" css-1vlpknv"><svg size="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="#55C500" class="css-1g4cku8 e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></button><a href="/miyaura/items/6f2570fe0dc0a8b0b7f1/likers" class="css-1iupg5d">4</a></div><div class="css-fsjkhv"><button class=" css-15cocm3"><svg size="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 353.02 398" color="#6E6F70" class="css-12rp90f e11v00bf0"><path d="M176.72 398c-67.52 0-130.16-29-171.84-79.69l-4.46-5.42V78.05H353v234.84l-4.45 5.42C306.88 369 244.24 398 176.72 398zm-137.2-99.34c34.17 38.37 83.78 60.25 137.2 60.25s103-21.88 137.21-60.25V117.14H39.52zM0 0h351.12v40.94H0z"></path></svg></button><span class="css-1b17vb0">5</span></div><div class="css-79elbk"><button class="css-16hhh7b"><i class="fa fa-ellipsis-h"></i></button><div class="css-7i7f4d"><div class="css-1gj7nt">Improve article</div><a href="/drafts/6f2570fe0dc0a8b0b7f1/edit" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-code-fork css-1jqivyb" aria-hidden="true"></i></span>Send edit request</a><div class="css-1ode1bp"></div><div class="css-1gj7nt">Article information</div><a href="/miyaura/items/6f2570fe0dc0a8b0b7f1/revisions" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-history css-1jqivyb" aria-hidden="true"></i></span>Revisions</a><a href="/miyaura/items/6f2570fe0dc0a8b0b7f1/patches" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-inbox css-1jqivyb" aria-hidden="true"></i></span>Edit Requests</a><a href="/miyaura/items/6f2570fe0dc0a8b0b7f1/likers" class="css-154zy0m"><span class="css-yikrym"><svg size="13" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 392.81 429" color="rgba(0, 0, 0, 0.6)" class="css-le4d8r e31pr5q0"><path d="M14.19 5.4h53.86v149.45h90.05v44.87H14.19zM288.4 93.77h100.79q1.29 25-5.66 45.39a96.79 96.79 0 01-20.33 34.89 92 92 0 01-32.13 22.45 104 104 0 01-40.95 7.93 109.71 109.71 0 01-76-29.92 104.05 104.05 0 01-23-32.56 95.46 95.46 0 01-8.47-39.88 94.78 94.78 0 018.47-39.87 104.38 104.38 0 0123-32.42A107.71 107.71 0 01248.23 8a110.79 110.79 0 01118.48 22.49l-35.07 35.08a51.25 51.25 0 00-17.75-15 52.83 52.83 0 00-44.67-1.23 52.92 52.92 0 00-17 12 57.07 57.07 0 00-11.45 18.11 60 60 0 00-4.23 22.77 60 60 0 004.23 22.68 56.57 56.57 0 0011.45 18.19 52.62 52.62 0 0017 12 50.5 50.5 0 0020.9 4.36q20.19 0 31.07-7.51a35.75 35.75 0 0014.46-20.55h-47.39zM51.29 279.55H0v-44.86h156v44.86h-51.13V429H51.29zM283.36 381.71l-41.72-62V429h-53.86V234.69h47.47L290 312l55.9-77.29h46.9V429h-53.86V320.27l-42.43 61.44z"></path></svg></span>Show all likers</a><a href="/miyaura/items/6f2570fe0dc0a8b0b7f1.md" class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-file-text-o css-1jqivyb" aria-hidden="true"></i></span>Show article in Markdown</a><div class="css-1ode1bp"></div><div class="css-154zy0m"><span class="css-yikrym"><i class="fa fa-flag css-1jqivyb" aria-hidden="true"></i></span>Report article</div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="illegal" required=""/>It&#x27;s illegal (copyright infringement, privacy infringement, libel, etc.)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It&#x27;s socially inappropriate (offensive to public order and morals)</label></div><div class="st-Form"><label><input type="radio" name="reason" value="advertising" required=""/>It&#x27;s advertising</label></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="guideline_violation" required=""/>Other than the above, but not suitable for the Qiita community (violation of guidelines)</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalArticlePage" data-dom-id="PersonalArticlePage-react-component-6ee26546-8b2e-4059-8cce-170d2d6bcfdb">{"authorAnalyticsTrackingId":"UA-92162552-1","organizationAnalyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a><a target="_blank" href="https://help.qiita.com/ja/articles/others-brand-guideline">Design Guideline</a></div><div class="st-Footer_column"><a href="/release-notes">Release</a><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2021 Increments Inc.</div></footer><div id="Snackbar-react-component-2aacddcd-e137-4273-a904-94036bd552be"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-2aacddcd-e137-4273-a904-94036bd552be">{}</script>
      
<div id="LoginModal-react-component-8e352df5-fc30-4b0a-8d26-cc9fb1f3fbea"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-8e352df5-fc30-4b0a-8d26-cc9fb1f3fbea">{}</script>
      
<div id="StockModal-react-component-54737663-18e8-40bd-bdc9-0a30eabf8468"></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="StockModal" data-dom-id="StockModal-react-component-54737663-18e8-40bd-bdc9-0a30eabf8468">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;7+2e6RQKNitiV/+xBKq9pE1Az+3rVcty4aPJGaGkxHESInw4+YnyTUdWV38vZ21+cS7UnJiwDod6vunnhg+teQ==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStoreWithReactOnRails">{"snackbar":{"type":"","body":"","isActive":false},"article":{"article":{"body":"\n\u003ch1\u003e\n\u003cspan id=\"hololensでリアルタイム翻訳\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#hololens%E3%81%A7%E3%83%AA%E3%82%A2%E3%83%AB%E3%82%BF%E3%82%A4%E3%83%A0%E7%BF%BB%E8%A8%B3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eHoloLensでリアルタイム翻訳\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"http://qiita.com/miyaura/items/e50183be18e3bf8f70e0\" id=\"reference-a9f45e7152b49739475a\"\u003e前回\u003c/a\u003e、\u003ca href=\"http://qiita.com/miyaura/items/febee8ca6f9050c9ff26\" id=\"reference-a7b5521a5a6ad8f8cb6f\"\u003e前々回\u003c/a\u003eで紹介した方法を使い、HoloLensでリアルタイム翻訳を実施します。構築したアプリケーションとしては、以下の機能を有するものです。\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e翻訳したい言語、翻訳後の言語、合成音声出すかをUIで設定\u003c/li\u003e\n\u003cli\u003eレコーディング開始を実行するとリアルタイム翻訳開始\u003c/li\u003e\n\u003cli\u003eレコーディングを止めるまでマイクの音声を集約する。\u003c/li\u003e\n\u003cli\u003e翻訳できたデータはHoloLens上でテロップ＆音声出力\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003e以上のような簡単なものです。ただ、実をいうと音声出力はよくないと思います。というのも、スピーカーから出すとマイクで集音されてしまうのでただの雑音になり精度を下げる要因になります。お試しで使う形になるかと思います。動作させるとこのような形で動きます。\u003c/p\u003e\n\n\u003cblockquote class=\"\" data-lang=\"ja\"\u003e\n\u003cp\u003eとりあえずの最終版のHoloLensリアルタイム翻訳アプリの動作状況。現状のTranslator Speech APIが使えると思われる設定だと音声品質の問題で認識率が落ちてる気がします。\u003ca href=\"https://twitter.com/hashtag/HoloLensJP?src=hash\" rel=\"nofollow noopener\" target=\"_blank\"\u003e#HoloLensJP\u003c/a\u003e \u003ca href=\"https://t.co/xBww80Ch6N\" rel=\"nofollow noopener\" target=\"_blank\"\u003epic.twitter.com/xBww80Ch6N\u003c/a\u003e\u003c/p\u003e— takabrz (@takabrz1) \u003ca href=\"https://twitter.com/takabrz1/status/864531865746554880\" rel=\"nofollow noopener\" target=\"_blank\"\u003e2017年5月16日\u003c/a\u003e\n\u003c/blockquote\u003e\n\n\n\n\u003ch2\u003e\n\u003cspan id=\"今回の環境\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BB%8A%E5%9B%9E%E3%81%AE%E7%92%B0%E5%A2%83\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e今回の環境\u003c/h2\u003e\n\n\u003cp\u003e環境については以下の通りです。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eIDE\n\n\u003cul\u003e\n\u003cli\u003eUnity 5.5.0f3\u003c/li\u003e\n\u003cli\u003eVisual Studio 2015 update 3 Community Edition\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eライブラリ関連\n\n\u003cul\u003e\n\u003cli\u003eHoloToolkit-Unity 1.5.5.0\u003c/li\u003e\n\u003cli\u003eNaudio 1.8.8.0(合成音声の再生のみで利用)\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"実装について\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%9F%E8%A3%85%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e実装について\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\"http://qiita.com/miyaura/items/e50183be18e3bf8f70e0\"\u003e前回\u003c/a\u003e、\u003ca href=\"http://qiita.com/miyaura/items/febee8ca6f9050c9ff26\"\u003e前々回\u003c/a\u003eでライブラリ化しているので、実態としてはそれをそのまま利用する形になります。ただ、音声については多少の加工を行っているのでそのあたりを紹介したいと思います。\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eUnityでの実装(UI)\u003c/li\u003e\n\u003cli\u003e音声処理の実装\u003c/li\u003e\n\u003cli\u003eUWP側の実装(\u003ca href=\"http://qiita.com/miyaura/items/febee8ca6f9050c9ff26\"\u003e前々回\u003c/a\u003e作成のライブラリを参照したアプリの実装）\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"事前作業について\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BA%8B%E5%89%8D%E4%BD%9C%E6%A5%AD%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e事前作業について\u003c/h3\u003e\n\n\u003cp\u003e事前作業としてAzureのCognitive Serviceとして「Translator Speech API」の追加を行ってください。追加後SubscriptionKeyの控をお忘れなく。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"1-unityでの実装ui\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#1-unity%E3%81%A7%E3%81%AE%E5%AE%9F%E8%A3%85ui\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e1. Unityでの実装(UI)\u003c/h4\u003e\n\n\u003cp\u003eUnityのUIとしては3つのパラメータの設定、翻訳のスタート＆ストップです。\u003cbr\u003e\nパラメータについてはそれぞれ以下の情報を設定します。\u003c/p\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align: center\"\u003equery\u003c/th\u003e\n\u003cth style=\"text-align: center\"\u003e設定値\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003efrom\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e入力する音声の言語\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003eto\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e翻訳する言語\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003evoice\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e合成音声のId\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003cp\u003e合成音声を返さない場合は未設定とします。それぞれのパラメータは\u003ca href=\"http://qiita.com/miyaura/items/febee8ca6f9050c9ff26#2-%E3%82%B5%E3%83%9D%E3%83%BC%E3%83%88%E8%A8%80%E8%AA%9E%E3%81%AE%E5%8F%96%E5%BE%97\" id=\"reference-a7b5521a5a6ad8f8cb6f\"\u003e前々回の「2. サポート言語の取得」\u003c/a\u003eでえられるデータのIDに相当する値となります。\u003cbr\u003e\n今回は適当にこんなUIにしてみました。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/24362178f966d0e64ea3031523f64c0f97d9c3d7/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3135323534382f63616537353266642d363766342d363231652d306334322d3066336564363533376663632e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F152548%2Fcae752fd-67f4-621e-0c42-0f3ed6537fcc.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=919b302a573ee961db5e9239f0660417\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/152548/cae752fd-67f4-621e-0c42-0f3ed6537fcc.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F152548%2Fcae752fd-67f4-621e-0c42-0f3ed6537fcc.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=c2fade46396405040e498075d3c286d4 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eまた、翻訳結果をテロップ表示するためのテキストも用意します。のちに作るMicrophoneInput.csの中で利用するものでサンプルでは「TranslateText」としてprefabにしています。表示後少ししてから上に移動しながらフェードアウトするように処理を入れています。\u003c/p\u003e\n\n\u003cp\u003e上記はいずれもnGUIでつくりました。Canvasの設定については操作系はTagalongを利用しました。テロップはカメラ追従で実装しています。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"2-音声処理の実装\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#2-%E9%9F%B3%E5%A3%B0%E5%87%A6%E7%90%86%E3%81%AE%E5%AE%9F%E8%A3%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2. 音声処理の実装\u003c/h4\u003e\n\n\u003ch5\u003e\n\u003cspan id=\"オブジェクトの設定\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E8%A8%AD%E5%AE%9A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eオブジェクトの設定\u003c/h5\u003e\n\n\u003cp\u003e次にマイクからの集音処理部分の実装です。\u003cbr\u003e\nUnityのHierarchyで「create」-「Audio」-「Audio Source」を選択し「Audio Source」を追加します。あと、Projectで「create」-「Audio Mixer」を選択し「Audio Mixer」も追加します。\u003cbr\u003e\nまず、「Audio Mixer」-「Master」を選択し、Inspectorの設定項目「Volume」を-80dbに設定します。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/ae2c9833451249f08581af2d8a654fb72d6680d9/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3135323534382f34633439396166622d663733312d363239632d626134632d3631343939663261386638372e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F152548%2F4c499afb-f731-629c-ba4c-61499f2a8f87.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=81ebe2fe29c7224a0f97890eb0d205cf\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/152548/4c499afb-f731-629c-ba4c-61499f2a8f87.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F152548%2F4c499afb-f731-629c-ba4c-61499f2a8f87.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=e6f7d1ad4fba6adb0e485a6d3a554fa9 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e次にHierarchyで「Audio Source」を選択し、Inspectorの設定項目「output」に先ほどの「Master」をドラッグ＆ドロップします。これはスピーカーから自分のマイク音声を出力しないための設定です。なお「Audio Clip」については後でプログラム側で設定するのでそのままにしておきます。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/f8b0f1cef858208af1e0d8c5e07fca5f89e7074a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3135323534382f66346430396366652d643662352d353136382d303961302d3136396133646434313633312e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F152548%2Ff4d09cfe-d6b5-5168-09a0-169a3dd41631.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=2f734f50b9fe6c5acf139c9a6d03c834\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/152548/f4d09cfe-d6b5-5168-09a0-169a3dd41631.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F152548%2Ff4d09cfe-d6b5-5168-09a0-169a3dd41631.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=8a1c7d1cdbf7a7099e628f468baa81fb 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch5\u003e\n\u003cspan id=\"初期化処理\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%88%9D%E6%9C%9F%E5%8C%96%E5%87%A6%E7%90%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e初期化処理\u003c/h5\u003e\n\n\u003cp\u003e次に「Audio Source」の処理を書きます。Project内にC#Scpirtを作成します。\u003cbr\u003e\nStartメソッドでは、\u003ca href=\"http://qiita.com/miyaura/items/febee8ca6f9050c9ff26\"\u003e前々回\u003c/a\u003eのUWPのサンプルコードを参考にTranslator Speech APIのサービスへの接続処理を書きます。\u003cbr\u003e\nUWPで作ったプロジェクト（Com.Reseul.Apis.Services.CognitiveService.Translators.UWPプロジェクト）をそのまま利用するのが楽ですが、この場合一旦Unityでビルドを行いUWPに変換してから追記する必要があります。\u003c/p\u003e\n\n\u003ch5\u003e\n\u003cspan id=\"翻訳結果の表示\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%BF%BB%E8%A8%B3%E7%B5%90%E6%9E%9C%E3%81%AE%E8%A1%A8%E7%A4%BA\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e翻訳結果の表示\u003c/h5\u003e\n\n\u003cp\u003e翻訳結果の表示については\u003ca href=\"http://qiita.com/miyaura/items/febee8ca6f9050c9ff26\"\u003e前々回\u003c/a\u003eのUWPのサンプルコードを参考にサービスの翻訳結果のうちJSONの内容を加工し「TranslateText」をインスタンス化して\u003cbr\u003e\n画面に表示します。\u003c/p\u003e\n\n\u003ch5\u003e\n\u003cspan id=\"マイクの集音開始終了及びデータの送信\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%9E%E3%82%A4%E3%82%AF%E3%81%AE%E9%9B%86%E9%9F%B3%E9%96%8B%E5%A7%8B%E7%B5%82%E4%BA%86%E5%8F%8A%E3%81%B3%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E9%80%81%E4%BF%A1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eマイクの集音開始/終了及びデータの送信\u003c/h5\u003e\n\n\u003cp\u003e次にマイクからの集音開始と終了及びデータの送信部分を作成します。\u003c/p\u003e\n\n\u003ch6\u003e\n\u003cspan id=\"マイクの集音開始\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%9E%E3%82%A4%E3%82%AF%E3%81%AE%E9%9B%86%E9%9F%B3%E9%96%8B%E5%A7%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eマイクの集音開始\u003c/h6\u003e\n\n\u003cp\u003eマイクの集音開始については以下のように実装します。このメソッドは先ほど作ったUIのStartボタンで呼び出されるように実装します。\u003cbr\u003e\n処理内容としては\u003ca href=\"http://qiita.com/miyaura/items/e50183be18e3bf8f70e0\"\u003e前回\u003c/a\u003eと同じ実装内容になります。今回はHolotoolkit-Unityは使用せずにUnityのみで実現しています。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eMicrophoneInput.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// Copyright(c) 2017 Takahiro Miyaura\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// Released under the MIT license\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// http://opensource.org/licenses/mit-license.php\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003eaudio\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eGetComponent\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eAudioSource\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n\u003cspan class=\"n\"\u003eaudio\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eclip\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eMicrophone\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eStart\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edeviceName\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e999\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eMicSampleRate\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003eaudio\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eloop\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003ewhile\u003c/span\u003e \u003cspan class=\"p\"\u003e(!(\u003c/span\u003e\u003cspan class=\"n\"\u003eMicrophone\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetPosition\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edeviceName\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e//recording start.\u003c/span\u003e\n\u003cspan class=\"n\"\u003eaudio\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ePlay\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch6\u003e\n\u003cspan id=\"マイクの集音終了\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%9E%E3%82%A4%E3%82%AF%E3%81%AE%E9%9B%86%E9%9F%B3%E7%B5%82%E4%BA%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eマイクの集音終了\u003c/h6\u003e\n\n\u003cp\u003eマイクの集音終了はMicrophoneInput.ServiceStopメソッドで実装します。このメソッドは先ほど作ったUIのStopボタンで呼び出されるように実装しています。\u003cbr\u003e\nこちらの処理内容も\u003ca href=\"http://qiita.com/miyaura/items/e50183be18e3bf8f70e0\"\u003e前回\u003c/a\u003eと同じ実装内容になります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eMicrophoneInput.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// Copyright(c) 2017 Takahiro Miyaura\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// Released under the MIT license\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// http://opensource.org/licenses/mit-license.php\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003eaudio\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eStop\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"n\"\u003eMicrophone\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEnd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edeviceName\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch6\u003e\n\u003cspan id=\"集音データの送信\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%9B%86%E9%9F%B3%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E9%80%81%E4%BF%A1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e集音データの送信\u003c/h6\u003e\n\n\u003cp\u003e次に集音データの送信を行います。処理はMicrophoneInput.OnAudioFilterReadメソッドで実装します。こちらも基本的な部分は\u003ca href=\"http://qiita.com/miyaura/items/e50183be18e3bf8f70e0\"\u003e前回\u003c/a\u003eと同じ実装内容になります。\u003cbr\u003e\n異なるのは、以下の２点です。\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eTranslator Speech APIへ送信するためのリサンプリング\u003c/li\u003e\n\u003cli\u003eTranslator Speech APIサービスにデータを送信\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eリサンプリングについては、HoloLensで集音すると48Khz,2chの品質でサンプリングされます。ですが、経験上（確認中ですが）Translator Speech APIは16Khz,1ch,16bitで送るのがよさそうなので、リサンプリングを行っています。リサンプリングは単純にデータを間引く対応を行っています。間引き方は単純で48/16*2=6個のデータ毎に平均をとって配列を再構成します。waveデータはfloatの配列で取得できるのですが、ステレオの場合、この配列の偶数が右チャネル、奇数が左チャネルとなります。今回はステレオからモノラルの変換も兼ねているので単純にまとめて処理しています。リサンプリングしたデータは16bitで量子化したうえでTranslator Speech APIに送信します。\u003cbr\u003e\nなお、この辺りの処理が単純すぎるので認識率の低下につながってる可能性もあります（データ劣化を起こしている）。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eMicrophoneInput.cs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// Copyright(c) 2017 Takahiro Miyaura\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// Released under the MIT license\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// http://opensource.org/licenses/mit-license.php\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e///     Read sampling Data from Microphone.\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// \u0026lt;param name=\"buffer\"\u0026gt;Sampling Data.\u0026lt;/param\u0026gt;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// \u0026lt;param name=\"numChannels\"\u0026gt;number of audio channels.\u0026lt;/param\u0026gt;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnAudioFilterRead\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003efloat\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003enumChannels\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(!\u003c/span\u003e\u003cspan class=\"n\"\u003e_isStart\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003elock\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eDebug\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"samplingDataSize:\"\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003elock\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elockObject\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// Resampling datas from microphone(ex:48000hz) to 16000hz.\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ereduction\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eMicSampleRate\u003c/span\u003e \u003cspan class=\"p\"\u003e/\u003c/span\u003e \u003cspan class=\"n\"\u003etoSampleRate\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003enumChannels\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003econvBufSize\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e \u003cspan class=\"p\"\u003e/\u003c/span\u003e \u003cspan class=\"n\"\u003ereduction\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"n\"\u003ereduction\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003econvBufSize\u003c/span\u003e\u003cspan class=\"p\"\u003e++;\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003econvBuf\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003eshort\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003econvBufSize\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ecount\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"kt\"\u003efloat\u003c/span\u003e \u003cspan class=\"n\"\u003eave\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ewhile\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecount\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003econvBufSize\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eave\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ej\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ej\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003ereduction\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ej\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003eave\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ecount\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003ereduction\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003ej\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eave\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eave\u003c/span\u003e \u003cspan class=\"p\"\u003e/\u003c/span\u003e \u003cspan class=\"n\"\u003ereduction\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"m\"\u003e20f\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"n\"\u003econvBuf\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ecount\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eFloatToInt16\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eave\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                \u003cspan class=\"n\"\u003ecount\u003c/span\u003e\u003cspan class=\"p\"\u003e++;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eave\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ej\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecount\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003ereduction\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ej\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ej\u003c/span\u003e\u003cspan class=\"p\"\u003e++)\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eave\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ej\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eave\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eave\u003c/span\u003e \u003cspan class=\"p\"\u003e/\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003ecount\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003ereduction\u003c/span\u003e \u003cspan class=\"p\"\u003e+\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003econvBuf\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ecount\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eFloatToInt16\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eave\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e//Write send datas to Translator Speech API.\u003c/span\u003e\n\n            \u003cspan class=\"n\"\u003econvBuf\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"3-uwp側の実装前々回作成のライブラリを参照したアプリの実装\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#3-uwp%E5%81%B4%E3%81%AE%E5%AE%9F%E8%A3%85%E5%89%8D%E3%80%85%E5%9B%9E%E4%BD%9C%E6%88%90%E3%81%AE%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%82%92%E5%8F%82%E7%85%A7%E3%81%97%E3%81%9F%E3%82%A2%E3%83%97%E3%83%AA%E3%81%AE%E5%AE%9F%E8%A3%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e3. UWP側の実装(\u003ca href=\"http://qiita.com/miyaura/items/febee8ca6f9050c9ff26\"\u003e前々回\u003c/a\u003e作成のライブラリを参照したアプリの実装）\u003c/h4\u003e\n\n\u003cp\u003e全てUnity上でできれば丸く収まるのですが、今回作成したものはUWPのライブラリですので、\u003cbr\u003e\nUWP側で残りの実装を行います。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"http://qiita.com/miyaura/items/febee8ca6f9050c9ff26\"\u003e前々回\u003c/a\u003eのUWPのライブラリを利用した場合以下の６つの実装を行います。\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e初期化処理を接続の開始\u003c/li\u003e\n\u003cli\u003eデータの送信\u003c/li\u003e\n\u003cli\u003e合成音声可能な言語リストの取得(GetTtsInfoメソッド)\u003c/li\u003e\n\u003cli\u003e翻訳可能な言語リストの取得(GetTranslateLanguageInfoメソッド)\u003c/li\u003e\n\u003cli\u003e受信後(翻訳結果：テキスト)の処理(OnTextMessageメソッド)\u003c/li\u003e\n\u003cli\u003e受信後(翻訳結果：合成音声)の処理(OnVoiceMessageメソッド)\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"1-初期化処理を接続の開始\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#1-%E5%88%9D%E6%9C%9F%E5%8C%96%E5%87%A6%E7%90%86%E3%82%92%E6%8E%A5%E7%B6%9A%E3%81%AE%E9%96%8B%E5%A7%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e1. 初期化処理を接続の開始\u003c/h4\u003e\n\n\u003cp\u003eライブラリの初期化をTranslator Speech APIの接続を開始します。\u003cbr\u003e\nこの処理は録音開始のボタンの押下時に実行するように実装します。\u003cbr\u003e\nConnectメソッドにはUIで設定したfrom,to,Voiceを渡します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// Copyright(c) 2017 Takahiro Miyaura\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// Released under the MIT license\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// http://opensource.org/licenses/mit-license.php\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003eservice\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eCognitiveTranslatorService\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esubScriptionKey\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003eservice\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eOnTextMessage\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"n\"\u003eOnTextMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003eservice\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eOnVoiceMessage\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"n\"\u003eOnVoiceMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003eservice\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eConnect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003evoice\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eコンストラクタの引数にはAzureのサブスクリプションキーを渡します。\u003cbr\u003e\n2,3行目は送信した翻訳データを受信した際に呼び出すメソッドを割り当てる処理となります。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"2-データの送信\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#2-%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E9%80%81%E4%BF%A1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2. データの送信\u003c/h4\u003e\n\n\u003cp\u003e接続の完了後音声データを送信する処理は以下の通りです。Unityの方で音声データを集音した際にはデータは16bitのサンプリングデータに変換します。サービスへの送信についてはこれをByteの配列に変換します。データはリトルエンディアンになりますので注意してください。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// Copyright(c) 2017 Takahiro Miyaura\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// Released under the MIT license\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// http://opensource.org/licenses/mit-license.php\u003c/span\u003e\n\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003econvertBytes\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eConvertBytes\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esamplingData\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003econvertBytes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToArray\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"n\"\u003eservice\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAddSamplingData\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// Copyright(c) 2017 Takahiro Miyaura\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// Released under the MIT license\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// http://opensource.org/licenses/mit-license.php\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eIEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eConvertBytes\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eshort\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"n\"\u003esampleData\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003es\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003esampleData\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ebytes\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eBitConverter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetBytes\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eyield\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003ebytes\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eyield\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003ebytes\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"3-合成音声可能な言語リストの取得getttsinfoメソッド\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#3-%E5%90%88%E6%88%90%E9%9F%B3%E5%A3%B0%E5%8F%AF%E8%83%BD%E3%81%AA%E8%A8%80%E8%AA%9E%E3%83%AA%E3%82%B9%E3%83%88%E3%81%AE%E5%8F%96%E5%BE%97getttsinfo%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e3. 合成音声可能な言語リストの取得(GetTtsInfoメソッド)\u003c/h4\u003e\n\n\u003cp\u003eTranslator Speech APIでサポートしている合成音声の情報を取得します。これはUnity上のUIで値を選択するための情報として利用します。ライブラリではメソッドを１つ呼ぶだけで実施可能です。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// Copyright(c) 2017 Takahiro Miyaura\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// Released under the MIT license\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// http://opensource.org/licenses/mit-license.php\u003c/span\u003e\n\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003espeechTtsInfo\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eCognitiveTranslatorService\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetSpeechTtsInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"n\"\u003espeechTtsInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWait\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eなお、ライブラリのGetSpeechTtsInfoは非同期のメソッドとして定義していますので、\u003cbr\u003e\nレスポンスを同期的に処理するためにはWaitメソッドを用いて待機します。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"4-翻訳可能な言語リストの取得gettranslatelanguageinfoメソッド\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#4-%E7%BF%BB%E8%A8%B3%E5%8F%AF%E8%83%BD%E3%81%AA%E8%A8%80%E8%AA%9E%E3%83%AA%E3%82%B9%E3%83%88%E3%81%AE%E5%8F%96%E5%BE%97gettranslatelanguageinfo%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e4. 翻訳可能な言語リストの取得(GetTranslateLanguageInfoメソッド)\u003c/h4\u003e\n\n\u003cp\u003eTranslator Speech APIでサポートしている言語の情報を取得します。これはUnity上のUIで値を選択するための情報として利用します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// Copyright(c) 2017 Takahiro Miyaura\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// Released under the MIT license\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// http://opensource.org/licenses/mit-license.php\u003c/span\u003e\n\n\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003espeechTtsInfo\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eCognitiveTranslatorService\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetSpeechTextInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"n\"\u003espeechTtsInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWait\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"5-受信後翻訳結果テキストの処理ontextmessageメソッド\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#5-%E5%8F%97%E4%BF%A1%E5%BE%8C%E7%BF%BB%E8%A8%B3%E7%B5%90%E6%9E%9C%E3%83%86%E3%82%AD%E3%82%B9%E3%83%88%E3%81%AE%E5%87%A6%E7%90%86ontextmessage%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e5. 受信後(翻訳結果：テキスト)の処理(OnTextMessageメソッド)\u003c/h4\u003e\n\n\u003cp\u003eここでは、翻訳後のデータが入ったJSONデータを解析してUnity側に描画します。JSONデータには音声から解析された原文と翻訳後の情報があります。今回は両方のデータを利用できるように文字列を加工しています。Unityへの描画についてはコメントの部分に記載を行います。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// Copyright(c) 2017 Takahiro Miyaura\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// Released under the MIT license\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// http://opensource.org/licenses/mit-license.php\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003erivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnTextMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eobject\u003c/span\u003e \u003cspan class=\"n\"\u003esender\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eMessageWebSocketMessageReceivedEventArgs\u003c/span\u003e \u003cspan class=\"n\"\u003emessageWebSocketMessageReceivedEventArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eresult\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emessageWebSocketMessageReceivedEventArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetDataStream\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003esr\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eStreamReader\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAsStreamForRead\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \u003cspan class=\"n\"\u003eEncoding\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetEncoding\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"UTF-8\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)))\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eresult\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eReadToEnd\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ejsonObject\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eJsonObject\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eParse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eresult\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003erecognition\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ejsonObject\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"recognition\"\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetString\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003etranslation\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ejsonObject\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"translation\"\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetString\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e//(translation + \"\\n[\" + recognition + \"]\")\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//ここでUnity側に値を表示するロジックを実装する。\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"6-受信後翻訳結果合成音声の処理onvoicemessageメソッド\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#6-%E5%8F%97%E4%BF%A1%E5%BE%8C%E7%BF%BB%E8%A8%B3%E7%B5%90%E6%9E%9C%E5%90%88%E6%88%90%E9%9F%B3%E5%A3%B0%E3%81%AE%E5%87%A6%E7%90%86onvoicemessage%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e6. 受信後(翻訳結果：合成音声)の処理(OnVoiceMessageメソッド)\u003c/h4\u003e\n\n\u003cp\u003eここでは、翻訳後の音声データとしてバイナリデータが送られた場合、スピーカーから発話します。音声周りはNAudioを利用して再生しています。\u003cbr\u003e\nなお、発話するとスピーカーからの音声をマイクが集音することで雑音が増える結果になります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// Copyright(c) 2017 Takahiro Miyaura\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// Released under the MIT license\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// http://opensource.org/licenses/mit-license.php\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnVoiceMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eobject\u003c/span\u003e \u003cspan class=\"n\"\u003esender\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eMessageWebSocketMessageReceivedEventArgs\u003c/span\u003e \u003cspan class=\"n\"\u003emessageWebSocketMessageReceivedEventArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emessageWebSocketMessageReceivedEventArgs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetDataStream\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003estream\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAsStreamForRead\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003emStream\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMemoryStream\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ebufferSize\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e32000\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ebytes\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ebuf\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"kt\"\u003ebyte\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ebufferSize\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003elength\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estream\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRead\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebuf\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ebuf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ewhile\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elength\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003ebufferSize\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ebytes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAddRange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebuf\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"n\"\u003elength\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estream\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRead\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebuf\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ebuf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elength\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ebytes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAddRange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebuf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eTake\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elength\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eToArray\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003efullData\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ebytes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToArray\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"n\"\u003emStream\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efullData\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003efullData\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLength\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003emStream\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePosition\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ebitsPerSampleBytes\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003efullData\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSkip\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e34\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eTake\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eToArray\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003echannelBytes\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003efullData\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSkip\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e22\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eTake\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eToArray\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003esamplingBytes\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003efullData\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSkip\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e24\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eTake\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003eToArray\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ebitsPerSample\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eBitConverter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToInt16\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebitsPerSampleBytes\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003echannel\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eBitConverter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToInt16\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003echannelBytes\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003esamplingRate\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eBitConverter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToInt32\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esamplingBytes\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eplayer\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eWasapiOutRT\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eAudioClientShareMode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eShared\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e250\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eplayer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eInit\u003c/span\u003e\u003cspan class=\"p\"\u003e(()\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003ewaveChannel32\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eWaveChannel32\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eRawSourceWaveStream\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emStream\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                        \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eWaveFormat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esamplingRate\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ebitsPerSample\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003echannel\u003c/span\u003e\u003cspan class=\"p\"\u003e)));\u003c/span\u003e\n                \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003emixer\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMixingSampleProvider\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003ewaveChannel32\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToSampleProvider\u003c/span\u003e\u003cspan class=\"p\"\u003e()});\u003c/span\u003e\n\n                \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003emixer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eToWaveProvider16\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n            \u003cspan class=\"n\"\u003eplayer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ePlay\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ewhile\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eplayer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePlaybackState\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003ePlaybackState\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePlaying\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"最後に\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%9C%80%E5%BE%8C%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e最後に\u003c/h2\u003e\n\n\u003cp\u003e以上がHoloLensに組み込む際のポイントを残してみました。もう少しここはどうなってる？等ありましたら、コメントしていただければ返したいと思います。\u003cbr\u003e\nなお、2017年5月からTranslator Speech APIが大幅値下げされています。お試しで使うとしてもかなりお得感があるので色々試してください。\u003cbr\u003e\n私自身は、この翻訳アプリをDe:code 2017の基調講演で試行してみたいと思ってます。ただ、事前に映画見ながらも使っていたのですが「１．音声データの品質」「２．翻訳精度」の２つの問題から思ったようには翻訳されないことが多いです。かなり条件そろわないと難しい印象です。この辺り、他のTranslatorも少し使ってみようと思います。\u003c/p\u003e\n","createdAt":"2017-05-19T03:37:59Z","elapsedYearsFromLastModifiedAt":4,"encryptedId":"rWaGSVOs1ct3RBFtnNl12rfFfvY6bEJS--fXLfHvVyQal5Ubmv--/CKlle+i5+WZ3PlKjQxeeA==","isBanned":false,"isDeprecated":true,"isDestroyableByViewer":false,"isEditRequestReadableByViewer":true,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isSubscribableByViewer":false,"isSubscribedByViewer":false,"isUpdatableByViewer":false,"isUpdated":false,"lastModifiedAt":"2017-05-19T03:37:59Z","likesCount":4,"linkUrl":"https://qiita.com/miyaura/items/6f2570fe0dc0a8b0b7f1","organization":null,"originalId":494297,"stockedCount":5,"title":"HoloLensでTranslator Speech APIを使ったリアルタイム翻訳 -その3 HoloLensでテロップ表示","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#hololens%E3%81%A7%E3%83%AA%E3%82%A2%E3%83%AB%E3%82%BF%E3%82%A4%E3%83%A0%E7%BF%BB%E8%A8%B3\"\u003eHoloLensでリアルタイム翻訳\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%BB%8A%E5%9B%9E%E3%81%AE%E7%92%B0%E5%A2%83\"\u003e今回の環境\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%AE%9F%E8%A3%85%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\"\u003e実装について\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E4%BA%8B%E5%89%8D%E4%BD%9C%E6%A5%AD%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\"\u003e事前作業について\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#1-unity%E3%81%A7%E3%81%AE%E5%AE%9F%E8%A3%85ui\"\u003e1. Unityでの実装(UI)\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#2-%E9%9F%B3%E5%A3%B0%E5%87%A6%E7%90%86%E3%81%AE%E5%AE%9F%E8%A3%85\"\u003e2. 音声処理の実装\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E8%A8%AD%E5%AE%9A\"\u003eオブジェクトの設定\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%88%9D%E6%9C%9F%E5%8C%96%E5%87%A6%E7%90%86\"\u003e初期化処理\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%BF%BB%E8%A8%B3%E7%B5%90%E6%9E%9C%E3%81%AE%E8%A1%A8%E7%A4%BA\"\u003e翻訳結果の表示\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%9E%E3%82%A4%E3%82%AF%E3%81%AE%E9%9B%86%E9%9F%B3%E9%96%8B%E5%A7%8B%E7%B5%82%E4%BA%86%E5%8F%8A%E3%81%B3%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E9%80%81%E4%BF%A1\"\u003eマイクの集音開始/終了及びデータの送信\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%9E%E3%82%A4%E3%82%AF%E3%81%AE%E9%9B%86%E9%9F%B3%E9%96%8B%E5%A7%8B\"\u003eマイクの集音開始\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%83%9E%E3%82%A4%E3%82%AF%E3%81%AE%E9%9B%86%E9%9F%B3%E7%B5%82%E4%BA%86\"\u003eマイクの集音終了\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E9%9B%86%E9%9F%B3%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E9%80%81%E4%BF%A1\"\u003e集音データの送信\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#3-uwp%E5%81%B4%E3%81%AE%E5%AE%9F%E8%A3%85%E5%89%8D%E3%80%85%E5%9B%9E%E4%BD%9C%E6%88%90%E3%81%AE%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%82%92%E5%8F%82%E7%85%A7%E3%81%97%E3%81%9F%E3%82%A2%E3%83%97%E3%83%AA%E3%81%AE%E5%AE%9F%E8%A3%85\"\u003e3. UWP側の実装(前々回作成のライブラリを参照したアプリの実装）\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#1-%E5%88%9D%E6%9C%9F%E5%8C%96%E5%87%A6%E7%90%86%E3%82%92%E6%8E%A5%E7%B6%9A%E3%81%AE%E9%96%8B%E5%A7%8B\"\u003e1. 初期化処理を接続の開始\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#2-%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E9%80%81%E4%BF%A1\"\u003e2. データの送信\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#3-%E5%90%88%E6%88%90%E9%9F%B3%E5%A3%B0%E5%8F%AF%E8%83%BD%E3%81%AA%E8%A8%80%E8%AA%9E%E3%83%AA%E3%82%B9%E3%83%88%E3%81%AE%E5%8F%96%E5%BE%97getttsinfo%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89\"\u003e3. 合成音声可能な言語リストの取得(GetTtsInfoメソッド)\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#4-%E7%BF%BB%E8%A8%B3%E5%8F%AF%E8%83%BD%E3%81%AA%E8%A8%80%E8%AA%9E%E3%83%AA%E3%82%B9%E3%83%88%E3%81%AE%E5%8F%96%E5%BE%97gettranslatelanguageinfo%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89\"\u003e4. 翻訳可能な言語リストの取得(GetTranslateLanguageInfoメソッド)\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#5-%E5%8F%97%E4%BF%A1%E5%BE%8C%E7%BF%BB%E8%A8%B3%E7%B5%90%E6%9E%9C%E3%83%86%E3%82%AD%E3%82%B9%E3%83%88%E3%81%AE%E5%87%A6%E7%90%86ontextmessage%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89\"\u003e5. 受信後(翻訳結果：テキスト)の処理(OnTextMessageメソッド)\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#6-%E5%8F%97%E4%BF%A1%E5%BE%8C%E7%BF%BB%E8%A8%B3%E7%B5%90%E6%9E%9C%E5%90%88%E6%88%90%E9%9F%B3%E5%A3%B0%E3%81%AE%E5%87%A6%E7%90%86onvoicemessage%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89\"\u003e6. 受信後(翻訳結果：合成音声)の処理(OnVoiceMessageメソッド)\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%9C%80%E5%BE%8C%E3%81%AB\"\u003e最後に\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":2125,"uuid":"6f2570fe0dc0a8b0b7f1","banReason":null,"adventCalendarItem":null,"author":{"encryptedId":"QSRHr8QNY4noRz1dMpzbLD8Jp4SS--NDK0CjbBTXcWVyl7--rOgSFZrSpJ5NPf6H/3EWfw==","originalId":152548,"description":"C#ベース。現在はMR関連の技術に興味あり。\r\nMicrosoft MVP for Windows Development(2018-2022)","facebookUrl":null,"githubUrl":"https://github.com/TakahiroMiyaura","isBlockingViewer":false,"isFollowableByViewer":true,"isFollowedByViewer":false,"isTweetWebNotificationReceivable":true,"linkedinUrl":null,"name":"Miyaura","profileImageUrl":"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/152548/profile-images/1616018241","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F152548%2Fprofile-images%2F1616018241?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=c58087e984e4d654f6504a1c34bd6a30","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F152548%2Fprofile-images%2F1616018241?ixlib=rb-4.0.0\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=61c4f9412b9ce18c58a30ab1b3cc989e","urlName":"miyaura","websiteUrl":"","twitterUrl":"https://twitter.com/takabrz1","twitterUrlName":"takabrz1","revealedOrganizations":{"edges":[]}},"tags":[{"name":"C#","urlName":"csharp"},{"name":"VisualStudio2015","urlName":"visualstudio2015"},{"name":"UWP","urlName":"uwp"},{"name":"HoloLens","urlName":"hololens"}],"followingLikers":{"edges":[]},"comments":{"totalCount":0}},"comments":[],"client":null,"ads_event_emitter":null}}</script>

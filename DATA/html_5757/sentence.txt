More than 3 years have passed since last update.これは、Visual Basic Advent Calendar 2017の10日目の記事となります。末尾数字を取得するって結構ありそうな気がするんですが、ネット上でもっと見つかると思ったのですが意外となかったです。
文字列の語尾が数字の部分を正規表現で取得したい - teratailコントロール名やDBの列名の末尾に数字を付けるとかありますよね。その場合は区切り文字として"_"等を付ければ、正規表現で末尾数字の取得は簡単そうです。
でも、今回は区切り文字は付けないで末尾数字を取得します。設定ファイルをxml形式で作成したところ、ユーザーからIni形式で慣れているので変更して欲しいという要望がありました。
既に本体プログラムはReadXmlでDataSet型にして設定を読み込むむようになっていたため、本体プログラムに出来るだけ影響しないようにIni形式をDataSet型に変換するクラスを作成しました。
このクラスを作成した際に、セクションやキーの末尾に数字があればグループとして扱うようにしました。DataSet型にはテーブル名「FONT」でDataTable型として次のようにセットされます。Grp列にはセクションの末尾数字をセットします。末尾数字を取得するのに正規表現を使います。
どうせ正規表現を使うなら、英字部分(FONT)と数字部分(n)を分割して1度に取得したいと考えました。正規表現の部分だけを考察します。
次の正規表現では、末尾１桁の数字なら正常に取得できるのですが、2桁以上になると英字部分に数字が含まれてしまいます。後ろから検索してくれれば、2桁以上になっても英字部分に数字が含まれないようになりそうです。
正規表現は先頭から検索していくよなーという思い込みがあって、じゃー文字列を反転させてしまえばどうだろうか。文字列を反転されていることを考慮して、正規表現側を数字と英字の順にします。
取得結果も反転した状態なので、最終結果では反転させて元に戻します。結果はいいですが、コスト的にさすがにこれはないよな・・・正規表現で後ろから読んでくれればいいよねと、検索してみると次のサイトを見つけまして、内容の結果は違えど解決のヒントがありました。
Perlの正規表現で後ろからマッチさせる初期状態では、最長マッチとなっているので最短マッチ(「*」の後に「?」を追加)にしてみました。試しに、英字部分の間に数字含めてみました。
結果はいい感じです。【2017/12/11追記】
albireoさんからコメントを頂き、(?&lt;Key&gt;.*\D)(?&lt;No&gt;\d+$)の方が一般的だと思います。数字のみのセクションやキーは考慮しないことにします。C#版も載せておきます。実はこの記事を書くまで、次のようにしていました。
なので、お仕事のソースコードは書き換えですね。



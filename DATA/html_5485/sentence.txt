More than 3 years have passed since last update.「小町算(こまちざん)」とは、1～9までの数字と＋、－、×、÷  の記号を使って、計算結果が100になる式を作る数学パズルです。江戸時代にはすでに知られていたということで、歴史あるパズルです。例えば、

123 + 4 - 5 + 67 - 89 = 100

はその正解の一つです。このパズルの変形として、＋、－だけ使うものとか、（）を認めるものとか、色々あるようです。ここでは、＋、－だけを使って100になるような式を求めています。解き方はいろいろあると思いますが、１□２□３□４□５□６□７□８□９の四角の中に、＋、－、空文字を入れてゆき、その計算結果が100になるものを求めという方法を採用します。例えば、四角の中に、順に　"", "", "+", "-", "+", "", "-", "" を入れていけば、次のような式が出来上がります。この式が、100になるかを確かめれば良いことになります。これをすべてのパターンで調べるわけですね。「四角の中に、＋、－、空文字を入れる」というのは、実は、組合せの一種です。
この組合せを求めるのに再帰処理を使う方法もありますが、今回は、LINQのクエリ式で組合せを求めています。例えば、普段クエリ形式のLINQって書かないのですが、これは、クエリ式使ったほうがすっきりと簡単に書けますね。上のコードを実行すると、という結果を得られます。このように個数が事前に分かっている場合は、LINQのfromを複数使ったクエリ式を使うととても簡単です。LINQすごいです。つまり、という配列に対し、とすれば、１□２□３□４□５□６□７□８□９の四角の中に入れる組合せを求めることが出来るというわけです。
そして、以下のコードで、計算式としても文字列を組み立てます。これで、"1234+5-678-9"  のような文字列が出来上がります。この計算式をコンピュータに計算させれば良いわけです。この計算をするのに、C#:逆ポーランド記法を利用した数式の計算とか C#:Roslynを使って数式を計算するクラスを作成してみたで示した、Expressionクラスを使います。×、÷ も含めた小町算を解くには、割り算で、切り捨てにならないように注意する必要がありますね。こことかこことかに少し手を加えれば、たぶんできると思います。いちおう、C#:Roslynを使って数式を計算するクラスを作成してみたで示した、Expressionクラスのコードも掲載しておきます。この記事は、Gushwell's C# Programming Pageで公開したものをに大幅に加筆・修正したものです。



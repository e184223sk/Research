More than 1 year has passed since last update.Web関連のお仕事中ですが、なぜかC#を使うことになりネットで検索しながら対応しました。
ですが、案外と古い情報ばかりで答えに到達できずに少し苦労しましたので、最新の情報に更新したいと思います。C#で特定のWebサイトをスクレイピングして、サイト内のURLを取得し、そのリンク先にあるzipファイルをダウンロード。。。
月次、日次や週次処理として自動化することが目的です。C# (.Net 4.7.x) Visual Studio 2017を使用
AngleSharp 0.13.0.0 (2019/10現在の最新を使用)
System.IO.Compression.FileSystem (Zipファイルを解凍するのに使用)Visual Studio 2017の NuGetからインストールします。
※　詳細は割愛します。プロジェクトの参照の追加より、System.IO.Compression.FileSystem を追加します。
参考にしましたサイトは以下です。
C#でZipファイルを解凍・圧縮するHttpClientをusingで囲わないでくださいちょうどいいタイミングでトレンドになっていましたので、参考になりました。呼び出し元で同期したかったので、すべての処理が終わるまで待ち合わせています。
Taskのメソッドを呼び出して対応しています。取得の仕方はいろいろあると思いますが、今回は簡単な方法を採用しました。
client.GetStreamAsync()などでもいいかと思います。パースの仕方が以前の方法から変わっています。
参考にしたサイトなどはほとんどdoc = await parser.ParseAsync(stream);などとなっていました。
現在のバージョンでは、ParseAsync()はありません。今回掲載はしていませんが、例えば、
div.button-div &gt; a などでセレクタ指定します。
上記の場合は、 divタグのclass属性に”button-div”があるときにそのdiv内にあるaタグをすべて取得する
となります。ファイルのダウンロードは、WebClient クラスで簡単にできます。ZIPファイルの解凍はZipFileクラスで簡単にできます。
.Net 4.5以上ならとても簡単です。技術は日々変わっていますので、情報のアップデートは必要ですね。
調べるのに結構時間がかかりましたのでご参考になれば幸いです。参考になりました。ありがとうございました。HttpClientをusingで囲わないでください
C#でモダンにスクレイピングするならAngleSharp
C#でZipファイルを解凍・圧縮する
ネットワーク上のファイルのダウンロード


